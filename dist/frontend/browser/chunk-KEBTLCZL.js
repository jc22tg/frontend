import{a as U}from"./chunk-MZVWOBTH.js";import{a as F}from"./chunk-PYE7UGMK.js";import{a as l}from"./chunk-ULFK375Q.js";import{F as a,G as M,c as y,ed as P,fd as g,g as I,gd as A,id as p,ja as c,m as O,o as s,oa as u,pa as m,s as d,u as D}from"./chunk-FG6FKNI4.js";import{a as w,b as T}from"./chunk-OXVY4BEJ.js";var f=[{id:"conn-001",name:"Conexi\xF3n OLT-1 a Splitter-1",type:"FIBER",sourceElementId:"olt-001",targetElementId:"splitter-001",status:"ACTIVE",properties:{fiberType:"SINGLE_MODE",length:1250,lastUpdated:new Date("2023-01-15")}},{id:"conn-002",name:"Conexi\xF3n Splitter-1 a FDP-1",type:"FIBER",sourceElementId:"splitter-001",targetElementId:"fdp-001",status:"ACTIVE",properties:{fiberType:"SINGLE_MODE",length:850,lastUpdated:new Date("2023-01-15")}},{id:"conn-003",name:"Conexi\xF3n FDP-1 a ONT-1",type:"FIBER",sourceElementId:"fdp-001",targetElementId:"ont-001",status:"ACTIVE",properties:{fiberType:"SINGLE_MODE",length:120,lastUpdated:new Date("2023-01-16")}},{id:"conn-004",name:"Conexi\xF3n OLT-1 a EDFA-1",type:"FIBER",sourceElementId:"olt-001",targetElementId:"edfa-001",status:"ACTIVE",properties:{fiberType:"SINGLE_MODE",length:5600,lastUpdated:new Date("2023-02-01")}},{id:"conn-005",name:"Conexi\xF3n EDFA-1 a Manga-1",type:"FIBER",sourceElementId:"edfa-001",targetElementId:"manga-001",status:"ACTIVE",properties:{fiberType:"SINGLE_MODE",length:2300,lastUpdated:new Date("2023-02-15")}}];var b=class o{constructor(e){this.http=e}apiUrl=`${l.apiUrl}/network`;elementsSubject=new I([]);elements$=this.elementsSubject.asObservable();getNetworkElements(){return console.warn("getNetworkElements() no soporta paginaci\xF3n y podr\xEDa devolver muchos datos."),this.http.get(`${this.apiUrl}/elements`)}getElements(e,t){let r=this.getElementPath(e);if(!r)return s(()=>new Error(`Path no definido para el tipo de elemento: ${e}`));let n=new g;if(t){if(t.page!==void 0&&(n=n.set("page",t.page.toString())),t.pageSize!==void 0&&(n=n.set("pageSize",t.pageSize.toString())),t.sortBy&&(n=n.set("sortBy",t.sortBy)),t.sortDirection&&(n=n.set("sortDirection",t.sortDirection)),t.filter)for(let i in t.filter)t.filter.hasOwnProperty(i)&&t.filter[i]!==void 0&&t.filter[i]!==null&&(n=n.set(i,t.filter[i].toString()));for(let i in t)t.hasOwnProperty(i)&&!["page","pageSize","sortBy","sortDirection","filter"].includes(i)&&t[i]!==void 0&&t[i]!==null&&(n=n.set(i,t[i].toString()))}return this.http.get(`${this.apiUrl}/${r}`,{params:n})}getElementPath(e){switch(e){case"FIBER_CABLE":return"fiber-cables";case"FIBER_SPLICE":return"fiber-splices";case"FIBER_STRAND":return"fiber-strands";case"FIBER_THREAD":return"fiber-threads";default:return console.error(`Path de API no definido en getElementPath para el tipo: ${e}`),null}}getElementsByType(e,t){return this.getElements(e,t)}getElementById(e){return this.http.get(`${this.apiUrl}/elements/${e}`)}updateElementStatus(e,t){return this.http.patch(`${this.apiUrl}/elements/${e}/status`,{status:t})}getConnections(){let e=new P({Accept:"application/json","Content-Type":"application/json"});return this.http.get(`${this.apiUrl}/connections`,{headers:e}).pipe(a(t=>(console.error("Error obteniendo conexiones:",t),t?.error?.text&&typeof t.error.text=="string"&&t.error.text.includes("<!DOCTYPE html>")?(console.warn("El servidor devolvi\xF3 HTML en lugar de JSON. Usando datos mock."),new y(r=>{r.next(f),r.complete()})):l.useMocks?(console.log("Usando datos mock para conexiones"),new y(r=>{r.next(f),r.complete()})):s(()=>t))))}createConnection(e){return this.http.post(`${this.apiUrl}/connections`,e)}updateConnection(e,t){return this.http.put(`${this.apiUrl}/connections/${e}`,t)}deleteConnection(e){return this.http.delete(`${this.apiUrl}/connections/${e}`)}getMonitoringData(e){return this.http.get(`${this.apiUrl}/monitoring/${e}`).pipe(a(this.handleError))}getAlerts(){return this.http.get(`${this.apiUrl}/alerts`).pipe(a(this.handleError))}getClients(){return this.http.get(`${this.apiUrl}/clients`).pipe(a(this.handleError))}handleError(e){return console.error("Error en el servicio de red:",e),s(()=>new Error("Error en el servicio de red"))}simulateFailure(e){return this.http.post(`${this.apiUrl}/simulate-failure`,e)}deleteElement(e){return this.http.delete(`${this.apiUrl}/elements/${e}`)}createElement(e){return this.http.post(`${this.apiUrl}/elements`,e)}updateElement(e,t){return this.http.put(`${this.apiUrl}/elements/${e}`,t)}static \u0275fac=function(t){return new(t||o)(u(p))};static \u0275prov=c({token:o,factory:o.\u0275fac,providedIn:"root"})};var E=class o{constructor(e){this.http=e}apiUrl=`${l.apiUrl}/monitoring`;getMonitoringData(e,t){return this.http.get(`${this.apiUrl}/data/${t}/${e}`)}getElementMetrics(e,t,r){let n=new g().set("timeRange",r);return this.http.get(`${this.apiUrl}/metrics/${t}/${e}`,{params:n})}getNetworkAlerts(e,t){let r=new g;return e&&(r=r.set("severity",e)),t!==void 0&&(r=r.set("resolved",t.toString())),this.http.get(`${this.apiUrl}/alerts`,{params:r})}resolveAlert(e){return this.http.patch(`${this.apiUrl}/alerts/${e}/resolve`,{})}getMaintenanceSchedules(e){let t=new g;return e&&(t=t.set("status",e)),this.http.get(`${this.apiUrl}/maintenance`,{params:t})}scheduleMaintenanceTask(e){return this.http.post(`${this.apiUrl}/maintenance`,e)}updateMaintenanceTask(e,t){return this.http.patch(`${this.apiUrl}/maintenance/${e}`,t)}subscribeToMetrics(e,t){throw new Error("Not implemented")}static \u0275fac=function(t){return new(t||o)(u(p))};static \u0275prov=c({token:o,factory:o.\u0275fac,providedIn:"root"})};var v=class o{constructor(e){this.http=e}apiUrl=`${l.apiUrl}/attachments`;getAttachments(e,t){return this.http.get(`${this.apiUrl}`,{params:{entityType:e,entityId:t}})}uploadAttachment(e,t,r,n){let i=new FormData;i.append("file",e),i.append("entityType",t),i.append("entityId",r),i.append("description",n);let h=new A("POST",this.apiUrl,i,{reportProgress:!0});return this.http.request(h)}deleteAttachment(e){return this.http.delete(`${this.apiUrl}/${e}`)}downloadAttachment(e){return this.http.get(`${this.apiUrl}/${e}/download`,{responseType:"blob"})}updateAttachment(e,t){return this.http.patch(`${this.apiUrl}/${e}`,t)}static \u0275fac=function(t){return new(t||o)(u(p))};static \u0275prov=c({token:o,factory:o.\u0275fac,providedIn:"root"})};var j=class o{apiUrl=l.apiUrl;networkService=m(b);monitoringService=m(E);attachmentService=m(v);projectService=m(U);http=m(p);logger=m(F);getElementsByType(e,t){return this.networkService.getElementsByType(e,t)}updateElementStatus(e,t){if(!e)throw new Error("ID de elemento no definido");return this.networkService.updateElementStatus(e,t)}validatePosition(e){if(!e||!e.coordinates||e.coordinates.length!==2)return!1;let t=e.coordinates[0],r=e.coordinates[1];return r>=17.5&&r<=19.9&&t>=-72&&t<=-68.3}calculateDistance(e,t){let n=e.position.coordinates[1],i=e.position.coordinates[0],h=t.position.coordinates[1],R=t.position.coordinates[0],N=this.toRad(h-n),k=this.toRad(R-i),S=Math.sin(N/2)*Math.sin(N/2)+Math.sin(k/2)*Math.sin(k/2)*Math.cos(this.toRad(n))*Math.cos(this.toRad(h));return 6371*(2*Math.atan2(Math.sqrt(S),Math.sqrt(1-S)))}toRad(e){return e*Math.PI/180}getMonitoringData(e,t){if(!e)throw new Error("ID de elemento no definido");return this.monitoringService.getMonitoringData(e,t)}getNetworkAlerts(e,t){return this.monitoringService.getNetworkAlerts(e,t)}resolveAlert(e){return this.monitoringService.resolveAlert(e)}getMaintenanceSchedules(e){let t=typeof e=="string"?e.toLowerCase():e;return this.monitoringService.getMaintenanceSchedules(t)}scheduleMaintenanceTask(e){return this.monitoringService.scheduleMaintenanceTask(e)}getAttachments(e,t){return this.attachmentService.getAttachments(e,t)}uploadAttachment(e,t,r,n){return this.attachmentService.uploadAttachment(e,t,r,n).pipe(d(i=>{if(i.type===4)return i.body;throw new Error("Error en la subida del archivo")}))}getClients(e){return this.projectService.getClients(e)}getClientById(e){return this.projectService.getClientById(e)}getProjects(e){return this.projectService.getProjects()}createProject(e){return this.projectService.createProject(e)}updateProject(e,t){return this.projectService.updateProject(e,t)}getConnections(){return this.logger.info("NetworkDesignService: Fetching connections."),this.networkService.getConnections().pipe(d(e=>Array.isArray(e)?e.map(t=>this.mapFiberConnectionModelToNetworkConnection(t)):(this.logger.error("NetworkDesignService: getConnections response is not an array.",e),[])),a(e=>(this.logger.error("Error fetching connections in NetworkDesignService",e),s(()=>new Error("Failed to fetch connections")))))}createConnection(e){this.logger.info("NetworkDesignService: Creating connection.",e);let t=this.mapNetworkConnectionToFiberConnectionPayload(e);return this.logger.debug("NetworkDesignService: createConnection payload for networkService:",t),this.networkService.createConnection(t).pipe(d(r=>(this.logger.info("NetworkDesignService: Connection created by networkService, mapping response.",r),this.mapFiberConnectionModelToNetworkConnection(r))),a(r=>(this.logger.error("Error creating connection in NetworkDesignService",r,{originalInput:e,mappedPayload:t}),s(()=>new Error("Failed to create connection")))))}updateConnection(e,t){this.logger.info(`NetworkDesignService: Updating connection ${e}.`,t);let r=this.mapNetworkConnectionToFiberConnectionPayload(t);return this.logger.debug(`NetworkDesignService: updateConnection payload for networkService (id: ${e}):`,r),this.networkService.updateConnection(e,r).pipe(d(n=>(this.logger.info(`NetworkDesignService: Connection ${e} updated by networkService, mapping response.`,n),this.mapFiberConnectionModelToNetworkConnection(n))),a(n=>(this.logger.error(`Error updating connection ${e} in NetworkDesignService`,n,{originalInput:t,mappedPayload:r}),s(()=>new Error("Failed to update connection")))))}getElementsById(e){return this.networkService.getElementById(e)}deleteElement(e){return this.networkService.deleteElement(e)}createElement(e){return this.networkService.createElement(e)}updateElement(e,t){return this.networkService.updateElement(e,t)}createNetworkElements(e){return O(e).pipe(D(t=>this.createElement(t)),M())}getElementHistory(e){return this.http.get(`${this.apiUrl}/elements/${e}/history`).pipe(a(t=>(this.logger.error("Error al obtener historial del elemento:",t),s(()=>new Error(`Error al obtener historial: ${t.message}`)))),d(t=>t.map(r=>T(w({},r),{timestamp:new Date(r.timestamp)}))))}mapFiberConnectionModelToNetworkConnection(e){if(!e)return this.logger.error("mapFiberConnectionModelToNetworkConnection: input FiberConnectionModel is null or undefined."),{id:"ERROR_NULL_INPUT",sourceElementId:"UNKNOWN_SOURCE",targetElementId:"UNKNOWN_TARGET",type:"FIBER",status:"INACTIVE",name:"Error: Null Input Connection"};let t=e.sourceId||e.properties?.sourceId,r=e.targetId||e.properties?.targetId,n=e.connectionType||e.properties?.connectionType,i=e.status||e.properties?.status;return(!t||!r||!n||!i)&&this.logger.warn(`FiberConnectionModel (id: ${e.id}) is missing one or more required fields (sourceId, targetId, type, status) for full NetworkConnection mapping. Using defaults. Original object:`,e),{id:e.id,name:e.name||`Connection ${e.id}`,description:e.description,sourceElementId:t||"UNKNOWN_SOURCE",targetElementId:r||"UNKNOWN_TARGET",type:n||"FIBER",status:i||"INACTIVE",capacity:e.capacity||(typeof e.bandwidth=="number"?e.bandwidth:void 0),utilization:e.utilization,latency:e.latency,properties:w({usageType:e.usageType,fiberType:e.fiberType,connectorType:e.connectorType,polishingType:e.polishingType,standard:e.standard,insertionLoss:e.insertionLoss,returnLoss:e.returnLoss,wavelength:e.wavelength,bandwidthMhzKm:e.bandwidth,coreDiameter:e.coreDiameter,claddingDiameter:e.claddingDiameter,outerDiameter:e.outerDiameter,operatingTemperature:e.operatingTemperature,tensileStrength:e.tensileStrength,manufacturer:e.manufacturer,modelNumber:e.modelNumber,manufacturingDate:e.manufacturingDate,certifications:e.certifications,strands:e.strands,strandConfiguration:e.strandConfiguration,networkInfo:e.networkInfo,installation:e.installation,maintenance:e.maintenance,emergency:e.emergency},e.properties||{}),metadata:e.metadata,fiberDetails:e,createdAt:e.createdAt||e.manufacturingDate,updatedAt:e.updatedAt,points:e.points||e.networkInfo?.points,vertices:e.vertices}}mapNetworkConnectionToFiberConnectionPayload(e){let t=e.fiberDetails,r=e.properties||{},n={name:e.name||"Connection",description:e.description,usageType:r.usageType||t?.usageType||"DISTRIBUTION",fiberType:r.fiberType||t?.fiberType||"SINGLE_MODE",connectorType:r.connectorType||t?.connectorType||"SC",polishingType:r.polishingType||t?.polishingType||"APC",standard:r.standard||t?.standard||"ITU-T G.652",insertionLoss:typeof(r.insertionLoss??t?.insertionLoss)=="number"?r.insertionLoss??t?.insertionLoss:0,returnLoss:typeof(r.returnLoss??t?.returnLoss)=="number"?r.returnLoss??t?.returnLoss:0,wavelength:typeof(r.wavelength??t?.wavelength)=="number"?r.wavelength??t?.wavelength:1310,bandwidth:typeof(r.bandwidthMhzKm??t?.bandwidth)=="number"?r.bandwidthMhzKm??t?.bandwidth:0,coreDiameter:r.coreDiameter??t?.coreDiameter,claddingDiameter:r.claddingDiameter??t?.claddingDiameter,outerDiameter:r.outerDiameter??t?.outerDiameter,operatingTemperature:r.operatingTemperature??t?.operatingTemperature,tensileStrength:r.tensileStrength??t?.tensileStrength,manufacturer:r.manufacturer??t?.manufacturer,modelNumber:r.modelNumber??t?.modelNumber,manufacturingDate:r.manufacturingDate??t?.manufacturingDate,certifications:r.certifications??t?.certifications,strands:r.strands??t?.strands,strandConfiguration:r.strandConfiguration??t?.strandConfiguration,networkInfo:r.networkInfo??t?.networkInfo,installation:r.installation??t?.installation,maintenance:r.maintenance??t?.maintenance,emergency:r.emergency??t?.emergency,metadata:e.metadata||r.metadata||t?.metadata};return Object.keys(n).forEach(i=>n[i]===void 0&&delete n[i]),"sourceId"in e&&e.sourceId&&(n.sourceId=e.sourceId),"targetId"in e&&e.targetId&&(n.targetId=e.targetId),"type"in e&&e.type&&(n.type=e.type),"status"in e&&e.status&&(n.status=e.status),n}static \u0275fac=function(t){return new(t||o)};static \u0275prov=c({token:o,factory:o.\u0275fac,providedIn:"root"})};export{b as a,j as b};
