import{a as O,b as P}from"./chunk-SFSNZG2F.js";import{a as T}from"./chunk-PYE7UGMK.js";import{a as b}from"./chunk-ULFK375Q.js";import{$ as M,F as E,M as S,fa as g,g as L,id as k,ja as y,n as d,o as w,oa as h,s as N}from"./chunk-FG6FKNI4.js";import{a as p,b as m}from"./chunk-OXVY4BEJ.js";function c(s,e,t){return{type:"Point",coordinates:[e,s],altitude:t,lat:s,lng:e}}function _(s,e={}){let[t,r]=s;if(isNaN(t)||isNaN(r))throw new Error("Las coordenadas deben ser valores num\xE9ricos");if(t<-180||t>180)throw new Error("La longitud debe estar entre -180 y 180");if(r<-90||r>90)throw new Error("La latitud debe estar entre -90 y 90");return c(r,t,e.altitude)}var f={api:{baseUrl:"/api/v1",timeout:3e4,retryAttempts:3,backendUrl:"http://localhost:3000/api",maxPageSize:100,defaultPageSize:20},map:{initialZoom:6,maxZoom:18,minZoom:4,defaultCenter:[0,0],tileLayers:{default:{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'},satellite:{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"},dark:{url:"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'}},gridSize:100,clusteringThreshold:20,elementIcons:{size:{default:32,small:24,large:48},scaleFactor:1.2},debug:!1,loadTimeout:1e4,renderLimitPerFrame:50},cache:{defaultExpiryTime:3e5,storagePrefix:"network-app-",maxLocalStorageSize:5242880,localStorageKeys:{user:"user",theme:"theme",elements:"elements",elementTypes:"element-types",mapState:"map-state",mapPosition:"map-position",lastProject:"last-project"}},ui:{snackbarDuration:3e3,confirmDialogWidth:"400px",tooltipDelay:500,animations:{enabled:!0,duration:{short:200,medium:300,long:500}},debounceTime:300,themeModes:{light:"light-theme",dark:"dark-theme"},defaultLanguage:"es",dateFormat:"dd/MM/yyyy",dateTimeFormat:"dd/MM/yyyy HH:mm"},features:{offlineMode:!0,mapLayerSettings:!0,elementHistory:!0,connections:!0,connectionTypes:!0,projects:!0,reports:!0,monitoring:!0,userManagement:!0,networkGraph:!0,batchOperations:!0,importExport:!0,diagnostics:!0},debugging:{logLevel:"info",enableDevTools:!0,componentBoundaries:!1,measurePerformance:!0,trackMemory:!1}};var C=class s{constructor(e){this.logger=e}memoryCache=new Map;set(e,t,r){let a=Date.now(),i={data:t,timestamp:a};if(this.memoryCache.set(e,i),this.logger.debug(`[Cache] Guardado en memoria: ${e}`),r?.useLocalStorage)try{let o=r.storageKey||e,n=this.getPrefixedKey(o);localStorage.setItem(n,JSON.stringify(i)),this.logger.debug(`[Cache] Guardado en localStorage: ${n}`)}catch(o){this.logger.error("[Cache] Error al guardar en localStorage",o)}}get(e,t){let r=t?.expiryTime||f.cache.defaultExpiryTime,a=Date.now(),i=this.memoryCache.get(e);if(i){if(a-i.timestamp<r)return this.logger.debug(`[Cache] Obtenido de memoria: ${e}`),i.data;this.logger.debug(`[Cache] Expirado en memoria: ${e}`),this.memoryCache.delete(e)}if(t?.useLocalStorage)try{let o=t.storageKey||e,n=this.getPrefixedKey(o),l=localStorage.getItem(n);if(l){let u=JSON.parse(l);if(a-u.timestamp<r)return this.memoryCache.set(e,u),this.logger.debug(`[Cache] Obtenido de localStorage: ${n}`),u.data;this.logger.debug(`[Cache] Expirado en localStorage: ${n}`),localStorage.removeItem(n)}}catch(o){this.logger.error("[Cache] Error al leer de localStorage",o)}return null}has(e,t){let r=t?.expiryTime||f.cache.defaultExpiryTime,a=Date.now(),i=this.memoryCache.get(e);if(i&&a-i.timestamp<r)return!0;if(t?.useLocalStorage)try{let o=t.storageKey||e,n=this.getPrefixedKey(o),l=localStorage.getItem(n);if(l){let u=JSON.parse(l);return a-u.timestamp<r}}catch(o){this.logger.error("[Cache] Error al verificar existencia en localStorage",o)}return!1}remove(e,t){if(this.memoryCache.delete(e),this.logger.debug(`[Cache] Eliminado de memoria: ${e}`),t?.useLocalStorage)try{let r=t.storageKey||e,a=this.getPrefixedKey(r);localStorage.removeItem(a),this.logger.debug(`[Cache] Eliminado de localStorage: ${a}`)}catch(r){this.logger.error("[Cache] Error al eliminar de localStorage",r)}}clear(e){if(this.memoryCache.clear(),this.logger.debug("[Cache] Memoria limpiada"),!e?.preserveLocalStorage)try{let t=[],r=f.cache.storagePrefix;for(let a=0;a<localStorage.length;a++){let i=localStorage.key(a);i&&i.startsWith(r)&&t.push(i)}t.forEach(a=>localStorage.removeItem(a)),this.logger.debug(`[Cache] LocalStorage limpiado: ${t.length} elementos`)}catch(t){this.logger.error("[Cache] Error al limpiar localStorage",t)}}cleanExpired(e){let t=e||f.cache.defaultExpiryTime,r=Date.now();for(let[a,i]of this.memoryCache.entries())r-i.timestamp>=t&&(this.memoryCache.delete(a),this.logger.debug(`[Cache] Eliminada entrada expirada: ${a}`));try{let a=f.cache.storagePrefix,i=[];for(let o=0;o<localStorage.length;o++){let n=localStorage.key(o);if(n&&n.startsWith(a))try{let l=localStorage.getItem(n);if(l){let u=JSON.parse(l);r-u.timestamp>=t&&i.push(n)}}catch{i.push(n)}}i.forEach(o=>localStorage.removeItem(o)),this.logger.debug(`[Cache] Limpiadas entradas expiradas de localStorage: ${i.length}`)}catch(a){this.logger.error("[Cache] Error al limpiar entradas expiradas",a)}}getPrefixedKey(e){return`${f.cache.storagePrefix}${e}`}static \u0275fac=function(t){return new(t||s)(h(T))};static \u0275prov=y({token:s,factory:s.\u0275fac,providedIn:"root"})};var v=class s{formatFileSize(e){if(e===0)return"0 Bytes";let t=1024,r=["Bytes","KB","MB","GB","TB"],a=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,a)).toFixed(2))+" "+r[a]}calculateDistance(e,t,r,a){let o=this.deg2rad(r-e),n=this.deg2rad(a-t),l=Math.sin(o/2)*Math.sin(o/2)+Math.cos(this.deg2rad(e))*Math.cos(this.deg2rad(r))*Math.sin(n/2)*Math.sin(n/2);return 6371*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))}deg2rad(e){return e*(Math.PI/180)}validateCoordinates(e,t){return e>=-90&&e<=90&&t>=-180&&t<=180}generateUniqueId(e="id"){return`${e}-${Date.now()}-${Math.floor(Math.random()*1e4)}`}truncateText(e,t=100){return e?e.length>t?`${e.substring(0,t)}...`:e:""}formatDate(e){return e?(typeof e=="object"?e:new Date(e)).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}):""}formatDateTime(e){return e?(typeof e=="object"?e:new Date(e)).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):""}getRandomColor(){return`#${Math.floor(Math.random()*16777215).toString(16).padStart(6,"0")}`}isEmptyObject(e){return e&&Object.keys(e).length===0&&e.constructor===Object}deepCopy(e){return JSON.parse(JSON.stringify(e))}objectToQueryParams(e){return Object.keys(e).filter(t=>e[t]!==void 0&&e[t]!==null).map(t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`).join("&")}pickProperties(e,t){return t.reduce((r,a)=>(a in e&&(r[a]=e[a]),r),{})}formatWithUnit(e,t,r=2){return`${e.toFixed(r)} ${t}`}static \u0275fac=function(t){return new(t||s)};static \u0275prov=y({token:s,factory:s.\u0275fac,providedIn:"root"})};var I=class s{constructor(e,t,r,a){this.http=e;this.loggerService=t;this.cacheService=r;this.utilsService=a}apiUrl=`${b.apiUrl}/elements`;ELEMENTS_CACHE_KEY="network-elements";elementsChangedSubject=new L(!1);elementsChanged$=this.elementsChangedSubject.asObservable();getAllElements(){try{return b.featureFlags.enableMockData?(this.loggerService.info("Usando datos mock para elementos de red"),d(this.getMockElements()).pipe(S(500),g(e=>{this.loggerService.debug("Elementos mock cargados:",e.length),this.cacheService.set(this.ELEMENTS_CACHE_KEY,e,{useLocalStorage:!0}),this.notifyElementsChanged()}))):this.http.get(this.apiUrl).pipe(g(e=>{this.loggerService.debug("Elementos obtenidos:",e?.length),this.cacheService.set(this.ELEMENTS_CACHE_KEY,e,{useLocalStorage:!0})}),E(e=>{this.loggerService.error("Error al obtener elementos:",e);let t=this.cacheService.get(this.ELEMENTS_CACHE_KEY,{useLocalStorage:!0});return t&&t.length>0?(this.loggerService.info("Usando elementos en cach\xE9:",t.length),d(t)):(this.loggerService.info("Sin cach\xE9 disponible, usando elementos mock"),d(this.getMockElements()).pipe(S(500)))}),M(1))}catch(e){return this.loggerService.error("Error inesperado en getAllElements:",e),d(this.getMockElements())}}getElementById(e){let t=`element-${e}`,r=this.cacheService.get(t);return r?d(r):this.http.get(`${this.apiUrl}/${e}`).pipe(g(a=>{this.cacheService.set(t,a,{useLocalStorage:!0})}),E(this.handleError))}createElement(e){if(b.featureFlags.enableMockData||b.useMocks){this.loggerService.info("Usando datos mock para crear elemento");let t=m(p({},e),{id:e.id||this.generateTemporaryId(),createdAt:new Date,updatedAt:new Date}),r=`element-${t.id}`;this.cacheService.set(r,t,{useLocalStorage:!0});let a=this.cacheService.get(this.ELEMENTS_CACHE_KEY,{useLocalStorage:!0})||[];return a.push(t),this.cacheService.set(this.ELEMENTS_CACHE_KEY,a,{useLocalStorage:!0}),this.notifyElementsChanged(),d(t).pipe(S(500))}return this.http.post(this.apiUrl,e).pipe(g(t=>{if(t.id){let r=`element-${t.id}`;this.cacheService.set(r,t,{useLocalStorage:!0}),this.invalidateElementsCache(),this.notifyElementsChanged()}}),E(this.handleError))}updateElement(e,t){return this.http.put(`${this.apiUrl}/${e}`,t).pipe(g(r=>{let a=`element-${e}`;this.cacheService.set(a,r,{useLocalStorage:!0}),this.invalidateElementsCache(),this.notifyElementsChanged()}),E(this.handleError))}deleteElement(e){return this.http.delete(`${this.apiUrl}/${e}`).pipe(g(()=>{let t=`element-${e}`;this.cacheService.remove(t,{useLocalStorage:!0}),this.invalidateElementsCache(),this.notifyElementsChanged()}),E(this.handleError))}getElementTypeName(e){return O[e]||"Desconocido"}getElementStatusClass(e){return P[e]||""}getElementProperty(e,t){return e[t]}isOLT(e){if(e.type!=="OLT")return!1;let t=e;return typeof t.manufacturer=="string"&&typeof t.model=="string"&&typeof t.portCount=="number"&&typeof t.ponPorts=="number"}isONT(e){if(e.type!=="ONT")return!1;let t=e;return typeof t.manufacturer=="string"&&typeof t.model=="string"&&typeof t.serialNumber=="string"}isODF(e){if(e.type!=="ODF")return!1;let t=e;return typeof t.manufacturer=="string"&&typeof t.model=="string"&&typeof t.totalPortCapacity=="number"&&typeof t.usedPorts=="number"}isEDFA(e){return e.type==="EDFA"}isSplitter(e){return e.type!=="SPLITTER"?!1:typeof e.splitRatio=="string"}isManga(e){if(e.type!=="MANGA")return!1;let t=e;return typeof t.capacity=="number"&&typeof t.usedCapacity=="number"}isTerminalBox(e){if(e.type!=="TERMINAL_BOX")return!1;let t=e;return typeof t.portCapacity=="number"&&typeof t.usedPorts=="number"}isFiberThread(e){return e.type!=="FIBER_THREAD"?!1:typeof e.length=="number"}isSlackFiber(e){return e.type==="SLACK_FIBER"}isRack(e){return e.type==="RACK"}formatFileSize(e){return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(2)} KB`:e<1024*1024*1024?`${(e/(1024*1024)).toFixed(2)} MB`:`${(e/(1024*1024*1024)).toFixed(2)} GB`}createDefaultElement(e){let t={id:this.generateTemporaryId(),name:`Nuevo ${this.getElementTypeName(e)}`,type:e,status:"INACTIVE",position:c(0,0),description:"",createdAt:new Date,updatedAt:new Date};switch(e){case"OLT":return m(p({},t),{type:"OLT",manufacturer:"Proveedor Gen\xE9rico",model:"Modelo OLT Gen\xE9rico",portCount:16,ponPorts:4,serialNumber:`OLT-${Date.now().toString(36)}`,ipAddress:"192.168.1.100",macAddress:"00:11:22:33:44:55",firmwareVersion:"1.0.0"});case"ONT":return m(p({},t),{type:"ONT",manufacturer:"Proveedor Gen\xE9rico",model:"Modelo ONT Gen\xE9rico",serialNumber:`ONT-${Date.now().toString(36)}`,ipAddress:"192.168.1.200",macAddress:"00:11:22:33:44:66",installationDate:new Date,clientId:void 0});case"ODF":return m(p({},t),{type:"ODF",manufacturer:"Proveedor Gen\xE9rico",model:"Modelo ODF Gen\xE9rico",totalPortCapacity:48,usedPorts:0,installationDate:new Date});case"SPLITTER":return m(p({},t),{type:"SPLITTER",manufacturer:"Proveedor Gen\xE9rico",model:"Modelo Splitter Gen\xE9rico",splitRatio:"1:8",insertionLoss:10.5,serialNumber:`SPL-${Date.now().toString(36)}`,installationDate:new Date});case"MANGA":return m(p({},t),{type:"MANGA",manufacturer:"Proveedor Gen\xE9rico",model:"Modelo Manga Gen\xE9rico",serialNumber:`MNG-${Date.now().toString(36)}`,closureType:"UNDERGROUND",maxCableEntries:24,maxSpliceCapacity:48,isAerial:!1,ipRating:"IP65",sealingType:"MECHANICAL",hasSplitter:!1,usedSplices:0,usedCableEntries:0,installationDate:new Date});case"TERMINAL_BOX":return m(p({},t),{type:"TERMINAL_BOX",manufacturer:"Proveedor Gen\xE9rico",model:"Modelo Terminal Box Gen\xE9rico",portCapacity:12,usedPorts:0,mountingType:"wall",serialNumber:`TB-${Date.now().toString(36)}`,installationDate:new Date});case"SLACK_FIBER":return m(p({},t),{type:"SLACK_FIBER",length:30,fiberType:void 0});case"FIBER_THREAD":return m(p({},t),{type:"FIBER_THREAD",length:100,color:"Azul",coreNumber:1,cableId:`CBL-${Date.now().toString(36)}`,fiberType:void 0});case"RACK":return m(p({},t),{type:"RACK",manufacturer:"Fabricante Gen\xE9rico",model:"Modelo Rack Gen\xE9rico",serialNumber:`RACK-${Date.now().toString(36)}`,installationDate:new Date,heightUnits:42,width:600,depth:1e3,totalU:42,usedU:0,roomName:"Sala Principal"});default:return t}}generateTemporaryId(){return this.utilsService.generateUniqueId("temp-element")}validateElement(e){if(!e.name||e.name.trim()==="")return"El nombre del elemento es obligatorio";if(!e.type)return"El tipo de elemento es obligatorio";if(!e.position||typeof e.position.lat!="number"||typeof e.position.lng!="number")return"La posici\xF3n del elemento es obligatoria y debe tener coordenadas v\xE1lidas";switch(e.type){case"OLT":if(!("portCount"in e)||e.portCount===void 0)return"El n\xFAmero de puertos es obligatorio para OLT";break;case"ODF":if(!("totalPortCapacity"in e)||e.totalPortCapacity===void 0)return"La capacidad total de puertos es obligatoria para ODF";break;case"SPLITTER":if(!("splitRatio"in e)||!e.splitRatio)return"La relaci\xF3n de divisi\xF3n es obligatoria para Splitter";break;case"SLACK_FIBER":if(!("length"in e)||e.length===void 0)return"La longitud es obligatoria para Flojo de Fibra";break;case"FIBER_THREAD":if(!("length"in e)||e.length===void 0)return"La longitud es obligatoria para Hilo de Fibra";break;case"RACK":if(!("heightUnits"in e)||e.heightUnits===void 0)return"La altura (U) es obligatoria para Rack";if(!("width"in e)||e.width===void 0)return"El ancho es obligatorio para Rack";if(!("depth"in e)||e.depth===void 0)return"La profundidad es obligatoria para Rack";if(!("totalU"in e)||e.totalU===void 0)return"El total de unidades U es obligatorio para Rack";if(!("usedU"in e)||e.usedU===void 0)return"Las unidades U utilizadas son obligatorias para Rack";if(!("roomName"in e)||!e.roomName)return"El nombre de la sala es obligatorio para Rack";break}return!0}notifyElementsChanged(){this.elementsChangedSubject.next(!0)}handleError=e=>{let t="Error desconocido";return e.error instanceof ErrorEvent?t=`Error: ${e.error.message}`:t=`C\xF3digo: ${e.status}, Mensaje: ${e.message}`,this.loggerService.error(t,e),w(()=>new Error(t))};invalidateElementsCache(){this.cacheService.remove(this.ELEMENTS_CACHE_KEY,{useLocalStorage:!0})}clearCache(){this.cacheService.remove(this.ELEMENTS_CACHE_KEY,{useLocalStorage:!0}),this.cacheService.cleanExpired(0),this.notifyElementsChanged()}invalidateCacheEntry(e){let t=`element-${e}`;this.cacheService.remove(t,{useLocalStorage:!0})}getMockElements(){return[{id:"olt-001",name:"OLT Central Norte",type:"OLT",status:"ACTIVE",position:c(18.4821,-69.9312),description:"OLT principal del sector norte"},{id:"odf-001",name:"ODF Zona Norte 1",type:"ODF",status:"ACTIVE",position:c(18.4835,-69.9287),description:"Distribuidor de fibra \xF3ptica para la zona norte"},{id:"splitter-001",name:"Splitter 1:8 Zona Norte",type:"SPLITTER",status:"ACTIVE",position:c(18.4845,-69.9276),description:"Splitter principal para distribuci\xF3n residencial"},{id:"ont-001",name:"ONT Cliente Residencial",type:"ONT",status:"ACTIVE",position:c(18.4842,-69.9265),description:"ONT instalada en cliente residencial"},{id:"edfa-001",name:"Amplificador Troncal",type:"EDFA",status:"ACTIVE",position:c(18.4815,-69.934),description:"Amplificador para enlace de larga distancia"},{id:"manga-001",name:"Manga Av. Principal",type:"MANGA",status:"ACTIVE",position:c(18.4827,-69.9299),description:"Manga para empalmes de fibra en avenida principal"},{id:"slack-001",name:"Flojo de Fibra Principal",type:"SLACK_FIBER",status:"ACTIVE",position:c(18.485,-69.93),description:"Reserva de cable de fibra \xF3ptica",properties:{length:30}},{id:"fiber-001",name:"Hilo de Fibra Azul",type:"FIBER_THREAD",status:"ACTIVE",position:c(18.486,-69.931),description:"Hilo de fibra individual para pruebas",properties:{length:100,color:"Azul"}}]}getElementsByType(e){return this.getAllElements().pipe(N(t=>t.filter(r=>r.type===e)))}searchByTerm(e){return this.getAllElements().pipe(N(t=>{if(!e||e.trim()==="")return t;let r=e.toLowerCase().trim();return t.filter(a=>a.name?.toLowerCase().includes(r)||a.description?.toLowerCase().includes(r)||a.id&&a.id.toLowerCase().includes(r))}))}static \u0275fac=function(t){return new(t||s)(h(k),h(T),h(C),h(v))};static \u0275prov=y({token:s,factory:s.\u0275fac,providedIn:"root"})};export{c as a,_ as b,f as c,v as d,I as e};
