import{b as Ys}from"./chunk-E3NR5YS4.js";import{d as Hs,f as Ws,g as qs,h as Xs}from"./chunk-JGNBERAY.js";import{a as Vs,c as js,d as Us}from"./chunk-Q2I2H6RZ.js";import{a as Os,b as Is,c as Ds,e as As,f as Ns,g as zs,h as Rs}from"./chunk-RMHD7ZOV.js";import{a as Si,e as Ks}from"./chunk-PQUQY4V4.js";import{a as Ci}from"./chunk-SFSNZG2F.js";import{a as pt}from"./chunk-PYE7UGMK.js";import{d as Bs,e as Zs,f as Fs,g as Gs,j as $s}from"./chunk-RWQWO3EM.js";import{a as bn}from"./chunk-ULFK375Q.js";import{A as Ts,B as Ps,a as _s,b as vs,c as ys,d as Qe,g as bs,h as ws,l as xs,m as Ls,o as Es,r as Ms,v as Cs,w as Ss,z as ks}from"./chunk-JO2MD4NL.js";import{a as hs,b as cs,c as ds,f as fs,j as ms,n as ps}from"./chunk-XJSBNB6N.js";import{w as gs}from"./chunk-VH7SA6GK.js";import{H as qr,k as ss,m as ls,x as us}from"./chunk-4PHUDKEH.js";import{$a as bt,$c as as,Aa as jr,Ab as ja,Ba as Fa,Cb as Ua,D as Na,F as Ee,Ga,Gb as J,Hb as q,Ib as Gt,Ja as Ur,K as za,Ka as Ye,M as Ei,Mb as Ha,Mc as rs,Na as pn,Nb as Wa,Nc as os,Ob as Ke,Pb as Wr,Qb as qa,Rb as Xa,Ta as $a,Ub as Ya,Vb as Ka,Wb as Qa,Zb as Ja,_b as mt,ac as Mi,bc as ts,da as Nt,db as gn,f as dt,fa as Xe,g as N,gc as es,ia as Ra,id as yn,ja as ft,ka as Ba,kb as _n,lb as Va,ma as Me,n as At,o as Le,oa as K,pa as Et,qb as Ce,s as $r,vc as is,wb as vn,xb as It,xc as Se,ya as Za,yc as ns,za as Vr,zb as Hr}from"./chunk-FG6FKNI4.js";import{a as I,b as Z,e as Gr,f as Li,g as Aa}from"./chunk-OXVY4BEJ.js";var ki=Gr((Cn,tl)=>{"use strict";(function(n,e){typeof Cn=="object"&&typeof tl<"u"?e(Cn):typeof define=="function"&&define.amd?define(["exports"],e):(n=typeof globalThis<"u"?globalThis:n||self,e(n.leaflet={}))})(Cn,function(n){"use strict";var e="1.9.4";function o(t){var i,a,u,d;for(a=1,u=arguments.length;a<u;a++){d=arguments[a];for(i in d)t[i]=d[i]}return t}var r=Object.create||function(){function t(){}return function(i){return t.prototype=i,new t}}();function s(t,i){var a=Array.prototype.slice;if(t.bind)return t.bind.apply(t,a.call(arguments,1));var u=a.call(arguments,2);return function(){return t.apply(i,u.length?u.concat(a.call(arguments)):arguments)}}var h=0;function c(t){return"_leaflet_id"in t||(t._leaflet_id=++h),t._leaflet_id}function f(t,i,a){var u,d,p,b;return b=function(){u=!1,d&&(p.apply(a,d),d=!1)},p=function(){u?d=arguments:(t.apply(a,arguments),setTimeout(b,i),u=!0)},p}function _(t,i,a){var u=i[1],d=i[0],p=u-d;return t===u&&a?t:((t-d)%p+p)%p+d}function g(){return!1}function l(t,i){if(i===!1)return t;var a=Math.pow(10,i===void 0?6:i);return Math.round(t*a)/a}function m(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function v(t){return m(t).split(/\s+/)}function y(t,i){Object.prototype.hasOwnProperty.call(t,"options")||(t.options=t.options?r(t.options):{});for(var a in i)t.options[a]=i[a];return t.options}function M(t,i,a){var u=[];for(var d in t)u.push(encodeURIComponent(a?d.toUpperCase():d)+"="+encodeURIComponent(t[d]));return(!i||i.indexOf("?")===-1?"?":"&")+u.join("&")}var x=/\{ *([\w_ -]+) *\}/g;function C(t,i){return t.replace(x,function(a,u){var d=i[u];if(d===void 0)throw new Error("No value provided for variable "+a);return typeof d=="function"&&(d=d(i)),d})}var k=Array.isArray||function(t){return Object.prototype.toString.call(t)==="[object Array]"};function P(t,i){for(var a=0;a<t.length;a++)if(t[a]===i)return a;return-1}var A="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function S(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}var R=0;function U(t){var i=+new Date,a=Math.max(0,16-(i-R));return R=i+a,window.setTimeout(t,a)}var X=window.requestAnimationFrame||S("RequestAnimationFrame")||U,rt=window.cancelAnimationFrame||S("CancelAnimationFrame")||S("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)};function Q(t,i,a){if(a&&X===U)t.call(i);else return X.call(window,s(t,i))}function ot(t){t&&rt.call(window,t)}var zt={__proto__:null,extend:o,create:r,bind:s,get lastId(){return h},stamp:c,throttle:f,wrapNum:_,falseFn:g,formatNum:l,trim:m,splitWords:v,setOptions:y,getParamString:M,template:C,isArray:k,indexOf:P,emptyImageUrl:A,requestFn:X,cancelFn:rt,requestAnimFrame:Q,cancelAnimFrame:ot};function Rt(){}Rt.extend=function(t){var i=function(){y(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},a=i.__super__=this.prototype,u=r(a);u.constructor=i,i.prototype=u;for(var d in this)Object.prototype.hasOwnProperty.call(this,d)&&d!=="prototype"&&d!=="__super__"&&(i[d]=this[d]);return t.statics&&o(i,t.statics),t.includes&&(qi(t.includes),o.apply(null,[u].concat(t.includes))),o(u,t),delete u.statics,delete u.includes,u.options&&(u.options=a.options?r(a.options):{},o(u.options,t.options)),u._initHooks=[],u.callInitHooks=function(){if(!this._initHooksCalled){a.callInitHooks&&a.callInitHooks.call(this),this._initHooksCalled=!0;for(var p=0,b=u._initHooks.length;p<b;p++)u._initHooks[p].call(this)}},i},Rt.include=function(t){var i=this.prototype.options;return o(this.prototype,t),t.options&&(this.prototype.options=i,this.mergeOptions(t.options)),this},Rt.mergeOptions=function(t){return o(this.prototype.options,t),this},Rt.addInitHook=function(t){var i=Array.prototype.slice.call(arguments,1),a=typeof t=="function"?t:function(){this[t].apply(this,i)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(a),this};function qi(t){if(!(typeof L>"u"||!L||!L.Mixin)){t=k(t)?t:[t];for(var i=0;i<t.length;i++)t[i]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var _t={on:function(t,i,a){if(typeof t=="object")for(var u in t)this._on(u,t[u],i);else{t=v(t);for(var d=0,p=t.length;d<p;d++)this._on(t[d],i,a)}return this},off:function(t,i,a){if(!arguments.length)delete this._events;else if(typeof t=="object")for(var u in t)this._off(u,t[u],i);else{t=v(t);for(var d=arguments.length===1,p=0,b=t.length;p<b;p++)d?this._off(t[p]):this._off(t[p],i,a)}return this},_on:function(t,i,a,u){if(typeof i!="function"){console.warn("wrong listener type: "+typeof i);return}if(this._listens(t,i,a)===!1){a===this&&(a=void 0);var d={fn:i,ctx:a};u&&(d.once=!0),this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(d)}},_off:function(t,i,a){var u,d,p;if(this._events&&(u=this._events[t],!!u)){if(arguments.length===1){if(this._firingCount)for(d=0,p=u.length;d<p;d++)u[d].fn=g;delete this._events[t];return}if(typeof i!="function"){console.warn("wrong listener type: "+typeof i);return}var b=this._listens(t,i,a);if(b!==!1){var w=u[b];this._firingCount&&(w.fn=g,this._events[t]=u=u.slice()),u.splice(b,1)}}},fire:function(t,i,a){if(!this.listens(t,a))return this;var u=o({},i,{type:t,target:this,sourceTarget:i&&i.sourceTarget||this});if(this._events){var d=this._events[t];if(d){this._firingCount=this._firingCount+1||1;for(var p=0,b=d.length;p<b;p++){var w=d[p],E=w.fn;w.once&&this.off(t,E,w.ctx),E.call(w.ctx||this,u)}this._firingCount--}}return a&&this._propagateEvent(u),this},listens:function(t,i,a,u){typeof t!="string"&&console.warn('"string" type argument expected');var d=i;typeof i!="function"&&(u=!!i,d=void 0,a=void 0);var p=this._events&&this._events[t];if(p&&p.length&&this._listens(t,d,a)!==!1)return!0;if(u){for(var b in this._eventParents)if(this._eventParents[b].listens(t,i,a,u))return!0}return!1},_listens:function(t,i,a){if(!this._events)return!1;var u=this._events[t]||[];if(!i)return!!u.length;a===this&&(a=void 0);for(var d=0,p=u.length;d<p;d++)if(u[d].fn===i&&u[d].ctx===a)return d;return!1},once:function(t,i,a){if(typeof t=="object")for(var u in t)this._on(u,t[u],i,!0);else{t=v(t);for(var d=0,p=t.length;d<p;d++)this._on(t[d],i,a,!0)}return this},addEventParent:function(t){return this._eventParents=this._eventParents||{},this._eventParents[c(t)]=t,this},removeEventParent:function(t){return this._eventParents&&delete this._eventParents[c(t)],this},_propagateEvent:function(t){for(var i in this._eventParents)this._eventParents[i].fire(t.type,o({layer:t.target,propagatedFrom:t.target},t),!0)}};_t.addEventListener=_t.on,_t.removeEventListener=_t.clearAllEventListeners=_t.off,_t.addOneTimeEventListener=_t.once,_t.fireEvent=_t.fire,_t.hasEventListeners=_t.listens;var _e=Rt.extend(_t);function F(t,i,a){this.x=a?Math.round(t):t,this.y=a?Math.round(i):i}var li=Math.trunc||function(t){return t>0?Math.floor(t):Math.ceil(t)};F.prototype={clone:function(){return new F(this.x,this.y)},add:function(t){return this.clone()._add(G(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(G(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},scaleBy:function(t){return new F(this.x*t.x,this.y*t.y)},unscaleBy:function(t){return new F(this.x/t.x,this.y/t.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=li(this.x),this.y=li(this.y),this},distanceTo:function(t){t=G(t);var i=t.x-this.x,a=t.y-this.y;return Math.sqrt(i*i+a*a)},equals:function(t){return t=G(t),t.x===this.x&&t.y===this.y},contains:function(t){return t=G(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+l(this.x)+", "+l(this.y)+")"}};function G(t,i,a){return t instanceof F?t:k(t)?new F(t[0],t[1]):t==null?t:typeof t=="object"&&"x"in t&&"y"in t?new F(t.x,t.y):new F(t,i,a)}function it(t,i){if(t)for(var a=i?[t,i]:t,u=0,d=a.length;u<d;u++)this.extend(a[u])}it.prototype={extend:function(t){var i,a;if(!t)return this;if(t instanceof F||typeof t[0]=="number"||"x"in t)i=a=G(t);else if(t=vt(t),i=t.min,a=t.max,!i||!a)return this;return!this.min&&!this.max?(this.min=i.clone(),this.max=a.clone()):(this.min.x=Math.min(i.x,this.min.x),this.max.x=Math.max(a.x,this.max.x),this.min.y=Math.min(i.y,this.min.y),this.max.y=Math.max(a.y,this.max.y)),this},getCenter:function(t){return G((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return G(this.min.x,this.max.y)},getTopRight:function(){return G(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var i,a;return typeof t[0]=="number"||t instanceof F?t=G(t):t=vt(t),t instanceof it?(i=t.min,a=t.max):i=a=t,i.x>=this.min.x&&a.x<=this.max.x&&i.y>=this.min.y&&a.y<=this.max.y},intersects:function(t){t=vt(t);var i=this.min,a=this.max,u=t.min,d=t.max,p=d.x>=i.x&&u.x<=a.x,b=d.y>=i.y&&u.y<=a.y;return p&&b},overlaps:function(t){t=vt(t);var i=this.min,a=this.max,u=t.min,d=t.max,p=d.x>i.x&&u.x<a.x,b=d.y>i.y&&u.y<a.y;return p&&b},isValid:function(){return!!(this.min&&this.max)},pad:function(t){var i=this.min,a=this.max,u=Math.abs(i.x-a.x)*t,d=Math.abs(i.y-a.y)*t;return vt(G(i.x-u,i.y-d),G(a.x+u,a.y+d))},equals:function(t){return t?(t=vt(t),this.min.equals(t.getTopLeft())&&this.max.equals(t.getBottomRight())):!1}};function vt(t,i){return!t||t instanceof it?t:new it(t,i)}function Pt(t,i){if(t)for(var a=i?[t,i]:t,u=0,d=a.length;u<d;u++)this.extend(a[u])}Pt.prototype={extend:function(t){var i=this._southWest,a=this._northEast,u,d;if(t instanceof tt)u=t,d=t;else if(t instanceof Pt){if(u=t._southWest,d=t._northEast,!u||!d)return this}else return t?this.extend(H(t)||ut(t)):this;return!i&&!a?(this._southWest=new tt(u.lat,u.lng),this._northEast=new tt(d.lat,d.lng)):(i.lat=Math.min(u.lat,i.lat),i.lng=Math.min(u.lng,i.lng),a.lat=Math.max(d.lat,a.lat),a.lng=Math.max(d.lng,a.lng)),this},pad:function(t){var i=this._southWest,a=this._northEast,u=Math.abs(i.lat-a.lat)*t,d=Math.abs(i.lng-a.lng)*t;return new Pt(new tt(i.lat-u,i.lng-d),new tt(a.lat+u,a.lng+d))},getCenter:function(){return new tt((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new tt(this.getNorth(),this.getWest())},getSouthEast:function(){return new tt(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){typeof t[0]=="number"||t instanceof tt||"lat"in t?t=H(t):t=ut(t);var i=this._southWest,a=this._northEast,u,d;return t instanceof Pt?(u=t.getSouthWest(),d=t.getNorthEast()):u=d=t,u.lat>=i.lat&&d.lat<=a.lat&&u.lng>=i.lng&&d.lng<=a.lng},intersects:function(t){t=ut(t);var i=this._southWest,a=this._northEast,u=t.getSouthWest(),d=t.getNorthEast(),p=d.lat>=i.lat&&u.lat<=a.lat,b=d.lng>=i.lng&&u.lng<=a.lng;return p&&b},overlaps:function(t){t=ut(t);var i=this._southWest,a=this._northEast,u=t.getSouthWest(),d=t.getNorthEast(),p=d.lat>i.lat&&u.lat<a.lat,b=d.lng>i.lng&&u.lng<a.lng;return p&&b},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t,i){return t?(t=ut(t),this._southWest.equals(t.getSouthWest(),i)&&this._northEast.equals(t.getNorthEast(),i)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function ut(t,i){return t instanceof Pt?t:new Pt(t,i)}function tt(t,i,a){if(isNaN(t)||isNaN(i))throw new Error("Invalid LatLng object: ("+t+", "+i+")");this.lat=+t,this.lng=+i,a!==void 0&&(this.alt=+a)}tt.prototype={equals:function(t,i){if(!t)return!1;t=H(t);var a=Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng));return a<=(i===void 0?1e-9:i)},toString:function(t){return"LatLng("+l(this.lat,t)+", "+l(this.lng,t)+")"},distanceTo:function(t){return le.distance(this,H(t))},wrap:function(){return le.wrapLatLng(this)},toBounds:function(t){var i=180*t/40075017,a=i/Math.cos(Math.PI/180*this.lat);return ut([this.lat-i,this.lng-a],[this.lat+i,this.lng+a])},clone:function(){return new tt(this.lat,this.lng,this.alt)}};function H(t,i,a){return t instanceof tt?t:k(t)&&typeof t[0]!="object"?t.length===3?new tt(t[0],t[1],t[2]):t.length===2?new tt(t[0],t[1]):null:t==null?t:typeof t=="object"&&"lat"in t?new tt(t.lat,"lng"in t?t.lng:t.lon,t.alt):i===void 0?null:new tt(t,i,a)}var te={latLngToPoint:function(t,i){var a=this.projection.project(t),u=this.scale(i);return this.transformation._transform(a,u)},pointToLatLng:function(t,i){var a=this.scale(i),u=this.transformation.untransform(t,a);return this.projection.unproject(u)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},scale:function(t){return 256*Math.pow(2,t)},zoom:function(t){return Math.log(t/256)/Math.LN2},getProjectedBounds:function(t){if(this.infinite)return null;var i=this.projection.bounds,a=this.scale(t),u=this.transformation.transform(i.min,a),d=this.transformation.transform(i.max,a);return new it(u,d)},infinite:!1,wrapLatLng:function(t){var i=this.wrapLng?_(t.lng,this.wrapLng,!0):t.lng,a=this.wrapLat?_(t.lat,this.wrapLat,!0):t.lat,u=t.alt;return new tt(a,i,u)},wrapLatLngBounds:function(t){var i=t.getCenter(),a=this.wrapLatLng(i),u=i.lat-a.lat,d=i.lng-a.lng;if(u===0&&d===0)return t;var p=t.getSouthWest(),b=t.getNorthEast(),w=new tt(p.lat-u,p.lng-d),E=new tt(b.lat-u,b.lng-d);return new Pt(w,E)}},le=o({},te,{wrapLng:[-180,180],R:6371e3,distance:function(t,i){var a=Math.PI/180,u=t.lat*a,d=i.lat*a,p=Math.sin((i.lat-t.lat)*a/2),b=Math.sin((i.lng-t.lng)*a/2),w=p*p+Math.cos(u)*Math.cos(d)*b*b,E=2*Math.atan2(Math.sqrt(w),Math.sqrt(1-w));return this.R*E}}),Eo=6378137,sr={R:Eo,MAX_LATITUDE:85.0511287798,project:function(t){var i=Math.PI/180,a=this.MAX_LATITUDE,u=Math.max(Math.min(a,t.lat),-a),d=Math.sin(u*i);return new F(this.R*t.lng*i,this.R*Math.log((1+d)/(1-d))/2)},unproject:function(t){var i=180/Math.PI;return new tt((2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*i,t.x*i/this.R)},bounds:function(){var t=Eo*Math.PI;return new it([-t,-t],[t,t])}()};function lr(t,i,a,u){if(k(t)){this._a=t[0],this._b=t[1],this._c=t[2],this._d=t[3];return}this._a=t,this._b=i,this._c=a,this._d=u}lr.prototype={transform:function(t,i){return this._transform(t.clone(),i)},_transform:function(t,i){return i=i||1,t.x=i*(this._a*t.x+this._b),t.y=i*(this._c*t.y+this._d),t},untransform:function(t,i){return i=i||1,new F((t.x/i-this._b)/this._a,(t.y/i-this._d)/this._c)}};function ui(t,i,a,u){return new lr(t,i,a,u)}var ur=o({},le,{code:"EPSG:3857",projection:sr,transformation:function(){var t=.5/(Math.PI*sr.R);return ui(t,.5,-t,.5)}()}),Ch=o({},ur,{code:"EPSG:900913"});function Mo(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function Co(t,i){var a="",u,d,p,b,w,E;for(u=0,p=t.length;u<p;u++){for(w=t[u],d=0,b=w.length;d<b;d++)E=w[d],a+=(d?"L":"M")+E.x+" "+E.y;a+=i?D.svg?"z":"x":""}return a||"M0 0"}var hr=document.documentElement.style,Xi="ActiveXObject"in window,Sh=Xi&&!document.addEventListener,So="msLaunchUri"in navigator&&!("documentMode"in document),cr=Xt("webkit"),ko=Xt("android"),To=Xt("android 2")||Xt("android 3"),kh=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Th=ko&&Xt("Google")&&kh<537&&!("AudioNode"in window),dr=!!window.opera,Po=!So&&Xt("chrome"),Oo=Xt("gecko")&&!cr&&!dr&&!Xi,Ph=!Po&&Xt("safari"),Io=Xt("phantom"),Do="OTransition"in hr,Oh=navigator.platform.indexOf("Win")===0,Ao=Xi&&"transition"in hr,fr="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!To,No="MozPerspective"in hr,Ih=!window.L_DISABLE_3D&&(Ao||fr||No)&&!Do&&!Io,hi=typeof orientation<"u"||Xt("mobile"),Dh=hi&&cr,Ah=hi&&fr,zo=!window.PointerEvent&&window.MSPointerEvent,Ro=!!(window.PointerEvent||zo),Bo="ontouchstart"in window||!!window.TouchEvent,Nh=!window.L_NO_TOUCH&&(Bo||Ro),zh=hi&&dr,Rh=hi&&Oo,Bh=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Zh=function(){var t=!1;try{var i=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("testPassiveEventSupport",g,i),window.removeEventListener("testPassiveEventSupport",g,i)}catch{}return t}(),Fh=function(){return!!document.createElement("canvas").getContext}(),mr=!!(document.createElementNS&&Mo("svg").createSVGRect),Gh=!!mr&&function(){var t=document.createElement("div");return t.innerHTML="<svg/>",(t.firstChild&&t.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),$h=!mr&&function(){try{var t=document.createElement("div");t.innerHTML='<v:shape adj="1"/>';var i=t.firstChild;return i.style.behavior="url(#default#VML)",i&&typeof i.adj=="object"}catch{return!1}}(),Vh=navigator.platform.indexOf("Mac")===0,jh=navigator.platform.indexOf("Linux")===0;function Xt(t){return navigator.userAgent.toLowerCase().indexOf(t)>=0}var D={ie:Xi,ielt9:Sh,edge:So,webkit:cr,android:ko,android23:To,androidStock:Th,opera:dr,chrome:Po,gecko:Oo,safari:Ph,phantom:Io,opera12:Do,win:Oh,ie3d:Ao,webkit3d:fr,gecko3d:No,any3d:Ih,mobile:hi,mobileWebkit:Dh,mobileWebkit3d:Ah,msPointer:zo,pointer:Ro,touch:Nh,touchNative:Bo,mobileOpera:zh,mobileGecko:Rh,retina:Bh,passiveEvents:Zh,canvas:Fh,svg:mr,vml:$h,inlineSvg:Gh,mac:Vh,linux:jh},Zo=D.msPointer?"MSPointerDown":"pointerdown",Fo=D.msPointer?"MSPointerMove":"pointermove",Go=D.msPointer?"MSPointerUp":"pointerup",$o=D.msPointer?"MSPointerCancel":"pointercancel",pr={touchstart:Zo,touchmove:Fo,touchend:Go,touchcancel:$o},Vo={touchstart:Yh,touchmove:Yi,touchend:Yi,touchcancel:Yi},Fe={},jo=!1;function Uh(t,i,a){return i==="touchstart"&&Xh(),Vo[i]?(a=Vo[i].bind(this,a),t.addEventListener(pr[i],a,!1),a):(console.warn("wrong event specified:",i),g)}function Hh(t,i,a){if(!pr[i]){console.warn("wrong event specified:",i);return}t.removeEventListener(pr[i],a,!1)}function Wh(t){Fe[t.pointerId]=t}function qh(t){Fe[t.pointerId]&&(Fe[t.pointerId]=t)}function Uo(t){delete Fe[t.pointerId]}function Xh(){jo||(document.addEventListener(Zo,Wh,!0),document.addEventListener(Fo,qh,!0),document.addEventListener(Go,Uo,!0),document.addEventListener($o,Uo,!0),jo=!0)}function Yi(t,i){if(i.pointerType!==(i.MSPOINTER_TYPE_MOUSE||"mouse")){i.touches=[];for(var a in Fe)i.touches.push(Fe[a]);i.changedTouches=[i],t(i)}}function Yh(t,i){i.MSPOINTER_TYPE_TOUCH&&i.pointerType===i.MSPOINTER_TYPE_TOUCH&&Lt(i),Yi(t,i)}function Kh(t){var i={},a,u;for(u in t)a=t[u],i[u]=a&&a.bind?a.bind(t):a;return t=i,i.type="dblclick",i.detail=2,i.isTrusted=!1,i._simulated=!0,i}var Qh=200;function Jh(t,i){t.addEventListener("dblclick",i);var a=0,u;function d(p){if(p.detail!==1){u=p.detail;return}if(!(p.pointerType==="mouse"||p.sourceCapabilities&&!p.sourceCapabilities.firesTouchEvents)){var b=Yo(p);if(!(b.some(function(E){return E instanceof HTMLLabelElement&&E.attributes.for})&&!b.some(function(E){return E instanceof HTMLInputElement||E instanceof HTMLSelectElement}))){var w=Date.now();w-a<=Qh?(u++,u===2&&i(Kh(p))):u=1,a=w}}}return t.addEventListener("click",d),{dblclick:i,simDblclick:d}}function tc(t,i){t.removeEventListener("dblclick",i.dblclick),t.removeEventListener("click",i.simDblclick)}var gr=Ji(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),ci=Ji(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Ho=ci==="webkitTransition"||ci==="OTransition"?ci+"End":"transitionend";function Wo(t){return typeof t=="string"?document.getElementById(t):t}function di(t,i){var a=t.style[i]||t.currentStyle&&t.currentStyle[i];if((!a||a==="auto")&&document.defaultView){var u=document.defaultView.getComputedStyle(t,null);a=u?u[i]:null}return a==="auto"?null:a}function Y(t,i,a){var u=document.createElement(t);return u.className=i||"",a&&a.appendChild(u),u}function at(t){var i=t.parentNode;i&&i.removeChild(t)}function Ki(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function Ge(t){var i=t.parentNode;i&&i.lastChild!==t&&i.appendChild(t)}function $e(t){var i=t.parentNode;i&&i.firstChild!==t&&i.insertBefore(t,i.firstChild)}function _r(t,i){if(t.classList!==void 0)return t.classList.contains(i);var a=Qi(t);return a.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(a)}function V(t,i){if(t.classList!==void 0)for(var a=v(i),u=0,d=a.length;u<d;u++)t.classList.add(a[u]);else if(!_r(t,i)){var p=Qi(t);vr(t,(p?p+" ":"")+i)}}function lt(t,i){t.classList!==void 0?t.classList.remove(i):vr(t,m((" "+Qi(t)+" ").replace(" "+i+" "," ")))}function vr(t,i){t.className.baseVal===void 0?t.className=i:t.className.baseVal=i}function Qi(t){return t.correspondingElement&&(t=t.correspondingElement),t.className.baseVal===void 0?t.className:t.className.baseVal}function Bt(t,i){"opacity"in t.style?t.style.opacity=i:"filter"in t.style&&ec(t,i)}function ec(t,i){var a=!1,u="DXImageTransform.Microsoft.Alpha";try{a=t.filters.item(u)}catch{if(i===1)return}i=Math.round(i*100),a?(a.Enabled=i!==100,a.Opacity=i):t.style.filter+=" progid:"+u+"(opacity="+i+")"}function Ji(t){for(var i=document.documentElement.style,a=0;a<t.length;a++)if(t[a]in i)return t[a];return!1}function ve(t,i,a){var u=i||new F(0,0);t.style[gr]=(D.ie3d?"translate("+u.x+"px,"+u.y+"px)":"translate3d("+u.x+"px,"+u.y+"px,0)")+(a?" scale("+a+")":"")}function ht(t,i){t._leaflet_pos=i,D.any3d?ve(t,i):(t.style.left=i.x+"px",t.style.top=i.y+"px")}function ye(t){return t._leaflet_pos||new F(0,0)}var fi,mi,yr;if("onselectstart"in document)fi=function(){$(window,"selectstart",Lt)},mi=function(){nt(window,"selectstart",Lt)};else{var pi=Ji(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);fi=function(){if(pi){var t=document.documentElement.style;yr=t[pi],t[pi]="none"}},mi=function(){pi&&(document.documentElement.style[pi]=yr,yr=void 0)}}function br(){$(window,"dragstart",Lt)}function wr(){nt(window,"dragstart",Lt)}var tn,xr;function Lr(t){for(;t.tabIndex===-1;)t=t.parentNode;t.style&&(en(),tn=t,xr=t.style.outlineStyle,t.style.outlineStyle="none",$(window,"keydown",en))}function en(){tn&&(tn.style.outlineStyle=xr,tn=void 0,xr=void 0,nt(window,"keydown",en))}function qo(t){do t=t.parentNode;while((!t.offsetWidth||!t.offsetHeight)&&t!==document.body);return t}function Er(t){var i=t.getBoundingClientRect();return{x:i.width/t.offsetWidth||1,y:i.height/t.offsetHeight||1,boundingClientRect:i}}var ic={__proto__:null,TRANSFORM:gr,TRANSITION:ci,TRANSITION_END:Ho,get:Wo,getStyle:di,create:Y,remove:at,empty:Ki,toFront:Ge,toBack:$e,hasClass:_r,addClass:V,removeClass:lt,setClass:vr,getClass:Qi,setOpacity:Bt,testProp:Ji,setTransform:ve,setPosition:ht,getPosition:ye,get disableTextSelection(){return fi},get enableTextSelection(){return mi},disableImageDrag:br,enableImageDrag:wr,preventOutline:Lr,restoreOutline:en,getSizedParentNode:qo,getScale:Er};function $(t,i,a,u){if(i&&typeof i=="object")for(var d in i)Cr(t,d,i[d],a);else{i=v(i);for(var p=0,b=i.length;p<b;p++)Cr(t,i[p],a,u)}return this}var Yt="_leaflet_events";function nt(t,i,a,u){if(arguments.length===1)Xo(t),delete t[Yt];else if(i&&typeof i=="object")for(var d in i)Sr(t,d,i[d],a);else if(i=v(i),arguments.length===2)Xo(t,function(w){return P(i,w)!==-1});else for(var p=0,b=i.length;p<b;p++)Sr(t,i[p],a,u);return this}function Xo(t,i){for(var a in t[Yt]){var u=a.split(/\d/)[0];(!i||i(u))&&Sr(t,u,null,null,a)}}var Mr={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Cr(t,i,a,u){var d=i+c(a)+(u?"_"+c(u):"");if(t[Yt]&&t[Yt][d])return this;var p=function(w){return a.call(u||t,w||window.event)},b=p;!D.touchNative&&D.pointer&&i.indexOf("touch")===0?p=Uh(t,i,p):D.touch&&i==="dblclick"?p=Jh(t,p):"addEventListener"in t?i==="touchstart"||i==="touchmove"||i==="wheel"||i==="mousewheel"?t.addEventListener(Mr[i]||i,p,D.passiveEvents?{passive:!1}:!1):i==="mouseenter"||i==="mouseleave"?(p=function(w){w=w||window.event,Tr(t,w)&&b(w)},t.addEventListener(Mr[i],p,!1)):t.addEventListener(i,b,!1):t.attachEvent("on"+i,p),t[Yt]=t[Yt]||{},t[Yt][d]=p}function Sr(t,i,a,u,d){d=d||i+c(a)+(u?"_"+c(u):"");var p=t[Yt]&&t[Yt][d];if(!p)return this;!D.touchNative&&D.pointer&&i.indexOf("touch")===0?Hh(t,i,p):D.touch&&i==="dblclick"?tc(t,p):"removeEventListener"in t?t.removeEventListener(Mr[i]||i,p,!1):t.detachEvent("on"+i,p),t[Yt][d]=null}function be(t){return t.stopPropagation?t.stopPropagation():t.originalEvent?t.originalEvent._stopped=!0:t.cancelBubble=!0,this}function kr(t){return Cr(t,"wheel",be),this}function gi(t){return $(t,"mousedown touchstart dblclick contextmenu",be),t._leaflet_disable_click=!0,this}function Lt(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function we(t){return Lt(t),be(t),this}function Yo(t){if(t.composedPath)return t.composedPath();for(var i=[],a=t.target;a;)i.push(a),a=a.parentNode;return i}function Ko(t,i){if(!i)return new F(t.clientX,t.clientY);var a=Er(i),u=a.boundingClientRect;return new F((t.clientX-u.left)/a.x-i.clientLeft,(t.clientY-u.top)/a.y-i.clientTop)}var nc=D.linux&&D.chrome?window.devicePixelRatio:D.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Qo(t){return D.edge?t.wheelDeltaY/2:t.deltaY&&t.deltaMode===0?-t.deltaY/nc:t.deltaY&&t.deltaMode===1?-t.deltaY*20:t.deltaY&&t.deltaMode===2?-t.deltaY*60:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?-t.detail*20:t.detail?t.detail/-32765*60:0}function Tr(t,i){var a=i.relatedTarget;if(!a)return!0;try{for(;a&&a!==t;)a=a.parentNode}catch{return!1}return a!==t}var rc={__proto__:null,on:$,off:nt,stopPropagation:be,disableScrollPropagation:kr,disableClickPropagation:gi,preventDefault:Lt,stop:we,getPropagationPath:Yo,getMousePosition:Ko,getWheelDelta:Qo,isExternalTarget:Tr,addListener:$,removeListener:nt},Jo=_e.extend({run:function(t,i,a,u){this.stop(),this._el=t,this._inProgress=!0,this._duration=a||.25,this._easeOutPower=1/Math.max(u||.5,.2),this._startPos=ye(t),this._offset=i.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=Q(this._animate,this),this._step()},_step:function(t){var i=+new Date-this._startTime,a=this._duration*1e3;i<a?this._runFrame(this._easeOut(i/a),t):(this._runFrame(1),this._complete())},_runFrame:function(t,i){var a=this._startPos.add(this._offset.multiplyBy(t));i&&a._round(),ht(this._el,a),this.fire("step")},_complete:function(){ot(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),W=_e.extend({options:{crs:ur,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(t,i){i=y(this,i),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(t),this._initLayout(),this._onResize=s(this._onResize,this),this._initEvents(),i.maxBounds&&this.setMaxBounds(i.maxBounds),i.zoom!==void 0&&(this._zoom=this._limitZoom(i.zoom)),i.center&&i.zoom!==void 0&&this.setView(H(i.center),i.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=ci&&D.any3d&&!D.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),$(this._proxy,Ho,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(t,i,a){if(i=i===void 0?this._zoom:this._limitZoom(i),t=this._limitCenter(H(t),i,this.options.maxBounds),a=a||{},this._stop(),this._loaded&&!a.reset&&a!==!0){a.animate!==void 0&&(a.zoom=o({animate:a.animate},a.zoom),a.pan=o({animate:a.animate,duration:a.duration},a.pan));var u=this._zoom!==i?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,i,a.zoom):this._tryAnimatedPan(t,a.pan);if(u)return clearTimeout(this._sizeTimer),this}return this._resetView(t,i,a.pan&&a.pan.noMoveStart),this},setZoom:function(t,i){return this._loaded?this.setView(this.getCenter(),t,{zoom:i}):(this._zoom=t,this)},zoomIn:function(t,i){return t=t||(D.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+t,i)},zoomOut:function(t,i){return t=t||(D.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-t,i)},setZoomAround:function(t,i,a){var u=this.getZoomScale(i),d=this.getSize().divideBy(2),p=t instanceof F?t:this.latLngToContainerPoint(t),b=p.subtract(d).multiplyBy(1-1/u),w=this.containerPointToLatLng(d.add(b));return this.setView(w,i,{zoom:a})},_getBoundsCenterZoom:function(t,i){i=i||{},t=t.getBounds?t.getBounds():ut(t);var a=G(i.paddingTopLeft||i.padding||[0,0]),u=G(i.paddingBottomRight||i.padding||[0,0]),d=this.getBoundsZoom(t,!1,a.add(u));if(d=typeof i.maxZoom=="number"?Math.min(i.maxZoom,d):d,d===1/0)return{center:t.getCenter(),zoom:d};var p=u.subtract(a).divideBy(2),b=this.project(t.getSouthWest(),d),w=this.project(t.getNorthEast(),d),E=this.unproject(b.add(w).divideBy(2).add(p),d);return{center:E,zoom:d}},fitBounds:function(t,i){if(t=ut(t),!t.isValid())throw new Error("Bounds are not valid.");var a=this._getBoundsCenterZoom(t,i);return this.setView(a.center,a.zoom,i)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,i){return this.setView(t,this._zoom,{pan:i})},panBy:function(t,i){if(t=G(t).round(),i=i||{},!t.x&&!t.y)return this.fire("moveend");if(i.animate!==!0&&!this.getSize().contains(t))return this._resetView(this.unproject(this.project(this.getCenter()).add(t)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Jo,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),i.noMoveStart||this.fire("movestart"),i.animate!==!1){V(this._mapPane,"leaflet-pan-anim");var a=this._getMapPanePos().subtract(t).round();this._panAnim.run(this._mapPane,a,i.duration||.25,i.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},flyTo:function(t,i,a){if(a=a||{},a.animate===!1||!D.any3d)return this.setView(t,i,a);this._stop();var u=this.project(this.getCenter()),d=this.project(t),p=this.getSize(),b=this._zoom;t=H(t),i=i===void 0?b:i;var w=Math.max(p.x,p.y),E=w*this.getZoomScale(b,i),T=d.distanceTo(u)||1,O=1.42,B=O*O;function j(ct){var mn=ct?-1:1,Hc=ct?E:w,Wc=E*E-w*w+mn*B*B*T*T,qc=2*Hc*B*T,Fr=Wc/qc,Da=Math.sqrt(Fr*Fr+1)-Fr,Xc=Da<1e-9?-18:Math.log(Da);return Xc}function St(ct){return(Math.exp(ct)-Math.exp(-ct))/2}function yt(ct){return(Math.exp(ct)+Math.exp(-ct))/2}function Ft(ct){return St(ct)/yt(ct)}var Ot=j(0);function qe(ct){return w*(yt(Ot)/yt(Ot+O*ct))}function $c(ct){return w*(yt(Ot)*Ft(Ot+O*ct)-St(Ot))/B}function Vc(ct){return 1-Math.pow(1-ct,1.5)}var jc=Date.now(),Oa=(j(1)-Ot)/O,Uc=a.duration?1e3*a.duration:1e3*Oa*.8;function Ia(){var ct=(Date.now()-jc)/Uc,mn=Vc(ct)*Oa;ct<=1?(this._flyToFrame=Q(Ia,this),this._move(this.unproject(u.add(d.subtract(u).multiplyBy($c(mn)/T)),b),this.getScaleZoom(w/qe(mn),b),{flyTo:!0})):this._move(t,i)._moveEnd(!0)}return this._moveStart(!0,a.noMoveStart),Ia.call(this),this},flyToBounds:function(t,i){var a=this._getBoundsCenterZoom(t,i);return this.flyTo(a.center,a.zoom,i)},setMaxBounds:function(t){return t=ut(t),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),t.isValid()?(this.options.maxBounds=t,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(t){var i=this.options.minZoom;return this.options.minZoom=t,this._loaded&&i!==t&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(t):this},setMaxZoom:function(t){var i=this.options.maxZoom;return this.options.maxZoom=t,this._loaded&&i!==t&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(t):this},panInsideBounds:function(t,i){this._enforcingBounds=!0;var a=this.getCenter(),u=this._limitCenter(a,this._zoom,ut(t));return a.equals(u)||this.panTo(u,i),this._enforcingBounds=!1,this},panInside:function(t,i){i=i||{};var a=G(i.paddingTopLeft||i.padding||[0,0]),u=G(i.paddingBottomRight||i.padding||[0,0]),d=this.project(this.getCenter()),p=this.project(t),b=this.getPixelBounds(),w=vt([b.min.add(a),b.max.subtract(u)]),E=w.getSize();if(!w.contains(p)){this._enforcingBounds=!0;var T=p.subtract(w.getCenter()),O=w.extend(p).getSize().subtract(E);d.x+=T.x<0?-O.x:O.x,d.y+=T.y<0?-O.y:O.y,this.panTo(this.unproject(d),i),this._enforcingBounds=!1}return this},invalidateSize:function(t){if(!this._loaded)return this;t=o({animate:!1,pan:!0},t===!0?{animate:!0}:t);var i=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var a=this.getSize(),u=i.divideBy(2).round(),d=a.divideBy(2).round(),p=u.subtract(d);return!p.x&&!p.y?this:(t.animate&&t.pan?this.panBy(p):(t.pan&&this._rawPanBy(p),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(s(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:i,newSize:a}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(t){if(t=this._locateOptions=o({timeout:1e4,watch:!1},t),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var i=s(this._handleGeolocationResponse,this),a=s(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(i,a,t):navigator.geolocation.getCurrentPosition(i,a,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){if(this._container._leaflet_id){var i=t.code,a=t.message||(i===1?"permission denied":i===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:i,message:"Geolocation error: "+a+"."})}},_handleGeolocationResponse:function(t){if(this._container._leaflet_id){var i=t.coords.latitude,a=t.coords.longitude,u=new tt(i,a),d=u.toBounds(t.coords.accuracy*2),p=this._locateOptions;if(p.setView){var b=this.getBoundsZoom(d);this.setView(u,p.maxZoom?Math.min(b,p.maxZoom):b)}var w={latlng:u,bounds:d,timestamp:t.timestamp};for(var E in t.coords)typeof t.coords[E]=="number"&&(w[E]=t.coords[E]);this.fire("locationfound",w)}},addHandler:function(t,i){if(!i)return this;var a=this[t]=new i(this);return this._handlers.push(a),this.options[t]&&a.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),at(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(ot(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var t;for(t in this._layers)this._layers[t].remove();for(t in this._panes)at(this._panes[t]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(t,i){var a="leaflet-pane"+(t?" leaflet-"+t.replace("Pane","")+"-pane":""),u=Y("div",a,i||this._mapPane);return t&&(this._panes[t]=u),u},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds(),i=this.unproject(t.getBottomLeft()),a=this.unproject(t.getTopRight());return new Pt(i,a)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,i,a){t=ut(t),a=G(a||[0,0]);var u=this.getZoom()||0,d=this.getMinZoom(),p=this.getMaxZoom(),b=t.getNorthWest(),w=t.getSouthEast(),E=this.getSize().subtract(a),T=vt(this.project(w,u),this.project(b,u)).getSize(),O=D.any3d?this.options.zoomSnap:1,B=E.x/T.x,j=E.y/T.y,St=i?Math.max(B,j):Math.min(B,j);return u=this.getScaleZoom(St,u),O&&(u=Math.round(u/(O/100))*(O/100),u=i?Math.ceil(u/O)*O:Math.floor(u/O)*O),Math.max(d,Math.min(p,u))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new F(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(t,i){var a=this._getTopLeftPoint(t,i);return new it(a,a.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(t){return this.options.crs.getProjectedBounds(t===void 0?this.getZoom():t)},getPane:function(t){return typeof t=="string"?this._panes[t]:t},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t,i){var a=this.options.crs;return i=i===void 0?this._zoom:i,a.scale(t)/a.scale(i)},getScaleZoom:function(t,i){var a=this.options.crs;i=i===void 0?this._zoom:i;var u=a.zoom(t*a.scale(i));return isNaN(u)?1/0:u},project:function(t,i){return i=i===void 0?this._zoom:i,this.options.crs.latLngToPoint(H(t),i)},unproject:function(t,i){return i=i===void 0?this._zoom:i,this.options.crs.pointToLatLng(G(t),i)},layerPointToLatLng:function(t){var i=G(t).add(this.getPixelOrigin());return this.unproject(i)},latLngToLayerPoint:function(t){var i=this.project(H(t))._round();return i._subtract(this.getPixelOrigin())},wrapLatLng:function(t){return this.options.crs.wrapLatLng(H(t))},wrapLatLngBounds:function(t){return this.options.crs.wrapLatLngBounds(ut(t))},distance:function(t,i){return this.options.crs.distance(H(t),H(i))},containerPointToLayerPoint:function(t){return G(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return G(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var i=this.containerPointToLayerPoint(G(t));return this.layerPointToLatLng(i)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(H(t)))},mouseEventToContainerPoint:function(t){return Ko(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var i=this._container=Wo(t);if(i){if(i._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");$(i,"scroll",this._onScroll,this),this._containerId=c(i)},_initLayout:function(){var t=this._container;this._fadeAnimated=this.options.fadeAnimation&&D.any3d,V(t,"leaflet-container"+(D.touch?" leaflet-touch":"")+(D.retina?" leaflet-retina":"")+(D.ielt9?" leaflet-oldie":"")+(D.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var i=di(t,"position");i!=="absolute"&&i!=="relative"&&i!=="fixed"&&i!=="sticky"&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),ht(this._mapPane,new F(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(V(t.markerPane,"leaflet-zoom-hide"),V(t.shadowPane,"leaflet-zoom-hide"))},_resetView:function(t,i,a){ht(this._mapPane,new F(0,0));var u=!this._loaded;this._loaded=!0,i=this._limitZoom(i),this.fire("viewprereset");var d=this._zoom!==i;this._moveStart(d,a)._move(t,i)._moveEnd(d),this.fire("viewreset"),u&&this.fire("load")},_moveStart:function(t,i){return t&&this.fire("zoomstart"),i||this.fire("movestart"),this},_move:function(t,i,a,u){i===void 0&&(i=this._zoom);var d=this._zoom!==i;return this._zoom=i,this._lastCenter=t,this._pixelOrigin=this._getNewPixelOrigin(t),u?a&&a.pinch&&this.fire("zoom",a):((d||a&&a.pinch)&&this.fire("zoom",a),this.fire("move",a)),this},_moveEnd:function(t){return t&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return ot(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(t){ht(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(t){this._targets={},this._targets[c(this._container)]=this;var i=t?nt:$;i(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&i(window,"resize",this._onResize,this),D.any3d&&this.options.transform3DLimit&&(t?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){ot(this._resizeRequest),this._resizeRequest=Q(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var t=this._getMapPanePos();Math.max(Math.abs(t.x),Math.abs(t.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(t,i){for(var a=[],u,d=i==="mouseout"||i==="mouseover",p=t.target||t.srcElement,b=!1;p;){if(u=this._targets[c(p)],u&&(i==="click"||i==="preclick")&&this._draggableMoved(u)){b=!0;break}if(u&&u.listens(i,!0)&&(d&&!Tr(p,t)||(a.push(u),d))||p===this._container)break;p=p.parentNode}return!a.length&&!b&&!d&&this.listens(i,!0)&&(a=[this]),a},_isClickDisabled:function(t){for(;t&&t!==this._container;){if(t._leaflet_disable_click)return!0;t=t.parentNode}},_handleDOMEvent:function(t){var i=t.target||t.srcElement;if(!(!this._loaded||i._leaflet_disable_events||t.type==="click"&&this._isClickDisabled(i))){var a=t.type;a==="mousedown"&&Lr(i),this._fireDOMEvent(t,a)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(t,i,a){if(t.type==="click"){var u=o({},t);u.type="preclick",this._fireDOMEvent(u,u.type,a)}var d=this._findEventTargets(t,i);if(a){for(var p=[],b=0;b<a.length;b++)a[b].listens(i,!0)&&p.push(a[b]);d=p.concat(d)}if(d.length){i==="contextmenu"&&Lt(t);var w=d[0],E={originalEvent:t};if(t.type!=="keypress"&&t.type!=="keydown"&&t.type!=="keyup"){var T=w.getLatLng&&(!w._radius||w._radius<=10);E.containerPoint=T?this.latLngToContainerPoint(w.getLatLng()):this.mouseEventToContainerPoint(t),E.layerPoint=this.containerPointToLayerPoint(E.containerPoint),E.latlng=T?w.getLatLng():this.layerPointToLatLng(E.layerPoint)}for(b=0;b<d.length;b++)if(d[b].fire(i,E,!0),E.originalEvent._stopped||d[b].options.bubblingMouseEvents===!1&&P(this._mouseEvents,i)!==-1)return}},_draggableMoved:function(t){return t=t.dragging&&t.dragging.enabled()?t:this,t.dragging&&t.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var t=0,i=this._handlers.length;t<i;t++)this._handlers[t].disable()},whenReady:function(t,i){return this._loaded?t.call(i||this,{target:this}):this.on("load",t,i),this},_getMapPanePos:function(){return ye(this._mapPane)||new F(0,0)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(t,i){var a=t&&i!==void 0?this._getNewPixelOrigin(t,i):this.getPixelOrigin();return a.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(t,i){var a=this.getSize()._divideBy(2);return this.project(t,i)._subtract(a)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(t,i,a){var u=this._getNewPixelOrigin(a,i);return this.project(t,i)._subtract(u)},_latLngBoundsToNewLayerBounds:function(t,i,a){var u=this._getNewPixelOrigin(a,i);return vt([this.project(t.getSouthWest(),i)._subtract(u),this.project(t.getNorthWest(),i)._subtract(u),this.project(t.getSouthEast(),i)._subtract(u),this.project(t.getNorthEast(),i)._subtract(u)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,i,a){if(!a)return t;var u=this.project(t,i),d=this.getSize().divideBy(2),p=new it(u.subtract(d),u.add(d)),b=this._getBoundsOffset(p,a,i);return Math.abs(b.x)<=1&&Math.abs(b.y)<=1?t:this.unproject(u.add(b),i)},_limitOffset:function(t,i){if(!i)return t;var a=this.getPixelBounds(),u=new it(a.min.add(t),a.max.add(t));return t.add(this._getBoundsOffset(u,i))},_getBoundsOffset:function(t,i,a){var u=vt(this.project(i.getNorthEast(),a),this.project(i.getSouthWest(),a)),d=u.min.subtract(t.min),p=u.max.subtract(t.max),b=this._rebound(d.x,-p.x),w=this._rebound(d.y,-p.y);return new F(b,w)},_rebound:function(t,i){return t+i>0?Math.round(t-i)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(i))},_limitZoom:function(t){var i=this.getMinZoom(),a=this.getMaxZoom(),u=D.any3d?this.options.zoomSnap:1;return u&&(t=Math.round(t/u)*u),Math.max(i,Math.min(a,t))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){lt(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,i){var a=this._getCenterOffset(t)._trunc();return(i&&i.animate)!==!0&&!this.getSize().contains(a)?!1:(this.panBy(a,i),!0)},_createAnimProxy:function(){var t=this._proxy=Y("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(t),this.on("zoomanim",function(i){var a=gr,u=this._proxy.style[a];ve(this._proxy,this.project(i.center,i.zoom),this.getZoomScale(i.zoom,1)),u===this._proxy.style[a]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){at(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var t=this.getCenter(),i=this.getZoom();ve(this._proxy,this.project(t,i),this.getZoomScale(i,1))},_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,i,a){if(this._animatingZoom)return!0;if(a=a||{},!this._zoomAnimated||a.animate===!1||this._nothingToAnimate()||Math.abs(i-this._zoom)>this.options.zoomAnimationThreshold)return!1;var u=this.getZoomScale(i),d=this._getCenterOffset(t)._divideBy(1-1/u);return a.animate!==!0&&!this.getSize().contains(d)?!1:(Q(function(){this._moveStart(!0,a.noMoveStart||!1)._animateZoom(t,i,!0)},this),!0)},_animateZoom:function(t,i,a,u){this._mapPane&&(a&&(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=i,V(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:t,zoom:i,noUpdate:u}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(s(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&lt(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function oc(t,i){return new W(t,i)}var Ut=Rt.extend({options:{position:"topright"},initialize:function(t){y(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var i=this._map;return i&&i.removeControl(this),this.options.position=t,i&&i.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this.remove(),this._map=t;var i=this._container=this.onAdd(t),a=this.getPosition(),u=t._controlCorners[a];return V(i,"leaflet-control"),a.indexOf("bottom")!==-1?u.insertBefore(i,u.firstChild):u.appendChild(i),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(at(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(t){this._map&&t&&t.screenX>0&&t.screenY>0&&this._map.getContainer().focus()}}),_i=function(t){return new Ut(t)};W.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.remove(),this},_initControlPos:function(){var t=this._controlCorners={},i="leaflet-",a=this._controlContainer=Y("div",i+"control-container",this._container);function u(d,p){var b=i+d+" "+i+p;t[d+p]=Y("div",b,a)}u("top","left"),u("top","right"),u("bottom","left"),u("bottom","right")},_clearControlPos:function(){for(var t in this._controlCorners)at(this._controlCorners[t]);at(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var ta=Ut.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(t,i,a,u){return a<u?-1:u<a?1:0}},initialize:function(t,i,a){y(this,a),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var u in t)this._addLayer(t[u],u);for(u in i)this._addLayer(i[u],u,!0)},onAdd:function(t){this._initLayout(),this._update(),this._map=t,t.on("zoomend",this._checkDisabledLayers,this);for(var i=0;i<this._layers.length;i++)this._layers[i].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(t){return Ut.prototype.addTo.call(this,t),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(t,i){return this._addLayer(t,i),this._map?this._update():this},addOverlay:function(t,i){return this._addLayer(t,i,!0),this._map?this._update():this},removeLayer:function(t){t.off("add remove",this._onLayerChange,this);var i=this._getLayer(c(t));return i&&this._layers.splice(this._layers.indexOf(i),1),this._map?this._update():this},expand:function(){V(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var t=this._map.getSize().y-(this._container.offsetTop+50);return t<this._section.clientHeight?(V(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=t+"px"):lt(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return lt(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var t="leaflet-control-layers",i=this._container=Y("div",t),a=this.options.collapsed;i.setAttribute("aria-haspopup",!0),gi(i),kr(i);var u=this._section=Y("section",t+"-list");a&&(this._map.on("click",this.collapse,this),$(i,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var d=this._layersLink=Y("a",t+"-toggle",i);d.href="#",d.title="Layers",d.setAttribute("role","button"),$(d,{keydown:function(p){p.keyCode===13&&this._expandSafely()},click:function(p){Lt(p),this._expandSafely()}},this),a||this.expand(),this._baseLayersList=Y("div",t+"-base",u),this._separator=Y("div",t+"-separator",u),this._overlaysList=Y("div",t+"-overlays",u),i.appendChild(u)},_getLayer:function(t){for(var i=0;i<this._layers.length;i++)if(this._layers[i]&&c(this._layers[i].layer)===t)return this._layers[i]},_addLayer:function(t,i,a){this._map&&t.on("add remove",this._onLayerChange,this),this._layers.push({layer:t,name:i,overlay:a}),this.options.sortLayers&&this._layers.sort(s(function(u,d){return this.options.sortFunction(u.layer,d.layer,u.name,d.name)},this)),this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Ki(this._baseLayersList),Ki(this._overlaysList),this._layerControlInputs=[];var t,i,a,u,d=0;for(a=0;a<this._layers.length;a++)u=this._layers[a],this._addItem(u),i=i||u.overlay,t=t||!u.overlay,d+=u.overlay?0:1;return this.options.hideSingleBase&&(t=t&&d>1,this._baseLayersList.style.display=t?"":"none"),this._separator.style.display=i&&t?"":"none",this},_onLayerChange:function(t){this._handlingClick||this._update();var i=this._getLayer(c(t.target)),a=i.overlay?t.type==="add"?"overlayadd":"overlayremove":t.type==="add"?"baselayerchange":null;a&&this._map.fire(a,i)},_createRadioElement:function(t,i){var a='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"'+(i?' checked="checked"':"")+"/>",u=document.createElement("div");return u.innerHTML=a,u.firstChild},_addItem:function(t){var i=document.createElement("label"),a=this._map.hasLayer(t.layer),u;t.overlay?(u=document.createElement("input"),u.type="checkbox",u.className="leaflet-control-layers-selector",u.defaultChecked=a):u=this._createRadioElement("leaflet-base-layers_"+c(this),a),this._layerControlInputs.push(u),u.layerId=c(t.layer),$(u,"click",this._onInputClick,this);var d=document.createElement("span");d.innerHTML=" "+t.name;var p=document.createElement("span");i.appendChild(p),p.appendChild(u),p.appendChild(d);var b=t.overlay?this._overlaysList:this._baseLayersList;return b.appendChild(i),this._checkDisabledLayers(),i},_onInputClick:function(){if(!this._preventClick){var t=this._layerControlInputs,i,a,u=[],d=[];this._handlingClick=!0;for(var p=t.length-1;p>=0;p--)i=t[p],a=this._getLayer(i.layerId).layer,i.checked?u.push(a):i.checked||d.push(a);for(p=0;p<d.length;p++)this._map.hasLayer(d[p])&&this._map.removeLayer(d[p]);for(p=0;p<u.length;p++)this._map.hasLayer(u[p])||this._map.addLayer(u[p]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var t=this._layerControlInputs,i,a,u=this._map.getZoom(),d=t.length-1;d>=0;d--)i=t[d],a=this._getLayer(i.layerId).layer,i.disabled=a.options.minZoom!==void 0&&u<a.options.minZoom||a.options.maxZoom!==void 0&&u>a.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var t=this._section;this._preventClick=!0,$(t,"click",Lt),this.expand();var i=this;setTimeout(function(){nt(t,"click",Lt),i._preventClick=!1})}}),ac=function(t,i,a){return new ta(t,i,a)},Pr=Ut.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(t){var i="leaflet-control-zoom",a=Y("div",i+" leaflet-bar"),u=this.options;return this._zoomInButton=this._createButton(u.zoomInText,u.zoomInTitle,i+"-in",a,this._zoomIn),this._zoomOutButton=this._createButton(u.zoomOutText,u.zoomOutTitle,i+"-out",a,this._zoomOut),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),a},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(t){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(t.shiftKey?3:1))},_zoomOut:function(t){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(t.shiftKey?3:1))},_createButton:function(t,i,a,u,d){var p=Y("a",a,u);return p.innerHTML=t,p.href="#",p.title=i,p.setAttribute("role","button"),p.setAttribute("aria-label",i),gi(p),$(p,"click",we),$(p,"click",d,this),$(p,"click",this._refocusOnMap,this),p},_updateDisabled:function(){var t=this._map,i="leaflet-disabled";lt(this._zoomInButton,i),lt(this._zoomOutButton,i),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||t._zoom===t.getMinZoom())&&(V(this._zoomOutButton,i),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||t._zoom===t.getMaxZoom())&&(V(this._zoomInButton,i),this._zoomInButton.setAttribute("aria-disabled","true"))}});W.mergeOptions({zoomControl:!0}),W.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Pr,this.addControl(this.zoomControl))});var sc=function(t){return new Pr(t)},ea=Ut.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(t){var i="leaflet-control-scale",a=Y("div",i),u=this.options;return this._addScales(u,i+"-line",a),t.on(u.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),a},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,i,a){t.metric&&(this._mScale=Y("div",i,a)),t.imperial&&(this._iScale=Y("div",i,a))},_update:function(){var t=this._map,i=t.getSize().y/2,a=t.distance(t.containerPointToLatLng([0,i]),t.containerPointToLatLng([this.options.maxWidth,i]));this._updateScales(a)},_updateScales:function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},_updateMetric:function(t){var i=this._getRoundNum(t),a=i<1e3?i+" m":i/1e3+" km";this._updateScale(this._mScale,a,i/t)},_updateImperial:function(t){var i=t*3.2808399,a,u,d;i>5280?(a=i/5280,u=this._getRoundNum(a),this._updateScale(this._iScale,u+" mi",u/a)):(d=this._getRoundNum(i),this._updateScale(this._iScale,d+" ft",d/i))},_updateScale:function(t,i,a){t.style.width=Math.round(this.options.maxWidth*a)+"px",t.innerHTML=i},_getRoundNum:function(t){var i=Math.pow(10,(Math.floor(t)+"").length-1),a=t/i;return a=a>=10?10:a>=5?5:a>=3?3:a>=2?2:1,i*a}}),lc=function(t){return new ea(t)},uc='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Or=Ut.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(D.inlineSvg?uc+" ":"")+"Leaflet</a>"},initialize:function(t){y(this,t),this._attributions={}},onAdd:function(t){t.attributionControl=this,this._container=Y("div","leaflet-control-attribution"),gi(this._container);for(var i in t._layers)t._layers[i].getAttribution&&this.addAttribution(t._layers[i].getAttribution());return this._update(),t.on("layeradd",this._addAttribution,this),this._container},onRemove:function(t){t.off("layeradd",this._addAttribution,this)},_addAttribution:function(t){t.layer.getAttribution&&(this.addAttribution(t.layer.getAttribution()),t.layer.once("remove",function(){this.removeAttribution(t.layer.getAttribution())},this))},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):this},removeAttribution:function(t){return t?(this._attributions[t]&&(this._attributions[t]--,this._update()),this):this},_update:function(){if(this._map){var t=[];for(var i in this._attributions)this._attributions[i]&&t.push(i);var a=[];this.options.prefix&&a.push(this.options.prefix),t.length&&a.push(t.join(", ")),this._container.innerHTML=a.join(' <span aria-hidden="true">|</span> ')}}});W.mergeOptions({attributionControl:!0}),W.addInitHook(function(){this.options.attributionControl&&new Or().addTo(this)});var hc=function(t){return new Or(t)};Ut.Layers=ta,Ut.Zoom=Pr,Ut.Scale=ea,Ut.Attribution=Or,_i.layers=ac,_i.zoom=sc,_i.scale=lc,_i.attribution=hc;var Kt=Rt.extend({initialize:function(t){this._map=t},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Kt.addTo=function(t,i){return t.addHandler(i,this),this};var cc={Events:_t},ia=D.touch?"touchstart mousedown":"mousedown",ue=_e.extend({options:{clickTolerance:3},initialize:function(t,i,a,u){y(this,u),this._element=t,this._dragStartTarget=i||t,this._preventOutline=a},enable:function(){this._enabled||($(this._dragStartTarget,ia,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(ue._dragging===this&&this.finishDrag(!0),nt(this._dragStartTarget,ia,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(t){if(this._enabled&&(this._moved=!1,!_r(this._element,"leaflet-zoom-anim"))){if(t.touches&&t.touches.length!==1){ue._dragging===this&&this.finishDrag();return}if(!(ue._dragging||t.shiftKey||t.which!==1&&t.button!==1&&!t.touches)&&(ue._dragging=this,this._preventOutline&&Lr(this._element),br(),fi(),!this._moving)){this.fire("down");var i=t.touches?t.touches[0]:t,a=qo(this._element);this._startPoint=new F(i.clientX,i.clientY),this._startPos=ye(this._element),this._parentScale=Er(a);var u=t.type==="mousedown";$(document,u?"mousemove":"touchmove",this._onMove,this),$(document,u?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(t){if(this._enabled){if(t.touches&&t.touches.length>1){this._moved=!0;return}var i=t.touches&&t.touches.length===1?t.touches[0]:t,a=new F(i.clientX,i.clientY)._subtract(this._startPoint);!a.x&&!a.y||Math.abs(a.x)+Math.abs(a.y)<this.options.clickTolerance||(a.x/=this._parentScale.x,a.y/=this._parentScale.y,Lt(t),this._moved||(this.fire("dragstart"),this._moved=!0,V(document.body,"leaflet-dragging"),this._lastTarget=t.target||t.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),V(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(a),this._moving=!0,this._lastEvent=t,this._updatePosition())}},_updatePosition:function(){var t={originalEvent:this._lastEvent};this.fire("predrag",t),ht(this._element,this._newPos),this.fire("drag",t)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(t){lt(document.body,"leaflet-dragging"),this._lastTarget&&(lt(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),nt(document,"mousemove touchmove",this._onMove,this),nt(document,"mouseup touchend touchcancel",this._onUp,this),wr(),mi();var i=this._moved&&this._moving;this._moving=!1,ue._dragging=!1,i&&this.fire("dragend",{noInertia:t,distance:this._newPos.distanceTo(this._startPos)})}});function na(t,i,a){var u,d=[1,4,2,8],p,b,w,E,T,O,B,j;for(p=0,O=t.length;p<O;p++)t[p]._code=xe(t[p],i);for(w=0;w<4;w++){for(B=d[w],u=[],p=0,O=t.length,b=O-1;p<O;b=p++)E=t[p],T=t[b],E._code&B?T._code&B||(j=nn(T,E,B,i,a),j._code=xe(j,i),u.push(j)):(T._code&B&&(j=nn(T,E,B,i,a),j._code=xe(j,i),u.push(j)),u.push(E));t=u}return t}function ra(t,i){var a,u,d,p,b,w,E,T,O;if(!t||t.length===0)throw new Error("latlngs not passed");Zt(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);var B=H([0,0]),j=ut(t),St=j.getNorthWest().distanceTo(j.getSouthWest())*j.getNorthEast().distanceTo(j.getNorthWest());St<1700&&(B=Ir(t));var yt=t.length,Ft=[];for(a=0;a<yt;a++){var Ot=H(t[a]);Ft.push(i.project(H([Ot.lat-B.lat,Ot.lng-B.lng])))}for(w=E=T=0,a=0,u=yt-1;a<yt;u=a++)d=Ft[a],p=Ft[u],b=d.y*p.x-p.y*d.x,E+=(d.x+p.x)*b,T+=(d.y+p.y)*b,w+=b*3;w===0?O=Ft[0]:O=[E/w,T/w];var qe=i.unproject(G(O));return H([qe.lat+B.lat,qe.lng+B.lng])}function Ir(t){for(var i=0,a=0,u=0,d=0;d<t.length;d++){var p=H(t[d]);i+=p.lat,a+=p.lng,u++}return H([i/u,a/u])}var dc={__proto__:null,clipPolygon:na,polygonCenter:ra,centroid:Ir};function oa(t,i){if(!i||!t.length)return t.slice();var a=i*i;return t=pc(t,a),t=mc(t,a),t}function aa(t,i,a){return Math.sqrt(vi(t,i,a,!0))}function fc(t,i,a){return vi(t,i,a)}function mc(t,i){var a=t.length,u=typeof Uint8Array<"u"?Uint8Array:Array,d=new u(a);d[0]=d[a-1]=1,Dr(t,d,i,0,a-1);var p,b=[];for(p=0;p<a;p++)d[p]&&b.push(t[p]);return b}function Dr(t,i,a,u,d){var p=0,b,w,E;for(w=u+1;w<=d-1;w++)E=vi(t[w],t[u],t[d],!0),E>p&&(b=w,p=E);p>a&&(i[b]=1,Dr(t,i,a,u,b),Dr(t,i,a,b,d))}function pc(t,i){for(var a=[t[0]],u=1,d=0,p=t.length;u<p;u++)gc(t[u],t[d])>i&&(a.push(t[u]),d=u);return d<p-1&&a.push(t[p-1]),a}var sa;function la(t,i,a,u,d){var p=u?sa:xe(t,a),b=xe(i,a),w,E,T;for(sa=b;;){if(!(p|b))return[t,i];if(p&b)return!1;w=p||b,E=nn(t,i,w,a,d),T=xe(E,a),w===p?(t=E,p=T):(i=E,b=T)}}function nn(t,i,a,u,d){var p=i.x-t.x,b=i.y-t.y,w=u.min,E=u.max,T,O;return a&8?(T=t.x+p*(E.y-t.y)/b,O=E.y):a&4?(T=t.x+p*(w.y-t.y)/b,O=w.y):a&2?(T=E.x,O=t.y+b*(E.x-t.x)/p):a&1&&(T=w.x,O=t.y+b*(w.x-t.x)/p),new F(T,O,d)}function xe(t,i){var a=0;return t.x<i.min.x?a|=1:t.x>i.max.x&&(a|=2),t.y<i.min.y?a|=4:t.y>i.max.y&&(a|=8),a}function gc(t,i){var a=i.x-t.x,u=i.y-t.y;return a*a+u*u}function vi(t,i,a,u){var d=i.x,p=i.y,b=a.x-d,w=a.y-p,E=b*b+w*w,T;return E>0&&(T=((t.x-d)*b+(t.y-p)*w)/E,T>1?(d=a.x,p=a.y):T>0&&(d+=b*T,p+=w*T)),b=t.x-d,w=t.y-p,u?b*b+w*w:new F(d,p)}function Zt(t){return!k(t[0])||typeof t[0][0]!="object"&&typeof t[0][0]<"u"}function ua(t){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Zt(t)}function ha(t,i){var a,u,d,p,b,w,E,T;if(!t||t.length===0)throw new Error("latlngs not passed");Zt(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);var O=H([0,0]),B=ut(t),j=B.getNorthWest().distanceTo(B.getSouthWest())*B.getNorthEast().distanceTo(B.getNorthWest());j<1700&&(O=Ir(t));var St=t.length,yt=[];for(a=0;a<St;a++){var Ft=H(t[a]);yt.push(i.project(H([Ft.lat-O.lat,Ft.lng-O.lng])))}for(a=0,u=0;a<St-1;a++)u+=yt[a].distanceTo(yt[a+1])/2;if(u===0)T=yt[0];else for(a=0,p=0;a<St-1;a++)if(b=yt[a],w=yt[a+1],d=b.distanceTo(w),p+=d,p>u){E=(p-u)/d,T=[w.x-E*(w.x-b.x),w.y-E*(w.y-b.y)];break}var Ot=i.unproject(G(T));return H([Ot.lat+O.lat,Ot.lng+O.lng])}var _c={__proto__:null,simplify:oa,pointToSegmentDistance:aa,closestPointOnSegment:fc,clipSegment:la,_getEdgeIntersection:nn,_getBitCode:xe,_sqClosestPointOnSegment:vi,isFlat:Zt,_flat:ua,polylineCenter:ha},Ar={project:function(t){return new F(t.lng,t.lat)},unproject:function(t){return new tt(t.y,t.x)},bounds:new it([-180,-90],[180,90])},Nr={R:6378137,R_MINOR:6356752314245179e-9,bounds:new it([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(t){var i=Math.PI/180,a=this.R,u=t.lat*i,d=this.R_MINOR/a,p=Math.sqrt(1-d*d),b=p*Math.sin(u),w=Math.tan(Math.PI/4-u/2)/Math.pow((1-b)/(1+b),p/2);return u=-a*Math.log(Math.max(w,1e-10)),new F(t.lng*i*a,u)},unproject:function(t){for(var i=180/Math.PI,a=this.R,u=this.R_MINOR/a,d=Math.sqrt(1-u*u),p=Math.exp(-t.y/a),b=Math.PI/2-2*Math.atan(p),w=0,E=.1,T;w<15&&Math.abs(E)>1e-7;w++)T=d*Math.sin(b),T=Math.pow((1-T)/(1+T),d/2),E=Math.PI/2-2*Math.atan(p*T)-b,b+=E;return new tt(b*i,t.x*i/a)}},vc={__proto__:null,LonLat:Ar,Mercator:Nr,SphericalMercator:sr},yc=o({},le,{code:"EPSG:3395",projection:Nr,transformation:function(){var t=.5/(Math.PI*Nr.R);return ui(t,.5,-t,.5)}()}),ca=o({},le,{code:"EPSG:4326",projection:Ar,transformation:ui(1/180,1,-1/180,.5)}),bc=o({},te,{projection:Ar,transformation:ui(1,0,-1,0),scale:function(t){return Math.pow(2,t)},zoom:function(t){return Math.log(t)/Math.LN2},distance:function(t,i){var a=i.lng-t.lng,u=i.lat-t.lat;return Math.sqrt(a*a+u*u)},infinite:!0});te.Earth=le,te.EPSG3395=yc,te.EPSG3857=ur,te.EPSG900913=Ch,te.EPSG4326=ca,te.Simple=bc;var Ht=_e.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(t){return t.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(t){return t&&t.removeLayer(this),this},getPane:function(t){return this._map.getPane(t?this.options[t]||t:this.options.pane)},addInteractiveTarget:function(t){return this._map._targets[c(t)]=this,this},removeInteractiveTarget:function(t){return delete this._map._targets[c(t)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(t){var i=t.target;if(i.hasLayer(this)){if(this._map=i,this._zoomAnimated=i._zoomAnimated,this.getEvents){var a=this.getEvents();i.on(a,this),this.once("remove",function(){i.off(a,this)},this)}this.onAdd(i),this.fire("add"),i.fire("layeradd",{layer:this})}}});W.include({addLayer:function(t){if(!t._layerAdd)throw new Error("The provided object is not a Layer.");var i=c(t);return this._layers[i]?this:(this._layers[i]=t,t._mapToAdd=this,t.beforeAdd&&t.beforeAdd(this),this.whenReady(t._layerAdd,t),this)},removeLayer:function(t){var i=c(t);return this._layers[i]?(this._loaded&&t.onRemove(this),delete this._layers[i],this._loaded&&(this.fire("layerremove",{layer:t}),t.fire("remove")),t._map=t._mapToAdd=null,this):this},hasLayer:function(t){return c(t)in this._layers},eachLayer:function(t,i){for(var a in this._layers)t.call(i,this._layers[a]);return this},_addLayers:function(t){t=t?k(t)?t:[t]:[];for(var i=0,a=t.length;i<a;i++)this.addLayer(t[i])},_addZoomLimit:function(t){(!isNaN(t.options.maxZoom)||!isNaN(t.options.minZoom))&&(this._zoomBoundLayers[c(t)]=t,this._updateZoomLevels())},_removeZoomLimit:function(t){var i=c(t);this._zoomBoundLayers[i]&&(delete this._zoomBoundLayers[i],this._updateZoomLevels())},_updateZoomLevels:function(){var t=1/0,i=-1/0,a=this._getZoomSpan();for(var u in this._zoomBoundLayers){var d=this._zoomBoundLayers[u].options;t=d.minZoom===void 0?t:Math.min(t,d.minZoom),i=d.maxZoom===void 0?i:Math.max(i,d.maxZoom)}this._layersMaxZoom=i===-1/0?void 0:i,this._layersMinZoom=t===1/0?void 0:t,a!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Ve=Ht.extend({initialize:function(t,i){y(this,i),this._layers={};var a,u;if(t)for(a=0,u=t.length;a<u;a++)this.addLayer(t[a])},addLayer:function(t){var i=this.getLayerId(t);return this._layers[i]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var i=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[i]&&this._map.removeLayer(this._layers[i]),delete this._layers[i],this},hasLayer:function(t){var i=typeof t=="number"?t:this.getLayerId(t);return i in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(t){var i=Array.prototype.slice.call(arguments,1),a,u;for(a in this._layers)u=this._layers[a],u[t]&&u[t].apply(u,i);return this},onAdd:function(t){this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t)},eachLayer:function(t,i){for(var a in this._layers)t.call(i,this._layers[a]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];return this.eachLayer(t.push,t),t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return c(t)}}),wc=function(t,i){return new Ve(t,i)},ee=Ve.extend({addLayer:function(t){return this.hasLayer(t)?this:(t.addEventParent(this),Ve.prototype.addLayer.call(this,t),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.removeEventParent(this),Ve.prototype.removeLayer.call(this,t),this.fire("layerremove",{layer:t})):this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new Pt;for(var i in this._layers){var a=this._layers[i];t.extend(a.getBounds?a.getBounds():a.getLatLng())}return t}}),xc=function(t,i){return new ee(t,i)},je=Rt.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(t){y(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,i){var a=this._getIconUrl(t);if(!a){if(t==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var u=this._createImg(a,i&&i.tagName==="IMG"?i:null);return this._setIconStyles(u,t),(this.options.crossOrigin||this.options.crossOrigin==="")&&(u.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),u},_setIconStyles:function(t,i){var a=this.options,u=a[i+"Size"];typeof u=="number"&&(u=[u,u]);var d=G(u),p=G(i==="shadow"&&a.shadowAnchor||a.iconAnchor||d&&d.divideBy(2,!0));t.className="leaflet-marker-"+i+" "+(a.className||""),p&&(t.style.marginLeft=-p.x+"px",t.style.marginTop=-p.y+"px"),d&&(t.style.width=d.x+"px",t.style.height=d.y+"px")},_createImg:function(t,i){return i=i||document.createElement("img"),i.src=t,i},_getIconUrl:function(t){return D.retina&&this.options[t+"RetinaUrl"]||this.options[t+"Url"]}});function Lc(t){return new je(t)}var yi=je.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(t){return typeof yi.imagePath!="string"&&(yi.imagePath=this._detectIconPath()),(this.options.imagePath||yi.imagePath)+je.prototype._getIconUrl.call(this,t)},_stripUrl:function(t){var i=function(a,u,d){var p=u.exec(a);return p&&p[d]};return t=i(t,/^url\((['"])?(.+)\1\)$/,2),t&&i(t,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var t=Y("div","leaflet-default-icon-path",document.body),i=di(t,"background-image")||di(t,"backgroundImage");if(document.body.removeChild(t),i=this._stripUrl(i),i)return i;var a=document.querySelector('link[href$="leaflet.css"]');return a?a.href.substring(0,a.href.length-11-1):""}}),da=Kt.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new ue(t,t,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),V(t,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&lt(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(t){var i=this._marker,a=i._map,u=this._marker.options.autoPanSpeed,d=this._marker.options.autoPanPadding,p=ye(i._icon),b=a.getPixelBounds(),w=a.getPixelOrigin(),E=vt(b.min._subtract(w).add(d),b.max._subtract(w).subtract(d));if(!E.contains(p)){var T=G((Math.max(E.max.x,p.x)-E.max.x)/(b.max.x-E.max.x)-(Math.min(E.min.x,p.x)-E.min.x)/(b.min.x-E.min.x),(Math.max(E.max.y,p.y)-E.max.y)/(b.max.y-E.max.y)-(Math.min(E.min.y,p.y)-E.min.y)/(b.min.y-E.min.y)).multiplyBy(u);a.panBy(T,{animate:!1}),this._draggable._newPos._add(T),this._draggable._startPos._add(T),ht(i._icon,this._draggable._newPos),this._onDrag(t),this._panRequest=Q(this._adjustPan.bind(this,t))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(t){this._marker.options.autoPan&&(ot(this._panRequest),this._panRequest=Q(this._adjustPan.bind(this,t)))},_onDrag:function(t){var i=this._marker,a=i._shadow,u=ye(i._icon),d=i._map.layerPointToLatLng(u);a&&ht(a,u),i._latlng=d,t.latlng=d,t.oldLatLng=this._oldLatLng,i.fire("move",t).fire("drag",t)},_onDragEnd:function(t){ot(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",t)}}),rn=Ht.extend({options:{icon:new yi,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(t,i){y(this,i),this._latlng=H(t)},onAdd:function(t){this._zoomAnimated=this._zoomAnimated&&t.options.markerZoomAnimation,this._zoomAnimated&&t.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(t){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&t.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(t){var i=this._latlng;return this._latlng=H(t),this.update(),this.fire("move",{oldLatLng:i,latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update()},getIcon:function(){return this.options.icon},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,i="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),a=t.icon.createIcon(this._icon),u=!1;a!==this._icon&&(this._icon&&this._removeIcon(),u=!0,t.title&&(a.title=t.title),a.tagName==="IMG"&&(a.alt=t.alt||"")),V(a,i),t.keyboard&&(a.tabIndex="0",a.setAttribute("role","button")),this._icon=a,t.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&$(a,"focus",this._panOnFocus,this);var d=t.icon.createShadow(this._shadow),p=!1;d!==this._shadow&&(this._removeShadow(),p=!0),d&&(V(d,i),d.alt=""),this._shadow=d,t.opacity<1&&this._updateOpacity(),u&&this.getPane().appendChild(this._icon),this._initInteraction(),d&&p&&this.getPane(t.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&nt(this._icon,"focus",this._panOnFocus,this),at(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&at(this._shadow),this._shadow=null},_setPos:function(t){this._icon&&ht(this._icon,t),this._shadow&&ht(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon&&(this._icon.style.zIndex=this._zIndex+t)},_animateZoom:function(t){var i=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(i)},_initInteraction:function(){if(this.options.interactive&&(V(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),da)){var t=this.options.draggable;this.dragging&&(t=this.dragging.enabled(),this.dragging.disable()),this.dragging=new da(this),t&&this.dragging.enable()}},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var t=this.options.opacity;this._icon&&Bt(this._icon,t),this._shadow&&Bt(this._shadow,t)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var t=this._map;if(t){var i=this.options.icon.options,a=i.iconSize?G(i.iconSize):G(0,0),u=i.iconAnchor?G(i.iconAnchor):G(0,0);t.panInside(this._latlng,{paddingTopLeft:u,paddingBottomRight:a.subtract(u)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Ec(t,i){return new rn(t,i)}var he=Ht.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(t){this._renderer=t.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(t){return y(this,t),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&t&&Object.prototype.hasOwnProperty.call(t,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),on=he.extend({options:{fill:!0,radius:10},initialize:function(t,i){y(this,i),this._latlng=H(t),this._radius=this.options.radius},setLatLng:function(t){var i=this._latlng;return this._latlng=H(t),this.redraw(),this.fire("move",{oldLatLng:i,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius},setStyle:function(t){var i=t&&t.radius||this._radius;return he.prototype.setStyle.call(this,t),this.setRadius(i),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var t=this._radius,i=this._radiusY||t,a=this._clickTolerance(),u=[t+a,i+a];this._pxBounds=new it(this._point.subtract(u),this._point.add(u))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(t){return t.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function Mc(t,i){return new on(t,i)}var zr=on.extend({initialize:function(t,i,a){if(typeof i=="number"&&(i=o({},a,{radius:i})),y(this,i),this._latlng=H(t),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(t){return this._mRadius=t,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var t=[this._radius,this._radiusY||this._radius];return new Pt(this._map.layerPointToLatLng(this._point.subtract(t)),this._map.layerPointToLatLng(this._point.add(t)))},setStyle:he.prototype.setStyle,_project:function(){var t=this._latlng.lng,i=this._latlng.lat,a=this._map,u=a.options.crs;if(u.distance===le.distance){var d=Math.PI/180,p=this._mRadius/le.R/d,b=a.project([i+p,t]),w=a.project([i-p,t]),E=b.add(w).divideBy(2),T=a.unproject(E).lat,O=Math.acos((Math.cos(p*d)-Math.sin(i*d)*Math.sin(T*d))/(Math.cos(i*d)*Math.cos(T*d)))/d;(isNaN(O)||O===0)&&(O=p/Math.cos(Math.PI/180*i)),this._point=E.subtract(a.getPixelOrigin()),this._radius=isNaN(O)?0:E.x-a.project([T,t-O]).x,this._radiusY=E.y-b.y}else{var B=u.unproject(u.project(this._latlng).subtract([this._mRadius,0]));this._point=a.latLngToLayerPoint(this._latlng),this._radius=this._point.x-a.latLngToLayerPoint(B).x}this._updateBounds()}});function Cc(t,i,a){return new zr(t,i,a)}var ie=he.extend({options:{smoothFactor:1,noClip:!1},initialize:function(t,i){y(this,i),this._setLatLngs(t)},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._setLatLngs(t),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(t){for(var i=1/0,a=null,u=vi,d,p,b=0,w=this._parts.length;b<w;b++)for(var E=this._parts[b],T=1,O=E.length;T<O;T++){d=E[T-1],p=E[T];var B=u(t,d,p,!0);B<i&&(i=B,a=u(t,d,p))}return a&&(a.distance=Math.sqrt(i)),a},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return ha(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(t,i){return i=i||this._defaultShape(),t=H(t),i.push(t),this._bounds.extend(t),this.redraw()},_setLatLngs:function(t){this._bounds=new Pt,this._latlngs=this._convertLatLngs(t)},_defaultShape:function(){return Zt(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(t){for(var i=[],a=Zt(t),u=0,d=t.length;u<d;u++)a?(i[u]=H(t[u]),this._bounds.extend(i[u])):i[u]=this._convertLatLngs(t[u]);return i},_project:function(){var t=new it;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,t),this._bounds.isValid()&&t.isValid()&&(this._rawPxBounds=t,this._updateBounds())},_updateBounds:function(){var t=this._clickTolerance(),i=new F(t,t);this._rawPxBounds&&(this._pxBounds=new it([this._rawPxBounds.min.subtract(i),this._rawPxBounds.max.add(i)]))},_projectLatlngs:function(t,i,a){var u=t[0]instanceof tt,d=t.length,p,b;if(u){for(b=[],p=0;p<d;p++)b[p]=this._map.latLngToLayerPoint(t[p]),a.extend(b[p]);i.push(b)}else for(p=0;p<d;p++)this._projectLatlngs(t[p],i,a)},_clipPoints:function(){var t=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(t))){if(this.options.noClip){this._parts=this._rings;return}var i=this._parts,a,u,d,p,b,w,E;for(a=0,d=0,p=this._rings.length;a<p;a++)for(E=this._rings[a],u=0,b=E.length;u<b-1;u++)w=la(E[u],E[u+1],t,u,!0),w&&(i[d]=i[d]||[],i[d].push(w[0]),(w[1]!==E[u+1]||u===b-2)&&(i[d].push(w[1]),d++))}},_simplifyPoints:function(){for(var t=this._parts,i=this.options.smoothFactor,a=0,u=t.length;a<u;a++)t[a]=oa(t[a],i)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(t,i){var a,u,d,p,b,w,E=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(a=0,p=this._parts.length;a<p;a++)for(w=this._parts[a],u=0,b=w.length,d=b-1;u<b;d=u++)if(!(!i&&u===0)&&aa(t,w[d],w[u])<=E)return!0;return!1}});function Sc(t,i){return new ie(t,i)}ie._flat=ua;var Ue=ie.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return ra(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(t){var i=ie.prototype._convertLatLngs.call(this,t),a=i.length;return a>=2&&i[0]instanceof tt&&i[0].equals(i[a-1])&&i.pop(),i},_setLatLngs:function(t){ie.prototype._setLatLngs.call(this,t),Zt(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Zt(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var t=this._renderer._bounds,i=this.options.weight,a=new F(i,i);if(t=new it(t.min.subtract(a),t.max.add(a)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(t))){if(this.options.noClip){this._parts=this._rings;return}for(var u=0,d=this._rings.length,p;u<d;u++)p=na(this._rings[u],t,!0),p.length&&this._parts.push(p)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(t){var i=!1,a,u,d,p,b,w,E,T;if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(p=0,E=this._parts.length;p<E;p++)for(a=this._parts[p],b=0,T=a.length,w=T-1;b<T;w=b++)u=a[b],d=a[w],u.y>t.y!=d.y>t.y&&t.x<(d.x-u.x)*(t.y-u.y)/(d.y-u.y)+u.x&&(i=!i);return i||ie.prototype._containsPoint.call(this,t,!0)}});function kc(t,i){return new Ue(t,i)}var ne=ee.extend({initialize:function(t,i){y(this,i),this._layers={},t&&this.addData(t)},addData:function(t){var i=k(t)?t:t.features,a,u,d;if(i){for(a=0,u=i.length;a<u;a++)d=i[a],(d.geometries||d.geometry||d.features||d.coordinates)&&this.addData(d);return this}var p=this.options;if(p.filter&&!p.filter(t))return this;var b=an(t,p);return b?(b.feature=un(t),b.defaultOptions=b.options,this.resetStyle(b),p.onEachFeature&&p.onEachFeature(t,b),this.addLayer(b)):this},resetStyle:function(t){return t===void 0?this.eachLayer(this.resetStyle,this):(t.options=o({},t.defaultOptions),this._setLayerStyle(t,this.options.style),this)},setStyle:function(t){return this.eachLayer(function(i){this._setLayerStyle(i,t)},this)},_setLayerStyle:function(t,i){t.setStyle&&(typeof i=="function"&&(i=i(t.feature)),t.setStyle(i))}});function an(t,i){var a=t.type==="Feature"?t.geometry:t,u=a?a.coordinates:null,d=[],p=i&&i.pointToLayer,b=i&&i.coordsToLatLng||Rr,w,E,T,O;if(!u&&!a)return null;switch(a.type){case"Point":return w=b(u),fa(p,t,w,i);case"MultiPoint":for(T=0,O=u.length;T<O;T++)w=b(u[T]),d.push(fa(p,t,w,i));return new ee(d);case"LineString":case"MultiLineString":return E=sn(u,a.type==="LineString"?0:1,b),new ie(E,i);case"Polygon":case"MultiPolygon":return E=sn(u,a.type==="Polygon"?1:2,b),new Ue(E,i);case"GeometryCollection":for(T=0,O=a.geometries.length;T<O;T++){var B=an({geometry:a.geometries[T],type:"Feature",properties:t.properties},i);B&&d.push(B)}return new ee(d);case"FeatureCollection":for(T=0,O=a.features.length;T<O;T++){var j=an(a.features[T],i);j&&d.push(j)}return new ee(d);default:throw new Error("Invalid GeoJSON object.")}}function fa(t,i,a,u){return t?t(i,a):new rn(a,u&&u.markersInheritOptions&&u)}function Rr(t){return new tt(t[1],t[0],t[2])}function sn(t,i,a){for(var u=[],d=0,p=t.length,b;d<p;d++)b=i?sn(t[d],i-1,a):(a||Rr)(t[d]),u.push(b);return u}function Br(t,i){return t=H(t),t.alt!==void 0?[l(t.lng,i),l(t.lat,i),l(t.alt,i)]:[l(t.lng,i),l(t.lat,i)]}function ln(t,i,a,u){for(var d=[],p=0,b=t.length;p<b;p++)d.push(i?ln(t[p],Zt(t[p])?0:i-1,a,u):Br(t[p],u));return!i&&a&&d.length>0&&d.push(d[0].slice()),d}function He(t,i){return t.feature?o({},t.feature,{geometry:i}):un(i)}function un(t){return t.type==="Feature"||t.type==="FeatureCollection"?t:{type:"Feature",properties:{},geometry:t}}var Zr={toGeoJSON:function(t){return He(this,{type:"Point",coordinates:Br(this.getLatLng(),t)})}};rn.include(Zr),zr.include(Zr),on.include(Zr),ie.include({toGeoJSON:function(t){var i=!Zt(this._latlngs),a=ln(this._latlngs,i?1:0,!1,t);return He(this,{type:(i?"Multi":"")+"LineString",coordinates:a})}}),Ue.include({toGeoJSON:function(t){var i=!Zt(this._latlngs),a=i&&!Zt(this._latlngs[0]),u=ln(this._latlngs,a?2:i?1:0,!0,t);return i||(u=[u]),He(this,{type:(a?"Multi":"")+"Polygon",coordinates:u})}}),Ve.include({toMultiPoint:function(t){var i=[];return this.eachLayer(function(a){i.push(a.toGeoJSON(t).geometry.coordinates)}),He(this,{type:"MultiPoint",coordinates:i})},toGeoJSON:function(t){var i=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(i==="MultiPoint")return this.toMultiPoint(t);var a=i==="GeometryCollection",u=[];return this.eachLayer(function(d){if(d.toGeoJSON){var p=d.toGeoJSON(t);if(a)u.push(p.geometry);else{var b=un(p);b.type==="FeatureCollection"?u.push.apply(u,b.features):u.push(b)}}}),a?He(this,{geometries:u,type:"GeometryCollection"}):{type:"FeatureCollection",features:u}}});function ma(t,i){return new ne(t,i)}var Tc=ma,hn=Ht.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(t,i,a){this._url=t,this._bounds=ut(i),y(this,a)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(V(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){at(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(t){return this.options.opacity=t,this._image&&this._updateOpacity(),this},setStyle:function(t){return t.opacity&&this.setOpacity(t.opacity),this},bringToFront:function(){return this._map&&Ge(this._image),this},bringToBack:function(){return this._map&&$e(this._image),this},setUrl:function(t){return this._url=t,this._image&&(this._image.src=t),this},setBounds:function(t){return this._bounds=ut(t),this._map&&this._reset(),this},getEvents:function(){var t={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var t=this._url.tagName==="IMG",i=this._image=t?this._url:Y("img");if(V(i,"leaflet-image-layer"),this._zoomAnimated&&V(i,"leaflet-zoom-animated"),this.options.className&&V(i,this.options.className),i.onselectstart=g,i.onmousemove=g,i.onload=s(this.fire,this,"load"),i.onerror=s(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(i.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),t){this._url=i.src;return}i.src=this._url,i.alt=this.options.alt},_animateZoom:function(t){var i=this._map.getZoomScale(t.zoom),a=this._map._latLngBoundsToNewLayerBounds(this._bounds,t.zoom,t.center).min;ve(this._image,a,i)},_reset:function(){var t=this._image,i=new it(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),a=i.getSize();ht(t,i.min),t.style.width=a.x+"px",t.style.height=a.y+"px"},_updateOpacity:function(){Bt(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var t=this.options.errorOverlayUrl;t&&this._url!==t&&(this._url=t,this._image.src=t)},getCenter:function(){return this._bounds.getCenter()}}),Pc=function(t,i,a){return new hn(t,i,a)},pa=hn.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var t=this._url.tagName==="VIDEO",i=this._image=t?this._url:Y("video");if(V(i,"leaflet-image-layer"),this._zoomAnimated&&V(i,"leaflet-zoom-animated"),this.options.className&&V(i,this.options.className),i.onselectstart=g,i.onmousemove=g,i.onloadeddata=s(this.fire,this,"load"),t){for(var a=i.getElementsByTagName("source"),u=[],d=0;d<a.length;d++)u.push(a[d].src);this._url=a.length>0?u:[i.src];return}k(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(i.style,"objectFit")&&(i.style.objectFit="fill"),i.autoplay=!!this.options.autoplay,i.loop=!!this.options.loop,i.muted=!!this.options.muted,i.playsInline=!!this.options.playsInline;for(var p=0;p<this._url.length;p++){var b=Y("source");b.src=this._url[p],i.appendChild(b)}}});function Oc(t,i,a){return new pa(t,i,a)}var ga=hn.extend({_initImage:function(){var t=this._image=this._url;V(t,"leaflet-image-layer"),this._zoomAnimated&&V(t,"leaflet-zoom-animated"),this.options.className&&V(t,this.options.className),t.onselectstart=g,t.onmousemove=g}});function Ic(t,i,a){return new ga(t,i,a)}var Qt=Ht.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(t,i){t&&(t instanceof tt||k(t))?(this._latlng=H(t),y(this,i)):(y(this,t),this._source=i),this.options.content&&(this._content=this.options.content)},openOn:function(t){return t=arguments.length?t:this._source._map,t.hasLayer(this)||t.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(t){return this._map?this.close():(arguments.length?this._source=t:t=this._source,this._prepareOpen(),this.openOn(t._map)),this},onAdd:function(t){this._zoomAnimated=t._zoomAnimated,this._container||this._initLayout(),t._fadeAnimated&&Bt(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),t._fadeAnimated&&Bt(this._container,1),this.bringToFront(),this.options.interactive&&(V(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(t){t._fadeAnimated?(Bt(this._container,0),this._removeTimeout=setTimeout(s(at,void 0,this._container),200)):at(this._container),this.options.interactive&&(lt(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=H(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var t={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&Ge(this._container),this},bringToBack:function(){return this._map&&$e(this._container),this},_prepareOpen:function(t){var i=this._source;if(!i._map)return!1;if(i instanceof ee){i=null;var a=this._source._layers;for(var u in a)if(a[u]._map){i=a[u];break}if(!i)return!1;this._source=i}if(!t)if(i.getCenter)t=i.getCenter();else if(i.getLatLng)t=i.getLatLng();else if(i.getBounds)t=i.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(t),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var t=this._contentNode,i=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof i=="string")t.innerHTML=i;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(i)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),i=G(this.options.offset),a=this._getAnchor();this._zoomAnimated?ht(this._container,t.add(a)):i=i.add(t).add(a);var u=this._containerBottom=-i.y,d=this._containerLeft=-Math.round(this._containerWidth/2)+i.x;this._container.style.bottom=u+"px",this._container.style.left=d+"px"}},_getAnchor:function(){return[0,0]}});W.include({_initOverlay:function(t,i,a,u){var d=i;return d instanceof t||(d=new t(u).setContent(i)),a&&d.setLatLng(a),d}}),Ht.include({_initOverlay:function(t,i,a,u){var d=a;return d instanceof t?(y(d,u),d._source=this):(d=i&&!u?i:new t(u,this),d.setContent(a)),d}});var cn=Qt.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(t){return t=arguments.length?t:this._source._map,!t.hasLayer(this)&&t._popup&&t._popup.options.autoClose&&t.removeLayer(t._popup),t._popup=this,Qt.prototype.openOn.call(this,t)},onAdd:function(t){Qt.prototype.onAdd.call(this,t),t.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof he||this._source.on("preclick",be))},onRemove:function(t){Qt.prototype.onRemove.call(this,t),t.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof he||this._source.off("preclick",be))},getEvents:function(){var t=Qt.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this.close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_initLayout:function(){var t="leaflet-popup",i=this._container=Y("div",t+" "+(this.options.className||"")+" leaflet-zoom-animated"),a=this._wrapper=Y("div",t+"-content-wrapper",i);if(this._contentNode=Y("div",t+"-content",a),gi(i),kr(this._contentNode),$(i,"contextmenu",be),this._tipContainer=Y("div",t+"-tip-container",i),this._tip=Y("div",t+"-tip",this._tipContainer),this.options.closeButton){var u=this._closeButton=Y("a",t+"-close-button",i);u.setAttribute("role","button"),u.setAttribute("aria-label","Close popup"),u.href="#close",u.innerHTML='<span aria-hidden="true">&#215;</span>',$(u,"click",function(d){Lt(d),this.close()},this)}},_updateLayout:function(){var t=this._contentNode,i=t.style;i.width="",i.whiteSpace="nowrap";var a=t.offsetWidth;a=Math.min(a,this.options.maxWidth),a=Math.max(a,this.options.minWidth),i.width=a+1+"px",i.whiteSpace="",i.height="";var u=t.offsetHeight,d=this.options.maxHeight,p="leaflet-popup-scrolled";d&&u>d?(i.height=d+"px",V(t,p)):lt(t,p),this._containerWidth=this._container.offsetWidth},_animateZoom:function(t){var i=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center),a=this._getAnchor();ht(this._container,i.add(a))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var t=this._map,i=parseInt(di(this._container,"marginBottom"),10)||0,a=this._container.offsetHeight+i,u=this._containerWidth,d=new F(this._containerLeft,-a-this._containerBottom);d._add(ye(this._container));var p=t.layerPointToContainerPoint(d),b=G(this.options.autoPanPadding),w=G(this.options.autoPanPaddingTopLeft||b),E=G(this.options.autoPanPaddingBottomRight||b),T=t.getSize(),O=0,B=0;p.x+u+E.x>T.x&&(O=p.x+u-T.x+E.x),p.x-O-w.x<0&&(O=p.x-w.x),p.y+a+E.y>T.y&&(B=p.y+a-T.y+E.y),p.y-B-w.y<0&&(B=p.y-w.y),(O||B)&&(this.options.keepInView&&(this._autopanning=!0),t.fire("autopanstart").panBy([O,B]))}},_getAnchor:function(){return G(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Dc=function(t,i){return new cn(t,i)};W.mergeOptions({closePopupOnClick:!0}),W.include({openPopup:function(t,i,a){return this._initOverlay(cn,t,i,a).openOn(this),this},closePopup:function(t){return t=arguments.length?t:this._popup,t&&t.close(),this}}),Ht.include({bindPopup:function(t,i){return this._popup=this._initOverlay(cn,this._popup,t,i),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(t){return this._popup&&(this instanceof ee||(this._popup._source=this),this._popup._prepareOpen(t||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},getPopup:function(){return this._popup},_openPopup:function(t){if(!(!this._popup||!this._map)){we(t);var i=t.layer||t.target;if(this._popup._source===i&&!(i instanceof he)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(t.latlng);return}this._popup._source=i,this.openPopup(t.latlng)}},_movePopup:function(t){this._popup.setLatLng(t.latlng)},_onKeyPress:function(t){t.originalEvent.keyCode===13&&this._openPopup(t)}});var dn=Qt.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(t){Qt.prototype.onAdd.call(this,t),this.setOpacity(this.options.opacity),t.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(t){Qt.prototype.onRemove.call(this,t),t.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var t=Qt.prototype.getEvents.call(this);return this.options.permanent||(t.preclick=this.close),t},_initLayout:function(){var t="leaflet-tooltip",i=t+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=Y("div",i),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+c(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(t){var i,a,u=this._map,d=this._container,p=u.latLngToContainerPoint(u.getCenter()),b=u.layerPointToContainerPoint(t),w=this.options.direction,E=d.offsetWidth,T=d.offsetHeight,O=G(this.options.offset),B=this._getAnchor();w==="top"?(i=E/2,a=T):w==="bottom"?(i=E/2,a=0):w==="center"?(i=E/2,a=T/2):w==="right"?(i=0,a=T/2):w==="left"?(i=E,a=T/2):b.x<p.x?(w="right",i=0,a=T/2):(w="left",i=E+(O.x+B.x)*2,a=T/2),t=t.subtract(G(i,a,!0)).add(O).add(B),lt(d,"leaflet-tooltip-right"),lt(d,"leaflet-tooltip-left"),lt(d,"leaflet-tooltip-top"),lt(d,"leaflet-tooltip-bottom"),V(d,"leaflet-tooltip-"+w),ht(d,t)},_updatePosition:function(){var t=this._map.latLngToLayerPoint(this._latlng);this._setPosition(t)},setOpacity:function(t){this.options.opacity=t,this._container&&Bt(this._container,t)},_animateZoom:function(t){var i=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPosition(i)},_getAnchor:function(){return G(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Ac=function(t,i){return new dn(t,i)};W.include({openTooltip:function(t,i,a){return this._initOverlay(dn,t,i,a).openOn(this),this},closeTooltip:function(t){return t.close(),this}}),Ht.include({bindTooltip:function(t,i){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(dn,this._tooltip,t,i),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(t){if(!(!t&&this._tooltipHandlersAdded)){var i=t?"off":"on",a={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?a.add=this._openTooltip:(a.mouseover=this._openTooltip,a.mouseout=this.closeTooltip,a.click=this._openTooltip,this._map?this._addFocusListeners():a.add=this._addFocusListeners),this._tooltip.options.sticky&&(a.mousemove=this._moveTooltip),this[i](a),this._tooltipHandlersAdded=!t}},openTooltip:function(t){return this._tooltip&&(this instanceof ee||(this._tooltip._source=this),this._tooltip._prepareOpen(t)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(t){return this._tooltip&&this._tooltip.setContent(t),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(t){var i=typeof t.getElement=="function"&&t.getElement();i&&($(i,"focus",function(){this._tooltip._source=t,this.openTooltip()},this),$(i,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(t){var i=typeof t.getElement=="function"&&t.getElement();i&&i.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(t){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var i=this;this._map.once("moveend",function(){i._openOnceFlag=!1,i._openTooltip(t)});return}this._tooltip._source=t.layer||t.target,this.openTooltip(this._tooltip.options.sticky?t.latlng:void 0)}},_moveTooltip:function(t){var i=t.latlng,a,u;this._tooltip.options.sticky&&t.originalEvent&&(a=this._map.mouseEventToContainerPoint(t.originalEvent),u=this._map.containerPointToLayerPoint(a),i=this._map.layerPointToLatLng(u)),this._tooltip.setLatLng(i)}});var _a=je.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(t){var i=t&&t.tagName==="DIV"?t:document.createElement("div"),a=this.options;if(a.html instanceof Element?(Ki(i),i.appendChild(a.html)):i.innerHTML=a.html!==!1?a.html:"",a.bgPos){var u=G(a.bgPos);i.style.backgroundPosition=-u.x+"px "+-u.y+"px"}return this._setIconStyles(i,"icon"),i},createShadow:function(){return null}});function Nc(t){return new _a(t)}je.Default=yi;var bi=Ht.extend({options:{tileSize:256,opacity:1,updateWhenIdle:D.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(t){y(this,t)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(t){t._addZoomLimit(this)},onRemove:function(t){this._removeAllTiles(),at(this._container),t._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(Ge(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&($e(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var t=this._clampZoom(this._map.getZoom());t!==this._tileZoom&&(this._tileZoom=t,this._updateLevels()),this._update()}return this},getEvents:function(){var t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=f(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},createTile:function(){return document.createElement("div")},getTileSize:function(){var t=this.options.tileSize;return t instanceof F?t:new F(t,t)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t){for(var i=this.getPane().children,a=-t(-1/0,1/0),u=0,d=i.length,p;u<d;u++)p=i[u].style.zIndex,i[u]!==this._container&&p&&(a=t(a,+p));isFinite(a)&&(this.options.zIndex=a+t(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!D.ielt9){Bt(this._container,this.options.opacity);var t=+new Date,i=!1,a=!1;for(var u in this._tiles){var d=this._tiles[u];if(!(!d.current||!d.loaded)){var p=Math.min(1,(t-d.loaded)/200);Bt(d.el,p),p<1?i=!0:(d.active?a=!0:this._onOpaqueTile(d),d.active=!0)}}a&&!this._noPrune&&this._pruneTiles(),i&&(ot(this._fadeFrame),this._fadeFrame=Q(this._updateOpacity,this))}},_onOpaqueTile:g,_initContainer:function(){this._container||(this._container=Y("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var t=this._tileZoom,i=this.options.maxZoom;if(t!==void 0){for(var a in this._levels)a=Number(a),this._levels[a].el.children.length||a===t?(this._levels[a].el.style.zIndex=i-Math.abs(t-a),this._onUpdateLevel(a)):(at(this._levels[a].el),this._removeTilesAtZoom(a),this._onRemoveLevel(a),delete this._levels[a]);var u=this._levels[t],d=this._map;return u||(u=this._levels[t]={},u.el=Y("div","leaflet-tile-container leaflet-zoom-animated",this._container),u.el.style.zIndex=i,u.origin=d.project(d.unproject(d.getPixelOrigin()),t).round(),u.zoom=t,this._setZoomTransform(u,d.getCenter(),d.getZoom()),g(u.el.offsetWidth),this._onCreateLevel(u)),this._level=u,u}},_onUpdateLevel:g,_onRemoveLevel:g,_onCreateLevel:g,_pruneTiles:function(){if(this._map){var t,i,a=this._map.getZoom();if(a>this.options.maxZoom||a<this.options.minZoom){this._removeAllTiles();return}for(t in this._tiles)i=this._tiles[t],i.retain=i.current;for(t in this._tiles)if(i=this._tiles[t],i.current&&!i.active){var u=i.coords;this._retainParent(u.x,u.y,u.z,u.z-5)||this._retainChildren(u.x,u.y,u.z,u.z+2)}for(t in this._tiles)this._tiles[t].retain||this._removeTile(t)}},_removeTilesAtZoom:function(t){for(var i in this._tiles)this._tiles[i].coords.z===t&&this._removeTile(i)},_removeAllTiles:function(){for(var t in this._tiles)this._removeTile(t)},_invalidateAll:function(){for(var t in this._levels)at(this._levels[t].el),this._onRemoveLevel(Number(t)),delete this._levels[t];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(t,i,a,u){var d=Math.floor(t/2),p=Math.floor(i/2),b=a-1,w=new F(+d,+p);w.z=+b;var E=this._tileCoordsToKey(w),T=this._tiles[E];return T&&T.active?(T.retain=!0,!0):(T&&T.loaded&&(T.retain=!0),b>u?this._retainParent(d,p,b,u):!1)},_retainChildren:function(t,i,a,u){for(var d=2*t;d<2*t+2;d++)for(var p=2*i;p<2*i+2;p++){var b=new F(d,p);b.z=a+1;var w=this._tileCoordsToKey(b),E=this._tiles[w];if(E&&E.active){E.retain=!0;continue}else E&&E.loaded&&(E.retain=!0);a+1<u&&this._retainChildren(d,p,a+1,u)}},_resetView:function(t){var i=t&&(t.pinch||t.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),i,i)},_animateZoom:function(t){this._setView(t.center,t.zoom,!0,t.noUpdate)},_clampZoom:function(t){var i=this.options;return i.minNativeZoom!==void 0&&t<i.minNativeZoom?i.minNativeZoom:i.maxNativeZoom!==void 0&&i.maxNativeZoom<t?i.maxNativeZoom:t},_setView:function(t,i,a,u){var d=Math.round(i);this.options.maxZoom!==void 0&&d>this.options.maxZoom||this.options.minZoom!==void 0&&d<this.options.minZoom?d=void 0:d=this._clampZoom(d);var p=this.options.updateWhenZooming&&d!==this._tileZoom;(!u||p)&&(this._tileZoom=d,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),d!==void 0&&this._update(t),a||this._pruneTiles(),this._noPrune=!!a),this._setZoomTransforms(t,i)},_setZoomTransforms:function(t,i){for(var a in this._levels)this._setZoomTransform(this._levels[a],t,i)},_setZoomTransform:function(t,i,a){var u=this._map.getZoomScale(a,t.zoom),d=t.origin.multiplyBy(u).subtract(this._map._getNewPixelOrigin(i,a)).round();D.any3d?ve(t.el,d,u):ht(t.el,d)},_resetGrid:function(){var t=this._map,i=t.options.crs,a=this._tileSize=this.getTileSize(),u=this._tileZoom,d=this._map.getPixelWorldBounds(this._tileZoom);d&&(this._globalTileRange=this._pxBoundsToTileRange(d)),this._wrapX=i.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,i.wrapLng[0]],u).x/a.x),Math.ceil(t.project([0,i.wrapLng[1]],u).x/a.y)],this._wrapY=i.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([i.wrapLat[0],0],u).y/a.x),Math.ceil(t.project([i.wrapLat[1],0],u).y/a.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(t){var i=this._map,a=i._animatingZoom?Math.max(i._animateToZoom,i.getZoom()):i.getZoom(),u=i.getZoomScale(a,this._tileZoom),d=i.project(t,this._tileZoom).floor(),p=i.getSize().divideBy(u*2);return new it(d.subtract(p),d.add(p))},_update:function(t){var i=this._map;if(i){var a=this._clampZoom(i.getZoom());if(t===void 0&&(t=i.getCenter()),this._tileZoom!==void 0){var u=this._getTiledPixelBounds(t),d=this._pxBoundsToTileRange(u),p=d.getCenter(),b=[],w=this.options.keepBuffer,E=new it(d.getBottomLeft().subtract([w,-w]),d.getTopRight().add([w,-w]));if(!(isFinite(d.min.x)&&isFinite(d.min.y)&&isFinite(d.max.x)&&isFinite(d.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var T in this._tiles){var O=this._tiles[T].coords;(O.z!==this._tileZoom||!E.contains(new F(O.x,O.y)))&&(this._tiles[T].current=!1)}if(Math.abs(a-this._tileZoom)>1){this._setView(t,a);return}for(var B=d.min.y;B<=d.max.y;B++)for(var j=d.min.x;j<=d.max.x;j++){var St=new F(j,B);if(St.z=this._tileZoom,!!this._isValidTile(St)){var yt=this._tiles[this._tileCoordsToKey(St)];yt?yt.current=!0:b.push(St)}}if(b.sort(function(Ot,qe){return Ot.distanceTo(p)-qe.distanceTo(p)}),b.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Ft=document.createDocumentFragment();for(j=0;j<b.length;j++)this._addTile(b[j],Ft);this._level.el.appendChild(Ft)}}}},_isValidTile:function(t){var i=this._map.options.crs;if(!i.infinite){var a=this._globalTileRange;if(!i.wrapLng&&(t.x<a.min.x||t.x>a.max.x)||!i.wrapLat&&(t.y<a.min.y||t.y>a.max.y))return!1}if(!this.options.bounds)return!0;var u=this._tileCoordsToBounds(t);return ut(this.options.bounds).overlaps(u)},_keyToBounds:function(t){return this._tileCoordsToBounds(this._keyToTileCoords(t))},_tileCoordsToNwSe:function(t){var i=this._map,a=this.getTileSize(),u=t.scaleBy(a),d=u.add(a),p=i.unproject(u,t.z),b=i.unproject(d,t.z);return[p,b]},_tileCoordsToBounds:function(t){var i=this._tileCoordsToNwSe(t),a=new Pt(i[0],i[1]);return this.options.noWrap||(a=this._map.wrapLatLngBounds(a)),a},_tileCoordsToKey:function(t){return t.x+":"+t.y+":"+t.z},_keyToTileCoords:function(t){var i=t.split(":"),a=new F(+i[0],+i[1]);return a.z=+i[2],a},_removeTile:function(t){var i=this._tiles[t];i&&(at(i.el),delete this._tiles[t],this.fire("tileunload",{tile:i.el,coords:this._keyToTileCoords(t)}))},_initTile:function(t){V(t,"leaflet-tile");var i=this.getTileSize();t.style.width=i.x+"px",t.style.height=i.y+"px",t.onselectstart=g,t.onmousemove=g,D.ielt9&&this.options.opacity<1&&Bt(t,this.options.opacity)},_addTile:function(t,i){var a=this._getTilePos(t),u=this._tileCoordsToKey(t),d=this.createTile(this._wrapCoords(t),s(this._tileReady,this,t));this._initTile(d),this.createTile.length<2&&Q(s(this._tileReady,this,t,null,d)),ht(d,a),this._tiles[u]={el:d,coords:t,current:!0},i.appendChild(d),this.fire("tileloadstart",{tile:d,coords:t})},_tileReady:function(t,i,a){i&&this.fire("tileerror",{error:i,tile:a,coords:t});var u=this._tileCoordsToKey(t);a=this._tiles[u],a&&(a.loaded=+new Date,this._map._fadeAnimated?(Bt(a.el,0),ot(this._fadeFrame),this._fadeFrame=Q(this._updateOpacity,this)):(a.active=!0,this._pruneTiles()),i||(V(a.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:a.el,coords:t})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),D.ielt9||!this._map._fadeAnimated?Q(this._pruneTiles,this):setTimeout(s(this._pruneTiles,this),250)))},_getTilePos:function(t){return t.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(t){var i=new F(this._wrapX?_(t.x,this._wrapX):t.x,this._wrapY?_(t.y,this._wrapY):t.y);return i.z=t.z,i},_pxBoundsToTileRange:function(t){var i=this.getTileSize();return new it(t.min.unscaleBy(i).floor(),t.max.unscaleBy(i).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var t in this._tiles)if(!this._tiles[t].loaded)return!1;return!0}});function zc(t){return new bi(t)}var We=bi.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(t,i){this._url=t,i=y(this,i),i.detectRetina&&D.retina&&i.maxZoom>0?(i.tileSize=Math.floor(i.tileSize/2),i.zoomReverse?(i.zoomOffset--,i.minZoom=Math.min(i.maxZoom,i.minZoom+1)):(i.zoomOffset++,i.maxZoom=Math.max(i.minZoom,i.maxZoom-1)),i.minZoom=Math.max(0,i.minZoom)):i.zoomReverse?i.minZoom=Math.min(i.maxZoom,i.minZoom):i.maxZoom=Math.max(i.minZoom,i.maxZoom),typeof i.subdomains=="string"&&(i.subdomains=i.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(t,i){return this._url===t&&i===void 0&&(i=!0),this._url=t,i||this.redraw(),this},createTile:function(t,i){var a=document.createElement("img");return $(a,"load",s(this._tileOnLoad,this,i,a)),$(a,"error",s(this._tileOnError,this,i,a)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(a.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(a.referrerPolicy=this.options.referrerPolicy),a.alt="",a.src=this.getTileUrl(t),a},getTileUrl:function(t){var i={r:D.retina?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var a=this._globalTileRange.max.y-t.y;this.options.tms&&(i.y=a),i["-y"]=a}return C(this._url,o(i,this.options))},_tileOnLoad:function(t,i){D.ielt9?setTimeout(s(t,this,null,i),0):t(null,i)},_tileOnError:function(t,i,a){var u=this.options.errorTileUrl;u&&i.getAttribute("src")!==u&&(i.src=u),t(a,i)},_onTileRemove:function(t){t.tile.onload=null},_getZoomForUrl:function(){var t=this._tileZoom,i=this.options.maxZoom,a=this.options.zoomReverse,u=this.options.zoomOffset;return a&&(t=i-t),t+u},_getSubdomain:function(t){var i=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[i]},_abortLoading:function(){var t,i;for(t in this._tiles)if(this._tiles[t].coords.z!==this._tileZoom&&(i=this._tiles[t].el,i.onload=g,i.onerror=g,!i.complete)){i.src=A;var a=this._tiles[t].coords;at(i),delete this._tiles[t],this.fire("tileabort",{tile:i,coords:a})}},_removeTile:function(t){var i=this._tiles[t];if(i)return i.el.setAttribute("src",A),bi.prototype._removeTile.call(this,t)},_tileReady:function(t,i,a){if(!(!this._map||a&&a.getAttribute("src")===A))return bi.prototype._tileReady.call(this,t,i,a)}});function va(t,i){return new We(t,i)}var ya=We.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(t,i){this._url=t;var a=o({},this.defaultWmsParams);for(var u in i)u in this.options||(a[u]=i[u]);i=y(this,i);var d=i.detectRetina&&D.retina?2:1,p=this.getTileSize();a.width=p.x*d,a.height=p.y*d,this.wmsParams=a},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var i=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[i]=this._crs.code,We.prototype.onAdd.call(this,t)},getTileUrl:function(t){var i=this._tileCoordsToNwSe(t),a=this._crs,u=vt(a.project(i[0]),a.project(i[1])),d=u.min,p=u.max,b=(this._wmsVersion>=1.3&&this._crs===ca?[d.y,d.x,p.y,p.x]:[d.x,d.y,p.x,p.y]).join(","),w=We.prototype.getTileUrl.call(this,t);return w+M(this.wmsParams,w,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+b},setParams:function(t,i){return o(this.wmsParams,t),i||this.redraw(),this}});function Rc(t,i){return new ya(t,i)}We.WMS=ya,va.wms=Rc;var re=Ht.extend({options:{padding:.1},initialize:function(t){y(this,t),c(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),V(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var t={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},_onAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,i){var a=this._map.getZoomScale(i,this._zoom),u=this._map.getSize().multiplyBy(.5+this.options.padding),d=this._map.project(this._center,i),p=u.multiplyBy(-a).add(d).subtract(this._map._getNewPixelOrigin(t,i));D.any3d?ve(this._container,p,a):ht(this._container,p)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var t in this._layers)this._layers[t]._reset()},_onZoomEnd:function(){for(var t in this._layers)this._layers[t]._project()},_updatePaths:function(){for(var t in this._layers)this._layers[t]._update()},_update:function(){var t=this.options.padding,i=this._map.getSize(),a=this._map.containerPointToLayerPoint(i.multiplyBy(-t)).round();this._bounds=new it(a,a.add(i.multiplyBy(1+t*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),ba=re.extend({options:{tolerance:0},getEvents:function(){var t=re.prototype.getEvents.call(this);return t.viewprereset=this._onViewPreReset,t},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){re.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var t=this._container=document.createElement("canvas");$(t,"mousemove",this._onMouseMove,this),$(t,"click dblclick mousedown mouseup contextmenu",this._onClick,this),$(t,"mouseout",this._handleMouseOut,this),t._leaflet_disable_events=!0,this._ctx=t.getContext("2d")},_destroyContainer:function(){ot(this._redrawRequest),delete this._ctx,at(this._container),nt(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var t;this._redrawBounds=null;for(var i in this._layers)t=this._layers[i],t._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){re.prototype._update.call(this);var t=this._bounds,i=this._container,a=t.getSize(),u=D.retina?2:1;ht(i,t.min),i.width=u*a.x,i.height=u*a.y,i.style.width=a.x+"px",i.style.height=a.y+"px",D.retina&&this._ctx.scale(2,2),this._ctx.translate(-t.min.x,-t.min.y),this.fire("update")}},_reset:function(){re.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(t){this._updateDashArray(t),this._layers[c(t)]=t;var i=t._order={layer:t,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=i),this._drawLast=i,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(t){this._requestRedraw(t)},_removePath:function(t){var i=t._order,a=i.next,u=i.prev;a?a.prev=u:this._drawLast=u,u?u.next=a:this._drawFirst=a,delete t._order,delete this._layers[c(t)],this._requestRedraw(t)},_updatePath:function(t){this._extendRedrawBounds(t),t._project(),t._update(),this._requestRedraw(t)},_updateStyle:function(t){this._updateDashArray(t),this._requestRedraw(t)},_updateDashArray:function(t){if(typeof t.options.dashArray=="string"){var i=t.options.dashArray.split(/[, ]+/),a=[],u,d;for(d=0;d<i.length;d++){if(u=Number(i[d]),isNaN(u))return;a.push(u)}t.options._dashArray=a}else t.options._dashArray=t.options.dashArray},_requestRedraw:function(t){this._map&&(this._extendRedrawBounds(t),this._redrawRequest=this._redrawRequest||Q(this._redraw,this))},_extendRedrawBounds:function(t){if(t._pxBounds){var i=(t.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new it,this._redrawBounds.extend(t._pxBounds.min.subtract([i,i])),this._redrawBounds.extend(t._pxBounds.max.add([i,i]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var t=this._redrawBounds;if(t){var i=t.getSize();this._ctx.clearRect(t.min.x,t.min.y,i.x,i.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var t,i=this._redrawBounds;if(this._ctx.save(),i){var a=i.getSize();this._ctx.beginPath(),this._ctx.rect(i.min.x,i.min.y,a.x,a.y),this._ctx.clip()}this._drawing=!0;for(var u=this._drawFirst;u;u=u.next)t=u.layer,(!i||t._pxBounds&&t._pxBounds.intersects(i))&&t._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(t,i){if(this._drawing){var a,u,d,p,b=t._parts,w=b.length,E=this._ctx;if(w){for(E.beginPath(),a=0;a<w;a++){for(u=0,d=b[a].length;u<d;u++)p=b[a][u],E[u?"lineTo":"moveTo"](p.x,p.y);i&&E.closePath()}this._fillStroke(E,t)}}},_updateCircle:function(t){if(!(!this._drawing||t._empty())){var i=t._point,a=this._ctx,u=Math.max(Math.round(t._radius),1),d=(Math.max(Math.round(t._radiusY),1)||u)/u;d!==1&&(a.save(),a.scale(1,d)),a.beginPath(),a.arc(i.x,i.y/d,u,0,Math.PI*2,!1),d!==1&&a.restore(),this._fillStroke(a,t)}},_fillStroke:function(t,i){var a=i.options;a.fill&&(t.globalAlpha=a.fillOpacity,t.fillStyle=a.fillColor||a.color,t.fill(a.fillRule||"evenodd")),a.stroke&&a.weight!==0&&(t.setLineDash&&t.setLineDash(i.options&&i.options._dashArray||[]),t.globalAlpha=a.opacity,t.lineWidth=a.weight,t.strokeStyle=a.color,t.lineCap=a.lineCap,t.lineJoin=a.lineJoin,t.stroke())},_onClick:function(t){for(var i=this._map.mouseEventToLayerPoint(t),a,u,d=this._drawFirst;d;d=d.next)a=d.layer,a.options.interactive&&a._containsPoint(i)&&(!(t.type==="click"||t.type==="preclick")||!this._map._draggableMoved(a))&&(u=a);this._fireEvent(u?[u]:!1,t)},_onMouseMove:function(t){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var i=this._map.mouseEventToLayerPoint(t);this._handleMouseHover(t,i)}},_handleMouseOut:function(t){var i=this._hoveredLayer;i&&(lt(this._container,"leaflet-interactive"),this._fireEvent([i],t,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(t,i){if(!this._mouseHoverThrottled){for(var a,u,d=this._drawFirst;d;d=d.next)a=d.layer,a.options.interactive&&a._containsPoint(i)&&(u=a);u!==this._hoveredLayer&&(this._handleMouseOut(t),u&&(V(this._container,"leaflet-interactive"),this._fireEvent([u],t,"mouseover"),this._hoveredLayer=u)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,t),this._mouseHoverThrottled=!0,setTimeout(s(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(t,i,a){this._map._fireDOMEvent(i,a||i.type,t)},_bringToFront:function(t){var i=t._order;if(i){var a=i.next,u=i.prev;if(a)a.prev=u;else return;u?u.next=a:a&&(this._drawFirst=a),i.prev=this._drawLast,this._drawLast.next=i,i.next=null,this._drawLast=i,this._requestRedraw(t)}},_bringToBack:function(t){var i=t._order;if(i){var a=i.next,u=i.prev;if(u)u.next=a;else return;a?a.prev=u:u&&(this._drawLast=u),i.prev=null,i.next=this._drawFirst,this._drawFirst.prev=i,this._drawFirst=i,this._requestRedraw(t)}}});function wa(t){return D.canvas?new ba(t):null}var wi=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return document.createElement("<lvml:"+t+' class="lvml">')}}catch{}return function(t){return document.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),Bc={_initContainer:function(){this._container=Y("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(re.prototype._update.call(this),this.fire("update"))},_initPath:function(t){var i=t._container=wi("shape");V(i,"leaflet-vml-shape "+(this.options.className||"")),i.coordsize="1 1",t._path=wi("path"),i.appendChild(t._path),this._updateStyle(t),this._layers[c(t)]=t},_addPath:function(t){var i=t._container;this._container.appendChild(i),t.options.interactive&&t.addInteractiveTarget(i)},_removePath:function(t){var i=t._container;at(i),t.removeInteractiveTarget(i),delete this._layers[c(t)]},_updateStyle:function(t){var i=t._stroke,a=t._fill,u=t.options,d=t._container;d.stroked=!!u.stroke,d.filled=!!u.fill,u.stroke?(i||(i=t._stroke=wi("stroke")),d.appendChild(i),i.weight=u.weight+"px",i.color=u.color,i.opacity=u.opacity,u.dashArray?i.dashStyle=k(u.dashArray)?u.dashArray.join(" "):u.dashArray.replace(/( *, *)/g," "):i.dashStyle="",i.endcap=u.lineCap.replace("butt","flat"),i.joinstyle=u.lineJoin):i&&(d.removeChild(i),t._stroke=null),u.fill?(a||(a=t._fill=wi("fill")),d.appendChild(a),a.color=u.fillColor||u.color,a.opacity=u.fillOpacity):a&&(d.removeChild(a),t._fill=null)},_updateCircle:function(t){var i=t._point.round(),a=Math.round(t._radius),u=Math.round(t._radiusY||a);this._setPath(t,t._empty()?"M0 0":"AL "+i.x+","+i.y+" "+a+","+u+" 0,"+65535*360)},_setPath:function(t,i){t._path.v=i},_bringToFront:function(t){Ge(t._container)},_bringToBack:function(t){$e(t._container)}},fn=D.vml?wi:Mo,xi=re.extend({_initContainer:function(){this._container=fn("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=fn("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){at(this._container),nt(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){re.prototype._update.call(this);var t=this._bounds,i=t.getSize(),a=this._container;(!this._svgSize||!this._svgSize.equals(i))&&(this._svgSize=i,a.setAttribute("width",i.x),a.setAttribute("height",i.y)),ht(a,t.min),a.setAttribute("viewBox",[t.min.x,t.min.y,i.x,i.y].join(" ")),this.fire("update")}},_initPath:function(t){var i=t._path=fn("path");t.options.className&&V(i,t.options.className),t.options.interactive&&V(i,"leaflet-interactive"),this._updateStyle(t),this._layers[c(t)]=t},_addPath:function(t){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(t._path),t.addInteractiveTarget(t._path)},_removePath:function(t){at(t._path),t.removeInteractiveTarget(t._path),delete this._layers[c(t)]},_updatePath:function(t){t._project(),t._update()},_updateStyle:function(t){var i=t._path,a=t.options;i&&(a.stroke?(i.setAttribute("stroke",a.color),i.setAttribute("stroke-opacity",a.opacity),i.setAttribute("stroke-width",a.weight),i.setAttribute("stroke-linecap",a.lineCap),i.setAttribute("stroke-linejoin",a.lineJoin),a.dashArray?i.setAttribute("stroke-dasharray",a.dashArray):i.removeAttribute("stroke-dasharray"),a.dashOffset?i.setAttribute("stroke-dashoffset",a.dashOffset):i.removeAttribute("stroke-dashoffset")):i.setAttribute("stroke","none"),a.fill?(i.setAttribute("fill",a.fillColor||a.color),i.setAttribute("fill-opacity",a.fillOpacity),i.setAttribute("fill-rule",a.fillRule||"evenodd")):i.setAttribute("fill","none"))},_updatePoly:function(t,i){this._setPath(t,Co(t._parts,i))},_updateCircle:function(t){var i=t._point,a=Math.max(Math.round(t._radius),1),u=Math.max(Math.round(t._radiusY),1)||a,d="a"+a+","+u+" 0 1,0 ",p=t._empty()?"M0 0":"M"+(i.x-a)+","+i.y+d+a*2+",0 "+d+-a*2+",0 ";this._setPath(t,p)},_setPath:function(t,i){t._path.setAttribute("d",i)},_bringToFront:function(t){Ge(t._path)},_bringToBack:function(t){$e(t._path)}});D.vml&&xi.include(Bc);function xa(t){return D.svg||D.vml?new xi(t):null}W.include({getRenderer:function(t){var i=t.options.renderer||this._getPaneRenderer(t.options.pane)||this.options.renderer||this._renderer;return i||(i=this._renderer=this._createRenderer()),this.hasLayer(i)||this.addLayer(i),i},_getPaneRenderer:function(t){if(t==="overlayPane"||t===void 0)return!1;var i=this._paneRenderers[t];return i===void 0&&(i=this._createRenderer({pane:t}),this._paneRenderers[t]=i),i},_createRenderer:function(t){return this.options.preferCanvas&&wa(t)||xa(t)}});var La=Ue.extend({initialize:function(t,i){Ue.prototype.initialize.call(this,this._boundsToLatLngs(t),i)},setBounds:function(t){return this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return t=ut(t),[t.getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}});function Zc(t,i){return new La(t,i)}xi.create=fn,xi.pointsToPath=Co,ne.geometryToLayer=an,ne.coordsToLatLng=Rr,ne.coordsToLatLngs=sn,ne.latLngToCoords=Br,ne.latLngsToCoords=ln,ne.getFeature=He,ne.asFeature=un,W.mergeOptions({boxZoom:!0});var Ea=Kt.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane,this._resetStateTimeout=0,t.on("unload",this._destroy,this)},addHooks:function(){$(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){nt(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){at(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(t){if(!t.shiftKey||t.which!==1&&t.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),fi(),br(),this._startPoint=this._map.mouseEventToContainerPoint(t),$(document,{contextmenu:we,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(t){this._moved||(this._moved=!0,this._box=Y("div","leaflet-zoom-box",this._container),V(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(t);var i=new it(this._point,this._startPoint),a=i.getSize();ht(this._box,i.min),this._box.style.width=a.x+"px",this._box.style.height=a.y+"px"},_finish:function(){this._moved&&(at(this._box),lt(this._container,"leaflet-crosshair")),mi(),wr(),nt(document,{contextmenu:we,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(t){if(!(t.which!==1&&t.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(s(this._resetState,this),0);var i=new Pt(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(i).fire("boxzoomend",{boxZoomBounds:i})}},_onKeyDown:function(t){t.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});W.addInitHook("addHandler","boxZoom",Ea),W.mergeOptions({doubleClickZoom:!0});var Ma=Kt.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var i=this._map,a=i.getZoom(),u=i.options.zoomDelta,d=t.originalEvent.shiftKey?a-u:a+u;i.options.doubleClickZoom==="center"?i.setZoom(d):i.setZoomAround(t.containerPoint,d)}});W.addInitHook("addHandler","doubleClickZoom",Ma),W.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Ca=Kt.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new ue(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),t.on("zoomend",this._onZoomEnd,this),t.whenReady(this._onZoomEnd,this))}V(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){lt(this._map._container,"leaflet-grab"),lt(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var t=this._map;if(t._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var i=ut(this._map.options.maxBounds);this._offsetLimit=vt(this._map.latLngToContainerPoint(i.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(i.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(t){if(this._map.options.inertia){var i=this._lastTime=+new Date,a=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(a),this._times.push(i),this._prunePositions(i)}this._map.fire("move",t).fire("drag",t)},_prunePositions:function(t){for(;this._positions.length>1&&t-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var t=this._map.getSize().divideBy(2),i=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=i.subtract(t).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(t,i){return t-(t-i)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var t=this._draggable._newPos.subtract(this._draggable._startPos),i=this._offsetLimit;t.x<i.min.x&&(t.x=this._viscousLimit(t.x,i.min.x)),t.y<i.min.y&&(t.y=this._viscousLimit(t.y,i.min.y)),t.x>i.max.x&&(t.x=this._viscousLimit(t.x,i.max.x)),t.y>i.max.y&&(t.y=this._viscousLimit(t.y,i.max.y)),this._draggable._newPos=this._draggable._startPos.add(t)}},_onPreDragWrap:function(){var t=this._worldWidth,i=Math.round(t/2),a=this._initialWorldOffset,u=this._draggable._newPos.x,d=(u-i+a)%t+i-a,p=(u+i+a)%t-i-a,b=Math.abs(d+a)<Math.abs(p+a)?d:p;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=b},_onDragEnd:function(t){var i=this._map,a=i.options,u=!a.inertia||t.noInertia||this._times.length<2;if(i.fire("dragend",t),u)i.fire("moveend");else{this._prunePositions(+new Date);var d=this._lastPos.subtract(this._positions[0]),p=(this._lastTime-this._times[0])/1e3,b=a.easeLinearity,w=d.multiplyBy(b/p),E=w.distanceTo([0,0]),T=Math.min(a.inertiaMaxSpeed,E),O=w.multiplyBy(T/E),B=T/(a.inertiaDeceleration*b),j=O.multiplyBy(-B/2).round();!j.x&&!j.y?i.fire("moveend"):(j=i._limitOffset(j,i.options.maxBounds),Q(function(){i.panBy(j,{duration:B,easeLinearity:b,noMoveStart:!0,animate:!0})}))}}});W.addInitHook("addHandler","dragging",Ca),W.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Sa=Kt.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(t){this._map=t,this._setPanDelta(t.options.keyboardPanDelta),this._setZoomDelta(t.options.zoomDelta)},addHooks:function(){var t=this._map._container;t.tabIndex<=0&&(t.tabIndex="0"),$(t,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),nt(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var t=document.body,i=document.documentElement,a=t.scrollTop||i.scrollTop,u=t.scrollLeft||i.scrollLeft;this._map._container.focus(),window.scrollTo(u,a)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(t){var i=this._panKeys={},a=this.keyCodes,u,d;for(u=0,d=a.left.length;u<d;u++)i[a.left[u]]=[-1*t,0];for(u=0,d=a.right.length;u<d;u++)i[a.right[u]]=[t,0];for(u=0,d=a.down.length;u<d;u++)i[a.down[u]]=[0,t];for(u=0,d=a.up.length;u<d;u++)i[a.up[u]]=[0,-1*t]},_setZoomDelta:function(t){var i=this._zoomKeys={},a=this.keyCodes,u,d;for(u=0,d=a.zoomIn.length;u<d;u++)i[a.zoomIn[u]]=t;for(u=0,d=a.zoomOut.length;u<d;u++)i[a.zoomOut[u]]=-t},_addHooks:function(){$(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){nt(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var i=t.keyCode,a=this._map,u;if(i in this._panKeys){if(!a._panAnim||!a._panAnim._inProgress)if(u=this._panKeys[i],t.shiftKey&&(u=G(u).multiplyBy(3)),a.options.maxBounds&&(u=a._limitOffset(G(u),a.options.maxBounds)),a.options.worldCopyJump){var d=a.wrapLatLng(a.unproject(a.project(a.getCenter()).add(u)));a.panTo(d)}else a.panBy(u)}else if(i in this._zoomKeys)a.setZoom(a.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[i]);else if(i===27&&a._popup&&a._popup.options.closeOnEscapeKey)a.closePopup();else return;we(t)}}});W.addInitHook("addHandler","keyboard",Sa),W.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var ka=Kt.extend({addHooks:function(){$(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){nt(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(t){var i=Qo(t),a=this._map.options.wheelDebounceTime;this._delta+=i,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var u=Math.max(a-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(s(this._performZoom,this),u),we(t)},_performZoom:function(){var t=this._map,i=t.getZoom(),a=this._map.options.zoomSnap||0;t._stop();var u=this._delta/(this._map.options.wheelPxPerZoomLevel*4),d=4*Math.log(2/(1+Math.exp(-Math.abs(u))))/Math.LN2,p=a?Math.ceil(d/a)*a:d,b=t._limitZoom(i+(this._delta>0?p:-p))-i;this._delta=0,this._startTime=null,b&&(t.options.scrollWheelZoom==="center"?t.setZoom(i+b):t.setZoomAround(this._lastMousePos,i+b))}});W.addInitHook("addHandler","scrollWheelZoom",ka);var Fc=600;W.mergeOptions({tapHold:D.touchNative&&D.safari&&D.mobile,tapTolerance:15});var Ta=Kt.extend({addHooks:function(){$(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){nt(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(clearTimeout(this._holdTimeout),t.touches.length===1){var i=t.touches[0];this._startPos=this._newPos=new F(i.clientX,i.clientY),this._holdTimeout=setTimeout(s(function(){this._cancel(),this._isTapValid()&&($(document,"touchend",Lt),$(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",i))},this),Fc),$(document,"touchend touchcancel contextmenu",this._cancel,this),$(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function t(){nt(document,"touchend",Lt),nt(document,"touchend touchcancel",t)},_cancel:function(){clearTimeout(this._holdTimeout),nt(document,"touchend touchcancel contextmenu",this._cancel,this),nt(document,"touchmove",this._onMove,this)},_onMove:function(t){var i=t.touches[0];this._newPos=new F(i.clientX,i.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(t,i){var a=new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,screenX:i.screenX,screenY:i.screenY,clientX:i.clientX,clientY:i.clientY});a._simulated=!0,i.target.dispatchEvent(a)}});W.addInitHook("addHandler","tapHold",Ta),W.mergeOptions({touchZoom:D.touch,bounceAtZoomLimits:!0});var Pa=Kt.extend({addHooks:function(){V(this._map._container,"leaflet-touch-zoom"),$(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){lt(this._map._container,"leaflet-touch-zoom"),nt(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var i=this._map;if(!(!t.touches||t.touches.length!==2||i._animatingZoom||this._zooming)){var a=i.mouseEventToContainerPoint(t.touches[0]),u=i.mouseEventToContainerPoint(t.touches[1]);this._centerPoint=i.getSize()._divideBy(2),this._startLatLng=i.containerPointToLatLng(this._centerPoint),i.options.touchZoom!=="center"&&(this._pinchStartLatLng=i.containerPointToLatLng(a.add(u)._divideBy(2))),this._startDist=a.distanceTo(u),this._startZoom=i.getZoom(),this._moved=!1,this._zooming=!0,i._stop(),$(document,"touchmove",this._onTouchMove,this),$(document,"touchend touchcancel",this._onTouchEnd,this),Lt(t)}},_onTouchMove:function(t){if(!(!t.touches||t.touches.length!==2||!this._zooming)){var i=this._map,a=i.mouseEventToContainerPoint(t.touches[0]),u=i.mouseEventToContainerPoint(t.touches[1]),d=a.distanceTo(u)/this._startDist;if(this._zoom=i.getScaleZoom(d,this._startZoom),!i.options.bounceAtZoomLimits&&(this._zoom<i.getMinZoom()&&d<1||this._zoom>i.getMaxZoom()&&d>1)&&(this._zoom=i._limitZoom(this._zoom)),i.options.touchZoom==="center"){if(this._center=this._startLatLng,d===1)return}else{var p=a._add(u)._divideBy(2)._subtract(this._centerPoint);if(d===1&&p.x===0&&p.y===0)return;this._center=i.unproject(i.project(this._pinchStartLatLng,this._zoom).subtract(p),this._zoom)}this._moved||(i._moveStart(!0,!1),this._moved=!0),ot(this._animRequest);var b=s(i._move,i,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=Q(b,this,!0),Lt(t)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,ot(this._animRequest),nt(document,"touchmove",this._onTouchMove,this),nt(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});W.addInitHook("addHandler","touchZoom",Pa),W.BoxZoom=Ea,W.DoubleClickZoom=Ma,W.Drag=Ca,W.Keyboard=Sa,W.ScrollWheelZoom=ka,W.TapHold=Ta,W.TouchZoom=Pa,n.Bounds=it,n.Browser=D,n.CRS=te,n.Canvas=ba,n.Circle=zr,n.CircleMarker=on,n.Class=Rt,n.Control=Ut,n.DivIcon=_a,n.DivOverlay=Qt,n.DomEvent=rc,n.DomUtil=ic,n.Draggable=ue,n.Evented=_e,n.FeatureGroup=ee,n.GeoJSON=ne,n.GridLayer=bi,n.Handler=Kt,n.Icon=je,n.ImageOverlay=hn,n.LatLng=tt,n.LatLngBounds=Pt,n.Layer=Ht,n.LayerGroup=Ve,n.LineUtil=_c,n.Map=W,n.Marker=rn,n.Mixin=cc,n.Path=he,n.Point=F,n.PolyUtil=dc,n.Polygon=Ue,n.Polyline=ie,n.Popup=cn,n.PosAnimation=Jo,n.Projection=vc,n.Rectangle=La,n.Renderer=re,n.SVG=xi,n.SVGOverlay=ga,n.TileLayer=We,n.Tooltip=dn,n.Transformation=lr,n.Util=zt,n.VideoOverlay=pa,n.bind=s,n.bounds=vt,n.canvas=wa,n.circle=Cc,n.circleMarker=Mc,n.control=_i,n.divIcon=Nc,n.extend=o,n.featureGroup=xc,n.geoJSON=ma,n.geoJson=Tc,n.gridLayer=zc,n.icon=Lc,n.imageOverlay=Pc,n.latLng=H,n.latLngBounds=ut,n.layerGroup=wc,n.map=oc,n.marker=Ec,n.point=G,n.polygon=kc,n.polyline=Sc,n.popup=Dc,n.rectangle=Zc,n.setOptions=y,n.stamp=c,n.svg=xa,n.svgOverlay=Ic,n.tileLayer=va,n.tooltip=Ac,n.transformation=ui,n.version=e,n.videoOverlay=Oc;var Gc=window.L;n.noConflict=function(){return window.L=Gc,this},window.L=n})});var nl=Gr((On,il)=>{"use strict";(function(n,e){typeof On=="object"&&typeof il<"u"?e(On):typeof define=="function"&&define.amd?define(["exports"],e):(n=n||self,e((n.Leaflet=n.Leaflet||{},n.Leaflet.markercluster={})))})(On,function(n){"use strict";var e=L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,clusterPane:L.Marker.prototype.options.pane,spiderfyOnEveryZoom:!1,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,removeOutsideVisibleBounds:!0,animate:!0,animateAddingMarkers:!1,spiderfyShapePositions:null,spiderfyDistanceMultiplier:1,spiderLegPolylineOptions:{weight:1.5,color:"#222",opacity:.5},chunkedLoading:!1,chunkInterval:200,chunkDelay:50,chunkProgress:null,polygonOptions:{}},initialize:function(r){L.Util.setOptions(this,r),this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction),this._featureGroup=L.featureGroup(),this._featureGroup.addEventParent(this),this._nonPointGroup=L.featureGroup(),this._nonPointGroup.addEventParent(this),this._inZoomAnimation=0,this._needsClustering=[],this._needsRemoving=[],this._currentShownBounds=null,this._queue=[],this._childMarkerEventHandlers={dragstart:this._childMarkerDragStart,move:this._childMarkerMoved,dragend:this._childMarkerDragEnd};var s=L.DomUtil.TRANSITION&&this.options.animate;L.extend(this,s?this._withAnimation:this._noAnimation),this._markerCluster=s?L.MarkerCluster:L.MarkerClusterNonAnimated},addLayer:function(r){if(r instanceof L.LayerGroup)return this.addLayers([r]);if(!r.getLatLng)return this._nonPointGroup.addLayer(r),this.fire("layeradd",{layer:r}),this;if(!this._map)return this._needsClustering.push(r),this.fire("layeradd",{layer:r}),this;if(this.hasLayer(r))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(r,this._maxZoom),this.fire("layeradd",{layer:r}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons();var s=r,h=this._zoom;if(r.__parent)for(;s.__parent._zoom>=h;)s=s.__parent;return this._currentShownBounds.contains(s.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(r,s):this._animationAddLayerNonAnimated(r,s)),this},removeLayer:function(r){return r instanceof L.LayerGroup?this.removeLayers([r]):r.getLatLng?this._map?r.__parent?(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(r)),this._removeLayer(r,!0),this.fire("layerremove",{layer:r}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),r.off(this._childMarkerEventHandlers,this),this._featureGroup.hasLayer(r)&&(this._featureGroup.removeLayer(r),r.clusterShow&&r.clusterShow()),this):this:(!this._arraySplice(this._needsClustering,r)&&this.hasLayer(r)&&this._needsRemoving.push({layer:r,latlng:r._latlng}),this.fire("layerremove",{layer:r}),this):(this._nonPointGroup.removeLayer(r),this.fire("layerremove",{layer:r}),this)},addLayers:function(r,s){if(!L.Util.isArray(r))return this.addLayer(r);var h=this._featureGroup,c=this._nonPointGroup,f=this.options.chunkedLoading,_=this.options.chunkInterval,g=this.options.chunkProgress,l=r.length,m=0,v=!0,y;if(this._map){var M=new Date().getTime(),x=L.bind(function(){var k=new Date().getTime();for(this._map&&this._unspiderfy&&this._unspiderfy();m<l;m++){if(f&&m%200===0){var P=new Date().getTime()-k;if(P>_)break}if(y=r[m],y instanceof L.LayerGroup){v&&(r=r.slice(),v=!1),this._extractNonGroupLayers(y,r),l=r.length;continue}if(!y.getLatLng){c.addLayer(y),s||this.fire("layeradd",{layer:y});continue}if(!this.hasLayer(y)&&(this._addLayer(y,this._maxZoom),s||this.fire("layeradd",{layer:y}),y.__parent&&y.__parent.getChildCount()===2)){var A=y.__parent.getAllChildMarkers(),S=A[0]===y?A[1]:A[0];h.removeLayer(S)}}g&&g(m,l,new Date().getTime()-M),m===l?(this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)):setTimeout(x,this.options.chunkDelay)},this);x()}else for(var C=this._needsClustering;m<l;m++){if(y=r[m],y instanceof L.LayerGroup){v&&(r=r.slice(),v=!1),this._extractNonGroupLayers(y,r),l=r.length;continue}if(!y.getLatLng){c.addLayer(y);continue}this.hasLayer(y)||C.push(y)}return this},removeLayers:function(r){var s,h,c=r.length,f=this._featureGroup,_=this._nonPointGroup,g=!0;if(!this._map){for(s=0;s<c;s++){if(h=r[s],h instanceof L.LayerGroup){g&&(r=r.slice(),g=!1),this._extractNonGroupLayers(h,r),c=r.length;continue}this._arraySplice(this._needsClustering,h),_.removeLayer(h),this.hasLayer(h)&&this._needsRemoving.push({layer:h,latlng:h._latlng}),this.fire("layerremove",{layer:h})}return this}if(this._unspiderfy){this._unspiderfy();var l=r.slice(),m=c;for(s=0;s<m;s++){if(h=l[s],h instanceof L.LayerGroup){this._extractNonGroupLayers(h,l),m=l.length;continue}this._unspiderfyLayer(h)}}for(s=0;s<c;s++){if(h=r[s],h instanceof L.LayerGroup){g&&(r=r.slice(),g=!1),this._extractNonGroupLayers(h,r),c=r.length;continue}if(!h.__parent){_.removeLayer(h),this.fire("layerremove",{layer:h});continue}this._removeLayer(h,!0,!0),this.fire("layerremove",{layer:h}),f.hasLayer(h)&&(f.removeLayer(h),h.clusterShow&&h.clusterShow())}return this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),this},clearLayers:function(){return this._map||(this._needsClustering=[],this._needsRemoving=[],delete this._gridClusters,delete this._gridUnclustered),this._noanimationUnspiderfy&&this._noanimationUnspiderfy(),this._featureGroup.clearLayers(),this._nonPointGroup.clearLayers(),this.eachLayer(function(r){r.off(this._childMarkerEventHandlers,this),delete r.__parent},this),this._map&&this._generateInitialClusters(),this},getBounds:function(){var r=new L.LatLngBounds;this._topClusterLevel&&r.extend(this._topClusterLevel._bounds);for(var s=this._needsClustering.length-1;s>=0;s--)r.extend(this._needsClustering[s].getLatLng());return r.extend(this._nonPointGroup.getBounds()),r},eachLayer:function(r,s){var h=this._needsClustering.slice(),c=this._needsRemoving,f,_,g;for(this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(h),_=h.length-1;_>=0;_--){for(f=!0,g=c.length-1;g>=0;g--)if(c[g].layer===h[_]){f=!1;break}f&&r.call(s,h[_])}this._nonPointGroup.eachLayer(r,s)},getLayers:function(){var r=[];return this.eachLayer(function(s){r.push(s)}),r},getLayer:function(r){var s=null;return r=parseInt(r,10),this.eachLayer(function(h){L.stamp(h)===r&&(s=h)}),s},hasLayer:function(r){if(!r)return!1;var s,h=this._needsClustering;for(s=h.length-1;s>=0;s--)if(h[s]===r)return!0;for(h=this._needsRemoving,s=h.length-1;s>=0;s--)if(h[s].layer===r)return!1;return!!(r.__parent&&r.__parent._group===this)||this._nonPointGroup.hasLayer(r)},zoomToShowLayer:function(r,s){var h=this._map;typeof s!="function"&&(s=function(){});var c=function(){(h.hasLayer(r)||h.hasLayer(r.__parent))&&!this._inZoomAnimation&&(this._map.off("moveend",c,this),this.off("animationend",c,this),h.hasLayer(r)?s():r.__parent._icon&&(this.once("spiderfied",s,this),r.__parent.spiderfy()))};r._icon&&this._map.getBounds().contains(r.getLatLng())?s():r.__parent._zoom<Math.round(this._map._zoom)?(this._map.on("moveend",c,this),this._map.panTo(r.getLatLng())):(this._map.on("moveend",c,this),this.on("animationend",c,this),r.__parent.zoomToBounds())},onAdd:function(r){this._map=r;var s,h,c;if(!isFinite(this._map.getMaxZoom()))throw"Map has no maxZoom specified";for(this._featureGroup.addTo(r),this._nonPointGroup.addTo(r),this._gridClusters||this._generateInitialClusters(),this._maxLat=r.options.crs.projection.MAX_LATITUDE,s=0,h=this._needsRemoving.length;s<h;s++)c=this._needsRemoving[s],c.newlatlng=c.layer._latlng,c.layer._latlng=c.latlng;for(s=0,h=this._needsRemoving.length;s<h;s++)c=this._needsRemoving[s],this._removeLayer(c.layer,!0),c.layer._latlng=c.newlatlng;this._needsRemoving=[],this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds(),this._map.on("zoomend",this._zoomEnd,this),this._map.on("moveend",this._moveEnd,this),this._spiderfierOnAdd&&this._spiderfierOnAdd(),this._bindEvents(),h=this._needsClustering,this._needsClustering=[],this.addLayers(h,!0)},onRemove:function(r){r.off("zoomend",this._zoomEnd,this),r.off("moveend",this._moveEnd,this),this._unbindEvents(),this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim",""),this._spiderfierOnRemove&&this._spiderfierOnRemove(),delete this._maxLat,this._hideCoverage(),this._featureGroup.remove(),this._nonPointGroup.remove(),this._featureGroup.clearLayers(),this._map=null},getVisibleParent:function(r){for(var s=r;s&&!s._icon;)s=s.__parent;return s||null},_arraySplice:function(r,s){for(var h=r.length-1;h>=0;h--)if(r[h]===s)return r.splice(h,1),!0},_removeFromGridUnclustered:function(r,s){for(var h=this._map,c=this._gridUnclustered,f=Math.floor(this._map.getMinZoom());s>=f&&c[s].removeObject(r,h.project(r.getLatLng(),s));s--);},_childMarkerDragStart:function(r){r.target.__dragStart=r.target._latlng},_childMarkerMoved:function(r){if(!this._ignoreMove&&!r.target.__dragStart){var s=r.target._popup&&r.target._popup.isOpen();this._moveChild(r.target,r.oldLatLng,r.latlng),s&&r.target.openPopup()}},_moveChild:function(r,s,h){r._latlng=s,this.removeLayer(r),r._latlng=h,this.addLayer(r)},_childMarkerDragEnd:function(r){var s=r.target.__dragStart;delete r.target.__dragStart,s&&this._moveChild(r.target,s,r.target._latlng)},_removeLayer:function(r,s,h){var c=this._gridClusters,f=this._gridUnclustered,_=this._featureGroup,g=this._map,l=Math.floor(this._map.getMinZoom());s&&this._removeFromGridUnclustered(r,this._maxZoom);var m=r.__parent,v=m._markers,y;for(this._arraySplice(v,r);m&&(m._childCount--,m._boundsNeedUpdate=!0,!(m._zoom<l));)s&&m._childCount<=1?(y=m._markers[0]===r?m._markers[1]:m._markers[0],c[m._zoom].removeObject(m,g.project(m._cLatLng,m._zoom)),f[m._zoom].addObject(y,g.project(y.getLatLng(),m._zoom)),this._arraySplice(m.__parent._childClusters,m),m.__parent._markers.push(y),y.__parent=m.__parent,m._icon&&(_.removeLayer(m),h||_.addLayer(y))):m._iconNeedsUpdate=!0,m=m.__parent;delete r.__parent},_isOrIsParent:function(r,s){for(;s;){if(r===s)return!0;s=s.parentNode}return!1},fire:function(r,s,h){if(s&&s.layer instanceof L.MarkerCluster){if(s.originalEvent&&this._isOrIsParent(s.layer._icon,s.originalEvent.relatedTarget))return;r="cluster"+r}L.FeatureGroup.prototype.fire.call(this,r,s,h)},listens:function(r,s){return L.FeatureGroup.prototype.listens.call(this,r,s)||L.FeatureGroup.prototype.listens.call(this,"cluster"+r,s)},_defaultIconCreateFunction:function(r){var s=r.getChildCount(),h=" marker-cluster-";return s<10?h+="small":s<100?h+="medium":h+="large",new L.DivIcon({html:"<div><span>"+s+"</span></div>",className:"marker-cluster"+h,iconSize:new L.Point(40,40)})},_bindEvents:function(){var r=this._map,s=this.options.spiderfyOnMaxZoom,h=this.options.showCoverageOnHover,c=this.options.zoomToBoundsOnClick,f=this.options.spiderfyOnEveryZoom;(s||c||f)&&this.on("clusterclick clusterkeypress",this._zoomOrSpiderfy,this),h&&(this.on("clustermouseover",this._showCoverage,this),this.on("clustermouseout",this._hideCoverage,this),r.on("zoomend",this._hideCoverage,this))},_zoomOrSpiderfy:function(r){var s=r.layer,h=s;if(!(r.type==="clusterkeypress"&&r.originalEvent&&r.originalEvent.keyCode!==13)){for(;h._childClusters.length===1;)h=h._childClusters[0];h._zoom===this._maxZoom&&h._childCount===s._childCount&&this.options.spiderfyOnMaxZoom?s.spiderfy():this.options.zoomToBoundsOnClick&&s.zoomToBounds(),this.options.spiderfyOnEveryZoom&&s.spiderfy(),r.originalEvent&&r.originalEvent.keyCode===13&&this._map._container.focus()}},_showCoverage:function(r){var s=this._map;this._inZoomAnimation||(this._shownPolygon&&s.removeLayer(this._shownPolygon),r.layer.getChildCount()>2&&r.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(r.layer.getConvexHull(),this.options.polygonOptions),s.addLayer(this._shownPolygon)))},_hideCoverage:function(){this._shownPolygon&&(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_unbindEvents:function(){var r=this.options.spiderfyOnMaxZoom,s=this.options.showCoverageOnHover,h=this.options.zoomToBoundsOnClick,c=this.options.spiderfyOnEveryZoom,f=this._map;(r||h||c)&&this.off("clusterclick clusterkeypress",this._zoomOrSpiderfy,this),s&&(this.off("clustermouseover",this._showCoverage,this),this.off("clustermouseout",this._hideCoverage,this),f.off("zoomend",this._hideCoverage,this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var r=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,r),this._topClusterLevel._recursivelyAddChildrenToMap(null,Math.round(this._map._zoom),r),this._currentShownBounds=r}},_generateInitialClusters:function(){var r=Math.ceil(this._map.getMaxZoom()),s=Math.floor(this._map.getMinZoom()),h=this.options.maxClusterRadius,c=h;typeof h!="function"&&(c=function(){return h}),this.options.disableClusteringAtZoom!==null&&(r=this.options.disableClusteringAtZoom-1),this._maxZoom=r,this._gridClusters={},this._gridUnclustered={};for(var f=r;f>=s;f--)this._gridClusters[f]=new L.DistanceGrid(c(f)),this._gridUnclustered[f]=new L.DistanceGrid(c(f));this._topClusterLevel=new this._markerCluster(this,s-1)},_addLayer:function(r,s){var h=this._gridClusters,c=this._gridUnclustered,f=Math.floor(this._map.getMinZoom()),_,g;for(this.options.singleMarkerMode&&this._overrideMarkerIcon(r),r.on(this._childMarkerEventHandlers,this);s>=f;s--){_=this._map.project(r.getLatLng(),s);var l=h[s].getNearObject(_);if(l){l._addChild(r),r.__parent=l;return}if(l=c[s].getNearObject(_),l){var m=l.__parent;m&&this._removeLayer(l,!1);var v=new this._markerCluster(this,s,l,r);h[s].addObject(v,this._map.project(v._cLatLng,s)),l.__parent=v,r.__parent=v;var y=v;for(g=s-1;g>m._zoom;g--)y=new this._markerCluster(this,g,y),h[g].addObject(y,this._map.project(l.getLatLng(),g));m._addChild(y),this._removeFromGridUnclustered(l,s);return}c[s].addObject(r,_)}this._topClusterLevel._addChild(r),r.__parent=this._topClusterLevel},_refreshClustersIcons:function(){this._featureGroup.eachLayer(function(r){r instanceof L.MarkerCluster&&r._iconNeedsUpdate&&r._updateIcon()})},_enqueue:function(r){this._queue.push(r),this._queueTimeout||(this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300))},_processQueue:function(){for(var r=0;r<this._queue.length;r++)this._queue[r].call(this);this._queue.length=0,clearTimeout(this._queueTimeout),this._queueTimeout=null},_mergeSplitClusters:function(){var r=Math.round(this._map._zoom);this._processQueue(),this._zoom<r&&this._currentShownBounds.intersects(this._getExpandedVisibleBounds())?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,r)):this._zoom>r?(this._animationStart(),this._animationZoomOut(this._zoom,r)):this._moveEnd()},_getExpandedVisibleBounds:function(){if(this.options.removeOutsideVisibleBounds){if(L.Browser.mobile)return this._checkBoundsMaxLat(this._map.getBounds())}else return this._mapBoundsInfinite;return this._checkBoundsMaxLat(this._map.getBounds().pad(1))},_checkBoundsMaxLat:function(r){var s=this._maxLat;return s!==void 0&&(r.getNorth()>=s&&(r._northEast.lat=1/0),r.getSouth()<=-s&&(r._southWest.lat=-1/0)),r},_animationAddLayerNonAnimated:function(r,s){if(s===r)this._featureGroup.addLayer(r);else if(s._childCount===2){s._addToMap();var h=s.getAllChildMarkers();this._featureGroup.removeLayer(h[0]),this._featureGroup.removeLayer(h[1])}else s._updateIcon()},_extractNonGroupLayers:function(r,s){var h=r.getLayers(),c=0,f;for(s=s||[];c<h.length;c++){if(f=h[c],f instanceof L.LayerGroup){this._extractNonGroupLayers(f,s);continue}s.push(f)}return s},_overrideMarkerIcon:function(r){var s=r.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[r]}});return s}});L.MarkerClusterGroup.include({_mapBoundsInfinite:new L.LatLngBounds(new L.LatLng(-1/0,-1/0),new L.LatLng(1/0,1/0))}),L.MarkerClusterGroup.include({_noAnimation:{_animationStart:function(){},_animationZoomIn:function(r,s){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),r),this._topClusterLevel._recursivelyAddChildrenToMap(null,s,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationZoomOut:function(r,s){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),r),this._topClusterLevel._recursivelyAddChildrenToMap(null,s,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationAddLayer:function(r,s){this._animationAddLayerNonAnimated(r,s)}},_withAnimation:{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim",this._inZoomAnimation++},_animationZoomIn:function(r,s){var h=this._getExpandedVisibleBounds(),c=this._featureGroup,f=Math.floor(this._map.getMinZoom()),_;this._ignoreMove=!0,this._topClusterLevel._recursively(h,r,f,function(g){var l=g._latlng,m=g._markers,v;for(h.contains(l)||(l=null),g._isSingleParent()&&r+1===s?(c.removeLayer(g),g._recursivelyAddChildrenToMap(null,s,h)):(g.clusterHide(),g._recursivelyAddChildrenToMap(l,s,h)),_=m.length-1;_>=0;_--)v=m[_],h.contains(v._latlng)||c.removeLayer(v)}),this._forceLayout(),this._topClusterLevel._recursivelyBecomeVisible(h,s),c.eachLayer(function(g){!(g instanceof L.MarkerCluster)&&g._icon&&g.clusterShow()}),this._topClusterLevel._recursively(h,r,s,function(g){g._recursivelyRestoreChildPositions(s)}),this._ignoreMove=!1,this._enqueue(function(){this._topClusterLevel._recursively(h,r,f,function(g){c.removeLayer(g),g.clusterShow()}),this._animationEnd()})},_animationZoomOut:function(r,s){this._animationZoomOutSingle(this._topClusterLevel,r-1,s),this._topClusterLevel._recursivelyAddChildrenToMap(null,s,this._getExpandedVisibleBounds()),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),r,this._getExpandedVisibleBounds())},_animationAddLayer:function(r,s){var h=this,c=this._featureGroup;c.addLayer(r),s!==r&&(s._childCount>2?(s._updateIcon(),this._forceLayout(),this._animationStart(),r._setPos(this._map.latLngToLayerPoint(s.getLatLng())),r.clusterHide(),this._enqueue(function(){c.removeLayer(r),r.clusterShow(),h._animationEnd()})):(this._forceLayout(),h._animationStart(),h._animationZoomOutSingle(s,this._map.getMaxZoom(),this._zoom)))}},_animationZoomOutSingle:function(r,s,h){var c=this._getExpandedVisibleBounds(),f=Math.floor(this._map.getMinZoom());r._recursivelyAnimateChildrenInAndAddSelfToMap(c,f,s+1,h);var _=this;this._forceLayout(),r._recursivelyBecomeVisible(c,h),this._enqueue(function(){if(r._childCount===1){var g=r._markers[0];this._ignoreMove=!0,g.setLatLng(g.getLatLng()),this._ignoreMove=!1,g.clusterShow&&g.clusterShow()}else r._recursively(c,h,f,function(l){l._recursivelyRemoveChildrenFromMap(c,f,s+1)});_._animationEnd()})},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")),this._inZoomAnimation--,this.fire("animationend")},_forceLayout:function(){L.Util.falseFn(document.body.offsetWidth)}}),L.markerClusterGroup=function(r){return new L.MarkerClusterGroup(r)};var o=L.MarkerCluster=L.Marker.extend({options:L.Icon.prototype.options,initialize:function(r,s,h,c){L.Marker.prototype.initialize.call(this,h?h._cLatLng||h.getLatLng():new L.LatLng(0,0),{icon:this,pane:r.options.clusterPane}),this._group=r,this._zoom=s,this._markers=[],this._childClusters=[],this._childCount=0,this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._bounds=new L.LatLngBounds,h&&this._addChild(h),c&&this._addChild(c)},getAllChildMarkers:function(r,s){r=r||[];for(var h=this._childClusters.length-1;h>=0;h--)this._childClusters[h].getAllChildMarkers(r,s);for(var c=this._markers.length-1;c>=0;c--)s&&this._markers[c].__dragStart||r.push(this._markers[c]);return r},getChildCount:function(){return this._childCount},zoomToBounds:function(r){for(var s=this._childClusters.slice(),h=this._group._map,c=h.getBoundsZoom(this._bounds),f=this._zoom+1,_=h.getZoom(),g;s.length>0&&c>f;){f++;var l=[];for(g=0;g<s.length;g++)l=l.concat(s[g]._childClusters);s=l}c>f?this._group._map.setView(this._latlng,f):c<=_?this._group._map.setView(this._latlng,_+1):this._group._map.fitBounds(this._bounds,r)},getBounds:function(){var r=new L.LatLngBounds;return r.extend(this._bounds),r},_updateIcon:function(){this._iconNeedsUpdate=!0,this._icon&&this.setIcon(this)},createIcon:function(){return this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1),this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(r,s){this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._setClusterCenter(r),r instanceof L.MarkerCluster?(s||(this._childClusters.push(r),r.__parent=this),this._childCount+=r._childCount):(s||this._markers.push(r),this._childCount++),this.__parent&&this.__parent._addChild(r,!0)},_setClusterCenter:function(r){this._cLatLng||(this._cLatLng=r._cLatLng||r._latlng)},_resetBounds:function(){var r=this._bounds;r._southWest&&(r._southWest.lat=1/0,r._southWest.lng=1/0),r._northEast&&(r._northEast.lat=-1/0,r._northEast.lng=-1/0)},_recalculateBounds:function(){var r=this._markers,s=this._childClusters,h=0,c=0,f=this._childCount,_,g,l,m;if(f!==0){for(this._resetBounds(),_=0;_<r.length;_++)l=r[_]._latlng,this._bounds.extend(l),h+=l.lat,c+=l.lng;for(_=0;_<s.length;_++)g=s[_],g._boundsNeedUpdate&&g._recalculateBounds(),this._bounds.extend(g._bounds),l=g._wLatLng,m=g._childCount,h+=l.lat*m,c+=l.lng*m;this._latlng=this._wLatLng=new L.LatLng(h/f,c/f),this._boundsNeedUpdate=!1}},_addToMap:function(r){r&&(this._backupLatlng=this._latlng,this.setLatLng(r)),this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(r,s,h){this._recursively(r,this._group._map.getMinZoom(),h-1,function(c){var f=c._markers,_,g;for(_=f.length-1;_>=0;_--)g=f[_],g._icon&&(g._setPos(s),g.clusterHide())},function(c){var f=c._childClusters,_,g;for(_=f.length-1;_>=0;_--)g=f[_],g._icon&&(g._setPos(s),g.clusterHide())})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(r,s,h,c){this._recursively(r,c,s,function(f){f._recursivelyAnimateChildrenIn(r,f._group._map.latLngToLayerPoint(f.getLatLng()).round(),h),f._isSingleParent()&&h-1===c?(f.clusterShow(),f._recursivelyRemoveChildrenFromMap(r,s,h)):f.clusterHide(),f._addToMap()})},_recursivelyBecomeVisible:function(r,s){this._recursively(r,this._group._map.getMinZoom(),s,null,function(h){h.clusterShow()})},_recursivelyAddChildrenToMap:function(r,s,h){this._recursively(h,this._group._map.getMinZoom()-1,s,function(c){if(s!==c._zoom)for(var f=c._markers.length-1;f>=0;f--){var _=c._markers[f];h.contains(_._latlng)&&(r&&(_._backupLatlng=_.getLatLng(),_.setLatLng(r),_.clusterHide&&_.clusterHide()),c._group._featureGroup.addLayer(_))}},function(c){c._addToMap(r)})},_recursivelyRestoreChildPositions:function(r){for(var s=this._markers.length-1;s>=0;s--){var h=this._markers[s];h._backupLatlng&&(h.setLatLng(h._backupLatlng),delete h._backupLatlng)}if(r-1===this._zoom)for(var c=this._childClusters.length-1;c>=0;c--)this._childClusters[c]._restorePosition();else for(var f=this._childClusters.length-1;f>=0;f--)this._childClusters[f]._recursivelyRestoreChildPositions(r)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(r,s,h,c){var f,_;this._recursively(r,s-1,h-1,function(g){for(_=g._markers.length-1;_>=0;_--)f=g._markers[_],(!c||!c.contains(f._latlng))&&(g._group._featureGroup.removeLayer(f),f.clusterShow&&f.clusterShow())},function(g){for(_=g._childClusters.length-1;_>=0;_--)f=g._childClusters[_],(!c||!c.contains(f._latlng))&&(g._group._featureGroup.removeLayer(f),f.clusterShow&&f.clusterShow())})},_recursively:function(r,s,h,c,f){var _=this._childClusters,g=this._zoom,l,m;if(s<=g&&(c&&c(this),f&&g===h&&f(this)),g<s||g<h)for(l=_.length-1;l>=0;l--)m=_[l],m._boundsNeedUpdate&&m._recalculateBounds(),r.intersects(m._bounds)&&m._recursively(r,s,h,c,f)},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount}});L.Marker.include({clusterHide:function(){var r=this.options.opacity;return this.setOpacity(0),this.options.opacity=r,this},clusterShow:function(){return this.setOpacity(this.options.opacity)}}),L.DistanceGrid=function(r){this._cellSize=r,this._sqCellSize=r*r,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(r,s){var h=this._getCoord(s.x),c=this._getCoord(s.y),f=this._grid,_=f[c]=f[c]||{},g=_[h]=_[h]||[],l=L.Util.stamp(r);this._objectPoint[l]=s,g.push(r)},updateObject:function(r,s){this.removeObject(r),this.addObject(r,s)},removeObject:function(r,s){var h=this._getCoord(s.x),c=this._getCoord(s.y),f=this._grid,_=f[c]=f[c]||{},g=_[h]=_[h]||[],l,m;for(delete this._objectPoint[L.Util.stamp(r)],l=0,m=g.length;l<m;l++)if(g[l]===r)return g.splice(l,1),m===1&&delete _[h],!0},eachObject:function(r,s){var h,c,f,_,g,l,m,v=this._grid;for(h in v){g=v[h];for(c in g)for(l=g[c],f=0,_=l.length;f<_;f++)m=r.call(s,l[f]),m&&(f--,_--)}},getNearObject:function(r){var s=this._getCoord(r.x),h=this._getCoord(r.y),c,f,_,g,l,m,v,y,M=this._objectPoint,x=this._sqCellSize,C=null;for(c=h-1;c<=h+1;c++)if(g=this._grid[c],g){for(f=s-1;f<=s+1;f++)if(l=g[f],l)for(_=0,m=l.length;_<m;_++)v=l[_],y=this._sqDist(M[L.Util.stamp(v)],r),(y<x||y<=x&&C===null)&&(x=y,C=v)}return C},_getCoord:function(r){var s=Math.floor(r/this._cellSize);return isFinite(s)?s:r},_sqDist:function(r,s){var h=s.x-r.x,c=s.y-r.y;return h*h+c*c}},function(){L.QuickHull={getDistant:function(r,s){var h=s[1].lat-s[0].lat,c=s[0].lng-s[1].lng;return c*(r.lat-s[0].lat)+h*(r.lng-s[0].lng)},findMostDistantPointFromBaseLine:function(r,s){var h=0,c=null,f=[],_,g,l;for(_=s.length-1;_>=0;_--){if(g=s[_],l=this.getDistant(g,r),l>0)f.push(g);else continue;l>h&&(h=l,c=g)}return{maxPoint:c,newPoints:f}},buildConvexHull:function(r,s){var h=[],c=this.findMostDistantPointFromBaseLine(r,s);return c.maxPoint?(h=h.concat(this.buildConvexHull([r[0],c.maxPoint],c.newPoints)),h=h.concat(this.buildConvexHull([c.maxPoint,r[1]],c.newPoints)),h):[r[0]]},getConvexHull:function(r){var s=!1,h=!1,c=!1,f=!1,_=null,g=null,l=null,m=null,v=null,y=null,M;for(M=r.length-1;M>=0;M--){var x=r[M];(s===!1||x.lat>s)&&(_=x,s=x.lat),(h===!1||x.lat<h)&&(g=x,h=x.lat),(c===!1||x.lng>c)&&(l=x,c=x.lng),(f===!1||x.lng<f)&&(m=x,f=x.lng)}h!==s?(y=g,v=_):(y=m,v=l);var C=[].concat(this.buildConvexHull([y,v],r),this.buildConvexHull([v,y],r));return C}}}(),L.MarkerCluster.include({getConvexHull:function(){var r=this.getAllChildMarkers(),s=[],h,c;for(c=r.length-1;c>=0;c--)h=r[c].getLatLng(),s.push(h);return L.QuickHull.getConvexHull(s)}}),L.MarkerCluster.include({_2PI:Math.PI*2,_circleFootSeparation:25,_circleStartAngle:0,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(!(this._group._spiderfied===this||this._group._inZoomAnimation)){var r=this.getAllChildMarkers(null,!0),s=this._group,h=s._map,c=h.latLngToLayerPoint(this._latlng),f;this._group._unspiderfy(),this._group._spiderfied=this,this._group.options.spiderfyShapePositions?f=this._group.options.spiderfyShapePositions(r.length,c):r.length>=this._circleSpiralSwitchover?f=this._generatePointsSpiral(r.length,c):(c.y+=10,f=this._generatePointsCircle(r.length,c)),this._animationSpiderfy(r,f)}},unspiderfy:function(r){this._group._inZoomAnimation||(this._animationUnspiderfy(r),this._group._spiderfied=null)},_generatePointsCircle:function(r,s){var h=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+r),c=h/this._2PI,f=this._2PI/r,_=[],g,l;for(c=Math.max(c,35),_.length=r,g=0;g<r;g++)l=this._circleStartAngle+g*f,_[g]=new L.Point(s.x+c*Math.cos(l),s.y+c*Math.sin(l))._round();return _},_generatePointsSpiral:function(r,s){var h=this._group.options.spiderfyDistanceMultiplier,c=h*this._spiralLengthStart,f=h*this._spiralFootSeparation,_=h*this._spiralLengthFactor*this._2PI,g=0,l=[],m;for(l.length=r,m=r;m>=0;m--)m<r&&(l[m]=new L.Point(s.x+c*Math.cos(g),s.y+c*Math.sin(g))._round()),g+=f/c+m*5e-4,c+=_/g;return l},_noanimationUnspiderfy:function(){var r=this._group,s=r._map,h=r._featureGroup,c=this.getAllChildMarkers(null,!0),f,_;for(r._ignoreMove=!0,this.setOpacity(1),_=c.length-1;_>=0;_--)f=c[_],h.removeLayer(f),f._preSpiderfyLatlng&&(f.setLatLng(f._preSpiderfyLatlng),delete f._preSpiderfyLatlng),f.setZIndexOffset&&f.setZIndexOffset(0),f._spiderLeg&&(s.removeLayer(f._spiderLeg),delete f._spiderLeg);r.fire("unspiderfied",{cluster:this,markers:c}),r._ignoreMove=!1,r._spiderfied=null}}),L.MarkerClusterNonAnimated=L.MarkerCluster.extend({_animationSpiderfy:function(r,s){var h=this._group,c=h._map,f=h._featureGroup,_=this._group.options.spiderLegPolylineOptions,g,l,m,v;for(h._ignoreMove=!0,g=0;g<r.length;g++)v=c.layerPointToLatLng(s[g]),l=r[g],m=new L.Polyline([this._latlng,v],_),c.addLayer(m),l._spiderLeg=m,l._preSpiderfyLatlng=l._latlng,l.setLatLng(v),l.setZIndexOffset&&l.setZIndexOffset(1e6),f.addLayer(l);this.setOpacity(.3),h._ignoreMove=!1,h.fire("spiderfied",{cluster:this,markers:r})},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}}),L.MarkerCluster.include({_animationSpiderfy:function(r,s){var h=this,c=this._group,f=c._map,_=c._featureGroup,g=this._latlng,l=f.latLngToLayerPoint(g),m=L.Path.SVG,v=L.extend({},this._group.options.spiderLegPolylineOptions),y=v.opacity,M,x,C,k,P,A;for(y===void 0&&(y=L.MarkerClusterGroup.prototype.options.spiderLegPolylineOptions.opacity),m?(v.opacity=0,v.className=(v.className||"")+" leaflet-cluster-spider-leg"):v.opacity=y,c._ignoreMove=!0,M=0;M<r.length;M++)x=r[M],A=f.layerPointToLatLng(s[M]),C=new L.Polyline([g,A],v),f.addLayer(C),x._spiderLeg=C,m&&(k=C._path,P=k.getTotalLength()+.1,k.style.strokeDasharray=P,k.style.strokeDashoffset=P),x.setZIndexOffset&&x.setZIndexOffset(1e6),x.clusterHide&&x.clusterHide(),_.addLayer(x),x._setPos&&x._setPos(l);for(c._forceLayout(),c._animationStart(),M=r.length-1;M>=0;M--)A=f.layerPointToLatLng(s[M]),x=r[M],x._preSpiderfyLatlng=x._latlng,x.setLatLng(A),x.clusterShow&&x.clusterShow(),m&&(C=x._spiderLeg,k=C._path,k.style.strokeDashoffset=0,C.setStyle({opacity:y}));this.setOpacity(.3),c._ignoreMove=!1,setTimeout(function(){c._animationEnd(),c.fire("spiderfied",{cluster:h,markers:r})},200)},_animationUnspiderfy:function(r){var s=this,h=this._group,c=h._map,f=h._featureGroup,_=r?c._latLngToNewLayerPoint(this._latlng,r.zoom,r.center):c.latLngToLayerPoint(this._latlng),g=this.getAllChildMarkers(null,!0),l=L.Path.SVG,m,v,y,M,x,C;for(h._ignoreMove=!0,h._animationStart(),this.setOpacity(1),v=g.length-1;v>=0;v--)m=g[v],m._preSpiderfyLatlng&&(m.closePopup(),m.setLatLng(m._preSpiderfyLatlng),delete m._preSpiderfyLatlng,C=!0,m._setPos&&(m._setPos(_),C=!1),m.clusterHide&&(m.clusterHide(),C=!1),C&&f.removeLayer(m),l&&(y=m._spiderLeg,M=y._path,x=M.getTotalLength()+.1,M.style.strokeDashoffset=x,y.setStyle({opacity:0})));h._ignoreMove=!1,setTimeout(function(){var k=0;for(v=g.length-1;v>=0;v--)m=g[v],m._spiderLeg&&k++;for(v=g.length-1;v>=0;v--)m=g[v],m._spiderLeg&&(m.clusterShow&&m.clusterShow(),m.setZIndexOffset&&m.setZIndexOffset(0),k>1&&f.removeLayer(m),c.removeLayer(m._spiderLeg),delete m._spiderLeg);h._animationEnd(),h.fire("unspiderfied",{cluster:s,markers:g})},200)}}),L.MarkerClusterGroup.include({_spiderfied:null,unspiderfy:function(){this._unspiderfy.apply(this,arguments)},_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this),this._map.options.zoomAnimation&&this._map.on("zoomstart",this._unspiderfyZoomStart,this),this._map.on("zoomend",this._noanimationUnspiderfy,this),L.Browser.touch||this._map.getRenderer(this)},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this),this._map.off("zoomstart",this._unspiderfyZoomStart,this),this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._map.off("zoomend",this._noanimationUnspiderfy,this),this._noanimationUnspiderfy()},_unspiderfyZoomStart:function(){this._map&&this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(r){L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching")||(this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(r))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(r){this._spiderfied&&this._spiderfied.unspiderfy(r)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(r){r._spiderLeg&&(this._featureGroup.removeLayer(r),r.clusterShow&&r.clusterShow(),r.setZIndexOffset&&r.setZIndexOffset(0),this._map.removeLayer(r._spiderLeg),delete r._spiderLeg)}}),L.MarkerClusterGroup.include({refreshClusters:function(r){return r?r instanceof L.MarkerClusterGroup?r=r._topClusterLevel.getAllChildMarkers():r instanceof L.LayerGroup?r=r._layers:r instanceof L.MarkerCluster?r=r.getAllChildMarkers():r instanceof L.Marker&&(r=[r]):r=this._topClusterLevel.getAllChildMarkers(),this._flagParentsIconsNeedUpdate(r),this._refreshClustersIcons(),this.options.singleMarkerMode&&this._refreshSingleMarkerModeMarkers(r),this},_flagParentsIconsNeedUpdate:function(r){var s,h;for(s in r)for(h=r[s].__parent;h;)h._iconNeedsUpdate=!0,h=h.__parent},_refreshSingleMarkerModeMarkers:function(r){var s,h;for(s in r)h=r[s],this.hasLayer(h)&&h.setIcon(this._overrideMarkerIcon(h))}}),L.Marker.include({refreshIconOptions:function(r,s){var h=this.options.icon;return L.setOptions(h,r),this.setIcon(h),s&&this.__parent&&this.__parent._group.refreshClusters(this),this}}),n.MarkerClusterGroup=e,n.MarkerCluster=o,Object.defineProperty(n,"__esModule",{value:!0})})});var Lh=Gr((wh,xh)=>{"use strict";((n,e)=>{typeof define=="function"&&define.amd?define(["leaflet"],n):typeof wh=="object"&&(xh.exports=n(ki())),typeof e<"u"&&e.L&&n(e.L)})(n=>{n.Editable=n.Evented.extend({statics:{FORWARD:1,BACKWARD:-1},options:{zIndex:1e3,polygonClass:n.Polygon,polylineClass:n.Polyline,markerClass:n.Marker,circleMarkerClass:n.CircleMarker,rectangleClass:n.Rectangle,circleClass:n.Circle,drawingCSSClass:"leaflet-editable-drawing",drawingCursor:"crosshair",editLayer:void 0,featuresLayer:void 0,polylineEditorClass:void 0,polygonEditorClass:void 0,markerEditorClass:void 0,circleMarkerEditorClass:void 0,rectangleEditorClass:void 0,circleEditorClass:void 0,lineGuideOptions:{},skipMiddleMarkers:!1},initialize:function(l,m){n.setOptions(this,m),this._lastZIndex=this.options.zIndex,this.map=l,this.editLayer=this.createEditLayer(),this.featuresLayer=this.createFeaturesLayer(),this.forwardLineGuide=this.createLineGuide(),this.backwardLineGuide=this.createLineGuide()},fireAndForward:function(l,m){m=m||{},m.editTools=this,this.fire(l,m),this.map.fire(l,m)},createLineGuide:function(){let l=n.extend({dashArray:"5,10",weight:1,interactive:!1},this.options.lineGuideOptions);return n.polyline([],l)},createVertexIcon:l=>n.Browser.mobile&&n.Browser.touch?new n.Editable.TouchVertexIcon(l):new n.Editable.VertexIcon(l),createEditLayer:function(){return this.options.editLayer||new n.LayerGroup().addTo(this.map)},createFeaturesLayer:function(){return this.options.featuresLayer||new n.LayerGroup().addTo(this.map)},moveForwardLineGuide:function(l){this.forwardLineGuide._latlngs.length&&(this.forwardLineGuide._latlngs[1]=l,this.forwardLineGuide._bounds.extend(l),this.forwardLineGuide.redraw())},moveBackwardLineGuide:function(l){this.backwardLineGuide._latlngs.length&&(this.backwardLineGuide._latlngs[1]=l,this.backwardLineGuide._bounds.extend(l),this.backwardLineGuide.redraw())},anchorForwardLineGuide:function(l){this.forwardLineGuide._latlngs[0]=l,this.forwardLineGuide._bounds.extend(l),this.forwardLineGuide.redraw()},anchorBackwardLineGuide:function(l){this.backwardLineGuide._latlngs[0]=l,this.backwardLineGuide._bounds.extend(l),this.backwardLineGuide.redraw()},attachForwardLineGuide:function(){this.editLayer.addLayer(this.forwardLineGuide)},attachBackwardLineGuide:function(){this.editLayer.addLayer(this.backwardLineGuide)},detachForwardLineGuide:function(){this.forwardLineGuide.setLatLngs([]),this.editLayer.removeLayer(this.forwardLineGuide)},detachBackwardLineGuide:function(){this.backwardLineGuide.setLatLngs([]),this.editLayer.removeLayer(this.backwardLineGuide)},blockEvents:function(){this._oldTargets||(this._oldTargets=this.map._targets,this.map._targets={})},unblockEvents:function(){this._oldTargets&&(this.map._targets=n.extend(this.map._targets,this._oldTargets),delete this._oldTargets)},registerForDrawing:function(l){this._drawingEditor&&this.unregisterForDrawing(this._drawingEditor),this.blockEvents(),l.reset(),this._drawingEditor=l,this.map.on("mousemove touchmove",l.onDrawingMouseMove,l),this.map.on("mousedown",this.onMousedown,this),this.map.on("mouseup",this.onMouseup,this),n.DomUtil.addClass(this.map._container,this.options.drawingCSSClass),this.defaultMapCursor=this.map._container.style.cursor,this.map._container.style.cursor=this.options.drawingCursor},unregisterForDrawing:function(l){this.unblockEvents(),n.DomUtil.removeClass(this.map._container,this.options.drawingCSSClass),this.map._container.style.cursor=this.defaultMapCursor,l=l||this._drawingEditor,l&&(this.map.off("mousemove touchmove",l.onDrawingMouseMove,l),this.map.off("mousedown",this.onMousedown,this),this.map.off("mouseup",this.onMouseup,this),l===this._drawingEditor&&(delete this._drawingEditor,l._drawing&&l.cancelDrawing()))},onMousedown:function(l){l.originalEvent.which==1&&(this._mouseDown=l,this._drawingEditor.onDrawingMouseDown(l))},onMouseup:function(l){if(this._mouseDown){let m=this._drawingEditor,v=this._mouseDown;if(this._mouseDown=null,m.onDrawingMouseUp(l),this._drawingEditor!==m)return;let y=n.point(v.originalEvent.clientX,v.originalEvent.clientY),M=n.point(l.originalEvent.clientX,l.originalEvent.clientY).distanceTo(y);Math.abs(M)<9*(window.devicePixelRatio||1)&&this._drawingEditor.onDrawingClick(l)}},drawing:function(){return this._drawingEditor?.drawing()},stopDrawing:function(){this.unregisterForDrawing()},commitDrawing:function(l){this._drawingEditor&&this._drawingEditor.commitDrawing(l)},connectCreatedToMap:function(l){return this.featuresLayer.addLayer(l)},startPolyline:function(l,m){let v=this.createPolyline([],m);return v.enableEdit(this.map).newShape(l),v},startPolygon:function(l,m){let v=this.createPolygon([],m);return v.enableEdit(this.map).newShape(l),v},startMarker:function(l,m){l=l||this.map.getCenter().clone();let v=this.createMarker(l,m);return v.enableEdit(this.map).startDrawing(),v},startCircleMarker:function(l,m){l=l||this.map.getCenter().clone();let v=this.createCircleMarker(l,m);return v.enableEdit(this.map).startDrawing(),v},startRectangle:function(l,m){let v=l||n.latLng([0,0]),y=new n.LatLngBounds(v,v),M=this.createRectangle(y,m);return M.enableEdit(this.map).startDrawing(),M},startCircle:function(l,m){l=l||this.map.getCenter().clone();let v=this.createCircle(l,m);return v.enableEdit(this.map).startDrawing(),v},startHole:(l,m)=>{l.newHole(m)},createLayer:function(l,m,v){v=n.Util.extend({editOptions:{editTools:this}},v);let y=new l(m,v);return this.fireAndForward("editable:created",{layer:y}),y},createPolyline:function(l,m){return this.createLayer(m?.polylineClass||this.options.polylineClass,l,m)},createPolygon:function(l,m){return this.createLayer(m?.polygonClass||this.options.polygonClass,l,m)},createMarker:function(l,m){return this.createLayer(m?.markerClass||this.options.markerClass,l,m)},createCircleMarker:function(l,m){return this.createLayer(m?.circleMarkerClass||this.options.circleMarkerClass,l,m)},createRectangle:function(l,m){return this.createLayer(m?.rectangleClass||this.options.rectangleClass,l,m)},createCircle:function(l,m){return this.createLayer(m?.circleClass||this.options.circleClass,l,m)}}),n.extend(n.Editable,{makeCancellable:l=>{l.cancel=()=>{l._cancelled=!0}}}),n.Map.mergeOptions({editToolsClass:n.Editable,editable:!1,editOptions:{}}),n.Map.addInitHook(function(){this.whenReady(function(){this.options.editable&&(this.editTools=new this.options.editToolsClass(this,this.options.editOptions))})}),n.Editable.VertexIcon=n.DivIcon.extend({options:{iconSize:new n.Point(8,8)}}),n.Editable.TouchVertexIcon=n.Editable.VertexIcon.extend({options:{iconSize:new n.Point(20,20)}}),n.Editable.VertexMarker=n.Marker.extend({options:{draggable:!0,className:"leaflet-div-icon leaflet-vertex-icon"},initialize:function(l,m,v,y){this.latlng=l,this.latlngs=m,this.editor=v,n.Marker.prototype.initialize.call(this,l,y),this.options.icon=this.editor.tools.createVertexIcon({className:this.options.className}),this.latlng.__vertex=this,this.connect(),this.setZIndexOffset(v.tools._lastZIndex+1)},connect:function(){this.editor.editLayer.addLayer(this)},onAdd:function(l){n.Marker.prototype.onAdd.call(this,l),this.on("drag",this.onDrag),this.on("dragstart",this.onDragStart),this.on("dragend",this.onDragEnd),this.on("mouseup",this.onMouseup),this.on("click",this.onClick),this.on("contextmenu",this.onContextMenu),this.on("mousedown touchstart",this.onMouseDown),this.on("mouseover",this.onMouseOver),this.on("mouseout",this.onMouseOut),this.addMiddleMarkers()},onRemove:function(l){this.middleMarker&&this.middleMarker.delete(),delete this.latlng.__vertex,this.off("drag",this.onDrag),this.off("dragstart",this.onDragStart),this.off("dragend",this.onDragEnd),this.off("mouseup",this.onMouseup),this.off("click",this.onClick),this.off("contextmenu",this.onContextMenu),this.off("mousedown touchstart",this.onMouseDown),this.off("mouseover",this.onMouseOver),this.off("mouseout",this.onMouseOut),n.Marker.prototype.onRemove.call(this,l)},onDrag:function(l){l.vertex=this,this.editor.onVertexMarkerDrag(l);let m=n.DomUtil.getPosition(this._icon),v=this._map.layerPointToLatLng(m);this.latlng.update(v),this._latlng=this.latlng,this.editor.refresh(),this.middleMarker&&this.middleMarker.updateLatLng();let y=this.getNext();y?.middleMarker&&y.middleMarker.updateLatLng()},onDragStart:function(l){l.vertex=this,this.editor.onVertexMarkerDragStart(l)},onDragEnd:function(l){l.vertex=this,this.editor.onVertexMarkerDragEnd(l)},onClick:function(l){l.vertex=this,this.editor.onVertexMarkerClick(l)},onMouseup:function(l){n.DomEvent.stop(l),l.vertex=this,this.editor.map.fire("mouseup",l)},onContextMenu:function(l){l.vertex=this,this.editor.onVertexMarkerContextMenu(l)},onMouseDown:function(l){l.vertex=this,this.editor.onVertexMarkerMouseDown(l)},onMouseOver:function(l){l.vertex=this,this.editor.onVertexMarkerMouseOver(l)},onMouseOut:function(l){l.vertex=this,this.editor.onVertexMarkerMouseOut(l)},delete:function(){let l=this.getNext();this.latlngs.splice(this.getIndex(),1),this.editor.editLayer.removeLayer(this),this.editor.onVertexDeleted({latlng:this.latlng,vertex:this}),this.latlngs.length||this.editor.deleteShape(this.latlngs),l&&l.resetMiddleMarker(),this.editor.refresh()},getIndex:function(){return this.latlngs.indexOf(this.latlng)},getLastIndex:function(){return this.latlngs.length-1},getPrevious:function(){if(this.latlngs.length<2)return;let l=this.getIndex(),m=l-1;l===0&&this.editor.CLOSED&&(m=this.getLastIndex());let v=this.latlngs[m];if(v)return v.__vertex},getNext:function(){if(this.latlngs.length<2)return;let l=this.getIndex(),m=l+1;l===this.getLastIndex()&&this.editor.CLOSED&&(m=0);let v=this.latlngs[m];if(v)return v.__vertex},addMiddleMarker:function(l){this.editor.hasMiddleMarkers()&&(l=l||this.getPrevious(),l&&!this.middleMarker&&(this.middleMarker=this.editor.addMiddleMarker(l,this,this.latlngs,this.editor)))},addMiddleMarkers:function(){if(!this.editor.hasMiddleMarkers())return;let l=this.getPrevious();l&&this.addMiddleMarker(l);let m=this.getNext();m&&m.resetMiddleMarker()},resetMiddleMarker:function(){this.middleMarker&&this.middleMarker.delete(),this.addMiddleMarker()},split:function(){this.editor.splitShape&&this.editor.splitShape(this.latlngs,this.getIndex())},continue:function(){if(!this.editor.continueBackward)return;let l=this.getIndex();l===0?this.editor.continueBackward(this.latlngs):l===this.getLastIndex()&&this.editor.continueForward(this.latlngs)}}),n.Editable.mergeOptions({vertexMarkerClass:n.Editable.VertexMarker}),n.Editable.MiddleMarker=n.Marker.extend({options:{opacity:.5,className:"leaflet-div-icon leaflet-middle-icon",draggable:!0},initialize:function(l,m,v,y,M){this.left=l,this.right=m,this.editor=y,this.latlngs=v,n.Marker.prototype.initialize.call(this,this.computeLatLng(),M),this._opacity=this.options.opacity,this.options.icon=this.editor.tools.createVertexIcon({className:this.options.className}),this.editor.editLayer.addLayer(this),this.setVisibility()},setVisibility:function(){let l=this._map.latLngToContainerPoint(this.left.latlng),m=this._map.latLngToContainerPoint(this.right.latlng),v=n.point(this.options.icon.options.iconSize);l.distanceTo(m)<v.x*3?this.hide():this.show()},show:function(){this.setOpacity(this._opacity)},hide:function(){this.setOpacity(0)},updateLatLng:function(){this.setLatLng(this.computeLatLng()),this.setVisibility()},computeLatLng:function(){let l=this.editor.map.latLngToContainerPoint(this.left.latlng),m=this.editor.map.latLngToContainerPoint(this.right.latlng),v=(l.y+m.y)/2,y=(l.x+m.x)/2;return this.editor.map.containerPointToLatLng([y,v])},onAdd:function(l){n.Marker.prototype.onAdd.call(this,l),n.DomEvent.on(this._icon,"mousedown touchstart",this.onMouseDown,this),l.on("zoomend",this.setVisibility,this)},onRemove:function(l){delete this.right.middleMarker,n.DomEvent.off(this._icon,"mousedown touchstart",this.onMouseDown,this),l.off("zoomend",this.setVisibility,this),n.Marker.prototype.onRemove.call(this,l)},onMouseDown:function(l){let m=n.DomUtil.getPosition(this._icon),v=this.editor.map.layerPointToLatLng(m);if(l={originalEvent:l,latlng:v},this.options.opacity===0||(n.Editable.makeCancellable(l),this.editor.onMiddleMarkerMouseDown(l),l._cancelled))return;this.latlngs.splice(this.index(),0,l.latlng),this.editor.refresh();let y=this._icon,M=this.editor.addVertexMarker(l.latlng,this.latlngs);this.editor.onNewVertex(M);let x=M._icon.parentNode;x.removeChild(M._icon),M._icon=y,x.appendChild(M._icon),M._initIcon(),M._initInteraction(),M.setOpacity(1),n.Draggable._dragging=!1,M.dragging._draggable._onDown(l.originalEvent),this.delete()},delete:function(){this.editor.editLayer.removeLayer(this)},index:function(){return this.latlngs.indexOf(this.right.latlng)}}),n.Editable.mergeOptions({middleMarkerClass:n.Editable.MiddleMarker}),n.Editable.BaseEditor=n.Handler.extend({initialize:function(l,m,v){n.setOptions(this,v),this.map=l,this.feature=m,this.feature.editor=this,this.editLayer=new n.LayerGroup,this.tools=this.options.editTools||l.editTools},addHooks:function(){this.isConnected()?this.onFeatureAdd():this.feature.once("add",this.onFeatureAdd,this),this.onEnable(),this.feature.on(this._getEvents(),this)},removeHooks:function(){this.feature.off(this._getEvents(),this),this.feature.dragging&&this.feature.dragging.disable(),this.editLayer.clearLayers(),this.tools.editLayer.removeLayer(this.editLayer),this.onDisable(),this._drawing&&this.cancelDrawing()},drawing:function(){return!!this._drawing},reset:()=>{},onFeatureAdd:function(){this.tools.editLayer.addLayer(this.editLayer),this.feature.dragging&&this.feature.dragging.enable()},hasMiddleMarkers:function(){return!this.options.skipMiddleMarkers&&!this.tools.options.skipMiddleMarkers},fireAndForward:function(l,m){m=m||{},m.layer=this.feature,this.feature.fire(l,m),this.tools.fireAndForward(l,m)},onEnable:function(){this.fireAndForward("editable:enable")},onDisable:function(){this.fireAndForward("editable:disable")},onEditing:function(){this.fireAndForward("editable:editing")},onEdited:function(){this.fireAndForward("editable:edited")},onStartDrawing:function(){this.fireAndForward("editable:drawing:start")},onEndDrawing:function(){this.fireAndForward("editable:drawing:end")},onCancelDrawing:function(){this.fireAndForward("editable:drawing:cancel")},onCommitDrawing:function(l){this.fireAndForward("editable:drawing:commit",l),this.onEdited()},onDrawingMouseDown:function(l){this.fireAndForward("editable:drawing:mousedown",l)},onDrawingMouseUp:function(l){this.fireAndForward("editable:drawing:mouseup",l)},startDrawing:function(){this._drawing||(this._drawing=n.Editable.FORWARD),this.tools.registerForDrawing(this),this.onStartDrawing()},commitDrawing:function(l){this.onCommitDrawing(l),this.endDrawing()},cancelDrawing:function(){n.Draggable._dragging=!1,this.onCancelDrawing(),this.endDrawing()},endDrawing:function(){this._drawing=!1,this.tools.unregisterForDrawing(this),this.onEndDrawing()},onDrawingClick:function(l){this.drawing()&&(n.Editable.makeCancellable(l),this.fireAndForward("editable:drawing:click",l),!l._cancelled&&(this.isConnected()||this.connect(l),this.processDrawingClick(l)))},isConnected:function(){return this.map.hasLayer(this.feature)},connect:function(){this.tools.connectCreatedToMap(this.feature),this.tools.editLayer.addLayer(this.editLayer)},onMove:function(l){this.fireAndForward("editable:drawing:move",l)},onDrawingMouseMove:function(l){this.onMove(l)},_getEvents:function(){return{dragstart:this.onDragStart,drag:this.onDrag,dragend:this.onDragEnd,remove:this.disable}},onDragStart:function(l){this.onEditing(),this.fireAndForward("editable:dragstart",l)},onDrag:function(l){this.onMove(l),this.fireAndForward("editable:drag",l)},onDragEnd:function(l){this.fireAndForward("editable:dragend",l),this.onEdited()}}),n.Editable.MarkerEditor=n.Editable.BaseEditor.extend({onDrawingMouseMove:function(l){n.Editable.BaseEditor.prototype.onDrawingMouseMove.call(this,l),this._drawing&&this.feature.setLatLng(l.latlng)},processDrawingClick:function(l){this.fireAndForward("editable:drawing:clicked",l),this.commitDrawing(l)},connect:function(l){l&&(this.feature._latlng=l.latlng),n.Editable.BaseEditor.prototype.connect.call(this,l)}}),n.Editable.CircleMarkerEditor=n.Editable.BaseEditor.extend({onDrawingMouseMove:function(l){n.Editable.BaseEditor.prototype.onDrawingMouseMove.call(this,l),this._drawing&&this.feature.setLatLng(l.latlng)},processDrawingClick:function(l){this.fireAndForward("editable:drawing:clicked",l),this.commitDrawing(l)},connect:function(l){l&&(this.feature._latlng=l.latlng),n.Editable.BaseEditor.prototype.connect.call(this,l)}}),n.Editable.PathEditor=n.Editable.BaseEditor.extend({CLOSED:!1,MIN_VERTEX:2,addHooks:function(){return n.Editable.BaseEditor.prototype.addHooks.call(this),this.feature&&(this.initVertexMarkers(),this.map.on("moveend",this.onMoveEnd,this)),this},removeHooks:function(){n.Editable.BaseEditor.prototype.removeHooks.call(this),this.feature&&this.map.off("moveend",this.onMoveEnd,this)},onMoveEnd:function(){this.initVertexMarkers()},initVertexMarkers:function(l){if(this.enabled())if(l=l||this.getLatLngs(),g(l))this.addVertexMarkers(l);else for(let m of l)this.initVertexMarkers(m)},getLatLngs:function(){return this.feature.getLatLngs()},reset:function(){this.editLayer.clearLayers(),this.initVertexMarkers()},addVertexMarker:function(l,m){return l.__vertex?(l.__vertex.connect(),l.__vertex):new this.tools.options.vertexMarkerClass(l,m,this)},onNewVertex:function(l){this.fireAndForward("editable:vertex:new",{latlng:l.latlng,vertex:l})},addVertexMarkers:function(l){let m=this.map.getBounds();for(let v of l)m.contains(v)&&this.addVertexMarker(v,l)},refreshVertexMarkers:function(l){l=l||this.getDefaultLatLngs();for(let m of l)m.__vertex.update()},addMiddleMarker:function(l,m,v){return new this.tools.options.middleMarkerClass(l,m,v,this)},onVertexMarkerClick:function(l){if(n.Editable.makeCancellable(l),this.fireAndForward("editable:vertex:click",l),l._cancelled||this.tools.drawing()&&this.tools._drawingEditor!==this)return;let m=l.vertex.getIndex(),v;l.originalEvent.ctrlKey?this.onVertexMarkerCtrlClick(l):l.originalEvent.altKey?this.onVertexMarkerAltClick(l):l.originalEvent.shiftKey?this.onVertexMarkerShiftClick(l):l.originalEvent.metaKey?this.onVertexMarkerMetaKeyClick(l):m===l.vertex.getLastIndex()&&this._drawing===n.Editable.FORWARD?m>=this.MIN_VERTEX-1&&(v=!0):m===0&&this._drawing===n.Editable.BACKWARD&&this._drawnLatLngs.length>=this.MIN_VERTEX||m===0&&this._drawing===n.Editable.FORWARD&&this._drawnLatLngs.length>=this.MIN_VERTEX&&this.CLOSED?v=!0:this.onVertexRawMarkerClick(l),this.fireAndForward("editable:vertex:clicked",l),v&&this.commitDrawing(l)},onVertexRawMarkerClick:function(l){this.fireAndForward("editable:vertex:rawclick",l),!l._cancelled&&this.vertexCanBeDeleted(l.vertex)&&l.vertex.delete()},vertexCanBeDeleted:function(l){return l.latlngs.length>this.MIN_VERTEX},onVertexDeleted:function(l){this.fireAndForward("editable:vertex:deleted",l),this.onEdited()},onVertexMarkerCtrlClick:function(l){this.fireAndForward("editable:vertex:ctrlclick",l)},onVertexMarkerShiftClick:function(l){this.fireAndForward("editable:vertex:shiftclick",l)},onVertexMarkerMetaKeyClick:function(l){this.fireAndForward("editable:vertex:metakeyclick",l)},onVertexMarkerAltClick:function(l){this.fireAndForward("editable:vertex:altclick",l)},onVertexMarkerContextMenu:function(l){this.fireAndForward("editable:vertex:contextmenu",l)},onVertexMarkerMouseDown:function(l){this.fireAndForward("editable:vertex:mousedown",l)},onVertexMarkerMouseOver:function(l){this.fireAndForward("editable:vertex:mouseover",l)},onVertexMarkerMouseOut:function(l){this.fireAndForward("editable:vertex:mouseout",l)},onMiddleMarkerMouseDown:function(l){this.fireAndForward("editable:middlemarker:mousedown",l)},onVertexMarkerDrag:function(l){this.onMove(l),this.feature._bounds&&this.extendBounds(l),this.fireAndForward("editable:vertex:drag",l)},onVertexMarkerDragStart:function(l){this.fireAndForward("editable:vertex:dragstart",l)},onVertexMarkerDragEnd:function(l){this.fireAndForward("editable:vertex:dragend",l),this.onEdited()},setDrawnLatLngs:function(l){this._drawnLatLngs=l||this.getDefaultLatLngs()},startDrawing:function(){this._drawnLatLngs||this.setDrawnLatLngs(),n.Editable.BaseEditor.prototype.startDrawing.call(this)},startDrawingForward:function(){this.startDrawing()},endDrawing:function(){this.tools.detachForwardLineGuide(),this.tools.detachBackwardLineGuide(),this._drawnLatLngs&&this._drawnLatLngs.length<this.MIN_VERTEX&&this.deleteShape(this._drawnLatLngs),n.Editable.BaseEditor.prototype.endDrawing.call(this),delete this._drawnLatLngs},addLatLng:function(l){this._drawing===n.Editable.FORWARD?this._drawnLatLngs.push(l):this._drawnLatLngs.unshift(l),this.feature._bounds.extend(l);let m=this.addVertexMarker(l,this._drawnLatLngs);this.onNewVertex(m),this.refresh()},newPointForward:function(l){this.addLatLng(l),this.tools.attachForwardLineGuide(),this.tools.anchorForwardLineGuide(l)},newPointBackward:function(l){this.addLatLng(l),this.tools.anchorBackwardLineGuide(l)},push:function(l){if(!l)return console.error("L.Editable.PathEditor.push expect a valid latlng as parameter");this._drawing===n.Editable.FORWARD?this.newPointForward(l):this.newPointBackward(l)},removeLatLng:function(l){l.__vertex.delete(),this.refresh()},pop:function(){if(this._drawnLatLngs.length<=1)return;let l;return this._drawing===n.Editable.FORWARD?l=this._drawnLatLngs[this._drawnLatLngs.length-1]:l=this._drawnLatLngs[0],this.removeLatLng(l),this._drawing===n.Editable.FORWARD?this.tools.anchorForwardLineGuide(this._drawnLatLngs[this._drawnLatLngs.length-1]):this.tools.anchorForwardLineGuide(this._drawnLatLngs[0]),l},processDrawingClick:function(l){l.vertex&&l.vertex.editor===this||(this._drawing===n.Editable.FORWARD?this.newPointForward(l.latlng):this.newPointBackward(l.latlng),this.fireAndForward("editable:drawing:clicked",l))},onDrawingMouseMove:function(l){n.Editable.BaseEditor.prototype.onDrawingMouseMove.call(this,l),this._drawing&&(this.tools.moveForwardLineGuide(l.latlng),this.tools.moveBackwardLineGuide(l.latlng))},refresh:function(){this.feature.redraw(),this.onEditing()},newShape:function(l){let m=this.addNewEmptyShape();m&&(this.setDrawnLatLngs(m[0]||m),this.startDrawingForward(),this.fireAndForward("editable:shape:new",{shape:m}),l&&this.newPointForward(l))},deleteShape:function(l,m){let v={shape:l};if(n.Editable.makeCancellable(v),this.fireAndForward("editable:shape:delete",v),!v._cancelled)return l=this._deleteShape(l,m),this.ensureNotFlat&&this.ensureNotFlat(),this.feature.setLatLngs(this.getLatLngs()),this.refresh(),this.reset(),this.fireAndForward("editable:shape:deleted",{shape:l}),this.onEdited(),l},_deleteShape:function(l,m){if(m=m||this.getLatLngs(),!m.length)return;let v=(M,x)=>M.splice(0,Number.MAX_VALUE),y=(M,x)=>(M.splice(M.indexOf(x),1),M.length||this._deleteShape(M),x);if(m===l)return v(m,l);for(let M of m){if(M===l)return y(m,l);if(M.indexOf(l)!==-1)return y(M,l)}},deleteShapeAt:function(l){let m=this.feature.shapeAt(l);if(m)return this.deleteShape(m)},appendShape:function(l){this.insertShape(l)},prependShape:function(l){this.insertShape(l,0)},insertShape:function(l,m){this.ensureMulti(),l=this.formatShape(l),m===void 0&&(m=this.feature._latlngs.length),this.feature._latlngs.splice(m,0,l),this.feature.redraw(),this._enabled&&this.reset()},extendBounds:function(l){this.feature._bounds.extend(l.vertex.latlng)},onDragStart:function(l){this.editLayer.clearLayers(),n.Editable.BaseEditor.prototype.onDragStart.call(this,l)},onDragEnd:function(l){this.initVertexMarkers(),n.Editable.BaseEditor.prototype.onDragEnd.call(this,l)}}),n.Editable.PolylineEditor=n.Editable.PathEditor.extend({startDrawingBackward:function(){this._drawing=n.Editable.BACKWARD,this.startDrawing()},continueBackward:function(l){this.drawing()||(l=l||this.getDefaultLatLngs(),this.setDrawnLatLngs(l),l.length>0&&(this.tools.attachBackwardLineGuide(),this.tools.anchorBackwardLineGuide(l[0])),this.startDrawingBackward())},continueForward:function(l){this.drawing()||(l=l||this.getDefaultLatLngs(),this.setDrawnLatLngs(l),l.length>0&&(this.tools.attachForwardLineGuide(),this.tools.anchorForwardLineGuide(l[l.length-1])),this.startDrawingForward())},getDefaultLatLngs:function(l){return l=l||this.feature._latlngs,!l.length||l[0]instanceof n.LatLng?l:this.getDefaultLatLngs(l[0])},ensureMulti:function(){this.feature._latlngs.length&&g(this.feature._latlngs)&&(this.feature._latlngs=[this.feature._latlngs])},addNewEmptyShape:function(){if(this.feature._latlngs.length){let l=[];return this.appendShape(l),l}return this.feature._latlngs},formatShape:function(l){if(g(l))return l;if(l[0])return this.formatShape(l[0])},splitShape:function(l,m){if(!m||m>=l.length-1)return;this.ensureMulti();let v=this.feature._latlngs.indexOf(l);if(v===-1)return;let y=l.slice(0,m+1),M=l.slice(m);M[0]=n.latLng(M[0].lat,M[0].lng,M[0].alt),this.feature._latlngs.splice(v,1,y,M),this.refresh(),this.reset(),this.onEdited()}}),n.Editable.PolygonEditor=n.Editable.PathEditor.extend({CLOSED:!0,MIN_VERTEX:3,newPointForward:function(l){n.Editable.PathEditor.prototype.newPointForward.call(this,l),this.tools.backwardLineGuide._latlngs.length||this.tools.anchorBackwardLineGuide(l),this._drawnLatLngs.length===2&&this.tools.attachBackwardLineGuide()},addNewEmptyHole:function(l){this.ensureNotFlat();let m=this.feature.shapeAt(l);if(!m)return;let v=[];return m.push(v),v},newHole:function(l){let m=this.addNewEmptyHole(l);m&&(this.setDrawnLatLngs(m),this.startDrawingForward(),l&&this.newPointForward(l))},addNewEmptyShape:function(){if(this.feature._latlngs.length&&this.feature._latlngs[0].length){let l=[];return this.appendShape(l),l}return this.feature._latlngs},ensureMulti:function(){this.feature._latlngs.length&&g(this.feature._latlngs[0])&&(this.feature._latlngs=[this.feature._latlngs])},ensureNotFlat:function(){(!this.feature._latlngs.length||g(this.feature._latlngs))&&(this.feature._latlngs=[this.feature._latlngs])},vertexCanBeDeleted:function(l){let m=this.feature.parentShape(l.latlngs);return n.Util.indexOf(m,l.latlngs)>0?!0:n.Editable.PathEditor.prototype.vertexCanBeDeleted.call(this,l)},getDefaultLatLngs:function(){return this.feature._latlngs.length||this.feature._latlngs.push([]),this.feature._latlngs[0]},formatShape:l=>g(l)&&(!l[0]||l[0].length!==0)?[l]:l}),n.Editable.RectangleEditor=n.Editable.PathEditor.extend({CLOSED:!0,MIN_VERTEX:4,options:{skipMiddleMarkers:!0},extendBounds:function(l){let m=l.vertex.getIndex(),v=l.vertex.getNext(),y=l.vertex.getPrevious(),M=(m+2)%4,x=l.vertex.latlngs[M],C=new n.LatLngBounds(l.latlng,x);y.latlng.update([l.latlng.lat,x.lng]),v.latlng.update([x.lat,l.latlng.lng]),this.updateBounds(C),this.refreshVertexMarkers()},onDrawingMouseDown:function(l){n.Editable.PathEditor.prototype.onDrawingMouseDown.call(this,l),this.connect();let m=this.getDefaultLatLngs();m.length===3&&m.push(l.latlng);let v=new n.LatLngBounds(l.latlng,l.latlng);this.updateBounds(v),this.updateLatLngs(v),this.refresh(),this.reset(),l.originalEvent._simulated=!1,this.map.dragging._draggable._onUp(l.originalEvent),m[3].__vertex.dragging._draggable._onDown(l.originalEvent)},onDrawingMouseUp:function(l){this.commitDrawing(l),l.originalEvent._simulated=!1,n.Editable.PathEditor.prototype.onDrawingMouseUp.call(this,l)},onDrawingMouseMove:function(l){l.originalEvent._simulated=!1,n.Editable.PathEditor.prototype.onDrawingMouseMove.call(this,l)},getDefaultLatLngs:function(l){return l||this.feature._latlngs[0]},updateBounds:function(l){this.feature._bounds=l},updateLatLngs:function(l){let m=this.getDefaultLatLngs(),v=this.feature._boundsToLatLngs(l);for(let y=0;y<m.length;y++)m[y].update(v[y])}}),n.Editable.CircleEditor=n.Editable.PathEditor.extend({MIN_VERTEX:2,options:{skipMiddleMarkers:!0},initialize:function(l,m,v){n.Editable.PathEditor.prototype.initialize.call(this,l,m,v),this._resizeLatLng=this.computeResizeLatLng()},computeResizeLatLng:function(){let l=(this.feature._radius||this.feature._mRadius)*Math.cos(Math.PI/4),m=this.map.project(this.feature._latlng);return this.map.unproject([m.x+l,m.y-l])},updateResizeLatLng:function(){this._resizeLatLng.update(this.computeResizeLatLng()),this._resizeLatLng.__vertex.update()},getLatLngs:function(){return[this.feature._latlng,this._resizeLatLng]},getDefaultLatLngs:function(){return this.getLatLngs()},onVertexMarkerDrag:function(l){l.vertex.getIndex()===1?this.resize(l):this.updateResizeLatLng(l),n.Editable.PathEditor.prototype.onVertexMarkerDrag.call(this,l)},resize:function(l){let m;this.map.options.crs?m=this.map.options.crs.distance(this.feature._latlng,l.latlng):m=this.feature._latlng.distanceTo(l.latlng),this.feature.setRadius(m)},onDrawingMouseDown:function(l){n.Editable.PathEditor.prototype.onDrawingMouseDown.call(this,l),this._resizeLatLng.update(l.latlng),this.feature._latlng.update(l.latlng),this.connect(),l.originalEvent._simulated=!1,this.map.dragging._draggable._onUp(l.originalEvent),this._resizeLatLng.__vertex.dragging._draggable._onDown(l.originalEvent)},onDrawingMouseUp:function(l){this.commitDrawing(l),l.originalEvent._simulated=!1,n.Editable.PathEditor.prototype.onDrawingMouseUp.call(this,l)},onDrawingMouseMove:function(l){l.originalEvent._simulated=!1,n.Editable.PathEditor.prototype.onDrawingMouseMove.call(this,l)},onDrag:function(l){n.Editable.PathEditor.prototype.onDrag.call(this,l),this.feature.dragging.updateLatLng(this._resizeLatLng)}});let e={createEditor:function(l){l=l||this._map;let m=this.options.editOptions?.editTools||l.editTools;if(!m)throw Error("Unable to detect Editable instance.");let v=this.options.editorClass||this.getEditorClass(m);return new v(l,this,this.options.editOptions)},enableEdit:function(l){return this.editor||this.createEditor(l),this.editor.enable(),this.editor},editEnabled:function(){return this.editor?.enabled()},disableEdit:function(){this.editor&&(this.editor.disable(),delete this.editor)},toggleEdit:function(){this.editEnabled()?this.disableEdit():this.enableEdit()},_onEditableAdd:function(){this.editor&&this.enableEdit()}},o={getEditorClass:l=>l?.options?.polylineEditorClass||n.Editable.PolylineEditor,shapeAt:function(l,m){let v=null;if(m=m||this._latlngs,!m.length)return v;if(g(m)&&this.isInLatLngs(l,m))v=m;else for(let y of m)if(this.isInLatLngs(l,y))return y;return v},isInLatLngs:function(l,m){if(!m)return!1;let v,y,M,x=[],C,k=this._clickTolerance();if(this._projectLatlngs(m,x,this._pxBounds),x=x[0],C=this._map.latLngToLayerPoint(l),!this._pxBounds.contains(C))return!1;for(v=1,M=x.length,y=0;v<M;y=v++)if(n.LineUtil.pointToSegmentDistance(C,x[y],x[v])<=k)return!0;return!1}},r={getEditorClass:l=>l?.options?.polygonEditorClass||n.Editable.PolygonEditor,shapeAt:function(l,m){let v=null;if(m=m||this._latlngs,!m.length)return v;if(g(m)&&this.isInLatLngs(l,m)&&(v=m),g(m[0])&&this.isInLatLngs(l,m[0]))v=m;else for(let y of m)if(this.isInLatLngs(l,y[0]))return y;return v},isInLatLngs:(l,m)=>{let v=!1,y,M,x,C,k;for(x=0,k=m.length,C=k-1;x<k;C=x++)y=m[x],M=m[C],y.lat>l.lat!=M.lat>l.lat&&l.lng<(M.lng-y.lng)*(l.lat-y.lat)/(M.lat-y.lat)+y.lng&&(v=!v);return v},parentShape:function(l,m){if(m=m||this._latlngs,!m)return;let v=n.Util.indexOf(m,l);if(v!==-1)return m;for(let y of m)if(v=n.Util.indexOf(y,l),v!==-1)return y}},s={getEditorClass:l=>l?.options?.markerEditorClass||n.Editable.MarkerEditor},h={getEditorClass:l=>l?.options?.circleMarkerEditorClass||n.Editable.CircleMarkerEditor},c={getEditorClass:l=>l?.options?.rectangleEditorClass||n.Editable.RectangleEditor},f={getEditorClass:l=>l?.options?.circleEditorClass||n.Editable.CircleEditor},_=function(){this.on("add",this._onEditableAdd)},g=n.LineUtil.isFlat||n.LineUtil._flat||n.Polyline._flat;n.Polyline&&(n.Polyline.include(e),n.Polyline.include(o),n.Polyline.addInitHook(_)),n.Polygon&&(n.Polygon.include(e),n.Polygon.include(r)),n.Marker&&(n.Marker.include(e),n.Marker.include(s),n.Marker.addInitHook(_)),n.CircleMarker&&(n.CircleMarker.include(e),n.CircleMarker.include(h),n.CircleMarker.addInitHook(_)),n.Rectangle&&(n.Rectangle.include(e),n.Rectangle.include(c)),n.Circle&&(n.Circle.include(e),n.Circle.include(f)),n.LatLng.prototype.update=function(l){l=n.latLng(l),this.lat=l.lat,this.lng=l.lng}},window)});var Yc=["switch"],Kc=["*"];function Qc(n,e){n&1&&(J(0,"span",10),Fa(),J(1,"svg",12),Gt(2,"path",13),q(),J(3,"svg",14),Gt(4,"path",15),q()())}var Jc=new Me("mat-slide-toggle-default-options",{providedIn:"root",factory:()=>({disableToggleValue:!1,hideIcon:!1,disabledInteractive:!1})}),td={provide:_s,useExisting:Ra(()=>xn),multi:!0},wn=class{source;checked;constructor(e,o){this.source=e,this.checked=o}},xn=(()=>{class n{_elementRef=Et(pn);_focusMonitor=Et(ss);_changeDetectorRef=Et(is);defaults=Et(Jc);_onChange=o=>{};_onTouched=()=>{};_validatorOnChange=()=>{};_uniqueId;_checked=!1;_createChangeEvent(o){return new wn(this,o)}_labelId;get buttonId(){return`${this.id||this._uniqueId}-button`}_switchElement;focus(){this._switchElement.nativeElement.focus()}_noopAnimations;_focused;name=null;id;labelPosition="after";ariaLabel=null;ariaLabelledby=null;ariaDescribedby;required;color;disabled=!1;disableRipple=!1;tabIndex=0;get checked(){return this._checked}set checked(o){this._checked=o,this._changeDetectorRef.markForCheck()}hideIcon;disabledInteractive;change=new Ur;toggleChange=new Ur;get inputId(){return`${this.id||this._uniqueId}-input`}constructor(){Et(ls).load(ds);let o=Et(new Ga("tabindex"),{optional:!0}),r=this.defaults,s=Et($a,{optional:!0});this.tabIndex=o==null?0:parseInt(o)||0,this.color=r.color||"accent",this._noopAnimations=s==="NoopAnimations",this.id=this._uniqueId=Et(us).getId("mat-mdc-slide-toggle-"),this.hideIcon=r.hideIcon??!1,this.disabledInteractive=r.disabledInteractive??!1,this._labelId=this._uniqueId+"-label"}ngAfterContentInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(o=>{o==="keyboard"||o==="program"?(this._focused=!0,this._changeDetectorRef.markForCheck()):o||Promise.resolve().then(()=>{this._focused=!1,this._onTouched(),this._changeDetectorRef.markForCheck()})})}ngOnChanges(o){o.required&&this._validatorOnChange()}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}writeValue(o){this.checked=!!o}registerOnChange(o){this._onChange=o}registerOnTouched(o){this._onTouched=o}validate(o){return this.required&&o.value!==!0?{required:!0}:null}registerOnValidatorChange(o){this._validatorOnChange=o}setDisabledState(o){this.disabled=o,this._changeDetectorRef.markForCheck()}toggle(){this.checked=!this.checked,this._onChange(this.checked)}_emitChangeEvent(){this._onChange(this.checked),this.change.emit(this._createChangeEvent(this.checked))}_handleClick(){this.disabled||(this.toggleChange.emit(),this.defaults.disableToggleValue||(this.checked=!this.checked,this._onChange(this.checked),this.change.emit(new wn(this,this.checked))))}_getAriaLabelledBy(){return this.ariaLabelledby?this.ariaLabelledby:this.ariaLabel?null:this._labelId}static \u0275fac=function(r){return new(r||n)};static \u0275cmp=_n({type:n,selectors:[["mat-slide-toggle"]],viewQuery:function(r,s){if(r&1&&Ya(Yc,5),r&2){let h;Ka(h=Qa())&&(s._switchElement=h.first)}},hostAttrs:[1,"mat-mdc-slide-toggle"],hostVars:13,hostBindings:function(r,s){r&2&&(Wa("id",s.id),vn("tabindex",null)("aria-label",null)("name",null)("aria-labelledby",null),ja(s.color?"mat-"+s.color:""),Hr("mat-mdc-slide-toggle-focused",s._focused)("mat-mdc-slide-toggle-checked",s.checked)("_mat-animation-noopable",s._noopAnimations))},inputs:{name:"name",id:"id",labelPosition:"labelPosition",ariaLabel:[0,"aria-label","ariaLabel"],ariaLabelledby:[0,"aria-labelledby","ariaLabelledby"],ariaDescribedby:[0,"aria-describedby","ariaDescribedby"],required:[2,"required","required",Se],color:"color",disabled:[2,"disabled","disabled",Se],disableRipple:[2,"disableRipple","disableRipple",Se],tabIndex:[2,"tabIndex","tabIndex",o=>o==null?0:ns(o)],checked:[2,"checked","checked",Se],hideIcon:[2,"hideIcon","hideIcon",Se],disabledInteractive:[2,"disabledInteractive","disabledInteractive",Se]},outputs:{change:"change",toggleChange:"toggleChange"},exportAs:["matSlideToggle"],features:[es([td,{provide:ys,useExisting:n,multi:!0}]),Za],ngContentSelectors:Kc,decls:13,vars:27,consts:[["switch",""],["mat-internal-form-field","",3,"labelPosition"],["role","switch","type","button",1,"mdc-switch",3,"click","tabIndex","disabled"],[1,"mdc-switch__track"],[1,"mdc-switch__handle-track"],[1,"mdc-switch__handle"],[1,"mdc-switch__shadow"],[1,"mdc-elevation-overlay"],[1,"mdc-switch__ripple"],["mat-ripple","",1,"mat-mdc-slide-toggle-ripple","mat-focus-indicator",3,"matRippleTrigger","matRippleDisabled","matRippleCentered"],[1,"mdc-switch__icons"],[1,"mdc-label",3,"click","for"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--on"],["d","M19.69,5.23L8.96,15.96l-4.23-4.23L2.96,13.5l6,6L21.46,7L19.69,5.23z"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--off"],["d","M20 13H4v-2h16v2z"]],template:function(r,s){if(r&1){let h=Ha();qa(),J(0,"div",1)(1,"button",2,0),Ke("click",function(){return Vr(h),jr(s._handleClick())}),Gt(3,"span",3),J(4,"span",4)(5,"span",5)(6,"span",6),Gt(7,"span",7),q(),J(8,"span",8),Gt(9,"span",9),q(),Ce(10,Qc,5,0,"span",10),q()()(),J(11,"label",11),Ke("click",function(f){return Vr(h),jr(f.stopPropagation())}),Xa(12),q()()}if(r&2){let h=Ja(2);It("labelPosition",s.labelPosition),bt(),Hr("mdc-switch--selected",s.checked)("mdc-switch--unselected",!s.checked)("mdc-switch--checked",s.checked)("mdc-switch--disabled",s.disabled)("mat-mdc-slide-toggle-disabled-interactive",s.disabledInteractive),It("tabIndex",s.disabled&&!s.disabledInteractive?-1:s.tabIndex)("disabled",s.disabled&&!s.disabledInteractive),vn("id",s.buttonId)("name",s.name)("aria-label",s.ariaLabel)("aria-labelledby",s._getAriaLabelledBy())("aria-describedby",s.ariaDescribedby)("aria-required",s.required||null)("aria-checked",s.checked)("aria-disabled",s.disabled&&s.disabledInteractive?"true":null),bt(8),It("matRippleTrigger",h)("matRippleDisabled",s.disableRipple||s.disabled)("matRippleCentered",!0),bt(),Ua(s.hideIcon?-1:10),bt(),It("for",s.buttonId),vn("id",s._labelId)}},dependencies:[fs,Xs],styles:[`.mdc-switch{align-items:center;background:none;border:none;cursor:pointer;display:inline-flex;flex-shrink:0;margin:0;outline:none;overflow:visible;padding:0;position:relative;width:var(--mdc-switch-track-width, 52px)}.mdc-switch.mdc-switch--disabled{cursor:default;pointer-events:none}.mdc-switch.mat-mdc-slide-toggle-disabled-interactive{pointer-events:auto}.mdc-switch__track{overflow:hidden;position:relative;width:100%;height:var(--mdc-switch-track-height, 32px);border-radius:var(--mdc-switch-track-shape, var(--mat-sys-corner-full))}.mdc-switch--disabled.mdc-switch .mdc-switch__track{opacity:var(--mdc-switch-disabled-track-opacity, 0.12)}.mdc-switch__track::before,.mdc-switch__track::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";height:100%;left:0;position:absolute;width:100%;border-width:var(--mat-switch-track-outline-width, 2px);border-color:var(--mat-switch-track-outline-color, var(--mat-sys-outline))}.mdc-switch--selected .mdc-switch__track::before,.mdc-switch--selected .mdc-switch__track::after{border-width:var(--mat-switch-selected-track-outline-width, 2px);border-color:var(--mat-switch-selected-track-outline-color, transparent)}.mdc-switch--disabled .mdc-switch__track::before,.mdc-switch--disabled .mdc-switch__track::after{border-width:var(--mat-switch-disabled-unselected-track-outline-width, 2px);border-color:var(--mat-switch-disabled-unselected-track-outline-color, var(--mat-sys-on-surface))}@media(forced-colors: active){.mdc-switch__track{border-color:currentColor}}.mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:translateX(0);background:var(--mdc-switch-unselected-track-color, var(--mat-sys-surface-variant))}.mdc-switch--selected .mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.6, 1);transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch--selected .mdc-switch__track::before{transform:translateX(-100%)}.mdc-switch--selected .mdc-switch__track::before{opacity:var(--mat-switch-hidden-track-opacity, 0);transition:var(--mat-switch-hidden-track-transition, opacity 75ms)}.mdc-switch--unselected .mdc-switch__track::before{opacity:var(--mat-switch-visible-track-opacity, 1);transition:var(--mat-switch-visible-track-transition, opacity 75ms)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-hover-track-color, var(--mat-sys-surface-variant))}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-focus-track-color, var(--mat-sys-surface-variant))}.mdc-switch:enabled:active .mdc-switch__track::before{background:var(--mdc-switch-unselected-pressed-track-color, var(--mat-sys-surface-variant))}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:hover:not(:focus):not(:active) .mdc-switch__track::before,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:focus:not(:active) .mdc-switch__track::before,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:active .mdc-switch__track::before,.mdc-switch.mdc-switch--disabled .mdc-switch__track::before{background:var(--mdc-switch-disabled-unselected-track-color, var(--mat-sys-surface-variant))}.mdc-switch__track::after{transform:translateX(-100%);background:var(--mdc-switch-selected-track-color, var(--mat-sys-primary))}[dir=rtl] .mdc-switch__track::after{transform:translateX(100%)}.mdc-switch--selected .mdc-switch__track::after{transform:translateX(0)}.mdc-switch--selected .mdc-switch__track::after{opacity:var(--mat-switch-visible-track-opacity, 1);transition:var(--mat-switch-visible-track-transition, opacity 75ms)}.mdc-switch--unselected .mdc-switch__track::after{opacity:var(--mat-switch-hidden-track-opacity, 0);transition:var(--mat-switch-hidden-track-transition, opacity 75ms)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-hover-track-color, var(--mat-sys-primary))}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-focus-track-color, var(--mat-sys-primary))}.mdc-switch:enabled:active .mdc-switch__track::after{background:var(--mdc-switch-selected-pressed-track-color, var(--mat-sys-primary))}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:hover:not(:focus):not(:active) .mdc-switch__track::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:focus:not(:active) .mdc-switch__track::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:active .mdc-switch__track::after,.mdc-switch.mdc-switch--disabled .mdc-switch__track::after{background:var(--mdc-switch-disabled-selected-track-color, var(--mat-sys-on-surface))}.mdc-switch__handle-track{height:100%;pointer-events:none;position:absolute;top:0;transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);left:0;right:auto;transform:translateX(0);width:calc(100% - var(--mdc-switch-handle-width))}[dir=rtl] .mdc-switch__handle-track{left:auto;right:0}.mdc-switch--selected .mdc-switch__handle-track{transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch__handle-track{transform:translateX(-100%)}.mdc-switch__handle{display:flex;pointer-events:auto;position:absolute;top:50%;transform:translateY(-50%);left:0;right:auto;transition:width 75ms cubic-bezier(0.4, 0, 0.2, 1),height 75ms cubic-bezier(0.4, 0, 0.2, 1),margin 75ms cubic-bezier(0.4, 0, 0.2, 1);width:var(--mdc-switch-handle-width);height:var(--mdc-switch-handle-height);border-radius:var(--mdc-switch-handle-shape, var(--mat-sys-corner-full))}[dir=rtl] .mdc-switch__handle{left:auto;right:0}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle{width:var(--mat-switch-unselected-handle-size, 16px);height:var(--mat-switch-unselected-handle-size, 16px);margin:var(--mat-switch-unselected-handle-horizontal-margin, 0 8px)}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle:has(.mdc-switch__icons){margin:var(--mat-switch-unselected-with-icon-handle-horizontal-margin, 0 4px)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle{width:var(--mat-switch-selected-handle-size, 24px);height:var(--mat-switch-selected-handle-size, 24px);margin:var(--mat-switch-selected-handle-horizontal-margin, 0 24px)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle:has(.mdc-switch__icons){margin:var(--mat-switch-selected-with-icon-handle-horizontal-margin, 0 24px)}.mat-mdc-slide-toggle .mdc-switch__handle:has(.mdc-switch__icons){width:var(--mat-switch-with-icon-handle-size, 24px);height:var(--mat-switch-with-icon-handle-size, 24px)}.mat-mdc-slide-toggle .mdc-switch:active:not(.mdc-switch--disabled) .mdc-switch__handle{width:var(--mat-switch-pressed-handle-size, 28px);height:var(--mat-switch-pressed-handle-size, 28px)}.mat-mdc-slide-toggle .mdc-switch--selected:active:not(.mdc-switch--disabled) .mdc-switch__handle{margin:var(--mat-switch-selected-pressed-handle-horizontal-margin, 0 22px)}.mat-mdc-slide-toggle .mdc-switch--unselected:active:not(.mdc-switch--disabled) .mdc-switch__handle{margin:var(--mat-switch-unselected-pressed-handle-horizontal-margin, 0 2px)}.mdc-switch--disabled.mdc-switch--selected .mdc-switch__handle::after{opacity:var(--mat-switch-disabled-selected-handle-opacity, 1)}.mdc-switch--disabled.mdc-switch--unselected .mdc-switch__handle::after{opacity:var(--mat-switch-disabled-unselected-handle-opacity, 0.38)}.mdc-switch__handle::before,.mdc-switch__handle::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";width:100%;height:100%;left:0;position:absolute;top:0;transition:background-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1),border-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);z-index:-1}@media(forced-colors: active){.mdc-switch__handle::before,.mdc-switch__handle::after{border-color:currentColor}}.mdc-switch--selected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-selected-handle-color, var(--mat-sys-on-primary))}.mdc-switch--selected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-hover-handle-color, var(--mat-sys-primary-container))}.mdc-switch--selected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-focus-handle-color, var(--mat-sys-primary-container))}.mdc-switch--selected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-selected-pressed-handle-color, var(--mat-sys-primary-container))}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled.mdc-switch--selected:hover:not(:focus):not(:active) .mdc-switch__handle::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled.mdc-switch--selected:focus:not(:active) .mdc-switch__handle::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled.mdc-switch--selected:active .mdc-switch__handle::after,.mdc-switch--selected.mdc-switch--disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-selected-handle-color, var(--mat-sys-surface))}.mdc-switch--unselected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-unselected-handle-color, var(--mat-sys-outline))}.mdc-switch--unselected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-hover-handle-color, var(--mat-sys-on-surface-variant))}.mdc-switch--unselected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-focus-handle-color, var(--mat-sys-on-surface-variant))}.mdc-switch--unselected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-unselected-pressed-handle-color, var(--mat-sys-on-surface-variant))}.mdc-switch--unselected.mdc-switch--disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-unselected-handle-color, var(--mat-sys-on-surface))}.mdc-switch__handle::before{background:var(--mdc-switch-handle-surface-color)}.mdc-switch__shadow{border-radius:inherit;bottom:0;left:0;position:absolute;right:0;top:0}.mdc-switch:enabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-handle-elevation-shadow)}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:hover:not(:focus):not(:active) .mdc-switch__shadow,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:focus:not(:active) .mdc-switch__shadow,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:active .mdc-switch__shadow,.mdc-switch.mdc-switch--disabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-disabled-handle-elevation-shadow)}.mdc-switch__ripple{left:50%;position:absolute;top:50%;transform:translate(-50%, -50%);z-index:-1;width:var(--mdc-switch-state-layer-size, 40px);height:var(--mdc-switch-state-layer-size, 40px)}.mdc-switch__ripple::after{content:"";opacity:0}.mdc-switch--disabled .mdc-switch__ripple::after{display:none}.mat-mdc-slide-toggle-disabled-interactive .mdc-switch__ripple::after{display:block}.mdc-switch:hover .mdc-switch__ripple::after{opacity:.04;transition:75ms opacity cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mdc-switch .mdc-switch__ripple::after{opacity:.12}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:enabled:focus .mdc-switch__ripple::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:enabled:active .mdc-switch__ripple::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:enabled:hover:not(:focus) .mdc-switch__ripple::after,.mdc-switch--unselected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background:var(--mdc-switch-unselected-hover-state-layer-color, var(--mat-sys-on-surface))}.mdc-switch--unselected:enabled:focus .mdc-switch__ripple::after{background:var(--mdc-switch-unselected-focus-state-layer-color, var(--mat-sys-on-surface))}.mdc-switch--unselected:enabled:active .mdc-switch__ripple::after{background:var(--mdc-switch-unselected-pressed-state-layer-color, var(--mat-sys-on-surface));opacity:var(--mdc-switch-unselected-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity));transition:opacity 75ms linear}.mdc-switch--selected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background:var(--mdc-switch-selected-hover-state-layer-color, var(--mat-sys-primary))}.mdc-switch--selected:enabled:focus .mdc-switch__ripple::after{background:var(--mdc-switch-selected-focus-state-layer-color, var(--mat-sys-primary))}.mdc-switch--selected:enabled:active .mdc-switch__ripple::after{background:var(--mdc-switch-selected-pressed-state-layer-color, var(--mat-sys-primary));opacity:var(--mdc-switch-selected-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity));transition:opacity 75ms linear}.mdc-switch__icons{position:relative;height:100%;width:100%;z-index:1;transform:translateZ(0)}.mdc-switch--disabled.mdc-switch--unselected .mdc-switch__icons{opacity:var(--mdc-switch-disabled-unselected-icon-opacity, 0.38)}.mdc-switch--disabled.mdc-switch--selected .mdc-switch__icons{opacity:var(--mdc-switch-disabled-selected-icon-opacity, 0.38)}.mdc-switch__icon{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0;opacity:0;transition:opacity 30ms 0ms cubic-bezier(0.4, 0, 1, 1)}.mdc-switch--unselected .mdc-switch__icon{width:var(--mdc-switch-unselected-icon-size, 16px);height:var(--mdc-switch-unselected-icon-size, 16px);fill:var(--mdc-switch-unselected-icon-color, var(--mat-sys-surface-variant))}.mdc-switch--unselected.mdc-switch--disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-unselected-icon-color, var(--mat-sys-surface-variant))}.mdc-switch--selected .mdc-switch__icon{width:var(--mdc-switch-selected-icon-size, 16px);height:var(--mdc-switch-selected-icon-size, 16px);fill:var(--mdc-switch-selected-icon-color, var(--mat-sys-on-primary-container))}.mdc-switch--selected.mdc-switch--disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-selected-icon-color, var(--mat-sys-on-surface))}.mdc-switch--selected .mdc-switch__icon--on,.mdc-switch--unselected .mdc-switch__icon--off{opacity:1;transition:opacity 45ms 30ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle{-webkit-user-select:none;user-select:none;display:inline-block;-webkit-tap-highlight-color:rgba(0,0,0,0);outline:0}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple,.mat-mdc-slide-toggle .mdc-switch__ripple::after{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:50%;pointer-events:none}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple:not(:empty),.mat-mdc-slide-toggle .mdc-switch__ripple::after:not(:empty){transform:translateZ(0)}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mat-focus-indicator::before{content:""}.mat-mdc-slide-toggle .mat-internal-form-field{color:var(--mat-switch-label-text-color, var(--mat-sys-on-surface));font-family:var(--mat-switch-label-text-font, var(--mat-sys-body-medium-font));line-height:var(--mat-switch-label-text-line-height, var(--mat-sys-body-medium-line-height));font-size:var(--mat-switch-label-text-size, var(--mat-sys-body-medium-size));letter-spacing:var(--mat-switch-label-text-tracking, var(--mat-sys-body-medium-tracking));font-weight:var(--mat-switch-label-text-weight, var(--mat-sys-body-medium-weight))}.mat-mdc-slide-toggle .mat-ripple-element{opacity:.12}.mat-mdc-slide-toggle .mat-focus-indicator::before{border-radius:50%}.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle-track,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__icon,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::after,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::after{transition:none}.mat-mdc-slide-toggle .mdc-switch:enabled+.mdc-label{cursor:pointer}.mat-mdc-slide-toggle .mdc-switch--disabled+label{color:var(--mdc-switch-disabled-label-text-color)}
`],encapsulation:2,changeDetection:0})}return n})();var Qs=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275mod=Va({type:n});static \u0275inj=Ba({imports:[xn,qr,qr]})}return n})();function nd(n,e){n&1&&(J(0,"mat-error"),mt(1," El nombre es obligatorio "),q())}function rd(n,e){if(n&1&&(J(0,"mat-icon",22),mt(1),q()),n&2){let o,r=Wr();bt(),Mi(" ",(o=r.layerForm.get("icon"))==null?null:o.value," ")}}function od(n,e){if(n&1&&(J(0,"mat-option",23),mt(1),q()),n&2){let o=e.$implicit;It("value",o.id),bt(),ts(" ",o.name," (",o.type,") ")}}function ad(n,e){if(n&1&&(J(0,"div",24)(1,"span"),mt(2),q()()),n&2){let o,r=Wr();bt(2),Mi("",(o=r.layerForm.get("elementIds"))==null||o.value==null?null:o.value.length," elementos seleccionados")}}var Ln=class n{constructor(e,o,r){this.fb=e;this.dialogRef=o;this.data=r;let s={name:"",description:"",color:"#3f51b5",icon:"layers",elementIds:[],visible:!0,isEditable:!0,priority:50},h=r.isEditing&&r.layer?I(I({},s),r.layer):s;this.layerForm=this.fb.group({name:[h.name,[Qe.required]],description:[h.description],color:[h.color,[Qe.required]],icon:[h.icon],elementIds:[h.elementIds||[]],visible:[h.visible],isEditable:[h.isEditable],priority:[h.priority,[Qe.required,Qe.min(0),Qe.max(100)]]}),r.isEditing&&r.layer&&r.layer.isSystem&&(this.layerForm.get("name")?.disable(),r.layer.isEditable||(this.layerForm.get("description")?.disable(),this.layerForm.get("color")?.disable(),this.layerForm.get("icon")?.disable(),this.layerForm.get("elementIds")?.disable(),this.layerForm.get("priority")?.disable()))}layerForm;ngOnInit(){}onCancel(){this.dialogRef.close()}onSave(){if(this.layerForm.invalid)return;let e=this.layerForm.value;this.data.isEditing&&this.data.layer?this.dialogRef.close(Z(I(I({},this.data.layer),e),{updatedAt:new Date})):this.dialogRef.close(e)}static \u0275fac=function(o){return new(o||n)(gn(ks),gn(Os),gn(Is))};static \u0275cmp=_n({type:n,selectors:[["app-custom-layer-form"]],decls:56,vars:9,consts:[["mat-dialog-title",""],[3,"formGroup"],["mat-dialog-content",""],[1,"form-row"],["appearance","outline",1,"full-width"],["matInput","","formControlName","name","placeholder","Ej: Zona cr\xEDtica"],[4,"ngIf"],["matInput","","formControlName","description","placeholder","Describa el prop\xF3sito de esta capa","rows","3"],[1,"form-row","color-selection"],["matInput","","type","color","formControlName","color"],["matInput","","formControlName","icon","placeholder","Ej: layers"],["matSuffix","",4,"ngIf"],["formControlName","elementIds","multiple",""],[3,"value",4,"ngFor","ngForOf"],["class","selection-summary",4,"ngIf"],[1,"form-row","toggles"],["formControlName","visible","color","primary"],["formControlName","isEditable","color","primary",3,"disabled"],["matInput","","type","number","formControlName","priority","min","0","max","100"],["mat-dialog-actions","","align","end"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"],["matSuffix",""],[3,"value"],[1,"selection-summary"]],template:function(o,r){if(o&1&&(J(0,"h2",0),mt(1),q(),J(2,"form",1)(3,"div",2)(4,"div",3)(5,"mat-form-field",4)(6,"mat-label"),mt(7,"Nombre de la capa"),q(),Gt(8,"input",5),Ce(9,nd,2,0,"mat-error",6),q()(),J(10,"div",3)(11,"mat-form-field",4)(12,"mat-label"),mt(13,"Descripci\xF3n"),q(),Gt(14,"textarea",7),q()(),J(15,"div",8)(16,"h4"),mt(17,"Color de la capa"),q(),J(18,"mat-form-field",4)(19,"mat-label"),mt(20,"Color"),q(),Gt(21,"input",9),q()(),J(22,"div",3)(23,"mat-form-field",4)(24,"mat-label"),mt(25,"Icono"),q(),Gt(26,"input",10),J(27,"mat-hint"),mt(28,"Nombre de icono de Material Design"),q(),Ce(29,rd,2,1,"mat-icon",11),q()(),J(30,"div",3)(31,"h4"),mt(32,"Elementos en esta capa"),q(),J(33,"mat-form-field",4)(34,"mat-label"),mt(35,"Seleccionar elementos"),q(),J(36,"mat-select",12),Ce(37,od,2,3,"mat-option",13),q()(),Ce(38,ad,3,1,"div",14),q(),J(39,"div",15)(40,"mat-slide-toggle",16),mt(41," Capa visible "),q(),J(42,"mat-slide-toggle",17),mt(43," Permitir edici\xF3n "),q()(),J(44,"div",3)(45,"mat-form-field",4)(46,"mat-label"),mt(47,"Prioridad"),q(),Gt(48,"input",18),J(49,"mat-hint"),mt(50,"Mayor n\xFAmero = mayor prioridad de visualizaci\xF3n"),q()()()(),J(51,"div",19)(52,"button",20),Ke("click",function(){return r.onCancel()}),mt(53,"Cancelar"),q(),J(54,"button",21),Ke("click",function(){return r.onSave()}),mt(55),q()()()),o&2){let s,h,c;bt(),Mi("",r.data.isEditing?"Editar":"Crear"," Capa Personalizada"),bt(),It("formGroup",r.layerForm),bt(7),It("ngIf",(s=r.layerForm.get("name"))==null?null:s.hasError("required")),bt(20),It("ngIf",(h=r.layerForm.get("icon"))==null?null:h.value),bt(8),It("ngForOf",r.data.availableElements),bt(),It("ngIf",(c=r.layerForm.get("elementIds"))==null||c.value==null?null:c.value.length),bt(4),It("disabled",r.data.isEditing===!1||!!r.data.layer&&r.data.layer.isSystem===!0),bt(12),It("disabled",r.layerForm.invalid),bt(),Mi(" ",r.data.isEditing?"Actualizar":"Crear"," ")}},dependencies:[as,rs,os,Ts,xs,vs,Ls,bs,ws,Ss,Cs,Ps,Es,Ms,Rs,As,zs,Ns,ps,ms,Vs,$s,Bs,Fs,Zs,Gs,Us,js,qs,Ws,Hs,Ys,cs,hs,gs,Qs,xn],styles:[".full-width[_ngcontent-%COMP%]{width:100%}.form-row[_ngcontent-%COMP%]{margin-bottom:16px}.color-selection[_ngcontent-%COMP%]{display:flex;flex-direction:column}.toggles[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.selection-summary[_ngcontent-%COMP%]{margin-top:4px;color:#0009;font-size:12px}h4[_ngcontent-%COMP%]{margin-bottom:8px;color:#0009}"],changeDetection:0})};var Mt=[];for(let n=0;n<256;++n)Mt.push((n+256).toString(16).slice(1));function Js(n,e=0){return(Mt[n[e+0]]+Mt[n[e+1]]+Mt[n[e+2]]+Mt[n[e+3]]+"-"+Mt[n[e+4]]+Mt[n[e+5]]+"-"+Mt[n[e+6]]+Mt[n[e+7]]+"-"+Mt[n[e+8]]+Mt[n[e+9]]+"-"+Mt[n[e+10]]+Mt[n[e+11]]+Mt[n[e+12]]+Mt[n[e+13]]+Mt[n[e+14]]+Mt[n[e+15]]).toLowerCase()}var Xr,sd=new Uint8Array(16);function Yr(){if(!Xr){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Xr=crypto.getRandomValues.bind(crypto)}return Xr(sd)}var ld=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Kr={randomUUID:ld};function ud(n,e,o){if(Kr.randomUUID&&!e&&!n)return Kr.randomUUID();n=n||{};let r=n.random??n.rng?.()??Yr();if(r.length<16)throw new Error("Random bytes length must be >= 16");if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){if(o=o||0,o<0||o+16>e.length)throw new RangeError(`UUID byte range ${o}:${o+15} is out of buffer bounds`);for(let s=0;s<16;++s)e[o+s]=r[s];return e}return Js(r)}var Qr=ud;var En=class n{constructor(e,o,r){this.http=e;this.dialog=o;this.logger=r;this.initDefaultLayersOnLoad()}apiUrl="/api/layers";layersCache=[];layersLoaded=!1;useMock=bn.useMocks;layers$=new N([]);getLayers(){return this.layersLoaded&&this.layersCache.length>0?At([...this.layersCache]):(this.logger.debug("LayerService: Solicitando capas personalizadas."),this.useMock?(this.logger.info("LayerService: Usando datos simulados para capas personalizadas."),this.layersCache=this.getDefaultLayers(),this.layersLoaded=!0,this.layers$.next([...this.layersCache]),At([...this.layersCache]).pipe(Ei(300))):this.http.get(this.apiUrl).pipe(Xe(e=>{this.layersCache=e,this.layersLoaded=!0,this.layers$.next([...this.layersCache]),this.logger.debug("LayerService: Capas personalizadas cargadas desde API y cacheadas.",e.length)}),Ee(e=>(this.logger.error("LayerService: Error al obtener capas personalizadas desde API.",e),bn.production?Le(()=>e):(this.logger.warn("LayerService: Usando capas por defecto como fallback."),this.layersCache=this.getDefaultLayers(),this.layersLoaded=!0,this.layers$.next([...this.layersCache]),At([...this.layersCache]))))))}getLayersAsObservable(){return this.layersLoaded||this.getLayers().subscribe({error:e=>this.logger.error("LayerService: Error en la suscripci\xF3n inicial a getLayers.",e)}),this.layers$.asObservable()}createLayer(e){if(this.logger.debug("LayerService: Creando nueva capa personalizada.",e),this.useMock){let o=new Date,r=Z(I({},e),{id:Qr(),createdAt:o,updatedAt:o});return this.layersCache=[...this.layersCache,r],this.layers$.next([...this.layersCache]),this.logger.info("LayerService: Capa personalizada creada exitosamente (mock).",r),At(r).pipe(Ei(300))}return this.http.post(this.apiUrl,e).pipe(Xe(o=>{this.layersCache=[...this.layersCache,o],this.layers$.next([...this.layersCache]),this.logger.info("LayerService: Capa personalizada creada exitosamente.",o)}),Ee(o=>(this.logger.error("LayerService: Error al crear capa personalizada.",o,e),Le(()=>o))))}updateLayer(e,o){if(this.logger.debug(`LayerService: Actualizando capa personalizada con ID ${e}.`,o),this.useMock){let r=this.layersCache.findIndex(h=>h.id===e);if(r===-1){let h=new Error(`No se encontr\xF3 la capa con ID ${e}`);return this.logger.error("LayerService: Error al actualizar capa personalizada (mock).",h),Le(()=>h)}let s=Z(I(I({},this.layersCache[r]),o),{updatedAt:new Date});return this.layersCache[r]=s,this.layers$.next([...this.layersCache]),this.logger.info("LayerService: Capa personalizada actualizada exitosamente (mock).",s),At(s).pipe(Ei(300))}return this.http.patch(`${this.apiUrl}/${e}`,o).pipe(Xe(r=>{let s=this.layersCache.findIndex(h=>h.id===e);s!==-1?(this.layersCache[s]=r,this.layers$.next([...this.layersCache]),this.logger.info("LayerService: Capa personalizada actualizada exitosamente.",r)):(this.logger.warn(`LayerService: No se encontr\xF3 la capa con ID ${e} en cach\xE9 despu\xE9s de actualizar.`),this.forceRefreshLayers())}),Ee(r=>(this.logger.error(`LayerService: Error al actualizar capa personalizada con ID ${e}.`,r,o),Le(()=>r))))}deleteLayer(e){if(this.logger.debug(`LayerService: Eliminando capa personalizada con ID ${e}.`),this.useMock){if(this.layersCache.findIndex(r=>r.id===e)===-1){let r=new Error(`No se encontr\xF3 la capa con ID ${e}`);return this.logger.error("LayerService: Error al eliminar capa personalizada (mock).",r),Le(()=>r)}return this.layersCache=this.layersCache.filter(r=>r.id!==e),this.layers$.next([...this.layersCache]),this.logger.info(`LayerService: Capa personalizada con ID ${e} eliminada exitosamente (mock).`),At(void 0).pipe(Ei(300))}return this.http.delete(`${this.apiUrl}/${e}`).pipe(Xe(()=>{this.layersCache=this.layersCache.filter(o=>o.id!==e),this.layers$.next([...this.layersCache]),this.logger.info(`LayerService: Capa personalizada con ID ${e} eliminada exitosamente.`)}),Ee(o=>(this.logger.error(`LayerService: Error al eliminar capa personalizada con ID ${e}.`,o),Le(()=>o))))}forceRefreshLayers(){return this.layersLoaded=!1,this.logger.debug("LayerService: Forzando recarga de capas personalizadas."),this.getLayers()}openLayerDialog(e){return this.logger.debug("LayerService: Abriendo di\xE1logo de capa personalizada.",e),this.dialog.open(Ln,{width:"500px",data:{layer:e?I({},e):void 0}}).afterClosed().pipe(Xe(r=>{r?this.logger.debug("LayerService: Di\xE1logo de capa personalizada cerrado con resultado.",r):this.logger.debug("LayerService: Di\xE1logo de capa personalizada cerrado sin resultado (cancelado).")}))}initDefaultLayersOnLoad(){(this.useMock||!bn.production)&&this.layersCache.length===0&&!this.layersLoaded&&(this.logger.debug("LayerService: Pre-cargando capas por defecto en modo desarrollo (s\xEDncrono)."),this.layersCache=this.getDefaultLayers(),this.layers$.next([...this.layersCache]))}getDefaultLayers(){return this.logger.debug("LayerService: Obteniendo lista de capas por defecto."),[{id:"default-layer-olt",name:"OLTs (Default)",type:"VECTOR",visible:!0,opacity:1,zIndex:1,order:1,color:"#e53935",icon:"router",elements:["OLT"],createdAt:new Date,updatedAt:new Date,description:"Capa por defecto para OLTs"},{id:"default-layer-ont",name:"ONTs (Default)",type:"VECTOR",visible:!0,opacity:1,zIndex:2,order:2,color:"#43a047",icon:"device_hub",elements:["ONT"],createdAt:new Date,updatedAt:new Date,description:"Capa por defecto para ONTs"},{id:"default-layer-fdp",name:"FDPs (Default)",type:"VECTOR",visible:!0,opacity:1,zIndex:3,order:3,color:"#2196f3",icon:"settings_input_component",elements:["FDP"],createdAt:new Date,updatedAt:new Date,description:"Capa por defecto para FDPs"},{id:"default-layer-splitter",name:"Splitters (Default)",type:"VECTOR",visible:!0,opacity:1,zIndex:4,order:4,color:"#ff9800",icon:"call_split",elements:["SPLITTER"],createdAt:new Date,updatedAt:new Date,description:"Capa por defecto para Splitters"}]}static \u0275fac=function(o){return new(o||n)(K(yn),K(Ds),K(pt))};static \u0275prov=ft({token:n,factory:n.\u0275fac,providedIn:"root"})};var Mn=class n{constructor(e,o){this.logger=e;this.layerService=o;let r=new Set(Object.values(Ci).filter(s=>typeof s=="number"));this.updateActiveLayers(r),this.layerService.getLayersAsObservable().pipe(Nt(this.destroy$)).subscribe(s=>{this.updateCustomLayersList(s)}),this.logger.debug("NetworkStateService inicializado")}destroy$=new dt;initialState={selectedElement:null,selectedConnection:null,activeLayers:new Set,customLayers:[],activeCustomLayers:new Set,isDarkMode:!1,showMiniMap:!0,currentTool:"pan",hasUnsavedChanges:!1,zoomLevel:100,connections:[],historyItems:[],searchResults:[],elementPreview:null};stateSubject=new N(this.initialState);state$=this.stateSubject.asObservable();selectedElementSubject=new N(null);editingElementSubject=new N(null);mapVisibilitySubject=new N(!0);isDirtySubject=new N(!1);currentViewModeSubject=new N("map");diagnosticModeSubject=new N(!1);positionSelectionActiveSubject=new N(!1);selectedPositionSubject=new N(null);elementPreviewSubject=new N(null);_showSearchWidget=new N(!0);_showElementsPanel=new N(!0);showSearchWidget=this._showSearchWidget.asObservable();showElementsPanel=this._showElementsPanel.asObservable();selectedElement=new N(null);currentViewMode=new N("map");isDirtyState=new N(!1);isEditingState=new N(!1);mapCenter=new N(Si(18.735693,-70.162651));mapZoom=new N(7);editingElement=new N(null);mapVisible=new N(!0);mapViewMode=new N("DEFAULT");elementEditMode=new N("VIEW");selectedConnection=new N(null);visibleLayers=new N([]);widgets=new N([]);widgetVisibility=new N({search:!0,"elements-panel":!0,"mini-map":!0,"layer-control":!0});ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}getCurrentState(){return this.stateSubject.getValue()}updateSelectedElement(e){let o=this.getCurrentState();this.stateSubject.next(Z(I({},o),{selectedElement:e})),this.selectedElementSubject.next(e),this.logger.debug(`Elemento seleccionado actualizado: ${e?.id||"ninguno"}`)}updateActiveLayers(e){let o=this.getCurrentState();this.stateSubject.next(Z(I({},o),{activeLayers:e}))}updateCustomLayersList(e){let o=this.getCurrentState(),r=new Set;o.activeCustomLayers.forEach(s=>{e.some(h=>h.id===s)&&r.add(s)}),this.stateSubject.next(Z(I({},o),{customLayers:e,activeCustomLayers:r})),this.logger.debug("NetworkStateService: Lista de CustomLayers actualizada desde LayerService.",e.length)}updateDarkMode(e){let o=this.getCurrentState();this.stateSubject.next(Z(I({},o),{isDarkMode:e})),this.isDirtySubject.next(this.getCurrentState().hasUnsavedChanges),this.logger.debug(`NetworkStateService: modo oscuro ${e?"activado":"desactivado"}`)}updateCurrentTool(e){let o=this.getCurrentState();this.stateSubject.next(Z(I({},o),{currentTool:e}))}updateMiniMap(e){let o=this.getCurrentState();this.stateSubject.next(Z(I({},o),{showMiniMap:e}))}updateUnsavedChanges(e){let o=this.getCurrentState();this.stateSubject.next(Z(I({},o),{hasUnsavedChanges:e})),this.isDirtySubject.next(e)}updateConnections(e){let o=this.getCurrentState();this.stateSubject.next(Z(I({},o),{connections:e}))}updateCustomLayers(e){let o=this.getCurrentState();this.stateSubject.next(Z(I({},o),{customLayers:e}))}updateActiveCustomLayers(e){let o=this.getCurrentState(),r=new Set;e.forEach(s=>{o.customLayers.some(h=>h.id===s)&&r.add(s)}),this.stateSubject.next(Z(I({},o),{activeCustomLayers:r})),this.logger.debug("NetworkStateService: ActiveCustomLayers actualizado.",Array.from(r))}updateElementPreview(e,o){let r=this.getCurrentState();this.stateSubject.next(Z(I({},r),{elementPreview:e})),this.elementPreviewSubject.next(e),o&&this.logger.debug(`Vista previa de elemento actualizada. Acci\xF3n: ${o}, ID: ${e?.id||"nuevo"}`)}setSelectedElement(e){this.updateSelectedElement(e)}getSelectedElement(){return this.getCurrentState().selectedElement}getSelectedElementAsObservable(){return this.selectedElementSubject.asObservable()}isLayerActive(e){return this.getCurrentState().activeLayers.has(e)}setSelectedConnection(e){let o=this.getCurrentState();this.stateSubject.next(Z(I({},o),{selectedConnection:e})),this.selectedConnection.next(e),this.logger.debug(`Conexi\xF3n seleccionada: ${e?.id||"ninguna"}`)}toggleLayer(e){let o=this.getCurrentState(),r=new Set(o.activeLayers);r.has(e)?r.delete(e):r.add(e),this.updateActiveLayers(r),this.logger.debug(`Capa ${Ci[e]} alternada. Estado: ${r.has(e)}`)}toggleCustomLayer(e){let o=this.getCurrentState(),r=new Set(o.activeCustomLayers);r.has(e)?r.delete(e):r.add(e),this.updateActiveCustomLayers(r),this.logger.debug(`Capa personalizada ${e} alternada. Estado: ${r.has(e)}`)}setZoomLevel(e){let o=this.getCurrentState();this.stateSubject.next(Z(I({},o),{zoomLevel:e}))}getZoomLevel(){return this.getCurrentState().zoomLevel}setEditingElement(e){this.editingElement.next(e)}getEditingElement(){return this.editingElement.asObservable()}setMapVisibility(e){this.mapVisible.next(e)}getMapVisibility(){return this.mapVisible.asObservable()}setIsDirty(e){this.updateUnsavedChanges(e)}getIsDirty(){return this.isDirtySubject.asObservable()}hasDirtyChanges(){return this.isDirtySubject.getValue()}setCurrentViewMode(e){this.currentViewModeSubject.next(e)}getCurrentViewMode(){return this.currentViewModeSubject.asObservable()}showSnackbar(e,o="info"){this.logger.info(`[Snackbar] ${e} (${o})`)}addToHistory(e){let o=this.getCurrentState(),r=[...o.historyItems||[],e];r.length>50&&r.shift(),this.stateSubject.next(Z(I({},o),{historyItems:r}))}updateSearchResults(e){let o=this.getCurrentState();this.stateSubject.next(Z(I({},o),{searchResults:e}))}getSearchResults(){return this.getCurrentState().searchResults||[]}setShowSearchWidget(e){this._showSearchWidget.next(e)}setShowElementsPanel(e){this._showElementsPanel.next(e),this.logger.debug(`Panel de elementos: ${e?"visible":"oculto"}`)}getShowElementsPanel(){return this.showElementsPanel}setCurrentTool(e){this.updateCurrentTool(e)}clearElementPreview(){this.updateElementPreview(null),this.logger.debug("Vista previa de elemento limpiada")}setDiagnosticMode(e){this.diagnosticModeSubject.next(e),this.logger.debug(`Modo de diagn\xF3stico ${e?"activado":"desactivado"}`)}getDiagnosticMode(){return this.diagnosticModeSubject.asObservable()}setPositionSelectionActive(e){this.positionSelectionActiveSubject.next(e),this.logger.debug(`Selecci\xF3n de posici\xF3n ${e?"activada":"desactivada"}`)}getPositionSelectionActive(){return this.positionSelectionActiveSubject.asObservable()}setSelectedPosition(e){this.selectedPositionSubject.next(e),this.logger.debug(`Posici\xF3n seleccionada: [${e.lat}, ${e.lng}]`)}getSelectedPosition(){return this.selectedPositionSubject.asObservable()}resetState(){this.stateSubject.next(this.initialState),this.layerService.getLayersAsObservable().pipe(Nt(this.destroy$)).subscribe(e=>{this.updateCustomLayersList(e)}),this.logger.debug("NetworkStateService: estado restablecido a valores iniciales")}setMapCenter(e){this.mapCenter.next(e)}getMapCenterAsObservable(){return this.mapCenter.asObservable()}setMapZoom(e){this.mapZoom.next(e)}getMapZoomAsObservable(){return this.mapZoom.asObservable()}centerMapOnElement(e){e&&e.position&&(this.setMapCenter(e.position),this.setMapZoom(18))}resetMapView(){this.setMapCenter(Si(18.735693,-70.162651)),this.setMapZoom(7)}getMapViewMode(){return this.mapViewMode.asObservable()}setMapViewMode(e){this.mapViewMode.next(e)}getElementEditMode(){return this.elementEditMode.asObservable()}setElementEditMode(e){this.elementEditMode.next(e)}getSelectedConnection(){return this.selectedConnection.asObservable()}getVisibleLayers(){return this.visibleLayers.asObservable()}setVisibleLayers(e){this.visibleLayers.next(e)}getWidgets(){return this.widgets.asObservable()}setWidgets(e){this.widgets.next(e)}updateWidgetVisibility(e,o){let r=this.widgetVisibility.getValue();this.widgetVisibility.next(Z(I({},r),{[e]:o}))}getWidgetVisibility(){return this.widgetVisibility.asObservable()}static \u0275fac=function(o){return new(o||n)(K(pt),K(En))};static \u0275prov=ft({token:n,factory:n.\u0275fac,providedIn:"root"})};var Je=class n{constructor(e,o){this.networkStateService=e;this.logger=o;this.setupStateSubscriptions(),this.singleSelectedElement$=this.selectedElements$.pipe($r(r=>r.length===1?r[0]:null),Nt(this.destroy$))}destroy$=new dt;_mapState={currentTool:"pan",zoomLevel:100,isDarkMode:!1,showMiniMap:!0,historyCount:0,hasUnsavedChanges:!1,layers:[{id:"osm",name:"OpenStreetMap",visible:!0,type:"base",icon:"fa-map",description:"Mapa base est\xE1ndar",order:1},{id:"satellite",name:"Sat\xE9lite",visible:!1,type:"base",icon:"fa-satellite",description:"Vista satelital",order:2},{id:"terrain",name:"Terreno",visible:!1,type:"base",icon:"fa-mountain",description:"Mapa topogr\xE1fico",order:3},{id:"elements",name:"Elementos",visible:!0,type:"overlay",icon:"fa-network-wired",description:"Elementos de red",order:1},{id:"connections",name:"Conexiones",visible:!0,type:"overlay",icon:"fa-project-diagram",description:"Conexiones entre elementos",order:2},{id:"heatmap",name:"Mapa de calor",visible:!1,type:"overlay",icon:"fa-fire",description:"Densidad de elementos",order:3},{id:"alerts",name:"Alertas",visible:!0,type:"overlay",icon:"fa-exclamation-triangle",description:"Alertas y eventos",order:4}]};currentToolSubject=new N(this._mapState.currentTool);zoomLevelSubject=new N(this._mapState.zoomLevel);isDarkModeSubject=new N(this._mapState.isDarkMode);showMiniMapSubject=new N(this._mapState.showMiniMap);historyCountSubject=new N(this._mapState.historyCount);hasUnsavedChangesSubject=new N(this._mapState.hasUnsavedChanges);layersSubject=new N(this._mapState.layers);layerChangesSubject=new dt;selectedElementsSubject=new N([]);connectionToEditSubject=new N(null);currentTool=this.currentToolSubject.asObservable();activeTool$=this.currentToolSubject.asObservable();zoomLevel=this.zoomLevelSubject.asObservable();isDarkMode=this.isDarkModeSubject.asObservable();miniMapVisible=this.showMiniMapSubject.asObservable();historyCount=this.historyCountSubject.asObservable();hasUnsavedChanges=this.hasUnsavedChangesSubject.asObservable();layers=this.layersSubject.asObservable();layerChanges=this.layerChangesSubject.asObservable();selectedElements$=this.selectedElementsSubject.asObservable();singleSelectedElement$;connectionToEdit$=this.connectionToEditSubject.asObservable();get activeLayers(){return this.networkStateService.state$.pipe($r(e=>e.activeLayers?Array.from(e.activeLayers):[]))}setupStateSubscriptions(){this.networkStateService.state$.pipe(Nt(this.destroy$)).subscribe(e=>{this.isDarkModeSubject.getValue()!==e.isDarkMode&&(this.isDarkModeSubject.next(e.isDarkMode),this._mapState.isDarkMode=e.isDarkMode),this.showMiniMapSubject.getValue()!==(e.showMiniMap||this._mapState.showMiniMap)&&(this.showMiniMapSubject.next(e.showMiniMap||this._mapState.showMiniMap),this._mapState.showMiniMap=e.showMiniMap||this._mapState.showMiniMap),this.currentToolSubject.getValue()!==(e.currentTool||this._mapState.currentTool)&&(this.currentToolSubject.next(e.currentTool||this._mapState.currentTool),this._mapState.currentTool=e.currentTool||this._mapState.currentTool)})}openConnectionPropertiesDialog(e){this.logger.debug(`Solicitando apertura de di\xE1logo para editar conexi\xF3n: ${e.id}`),this.logger.debug("Detalles de la conexi\xF3n a editar:",JSON.stringify(e,null,2)),this.connectionToEditSubject.next(e)}clearConnectionToEdit(){this.connectionToEditSubject.next(null)}setTool(e){if(!this.isValidTool(e)){this.logger.warn(`Herramienta no v\xE1lida: ${e}`);return}this._mapState.currentTool=e,this.currentToolSubject.next(e),this.logger.debug(`Herramienta cambiada a: ${e}`)}setActiveTool(e){this.setTool(e)}setDarkMode(e){this.logger.debug(`Solicitando cambio de modo oscuro a NetworkStateService: ${e}`)}isValidTool(e){return["pan","select","measure","areaSelect","connect","zoomIn","zoomOut","fitToScreen","resetZoom","edit","placeElement","moveElement"].includes(e)}setZoomLevel(e){let o=Math.max(10,Math.min(200,e));this._mapState.zoomLevel=o,this.zoomLevelSubject.next(o)}toggleMiniMap(){let e=!this._mapState.showMiniMap;this._mapState.showMiniMap=e,this.showMiniMapSubject.next(e);try{typeof this.networkStateService.setMiniMapVisibility=="function"?this.networkStateService.setMiniMapVisibility(e):this.logger.debug("No se encontr\xF3 m\xE9todo para actualizar minimapa en NetworkStateService")}catch{this.logger.warn("No se pudo actualizar visibilidad del minimapa en el estado global")}}setUnsavedChanges(e){this._mapState.hasUnsavedChanges=e,this.hasUnsavedChangesSubject.next(e),this.networkStateService.updateUnsavedChanges(e)}isMiniMapVisible(){return this._mapState.showMiniMap}getAllLayers(){return[...this._mapState.layers]}toggleLayerVisibility(e){let o=this._mapState.layers.findIndex(s=>s.id===e);if(o===-1)return this.logger.warn(`Capa no encontrada: ${e}`),!1;let r=[...this._mapState.layers];return r[o].type==="base"&&!r[o].visible&&r.forEach((s,h)=>{s.type==="base"&&s.id!==e&&(r[h]=Z(I({},s),{visible:!1}))}),r[o]=Z(I({},r[o]),{visible:!r[o].visible}),this._mapState.layers=r,this.layersSubject.next(r),this.layerChangesSubject.next(),!0}addLayer(e){if(this._mapState.layers.some(r=>r.id===e.id))return this.logger.warn(`Ya existe una capa con ID: ${e.id}`),!1;let o=[...this._mapState.layers,e];return this._mapState.layers=o,this.layersSubject.next(o),this.layerChangesSubject.next(),!0}removeLayer(e){if(!this._mapState.layers.some(r=>r.id===e))return this.logger.warn(`No existe una capa con ID: ${e}`),!1;let o=this._mapState.layers.filter(r=>r.id!==e);return this._mapState.layers=o,this.layersSubject.next(o),this.layerChangesSubject.next(),!0}setSelectedElements(e){this.selectedElementsSubject.next(e),this.logger.debug(`Elementos seleccionados actualizados: ${e.length} elementos.`)}clearSelectedElements(){this.selectedElementsSubject.next([]),this.logger.debug("Selecci\xF3n de elementos limpiada.")}getSelectedElements(){return this.selectedElementsSubject.getValue()}processElementClick(e,o,r){let s=[...this.selectedElementsSubject.getValue()],h=e.id;if(r){let c=s.findIndex(f=>f.id===h);c>-1?s.splice(c,1):s.push(e),this.selectedElementsSubject.next(s)}else if(o){let c=s.findIndex(f=>f.id===h);c>-1?s.splice(c,1):s.push(e),this.selectedElementsSubject.next(s)}else s.length===1&&s[0].id===h||this.selectedElementsSubject.next([e]);this.logger.debug(`Selecci\xF3n despu\xE9s de clic: ${this.selectedElementsSubject.getValue().length} elementos`,this.selectedElementsSubject.getValue())}destroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(o){return new(o||n)(K(Mn),K(pt))};static \u0275prov=ft({token:n,factory:n.\u0275fac,providedIn:"root"})};var el=Li(ki());var ti=class n{constructor(e,o,r,s){this.elementService=e;this.logger=o;this.zone=r;this.http=s}destroy$=new dt;loadedElements=[];elementsById=new Map;elementsByType=new Map;elementsChanged$=new dt;connectionsChanged$=new dt;elementSelected$=new dt;loadedConnections=[];loadElementsProgressively(e){let r=I(I({},{batchSize:50,maxElements:1e3}),e),s=new dt;return this.clear(),this.zone.runOutsideAngular(()=>{this.elementService.getAllElements().pipe(za(1),Ee(h=>(this.logger.error("Error al cargar elementos:",h),s.next({loadedElements:0,totalElements:0,success:!1,error:h}),s.complete(),At([]))),Nt(this.destroy$)).subscribe(h=>{let c=h.length,f=0,_=g=>{let l=Math.min(g+r.batchSize,Math.min(c,r.maxElements)),m=h.slice(g,l);if(this.processElements(m),f=l,r.progressCallback){let v=Math.round(f/Math.min(c,r.maxElements)*100);this.zone.run(()=>r.progressCallback?.(v))}r.elementsCallback&&this.zone.run(()=>r.elementsCallback?.(m)),l<Math.min(c,r.maxElements)?setTimeout(()=>_(l),100):this.zone.run(()=>{s.next({loadedElements:f,totalElements:c,success:!0}),s.complete(),this.elementsChanged$.next()})};_(0)})}),s.asObservable()}processElements(e){for(let o of e)this.loadedElements.push(o),o.id?this.elementsById.set(o.id,o):this.logger.warn("Elemento sin ID ignorado para mapeo ID:",o),this.elementsByType.has(o.type)||this.elementsByType.set(o.type,[]),this.elementsByType.get(o.type)?.push(o)}getElementById(e){return this.elementsById.get(e)}getElementsByType(e){return this.elementsByType.get(e)||[]}getAllElements(){return this.logger.debug("[MapElementManagerService] getAllElements solicitados"),[...this.loadedElements]}getFilteredElements(e){return this.loadedElements.filter(e)}searchElements(e){if(!e||e.trim()==="")return[];let o=e.toLowerCase();return this.loadedElements.filter(r=>!!(r.id&&r.id.toLowerCase().includes(o)||r.name&&r.name.toLowerCase().includes(o)||r.description&&r.description.toLowerCase().includes(o)))}clear(){this.loadedElements=[],this.elementsById.clear(),this.elementsByType.clear()}updateElement(e){if(!e.id)return this.logger.warn("No se puede actualizar un elemento sin ID:",e),!1;if(!this.elementsById.has(e.id))return this.logger.warn(`Elemento con ID ${e.id} no existe para actualizar`),!1;let o=this.elementsById.get(e.id),r=Z(I(I({},o),e),{createdAt:o.createdAt||new Date,updatedAt:new Date});this.elementsById.set(e.id,r);let s=this.loadedElements.findIndex(h=>h.id===e.id);return s!==-1?this.loadedElements[s]=r:this.logger.warn(`Elemento ${e.id} no encontrado en el arreglo para actualizar`),this.elementsChanged$.next(),this.logger.debug(`Elemento actualizado: ${e.id}`),!0}addElement(e){e.id||(this.logger.warn("Elemento sin ID no puede ser a\xF1adido:",e),e.id=`element-${Date.now()}-${Math.floor(Math.random()*1e3)}`,this.logger.debug("ID generado para el elemento:",e.id)),this.elementsById.set(e.id,e),this.loadedElements.push(e),this.elementsChanged$.next(),this.logger.debug(`Elemento a\xF1adido: ${e.id}, total: ${this.loadedElements.length}`)}removeElement(e){if(!this.elementsById.has(e))return!1;try{let o=this.elementsById.get(e),r=this.elementsByType.get(o.type);if(r){let h=r.findIndex(c=>c.id===e);h>=0&&r.splice(h,1)}let s=this.loadedElements.findIndex(h=>h.id===e);return s>=0&&this.loadedElements.splice(s,1),this.elementsById.delete(e),this.elementsChanged$.next(),!0}catch(o){return this.logger.error("Error al eliminar elemento:",o),!1}}selectElement(e){let o=this.elementsById.get(e);o&&this.zone.run(()=>{this.elementSelected$.next(o)})}get elementsChanged(){return this.elementsChanged$.asObservable()}get connectionsChanged(){return this.connectionsChanged$.asObservable()}get elementSelected(){return this.elementSelected$.asObservable()}destroy(){this.destroy$.next(),this.destroy$.complete(),this.clear()}getElementsByFilters(e){return this.http.post("/api/elements/filter",e)}getElementsInBounds(e){return this.loadedElements.filter(o=>{if(!o.position)return!1;let r=el.latLng(o.position.lat,o.position.lng);return e.contains(r)})}getAllConnections(){return this.logger.debug("[MapElementManagerService] getAllConnections solicitados"),[...this.loadedConnections]}addConnection(e){this.loadedConnections.push(e),this.logger.debug(`[MapElementManagerService] Conexi\xF3n a\xF1adida entre ${e.sourceElementId} y ${e.targetElementId}. Total: ${this.loadedConnections.length}`),this.connectionsChanged$.next()}updateConnection(e){if(!e.id)return this.logger.warn("[MapElementManagerService] No se puede actualizar una conexi\xF3n sin ID:",e),!1;let o=this.loadedConnections.findIndex(r=>r.id===e.id);if(o!==-1){let r=this.loadedConnections[o];return this.loadedConnections[o]=Z(I(I({},r),e),{updatedAt:new Date}),this.logger.debug(`[MapElementManagerService] Conexi\xF3n actualizada: ${e.id}`),this.connectionsChanged$.next(),!0}else return this.logger.warn(`[MapElementManagerService] Conexi\xF3n con ID ${e.id} no encontrada para actualizar.`),!1}static \u0275fac=function(o){return new(o||n)(K(Ks),K(pt),K(Ye),K(yn))};static \u0275prov=ft({token:n,factory:n.\u0275fac,providedIn:"root"})};var Sn=class n{constructor(e){this.logger=e}eventSubject=new dt;emit(e){e.timestamp||(e.timestamp=new Date),this.logger.debug(`[EventBus] Emitiendo evento: ${e.type}`,e),this.eventSubject.next(e)}on(e){return this.eventSubject.asObservable().pipe(Na(o=>o.type===e))}emitMapError(e,o){this.emit({type:"MAP_ERROR",timestamp:new Date,payload:{error:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:void 0,source:o},source:o})}emitElementSelected(e){this.emit({type:"ELEMENT_SELECTED",timestamp:new Date,payload:{element:e},source:e?.id})}emitConnectionSelected(e){this.emit({type:"CONNECTION_SELECTED",timestamp:new Date,payload:{connection:e},source:e?.id})}emitLayerToggled(e,o){this.emit({type:"LAYER_TOGGLED",timestamp:new Date,payload:{layerId:e,visible:o},source:e})}emitWidgetLoaded(e,o){this.emit({type:"WIDGET_LOADED",timestamp:new Date,payload:{widgetId:e,success:o},source:e})}emitWidgetError(e,o){this.emit({type:"WIDGET_ERROR",timestamp:new Date,payload:{widgetId:e,error:o instanceof Error?o.message:String(o),stack:o instanceof Error?o.stack:void 0},source:e})}static \u0275fac=function(o){return new(o||n)(K(pt))};static \u0275prov=ft({token:n,factory:n.\u0275fac,providedIn:"root"})};var kn=class n{logger=Et(pt);initialState={center:[0,0],zoom:5,activeTool:"pan",selectedElementIds:[],selectedConnectionIds:[],isEditing:!1,isMeasuring:!1,isConnecting:!1};state=I({},this.initialState);mapStateSubject=new N(this.state);centerSubject=new N(this.state.center);zoomSubject=new N(this.state.zoom);activeToolSubject=new N(this.state.activeTool);selectedElementIdsSubject=new N(this.state.selectedElementIds);selectedConnectionIdsSubject=new N(this.state.selectedConnectionIds);mapState$=this.mapStateSubject.asObservable();center$=this.centerSubject.asObservable();zoom$=this.zoomSubject.asObservable();activeTool$=this.activeToolSubject.asObservable();selectedElementIds$=this.selectedElementIdsSubject.asObservable();selectedConnectionIds$=this.selectedConnectionIdsSubject.asObservable();constructor(){this.logger.debug("MapStateService inicializado")}getState(){return I({},this.state)}setState(e){this.state=I(I({},this.state),e),this.mapStateSubject.next(this.state),e.center!==void 0&&this.centerSubject.next(e.center),e.zoom!==void 0&&this.zoomSubject.next(e.zoom),e.activeTool!==void 0&&this.activeToolSubject.next(e.activeTool),e.selectedElementIds!==void 0&&this.selectedElementIdsSubject.next(e.selectedElementIds),e.selectedConnectionIds!==void 0&&this.selectedConnectionIdsSubject.next(e.selectedConnectionIds),this.logger.debug("Estado del mapa actualizado",this.state)}resetState(){this.setState(this.initialState),this.logger.debug("Estado del mapa restablecido a valores iniciales")}setCenter(e){this.setState({center:e})}setZoom(e){this.setState({zoom:e})}setBounds(e){this.setState({bounds:e})}setActiveTool(e){let o=e==="edit",r=e==="measure",s=e==="connect";this.setState({activeTool:e,isEditing:o,isMeasuring:r,isConnecting:s}),this.logger.debug(`Herramienta activa cambiada a: ${e}`)}selectElement(e,o=!0){let r=o?[e]:[...this.state.selectedElementIds,e];this.setState({selectedElementIds:r}),this.logger.debug(`Elemento seleccionado: ${e}`)}deselectElement(e){let o=this.state.selectedElementIds.filter(r=>r!==e);this.setState({selectedElementIds:o}),this.logger.debug(`Elemento deseleccionado: ${e}`)}selectElements(e,o=!0){let r=o?[...e]:[...this.state.selectedElementIds,...e];this.setState({selectedElementIds:r}),this.logger.debug(`${e.length} elementos seleccionados`)}clearElementSelection(){this.setState({selectedElementIds:[]}),this.logger.debug("Selecci\xF3n de elementos limpiada")}selectConnection(e,o=!0){let r=o?[e]:[...this.state.selectedConnectionIds,e];this.setState({selectedConnectionIds:r}),this.logger.debug(`Conexi\xF3n seleccionada: ${e}`)}deselectConnection(e){let o=this.state.selectedConnectionIds.filter(r=>r!==e);this.setState({selectedConnectionIds:o}),this.logger.debug(`Conexi\xF3n deseleccionada: ${e}`)}clearConnectionSelection(){this.setState({selectedConnectionIds:[]}),this.logger.debug("Selecci\xF3n de conexiones limpiada")}clearAllSelections(){this.setState({selectedElementIds:[],selectedConnectionIds:[]}),this.logger.debug("Todas las selecciones limpiadas")}static \u0275fac=function(o){return new(o||n)};static \u0275prov=ft({token:n,factory:n.\u0275fac,providedIn:"root"})};var Tn=class n{constructor(e){this.logger=e}VIEWPORT_MARGIN=100;calculateVisibleElements(e){return Aa(this,null,function*(){let{viewport:o,zoom:r,pan:s,elements:h}=e;if(!h||h.length===0)return[];let c=this.calculateViewportBounds(o,r,s);return new Promise(f=>{setTimeout(()=>{let _=h.filter(g=>this.isElementInViewport(g,c)&&!!g.id).map(g=>g.id);f(_)},0)})})}calculateViewportBounds(e,o,r){let s=o/100,h=r.x-(e.width/2+this.VIEWPORT_MARGIN)/s,c=r.x+(e.width/2+this.VIEWPORT_MARGIN)/s,f=r.y-(e.height/2+this.VIEWPORT_MARGIN)/s,_=r.y+(e.height/2+this.VIEWPORT_MARGIN)/s;return{minX:h,minY:f,maxX:c,maxY:_}}isElementInViewport(e,o){return!e.position||typeof e.position.lat!="number"||typeof e.position.lng!="number"?!1:e.position.lng>=o.minX&&e.position.lng<=o.maxX&&e.position.lat>=o.minY&&e.position.lat<=o.maxY}calculateDetailLevel(e){return e>150?"high":e>80?"medium":"low"}optimizePerformance(){this.logger.debug("Aplicando optimizaciones de rendimiento"),this.maxRenderElements=100,this.renderQuality="low",this.clusteringEnabled=!0,this.updateInterval=500,this.logger.info("Modo de rendimiento optimizado activado")}maxRenderElements=200;renderQuality="medium";clusteringEnabled=!1;updateInterval=250;static \u0275fac=function(o){return new(o||n)(K(pt))};static \u0275prov=ft({token:n,factory:n.\u0275fac,providedIn:"root"})};var Pn=class n{constructor(e,o){this.elementManager=e;this.logger=o;this.elementManager.elementsChanged.subscribe(()=>{this.elementsChangedSubject.next()})}elementsChangedSubject=new dt;selectedElement=null;get elementsChanged(){return this.elementsChangedSubject.asObservable()}getAllElements(){try{return this.elementManager.getAllElements()}catch(e){return this.logger.error("Error al obtener elementos en el adaptador",e),[]}}getElementById(e){try{return this.elementManager.getElementById(e)}catch(o){this.logger.error(`Error al obtener elemento con ID ${e} en el adaptador`,o);return}}getElementsByType(e){try{return this.elementManager.getElementsByType(e)}catch(o){return this.logger.error(`Error al obtener elementos de tipo ${e} en el adaptador`,o),[]}}selectElement(e){try{this.elementManager.selectElement(e),this.selectedElement=this.getElementById(e)||null}catch(o){this.logger.error(`Error al seleccionar elemento con ID ${e} en el adaptador`,o)}}deselectElement(){try{this.selectedElement=null}catch(e){this.logger.error("Error al deseleccionar elemento en el adaptador",e)}}getSelectedElement(){return this.selectedElement}searchElements(e){try{return this.elementManager.searchElements(e)}catch(o){return this.logger.error(`Error al buscar elementos con texto "${e}" en el adaptador`,o),[]}}addElement(e){try{if(console.log("MapElementManagerAdapter: A\xF1adiendo elemento",e),!e||!e.type){this.logger.error("Elemento inv\xE1lido para a\xF1adir",e);return}if(!e.position||typeof e.position.lat!="number"||typeof e.position.lng!="number"){this.logger.error("Posici\xF3n inv\xE1lida para a\xF1adir elemento",e);return}this.elementManager.addElement(e),this.logger.debug(`Elemento a\xF1adido correctamente: ${e.id}, tipo: ${e.type}`),this.elementsChangedSubject.next()}catch(o){this.logger.error("Error al a\xF1adir elemento en el adaptador",o)}}updateElement(e){try{return this.elementManager.updateElement(e)}catch(o){return this.logger.error(`Error al actualizar elemento con ID ${e.id} en el adaptador`,o),!1}}removeElement(e){try{return this.elementManager.removeElement(e)}catch(o){return this.logger.error(`Error al eliminar elemento con ID ${e} en el adaptador`,o),!1}}addConnection(e){try{return this.elementManager.addConnection(e),this.logger.info("[MapElementManagerAdapter] addConnection llamada a elementManager",e),At(e)}catch(o){throw this.logger.error("[MapElementManagerAdapter] Error al intentar a\xF1adir conexi\xF3n v\xEDa elementManager",o),o}}updateConnection(e){try{let o=this.elementManager.updateConnection(e);return this.logger.info("[MapElementManagerAdapter] updateConnection llamada a elementManager",e,`Success: ${o}`),At(o)}catch(o){return this.logger.error("[MapElementManagerAdapter] Error al intentar actualizar conexi\xF3n v\xEDa elementManager",o),At(!1)}}updateElementPosition(e,o,r){try{console.log(`MapElementManagerAdapter: Actualizando posici\xF3n del elemento ${e} a [${r}, ${o}]`);let s=this.getElementById(e);if(!s)return this.logger.error(`No se encontr\xF3 el elemento con ID ${e} para actualizar posici\xF3n`),!1;let h=Z(I({},s),{position:{lat:r,lng:o,coordinates:[o,r],type:"Point"}}),c=this.updateElement(h);return c&&(this.logger.debug(`Posici\xF3n del elemento ${e} actualizada correctamente`),this.elementsChangedSubject.next()),c}catch(s){return this.logger.error(`Error al actualizar posici\xF3n del elemento ${e}:`,s),!1}}static \u0275fac=function(o){return new(o||n)(K(ti),K(pt))};static \u0275prov=ft({token:n,factory:n.\u0275fac,providedIn:"root"})};var et=Li(ki()),t_=Li(nl());var In=class n{constructor(e,o,r,s,h){this.zone=e;this.logger=o;this.virtualizationService=r;this.mapStateManagerService=s;this.elementManagerAdapter=h;this.startFPSMeasurement(),this.logger.debug("[NetworkMapRendererService] Constructor"),document.addEventListener("keydown",this.handleKeyDown)}elementMarkers=new Map;connectionLines=new Map;connectionVertexMarkers=new Map;map=null;elementsLayer=et.default.layerGroup();connectionsLayer=et.default.layerGroup();clustersLayer=null;labelsLayer=et.default.layerGroup();options={darkMode:!1,useWebGL:!0,clusteringEnabled:!0,progressiveLoading:!0,showConnections:!0};_fps=0;_renderedElements=0;_visibleElements=0;lastFrameTime=0;frameCount=0;clusterGroup=null;performanceConfig={enableClustering:!0,clusterRadius:80,maxClusterRadius:80,animationDuration:300,disableClusteringAtZoom:18,maxZoom:19,useWebGL:!0,progressiveLoading:!0,useDisplayBuffers:!0,showCoverageOnHover:!1};elementsCountSubject=new N(0);elementsCountChange$=this.elementsCountSubject.asObservable();renderCompleteSubject=new dt;renderComplete$=this.renderCompleteSubject.asObservable();emergencyMode=!1;renderQueue=[];renderTimer=null;maxElementsPerFrame=10;isVirtualizationEnabled=!0;currentBounds=null;currentEditingConnection=null;initialize(e,o){this.map=e,o&&(this.options=I(I({},this.options),o)),this.elementsLayer.addTo(e),this.connectionsLayer.addTo(e),this.labelsLayer.addTo(e),this.options.clusteringEnabled&&this.initClustering(),this.startFPSMeasurement(),this.logger.debug("NetworkMapRenderer inicializado")}initClustering(){if(!this.map){this.logger.warn("[Renderer] Mapa no inicializado, no se puede inicializar clustering."),this.options.clusteringEnabled=!1;return}let e=!1;if(typeof et.default.markerClusterGroup=="function")try{this.clustersLayer=et.default.markerClusterGroup({maxClusterRadius:50,spiderfyOnMaxZoom:!0,showCoverageOnHover:!1,zoomToBoundsOnClick:!0}),this.map&&this.clustersLayer&&(this.map.addLayer(this.clustersLayer),this.logger.info("[Renderer] Clustering inicializado exitosamente con L.markerClusterGroup()."),e=!0)}catch(o){this.logger.warn(`[Renderer] Fall\xF3 L.markerClusterGroup(): ${o.message}. Se intentar\xE1n alternativas.`,o),this.clustersLayer&&this.map&&this.map.hasLayer(this.clustersLayer)&&this.map.removeLayer(this.clustersLayer),this.clustersLayer=null}else this.logger.debug("[Renderer] L.markerClusterGroup no es una funci\xF3n.");if(!e){let o=et.default.MarkerClusterGroup;if(typeof o=="function")try{this.clustersLayer=new o({maxClusterRadius:50,spiderfyOnMaxZoom:!0,showCoverageOnHover:!1,zoomToBoundsOnClick:!0}),this.map&&this.clustersLayer&&(this.map.addLayer(this.clustersLayer),this.logger.info("[Renderer] Clustering inicializado exitosamente con new L.MarkerClusterGroup()."),e=!0)}catch(r){this.logger.warn(`[Renderer] Fall\xF3 new L.MarkerClusterGroup(): ${r.message}`),console.error("[Renderer] Error object new L.MarkerClusterGroup:",r),this.clustersLayer&&this.map&&this.map.hasLayer(this.clustersLayer)&&this.map.removeLayer(this.clustersLayer),this.clustersLayer=null}else this.logger.debug("[Renderer] L.MarkerClusterGroup (PascalCase) no es una funci\xF3n.")}e?(this.options.clusteringEnabled=!0,this.clusterGroup=this.clustersLayer):(this.logger.error("[Renderer] No se pudo inicializar el clustering. Clustering deshabilitado."),this.options.clusteringEnabled=!1,this.clustersLayer=null,this.clusterGroup=null)}renderElements(e,o=null){this.map&&(this.emergencyMode&&(e=this.limitElementsForEmergencyMode(e)),!o&&this.map&&(o=this.map.getBounds()),this.zone.runOutsideAngular(()=>{this.cancelPendingRenders(),this.cleanupInvisibleMarkers(e);let{visibleElements:r,offscreenElements:s}=this.splitElementsByVisibility(e,o);this._visibleElements=r.length,this.renderQueue=[...r],this.processRenderQueue(),s.length>0&&setTimeout(()=>{this.emergencyMode||(this.renderQueue=[...this.renderQueue,...s])},2e3)}))}limitElementsForEmergencyMode(e){if(e.length<=50)return e;let r=e.filter(s=>s.type==="OLT"||s.type==="FDP"||s.type==="SPLITTER").slice(0,50);if(r.length<50){let s=e.filter(h=>h.type!=="OLT"&&h.type!=="FDP"&&h.type!=="SPLITTER").slice(0,50-r.length);return[...r,...s]}return r}splitElementsByVisibility(e,o){if(!o)return{visibleElements:e.slice(0,100),offscreenElements:e.slice(100)};let r=[],s=[],h=100;for(let c of e){if(!c.position){s.push(c);continue}let f=new et.default.LatLng(c.position.lat,c.position.lng);o.contains(f)&&r.length<h?r.push(c):s.push(c)}return{visibleElements:r,offscreenElements:s}}cancelPendingRenders(){this.renderTimer&&(cancelAnimationFrame(this.renderTimer),this.renderTimer=null),this.renderQueue=[]}processRenderQueue(){if(this.renderQueue.length===0){this._renderedElements=this.elementMarkers.size,this.renderCompleteSubject.next();return}this.renderQueue.splice(0,this.maxElementsPerFrame).forEach(o=>{this.createOrUpdateMarker(o)}),this._renderedElements=this.elementMarkers.size,this.renderTimer=requestAnimationFrame(()=>{this.processRenderQueue()})}createOrUpdateMarker(e){if(!e.id){this.logger.warn("[Renderer] Elemento sin ID no puede ser renderizado",e);return}if(!e.position){this.logger.warn(`[Renderer] Elemento ${e.id} sin posici\xF3n no puede ser renderizado.`);return}let o=et.default.latLng(e.position.lat,e.position.lng),r=this.elementMarkers.get(e.id),s;if(r){let h=r.getLatLng();(h.lat!==o.lat||h.lng!==o.lng)&&r.setLatLng(o);let c=this.getMarkerIcon(e);r.setIcon(c),s=r}else{let h=this.getMarkerIcon(e),c=et.default.marker(o,{icon:h,draggable:!1,title:e.name||`${e.type} ${e.id}`,riseOnHover:!0});c.element=e,this.addMarkerEvents(c,e),this.elementMarkers.set(e.id,c),s=c,this.options.clusteringEnabled&&this.clustersLayer?(this.clustersLayer.addLayer(c),this.logger.debug(`[Renderer] Marcador para elemento ${e.id} (${e.type}) a\xF1adido al cl\xFAster.`)):(this.elementsLayer.addLayer(c),this.logger.debug(`[Renderer] Marcador para elemento ${e.id} (${e.type}) a\xF1adido a la capa normal.`))}e.type==="MANGA"&&this.logger.info(`[Renderer] Elemento MANGA procesado: ${e.id} en posici\xF3n [${o.lat}, ${o.lng}]`)}addMarkerEvents(e,o){e.on("click",r=>{this.mapStateManagerService.setSelectedElements([o]),this.logger.debug(`[Renderer] Elemento seleccionado por clic en marcador: ${o.id} (${o.type})`),et.default.DomEvent.stopPropagation(r)}),e.on("dblclick",r=>{this.mapStateManagerService.setSelectedElements([o]),this.logger.debug(`[Renderer] Doble clic en marcador: ${o.id} (${o.type})`),et.default.DomEvent.stopPropagation(r)}),e.on("mouseover",()=>{e.openTooltip()}),e.on("mouseout",()=>{e.closeTooltip()})}renderConnections(e){if(!this.map){this.logger.warn("[Renderer] Mapa no inicializado, no se pueden renderizar conexiones.");return}this.logger.info(`[Renderer] Renderizando ${e.length} conexiones.`);let o=new Set(e.filter(r=>r.id).map(r=>r.id));this.connectionLines.forEach((r,s)=>{o.has(s)||(this.connectionsLayer.removeLayer(r),typeof r.disableEdit=="function"&&r.disableEdit(),this.connectionLines.delete(s),this.logger.debug(`[Renderer] Conexi\xF3n eliminada del mapa: ${s}`))}),e.forEach(r=>{if(!r.id){this.logger.warn("[Renderer] Se intent\xF3 renderizar una conexi\xF3n sin ID.",r);return}this.createOrUpdateConnection(r)})}createOrUpdateConnection(e){if(!this.map)return;if(!e.id){this.logger.error("[Renderer] Intento de crear/actualizar conexi\xF3n sin ID.");return}let o=this.elementMarkers.get(e.sourceElementId),r=this.elementMarkers.get(e.targetElementId);if(this.logger.info(`[Renderer] createOrUpdateConnection for ${e.id}: Source ID: ${e.sourceElementId} -> Marker found: ${!!o}, Target ID: ${e.targetElementId} -> Marker found: ${!!r}`),!o||!r){this.logger.warn(`[Renderer] No se encontraron marcadores de origen o destino para la conexi\xF3n ${e.id}. No se puede renderizar.`);let c=this.connectionLines.get(e.id);c&&(this.connectionsLayer.removeLayer(c),typeof c.disableEdit=="function"&&c.disableEdit(),this.connectionLines.delete(e.id));return}let s=[o.getLatLng(),...e.vertices?.map(c=>et.default.latLng(c.lat,c.lng))||[],r.getLatLng()],h=this.connectionLines.get(e.id);h?(h.setLatLngs(s),this.logger.debug(`[Renderer] Conexi\xF3n actualizada: ${e.id}`)):(h=et.default.polyline(s,{color:e.metadata?.color||"#3388ff",weight:e.metadata?.weight||3,opacity:e.metadata?.opacity||.7}).addTo(this.connectionsLayer),this.connectionLines.set(e.id,h),this.logger.debug(`[Renderer] Conexi\xF3n creada: ${e.id}`),this.map?h.enableEdit(this.map):this.logger.warn(`[Renderer] No se pudo habilitar la edici\xF3n para ${e.id} porque this.map es null.`),this.setupPolylineEditEvents(h,e))}setupPolylineEditEvents(e,o){this.map&&(e.on("editable:editing",r=>{this.logger.debug(`[Renderer] Evento 'editable:editing' para conexi\xF3n ${o.id}. Datos del evento:`,r),this.handlePolylineEdit(r.layer,o),this.currentEditingConnection={polyline:e,connection:o}}),e.on("editable:vertex:deleted",r=>{this.logger.info(`[Renderer] Evento 'editable:vertex:deleted' para conexi\xF3n ${o.id}. Datos del evento:`,r),this.handlePolylineEdit(r.layer,o),this.currentEditingConnection={polyline:e,connection:o}}),e.on("editable:vertex:dragend",r=>{this.logger.info(`[Renderer] Evento 'editable:vertex:dragend' para conexi\xF3n ${o.id}. Datos del evento:`,r),this.handlePolylineEdit(r.layer,o),this.currentEditingConnection={polyline:e,connection:o}}),e.on("click",r=>{et.default.DomEvent.stopPropagation(r.originalEvent),this.logger.debug(`[Renderer] Conexi\xF3n seleccionada: ${o.id}`),this.currentEditingConnection&&this.currentEditingConnection.polyline!==e&&this.currentEditingConnection.polyline.editor&&this.currentEditingConnection.polyline.disableEdit(),this.currentEditingConnection={polyline:e,connection:o},e.editEnabled||(e.enableEdit(this.map),e.editEnabled=!0,e.getElement()?.classList.add("connection-editing"),this.logger.debug(`[Renderer] Editor de v\xE9rtices activado para conexi\xF3n: ${o.id}`))}),e.on("dblclick",r=>{et.default.DomEvent.stopPropagation(r.originalEvent),this.logger.debug(`[Renderer] Solicitando edici\xF3n de propiedades para conexi\xF3n: ${o.id}`),this.currentEditingConnection={polyline:e,connection:o},this.mapStateManagerService.openConnectionPropertiesDialog(o)}),this.logger.debug(`[Renderer] Eventos de edici\xF3n configurados para conexi\xF3n: ${o.id}`))}handlePolylineEdit(e,o){if(!this.map)return;let r=e.getLatLngs(),s=[];r.length>2&&(s=r.slice(1,r.length-1).map(c=>Si(c.lat,c.lng)));let h=Z(I({},o),{vertices:s});this.logger.info(`[Renderer] Actualizando conexi\xF3n ${o.id} con nuevos v\xE9rtices:`,h.vertices),this.elementManagerAdapter.updateConnection(h).subscribe({next:c=>{if(c)this.logger.info(`[Renderer] Conexi\xF3n ${o.id} actualizada en backend tras edici\xF3n.`);else{this.logger.warn(`[Renderer] Fall\xF3 la actualizaci\xF3n en backend de la conexi\xF3n ${o.id} tras edici\xF3n. Revirtiendo cambios visuales.`);let f=[this.elementMarkers.get(o.sourceElementId).getLatLng(),...o.vertices?.map(_=>et.default.latLng(_.lat,_.lng))||[],this.elementMarkers.get(o.targetElementId).getLatLng()];e.setLatLngs(f),e.editor?.reset()}},error:c=>{this.logger.error(`[Renderer] Error al actualizar conexi\xF3n ${o.id} en backend tras edici\xF3n:`,c);let f=[this.elementMarkers.get(o.sourceElementId).getLatLng(),...o.vertices?.map(_=>et.default.latLng(_.lat,_.lng))||[],this.elementMarkers.get(o.targetElementId).getLatLng()];e.setLatLngs(f),e.editor?.reset()}})}cleanupInvisibleMarkers(e){let o=new Set(e.map(r=>r.id));this.elementMarkers.forEach((r,s)=>{o.has(s)||(this.options.clusteringEnabled&&this.clustersLayer?this.clustersLayer.removeLayer(r):this.elementsLayer.removeLayer(r),this.elementMarkers.delete(s))})}clearAll(){this.map&&(this.logger.debug("[Renderer] Limpiando todas las capas del renderer."),this.connectionsLayer.clearLayers(),this.elementsLayer.clearLayers(),this.labelsLayer.clearLayers(),this.elementMarkers.clear(),this.connectionLines.forEach(e=>e.disableEdit()),this.connectionLines.clear())}updateOptions(e){let o=I({},this.options);this.options=I(I({},this.options),e),o.clusteringEnabled!==this.options.clusteringEnabled&&this.handleClusteringChange()}handleClusteringChange(){if(!this.map)return;let e=[];this.elementMarkers.forEach((o,r)=>{o.element&&e.push(o.element)}),this.clearAll(),this.options.clusteringEnabled&&this.initClustering(),this.renderElements(e)}startFPSMeasurement(){this.lastFrameTime=performance.now(),this.frameCount=0;let e=()=>{this.frameCount++;let o=performance.now(),r=o-this.lastFrameTime;r>=1e3&&(this._fps=Math.round(this.frameCount*1e3/r),this.frameCount=0,this.lastFrameTime=o),requestAnimationFrame(e)};requestAnimationFrame(e)}get performanceMetrics(){return{fps:this._fps,rendered:this._renderedElements,visible:this._visibleElements}}destroy(){this.clearAll(),this.map=null,document.removeEventListener("keydown",this.handleKeyDown)}getUseWebGL(){return this.performanceConfig.useWebGL}getProgressiveLoading(){return this.performanceConfig.progressiveLoading}getClusteringEnabled(){return this.performanceConfig.enableClustering}updateBaseLayer(e,o){if(!e)return;e.eachLayer(s=>{s instanceof et.default.TileLayer&&e.removeLayer(s)});let r={crossOrigin:!0,updateWhenIdle:!0,updateWhenZooming:!1,keepBuffer:2,maxZoom:this.performanceConfig.maxZoom,useCache:!0,useOnlyCache:!1};switch(o){case"dark":et.default.tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",Z(I({},r),{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',subdomains:"abcd"})).addTo(e);break;case"satellite":et.default.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",Z(I({},r),{attribution:"Tiles &copy; Esri"})).addTo(e);break;case"hybrid":et.default.tileLayer("https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}",Z(I({},r),{attribution:"Map data &copy; Google"})).addTo(e);break;case"light":et.default.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",Z(I({},r),{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',subdomains:"abcd"})).addTo(e);break;case"offline":et.default.tileLayer("assets/leaflet/offline-tiles/{z}/{x}/{y}.png",Z(I({},r),{errorTileUrl:"assets/leaflet/error-tiles/error-tile.png",maxZoom:18,minZoom:10})).addTo(e);break;case"osm":default:et.default.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",Z(I({},r),{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'})).addTo(e);break}}optimizeForHardware(e,o){if(e){switch(o){case"low":if(this.performanceConfig.enableClustering=!0,this.performanceConfig.clusterRadius=100,this.performanceConfig.animationDuration=0,this.clusterGroup){let r=this.clusterGroup;r&&r.options&&(r.options.maxClusterRadius=100,r.options.animate=!1,r.options.animateAddingMarkers=!1)}et.default.Util.requestAnimFrame=function(r,s,h){return setTimeout(r.bind(s),100)};break;case"medium":if(this.performanceConfig.enableClustering=!0,this.performanceConfig.clusterRadius=80,this.performanceConfig.animationDuration=200,this.clusterGroup){let r=this.clusterGroup;r&&r.options&&(r.options.maxClusterRadius=80,r.options.animate=!0,r.options.animateAddingMarkers=!1)}break;case"high":if(this.performanceConfig.enableClustering=!0,this.performanceConfig.clusterRadius=60,this.performanceConfig.animationDuration=300,this.clusterGroup){let r=this.clusterGroup;r&&r.options&&(r.options.maxClusterRadius=60,r.options.animate=!0,r.options.animateAddingMarkers=!0)}break}e&&e.invalidateSize()}}cleanup(){this.clusterGroup=null}enableEmergencyMode(){this.emergencyMode=!0,this.maxElementsPerFrame=5,this.updateOptions({useWebGL:!1,progressiveLoading:!0,clusteringEnabled:!0}),this.clearAll(),this.logger.warn("Modo de emergencia activado para rendimiento")}disableEmergencyMode(){this.emergencyMode=!1,this.maxElementsPerFrame=10,this.logger.info("Modo de emergencia desactivado")}getMarkerIcon(e){let o="assets/leaflet/map-icons/default.svg",r=[28,28],s=[14,14],h="network-element-marker";return e.type&&(o=`assets/leaflet/map-icons/${e.type.toLowerCase()}.svg`),e.status&&(h+=` status-${e.status.toLowerCase()}`),et.default.icon({iconUrl:o,iconSize:r,iconAnchor:s,className:h})}handleKeyDown=e=>{e.key==="Enter"&&this.currentEditingConnection&&(this.logger.debug("[Renderer] Tecla Enter presionada, finalizando edici\xF3n de conexi\xF3n."),this.finishConnectionEditing()),(e.key==="Delete"||e.key==="Del")&&this.currentEditingConnection&&(this.logger.debug("[Renderer] Tecla Delete presionada, eliminando conexi\xF3n seleccionada."),this.deleteSelectedConnection())};finishConnectionEditing(){this.currentEditingConnection&&(this.logger.info(`[Renderer] Finalizando edici\xF3n de conexi\xF3n: ${this.currentEditingConnection.connection.id}`),this.currentEditingConnection.polyline&&this.currentEditingConnection.polyline.editor&&(this.currentEditingConnection.polyline.disableEdit(),this.currentEditingConnection.polyline.editEnabled=!1,this.currentEditingConnection.polyline.getElement()?.classList.remove("connection-editing")),this.handlePolylineEdit(this.currentEditingConnection.polyline,this.currentEditingConnection.connection),this.currentEditingConnection=null,this.logger.debug("[Renderer] Edici\xF3n de conexi\xF3n finalizada y cambios guardados."))}deleteSelectedConnection(){if(!this.currentEditingConnection||!this.currentEditingConnection.connection.id)return;let e=this.currentEditingConnection.connection.id;this.logger.info(`[Renderer] Eliminando conexi\xF3n seleccionada: ${e}`),this.currentEditingConnection.polyline&&(typeof this.currentEditingConnection.polyline.disableEdit=="function"&&(this.currentEditingConnection.polyline.disableEdit(),this.currentEditingConnection.polyline.editEnabled=!1),this.currentEditingConnection.polyline.getElement()?.classList.remove("connection-editing"),this.connectionsLayer.removeLayer(this.currentEditingConnection.polyline)),e&&this.connectionLines.delete(e);let o=Z(I({},this.currentEditingConnection.connection),{metadata:Z(I({},this.currentEditingConnection.connection.metadata||{}),{isDeleted:!0})});this.elementManagerAdapter.updateConnection(o).subscribe({next:r=>{r?this.logger.info(`[Renderer] Conexi\xF3n ${e} marcada como eliminada correctamente`):this.logger.warn(`[Renderer] No se pudo marcar como eliminada la conexi\xF3n ${e}`)},error:r=>{this.logger.error(`[Renderer] Error al marcar como eliminada la conexi\xF3n ${e}:`,r)}}),this.currentEditingConnection=null}static \u0275fac=function(o){return new(o||n)(K(Ye),K(pt),K(Tn),K(Je),K(Pn))};static \u0275prov=ft({token:n,factory:n.\u0275fac,providedIn:"root"})};var vd={value:()=>{}};function ol(){for(var n=0,e=arguments.length,o={},r;n<e;++n){if(!(r=arguments[n]+"")||r in o||/[\s.]/.test(r))throw new Error("illegal type: "+r);o[r]=[]}return new Dn(o)}function Dn(n){this._=n}function yd(n,e){return n.trim().split(/^|\s+/).map(function(o){var r="",s=o.indexOf(".");if(s>=0&&(r=o.slice(s+1),o=o.slice(0,s)),o&&!e.hasOwnProperty(o))throw new Error("unknown type: "+o);return{type:o,name:r}})}Dn.prototype=ol.prototype={constructor:Dn,on:function(n,e){var o=this._,r=yd(n+"",o),s,h=-1,c=r.length;if(arguments.length<2){for(;++h<c;)if((s=(n=r[h]).type)&&(s=bd(o[s],n.name)))return s;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++h<c;)if(s=(n=r[h]).type)o[s]=rl(o[s],n.name,e);else if(e==null)for(s in o)o[s]=rl(o[s],n.name,null);return this},copy:function(){var n={},e=this._;for(var o in e)n[o]=e[o].slice();return new Dn(n)},call:function(n,e){if((s=arguments.length-2)>0)for(var o=new Array(s),r=0,s,h;r<s;++r)o[r]=arguments[r+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(h=this._[n],r=0,s=h.length;r<s;++r)h[r].value.apply(e,o)},apply:function(n,e,o){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var r=this._[n],s=0,h=r.length;s<h;++s)r[s].value.apply(e,o)}};function bd(n,e){for(var o=0,r=n.length,s;o<r;++o)if((s=n[o]).name===e)return s.value}function rl(n,e,o){for(var r=0,s=n.length;r<s;++r)if(n[r].name===e){n[r]=vd,n=n.slice(0,r).concat(n.slice(r+1));break}return o!=null&&n.push({name:e,value:o}),n}var Te=ol;var An="http://www.w3.org/1999/xhtml",Jr={svg:"http://www.w3.org/2000/svg",xhtml:An,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function oe(n){var e=n+="",o=e.indexOf(":");return o>=0&&(e=n.slice(0,o))!=="xmlns"&&(n=n.slice(o+1)),Jr.hasOwnProperty(e)?{space:Jr[e],local:n}:n}function wd(n){return function(){var e=this.ownerDocument,o=this.namespaceURI;return o===An&&e.documentElement.namespaceURI===An?e.createElement(n):e.createElementNS(o,n)}}function xd(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function Nn(n){var e=oe(n);return(e.local?xd:wd)(e)}function Ld(){}function Pe(n){return n==null?Ld:function(){return this.querySelector(n)}}function al(n){typeof n!="function"&&(n=Pe(n));for(var e=this._groups,o=e.length,r=new Array(o),s=0;s<o;++s)for(var h=e[s],c=h.length,f=r[s]=new Array(c),_,g,l=0;l<c;++l)(_=h[l])&&(g=n.call(_,_.__data__,l,h))&&("__data__"in _&&(g.__data__=_.__data__),f[l]=g);return new st(r,this._parents)}function to(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function Ed(){return[]}function Ti(n){return n==null?Ed:function(){return this.querySelectorAll(n)}}function Md(n){return function(){return to(n.apply(this,arguments))}}function sl(n){typeof n=="function"?n=Md(n):n=Ti(n);for(var e=this._groups,o=e.length,r=[],s=[],h=0;h<o;++h)for(var c=e[h],f=c.length,_,g=0;g<f;++g)(_=c[g])&&(r.push(n.call(_,_.__data__,g,c)),s.push(_));return new st(r,s)}function Pi(n){return function(){return this.matches(n)}}function zn(n){return function(e){return e.matches(n)}}var Cd=Array.prototype.find;function Sd(n){return function(){return Cd.call(this.children,n)}}function kd(){return this.firstElementChild}function ll(n){return this.select(n==null?kd:Sd(typeof n=="function"?n:zn(n)))}var Td=Array.prototype.filter;function Pd(){return Array.from(this.children)}function Od(n){return function(){return Td.call(this.children,n)}}function ul(n){return this.selectAll(n==null?Pd:Od(typeof n=="function"?n:zn(n)))}function hl(n){typeof n!="function"&&(n=Pi(n));for(var e=this._groups,o=e.length,r=new Array(o),s=0;s<o;++s)for(var h=e[s],c=h.length,f=r[s]=[],_,g=0;g<c;++g)(_=h[g])&&n.call(_,_.__data__,g,h)&&f.push(_);return new st(r,this._parents)}function Rn(n){return new Array(n.length)}function cl(){return new st(this._enter||this._groups.map(Rn),this._parents)}function Oi(n,e){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=e}Oi.prototype={constructor:Oi,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,e){return this._parent.insertBefore(n,e)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function dl(n){return function(){return n}}function Id(n,e,o,r,s,h){for(var c=0,f,_=e.length,g=h.length;c<g;++c)(f=e[c])?(f.__data__=h[c],r[c]=f):o[c]=new Oi(n,h[c]);for(;c<_;++c)(f=e[c])&&(s[c]=f)}function Dd(n,e,o,r,s,h,c){var f,_,g=new Map,l=e.length,m=h.length,v=new Array(l),y;for(f=0;f<l;++f)(_=e[f])&&(v[f]=y=c.call(_,_.__data__,f,e)+"",g.has(y)?s[f]=_:g.set(y,_));for(f=0;f<m;++f)y=c.call(n,h[f],f,h)+"",(_=g.get(y))?(r[f]=_,_.__data__=h[f],g.delete(y)):o[f]=new Oi(n,h[f]);for(f=0;f<l;++f)(_=e[f])&&g.get(v[f])===_&&(s[f]=_)}function Ad(n){return n.__data__}function fl(n,e){if(!arguments.length)return Array.from(this,Ad);var o=e?Dd:Id,r=this._parents,s=this._groups;typeof n!="function"&&(n=dl(n));for(var h=s.length,c=new Array(h),f=new Array(h),_=new Array(h),g=0;g<h;++g){var l=r[g],m=s[g],v=m.length,y=Nd(n.call(l,l&&l.__data__,g,r)),M=y.length,x=f[g]=new Array(M),C=c[g]=new Array(M),k=_[g]=new Array(v);o(l,m,x,C,k,y,e);for(var P=0,A=0,S,R;P<M;++P)if(S=x[P]){for(P>=A&&(A=P+1);!(R=C[A])&&++A<M;);S._next=R||null}}return c=new st(c,r),c._enter=f,c._exit=_,c}function Nd(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function ml(){return new st(this._exit||this._groups.map(Rn),this._parents)}function pl(n,e,o){var r=this.enter(),s=this,h=this.exit();return typeof n=="function"?(r=n(r),r&&(r=r.selection())):r=r.append(n+""),e!=null&&(s=e(s),s&&(s=s.selection())),o==null?h.remove():o(h),r&&s?r.merge(s).order():s}function gl(n){for(var e=n.selection?n.selection():n,o=this._groups,r=e._groups,s=o.length,h=r.length,c=Math.min(s,h),f=new Array(s),_=0;_<c;++_)for(var g=o[_],l=r[_],m=g.length,v=f[_]=new Array(m),y,M=0;M<m;++M)(y=g[M]||l[M])&&(v[M]=y);for(;_<s;++_)f[_]=o[_];return new st(f,this._parents)}function _l(){for(var n=this._groups,e=-1,o=n.length;++e<o;)for(var r=n[e],s=r.length-1,h=r[s],c;--s>=0;)(c=r[s])&&(h&&c.compareDocumentPosition(h)^4&&h.parentNode.insertBefore(c,h),h=c);return this}function vl(n){n||(n=zd);function e(m,v){return m&&v?n(m.__data__,v.__data__):!m-!v}for(var o=this._groups,r=o.length,s=new Array(r),h=0;h<r;++h){for(var c=o[h],f=c.length,_=s[h]=new Array(f),g,l=0;l<f;++l)(g=c[l])&&(_[l]=g);_.sort(e)}return new st(s,this._parents).order()}function zd(n,e){return n<e?-1:n>e?1:n>=e?0:NaN}function yl(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function bl(){return Array.from(this)}function wl(){for(var n=this._groups,e=0,o=n.length;e<o;++e)for(var r=n[e],s=0,h=r.length;s<h;++s){var c=r[s];if(c)return c}return null}function xl(){let n=0;for(let e of this)++n;return n}function Ll(){return!this.node()}function El(n){for(var e=this._groups,o=0,r=e.length;o<r;++o)for(var s=e[o],h=0,c=s.length,f;h<c;++h)(f=s[h])&&n.call(f,f.__data__,h,s);return this}function Rd(n){return function(){this.removeAttribute(n)}}function Bd(n){return function(){this.removeAttributeNS(n.space,n.local)}}function Zd(n,e){return function(){this.setAttribute(n,e)}}function Fd(n,e){return function(){this.setAttributeNS(n.space,n.local,e)}}function Gd(n,e){return function(){var o=e.apply(this,arguments);o==null?this.removeAttribute(n):this.setAttribute(n,o)}}function $d(n,e){return function(){var o=e.apply(this,arguments);o==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,o)}}function Ml(n,e){var o=oe(n);if(arguments.length<2){var r=this.node();return o.local?r.getAttributeNS(o.space,o.local):r.getAttribute(o)}return this.each((e==null?o.local?Bd:Rd:typeof e=="function"?o.local?$d:Gd:o.local?Fd:Zd)(o,e))}function Bn(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function Vd(n){return function(){this.style.removeProperty(n)}}function jd(n,e,o){return function(){this.style.setProperty(n,e,o)}}function Ud(n,e,o){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(n):this.style.setProperty(n,r,o)}}function Cl(n,e,o){return arguments.length>1?this.each((e==null?Vd:typeof e=="function"?Ud:jd)(n,e,o??"")):ce(this.node(),n)}function ce(n,e){return n.style.getPropertyValue(e)||Bn(n).getComputedStyle(n,null).getPropertyValue(e)}function Hd(n){return function(){delete this[n]}}function Wd(n,e){return function(){this[n]=e}}function qd(n,e){return function(){var o=e.apply(this,arguments);o==null?delete this[n]:this[n]=o}}function Sl(n,e){return arguments.length>1?this.each((e==null?Hd:typeof e=="function"?qd:Wd)(n,e)):this.node()[n]}function kl(n){return n.trim().split(/^|\s+/)}function eo(n){return n.classList||new Tl(n)}function Tl(n){this._node=n,this._names=kl(n.getAttribute("class")||"")}Tl.prototype={add:function(n){var e=this._names.indexOf(n);e<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var e=this._names.indexOf(n);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function Pl(n,e){for(var o=eo(n),r=-1,s=e.length;++r<s;)o.add(e[r])}function Ol(n,e){for(var o=eo(n),r=-1,s=e.length;++r<s;)o.remove(e[r])}function Xd(n){return function(){Pl(this,n)}}function Yd(n){return function(){Ol(this,n)}}function Kd(n,e){return function(){(e.apply(this,arguments)?Pl:Ol)(this,n)}}function Il(n,e){var o=kl(n+"");if(arguments.length<2){for(var r=eo(this.node()),s=-1,h=o.length;++s<h;)if(!r.contains(o[s]))return!1;return!0}return this.each((typeof e=="function"?Kd:e?Xd:Yd)(o,e))}function Qd(){this.textContent=""}function Jd(n){return function(){this.textContent=n}}function tf(n){return function(){var e=n.apply(this,arguments);this.textContent=e??""}}function Dl(n){return arguments.length?this.each(n==null?Qd:(typeof n=="function"?tf:Jd)(n)):this.node().textContent}function ef(){this.innerHTML=""}function nf(n){return function(){this.innerHTML=n}}function rf(n){return function(){var e=n.apply(this,arguments);this.innerHTML=e??""}}function Al(n){return arguments.length?this.each(n==null?ef:(typeof n=="function"?rf:nf)(n)):this.node().innerHTML}function of(){this.nextSibling&&this.parentNode.appendChild(this)}function Nl(){return this.each(of)}function af(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function zl(){return this.each(af)}function Rl(n){var e=typeof n=="function"?n:Nn(n);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function sf(){return null}function Bl(n,e){var o=typeof n=="function"?n:Nn(n),r=e==null?sf:typeof e=="function"?e:Pe(e);return this.select(function(){return this.insertBefore(o.apply(this,arguments),r.apply(this,arguments)||null)})}function lf(){var n=this.parentNode;n&&n.removeChild(this)}function Zl(){return this.each(lf)}function uf(){var n=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function hf(){var n=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function Fl(n){return this.select(n?hf:uf)}function Gl(n){return arguments.length?this.property("__data__",n):this.node().__data__}function cf(n){return function(e){n.call(this,e,this.__data__)}}function df(n){return n.trim().split(/^|\s+/).map(function(e){var o="",r=e.indexOf(".");return r>=0&&(o=e.slice(r+1),e=e.slice(0,r)),{type:e,name:o}})}function ff(n){return function(){var e=this.__on;if(e){for(var o=0,r=-1,s=e.length,h;o<s;++o)h=e[o],(!n.type||h.type===n.type)&&h.name===n.name?this.removeEventListener(h.type,h.listener,h.options):e[++r]=h;++r?e.length=r:delete this.__on}}}function mf(n,e,o){return function(){var r=this.__on,s,h=cf(e);if(r){for(var c=0,f=r.length;c<f;++c)if((s=r[c]).type===n.type&&s.name===n.name){this.removeEventListener(s.type,s.listener,s.options),this.addEventListener(s.type,s.listener=h,s.options=o),s.value=e;return}}this.addEventListener(n.type,h,o),s={type:n.type,name:n.name,value:e,listener:h,options:o},r?r.push(s):this.__on=[s]}}function $l(n,e,o){var r=df(n+""),s,h=r.length,c;if(arguments.length<2){var f=this.node().__on;if(f){for(var _=0,g=f.length,l;_<g;++_)for(s=0,l=f[_];s<h;++s)if((c=r[s]).type===l.type&&c.name===l.name)return l.value}return}for(f=e?mf:ff,s=0;s<h;++s)this.each(f(r[s],e,o));return this}function Vl(n,e,o){var r=Bn(n),s=r.CustomEvent;typeof s=="function"?s=new s(e,o):(s=r.document.createEvent("Event"),o?(s.initEvent(e,o.bubbles,o.cancelable),s.detail=o.detail):s.initEvent(e,!1,!1)),n.dispatchEvent(s)}function pf(n,e){return function(){return Vl(this,n,e)}}function gf(n,e){return function(){return Vl(this,n,e.apply(this,arguments))}}function jl(n,e){return this.each((typeof e=="function"?gf:pf)(n,e))}function*Ul(){for(var n=this._groups,e=0,o=n.length;e<o;++e)for(var r=n[e],s=0,h=r.length,c;s<h;++s)(c=r[s])&&(yield c)}var io=[null];function st(n,e){this._groups=n,this._parents=e}function Hl(){return new st([[document.documentElement]],io)}function _f(){return this}st.prototype=Hl.prototype={constructor:st,select:al,selectAll:sl,selectChild:ll,selectChildren:ul,filter:hl,data:fl,enter:cl,exit:ml,join:pl,merge:gl,selection:_f,order:_l,sort:vl,call:yl,nodes:bl,node:wl,size:xl,empty:Ll,each:El,attr:Ml,style:Cl,property:Sl,classed:Il,text:Dl,html:Al,raise:Nl,lower:zl,append:Rl,insert:Bl,remove:Zl,clone:Fl,datum:Gl,on:$l,dispatch:jl,[Symbol.iterator]:Ul};var ae=Hl;function Oe(n){return typeof n=="string"?new st([[document.querySelector(n)]],[document.documentElement]):new st([[n]],io)}function Wl(n){let e;for(;e=n.sourceEvent;)n=e;return n}function Zn(n,e){if(n=Wl(n),e===void 0&&(e=n.currentTarget),e){var o=e.ownerSVGElement||e;if(o.createSVGPoint){var r=o.createSVGPoint();return r.x=n.clientX,r.y=n.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var s=e.getBoundingClientRect();return[n.clientX-s.left-e.clientLeft,n.clientY-s.top-e.clientTop]}}return[n.pageX,n.pageY]}var ql={passive:!1},Ie={capture:!0,passive:!1};function Fn(n){n.stopImmediatePropagation()}function de(n){n.preventDefault(),n.stopImmediatePropagation()}function Xl(n){var e=n.document.documentElement,o=Oe(n).on("dragstart.drag",de,Ie);"onselectstart"in e?o.on("selectstart.drag",de,Ie):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function Yl(n,e){var o=n.document.documentElement,r=Oe(n).on("dragstart.drag",null);e&&(r.on("click.drag",de,Ie),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in o?r.on("selectstart.drag",null):(o.style.MozUserSelect=o.__noselect,delete o.__noselect)}var Ii=n=>()=>n;function Di(n,{sourceEvent:e,subject:o,target:r,identifier:s,active:h,x:c,y:f,dx:_,dy:g,dispatch:l}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:o,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:s,enumerable:!0,configurable:!0},active:{value:h,enumerable:!0,configurable:!0},x:{value:c,enumerable:!0,configurable:!0},y:{value:f,enumerable:!0,configurable:!0},dx:{value:_,enumerable:!0,configurable:!0},dy:{value:g,enumerable:!0,configurable:!0},_:{value:l}})}Di.prototype.on=function(){var n=this._.on.apply(this._,arguments);return n===this._?this:n};function vf(n){return!n.ctrlKey&&!n.button}function yf(){return this.parentNode}function bf(n,e){return e??{x:n.x,y:n.y}}function wf(){return navigator.maxTouchPoints||"ontouchstart"in this}function xf(){var n=vf,e=yf,o=bf,r=wf,s={},h=Te("start","drag","end"),c=0,f,_,g,l,m=0;function v(S){S.on("mousedown.drag",y).filter(r).on("touchstart.drag",C).on("touchmove.drag",k,ql).on("touchend.drag touchcancel.drag",P).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function y(S,R){if(!(l||!n.call(this,S,R))){var U=A(this,e.call(this,S,R),S,R,"mouse");U&&(Oe(S.view).on("mousemove.drag",M,Ie).on("mouseup.drag",x,Ie),Xl(S.view),Fn(S),g=!1,f=S.clientX,_=S.clientY,U("start",S))}}function M(S){if(de(S),!g){var R=S.clientX-f,U=S.clientY-_;g=R*R+U*U>m}s.mouse("drag",S)}function x(S){Oe(S.view).on("mousemove.drag mouseup.drag",null),Yl(S.view,g),de(S),s.mouse("end",S)}function C(S,R){if(n.call(this,S,R)){var U=S.changedTouches,X=e.call(this,S,R),rt=U.length,Q,ot;for(Q=0;Q<rt;++Q)(ot=A(this,X,S,R,U[Q].identifier,U[Q]))&&(Fn(S),ot("start",S,U[Q]))}}function k(S){var R=S.changedTouches,U=R.length,X,rt;for(X=0;X<U;++X)(rt=s[R[X].identifier])&&(de(S),rt("drag",S,R[X]))}function P(S){var R=S.changedTouches,U=R.length,X,rt;for(l&&clearTimeout(l),l=setTimeout(function(){l=null},500),X=0;X<U;++X)(rt=s[R[X].identifier])&&(Fn(S),rt("end",S,R[X]))}function A(S,R,U,X,rt,Q){var ot=h.copy(),zt=Zn(Q||U,R),Rt,qi,_t;if((_t=o.call(S,new Di("beforestart",{sourceEvent:U,target:v,identifier:rt,active:c,x:zt[0],y:zt[1],dx:0,dy:0,dispatch:ot}),X))!=null)return Rt=_t.x-zt[0]||0,qi=_t.y-zt[1]||0,function _e(F,li,G){var it=zt,vt;switch(F){case"start":s[rt]=_e,vt=c++;break;case"end":delete s[rt],--c;case"drag":zt=Zn(G||li,R),vt=c;break}ot.call(F,S,new Di(F,{sourceEvent:li,subject:_t,target:v,identifier:rt,active:vt,x:zt[0]+Rt,y:zt[1]+qi,dx:zt[0]-it[0],dy:zt[1]-it[1],dispatch:ot}),X)}}return v.filter=function(S){return arguments.length?(n=typeof S=="function"?S:Ii(!!S),v):n},v.container=function(S){return arguments.length?(e=typeof S=="function"?S:Ii(S),v):e},v.subject=function(S){return arguments.length?(o=typeof S=="function"?S:Ii(S),v):o},v.touchable=function(S){return arguments.length?(r=typeof S=="function"?S:Ii(!!S),v):r},v.on=function(){var S=h.on.apply(h,arguments);return S===h?v:S},v.clickDistance=function(S){return arguments.length?(m=(S=+S)*S,v):Math.sqrt(m)},v}function Gn(n,e,o){n.prototype=e.prototype=o,o.constructor=n}function no(n,e){var o=Object.create(n.prototype);for(var r in e)o[r]=e[r];return o}function zi(){}var Ai=.7,jn=1/Ai,ei="\\s*([+-]?\\d+)\\s*",Ni="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Jt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Lf=/^#([0-9a-f]{3,8})$/,Ef=new RegExp(`^rgb\\(${ei},${ei},${ei}\\)$`),Mf=new RegExp(`^rgb\\(${Jt},${Jt},${Jt}\\)$`),Cf=new RegExp(`^rgba\\(${ei},${ei},${ei},${Ni}\\)$`),Sf=new RegExp(`^rgba\\(${Jt},${Jt},${Jt},${Ni}\\)$`),kf=new RegExp(`^hsl\\(${Ni},${Jt},${Jt}\\)$`),Tf=new RegExp(`^hsla\\(${Ni},${Jt},${Jt},${Ni}\\)$`),Kl={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Gn(zi,fe,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:Ql,formatHex:Ql,formatHex8:Pf,formatHsl:Of,formatRgb:Jl,toString:Jl});function Ql(){return this.rgb().formatHex()}function Pf(){return this.rgb().formatHex8()}function Of(){return ou(this).formatHsl()}function Jl(){return this.rgb().formatRgb()}function fe(n){var e,o;return n=(n+"").trim().toLowerCase(),(e=Lf.exec(n))?(o=e[1].length,e=parseInt(e[1],16),o===6?tu(e):o===3?new Dt(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):o===8?$n(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):o===4?$n(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Ef.exec(n))?new Dt(e[1],e[2],e[3],1):(e=Mf.exec(n))?new Dt(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Cf.exec(n))?$n(e[1],e[2],e[3],e[4]):(e=Sf.exec(n))?$n(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=kf.exec(n))?nu(e[1],e[2]/100,e[3]/100,1):(e=Tf.exec(n))?nu(e[1],e[2]/100,e[3]/100,e[4]):Kl.hasOwnProperty(n)?tu(Kl[n]):n==="transparent"?new Dt(NaN,NaN,NaN,0):null}function tu(n){return new Dt(n>>16&255,n>>8&255,n&255,1)}function $n(n,e,o,r){return r<=0&&(n=e=o=NaN),new Dt(n,e,o,r)}function If(n){return n instanceof zi||(n=fe(n)),n?(n=n.rgb(),new Dt(n.r,n.g,n.b,n.opacity)):new Dt}function ii(n,e,o,r){return arguments.length===1?If(n):new Dt(n,e,o,r??1)}function Dt(n,e,o,r){this.r=+n,this.g=+e,this.b=+o,this.opacity=+r}Gn(Dt,ii,no(zi,{brighter(n){return n=n==null?jn:Math.pow(jn,n),new Dt(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?Ai:Math.pow(Ai,n),new Dt(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new Dt(Ae(this.r),Ae(this.g),Ae(this.b),Un(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:eu,formatHex:eu,formatHex8:Df,formatRgb:iu,toString:iu}));function eu(){return`#${De(this.r)}${De(this.g)}${De(this.b)}`}function Df(){return`#${De(this.r)}${De(this.g)}${De(this.b)}${De((isNaN(this.opacity)?1:this.opacity)*255)}`}function iu(){let n=Un(this.opacity);return`${n===1?"rgb(":"rgba("}${Ae(this.r)}, ${Ae(this.g)}, ${Ae(this.b)}${n===1?")":`, ${n})`}`}function Un(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function Ae(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function De(n){return n=Ae(n),(n<16?"0":"")+n.toString(16)}function nu(n,e,o,r){return r<=0?n=e=o=NaN:o<=0||o>=1?n=e=NaN:e<=0&&(n=NaN),new qt(n,e,o,r)}function ou(n){if(n instanceof qt)return new qt(n.h,n.s,n.l,n.opacity);if(n instanceof zi||(n=fe(n)),!n)return new qt;if(n instanceof qt)return n;n=n.rgb();var e=n.r/255,o=n.g/255,r=n.b/255,s=Math.min(e,o,r),h=Math.max(e,o,r),c=NaN,f=h-s,_=(h+s)/2;return f?(e===h?c=(o-r)/f+(o<r)*6:o===h?c=(r-e)/f+2:c=(e-o)/f+4,f/=_<.5?h+s:2-h-s,c*=60):f=_>0&&_<1?0:c,new qt(c,f,_,n.opacity)}function au(n,e,o,r){return arguments.length===1?ou(n):new qt(n,e,o,r??1)}function qt(n,e,o,r){this.h=+n,this.s=+e,this.l=+o,this.opacity=+r}Gn(qt,au,no(zi,{brighter(n){return n=n==null?jn:Math.pow(jn,n),new qt(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?Ai:Math.pow(Ai,n),new qt(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,e=isNaN(n)||isNaN(this.s)?0:this.s,o=this.l,r=o+(o<.5?o:1-o)*e,s=2*o-r;return new Dt(ro(n>=240?n-240:n+120,s,r),ro(n,s,r),ro(n<120?n+240:n-120,s,r),this.opacity)},clamp(){return new qt(ru(this.h),Vn(this.s),Vn(this.l),Un(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let n=Un(this.opacity);return`${n===1?"hsl(":"hsla("}${ru(this.h)}, ${Vn(this.s)*100}%, ${Vn(this.l)*100}%${n===1?")":`, ${n})`}`}}));function ru(n){return n=(n||0)%360,n<0?n+360:n}function Vn(n){return Math.max(0,Math.min(1,n||0))}function ro(n,e,o){return(n<60?e+(o-e)*n/60:n<180?o:n<240?e+(o-e)*(240-n)/60:e)*255}function oo(n,e,o,r,s){var h=n*n,c=h*n;return((1-3*n+3*h-c)*e+(4-6*h+3*c)*o+(1+3*n+3*h-3*c)*r+c*s)/6}function su(n){var e=n.length-1;return function(o){var r=o<=0?o=0:o>=1?(o=1,e-1):Math.floor(o*e),s=n[r],h=n[r+1],c=r>0?n[r-1]:2*s-h,f=r<e-1?n[r+2]:2*h-s;return oo((o-r/e)*e,c,s,h,f)}}function lu(n){var e=n.length;return function(o){var r=Math.floor(((o%=1)<0?++o:o)*e),s=n[(r+e-1)%e],h=n[r%e],c=n[(r+1)%e],f=n[(r+2)%e];return oo((o-r/e)*e,s,h,c,f)}}var ao=n=>()=>n;function Af(n,e){return function(o){return n+o*e}}function Nf(n,e,o){return n=Math.pow(n,o),e=Math.pow(e,o)-n,o=1/o,function(r){return Math.pow(n+r*e,o)}}function uu(n){return(n=+n)==1?Hn:function(e,o){return o-e?Nf(e,o,n):ao(isNaN(e)?o:e)}}function Hn(n,e){var o=e-n;return o?Af(n,o):ao(isNaN(n)?e:n)}var Wn=function n(e){var o=uu(e);function r(s,h){var c=o((s=ii(s)).r,(h=ii(h)).r),f=o(s.g,h.g),_=o(s.b,h.b),g=Hn(s.opacity,h.opacity);return function(l){return s.r=c(l),s.g=f(l),s.b=_(l),s.opacity=g(l),s+""}}return r.gamma=n,r}(1);function hu(n){return function(e){var o=e.length,r=new Array(o),s=new Array(o),h=new Array(o),c,f;for(c=0;c<o;++c)f=ii(e[c]),r[c]=f.r||0,s[c]=f.g||0,h[c]=f.b||0;return r=n(r),s=n(s),h=n(h),f.opacity=1,function(_){return f.r=r(_),f.g=s(_),f.b=h(_),f+""}}}var zf=hu(su),Rf=hu(lu);function $t(n,e){return n=+n,e=+e,function(o){return n*(1-o)+e*o}}var lo=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,so=new RegExp(lo.source,"g");function Bf(n){return function(){return n}}function Zf(n){return function(e){return n(e)+""}}function uo(n,e){var o=lo.lastIndex=so.lastIndex=0,r,s,h,c=-1,f=[],_=[];for(n=n+"",e=e+"";(r=lo.exec(n))&&(s=so.exec(e));)(h=s.index)>o&&(h=e.slice(o,h),f[c]?f[c]+=h:f[++c]=h),(r=r[0])===(s=s[0])?f[c]?f[c]+=s:f[++c]=s:(f[++c]=null,_.push({i:c,x:$t(r,s)})),o=so.lastIndex;return o<e.length&&(h=e.slice(o),f[c]?f[c]+=h:f[++c]=h),f.length<2?_[0]?Zf(_[0].x):Bf(e):(e=_.length,function(g){for(var l=0,m;l<e;++l)f[(m=_[l]).i]=m.x(g);return f.join("")})}var cu=180/Math.PI,qn={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function ho(n,e,o,r,s,h){var c,f,_;return(c=Math.sqrt(n*n+e*e))&&(n/=c,e/=c),(_=n*o+e*r)&&(o-=n*_,r-=e*_),(f=Math.sqrt(o*o+r*r))&&(o/=f,r/=f,_/=f),n*r<e*o&&(n=-n,e=-e,_=-_,c=-c),{translateX:s,translateY:h,rotate:Math.atan2(e,n)*cu,skewX:Math.atan(_)*cu,scaleX:c,scaleY:f}}var Xn;function du(n){let e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(n+"");return e.isIdentity?qn:ho(e.a,e.b,e.c,e.d,e.e,e.f)}function fu(n){return n==null?qn:(Xn||(Xn=document.createElementNS("http://www.w3.org/2000/svg","g")),Xn.setAttribute("transform",n),(n=Xn.transform.baseVal.consolidate())?(n=n.matrix,ho(n.a,n.b,n.c,n.d,n.e,n.f)):qn)}function mu(n,e,o,r){function s(g){return g.length?g.pop()+" ":""}function h(g,l,m,v,y,M){if(g!==m||l!==v){var x=y.push("translate(",null,e,null,o);M.push({i:x-4,x:$t(g,m)},{i:x-2,x:$t(l,v)})}else(m||v)&&y.push("translate("+m+e+v+o)}function c(g,l,m,v){g!==l?(g-l>180?l+=360:l-g>180&&(g+=360),v.push({i:m.push(s(m)+"rotate(",null,r)-2,x:$t(g,l)})):l&&m.push(s(m)+"rotate("+l+r)}function f(g,l,m,v){g!==l?v.push({i:m.push(s(m)+"skewX(",null,r)-2,x:$t(g,l)}):l&&m.push(s(m)+"skewX("+l+r)}function _(g,l,m,v,y,M){if(g!==m||l!==v){var x=y.push(s(y)+"scale(",null,",",null,")");M.push({i:x-4,x:$t(g,m)},{i:x-2,x:$t(l,v)})}else(m!==1||v!==1)&&y.push(s(y)+"scale("+m+","+v+")")}return function(g,l){var m=[],v=[];return g=n(g),l=n(l),h(g.translateX,g.translateY,l.translateX,l.translateY,m,v),c(g.rotate,l.rotate,m,v),f(g.skewX,l.skewX,m,v),_(g.scaleX,g.scaleY,l.scaleX,l.scaleY,m,v),g=l=null,function(y){for(var M=-1,x=v.length,C;++M<x;)m[(C=v[M]).i]=C.x(y);return m.join("")}}}var co=mu(du,"px, ","px)","deg)"),fo=mu(fu,", ",")",")");var ni=0,Bi=0,Ri=0,gu=1e3,Yn,Zi,Kn=0,Ne=0,Qn=0,Fi=typeof performance=="object"&&performance.now?performance:Date,_u=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(n){setTimeout(n,17)};function $i(){return Ne||(_u(Ff),Ne=Fi.now()+Qn)}function Ff(){Ne=0}function Gi(){this._call=this._time=this._next=null}Gi.prototype=ri.prototype={constructor:Gi,restart:function(n,e,o){if(typeof n!="function")throw new TypeError("callback is not a function");o=(o==null?$i():+o)+(e==null?0:+e),!this._next&&Zi!==this&&(Zi?Zi._next=this:Yn=this,Zi=this),this._call=n,this._time=o,mo()},stop:function(){this._call&&(this._call=null,this._time=1/0,mo())}};function ri(n,e,o){var r=new Gi;return r.restart(n,e,o),r}function vu(){$i(),++ni;for(var n=Yn,e;n;)(e=Ne-n._time)>=0&&n._call.call(void 0,e),n=n._next;--ni}function pu(){Ne=(Kn=Fi.now())+Qn,ni=Bi=0;try{vu()}finally{ni=0,$f(),Ne=0}}function Gf(){var n=Fi.now(),e=n-Kn;e>gu&&(Qn-=e,Kn=n)}function $f(){for(var n,e=Yn,o,r=1/0;e;)e._call?(r>e._time&&(r=e._time),n=e,e=e._next):(o=e._next,e._next=null,e=n?n._next=o:Yn=o);Zi=n,mo(r)}function mo(n){if(!ni){Bi&&(Bi=clearTimeout(Bi));var e=n-Ne;e>24?(n<1/0&&(Bi=setTimeout(pu,n-Fi.now()-Qn)),Ri&&(Ri=clearInterval(Ri))):(Ri||(Kn=Fi.now(),Ri=setInterval(Gf,gu)),ni=1,_u(pu))}}function Jn(n,e,o){var r=new Gi;return e=e==null?0:+e,r.restart(s=>{r.stop(),n(s+e)},e,o),r}var Vf=Te("start","end","cancel","interrupt"),jf=[],wu=0,yu=1,er=2,tr=3,bu=4,ir=5,Vi=6;function me(n,e,o,r,s,h){var c=n.__transition;if(!c)n.__transition={};else if(o in c)return;Uf(n,o,{name:e,index:r,group:s,on:Vf,tween:jf,time:h.time,delay:h.delay,duration:h.duration,ease:h.ease,timer:null,state:wu})}function ji(n,e){var o=gt(n,e);if(o.state>wu)throw new Error("too late; already scheduled");return o}function Ct(n,e){var o=gt(n,e);if(o.state>tr)throw new Error("too late; already running");return o}function gt(n,e){var o=n.__transition;if(!o||!(o=o[e]))throw new Error("transition not found");return o}function Uf(n,e,o){var r=n.__transition,s;r[e]=o,o.timer=ri(h,0,o.time);function h(g){o.state=yu,o.timer.restart(c,o.delay,o.time),o.delay<=g&&c(g-o.delay)}function c(g){var l,m,v,y;if(o.state!==yu)return _();for(l in r)if(y=r[l],y.name===o.name){if(y.state===tr)return Jn(c);y.state===bu?(y.state=Vi,y.timer.stop(),y.on.call("interrupt",n,n.__data__,y.index,y.group),delete r[l]):+l<e&&(y.state=Vi,y.timer.stop(),y.on.call("cancel",n,n.__data__,y.index,y.group),delete r[l])}if(Jn(function(){o.state===tr&&(o.state=bu,o.timer.restart(f,o.delay,o.time),f(g))}),o.state=er,o.on.call("start",n,n.__data__,o.index,o.group),o.state===er){for(o.state=tr,s=new Array(v=o.tween.length),l=0,m=-1;l<v;++l)(y=o.tween[l].value.call(n,n.__data__,o.index,o.group))&&(s[++m]=y);s.length=m+1}}function f(g){for(var l=g<o.duration?o.ease.call(null,g/o.duration):(o.timer.restart(_),o.state=ir,1),m=-1,v=s.length;++m<v;)s[m].call(n,l);o.state===ir&&(o.on.call("end",n,n.__data__,o.index,o.group),_())}function _(){o.state=Vi,o.timer.stop(),delete r[e];for(var g in r)return;delete n.__transition}}function nr(n,e){var o=n.__transition,r,s,h=!0,c;if(o){e=e==null?null:e+"";for(c in o){if((r=o[c]).name!==e){h=!1;continue}s=r.state>er&&r.state<ir,r.state=Vi,r.timer.stop(),r.on.call(s?"interrupt":"cancel",n,n.__data__,r.index,r.group),delete o[c]}h&&delete n.__transition}}function xu(n){return this.each(function(){nr(this,n)})}function Hf(n,e){var o,r;return function(){var s=Ct(this,n),h=s.tween;if(h!==o){r=o=h;for(var c=0,f=r.length;c<f;++c)if(r[c].name===e){r=r.slice(),r.splice(c,1);break}}s.tween=r}}function Wf(n,e,o){var r,s;if(typeof o!="function")throw new Error;return function(){var h=Ct(this,n),c=h.tween;if(c!==r){s=(r=c).slice();for(var f={name:e,value:o},_=0,g=s.length;_<g;++_)if(s[_].name===e){s[_]=f;break}_===g&&s.push(f)}h.tween=s}}function Lu(n,e){var o=this._id;if(n+="",arguments.length<2){for(var r=gt(this.node(),o).tween,s=0,h=r.length,c;s<h;++s)if((c=r[s]).name===n)return c.value;return null}return this.each((e==null?Hf:Wf)(o,n,e))}function oi(n,e,o){var r=n._id;return n.each(function(){var s=Ct(this,r);(s.value||(s.value={}))[e]=o.apply(this,arguments)}),function(s){return gt(s,r).value[e]}}function rr(n,e){var o;return(typeof e=="number"?$t:e instanceof fe?Wn:(o=fe(e))?(e=o,Wn):uo)(n,e)}function qf(n){return function(){this.removeAttribute(n)}}function Xf(n){return function(){this.removeAttributeNS(n.space,n.local)}}function Yf(n,e,o){var r,s=o+"",h;return function(){var c=this.getAttribute(n);return c===s?null:c===r?h:h=e(r=c,o)}}function Kf(n,e,o){var r,s=o+"",h;return function(){var c=this.getAttributeNS(n.space,n.local);return c===s?null:c===r?h:h=e(r=c,o)}}function Qf(n,e,o){var r,s,h;return function(){var c,f=o(this),_;return f==null?void this.removeAttribute(n):(c=this.getAttribute(n),_=f+"",c===_?null:c===r&&_===s?h:(s=_,h=e(r=c,f)))}}function Jf(n,e,o){var r,s,h;return function(){var c,f=o(this),_;return f==null?void this.removeAttributeNS(n.space,n.local):(c=this.getAttributeNS(n.space,n.local),_=f+"",c===_?null:c===r&&_===s?h:(s=_,h=e(r=c,f)))}}function Eu(n,e){var o=oe(n),r=o==="transform"?fo:rr;return this.attrTween(n,typeof e=="function"?(o.local?Jf:Qf)(o,r,oi(this,"attr."+n,e)):e==null?(o.local?Xf:qf)(o):(o.local?Kf:Yf)(o,r,e))}function tm(n,e){return function(o){this.setAttribute(n,e.call(this,o))}}function em(n,e){return function(o){this.setAttributeNS(n.space,n.local,e.call(this,o))}}function im(n,e){var o,r;function s(){var h=e.apply(this,arguments);return h!==r&&(o=(r=h)&&em(n,h)),o}return s._value=e,s}function nm(n,e){var o,r;function s(){var h=e.apply(this,arguments);return h!==r&&(o=(r=h)&&tm(n,h)),o}return s._value=e,s}function Mu(n,e){var o="attr."+n;if(arguments.length<2)return(o=this.tween(o))&&o._value;if(e==null)return this.tween(o,null);if(typeof e!="function")throw new Error;var r=oe(n);return this.tween(o,(r.local?im:nm)(r,e))}function rm(n,e){return function(){ji(this,n).delay=+e.apply(this,arguments)}}function om(n,e){return e=+e,function(){ji(this,n).delay=e}}function Cu(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?rm:om)(e,n)):gt(this.node(),e).delay}function am(n,e){return function(){Ct(this,n).duration=+e.apply(this,arguments)}}function sm(n,e){return e=+e,function(){Ct(this,n).duration=e}}function Su(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?am:sm)(e,n)):gt(this.node(),e).duration}function lm(n,e){if(typeof e!="function")throw new Error;return function(){Ct(this,n).ease=e}}function ku(n){var e=this._id;return arguments.length?this.each(lm(e,n)):gt(this.node(),e).ease}function um(n,e){return function(){var o=e.apply(this,arguments);if(typeof o!="function")throw new Error;Ct(this,n).ease=o}}function Tu(n){if(typeof n!="function")throw new Error;return this.each(um(this._id,n))}function Pu(n){typeof n!="function"&&(n=Pi(n));for(var e=this._groups,o=e.length,r=new Array(o),s=0;s<o;++s)for(var h=e[s],c=h.length,f=r[s]=[],_,g=0;g<c;++g)(_=h[g])&&n.call(_,_.__data__,g,h)&&f.push(_);return new kt(r,this._parents,this._name,this._id)}function Ou(n){if(n._id!==this._id)throw new Error;for(var e=this._groups,o=n._groups,r=e.length,s=o.length,h=Math.min(r,s),c=new Array(r),f=0;f<h;++f)for(var _=e[f],g=o[f],l=_.length,m=c[f]=new Array(l),v,y=0;y<l;++y)(v=_[y]||g[y])&&(m[y]=v);for(;f<r;++f)c[f]=e[f];return new kt(c,this._parents,this._name,this._id)}function hm(n){return(n+"").trim().split(/^|\s+/).every(function(e){var o=e.indexOf(".");return o>=0&&(e=e.slice(0,o)),!e||e==="start"})}function cm(n,e,o){var r,s,h=hm(e)?ji:Ct;return function(){var c=h(this,n),f=c.on;f!==r&&(s=(r=f).copy()).on(e,o),c.on=s}}function Iu(n,e){var o=this._id;return arguments.length<2?gt(this.node(),o).on.on(n):this.each(cm(o,n,e))}function dm(n){return function(){var e=this.parentNode;for(var o in this.__transition)if(+o!==n)return;e&&e.removeChild(this)}}function Du(){return this.on("end.remove",dm(this._id))}function Au(n){var e=this._name,o=this._id;typeof n!="function"&&(n=Pe(n));for(var r=this._groups,s=r.length,h=new Array(s),c=0;c<s;++c)for(var f=r[c],_=f.length,g=h[c]=new Array(_),l,m,v=0;v<_;++v)(l=f[v])&&(m=n.call(l,l.__data__,v,f))&&("__data__"in l&&(m.__data__=l.__data__),g[v]=m,me(g[v],e,o,v,g,gt(l,o)));return new kt(h,this._parents,e,o)}function Nu(n){var e=this._name,o=this._id;typeof n!="function"&&(n=Ti(n));for(var r=this._groups,s=r.length,h=[],c=[],f=0;f<s;++f)for(var _=r[f],g=_.length,l,m=0;m<g;++m)if(l=_[m]){for(var v=n.call(l,l.__data__,m,_),y,M=gt(l,o),x=0,C=v.length;x<C;++x)(y=v[x])&&me(y,e,o,x,v,M);h.push(v),c.push(l)}return new kt(h,c,e,o)}var fm=ae.prototype.constructor;function zu(){return new fm(this._groups,this._parents)}function mm(n,e){var o,r,s;return function(){var h=ce(this,n),c=(this.style.removeProperty(n),ce(this,n));return h===c?null:h===o&&c===r?s:s=e(o=h,r=c)}}function Ru(n){return function(){this.style.removeProperty(n)}}function pm(n,e,o){var r,s=o+"",h;return function(){var c=ce(this,n);return c===s?null:c===r?h:h=e(r=c,o)}}function gm(n,e,o){var r,s,h;return function(){var c=ce(this,n),f=o(this),_=f+"";return f==null&&(_=f=(this.style.removeProperty(n),ce(this,n))),c===_?null:c===r&&_===s?h:(s=_,h=e(r=c,f))}}function _m(n,e){var o,r,s,h="style."+e,c="end."+h,f;return function(){var _=Ct(this,n),g=_.on,l=_.value[h]==null?f||(f=Ru(e)):void 0;(g!==o||s!==l)&&(r=(o=g).copy()).on(c,s=l),_.on=r}}function Bu(n,e,o){var r=(n+="")=="transform"?co:rr;return e==null?this.styleTween(n,mm(n,r)).on("end.style."+n,Ru(n)):typeof e=="function"?this.styleTween(n,gm(n,r,oi(this,"style."+n,e))).each(_m(this._id,n)):this.styleTween(n,pm(n,r,e),o).on("end.style."+n,null)}function vm(n,e,o){return function(r){this.style.setProperty(n,e.call(this,r),o)}}function ym(n,e,o){var r,s;function h(){var c=e.apply(this,arguments);return c!==s&&(r=(s=c)&&vm(n,c,o)),r}return h._value=e,h}function Zu(n,e,o){var r="style."+(n+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,ym(n,e,o??""))}function bm(n){return function(){this.textContent=n}}function wm(n){return function(){var e=n(this);this.textContent=e??""}}function Fu(n){return this.tween("text",typeof n=="function"?wm(oi(this,"text",n)):bm(n==null?"":n+""))}function xm(n){return function(e){this.textContent=n.call(this,e)}}function Lm(n){var e,o;function r(){var s=n.apply(this,arguments);return s!==o&&(e=(o=s)&&xm(s)),e}return r._value=n,r}function Gu(n){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(n==null)return this.tween(e,null);if(typeof n!="function")throw new Error;return this.tween(e,Lm(n))}function $u(){for(var n=this._name,e=this._id,o=or(),r=this._groups,s=r.length,h=0;h<s;++h)for(var c=r[h],f=c.length,_,g=0;g<f;++g)if(_=c[g]){var l=gt(_,e);me(_,n,o,g,c,{time:l.time+l.delay+l.duration,delay:0,duration:l.duration,ease:l.ease})}return new kt(r,this._parents,n,o)}function Vu(){var n,e,o=this,r=o._id,s=o.size();return new Promise(function(h,c){var f={value:c},_={value:function(){--s===0&&h()}};o.each(function(){var g=Ct(this,r),l=g.on;l!==n&&(e=(n=l).copy(),e._.cancel.push(f),e._.interrupt.push(f),e._.end.push(_)),g.on=e}),s===0&&h()})}var Em=0;function kt(n,e,o,r){this._groups=n,this._parents=e,this._name=o,this._id=r}function ju(n){return ae().transition(n)}function or(){return++Em}var se=ae.prototype;kt.prototype=ju.prototype={constructor:kt,select:Au,selectAll:Nu,selectChild:se.selectChild,selectChildren:se.selectChildren,filter:Pu,merge:Ou,selection:zu,transition:$u,call:se.call,nodes:se.nodes,node:se.node,size:se.size,empty:se.empty,each:se.each,on:Iu,attr:Eu,attrTween:Mu,style:Bu,styleTween:Zu,text:Fu,textTween:Gu,remove:Du,tween:Lu,delay:Cu,duration:Su,ease:ku,easeVarying:Tu,end:Vu,[Symbol.iterator]:se[Symbol.iterator]};function ar(n){return((n*=2)<=1?n*n*n:(n-=2)*n*n+2)/2}var Mm={time:null,delay:0,duration:250,ease:ar};function Cm(n,e){for(var o;!(o=n.__transition)||!(o=o[e]);)if(!(n=n.parentNode))throw new Error(`transition ${e} not found`);return o}function Uu(n){var e,o;n instanceof kt?(e=n._id,n=n._name):(e=or(),(o=Mm).time=$i(),n=n==null?null:n+"");for(var r=this._groups,s=r.length,h=0;h<s;++h)for(var c=r[h],f=c.length,_,g=0;g<f;++g)(_=c[g])&&me(_,n,e,g,c,o||Cm(_,e));return new kt(r,this._parents,n,e)}ae.prototype.interrupt=xu;ae.prototype.transition=Uu;var{abs:p0,max:g0,min:_0}=Math;function Hu(n){return[+n[0],+n[1]]}function Sm(n){return[Hu(n[0]),Hu(n[1])]}var v0={name:"x",handles:["w","e"].map(po),input:function(n,e){return n==null?null:[[+n[0],e[0][1]],[+n[1],e[1][1]]]},output:function(n){return n&&[n[0][0],n[1][0]]}},y0={name:"y",handles:["n","s"].map(po),input:function(n,e){return n==null?null:[[e[0][0],+n[0]],[e[1][0],+n[1]]]},output:function(n){return n&&[n[0][1],n[1][1]]}},b0={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(po),input:function(n){return n==null?null:Sm(n)},output:function(n){return n}};function po(n){return{type:n}}var go=Math.PI,_o=2*go,ze=1e-6,km=_o-ze;function Wu(n){this._+=n[0];for(let e=1,o=n.length;e<o;++e)this._+=arguments[e]+n[e]}function Tm(n){let e=Math.floor(n);if(!(e>=0))throw new Error(`invalid digits: ${n}`);if(e>15)return Wu;let o=10**e;return function(r){this._+=r[0];for(let s=1,h=r.length;s<h;++s)this._+=Math.round(arguments[s]*o)/o+r[s]}}var Re=class{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=e==null?Wu:Tm(e)}moveTo(e,o){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+o}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,o){this._append`L${this._x1=+e},${this._y1=+o}`}quadraticCurveTo(e,o,r,s){this._append`Q${+e},${+o},${this._x1=+r},${this._y1=+s}`}bezierCurveTo(e,o,r,s,h,c){this._append`C${+e},${+o},${+r},${+s},${this._x1=+h},${this._y1=+c}`}arcTo(e,o,r,s,h){if(e=+e,o=+o,r=+r,s=+s,h=+h,h<0)throw new Error(`negative radius: ${h}`);let c=this._x1,f=this._y1,_=r-e,g=s-o,l=c-e,m=f-o,v=l*l+m*m;if(this._x1===null)this._append`M${this._x1=e},${this._y1=o}`;else if(v>ze)if(!(Math.abs(m*_-g*l)>ze)||!h)this._append`L${this._x1=e},${this._y1=o}`;else{let y=r-c,M=s-f,x=_*_+g*g,C=y*y+M*M,k=Math.sqrt(x),P=Math.sqrt(v),A=h*Math.tan((go-Math.acos((x+v-C)/(2*k*P)))/2),S=A/P,R=A/k;Math.abs(S-1)>ze&&this._append`L${e+S*l},${o+S*m}`,this._append`A${h},${h},0,0,${+(m*y>l*M)},${this._x1=e+R*_},${this._y1=o+R*g}`}}arc(e,o,r,s,h,c){if(e=+e,o=+o,r=+r,c=!!c,r<0)throw new Error(`negative radius: ${r}`);let f=r*Math.cos(s),_=r*Math.sin(s),g=e+f,l=o+_,m=1^c,v=c?s-h:h-s;this._x1===null?this._append`M${g},${l}`:(Math.abs(this._x1-g)>ze||Math.abs(this._y1-l)>ze)&&this._append`L${g},${l}`,r&&(v<0&&(v=v%_o+_o),v>km?this._append`A${r},${r},0,1,${m},${e-f},${o-_}A${r},${r},0,1,${m},${this._x1=g},${this._y1=l}`:v>ze&&this._append`A${r},${r},0,${+(v>=go)},${m},${this._x1=e+r*Math.cos(h)},${this._y1=o+r*Math.sin(h)}`)}rect(e,o,r,s){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+o}h${r=+r}v${+s}h${-r}Z`}toString(){return this._}};function qu(){return new Re}qu.prototype=Re.prototype;function Pm(n,e){var o,r=1;n==null&&(n=0),e==null&&(e=0);function s(){var h,c=o.length,f,_=0,g=0;for(h=0;h<c;++h)f=o[h],_+=f.x,g+=f.y;for(_=(_/c-n)*r,g=(g/c-e)*r,h=0;h<c;++h)f=o[h],f.x-=_,f.y-=g}return s.initialize=function(h){o=h},s.x=function(h){return arguments.length?(n=+h,s):n},s.y=function(h){return arguments.length?(e=+h,s):e},s.strength=function(h){return arguments.length?(r=+h,s):r},s}function Xu(n){let e=+this._x.call(null,n),o=+this._y.call(null,n);return Yu(this.cover(e,o),e,o,n)}function Yu(n,e,o,r){if(isNaN(e)||isNaN(o))return n;var s,h=n._root,c={data:r},f=n._x0,_=n._y0,g=n._x1,l=n._y1,m,v,y,M,x,C,k,P;if(!h)return n._root=c,n;for(;h.length;)if((x=e>=(m=(f+g)/2))?f=m:g=m,(C=o>=(v=(_+l)/2))?_=v:l=v,s=h,!(h=h[k=C<<1|x]))return s[k]=c,n;if(y=+n._x.call(null,h.data),M=+n._y.call(null,h.data),e===y&&o===M)return c.next=h,s?s[k]=c:n._root=c,n;do s=s?s[k]=new Array(4):n._root=new Array(4),(x=e>=(m=(f+g)/2))?f=m:g=m,(C=o>=(v=(_+l)/2))?_=v:l=v;while((k=C<<1|x)===(P=(M>=v)<<1|y>=m));return s[P]=h,s[k]=c,n}function Ku(n){var e,o,r=n.length,s,h,c=new Array(r),f=new Array(r),_=1/0,g=1/0,l=-1/0,m=-1/0;for(o=0;o<r;++o)isNaN(s=+this._x.call(null,e=n[o]))||isNaN(h=+this._y.call(null,e))||(c[o]=s,f[o]=h,s<_&&(_=s),s>l&&(l=s),h<g&&(g=h),h>m&&(m=h));if(_>l||g>m)return this;for(this.cover(_,g).cover(l,m),o=0;o<r;++o)Yu(this,c[o],f[o],n[o]);return this}function Qu(n,e){if(isNaN(n=+n)||isNaN(e=+e))return this;var o=this._x0,r=this._y0,s=this._x1,h=this._y1;if(isNaN(o))s=(o=Math.floor(n))+1,h=(r=Math.floor(e))+1;else{for(var c=s-o||1,f=this._root,_,g;o>n||n>=s||r>e||e>=h;)switch(g=(e<r)<<1|n<o,_=new Array(4),_[g]=f,f=_,c*=2,g){case 0:s=o+c,h=r+c;break;case 1:o=s-c,h=r+c;break;case 2:s=o+c,r=h-c;break;case 3:o=s-c,r=h-c;break}this._root&&this._root.length&&(this._root=f)}return this._x0=o,this._y0=r,this._x1=s,this._y1=h,this}function Ju(){var n=[];return this.visit(function(e){if(!e.length)do n.push(e.data);while(e=e.next)}),n}function th(n){return arguments.length?this.cover(+n[0][0],+n[0][1]).cover(+n[1][0],+n[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function wt(n,e,o,r,s){this.node=n,this.x0=e,this.y0=o,this.x1=r,this.y1=s}function eh(n,e,o){var r,s=this._x0,h=this._y0,c,f,_,g,l=this._x1,m=this._y1,v=[],y=this._root,M,x;for(y&&v.push(new wt(y,s,h,l,m)),o==null?o=1/0:(s=n-o,h=e-o,l=n+o,m=e+o,o*=o);M=v.pop();)if(!(!(y=M.node)||(c=M.x0)>l||(f=M.y0)>m||(_=M.x1)<s||(g=M.y1)<h))if(y.length){var C=(c+_)/2,k=(f+g)/2;v.push(new wt(y[3],C,k,_,g),new wt(y[2],c,k,C,g),new wt(y[1],C,f,_,k),new wt(y[0],c,f,C,k)),(x=(e>=k)<<1|n>=C)&&(M=v[v.length-1],v[v.length-1]=v[v.length-1-x],v[v.length-1-x]=M)}else{var P=n-+this._x.call(null,y.data),A=e-+this._y.call(null,y.data),S=P*P+A*A;if(S<o){var R=Math.sqrt(o=S);s=n-R,h=e-R,l=n+R,m=e+R,r=y.data}}return r}function ih(n){if(isNaN(l=+this._x.call(null,n))||isNaN(m=+this._y.call(null,n)))return this;var e,o=this._root,r,s,h,c=this._x0,f=this._y0,_=this._x1,g=this._y1,l,m,v,y,M,x,C,k;if(!o)return this;if(o.length)for(;;){if((M=l>=(v=(c+_)/2))?c=v:_=v,(x=m>=(y=(f+g)/2))?f=y:g=y,e=o,!(o=o[C=x<<1|M]))return this;if(!o.length)break;(e[C+1&3]||e[C+2&3]||e[C+3&3])&&(r=e,k=C)}for(;o.data!==n;)if(s=o,!(o=o.next))return this;return(h=o.next)&&delete o.next,s?(h?s.next=h:delete s.next,this):e?(h?e[C]=h:delete e[C],(o=e[0]||e[1]||e[2]||e[3])&&o===(e[3]||e[2]||e[1]||e[0])&&!o.length&&(r?r[k]=o:this._root=o),this):(this._root=h,this)}function nh(n){for(var e=0,o=n.length;e<o;++e)this.remove(n[e]);return this}function rh(){return this._root}function oh(){var n=0;return this.visit(function(e){if(!e.length)do++n;while(e=e.next)}),n}function ah(n){var e=[],o,r=this._root,s,h,c,f,_;for(r&&e.push(new wt(r,this._x0,this._y0,this._x1,this._y1));o=e.pop();)if(!n(r=o.node,h=o.x0,c=o.y0,f=o.x1,_=o.y1)&&r.length){var g=(h+f)/2,l=(c+_)/2;(s=r[3])&&e.push(new wt(s,g,l,f,_)),(s=r[2])&&e.push(new wt(s,h,l,g,_)),(s=r[1])&&e.push(new wt(s,g,c,f,l)),(s=r[0])&&e.push(new wt(s,h,c,g,l))}return this}function sh(n){var e=[],o=[],r;for(this._root&&e.push(new wt(this._root,this._x0,this._y0,this._x1,this._y1));r=e.pop();){var s=r.node;if(s.length){var h,c=r.x0,f=r.y0,_=r.x1,g=r.y1,l=(c+_)/2,m=(f+g)/2;(h=s[0])&&e.push(new wt(h,c,f,l,m)),(h=s[1])&&e.push(new wt(h,l,f,_,m)),(h=s[2])&&e.push(new wt(h,c,m,l,g)),(h=s[3])&&e.push(new wt(h,l,m,_,g))}o.push(r)}for(;r=o.pop();)n(r.node,r.x0,r.y0,r.x1,r.y1);return this}function lh(n){return n[0]}function uh(n){return arguments.length?(this._x=n,this):this._x}function hh(n){return n[1]}function ch(n){return arguments.length?(this._y=n,this):this._y}function Ui(n,e,o){var r=new vo(e??lh,o??hh,NaN,NaN,NaN,NaN);return n==null?r:r.addAll(n)}function vo(n,e,o,r,s,h){this._x=n,this._y=e,this._x0=o,this._y0=r,this._x1=s,this._y1=h,this._root=void 0}function dh(n){for(var e={data:n.data},o=e;n=n.next;)o=o.next={data:n.data};return e}var Tt=Ui.prototype=vo.prototype;Tt.copy=function(){var n=new vo(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,o,r;if(!e)return n;if(!e.length)return n._root=dh(e),n;for(o=[{source:e,target:n._root=new Array(4)}];e=o.pop();)for(var s=0;s<4;++s)(r=e.source[s])&&(r.length?o.push({source:r,target:e.target[s]=new Array(4)}):e.target[s]=dh(r));return n};Tt.add=Xu;Tt.addAll=Ku;Tt.cover=Qu;Tt.data=Ju;Tt.extent=th;Tt.find=eh;Tt.remove=ih;Tt.removeAll=nh;Tt.root=rh;Tt.size=oh;Tt.visit=ah;Tt.visitAfter=sh;Tt.x=uh;Tt.y=ch;function Be(n){return function(){return n}}function pe(n){return(n()-.5)*1e-6}function Om(n){return n.index}function fh(n,e){var o=n.get(e);if(!o)throw new Error("node not found: "+e);return o}function Im(n){var e=Om,o=m,r,s=Be(30),h,c,f,_,g,l=1;n==null&&(n=[]);function m(C){return 1/Math.min(f[C.source.index],f[C.target.index])}function v(C){for(var k=0,P=n.length;k<l;++k)for(var A=0,S,R,U,X,rt,Q,ot;A<P;++A)S=n[A],R=S.source,U=S.target,X=U.x+U.vx-R.x-R.vx||pe(g),rt=U.y+U.vy-R.y-R.vy||pe(g),Q=Math.sqrt(X*X+rt*rt),Q=(Q-h[A])/Q*C*r[A],X*=Q,rt*=Q,U.vx-=X*(ot=_[A]),U.vy-=rt*ot,R.vx+=X*(ot=1-ot),R.vy+=rt*ot}function y(){if(c){var C,k=c.length,P=n.length,A=new Map(c.map((R,U)=>[e(R,U,c),R])),S;for(C=0,f=new Array(k);C<P;++C)S=n[C],S.index=C,typeof S.source!="object"&&(S.source=fh(A,S.source)),typeof S.target!="object"&&(S.target=fh(A,S.target)),f[S.source.index]=(f[S.source.index]||0)+1,f[S.target.index]=(f[S.target.index]||0)+1;for(C=0,_=new Array(P);C<P;++C)S=n[C],_[C]=f[S.source.index]/(f[S.source.index]+f[S.target.index]);r=new Array(P),M(),h=new Array(P),x()}}function M(){if(c)for(var C=0,k=n.length;C<k;++C)r[C]=+o(n[C],C,n)}function x(){if(c)for(var C=0,k=n.length;C<k;++C)h[C]=+s(n[C],C,n)}return v.initialize=function(C,k){c=C,g=k,y()},v.links=function(C){return arguments.length?(n=C,y(),v):n},v.id=function(C){return arguments.length?(e=C,v):e},v.iterations=function(C){return arguments.length?(l=+C,v):l},v.strength=function(C){return arguments.length?(o=typeof C=="function"?C:Be(+C),M(),v):o},v.distance=function(C){return arguments.length?(s=typeof C=="function"?C:Be(+C),x(),v):s},v}function mh(){let n=1;return()=>(n=(1664525*n+1013904223)%4294967296)/4294967296}function ph(n){return n.x}function gh(n){return n.y}var Dm=10,Am=Math.PI*(3-Math.sqrt(5));function Nm(n){var e,o=1,r=.001,s=1-Math.pow(r,1/300),h=0,c=.6,f=new Map,_=ri(m),g=Te("tick","end"),l=mh();n==null&&(n=[]);function m(){v(),g.call("tick",e),o<r&&(_.stop(),g.call("end",e))}function v(x){var C,k=n.length,P;x===void 0&&(x=1);for(var A=0;A<x;++A)for(o+=(h-o)*s,f.forEach(function(S){S(o)}),C=0;C<k;++C)P=n[C],P.fx==null?P.x+=P.vx*=c:(P.x=P.fx,P.vx=0),P.fy==null?P.y+=P.vy*=c:(P.y=P.fy,P.vy=0);return e}function y(){for(var x=0,C=n.length,k;x<C;++x){if(k=n[x],k.index=x,k.fx!=null&&(k.x=k.fx),k.fy!=null&&(k.y=k.fy),isNaN(k.x)||isNaN(k.y)){var P=Dm*Math.sqrt(.5+x),A=x*Am;k.x=P*Math.cos(A),k.y=P*Math.sin(A)}(isNaN(k.vx)||isNaN(k.vy))&&(k.vx=k.vy=0)}}function M(x){return x.initialize&&x.initialize(n,l),x}return y(),e={tick:v,restart:function(){return _.restart(m),e},stop:function(){return _.stop(),e},nodes:function(x){return arguments.length?(n=x,y(),f.forEach(M),e):n},alpha:function(x){return arguments.length?(o=+x,e):o},alphaMin:function(x){return arguments.length?(r=+x,e):r},alphaDecay:function(x){return arguments.length?(s=+x,e):+s},alphaTarget:function(x){return arguments.length?(h=+x,e):h},velocityDecay:function(x){return arguments.length?(c=1-x,e):1-c},randomSource:function(x){return arguments.length?(l=x,f.forEach(M),e):l},force:function(x,C){return arguments.length>1?(C==null?f.delete(x):f.set(x,M(C)),e):f.get(x)},find:function(x,C,k){var P=0,A=n.length,S,R,U,X,rt;for(k==null?k=1/0:k*=k,P=0;P<A;++P)X=n[P],S=x-X.x,R=C-X.y,U=S*S+R*R,U<k&&(rt=X,k=U);return rt},on:function(x,C){return arguments.length>1?(g.on(x,C),e):g.on(x)}}}function zm(){var n,e,o,r,s=Be(-30),h,c=1,f=1/0,_=.81;function g(y){var M,x=n.length,C=Ui(n,ph,gh).visitAfter(m);for(r=y,M=0;M<x;++M)e=n[M],C.visit(v)}function l(){if(n){var y,M=n.length,x;for(h=new Array(M),y=0;y<M;++y)x=n[y],h[x.index]=+s(x,y,n)}}function m(y){var M=0,x,C,k=0,P,A,S;if(y.length){for(P=A=S=0;S<4;++S)(x=y[S])&&(C=Math.abs(x.value))&&(M+=x.value,k+=C,P+=C*x.x,A+=C*x.y);y.x=P/k,y.y=A/k}else{x=y,x.x=x.data.x,x.y=x.data.y;do M+=h[x.data.index];while(x=x.next)}y.value=M}function v(y,M,x,C){if(!y.value)return!0;var k=y.x-e.x,P=y.y-e.y,A=C-M,S=k*k+P*P;if(A*A/_<S)return S<f&&(k===0&&(k=pe(o),S+=k*k),P===0&&(P=pe(o),S+=P*P),S<c&&(S=Math.sqrt(c*S)),e.vx+=k*y.value*r/S,e.vy+=P*y.value*r/S),!0;if(y.length||S>=f)return;(y.data!==e||y.next)&&(k===0&&(k=pe(o),S+=k*k),P===0&&(P=pe(o),S+=P*P),S<c&&(S=Math.sqrt(c*S)));do y.data!==e&&(A=h[y.data.index]*r/S,e.vx+=k*A,e.vy+=P*A);while(y=y.next)}return g.initialize=function(y,M){n=y,o=M,l()},g.strength=function(y){return arguments.length?(s=typeof y=="function"?y:Be(+y),l(),g):s},g.distanceMin=function(y){return arguments.length?(c=y*y,g):Math.sqrt(c)},g.distanceMax=function(y){return arguments.length?(f=y*y,g):Math.sqrt(f)},g.theta=function(y){return arguments.length?(_=y*y,g):Math.sqrt(_)},g}function Hi(n){return function(){return n}}var yo=Math.cos;var Wi=Math.sin,xt=Math.sqrt;var Ze=Math.PI,Ox=Ze/2,ai=2*Ze;function _h(n){let e=3;return n.digits=function(o){if(!arguments.length)return e;if(o==null)e=null;else{let r=Math.floor(o);if(!(r>=0))throw new RangeError(`invalid digits: ${o}`);e=r}return n},()=>new Re(e)}var bo={draw(n,e){let o=xt(e/Ze);n.moveTo(o,0),n.arc(0,0,o,0,ai)}};var Rm={draw(n,e){let o=xt(e/5)/2;n.moveTo(-3*o,-o),n.lineTo(-o,-o),n.lineTo(-o,-3*o),n.lineTo(o,-3*o),n.lineTo(o,-o),n.lineTo(3*o,-o),n.lineTo(3*o,o),n.lineTo(o,o),n.lineTo(o,3*o),n.lineTo(-o,3*o),n.lineTo(-o,o),n.lineTo(-3*o,o),n.closePath()}};var vh=xt(1/3),Bm=vh*2,Zm={draw(n,e){let o=xt(e/Bm),r=o*vh;n.moveTo(0,-o),n.lineTo(r,0),n.lineTo(0,o),n.lineTo(-r,0),n.closePath()}};var Fm={draw(n,e){let o=xt(e),r=-o/2;n.rect(r,r,o,o)}};var Gm=.8908130915292852,yh=Wi(Ze/10)/Wi(7*Ze/10),$m=Wi(ai/10)*yh,Vm=-yo(ai/10)*yh,jm={draw(n,e){let o=xt(e*Gm),r=$m*o,s=Vm*o;n.moveTo(0,-o),n.lineTo(r,s);for(let h=1;h<5;++h){let c=ai*h/5,f=yo(c),_=Wi(c);n.lineTo(_*o,-f*o),n.lineTo(f*r-_*s,_*r+f*s)}n.closePath()}};var wo=xt(3),Um={draw(n,e){let o=-xt(e/(wo*3));n.moveTo(0,o*2),n.lineTo(-wo*o,-o),n.lineTo(wo*o,-o),n.closePath()}};var Vt=-.5,jt=xt(3)/2,xo=1/xt(12),Hm=(xo/2+1)*3,Wm={draw(n,e){let o=xt(e/Hm),r=o/2,s=o*xo,h=r,c=o*xo+o,f=-h,_=c;n.moveTo(r,s),n.lineTo(h,c),n.lineTo(f,_),n.lineTo(Vt*r-jt*s,jt*r+Vt*s),n.lineTo(Vt*h-jt*c,jt*h+Vt*c),n.lineTo(Vt*f-jt*_,jt*f+Vt*_),n.lineTo(Vt*r+jt*s,Vt*s-jt*r),n.lineTo(Vt*h+jt*c,Vt*c-jt*h),n.lineTo(Vt*f+jt*_,Vt*_-jt*f),n.closePath()}};function bh(n,e){let o=null,r=_h(s);n=typeof n=="function"?n:Hi(n||bo),e=typeof e=="function"?e:Hi(e===void 0?64:+e);function s(){let h;if(o||(o=h=r()),n.apply(this,arguments).draw(o,+e.apply(this,arguments)),h)return o=null,h+""||null}return s.type=function(h){return arguments.length?(n=typeof h=="function"?h:Hi(h),s):n},s.size=function(h){return arguments.length?(e=typeof h=="function"?h:Hi(+h),s):e},s.context=function(h){return arguments.length?(o=h??null,s):o},s}function ge(n,e,o){this.k=n,this.x=e,this.y=o}ge.prototype={constructor:ge,scale:function(n){return n===1?this:new ge(this.k*n,this.x,this.y)},translate:function(n,e){return n===0&e===0?this:new ge(this.k,this.x+this.k*n,this.y+this.k*e)},apply:function(n){return[n[0]*this.k+this.x,n[1]*this.k+this.y]},applyX:function(n){return n*this.k+this.x},applyY:function(n){return n*this.k+this.y},invert:function(n){return[(n[0]-this.x)/this.k,(n[1]-this.y)/this.k]},invertX:function(n){return(n-this.x)/this.k},invertY:function(n){return(n-this.y)/this.k},rescaleX:function(n){return n.copy().domain(n.range().map(this.invertX,this).map(n.invert,n))},rescaleY:function(n){return n.copy().domain(n.range().map(this.invertY,this).map(n.invert,n))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Lo=new ge(1,0,0);si.prototype=ge.prototype;function si(n){for(;!n.__zoom;)if(!(n=n.parentNode))return Lo;return n.__zoom}var z=Li(ki()),pE=Li(Lh());var rE=new Me("MapService"),Eh=new Me("NetworkStateService"),oE=new Me("MapElementService"),aE=new Me("NetworkDesignService");var Mh=class n{constructor(e,o,r){this.zone=e;this.eventBus=o;this.networkStateService=r;this.logger.debug("MapService inicializado"),this.mapStateService.zoom$.pipe(Nt(this.destroy$)).subscribe(s=>{this.map&&this.isInitialized&&(this.logger.debug(`MapService: Recibido nuevo nivel de zoom desde MapStateService: ${s}`),this.setZoom(s,!0))}),this.mapStateService.center$.pipe(Nt(this.destroy$)).subscribe(s=>{this.map&&this.isInitialized&&s&&(this.logger.debug(`MapService: Recibidas nuevas coordenadas de centro desde MapStateService: ${s}`),this.map.panTo(s))}),this.mapStateManagerService.activeTool$.pipe(Nt(this.destroy$)).subscribe(s=>{this.isInitialized&&(this.logger.debug(`MapService: Recibida nueva herramienta desde MapStateManagerService: ${s}`),this.handleToolChange(s))})}logger=Et(pt);mapStateService=Et(kn);mapStateManagerService=Et(Je);networkMapRendererService=Et(In);mapElementManagerService=Et(ti);destroy$=new dt;mapElementRef=new pn(null);isInitialized=!1;isInteractionEnabled=!0;isReadySubject=new N(!1);currentToolSubject=new N("pan");isReady$=this.isReadySubject.asObservable();currentTool$=this.currentToolSubject.asObservable();svg=null;container=null;zoomBehavior=null;simulation=null;width=0;height=0;currentMapZoom=1;nodesGroup;linksGroup;mainGroup;selectedElement=null;currentToolActive="pan";isMapDarkMode=!1;serviceConfig=null;map=null;isPositionSelectionEnabled=!1;positionMarker=null;previewMarker=null;selectedPosition=null;selectedPositionSubject=new dt;measuringPoints=[];measurementPolyline=null;measurementMarkers=[];areaSelectionRectangle=null;areaSelectionStartPoint=null;isDrawingAreaSelection=!1;edgePanningZone=50;edgePanningSpeed=10;edgePanningAnimationFrameId=null;currentPanDirection={x:0,y:0};nodesData=[];linksData=[];internalIsDarkMode$=new N(!1);currentBaseLayerId$=new N("osm");activeTileLayer=null;isDarkMode$=this.internalIsDarkMode$.asObservable();baseLayers={osm:{id:"osm",name:"OpenStreetMap",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",options:{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',errorTileUrl:"assets/leaflet/error-tiles/error-tile.png",crossOrigin:!0,maxZoom:19}},satellite:{id:"satellite",name:"Sat\xE9lite",url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community",errorTileUrl:"assets/leaflet/error-tiles/error-tile.png",crossOrigin:!0,maxZoom:18}},terrain:{id:"terrain",name:"Terreno",url:"https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",options:{attribution:'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)',errorTileUrl:"assets/leaflet/error-tiles/error-tile.png",crossOrigin:!0,maxZoom:17}}};initializeEvents(){this.eventBus.on("WIDGET_ACTION").pipe(Nt(this.destroy$)).subscribe(e=>{if(e.payload?.component==="darkMode"&&this.toggleDarkMode(e.payload?.enabled),e.payload?.component==="elementSelected"){let o=e.payload?.element;o&&this.selectElement(o)}if(e.payload?.component==="mapReset"&&this.resetMap(),e.payload?.component==="changeBaseLayer"){let o=e.payload?.layerId;o&&this.setBaseLayer(o)}})}initialize(e){if(this.serviceConfig=e,this.container=e.container||null,!this.container){this.logger.error("Contenedor de mapa no especificado en MapService.initialize"),this.isReadySubject.next(!1);return}this.map&&this.destroyMap();let o=e.preferCanvas??!0;this.zone.runOutsideAngular(()=>{try{if(this.map=z.map(this.container,{center:e.initialCenter||[19.78375,-70.676666],zoom:e.initialZoom||16,minZoom:e.minZoom||3,maxZoom:e.maxZoom||19,zoomControl:!1,preferCanvas:o,attributionControl:!0}),this.logger.info("Instancia de Leaflet Map creada en MapService.initialize"),this.networkMapRendererService&&(this.networkMapRendererService.initialize(this.map),this.logger.debug("NetworkMapRendererService inicializado por MapService")),!z||!z.tileLayer){this.logger.error("Error: Leaflet no est\xE1 disponible. Verificar que la biblioteca est\xE9 correctamente importada");return}this.setBaseLayer(e.layerId||this.currentBaseLayerId$.value),e.isDarkMode&&this.setDarkMode(e.isDarkMode),this.setupMapEvents(e),this.isInitialized=!0,this.isReadySubject.next(!0),this.eventBus.emit({type:"MAP_READY",timestamp:new Date,payload:{map:this.map}}),this.logger.debug("Mapa inicializado correctamente")}catch(r){this.logger.error("Error al inicializar el mapa:",r),this.isReadySubject.next(!1),this.eventBus.emit({type:"MAP_ERROR",timestamp:new Date,payload:{error:r}})}})}setBaseLayer(e){if(!this.map){this.logger.warn("Mapa no inicializado. No se puede cambiar la capa base.");return}let o=this.baseLayers[e];if(!o){this.logger.error(`Configuraci\xF3n de capa base no encontrada para el ID: ${e}`),e!=="osm"&&this.setBaseLayer("osm");return}try{this.logger.debug(`Cambiando a capa base: ${o.name}`);let r=z.tileLayer(o.url,o.options);r.on("tileerror",s=>{this.logger.error(`Error al cargar tile para ${o.name}:`,s),this.loadBackupTiles()}),this.activeTileLayer&&this.map.removeLayer(this.activeTileLayer),r.addTo(this.map),this.activeTileLayer=r,this.currentBaseLayerId$.next(e),this.logger.debug(`Capa base ${o.name} cargada y activada.`)}catch(r){this.logger.error(`Error al cambiar a capa base ${o.name}:`,r),e!=="osm"&&(this.logger.info("Intentando cargar OpenStreetMap como fallback."),this.setBaseLayer("osm"))}}setupMapEvents(e){this.map&&(e.onElementSelect,this.map.on("zoomend",()=>{this.map}),this.map.on("moveend",()=>{this.map}))}destroyMap(){this.simulation&&this.simulation.stop(),this.map&&(this.map.remove(),this.map=null),this.svg&&(this.svg.selectAll("*").remove(),this.svg.remove(),this.svg=null),this.container=null,this.isReadySubject.next(!1)}isMapReady(){return this.isReadySubject.asObservable()}getMap(){return this.map}panTo(e){this.map&&this.map.panTo([e.lat,e.lng])}zoomTo(e){this.map&&this.map.setZoom(e)}centerOnCoordinates(e){if(this.map){let o=this.map.containerPointToLatLng([e.x,e.y]);this.map.panTo(o)}}setDarkMode(e){this.isMapDarkMode=e,this.internalIsDarkMode$.next(e),this.map&&this.updateBaseLayer(e?"dark":"osm"),this.svg&&this.svg.classed("dark-theme",e)}updateBaseLayer(e){if(this.currentBaseLayerId$.next(e),!!this.map)try{this.map.eachLayer(r=>{r instanceof z.TileLayer&&this.map?.removeLayer(r)});let o={errorTileUrl:"assets/error-tiles/error-tile.png",crossOrigin:!0,maxZoom:19};switch(e){case"dark":z.tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",Z(I({},o),{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',subdomains:"abcd"})).addTo(this.map);break;case"satellite":z.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",Z(I({},o),{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"})).addTo(this.map);break;case"hybrid":z.tileLayer("https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}",Z(I({},o),{attribution:"Map data &copy; Google"})).addTo(this.map);break;case"terrain":z.tileLayer("https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",Z(I({},o),{attribution:'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'})).addTo(this.map);break;case"offline":z.tileLayer("assets/leaflet/offline-tiles/{z}/{x}/{y}.png",Z(I({},o),{attribution:"Tiles Offline"})).addTo(this.map);break;case"osm":default:z.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",Z(I({},o),{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'})).addTo(this.map);break}this.logger.debug(`Capa base actualizada a: ${e}`)}catch(o){this.logger.error("Error al cambiar la capa base:",o),this.loadFallbackLayer()}}convertZoomLevelToPercent(e){return Math.round(e/19*100)}convertZoomPercentToLevel(e){return Math.round(e/100*19)}setTool(e){switch(this.currentToolActive=e,e){case"pan":this.enablePanMode();break;case"select":this.enableSelectMode();break;case"measure":this.enableMeasurement();break;case"area_select":this.enableAreaSelectMode(!0);break;default:this.enablePanMode()}this.eventBus.emit({type:"WIDGET_ACTION",timestamp:new Date,payload:{component:"toolChanged",tool:this.currentToolActive}})}enablePanMode(){this.map&&this.map.dragging.enable()}enableSelectMode(){this.map}enableAreaSelectMode(e){this.map}getNodesData(){return this.nodesData}getLinksData(){return this.linksData}fitContentToScreen(){if(this.map&&this.nodesData.length>0){let e=this.nodesData.filter(o=>o.x!==void 0&&o.y!==void 0).map(o=>new z.LatLng(o.y||0,o.x||0));if(e.length>0){let o=z.latLngBounds(e);this.map.fitBounds(o,{padding:[30,30]})}}}getVisibleBoundingBox(){if(this.map){let e=this.map.getBounds();return{north:e.getNorth(),south:e.getSouth(),east:e.getEast(),west:e.getWest()}}return{north:90,south:-90,east:180,west:-180}}zoomIn(){if(this.map)this.map.zoomIn();else if(this.zoomBehavior&&this.svg){let o=si(this.svg.node()).k*1.2;this.zoomBehavior.scaleBy(this.svg,1.2),this.currentMapZoom=o}}zoomOut(){if(this.map)this.map.zoomOut();else if(this.zoomBehavior&&this.svg){let o=si(this.svg.node()).k/1.2;this.zoomBehavior.scaleBy(this.svg,1/1.2),this.currentMapZoom=o}}centerOnElement(e){if(e.position){if(this.map){let o=new z.LatLng(e.position.lat,e.position.lng);this.map.panTo(o)}else if(this.svg&&e.position.coordinates){let[o,r]=e.position.coordinates;this.centerOnCoordinates({x:o,y:r})}}}fitToScreen(){if(this.map){let e=this.getNodesData().map(s=>({id:s.id,position:{lat:s.y||0,lng:s.x||0}}));if(e.length===0)return;let o=e.filter(s=>s.position).map(s=>new z.LatLng(s.position.lat,s.position.lng));if(o.length===0)return;let r=z.latLngBounds(o);this.map.fitBounds(r,{padding:[50,50],maxZoom:15})}else this.svg&&this.zoomBehavior&&this.fitContentToScreen()}setZoom(e,o=!1){if(this.map){let r=e;this.logger.debug(`MapService: Aplicando zoom de Leaflet: ${r}, Animado: ${o}`),this.map.setZoom(r,{animate:o})}else if(this.svg&&this.zoomBehavior){let r=this.convertPercentToScale(e);this.zoomBehavior.scaleTo(this.svg,r)}}enablePositionSelection(){this.map&&(this.isPositionSelectionEnabled=!0,this.container?.classList.add("map-position-selection"),this.map.on("click",this.handleMapClick),this.logger.debug("Modo de selecci\xF3n de posici\xF3n activado"))}disablePositionSelection(){this.map&&(this.isPositionSelectionEnabled=!1,this.container?.classList.remove("map-position-selection"),this.map.off("click",this.handleMapClick),this.positionMarker&&(this.map.removeLayer(this.positionMarker),this.positionMarker=null),this.logger.debug("Modo de selecci\xF3n de posici\xF3n desactivado"))}handleMapClick=e=>{if(!this.isPositionSelectionEnabled||!this.map)return;let o=e.latlng;if(this.selectedPosition={lat:o.lat,lng:o.lng},this.selectedPositionSubject.next(this.selectedPosition),this.positionMarker)this.positionMarker.setLatLng(o);else{let r=z.icon({iconUrl:"assets/leaflet/map-icons/position-marker.svg",iconSize:[32,32],iconAnchor:[16,32]});this.positionMarker=z.marker(o,{icon:r,draggable:!0}).addTo(this.map),this.positionMarker.on("dragend",()=>{if(this.positionMarker){let s=this.positionMarker.getLatLng();this.selectedPosition={lat:s.lat,lng:s.lng},this.selectedPositionSubject.next(this.selectedPosition)}})}};getSelectedPosition(){return this.selectedPositionSubject.asObservable()}previewElement(e){if(!this.map||!e.position)return;this.clearPreview();let o=new z.LatLng(e.position.lat,e.position.lng),r=z.icon({iconUrl:`assets/leaflet/map-icons/${e.type.toLowerCase()}.svg`,iconSize:[32,32],iconAnchor:[16,16],className:"preview-marker"});this.previewMarker=z.marker(o,{icon:r}).addTo(this.map),this.map.panTo(o)}clearPreview(){this.map&&this.previewMarker&&(this.map.removeLayer(this.previewMarker),this.previewMarker=null)}centerMap(){this.map&&this.serviceConfig&&this.serviceConfig.initialCenter&&this.map.setView(this.serviceConfig.initialCenter,this.convertZoomPercentToLevel(this.serviceConfig.initialZoom||100))}addElementAtPosition(e,o,r){if(!this.map)return;let s=new z.LatLng(r,o);this.map.panTo(s),this.clearPreview(),this.disablePositionSelection()}updateMapElements(e,o){this.logger.debug(`Actualizaci\xF3n de elementos solicitada: ${e.length} elementos, ${o.length} conexiones`),this.nodesData=e.filter(r=>!!r.id&&!!r.position).map(r=>{let s=r.position?.lng??0,h=r.position?.lat??0;return Z(I({},r),{id:r.id,x:s,y:h,fx:r.metadata?.fixed?s:null,fy:r.metadata?.fixed?h:null})})}exportMap(e){this.map&&this.logger.debug(`Exportando mapa en formato ${e}`)}initializeMap(e){this.logger.debug("[MapService] initializeMap llamado con MapConfig",e);let o=null;if(typeof e.container=="string"){if(o=document.getElementById(e.container),!o)return this.logger.error(`Contenedor del mapa con ID '${e.container}' no encontrado en el DOM.`),Promise.reject(`Contenedor del mapa '${e.container}' no encontrado.`)}else o=e.container;if(this.container=o,!this.container)return this.logger.error("Contenedor del mapa no resuelto desde MapConfig para initializeMap"),Promise.reject("Contenedor del mapa no disponible");let r={container:this.container,initialCenter:[19.78375,-70.676666],initialZoom:e.initialZoom||16,minZoom:e.minZoom,maxZoom:e.maxZoom,layerId:"osm",preferCanvas:!0,editOptions:{},isDarkMode:e.isDarkMode||!1,onElementSelect:e.onElementSelect};return this.initialize(r),Promise.resolve()}clearMap(){}stopSimulation(){}selectElement(e){}handleConnection(e,o,r){}getMapCenter(){return{x:0,y:0}}getCurrentZoom(){return 1}clearMeasurements(){}refreshMapSize(){}convertPercentToScale(e){return 1}convertScaleToPercent(e){return 100}sendPositionToEditor(e,o){}handleElementSelectedViaEvent(e){this.selectedElement=e,e&&this.map&&e.position&&this.panTo(e.position)}resetMap(){if(this.map){let e=this.serviceConfig?.initialCenter||[19.78375,-70.676666],o=this.serviceConfig?.initialZoom||16;this.map.setView(e,o),this.clearMarkers(),this.selectedElement=null}}clearMarkers(){this.positionMarker&&this.map&&(this.map.removeLayer(this.positionMarker),this.positionMarker=null),this.previewMarker&&this.map&&(this.map.removeLayer(this.previewMarker),this.previewMarker=null),this.selectedPosition=null,this.selectedPositionSubject.next(null)}handleToolChange(e){this.currentToolActive=e;let o=this.map?.getContainer();switch(this.map&&o&&(this.map.dragging.disable(),z.DomUtil.removeClass(o,"cursor-pointer"),z.DomUtil.removeClass(o,"cursor-crosshair"),z.DomUtil.removeClass(o,"cursor-grab"),this.disableMeasurementTool(),this.disableAreaSelectionTool(),this.disableSelectionTool()),e){case"pan":this.enablePanning();break;case"select":this.enableSelection();break;case"areaSelect":this.enableAreaSelection();break;case"measure":this.enableMeasurement();break;default:this.enablePanning();break}this.logger.debug(`Herramienta cambiada a: ${e}`)}toggleDarkMode(e){this.setDarkMode(e),this.logger.debug(`Modo oscuro ${e?"activado":"desactivado"}`)}disableInteraction(){this.logger.debug("Deshabilitando interacciones del mapa")}enablePanning(){this.logger.debug("Habilitando navegaci\xF3n del mapa (pan)"),this.map&&this.map.dragging.enable()}enableSelection(){if(this.logger.debug("Habilitando selecci\xF3n de elementos"),this.map){this.map.dragging.disable();let e=this.map.getContainer();z.DomUtil.addClass(e,"cursor-pointer"),this.map.on("click",this.handleMapSelectionClick)}}disableSelectionTool(){this.map&&this.map.off("click",this.handleMapSelectionClick),this.logger.debug("Herramienta de selecci\xF3n deshabilitada.")}handleMapSelectionClick=e=>{this.logger.debug("Clic en mapa vac\xEDo con herramienta seleccionar. Limpiando selecci\xF3n."),this.mapStateManagerService.clearSelectedElements()};enableMeasurement(){if(this.logger.debug("Habilitando medici\xF3n de distancias"),this.map){this.clearCurrentMeasurement(),this.map.dragging.disable();let e=this.map.getContainer();z.DomUtil.addClass(e,"cursor-crosshair"),this.map.on("click",this.handleMeasureMapClick),e.addEventListener("mousemove",this.handleMouseMoveForEdgePanning),e.addEventListener("mouseleave",this.stopEdgePanningOnMouseLeave)}}handleMeasureMapClick=e=>{if(!this.map||this.currentToolActive!=="measure")return;let o=e.latlng,r=0,s=0;if(this.measuringPoints.push(o),this.measuringPoints.length>=2){let f=this.measuringPoints[this.measuringPoints.length-2],_=o.distanceTo(f);r=parseFloat((_/1e3).toFixed(2))}if(this.measuringPoints.length>=2){s=0;for(let f=1;f<this.measuringPoints.length;f++)s+=this.measuringPoints[f].distanceTo(this.measuringPoints[f-1]);s=parseFloat((s/1e3).toFixed(2))}let h=z.circleMarker(o,{radius:6,color:"blue",fillColor:"#3388ff",fillOpacity:.7,weight:1}).addTo(this.map),c="";this.measuringPoints.length===1?c="Punto inicial":(c=`Segmento: ${r} km`,this.measuringPoints.length>=2&&(c+=`<br>Total: ${s} km`)),h.bindTooltip(c,{permanent:!0,direction:"top",offset:[0,-7],className:"measurement-tooltip"}).openTooltip(),this.measurementMarkers.push(h),this.measuringPoints.length>=2&&(this.measurementPolyline?this.measurementPolyline.setLatLngs(this.measuringPoints):this.measurementPolyline=z.polyline(this.measuringPoints,{color:"blue"}).addTo(this.map)),this.logger.debug(`Punto de medici\xF3n a\xF1adido: ${o}. Total puntos: ${this.measuringPoints.length}`)};clearCurrentMeasurement(){this.measuringPoints=[],this.measurementPolyline&&(this.map?.removeLayer(this.measurementPolyline),this.measurementPolyline=null),this.measurementMarkers.forEach(e=>this.map?.removeLayer(e)),this.measurementMarkers=[],this.logger.debug("Medici\xF3n actual limpiada.")}disableMeasurementTool(){if(this.map){this.map.off("click",this.handleMeasureMapClick);let e=this.map.getContainer();e.removeEventListener("mousemove",this.handleMouseMoveForEdgePanning),e.removeEventListener("mouseleave",this.stopEdgePanningOnMouseLeave),this.stopEdgePanningLoop()}this.clearCurrentMeasurement(),this.logger.debug("Herramienta de medici\xF3n deshabilitada.")}enableConnectionCreation(){this.logger.debug("Habilitando creaci\xF3n de conexiones")}enableAreaSelection(){if(this.logger.debug("Habilitando selecci\xF3n por \xE1rea"),this.map){this.disableAreaSelectionTool(),this.map.dragging.disable();let e=this.map.getContainer();z.DomUtil.addClass(e,"cursor-crosshair"),e.addEventListener("mousedown",this.handleAreaSelectMouseDown),e.addEventListener("mousemove",this.handleMouseMoveForEdgePanning),e.addEventListener("mouseleave",this.stopEdgePanningOnMouseLeave)}}disableAreaSelectionTool(){if(this.map){let e=this.map.getContainer();e.removeEventListener("mousedown",this.handleAreaSelectMouseDown),e.removeEventListener("mousemove",this.handleAreaSelectMouseMove),document.removeEventListener("mouseup",this.handleAreaSelectMouseUp),this.areaSelectionRectangle&&(this.map.removeLayer(this.areaSelectionRectangle),this.areaSelectionRectangle=null),this.isDrawingAreaSelection=!1,this.areaSelectionStartPoint=null,this.stopEdgePanningLoop()}this.logger.debug("Herramienta de selecci\xF3n por \xE1rea deshabilitada.")}handleAreaSelectMouseDown=e=>{if(!this.map||this.currentToolActive!=="areaSelect"||e.button!==0)return;e.preventDefault(),this.isDrawingAreaSelection=!0,this.areaSelectionStartPoint=this.map.mouseEventToLayerPoint(e),this.areaSelectionRectangle&&(this.map.removeLayer(this.areaSelectionRectangle),this.areaSelectionRectangle=null),this.map.getContainer().addEventListener("mousemove",this.handleAreaSelectMouseMove),document.addEventListener("mouseup",this.handleAreaSelectMouseUp),this.logger.debug("Inicio de selecci\xF3n por \xE1rea en:",this.areaSelectionStartPoint)};handleAreaSelectMouseMove=e=>{if(!this.map||!this.isDrawingAreaSelection||!this.areaSelectionStartPoint)return;let o=this.map.mouseEventToLayerPoint(e),r=z.bounds(this.areaSelectionStartPoint,o),s=z.latLngBounds(this.map.layerPointToLatLng(r.min),this.map.layerPointToLatLng(r.max));this.areaSelectionRectangle?this.areaSelectionRectangle.setBounds(s):this.areaSelectionRectangle=z.rectangle(s,{color:"#3388ff",weight:1,fillOpacity:.2}).addTo(this.map)};handleAreaSelectMouseUp=e=>{if(!this.map||!this.isDrawingAreaSelection||e.button!==0){this.isDrawingAreaSelection&&this.finishAreaSelection(null);return}e.preventDefault();let o=this.map.mouseEventToLayerPoint(e);this.finishAreaSelection(o)};finishAreaSelection(e){if(this.isDrawingAreaSelection=!1,this.map?.getContainer()?.removeEventListener("mousemove",this.handleAreaSelectMouseMove),document.removeEventListener("mouseup",this.handleAreaSelectMouseUp),!this.map||!this.areaSelectionStartPoint||!this.areaSelectionRectangle||!e){this.areaSelectionRectangle&&(this.map?.removeLayer(this.areaSelectionRectangle),this.areaSelectionRectangle=null),this.areaSelectionStartPoint=null,this.logger.debug("Selecci\xF3n por \xE1rea cancelada o incompleta.");return}let r=this.areaSelectionRectangle.getBounds();this.logger.debug("Selecci\xF3n por \xE1rea finalizada. Bounds:",r);let s=this.findElementsInBounds(r);this.logger.info(`Elementos seleccionados por \xE1rea: ${s.length}`,s),this.mapStateManagerService.setSelectedElements(s),this.areaSelectionRectangle&&(this.map.removeLayer(this.areaSelectionRectangle),this.areaSelectionRectangle=null),this.areaSelectionStartPoint=null,s.length>0&&this.mapStateManagerService.setTool("select")}findElementsInBounds(e){return!this.nodesData||this.nodesData.length===0?[]:this.nodesData.filter(o=>{if(typeof o.y=="number"&&typeof o.x=="number"){let r=z.latLng(o.y,o.x);return e.contains(r)}return!1})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.destroyMap(),document.removeEventListener("keydown",this.handleGlobalKeyDown),this.logger.debug("MapService destruido y desuscrito de observables, listener de teclado eliminado.")}enableElementEditing(){this.logger.debug("Habilitando edici\xF3n de elementos")}loadFallbackLayer(){try{if(!this.map){this.logger.error("El mapa no est\xE1 inicializado");return}this.logger.debug("Cargando capa fallback"),z.tileLayer("https://a.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',errorTileUrl:"assets/leaflet/error-tiles/error-tile.png",crossOrigin:!0}).addTo(this.map)}catch(e){this.logger.error("Error al cargar capa fallback:",e),this.loadOfflineTiles()}}loadOfflineTiles(){try{if(!this.map){this.logger.error("El mapa no est\xE1 inicializado");return}this.logger.debug("Intentando cargar tiles offline"),z.tileLayer("assets/leaflet/offline-tiles/{z}/{x}/{y}.png",{errorTileUrl:"assets/leaflet/error-tiles/error-tile.png",attribution:"Tiles Offline",crossOrigin:!0,minZoom:10,maxZoom:18}).addTo(this.map)}catch(e){this.logger.error("No se pudieron cargar los tiles offline:",e),this.createPlainLayer()}}createPlainLayer(){if(!this.map){this.logger.error("El mapa no est\xE1 inicializado");return}this.logger.debug("Creando capa plana como \xFAltimo recurso");let e=document.createElement("canvas");e.width=256,e.height=256;let o=e.getContext("2d");o&&(o.fillStyle="#f2f2f2",o.fillRect(0,0,256,256),o.strokeStyle="#ddd",o.strokeRect(0,0,256,256),o.font="10px Arial",o.fillStyle="#888",o.fillText("Error de carga",80,128));let r=e.toDataURL();z.tileLayer(r,{attribution:"Fallback Layer"}).addTo(this.map)}loadBackupTiles(){this.logger.debug("Cargando tiles de respaldo")}handleGlobalKeyDown=e=>{(e.key==="Escape"||e.keyCode===27)&&(this.currentToolActive==="measure"&&this.measuringPoints.length>0?(this.logger.debug("Tecla Escape presionada durante la medici\xF3n. Limpiando medici\xF3n..."),this.clearCurrentMeasurement()):this.currentToolActive==="areaSelect"&&this.isDrawingAreaSelection&&(this.logger.debug("Tecla Escape presionada durante la selecci\xF3n por \xE1rea. Cancelando..."),this.finishAreaSelection(null)))};handleMouseMoveForEdgePanning=e=>{if(!this.map||this.currentToolActive!=="measure"&&this.currentToolActive!=="areaSelect"&&this.currentToolActive!=="connect"){this.stopEdgePanningLoop();return}let r=this.map.getContainer().getBoundingClientRect(),s=e.clientX-r.left,h=e.clientY-r.top,c=0,f=0;s<this.edgePanningZone?c=-1:s>r.width-this.edgePanningZone&&(c=1),h<this.edgePanningZone?f=-1:h>r.height-this.edgePanningZone&&(f=1),this.currentPanDirection={x:c,y:f},c!==0||f!==0?this.edgePanningAnimationFrameId||this.startEdgePanningLoop():this.stopEdgePanningLoop()};startEdgePanningLoop(){this.edgePanningAnimationFrameId||this.edgePanLoop()}edgePanLoop=()=>{if(!this.map||this.currentPanDirection.x===0&&this.currentPanDirection.y===0){this.stopEdgePanningLoop();return}this.map.panBy([this.currentPanDirection.x*this.edgePanningSpeed,this.currentPanDirection.y*this.edgePanningSpeed],{animate:!1}),this.edgePanningAnimationFrameId=requestAnimationFrame(this.edgePanLoop)};stopEdgePanningLoop(){this.edgePanningAnimationFrameId&&(cancelAnimationFrame(this.edgePanningAnimationFrameId),this.edgePanningAnimationFrameId=null)}stopEdgePanningOnMouseLeave=()=>{this.logger.debug("Mouse ha salido del contenedor del mapa, deteniendo edge panning."),this.currentPanDirection={x:0,y:0},this.stopEdgePanningLoop()};refreshElementsDisplay(){if(!this.map||!this.isInitialized||!this.networkMapRendererService||!this.mapElementManagerService){this.logger.warn("[MapService] No se puede refrescar elementos: Mapa o servicios no inicializados.");return}let e=this.mapElementManagerService.getAllElements();this.logger.debug(`[MapService] refreshElementsDisplay: Obtenidos ${e.length} elementos.`),this.networkMapRendererService.renderElements(e,this.map.getBounds());let o=this.mapElementManagerService.getAllConnections();this.logger.info(`[MapService] refreshElementsDisplay: Obtenidas ${o.length} conexiones para renderizar:`,JSON.stringify(o.map(r=>({id:r.id,source:r.sourceElementId,target:r.targetElementId})))),o&&o.length>0?(this.networkMapRendererService.renderConnections(o),this.logger.debug(`[MapService] Renderizado de conexiones solicitado para ${o.length} conexiones.`)):(this.logger.debug("[MapService] No hay conexiones para renderizar o no se pudieron obtener."),this.networkMapRendererService.renderConnections([])),this.logger.info("[MapService] Visualizaci\xF3n de elementos y conexiones refrescada.")}updateElementPreviewPosition(e,o,r){if(!this.map)return;let s=this.findElementMarker(e);s?s.setLatLng([r,o]):this.logger.debug(`No se encontr\xF3 el marcador para el elemento ${e}`)}findElementMarker(e){if(!this.map)return null;let o=null;return this.map.eachLayer(r=>{(r instanceof z.Marker&&r.options.title===e||r.elementId===e)&&(o=r)}),o}static \u0275fac=function(o){return new(o||n)(K(Ye),K(Sn),K(Eh,8))};static \u0275prov=ft({token:n,factory:n.\u0275fac,providedIn:"root"})};export{Qs as a,Qr as b,En as c,Mn as d,Je as e,ki as f,Oe as g,xf as h,Pm as i,Im as j,Nm as k,zm as l,bo as m,Rm as n,Zm as o,Fm as p,jm as q,Um as r,Wm as s,bh as t,Sn as u,kn as v,Tn as w,ti as x,Pn as y,In as z,Mh as A};
