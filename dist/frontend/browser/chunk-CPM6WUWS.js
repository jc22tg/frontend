import{b as Ua}from"./chunk-E3NR5YS4.js";import{d as $a,f as Ga,g as Va,h as ja}from"./chunk-JGNBERAY.js";import{a as Ba,c as Za,d as Fa}from"./chunk-Q2I2H6RZ.js";import{a as Ca,b as Sa,c as ka,e as Pa,f as Ta,g as Ia,h as Oa}from"./chunk-RMHD7ZOV.js";import{a as Ci,e as Ha}from"./chunk-KIEZATJL.js";import{a as St}from"./chunk-VONGITAP.js";import{a as pt}from"./chunk-QQ6SKILC.js";import{d as Aa,e as Da,f as za,g as Ra,j as Na}from"./chunk-RWQWO3EM.js";import{a as yn}from"./chunk-4RASZFGW.js";import{A as Ea,B as Ma,a as da,b as fa,c as ma,d as ti,g as pa,h as ga,l as _a,m as va,o as ya,r as wa,v as ba,w as xa,z as La}from"./chunk-JO2MD4NL.js";import{a as oa,b as sa,c as aa,f as la,j as ha,n as ca}from"./chunk-XJSBNB6N.js";import{w as ua}from"./chunk-VH7SA6GK.js";import{H as $r,k as ia,m as na,x as ra}from"./chunk-4PHUDKEH.js";import{$a as wt,$c as ea,Aa as Nr,Ab as Zs,Ba as zs,Cb as Fs,D as Ts,F as Ce,Ga as Rs,Gb as J,Hb as q,Ib as Gt,Ja as Br,K as Is,Ka as Qe,M as Ei,Mb as $s,Mc as Js,Na as mn,Nb as Gs,Nc as ta,Ob as Je,Pb as Fr,Qb as Vs,Rb as js,Ta as Ns,Ub as Us,Vb as Hs,Wb as Ws,Zb as qs,_b as mt,ac as Mi,bc as Xs,da as Rt,db as pn,f as dt,fa as Ke,g as z,gc as Ys,ia as Os,id as vn,ja as ft,ka as As,kb as gn,lb as Bs,ma as Se,n as zt,o as Me,oa as K,pa as Et,qb as ke,s as zr,vc as Ks,wb as _n,xb as At,xc as Pe,ya as Ds,yc as Qs,za as Rr,zb as Zr}from"./chunk-FG6FKNI4.js";import{a as O,b as Z,e as Dr,f as Li,g as Ps}from"./chunk-OXVY4BEJ.js";var Si=Dr((Ln,Qa)=>{"use strict";(function(i,a){typeof Ln=="object"&&typeof Qa<"u"?a(Ln):typeof define=="function"&&define.amd?define(["exports"],a):(i=typeof globalThis<"u"?globalThis:i||self,a(i.leaflet={}))})(Ln,function(i){"use strict";var a="1.9.4";function n(t){var e,s,c,d;for(s=1,c=arguments.length;s<c;s++){d=arguments[s];for(e in d)t[e]=d[e]}return t}var r=Object.create||function(){function t(){}return function(e){return t.prototype=e,new t}}();function o(t,e){var s=Array.prototype.slice;if(t.bind)return t.bind.apply(t,s.call(arguments,1));var c=s.call(arguments,2);return function(){return t.apply(e,c.length?c.concat(s.call(arguments)):arguments)}}var h=0;function u(t){return"_leaflet_id"in t||(t._leaflet_id=++h),t._leaflet_id}function f(t,e,s){var c,d,g,w;return w=function(){c=!1,d&&(g.apply(s,d),d=!1)},g=function(){c?d=arguments:(t.apply(s,arguments),setTimeout(w,e),c=!0)},g}function _(t,e,s){var c=e[1],d=e[0],g=c-d;return t===c&&s?t:((t-d)%g+g)%g+d}function p(){return!1}function l(t,e){if(e===!1)return t;var s=Math.pow(10,e===void 0?6:e);return Math.round(t*s)/s}function m(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function v(t){return m(t).split(/\s+/)}function y(t,e){Object.prototype.hasOwnProperty.call(t,"options")||(t.options=t.options?r(t.options):{});for(var s in e)t.options[s]=e[s];return t.options}function M(t,e,s){var c=[];for(var d in t)c.push(encodeURIComponent(s?d.toUpperCase():d)+"="+encodeURIComponent(t[d]));return(!e||e.indexOf("?")===-1?"?":"&")+c.join("&")}var x=/\{ *([\w_ -]+) *\}/g;function C(t,e){return t.replace(x,function(s,c){var d=e[c];if(d===void 0)throw new Error("No value provided for variable "+s);return typeof d=="function"&&(d=d(e)),d})}var k=Array.isArray||function(t){return Object.prototype.toString.call(t)==="[object Array]"};function T(t,e){for(var s=0;s<t.length;s++)if(t[s]===e)return s;return-1}var D="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function S(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}var N=0;function U(t){var e=+new Date,s=Math.max(0,16-(e-N));return N=e+s,window.setTimeout(t,s)}var X=window.requestAnimationFrame||S("RequestAnimationFrame")||U,rt=window.cancelAnimationFrame||S("CancelAnimationFrame")||S("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)};function Q(t,e,s){if(s&&X===U)t.call(e);else return X.call(window,o(t,e))}function ot(t){t&&rt.call(window,t)}var Nt={__proto__:null,extend:n,create:r,bind:o,get lastId(){return h},stamp:u,throttle:f,wrapNum:_,falseFn:p,formatNum:l,trim:m,splitWords:v,setOptions:y,getParamString:M,template:C,isArray:k,indexOf:T,emptyImageUrl:D,requestFn:X,cancelFn:rt,requestAnimFrame:Q,cancelAnimFrame:ot};function Bt(){}Bt.extend=function(t){var e=function(){y(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},s=e.__super__=this.prototype,c=r(s);c.constructor=e,e.prototype=c;for(var d in this)Object.prototype.hasOwnProperty.call(this,d)&&d!=="prototype"&&d!=="__super__"&&(e[d]=this[d]);return t.statics&&n(e,t.statics),t.includes&&(Wi(t.includes),n.apply(null,[c].concat(t.includes))),n(c,t),delete c.statics,delete c.includes,c.options&&(c.options=s.options?r(s.options):{},n(c.options,t.options)),c._initHooks=[],c.callInitHooks=function(){if(!this._initHooksCalled){s.callInitHooks&&s.callInitHooks.call(this),this._initHooksCalled=!0;for(var g=0,w=c._initHooks.length;g<w;g++)c._initHooks[g].call(this)}},e},Bt.include=function(t){var e=this.prototype.options;return n(this.prototype,t),t.options&&(this.prototype.options=e,this.mergeOptions(t.options)),this},Bt.mergeOptions=function(t){return n(this.prototype.options,t),this},Bt.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),s=typeof t=="function"?t:function(){this[t].apply(this,e)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(s),this};function Wi(t){if(!(typeof L>"u"||!L||!L.Mixin)){t=k(t)?t:[t];for(var e=0;e<t.length;e++)t[e]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var _t={on:function(t,e,s){if(typeof t=="object")for(var c in t)this._on(c,t[c],e);else{t=v(t);for(var d=0,g=t.length;d<g;d++)this._on(t[d],e,s)}return this},off:function(t,e,s){if(!arguments.length)delete this._events;else if(typeof t=="object")for(var c in t)this._off(c,t[c],e);else{t=v(t);for(var d=arguments.length===1,g=0,w=t.length;g<w;g++)d?this._off(t[g]):this._off(t[g],e,s)}return this},_on:function(t,e,s,c){if(typeof e!="function"){console.warn("wrong listener type: "+typeof e);return}if(this._listens(t,e,s)===!1){s===this&&(s=void 0);var d={fn:e,ctx:s};c&&(d.once=!0),this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(d)}},_off:function(t,e,s){var c,d,g;if(this._events&&(c=this._events[t],!!c)){if(arguments.length===1){if(this._firingCount)for(d=0,g=c.length;d<g;d++)c[d].fn=p;delete this._events[t];return}if(typeof e!="function"){console.warn("wrong listener type: "+typeof e);return}var w=this._listens(t,e,s);if(w!==!1){var b=c[w];this._firingCount&&(b.fn=p,this._events[t]=c=c.slice()),c.splice(w,1)}}},fire:function(t,e,s){if(!this.listens(t,s))return this;var c=n({},e,{type:t,target:this,sourceTarget:e&&e.sourceTarget||this});if(this._events){var d=this._events[t];if(d){this._firingCount=this._firingCount+1||1;for(var g=0,w=d.length;g<w;g++){var b=d[g],E=b.fn;b.once&&this.off(t,E,b.ctx),E.call(b.ctx||this,c)}this._firingCount--}}return s&&this._propagateEvent(c),this},listens:function(t,e,s,c){typeof t!="string"&&console.warn('"string" type argument expected');var d=e;typeof e!="function"&&(c=!!e,d=void 0,s=void 0);var g=this._events&&this._events[t];if(g&&g.length&&this._listens(t,d,s)!==!1)return!0;if(c){for(var w in this._eventParents)if(this._eventParents[w].listens(t,e,s,c))return!0}return!1},_listens:function(t,e,s){if(!this._events)return!1;var c=this._events[t]||[];if(!e)return!!c.length;s===this&&(s=void 0);for(var d=0,g=c.length;d<g;d++)if(c[d].fn===e&&c[d].ctx===s)return d;return!1},once:function(t,e,s){if(typeof t=="object")for(var c in t)this._on(c,t[c],e,!0);else{t=v(t);for(var d=0,g=t.length;d<g;d++)this._on(t[d],e,s,!0)}return this},addEventParent:function(t){return this._eventParents=this._eventParents||{},this._eventParents[u(t)]=t,this},removeEventParent:function(t){return this._eventParents&&delete this._eventParents[u(t)],this},_propagateEvent:function(t){for(var e in this._eventParents)this._eventParents[e].fire(t.type,n({layer:t.target,propagatedFrom:t.target},t),!0)}};_t.addEventListener=_t.on,_t.removeEventListener=_t.clearAllEventListeners=_t.off,_t.addOneTimeEventListener=_t.once,_t.fireEvent=_t.fire,_t.hasEventListeners=_t.listens;var ye=Bt.extend(_t);function F(t,e,s){this.x=s?Math.round(t):t,this.y=s?Math.round(e):e}var li=Math.trunc||function(t){return t>0?Math.floor(t):Math.ceil(t)};F.prototype={clone:function(){return new F(this.x,this.y)},add:function(t){return this.clone()._add($(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract($(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},scaleBy:function(t){return new F(this.x*t.x,this.y*t.y)},unscaleBy:function(t){return new F(this.x/t.x,this.y/t.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=li(this.x),this.y=li(this.y),this},distanceTo:function(t){t=$(t);var e=t.x-this.x,s=t.y-this.y;return Math.sqrt(e*e+s*s)},equals:function(t){return t=$(t),t.x===this.x&&t.y===this.y},contains:function(t){return t=$(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+l(this.x)+", "+l(this.y)+")"}};function $(t,e,s){return t instanceof F?t:k(t)?new F(t[0],t[1]):t==null?t:typeof t=="object"&&"x"in t&&"y"in t?new F(t.x,t.y):new F(t,e,s)}function it(t,e){if(t)for(var s=e?[t,e]:t,c=0,d=s.length;c<d;c++)this.extend(s[c])}it.prototype={extend:function(t){var e,s;if(!t)return this;if(t instanceof F||typeof t[0]=="number"||"x"in t)e=s=$(t);else if(t=vt(t),e=t.min,s=t.max,!e||!s)return this;return!this.min&&!this.max?(this.min=e.clone(),this.max=s.clone()):(this.min.x=Math.min(e.x,this.min.x),this.max.x=Math.max(s.x,this.max.x),this.min.y=Math.min(e.y,this.min.y),this.max.y=Math.max(s.y,this.max.y)),this},getCenter:function(t){return $((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return $(this.min.x,this.max.y)},getTopRight:function(){return $(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,s;return typeof t[0]=="number"||t instanceof F?t=$(t):t=vt(t),t instanceof it?(e=t.min,s=t.max):e=s=t,e.x>=this.min.x&&s.x<=this.max.x&&e.y>=this.min.y&&s.y<=this.max.y},intersects:function(t){t=vt(t);var e=this.min,s=this.max,c=t.min,d=t.max,g=d.x>=e.x&&c.x<=s.x,w=d.y>=e.y&&c.y<=s.y;return g&&w},overlaps:function(t){t=vt(t);var e=this.min,s=this.max,c=t.min,d=t.max,g=d.x>e.x&&c.x<s.x,w=d.y>e.y&&c.y<s.y;return g&&w},isValid:function(){return!!(this.min&&this.max)},pad:function(t){var e=this.min,s=this.max,c=Math.abs(e.x-s.x)*t,d=Math.abs(e.y-s.y)*t;return vt($(e.x-c,e.y-d),$(s.x+c,s.y+d))},equals:function(t){return t?(t=vt(t),this.min.equals(t.getTopLeft())&&this.max.equals(t.getBottomRight())):!1}};function vt(t,e){return!t||t instanceof it?t:new it(t,e)}function It(t,e){if(t)for(var s=e?[t,e]:t,c=0,d=s.length;c<d;c++)this.extend(s[c])}It.prototype={extend:function(t){var e=this._southWest,s=this._northEast,c,d;if(t instanceof tt)c=t,d=t;else if(t instanceof It){if(c=t._southWest,d=t._northEast,!c||!d)return this}else return t?this.extend(H(t)||ht(t)):this;return!e&&!s?(this._southWest=new tt(c.lat,c.lng),this._northEast=new tt(d.lat,d.lng)):(e.lat=Math.min(c.lat,e.lat),e.lng=Math.min(c.lng,e.lng),s.lat=Math.max(d.lat,s.lat),s.lng=Math.max(d.lng,s.lng)),this},pad:function(t){var e=this._southWest,s=this._northEast,c=Math.abs(e.lat-s.lat)*t,d=Math.abs(e.lng-s.lng)*t;return new It(new tt(e.lat-c,e.lng-d),new tt(s.lat+c,s.lng+d))},getCenter:function(){return new tt((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new tt(this.getNorth(),this.getWest())},getSouthEast:function(){return new tt(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){typeof t[0]=="number"||t instanceof tt||"lat"in t?t=H(t):t=ht(t);var e=this._southWest,s=this._northEast,c,d;return t instanceof It?(c=t.getSouthWest(),d=t.getNorthEast()):c=d=t,c.lat>=e.lat&&d.lat<=s.lat&&c.lng>=e.lng&&d.lng<=s.lng},intersects:function(t){t=ht(t);var e=this._southWest,s=this._northEast,c=t.getSouthWest(),d=t.getNorthEast(),g=d.lat>=e.lat&&c.lat<=s.lat,w=d.lng>=e.lng&&c.lng<=s.lng;return g&&w},overlaps:function(t){t=ht(t);var e=this._southWest,s=this._northEast,c=t.getSouthWest(),d=t.getNorthEast(),g=d.lat>e.lat&&c.lat<s.lat,w=d.lng>e.lng&&c.lng<s.lng;return g&&w},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t,e){return t?(t=ht(t),this._southWest.equals(t.getSouthWest(),e)&&this._northEast.equals(t.getNorthEast(),e)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function ht(t,e){return t instanceof It?t:new It(t,e)}function tt(t,e,s){if(isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=+t,this.lng=+e,s!==void 0&&(this.alt=+s)}tt.prototype={equals:function(t,e){if(!t)return!1;t=H(t);var s=Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng));return s<=(e===void 0?1e-9:e)},toString:function(t){return"LatLng("+l(this.lat,t)+", "+l(this.lng,t)+")"},distanceTo:function(t){return ce.distance(this,H(t))},wrap:function(){return ce.wrapLatLng(this)},toBounds:function(t){var e=180*t/40075017,s=e/Math.cos(Math.PI/180*this.lat);return ht([this.lat-e,this.lng-s],[this.lat+e,this.lng+s])},clone:function(){return new tt(this.lat,this.lng,this.alt)}};function H(t,e,s){return t instanceof tt?t:k(t)&&typeof t[0]!="object"?t.length===3?new tt(t[0],t[1],t[2]):t.length===2?new tt(t[0],t[1]):null:t==null?t:typeof t=="object"&&"lat"in t?new tt(t.lat,"lng"in t?t.lng:t.lon,t.alt):e===void 0?null:new tt(t,e,s)}var ie={latLngToPoint:function(t,e){var s=this.projection.project(t),c=this.scale(e);return this.transformation._transform(s,c)},pointToLatLng:function(t,e){var s=this.scale(e),c=this.transformation.untransform(t,s);return this.projection.unproject(c)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},scale:function(t){return 256*Math.pow(2,t)},zoom:function(t){return Math.log(t/256)/Math.LN2},getProjectedBounds:function(t){if(this.infinite)return null;var e=this.projection.bounds,s=this.scale(t),c=this.transformation.transform(e.min,s),d=this.transformation.transform(e.max,s);return new it(c,d)},infinite:!1,wrapLatLng:function(t){var e=this.wrapLng?_(t.lng,this.wrapLng,!0):t.lng,s=this.wrapLat?_(t.lat,this.wrapLat,!0):t.lat,c=t.alt;return new tt(s,e,c)},wrapLatLngBounds:function(t){var e=t.getCenter(),s=this.wrapLatLng(e),c=e.lat-s.lat,d=e.lng-s.lng;if(c===0&&d===0)return t;var g=t.getSouthWest(),w=t.getNorthEast(),b=new tt(g.lat-c,g.lng-d),E=new tt(w.lat-c,w.lng-d);return new It(b,E)}},ce=n({},ie,{wrapLng:[-180,180],R:6371e3,distance:function(t,e){var s=Math.PI/180,c=t.lat*s,d=e.lat*s,g=Math.sin((e.lat-t.lat)*s/2),w=Math.sin((e.lng-t.lng)*s/2),b=g*g+Math.cos(c)*Math.cos(d)*w*w,E=2*Math.atan2(Math.sqrt(b),Math.sqrt(1-b));return this.R*E}}),yo=6378137,tr={R:yo,MAX_LATITUDE:85.0511287798,project:function(t){var e=Math.PI/180,s=this.MAX_LATITUDE,c=Math.max(Math.min(s,t.lat),-s),d=Math.sin(c*e);return new F(this.R*t.lng*e,this.R*Math.log((1+d)/(1-d))/2)},unproject:function(t){var e=180/Math.PI;return new tt((2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*e,t.x*e/this.R)},bounds:function(){var t=yo*Math.PI;return new it([-t,-t],[t,t])}()};function er(t,e,s,c){if(k(t)){this._a=t[0],this._b=t[1],this._c=t[2],this._d=t[3];return}this._a=t,this._b=e,this._c=s,this._d=c}er.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new F((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}};function hi(t,e,s,c){return new er(t,e,s,c)}var ir=n({},ce,{code:"EPSG:3857",projection:tr,transformation:function(){var t=.5/(Math.PI*tr.R);return hi(t,.5,-t,.5)}()}),kc=n({},ir,{code:"EPSG:900913"});function wo(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function bo(t,e){var s="",c,d,g,w,b,E;for(c=0,g=t.length;c<g;c++){for(b=t[c],d=0,w=b.length;d<w;d++)E=b[d],s+=(d?"L":"M")+E.x+" "+E.y;s+=e?A.svg?"z":"x":""}return s||"M0 0"}var nr=document.documentElement.style,qi="ActiveXObject"in window,Pc=qi&&!document.addEventListener,xo="msLaunchUri"in navigator&&!("documentMode"in document),rr=Kt("webkit"),Lo=Kt("android"),Eo=Kt("android 2")||Kt("android 3"),Tc=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Ic=Lo&&Kt("Google")&&Tc<537&&!("AudioNode"in window),or=!!window.opera,Mo=!xo&&Kt("chrome"),Co=Kt("gecko")&&!rr&&!or&&!qi,Oc=!Mo&&Kt("safari"),So=Kt("phantom"),ko="OTransition"in nr,Ac=navigator.platform.indexOf("Win")===0,Po=qi&&"transition"in nr,sr="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Eo,To="MozPerspective"in nr,Dc=!window.L_DISABLE_3D&&(Po||sr||To)&&!ko&&!So,ci=typeof orientation<"u"||Kt("mobile"),zc=ci&&rr,Rc=ci&&sr,Io=!window.PointerEvent&&window.MSPointerEvent,Oo=!!(window.PointerEvent||Io),Ao="ontouchstart"in window||!!window.TouchEvent,Nc=!window.L_NO_TOUCH&&(Ao||Oo),Bc=ci&&or,Zc=ci&&Co,Fc=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,$c=function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("testPassiveEventSupport",p,e),window.removeEventListener("testPassiveEventSupport",p,e)}catch{}return t}(),Gc=function(){return!!document.createElement("canvas").getContext}(),ar=!!(document.createElementNS&&wo("svg").createSVGRect),Vc=!!ar&&function(){var t=document.createElement("div");return t.innerHTML="<svg/>",(t.firstChild&&t.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),jc=!ar&&function(){try{var t=document.createElement("div");t.innerHTML='<v:shape adj="1"/>';var e=t.firstChild;return e.style.behavior="url(#default#VML)",e&&typeof e.adj=="object"}catch{return!1}}(),Uc=navigator.platform.indexOf("Mac")===0,Hc=navigator.platform.indexOf("Linux")===0;function Kt(t){return navigator.userAgent.toLowerCase().indexOf(t)>=0}var A={ie:qi,ielt9:Pc,edge:xo,webkit:rr,android:Lo,android23:Eo,androidStock:Ic,opera:or,chrome:Mo,gecko:Co,safari:Oc,phantom:So,opera12:ko,win:Ac,ie3d:Po,webkit3d:sr,gecko3d:To,any3d:Dc,mobile:ci,mobileWebkit:zc,mobileWebkit3d:Rc,msPointer:Io,pointer:Oo,touch:Nc,touchNative:Ao,mobileOpera:Bc,mobileGecko:Zc,retina:Fc,passiveEvents:$c,canvas:Gc,svg:ar,vml:jc,inlineSvg:Vc,mac:Uc,linux:Hc},Do=A.msPointer?"MSPointerDown":"pointerdown",zo=A.msPointer?"MSPointerMove":"pointermove",Ro=A.msPointer?"MSPointerUp":"pointerup",No=A.msPointer?"MSPointerCancel":"pointercancel",lr={touchstart:Do,touchmove:zo,touchend:Ro,touchcancel:No},Bo={touchstart:Qc,touchmove:Xi,touchend:Xi,touchcancel:Xi},Ge={},Zo=!1;function Wc(t,e,s){return e==="touchstart"&&Kc(),Bo[e]?(s=Bo[e].bind(this,s),t.addEventListener(lr[e],s,!1),s):(console.warn("wrong event specified:",e),p)}function qc(t,e,s){if(!lr[e]){console.warn("wrong event specified:",e);return}t.removeEventListener(lr[e],s,!1)}function Xc(t){Ge[t.pointerId]=t}function Yc(t){Ge[t.pointerId]&&(Ge[t.pointerId]=t)}function Fo(t){delete Ge[t.pointerId]}function Kc(){Zo||(document.addEventListener(Do,Xc,!0),document.addEventListener(zo,Yc,!0),document.addEventListener(Ro,Fo,!0),document.addEventListener(No,Fo,!0),Zo=!0)}function Xi(t,e){if(e.pointerType!==(e.MSPOINTER_TYPE_MOUSE||"mouse")){e.touches=[];for(var s in Ge)e.touches.push(Ge[s]);e.changedTouches=[e],t(e)}}function Qc(t,e){e.MSPOINTER_TYPE_TOUCH&&e.pointerType===e.MSPOINTER_TYPE_TOUCH&&Lt(e),Xi(t,e)}function Jc(t){var e={},s,c;for(c in t)s=t[c],e[c]=s&&s.bind?s.bind(t):s;return t=e,e.type="dblclick",e.detail=2,e.isTrusted=!1,e._simulated=!0,e}var tu=200;function eu(t,e){t.addEventListener("dblclick",e);var s=0,c;function d(g){if(g.detail!==1){c=g.detail;return}if(!(g.pointerType==="mouse"||g.sourceCapabilities&&!g.sourceCapabilities.firesTouchEvents)){var w=Uo(g);if(!(w.some(function(E){return E instanceof HTMLLabelElement&&E.attributes.for})&&!w.some(function(E){return E instanceof HTMLInputElement||E instanceof HTMLSelectElement}))){var b=Date.now();b-s<=tu?(c++,c===2&&e(Jc(g))):c=1,s=b}}}return t.addEventListener("click",d),{dblclick:e,simDblclick:d}}function iu(t,e){t.removeEventListener("dblclick",e.dblclick),t.removeEventListener("click",e.simDblclick)}var hr=Qi(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),ui=Qi(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),$o=ui==="webkitTransition"||ui==="OTransition"?ui+"End":"transitionend";function Go(t){return typeof t=="string"?document.getElementById(t):t}function di(t,e){var s=t.style[e]||t.currentStyle&&t.currentStyle[e];if((!s||s==="auto")&&document.defaultView){var c=document.defaultView.getComputedStyle(t,null);s=c?c[e]:null}return s==="auto"?null:s}function Y(t,e,s){var c=document.createElement(t);return c.className=e||"",s&&s.appendChild(c),c}function st(t){var e=t.parentNode;e&&e.removeChild(t)}function Yi(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function Ve(t){var e=t.parentNode;e&&e.lastChild!==t&&e.appendChild(t)}function je(t){var e=t.parentNode;e&&e.firstChild!==t&&e.insertBefore(t,e.firstChild)}function cr(t,e){if(t.classList!==void 0)return t.classList.contains(e);var s=Ki(t);return s.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(s)}function V(t,e){if(t.classList!==void 0)for(var s=v(e),c=0,d=s.length;c<d;c++)t.classList.add(s[c]);else if(!cr(t,e)){var g=Ki(t);ur(t,(g?g+" ":"")+e)}}function lt(t,e){t.classList!==void 0?t.classList.remove(e):ur(t,m((" "+Ki(t)+" ").replace(" "+e+" "," ")))}function ur(t,e){t.className.baseVal===void 0?t.className=e:t.className.baseVal=e}function Ki(t){return t.correspondingElement&&(t=t.correspondingElement),t.className.baseVal===void 0?t.className:t.className.baseVal}function Zt(t,e){"opacity"in t.style?t.style.opacity=e:"filter"in t.style&&nu(t,e)}function nu(t,e){var s=!1,c="DXImageTransform.Microsoft.Alpha";try{s=t.filters.item(c)}catch{if(e===1)return}e=Math.round(e*100),s?(s.Enabled=e!==100,s.Opacity=e):t.style.filter+=" progid:"+c+"(opacity="+e+")"}function Qi(t){for(var e=document.documentElement.style,s=0;s<t.length;s++)if(t[s]in e)return t[s];return!1}function we(t,e,s){var c=e||new F(0,0);t.style[hr]=(A.ie3d?"translate("+c.x+"px,"+c.y+"px)":"translate3d("+c.x+"px,"+c.y+"px,0)")+(s?" scale("+s+")":"")}function ct(t,e){t._leaflet_pos=e,A.any3d?we(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px")}function be(t){return t._leaflet_pos||new F(0,0)}var fi,mi,dr;if("onselectstart"in document)fi=function(){G(window,"selectstart",Lt)},mi=function(){nt(window,"selectstart",Lt)};else{var pi=Qi(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);fi=function(){if(pi){var t=document.documentElement.style;dr=t[pi],t[pi]="none"}},mi=function(){pi&&(document.documentElement.style[pi]=dr,dr=void 0)}}function fr(){G(window,"dragstart",Lt)}function mr(){nt(window,"dragstart",Lt)}var Ji,pr;function gr(t){for(;t.tabIndex===-1;)t=t.parentNode;t.style&&(tn(),Ji=t,pr=t.style.outlineStyle,t.style.outlineStyle="none",G(window,"keydown",tn))}function tn(){Ji&&(Ji.style.outlineStyle=pr,Ji=void 0,pr=void 0,nt(window,"keydown",tn))}function Vo(t){do t=t.parentNode;while((!t.offsetWidth||!t.offsetHeight)&&t!==document.body);return t}function _r(t){var e=t.getBoundingClientRect();return{x:e.width/t.offsetWidth||1,y:e.height/t.offsetHeight||1,boundingClientRect:e}}var ru={__proto__:null,TRANSFORM:hr,TRANSITION:ui,TRANSITION_END:$o,get:Go,getStyle:di,create:Y,remove:st,empty:Yi,toFront:Ve,toBack:je,hasClass:cr,addClass:V,removeClass:lt,setClass:ur,getClass:Ki,setOpacity:Zt,testProp:Qi,setTransform:we,setPosition:ct,getPosition:be,get disableTextSelection(){return fi},get enableTextSelection(){return mi},disableImageDrag:fr,enableImageDrag:mr,preventOutline:gr,restoreOutline:tn,getSizedParentNode:Vo,getScale:_r};function G(t,e,s,c){if(e&&typeof e=="object")for(var d in e)yr(t,d,e[d],s);else{e=v(e);for(var g=0,w=e.length;g<w;g++)yr(t,e[g],s,c)}return this}var Qt="_leaflet_events";function nt(t,e,s,c){if(arguments.length===1)jo(t),delete t[Qt];else if(e&&typeof e=="object")for(var d in e)wr(t,d,e[d],s);else if(e=v(e),arguments.length===2)jo(t,function(b){return T(e,b)!==-1});else for(var g=0,w=e.length;g<w;g++)wr(t,e[g],s,c);return this}function jo(t,e){for(var s in t[Qt]){var c=s.split(/\d/)[0];(!e||e(c))&&wr(t,c,null,null,s)}}var vr={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function yr(t,e,s,c){var d=e+u(s)+(c?"_"+u(c):"");if(t[Qt]&&t[Qt][d])return this;var g=function(b){return s.call(c||t,b||window.event)},w=g;!A.touchNative&&A.pointer&&e.indexOf("touch")===0?g=Wc(t,e,g):A.touch&&e==="dblclick"?g=eu(t,g):"addEventListener"in t?e==="touchstart"||e==="touchmove"||e==="wheel"||e==="mousewheel"?t.addEventListener(vr[e]||e,g,A.passiveEvents?{passive:!1}:!1):e==="mouseenter"||e==="mouseleave"?(g=function(b){b=b||window.event,xr(t,b)&&w(b)},t.addEventListener(vr[e],g,!1)):t.addEventListener(e,w,!1):t.attachEvent("on"+e,g),t[Qt]=t[Qt]||{},t[Qt][d]=g}function wr(t,e,s,c,d){d=d||e+u(s)+(c?"_"+u(c):"");var g=t[Qt]&&t[Qt][d];if(!g)return this;!A.touchNative&&A.pointer&&e.indexOf("touch")===0?qc(t,e,g):A.touch&&e==="dblclick"?iu(t,g):"removeEventListener"in t?t.removeEventListener(vr[e]||e,g,!1):t.detachEvent("on"+e,g),t[Qt][d]=null}function xe(t){return t.stopPropagation?t.stopPropagation():t.originalEvent?t.originalEvent._stopped=!0:t.cancelBubble=!0,this}function br(t){return yr(t,"wheel",xe),this}function gi(t){return G(t,"mousedown touchstart dblclick contextmenu",xe),t._leaflet_disable_click=!0,this}function Lt(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function Le(t){return Lt(t),xe(t),this}function Uo(t){if(t.composedPath)return t.composedPath();for(var e=[],s=t.target;s;)e.push(s),s=s.parentNode;return e}function Ho(t,e){if(!e)return new F(t.clientX,t.clientY);var s=_r(e),c=s.boundingClientRect;return new F((t.clientX-c.left)/s.x-e.clientLeft,(t.clientY-c.top)/s.y-e.clientTop)}var ou=A.linux&&A.chrome?window.devicePixelRatio:A.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Wo(t){return A.edge?t.wheelDeltaY/2:t.deltaY&&t.deltaMode===0?-t.deltaY/ou:t.deltaY&&t.deltaMode===1?-t.deltaY*20:t.deltaY&&t.deltaMode===2?-t.deltaY*60:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?-t.detail*20:t.detail?t.detail/-32765*60:0}function xr(t,e){var s=e.relatedTarget;if(!s)return!0;try{for(;s&&s!==t;)s=s.parentNode}catch{return!1}return s!==t}var su={__proto__:null,on:G,off:nt,stopPropagation:xe,disableScrollPropagation:br,disableClickPropagation:gi,preventDefault:Lt,stop:Le,getPropagationPath:Uo,getMousePosition:Ho,getWheelDelta:Wo,isExternalTarget:xr,addListener:G,removeListener:nt},qo=ye.extend({run:function(t,e,s,c){this.stop(),this._el=t,this._inProgress=!0,this._duration=s||.25,this._easeOutPower=1/Math.max(c||.5,.2),this._startPos=be(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=Q(this._animate,this),this._step()},_step:function(t){var e=+new Date-this._startTime,s=this._duration*1e3;e<s?this._runFrame(this._easeOut(e/s),t):(this._runFrame(1),this._complete())},_runFrame:function(t,e){var s=this._startPos.add(this._offset.multiplyBy(t));e&&s._round(),ct(this._el,s),this.fire("step")},_complete:function(){ot(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),W=ye.extend({options:{crs:ir,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(t,e){e=y(this,e),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(t),this._initLayout(),this._onResize=o(this._onResize,this),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),e.zoom!==void 0&&(this._zoom=this._limitZoom(e.zoom)),e.center&&e.zoom!==void 0&&this.setView(H(e.center),e.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=ui&&A.any3d&&!A.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),G(this._proxy,$o,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(t,e,s){if(e=e===void 0?this._zoom:this._limitZoom(e),t=this._limitCenter(H(t),e,this.options.maxBounds),s=s||{},this._stop(),this._loaded&&!s.reset&&s!==!0){s.animate!==void 0&&(s.zoom=n({animate:s.animate},s.zoom),s.pan=n({animate:s.animate,duration:s.duration},s.pan));var c=this._zoom!==e?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,e,s.zoom):this._tryAnimatedPan(t,s.pan);if(c)return clearTimeout(this._sizeTimer),this}return this._resetView(t,e,s.pan&&s.pan.noMoveStart),this},setZoom:function(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=t,this)},zoomIn:function(t,e){return t=t||(A.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+t,e)},zoomOut:function(t,e){return t=t||(A.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-t,e)},setZoomAround:function(t,e,s){var c=this.getZoomScale(e),d=this.getSize().divideBy(2),g=t instanceof F?t:this.latLngToContainerPoint(t),w=g.subtract(d).multiplyBy(1-1/c),b=this.containerPointToLatLng(d.add(w));return this.setView(b,e,{zoom:s})},_getBoundsCenterZoom:function(t,e){e=e||{},t=t.getBounds?t.getBounds():ht(t);var s=$(e.paddingTopLeft||e.padding||[0,0]),c=$(e.paddingBottomRight||e.padding||[0,0]),d=this.getBoundsZoom(t,!1,s.add(c));if(d=typeof e.maxZoom=="number"?Math.min(e.maxZoom,d):d,d===1/0)return{center:t.getCenter(),zoom:d};var g=c.subtract(s).divideBy(2),w=this.project(t.getSouthWest(),d),b=this.project(t.getNorthEast(),d),E=this.unproject(w.add(b).divideBy(2).add(g),d);return{center:E,zoom:d}},fitBounds:function(t,e){if(t=ht(t),!t.isValid())throw new Error("Bounds are not valid.");var s=this._getBoundsCenterZoom(t,e);return this.setView(s.center,s.zoom,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t,e){if(t=$(t).round(),e=e||{},!t.x&&!t.y)return this.fire("moveend");if(e.animate!==!0&&!this.getSize().contains(t))return this._resetView(this.unproject(this.project(this.getCenter()).add(t)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new qo,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),e.animate!==!1){V(this._mapPane,"leaflet-pan-anim");var s=this._getMapPanePos().subtract(t).round();this._panAnim.run(this._mapPane,s,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},flyTo:function(t,e,s){if(s=s||{},s.animate===!1||!A.any3d)return this.setView(t,e,s);this._stop();var c=this.project(this.getCenter()),d=this.project(t),g=this.getSize(),w=this._zoom;t=H(t),e=e===void 0?w:e;var b=Math.max(g.x,g.y),E=b*this.getZoomScale(w,e),P=d.distanceTo(c)||1,I=1.42,B=I*I;function j(ut){var fn=ut?-1:1,qu=ut?E:b,Xu=E*E-b*b+fn*B*B*P*P,Yu=2*qu*B*P,Ar=Xu/Yu,ks=Math.sqrt(Ar*Ar+1)-Ar,Ku=ks<1e-9?-18:Math.log(ks);return Ku}function kt(ut){return(Math.exp(ut)-Math.exp(-ut))/2}function yt(ut){return(Math.exp(ut)+Math.exp(-ut))/2}function $t(ut){return kt(ut)/yt(ut)}var Ot=j(0);function Ye(ut){return b*(yt(Ot)/yt(Ot+I*ut))}function ju(ut){return b*(yt(Ot)*$t(Ot+I*ut)-kt(Ot))/B}function Uu(ut){return 1-Math.pow(1-ut,1.5)}var Hu=Date.now(),Cs=(j(1)-Ot)/I,Wu=s.duration?1e3*s.duration:1e3*Cs*.8;function Ss(){var ut=(Date.now()-Hu)/Wu,fn=Uu(ut)*Cs;ut<=1?(this._flyToFrame=Q(Ss,this),this._move(this.unproject(c.add(d.subtract(c).multiplyBy(ju(fn)/P)),w),this.getScaleZoom(b/Ye(fn),w),{flyTo:!0})):this._move(t,e)._moveEnd(!0)}return this._moveStart(!0,s.noMoveStart),Ss.call(this),this},flyToBounds:function(t,e){var s=this._getBoundsCenterZoom(t,e);return this.flyTo(s.center,s.zoom,e)},setMaxBounds:function(t){return t=ht(t),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),t.isValid()?(this.options.maxBounds=t,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(t){var e=this.options.minZoom;return this.options.minZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(t):this},setMaxZoom:function(t){var e=this.options.maxZoom;return this.options.maxZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(t):this},panInsideBounds:function(t,e){this._enforcingBounds=!0;var s=this.getCenter(),c=this._limitCenter(s,this._zoom,ht(t));return s.equals(c)||this.panTo(c,e),this._enforcingBounds=!1,this},panInside:function(t,e){e=e||{};var s=$(e.paddingTopLeft||e.padding||[0,0]),c=$(e.paddingBottomRight||e.padding||[0,0]),d=this.project(this.getCenter()),g=this.project(t),w=this.getPixelBounds(),b=vt([w.min.add(s),w.max.subtract(c)]),E=b.getSize();if(!b.contains(g)){this._enforcingBounds=!0;var P=g.subtract(b.getCenter()),I=b.extend(g).getSize().subtract(E);d.x+=P.x<0?-I.x:I.x,d.y+=P.y<0?-I.y:I.y,this.panTo(this.unproject(d),e),this._enforcingBounds=!1}return this},invalidateSize:function(t){if(!this._loaded)return this;t=n({animate:!1,pan:!0},t===!0?{animate:!0}:t);var e=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var s=this.getSize(),c=e.divideBy(2).round(),d=s.divideBy(2).round(),g=c.subtract(d);return!g.x&&!g.y?this:(t.animate&&t.pan?this.panBy(g):(t.pan&&this._rawPanBy(g),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(o(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:e,newSize:s}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(t){if(t=this._locateOptions=n({timeout:1e4,watch:!1},t),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var e=o(this._handleGeolocationResponse,this),s=o(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(e,s,t):navigator.geolocation.getCurrentPosition(e,s,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){if(this._container._leaflet_id){var e=t.code,s=t.message||(e===1?"permission denied":e===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+s+"."})}},_handleGeolocationResponse:function(t){if(this._container._leaflet_id){var e=t.coords.latitude,s=t.coords.longitude,c=new tt(e,s),d=c.toBounds(t.coords.accuracy*2),g=this._locateOptions;if(g.setView){var w=this.getBoundsZoom(d);this.setView(c,g.maxZoom?Math.min(w,g.maxZoom):w)}var b={latlng:c,bounds:d,timestamp:t.timestamp};for(var E in t.coords)typeof t.coords[E]=="number"&&(b[E]=t.coords[E]);this.fire("locationfound",b)}},addHandler:function(t,e){if(!e)return this;var s=this[t]=new e(this);return this._handlers.push(s),this.options[t]&&s.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),st(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(ot(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var t;for(t in this._layers)this._layers[t].remove();for(t in this._panes)st(this._panes[t]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(t,e){var s="leaflet-pane"+(t?" leaflet-"+t.replace("Pane","")+"-pane":""),c=Y("div",s,e||this._mapPane);return t&&(this._panes[t]=c),c},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds(),e=this.unproject(t.getBottomLeft()),s=this.unproject(t.getTopRight());return new It(e,s)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,e,s){t=ht(t),s=$(s||[0,0]);var c=this.getZoom()||0,d=this.getMinZoom(),g=this.getMaxZoom(),w=t.getNorthWest(),b=t.getSouthEast(),E=this.getSize().subtract(s),P=vt(this.project(b,c),this.project(w,c)).getSize(),I=A.any3d?this.options.zoomSnap:1,B=E.x/P.x,j=E.y/P.y,kt=e?Math.max(B,j):Math.min(B,j);return c=this.getScaleZoom(kt,c),I&&(c=Math.round(c/(I/100))*(I/100),c=e?Math.ceil(c/I)*I:Math.floor(c/I)*I),Math.max(d,Math.min(g,c))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new F(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(t,e){var s=this._getTopLeftPoint(t,e);return new it(s,s.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(t){return this.options.crs.getProjectedBounds(t===void 0?this.getZoom():t)},getPane:function(t){return typeof t=="string"?this._panes[t]:t},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t,e){var s=this.options.crs;return e=e===void 0?this._zoom:e,s.scale(t)/s.scale(e)},getScaleZoom:function(t,e){var s=this.options.crs;e=e===void 0?this._zoom:e;var c=s.zoom(t*s.scale(e));return isNaN(c)?1/0:c},project:function(t,e){return e=e===void 0?this._zoom:e,this.options.crs.latLngToPoint(H(t),e)},unproject:function(t,e){return e=e===void 0?this._zoom:e,this.options.crs.pointToLatLng($(t),e)},layerPointToLatLng:function(t){var e=$(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){var e=this.project(H(t))._round();return e._subtract(this.getPixelOrigin())},wrapLatLng:function(t){return this.options.crs.wrapLatLng(H(t))},wrapLatLngBounds:function(t){return this.options.crs.wrapLatLngBounds(ht(t))},distance:function(t,e){return this.options.crs.distance(H(t),H(e))},containerPointToLayerPoint:function(t){return $(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return $(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint($(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(H(t)))},mouseEventToContainerPoint:function(t){return Ho(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=Go(t);if(e){if(e._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");G(e,"scroll",this._onScroll,this),this._containerId=u(e)},_initLayout:function(){var t=this._container;this._fadeAnimated=this.options.fadeAnimation&&A.any3d,V(t,"leaflet-container"+(A.touch?" leaflet-touch":"")+(A.retina?" leaflet-retina":"")+(A.ielt9?" leaflet-oldie":"")+(A.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var e=di(t,"position");e!=="absolute"&&e!=="relative"&&e!=="fixed"&&e!=="sticky"&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),ct(this._mapPane,new F(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(V(t.markerPane,"leaflet-zoom-hide"),V(t.shadowPane,"leaflet-zoom-hide"))},_resetView:function(t,e,s){ct(this._mapPane,new F(0,0));var c=!this._loaded;this._loaded=!0,e=this._limitZoom(e),this.fire("viewprereset");var d=this._zoom!==e;this._moveStart(d,s)._move(t,e)._moveEnd(d),this.fire("viewreset"),c&&this.fire("load")},_moveStart:function(t,e){return t&&this.fire("zoomstart"),e||this.fire("movestart"),this},_move:function(t,e,s,c){e===void 0&&(e=this._zoom);var d=this._zoom!==e;return this._zoom=e,this._lastCenter=t,this._pixelOrigin=this._getNewPixelOrigin(t),c?s&&s.pinch&&this.fire("zoom",s):((d||s&&s.pinch)&&this.fire("zoom",s),this.fire("move",s)),this},_moveEnd:function(t){return t&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return ot(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(t){ct(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(t){this._targets={},this._targets[u(this._container)]=this;var e=t?nt:G;e(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&e(window,"resize",this._onResize,this),A.any3d&&this.options.transform3DLimit&&(t?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){ot(this._resizeRequest),this._resizeRequest=Q(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var t=this._getMapPanePos();Math.max(Math.abs(t.x),Math.abs(t.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(t,e){for(var s=[],c,d=e==="mouseout"||e==="mouseover",g=t.target||t.srcElement,w=!1;g;){if(c=this._targets[u(g)],c&&(e==="click"||e==="preclick")&&this._draggableMoved(c)){w=!0;break}if(c&&c.listens(e,!0)&&(d&&!xr(g,t)||(s.push(c),d))||g===this._container)break;g=g.parentNode}return!s.length&&!w&&!d&&this.listens(e,!0)&&(s=[this]),s},_isClickDisabled:function(t){for(;t&&t!==this._container;){if(t._leaflet_disable_click)return!0;t=t.parentNode}},_handleDOMEvent:function(t){var e=t.target||t.srcElement;if(!(!this._loaded||e._leaflet_disable_events||t.type==="click"&&this._isClickDisabled(e))){var s=t.type;s==="mousedown"&&gr(e),this._fireDOMEvent(t,s)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(t,e,s){if(t.type==="click"){var c=n({},t);c.type="preclick",this._fireDOMEvent(c,c.type,s)}var d=this._findEventTargets(t,e);if(s){for(var g=[],w=0;w<s.length;w++)s[w].listens(e,!0)&&g.push(s[w]);d=g.concat(d)}if(d.length){e==="contextmenu"&&Lt(t);var b=d[0],E={originalEvent:t};if(t.type!=="keypress"&&t.type!=="keydown"&&t.type!=="keyup"){var P=b.getLatLng&&(!b._radius||b._radius<=10);E.containerPoint=P?this.latLngToContainerPoint(b.getLatLng()):this.mouseEventToContainerPoint(t),E.layerPoint=this.containerPointToLayerPoint(E.containerPoint),E.latlng=P?b.getLatLng():this.layerPointToLatLng(E.layerPoint)}for(w=0;w<d.length;w++)if(d[w].fire(e,E,!0),E.originalEvent._stopped||d[w].options.bubblingMouseEvents===!1&&T(this._mouseEvents,e)!==-1)return}},_draggableMoved:function(t){return t=t.dragging&&t.dragging.enabled()?t:this,t.dragging&&t.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,{target:this}):this.on("load",t,e),this},_getMapPanePos:function(){return be(this._mapPane)||new F(0,0)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(t,e){var s=t&&e!==void 0?this._getNewPixelOrigin(t,e):this.getPixelOrigin();return s.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(t,e){var s=this.getSize()._divideBy(2);return this.project(t,e)._subtract(s)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(t,e,s){var c=this._getNewPixelOrigin(s,e);return this.project(t,e)._subtract(c)},_latLngBoundsToNewLayerBounds:function(t,e,s){var c=this._getNewPixelOrigin(s,e);return vt([this.project(t.getSouthWest(),e)._subtract(c),this.project(t.getNorthWest(),e)._subtract(c),this.project(t.getSouthEast(),e)._subtract(c),this.project(t.getNorthEast(),e)._subtract(c)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,e,s){if(!s)return t;var c=this.project(t,e),d=this.getSize().divideBy(2),g=new it(c.subtract(d),c.add(d)),w=this._getBoundsOffset(g,s,e);return Math.abs(w.x)<=1&&Math.abs(w.y)<=1?t:this.unproject(c.add(w),e)},_limitOffset:function(t,e){if(!e)return t;var s=this.getPixelBounds(),c=new it(s.min.add(t),s.max.add(t));return t.add(this._getBoundsOffset(c,e))},_getBoundsOffset:function(t,e,s){var c=vt(this.project(e.getNorthEast(),s),this.project(e.getSouthWest(),s)),d=c.min.subtract(t.min),g=c.max.subtract(t.max),w=this._rebound(d.x,-g.x),b=this._rebound(d.y,-g.y);return new F(w,b)},_rebound:function(t,e){return t+e>0?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))},_limitZoom:function(t){var e=this.getMinZoom(),s=this.getMaxZoom(),c=A.any3d?this.options.zoomSnap:1;return c&&(t=Math.round(t/c)*c),Math.max(e,Math.min(s,t))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){lt(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){var s=this._getCenterOffset(t)._trunc();return(e&&e.animate)!==!0&&!this.getSize().contains(s)?!1:(this.panBy(s,e),!0)},_createAnimProxy:function(){var t=this._proxy=Y("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(t),this.on("zoomanim",function(e){var s=hr,c=this._proxy.style[s];we(this._proxy,this.project(e.center,e.zoom),this.getZoomScale(e.zoom,1)),c===this._proxy.style[s]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){st(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var t=this.getCenter(),e=this.getZoom();we(this._proxy,this.project(t,e),this.getZoomScale(e,1))},_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,e,s){if(this._animatingZoom)return!0;if(s=s||{},!this._zoomAnimated||s.animate===!1||this._nothingToAnimate()||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;var c=this.getZoomScale(e),d=this._getCenterOffset(t)._divideBy(1-1/c);return s.animate!==!0&&!this.getSize().contains(d)?!1:(Q(function(){this._moveStart(!0,s.noMoveStart||!1)._animateZoom(t,e,!0)},this),!0)},_animateZoom:function(t,e,s,c){this._mapPane&&(s&&(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=e,V(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:t,zoom:e,noUpdate:c}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(o(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&lt(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function au(t,e){return new W(t,e)}var Wt=Bt.extend({options:{position:"topright"},initialize:function(t){y(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this.remove(),this._map=t;var e=this._container=this.onAdd(t),s=this.getPosition(),c=t._controlCorners[s];return V(e,"leaflet-control"),s.indexOf("bottom")!==-1?c.insertBefore(e,c.firstChild):c.appendChild(e),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(st(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(t){this._map&&t&&t.screenX>0&&t.screenY>0&&this._map.getContainer().focus()}}),_i=function(t){return new Wt(t)};W.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.remove(),this},_initControlPos:function(){var t=this._controlCorners={},e="leaflet-",s=this._controlContainer=Y("div",e+"control-container",this._container);function c(d,g){var w=e+d+" "+e+g;t[d+g]=Y("div",w,s)}c("top","left"),c("top","right"),c("bottom","left"),c("bottom","right")},_clearControlPos:function(){for(var t in this._controlCorners)st(this._controlCorners[t]);st(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Xo=Wt.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(t,e,s,c){return s<c?-1:c<s?1:0}},initialize:function(t,e,s){y(this,s),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var c in t)this._addLayer(t[c],c);for(c in e)this._addLayer(e[c],c,!0)},onAdd:function(t){this._initLayout(),this._update(),this._map=t,t.on("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(t){return Wt.prototype.addTo.call(this,t),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._map?this._update():this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._map?this._update():this},removeLayer:function(t){t.off("add remove",this._onLayerChange,this);var e=this._getLayer(u(t));return e&&this._layers.splice(this._layers.indexOf(e),1),this._map?this._update():this},expand:function(){V(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var t=this._map.getSize().y-(this._container.offsetTop+50);return t<this._section.clientHeight?(V(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=t+"px"):lt(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return lt(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=Y("div",t),s=this.options.collapsed;e.setAttribute("aria-haspopup",!0),gi(e),br(e);var c=this._section=Y("section",t+"-list");s&&(this._map.on("click",this.collapse,this),G(e,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var d=this._layersLink=Y("a",t+"-toggle",e);d.href="#",d.title="Layers",d.setAttribute("role","button"),G(d,{keydown:function(g){g.keyCode===13&&this._expandSafely()},click:function(g){Lt(g),this._expandSafely()}},this),s||this.expand(),this._baseLayersList=Y("div",t+"-base",c),this._separator=Y("div",t+"-separator",c),this._overlaysList=Y("div",t+"-overlays",c),e.appendChild(c)},_getLayer:function(t){for(var e=0;e<this._layers.length;e++)if(this._layers[e]&&u(this._layers[e].layer)===t)return this._layers[e]},_addLayer:function(t,e,s){this._map&&t.on("add remove",this._onLayerChange,this),this._layers.push({layer:t,name:e,overlay:s}),this.options.sortLayers&&this._layers.sort(o(function(c,d){return this.options.sortFunction(c.layer,d.layer,c.name,d.name)},this)),this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Yi(this._baseLayersList),Yi(this._overlaysList),this._layerControlInputs=[];var t,e,s,c,d=0;for(s=0;s<this._layers.length;s++)c=this._layers[s],this._addItem(c),e=e||c.overlay,t=t||!c.overlay,d+=c.overlay?0:1;return this.options.hideSingleBase&&(t=t&&d>1,this._baseLayersList.style.display=t?"":"none"),this._separator.style.display=e&&t?"":"none",this},_onLayerChange:function(t){this._handlingClick||this._update();var e=this._getLayer(u(t.target)),s=e.overlay?t.type==="add"?"overlayadd":"overlayremove":t.type==="add"?"baselayerchange":null;s&&this._map.fire(s,e)},_createRadioElement:function(t,e){var s='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"'+(e?' checked="checked"':"")+"/>",c=document.createElement("div");return c.innerHTML=s,c.firstChild},_addItem:function(t){var e=document.createElement("label"),s=this._map.hasLayer(t.layer),c;t.overlay?(c=document.createElement("input"),c.type="checkbox",c.className="leaflet-control-layers-selector",c.defaultChecked=s):c=this._createRadioElement("leaflet-base-layers_"+u(this),s),this._layerControlInputs.push(c),c.layerId=u(t.layer),G(c,"click",this._onInputClick,this);var d=document.createElement("span");d.innerHTML=" "+t.name;var g=document.createElement("span");e.appendChild(g),g.appendChild(c),g.appendChild(d);var w=t.overlay?this._overlaysList:this._baseLayersList;return w.appendChild(e),this._checkDisabledLayers(),e},_onInputClick:function(){if(!this._preventClick){var t=this._layerControlInputs,e,s,c=[],d=[];this._handlingClick=!0;for(var g=t.length-1;g>=0;g--)e=t[g],s=this._getLayer(e.layerId).layer,e.checked?c.push(s):e.checked||d.push(s);for(g=0;g<d.length;g++)this._map.hasLayer(d[g])&&this._map.removeLayer(d[g]);for(g=0;g<c.length;g++)this._map.hasLayer(c[g])||this._map.addLayer(c[g]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var t=this._layerControlInputs,e,s,c=this._map.getZoom(),d=t.length-1;d>=0;d--)e=t[d],s=this._getLayer(e.layerId).layer,e.disabled=s.options.minZoom!==void 0&&c<s.options.minZoom||s.options.maxZoom!==void 0&&c>s.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var t=this._section;this._preventClick=!0,G(t,"click",Lt),this.expand();var e=this;setTimeout(function(){nt(t,"click",Lt),e._preventClick=!1})}}),lu=function(t,e,s){return new Xo(t,e,s)},Lr=Wt.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(t){var e="leaflet-control-zoom",s=Y("div",e+" leaflet-bar"),c=this.options;return this._zoomInButton=this._createButton(c.zoomInText,c.zoomInTitle,e+"-in",s,this._zoomIn),this._zoomOutButton=this._createButton(c.zoomOutText,c.zoomOutTitle,e+"-out",s,this._zoomOut),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),s},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(t){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(t.shiftKey?3:1))},_zoomOut:function(t){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(t.shiftKey?3:1))},_createButton:function(t,e,s,c,d){var g=Y("a",s,c);return g.innerHTML=t,g.href="#",g.title=e,g.setAttribute("role","button"),g.setAttribute("aria-label",e),gi(g),G(g,"click",Le),G(g,"click",d,this),G(g,"click",this._refocusOnMap,this),g},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";lt(this._zoomInButton,e),lt(this._zoomOutButton,e),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||t._zoom===t.getMinZoom())&&(V(this._zoomOutButton,e),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||t._zoom===t.getMaxZoom())&&(V(this._zoomInButton,e),this._zoomInButton.setAttribute("aria-disabled","true"))}});W.mergeOptions({zoomControl:!0}),W.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Lr,this.addControl(this.zoomControl))});var hu=function(t){return new Lr(t)},Yo=Wt.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(t){var e="leaflet-control-scale",s=Y("div",e),c=this.options;return this._addScales(c,e+"-line",s),t.on(c.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),s},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,s){t.metric&&(this._mScale=Y("div",e,s)),t.imperial&&(this._iScale=Y("div",e,s))},_update:function(){var t=this._map,e=t.getSize().y/2,s=t.distance(t.containerPointToLatLng([0,e]),t.containerPointToLatLng([this.options.maxWidth,e]));this._updateScales(s)},_updateScales:function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},_updateMetric:function(t){var e=this._getRoundNum(t),s=e<1e3?e+" m":e/1e3+" km";this._updateScale(this._mScale,s,e/t)},_updateImperial:function(t){var e=t*3.2808399,s,c,d;e>5280?(s=e/5280,c=this._getRoundNum(s),this._updateScale(this._iScale,c+" mi",c/s)):(d=this._getRoundNum(e),this._updateScale(this._iScale,d+" ft",d/e))},_updateScale:function(t,e,s){t.style.width=Math.round(this.options.maxWidth*s)+"px",t.innerHTML=e},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),s=t/e;return s=s>=10?10:s>=5?5:s>=3?3:s>=2?2:1,e*s}}),cu=function(t){return new Yo(t)},uu='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Er=Wt.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(A.inlineSvg?uu+" ":"")+"Leaflet</a>"},initialize:function(t){y(this,t),this._attributions={}},onAdd:function(t){t.attributionControl=this,this._container=Y("div","leaflet-control-attribution"),gi(this._container);for(var e in t._layers)t._layers[e].getAttribution&&this.addAttribution(t._layers[e].getAttribution());return this._update(),t.on("layeradd",this._addAttribution,this),this._container},onRemove:function(t){t.off("layeradd",this._addAttribution,this)},_addAttribution:function(t){t.layer.getAttribution&&(this.addAttribution(t.layer.getAttribution()),t.layer.once("remove",function(){this.removeAttribution(t.layer.getAttribution())},this))},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):this},removeAttribution:function(t){return t?(this._attributions[t]&&(this._attributions[t]--,this._update()),this):this},_update:function(){if(this._map){var t=[];for(var e in this._attributions)this._attributions[e]&&t.push(e);var s=[];this.options.prefix&&s.push(this.options.prefix),t.length&&s.push(t.join(", ")),this._container.innerHTML=s.join(' <span aria-hidden="true">|</span> ')}}});W.mergeOptions({attributionControl:!0}),W.addInitHook(function(){this.options.attributionControl&&new Er().addTo(this)});var du=function(t){return new Er(t)};Wt.Layers=Xo,Wt.Zoom=Lr,Wt.Scale=Yo,Wt.Attribution=Er,_i.layers=lu,_i.zoom=hu,_i.scale=cu,_i.attribution=du;var Jt=Bt.extend({initialize:function(t){this._map=t},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Jt.addTo=function(t,e){return t.addHandler(e,this),this};var fu={Events:_t},Ko=A.touch?"touchstart mousedown":"mousedown",ue=ye.extend({options:{clickTolerance:3},initialize:function(t,e,s,c){y(this,c),this._element=t,this._dragStartTarget=e||t,this._preventOutline=s},enable:function(){this._enabled||(G(this._dragStartTarget,Ko,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(ue._dragging===this&&this.finishDrag(!0),nt(this._dragStartTarget,Ko,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(t){if(this._enabled&&(this._moved=!1,!cr(this._element,"leaflet-zoom-anim"))){if(t.touches&&t.touches.length!==1){ue._dragging===this&&this.finishDrag();return}if(!(ue._dragging||t.shiftKey||t.which!==1&&t.button!==1&&!t.touches)&&(ue._dragging=this,this._preventOutline&&gr(this._element),fr(),fi(),!this._moving)){this.fire("down");var e=t.touches?t.touches[0]:t,s=Vo(this._element);this._startPoint=new F(e.clientX,e.clientY),this._startPos=be(this._element),this._parentScale=_r(s);var c=t.type==="mousedown";G(document,c?"mousemove":"touchmove",this._onMove,this),G(document,c?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(t){if(this._enabled){if(t.touches&&t.touches.length>1){this._moved=!0;return}var e=t.touches&&t.touches.length===1?t.touches[0]:t,s=new F(e.clientX,e.clientY)._subtract(this._startPoint);!s.x&&!s.y||Math.abs(s.x)+Math.abs(s.y)<this.options.clickTolerance||(s.x/=this._parentScale.x,s.y/=this._parentScale.y,Lt(t),this._moved||(this.fire("dragstart"),this._moved=!0,V(document.body,"leaflet-dragging"),this._lastTarget=t.target||t.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),V(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(s),this._moving=!0,this._lastEvent=t,this._updatePosition())}},_updatePosition:function(){var t={originalEvent:this._lastEvent};this.fire("predrag",t),ct(this._element,this._newPos),this.fire("drag",t)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(t){lt(document.body,"leaflet-dragging"),this._lastTarget&&(lt(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),nt(document,"mousemove touchmove",this._onMove,this),nt(document,"mouseup touchend touchcancel",this._onUp,this),mr(),mi();var e=this._moved&&this._moving;this._moving=!1,ue._dragging=!1,e&&this.fire("dragend",{noInertia:t,distance:this._newPos.distanceTo(this._startPos)})}});function Qo(t,e,s){var c,d=[1,4,2,8],g,w,b,E,P,I,B,j;for(g=0,I=t.length;g<I;g++)t[g]._code=Ee(t[g],e);for(b=0;b<4;b++){for(B=d[b],c=[],g=0,I=t.length,w=I-1;g<I;w=g++)E=t[g],P=t[w],E._code&B?P._code&B||(j=en(P,E,B,e,s),j._code=Ee(j,e),c.push(j)):(P._code&B&&(j=en(P,E,B,e,s),j._code=Ee(j,e),c.push(j)),c.push(E));t=c}return t}function Jo(t,e){var s,c,d,g,w,b,E,P,I;if(!t||t.length===0)throw new Error("latlngs not passed");Ft(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);var B=H([0,0]),j=ht(t),kt=j.getNorthWest().distanceTo(j.getSouthWest())*j.getNorthEast().distanceTo(j.getNorthWest());kt<1700&&(B=Mr(t));var yt=t.length,$t=[];for(s=0;s<yt;s++){var Ot=H(t[s]);$t.push(e.project(H([Ot.lat-B.lat,Ot.lng-B.lng])))}for(b=E=P=0,s=0,c=yt-1;s<yt;c=s++)d=$t[s],g=$t[c],w=d.y*g.x-g.y*d.x,E+=(d.x+g.x)*w,P+=(d.y+g.y)*w,b+=w*3;b===0?I=$t[0]:I=[E/b,P/b];var Ye=e.unproject($(I));return H([Ye.lat+B.lat,Ye.lng+B.lng])}function Mr(t){for(var e=0,s=0,c=0,d=0;d<t.length;d++){var g=H(t[d]);e+=g.lat,s+=g.lng,c++}return H([e/c,s/c])}var mu={__proto__:null,clipPolygon:Qo,polygonCenter:Jo,centroid:Mr};function ts(t,e){if(!e||!t.length)return t.slice();var s=e*e;return t=_u(t,s),t=gu(t,s),t}function es(t,e,s){return Math.sqrt(vi(t,e,s,!0))}function pu(t,e,s){return vi(t,e,s)}function gu(t,e){var s=t.length,c=typeof Uint8Array<"u"?Uint8Array:Array,d=new c(s);d[0]=d[s-1]=1,Cr(t,d,e,0,s-1);var g,w=[];for(g=0;g<s;g++)d[g]&&w.push(t[g]);return w}function Cr(t,e,s,c,d){var g=0,w,b,E;for(b=c+1;b<=d-1;b++)E=vi(t[b],t[c],t[d],!0),E>g&&(w=b,g=E);g>s&&(e[w]=1,Cr(t,e,s,c,w),Cr(t,e,s,w,d))}function _u(t,e){for(var s=[t[0]],c=1,d=0,g=t.length;c<g;c++)vu(t[c],t[d])>e&&(s.push(t[c]),d=c);return d<g-1&&s.push(t[g-1]),s}var is;function ns(t,e,s,c,d){var g=c?is:Ee(t,s),w=Ee(e,s),b,E,P;for(is=w;;){if(!(g|w))return[t,e];if(g&w)return!1;b=g||w,E=en(t,e,b,s,d),P=Ee(E,s),b===g?(t=E,g=P):(e=E,w=P)}}function en(t,e,s,c,d){var g=e.x-t.x,w=e.y-t.y,b=c.min,E=c.max,P,I;return s&8?(P=t.x+g*(E.y-t.y)/w,I=E.y):s&4?(P=t.x+g*(b.y-t.y)/w,I=b.y):s&2?(P=E.x,I=t.y+w*(E.x-t.x)/g):s&1&&(P=b.x,I=t.y+w*(b.x-t.x)/g),new F(P,I,d)}function Ee(t,e){var s=0;return t.x<e.min.x?s|=1:t.x>e.max.x&&(s|=2),t.y<e.min.y?s|=4:t.y>e.max.y&&(s|=8),s}function vu(t,e){var s=e.x-t.x,c=e.y-t.y;return s*s+c*c}function vi(t,e,s,c){var d=e.x,g=e.y,w=s.x-d,b=s.y-g,E=w*w+b*b,P;return E>0&&(P=((t.x-d)*w+(t.y-g)*b)/E,P>1?(d=s.x,g=s.y):P>0&&(d+=w*P,g+=b*P)),w=t.x-d,b=t.y-g,c?w*w+b*b:new F(d,g)}function Ft(t){return!k(t[0])||typeof t[0][0]!="object"&&typeof t[0][0]<"u"}function rs(t){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Ft(t)}function os(t,e){var s,c,d,g,w,b,E,P;if(!t||t.length===0)throw new Error("latlngs not passed");Ft(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);var I=H([0,0]),B=ht(t),j=B.getNorthWest().distanceTo(B.getSouthWest())*B.getNorthEast().distanceTo(B.getNorthWest());j<1700&&(I=Mr(t));var kt=t.length,yt=[];for(s=0;s<kt;s++){var $t=H(t[s]);yt.push(e.project(H([$t.lat-I.lat,$t.lng-I.lng])))}for(s=0,c=0;s<kt-1;s++)c+=yt[s].distanceTo(yt[s+1])/2;if(c===0)P=yt[0];else for(s=0,g=0;s<kt-1;s++)if(w=yt[s],b=yt[s+1],d=w.distanceTo(b),g+=d,g>c){E=(g-c)/d,P=[b.x-E*(b.x-w.x),b.y-E*(b.y-w.y)];break}var Ot=e.unproject($(P));return H([Ot.lat+I.lat,Ot.lng+I.lng])}var yu={__proto__:null,simplify:ts,pointToSegmentDistance:es,closestPointOnSegment:pu,clipSegment:ns,_getEdgeIntersection:en,_getBitCode:Ee,_sqClosestPointOnSegment:vi,isFlat:Ft,_flat:rs,polylineCenter:os},Sr={project:function(t){return new F(t.lng,t.lat)},unproject:function(t){return new tt(t.y,t.x)},bounds:new it([-180,-90],[180,90])},kr={R:6378137,R_MINOR:6356752314245179e-9,bounds:new it([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(t){var e=Math.PI/180,s=this.R,c=t.lat*e,d=this.R_MINOR/s,g=Math.sqrt(1-d*d),w=g*Math.sin(c),b=Math.tan(Math.PI/4-c/2)/Math.pow((1-w)/(1+w),g/2);return c=-s*Math.log(Math.max(b,1e-10)),new F(t.lng*e*s,c)},unproject:function(t){for(var e=180/Math.PI,s=this.R,c=this.R_MINOR/s,d=Math.sqrt(1-c*c),g=Math.exp(-t.y/s),w=Math.PI/2-2*Math.atan(g),b=0,E=.1,P;b<15&&Math.abs(E)>1e-7;b++)P=d*Math.sin(w),P=Math.pow((1-P)/(1+P),d/2),E=Math.PI/2-2*Math.atan(g*P)-w,w+=E;return new tt(w*e,t.x*e/s)}},wu={__proto__:null,LonLat:Sr,Mercator:kr,SphericalMercator:tr},bu=n({},ce,{code:"EPSG:3395",projection:kr,transformation:function(){var t=.5/(Math.PI*kr.R);return hi(t,.5,-t,.5)}()}),ss=n({},ce,{code:"EPSG:4326",projection:Sr,transformation:hi(1/180,1,-1/180,.5)}),xu=n({},ie,{projection:Sr,transformation:hi(1,0,-1,0),scale:function(t){return Math.pow(2,t)},zoom:function(t){return Math.log(t)/Math.LN2},distance:function(t,e){var s=e.lng-t.lng,c=e.lat-t.lat;return Math.sqrt(s*s+c*c)},infinite:!0});ie.Earth=ce,ie.EPSG3395=bu,ie.EPSG3857=ir,ie.EPSG900913=kc,ie.EPSG4326=ss,ie.Simple=xu;var qt=ye.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(t){return t.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(t){return t&&t.removeLayer(this),this},getPane:function(t){return this._map.getPane(t?this.options[t]||t:this.options.pane)},addInteractiveTarget:function(t){return this._map._targets[u(t)]=this,this},removeInteractiveTarget:function(t){return delete this._map._targets[u(t)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(t){var e=t.target;if(e.hasLayer(this)){if(this._map=e,this._zoomAnimated=e._zoomAnimated,this.getEvents){var s=this.getEvents();e.on(s,this),this.once("remove",function(){e.off(s,this)},this)}this.onAdd(e),this.fire("add"),e.fire("layeradd",{layer:this})}}});W.include({addLayer:function(t){if(!t._layerAdd)throw new Error("The provided object is not a Layer.");var e=u(t);return this._layers[e]?this:(this._layers[e]=t,t._mapToAdd=this,t.beforeAdd&&t.beforeAdd(this),this.whenReady(t._layerAdd,t),this)},removeLayer:function(t){var e=u(t);return this._layers[e]?(this._loaded&&t.onRemove(this),delete this._layers[e],this._loaded&&(this.fire("layerremove",{layer:t}),t.fire("remove")),t._map=t._mapToAdd=null,this):this},hasLayer:function(t){return u(t)in this._layers},eachLayer:function(t,e){for(var s in this._layers)t.call(e,this._layers[s]);return this},_addLayers:function(t){t=t?k(t)?t:[t]:[];for(var e=0,s=t.length;e<s;e++)this.addLayer(t[e])},_addZoomLimit:function(t){(!isNaN(t.options.maxZoom)||!isNaN(t.options.minZoom))&&(this._zoomBoundLayers[u(t)]=t,this._updateZoomLevels())},_removeZoomLimit:function(t){var e=u(t);this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels())},_updateZoomLevels:function(){var t=1/0,e=-1/0,s=this._getZoomSpan();for(var c in this._zoomBoundLayers){var d=this._zoomBoundLayers[c].options;t=d.minZoom===void 0?t:Math.min(t,d.minZoom),e=d.maxZoom===void 0?e:Math.max(e,d.maxZoom)}this._layersMaxZoom=e===-1/0?void 0:e,this._layersMinZoom=t===1/0?void 0:t,s!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Ue=qt.extend({initialize:function(t,e){y(this,e),this._layers={};var s,c;if(t)for(s=0,c=t.length;s<c;s++)this.addLayer(t[s])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){var e=typeof t=="number"?t:this.getLayerId(t);return e in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(t){var e=Array.prototype.slice.call(arguments,1),s,c;for(s in this._layers)c=this._layers[s],c[t]&&c[t].apply(c,e);return this},onAdd:function(t){this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t)},eachLayer:function(t,e){for(var s in this._layers)t.call(e,this._layers[s]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];return this.eachLayer(t.push,t),t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return u(t)}}),Lu=function(t,e){return new Ue(t,e)},ne=Ue.extend({addLayer:function(t){return this.hasLayer(t)?this:(t.addEventParent(this),Ue.prototype.addLayer.call(this,t),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.removeEventParent(this),Ue.prototype.removeLayer.call(this,t),this.fire("layerremove",{layer:t})):this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new It;for(var e in this._layers){var s=this._layers[e];t.extend(s.getBounds?s.getBounds():s.getLatLng())}return t}}),Eu=function(t,e){return new ne(t,e)},He=Bt.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(t){y(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var s=this._getIconUrl(t);if(!s){if(t==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var c=this._createImg(s,e&&e.tagName==="IMG"?e:null);return this._setIconStyles(c,t),(this.options.crossOrigin||this.options.crossOrigin==="")&&(c.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),c},_setIconStyles:function(t,e){var s=this.options,c=s[e+"Size"];typeof c=="number"&&(c=[c,c]);var d=$(c),g=$(e==="shadow"&&s.shadowAnchor||s.iconAnchor||d&&d.divideBy(2,!0));t.className="leaflet-marker-"+e+" "+(s.className||""),g&&(t.style.marginLeft=-g.x+"px",t.style.marginTop=-g.y+"px"),d&&(t.style.width=d.x+"px",t.style.height=d.y+"px")},_createImg:function(t,e){return e=e||document.createElement("img"),e.src=t,e},_getIconUrl:function(t){return A.retina&&this.options[t+"RetinaUrl"]||this.options[t+"Url"]}});function Mu(t){return new He(t)}var yi=He.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(t){return typeof yi.imagePath!="string"&&(yi.imagePath=this._detectIconPath()),(this.options.imagePath||yi.imagePath)+He.prototype._getIconUrl.call(this,t)},_stripUrl:function(t){var e=function(s,c,d){var g=c.exec(s);return g&&g[d]};return t=e(t,/^url\((['"])?(.+)\1\)$/,2),t&&e(t,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var t=Y("div","leaflet-default-icon-path",document.body),e=di(t,"background-image")||di(t,"backgroundImage");if(document.body.removeChild(t),e=this._stripUrl(e),e)return e;var s=document.querySelector('link[href$="leaflet.css"]');return s?s.href.substring(0,s.href.length-11-1):""}}),as=Jt.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new ue(t,t,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),V(t,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&lt(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(t){var e=this._marker,s=e._map,c=this._marker.options.autoPanSpeed,d=this._marker.options.autoPanPadding,g=be(e._icon),w=s.getPixelBounds(),b=s.getPixelOrigin(),E=vt(w.min._subtract(b).add(d),w.max._subtract(b).subtract(d));if(!E.contains(g)){var P=$((Math.max(E.max.x,g.x)-E.max.x)/(w.max.x-E.max.x)-(Math.min(E.min.x,g.x)-E.min.x)/(w.min.x-E.min.x),(Math.max(E.max.y,g.y)-E.max.y)/(w.max.y-E.max.y)-(Math.min(E.min.y,g.y)-E.min.y)/(w.min.y-E.min.y)).multiplyBy(c);s.panBy(P,{animate:!1}),this._draggable._newPos._add(P),this._draggable._startPos._add(P),ct(e._icon,this._draggable._newPos),this._onDrag(t),this._panRequest=Q(this._adjustPan.bind(this,t))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(t){this._marker.options.autoPan&&(ot(this._panRequest),this._panRequest=Q(this._adjustPan.bind(this,t)))},_onDrag:function(t){var e=this._marker,s=e._shadow,c=be(e._icon),d=e._map.layerPointToLatLng(c);s&&ct(s,c),e._latlng=d,t.latlng=d,t.oldLatLng=this._oldLatLng,e.fire("move",t).fire("drag",t)},_onDragEnd:function(t){ot(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",t)}}),nn=qt.extend({options:{icon:new yi,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(t,e){y(this,e),this._latlng=H(t)},onAdd:function(t){this._zoomAnimated=this._zoomAnimated&&t.options.markerZoomAnimation,this._zoomAnimated&&t.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(t){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&t.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(t){var e=this._latlng;return this._latlng=H(t),this.update(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update()},getIcon:function(){return this.options.icon},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,e="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),s=t.icon.createIcon(this._icon),c=!1;s!==this._icon&&(this._icon&&this._removeIcon(),c=!0,t.title&&(s.title=t.title),s.tagName==="IMG"&&(s.alt=t.alt||"")),V(s,e),t.keyboard&&(s.tabIndex="0",s.setAttribute("role","button")),this._icon=s,t.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&G(s,"focus",this._panOnFocus,this);var d=t.icon.createShadow(this._shadow),g=!1;d!==this._shadow&&(this._removeShadow(),g=!0),d&&(V(d,e),d.alt=""),this._shadow=d,t.opacity<1&&this._updateOpacity(),c&&this.getPane().appendChild(this._icon),this._initInteraction(),d&&g&&this.getPane(t.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&nt(this._icon,"focus",this._panOnFocus,this),st(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&st(this._shadow),this._shadow=null},_setPos:function(t){this._icon&&ct(this._icon,t),this._shadow&&ct(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon&&(this._icon.style.zIndex=this._zIndex+t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(e)},_initInteraction:function(){if(this.options.interactive&&(V(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),as)){var t=this.options.draggable;this.dragging&&(t=this.dragging.enabled(),this.dragging.disable()),this.dragging=new as(this),t&&this.dragging.enable()}},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var t=this.options.opacity;this._icon&&Zt(this._icon,t),this._shadow&&Zt(this._shadow,t)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var t=this._map;if(t){var e=this.options.icon.options,s=e.iconSize?$(e.iconSize):$(0,0),c=e.iconAnchor?$(e.iconAnchor):$(0,0);t.panInside(this._latlng,{paddingTopLeft:c,paddingBottomRight:s.subtract(c)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Cu(t,e){return new nn(t,e)}var de=qt.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(t){this._renderer=t.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(t){return y(this,t),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&t&&Object.prototype.hasOwnProperty.call(t,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),rn=de.extend({options:{fill:!0,radius:10},initialize:function(t,e){y(this,e),this._latlng=H(t),this._radius=this.options.radius},setLatLng:function(t){var e=this._latlng;return this._latlng=H(t),this.redraw(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius},setStyle:function(t){var e=t&&t.radius||this._radius;return de.prototype.setStyle.call(this,t),this.setRadius(e),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var t=this._radius,e=this._radiusY||t,s=this._clickTolerance(),c=[t+s,e+s];this._pxBounds=new it(this._point.subtract(c),this._point.add(c))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(t){return t.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function Su(t,e){return new rn(t,e)}var Pr=rn.extend({initialize:function(t,e,s){if(typeof e=="number"&&(e=n({},s,{radius:e})),y(this,e),this._latlng=H(t),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(t){return this._mRadius=t,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var t=[this._radius,this._radiusY||this._radius];return new It(this._map.layerPointToLatLng(this._point.subtract(t)),this._map.layerPointToLatLng(this._point.add(t)))},setStyle:de.prototype.setStyle,_project:function(){var t=this._latlng.lng,e=this._latlng.lat,s=this._map,c=s.options.crs;if(c.distance===ce.distance){var d=Math.PI/180,g=this._mRadius/ce.R/d,w=s.project([e+g,t]),b=s.project([e-g,t]),E=w.add(b).divideBy(2),P=s.unproject(E).lat,I=Math.acos((Math.cos(g*d)-Math.sin(e*d)*Math.sin(P*d))/(Math.cos(e*d)*Math.cos(P*d)))/d;(isNaN(I)||I===0)&&(I=g/Math.cos(Math.PI/180*e)),this._point=E.subtract(s.getPixelOrigin()),this._radius=isNaN(I)?0:E.x-s.project([P,t-I]).x,this._radiusY=E.y-w.y}else{var B=c.unproject(c.project(this._latlng).subtract([this._mRadius,0]));this._point=s.latLngToLayerPoint(this._latlng),this._radius=this._point.x-s.latLngToLayerPoint(B).x}this._updateBounds()}});function ku(t,e,s){return new Pr(t,e,s)}var re=de.extend({options:{smoothFactor:1,noClip:!1},initialize:function(t,e){y(this,e),this._setLatLngs(t)},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._setLatLngs(t),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(t){for(var e=1/0,s=null,c=vi,d,g,w=0,b=this._parts.length;w<b;w++)for(var E=this._parts[w],P=1,I=E.length;P<I;P++){d=E[P-1],g=E[P];var B=c(t,d,g,!0);B<e&&(e=B,s=c(t,d,g))}return s&&(s.distance=Math.sqrt(e)),s},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return os(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(t,e){return e=e||this._defaultShape(),t=H(t),e.push(t),this._bounds.extend(t),this.redraw()},_setLatLngs:function(t){this._bounds=new It,this._latlngs=this._convertLatLngs(t)},_defaultShape:function(){return Ft(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(t){for(var e=[],s=Ft(t),c=0,d=t.length;c<d;c++)s?(e[c]=H(t[c]),this._bounds.extend(e[c])):e[c]=this._convertLatLngs(t[c]);return e},_project:function(){var t=new it;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,t),this._bounds.isValid()&&t.isValid()&&(this._rawPxBounds=t,this._updateBounds())},_updateBounds:function(){var t=this._clickTolerance(),e=new F(t,t);this._rawPxBounds&&(this._pxBounds=new it([this._rawPxBounds.min.subtract(e),this._rawPxBounds.max.add(e)]))},_projectLatlngs:function(t,e,s){var c=t[0]instanceof tt,d=t.length,g,w;if(c){for(w=[],g=0;g<d;g++)w[g]=this._map.latLngToLayerPoint(t[g]),s.extend(w[g]);e.push(w)}else for(g=0;g<d;g++)this._projectLatlngs(t[g],e,s)},_clipPoints:function(){var t=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(t))){if(this.options.noClip){this._parts=this._rings;return}var e=this._parts,s,c,d,g,w,b,E;for(s=0,d=0,g=this._rings.length;s<g;s++)for(E=this._rings[s],c=0,w=E.length;c<w-1;c++)b=ns(E[c],E[c+1],t,c,!0),b&&(e[d]=e[d]||[],e[d].push(b[0]),(b[1]!==E[c+1]||c===w-2)&&(e[d].push(b[1]),d++))}},_simplifyPoints:function(){for(var t=this._parts,e=this.options.smoothFactor,s=0,c=t.length;s<c;s++)t[s]=ts(t[s],e)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(t,e){var s,c,d,g,w,b,E=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(s=0,g=this._parts.length;s<g;s++)for(b=this._parts[s],c=0,w=b.length,d=w-1;c<w;d=c++)if(!(!e&&c===0)&&es(t,b[d],b[c])<=E)return!0;return!1}});function Pu(t,e){return new re(t,e)}re._flat=rs;var We=re.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Jo(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(t){var e=re.prototype._convertLatLngs.call(this,t),s=e.length;return s>=2&&e[0]instanceof tt&&e[0].equals(e[s-1])&&e.pop(),e},_setLatLngs:function(t){re.prototype._setLatLngs.call(this,t),Ft(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Ft(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var t=this._renderer._bounds,e=this.options.weight,s=new F(e,e);if(t=new it(t.min.subtract(s),t.max.add(s)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(t))){if(this.options.noClip){this._parts=this._rings;return}for(var c=0,d=this._rings.length,g;c<d;c++)g=Qo(this._rings[c],t,!0),g.length&&this._parts.push(g)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(t){var e=!1,s,c,d,g,w,b,E,P;if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(g=0,E=this._parts.length;g<E;g++)for(s=this._parts[g],w=0,P=s.length,b=P-1;w<P;b=w++)c=s[w],d=s[b],c.y>t.y!=d.y>t.y&&t.x<(d.x-c.x)*(t.y-c.y)/(d.y-c.y)+c.x&&(e=!e);return e||re.prototype._containsPoint.call(this,t,!0)}});function Tu(t,e){return new We(t,e)}var oe=ne.extend({initialize:function(t,e){y(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var e=k(t)?t:t.features,s,c,d;if(e){for(s=0,c=e.length;s<c;s++)d=e[s],(d.geometries||d.geometry||d.features||d.coordinates)&&this.addData(d);return this}var g=this.options;if(g.filter&&!g.filter(t))return this;var w=on(t,g);return w?(w.feature=ln(t),w.defaultOptions=w.options,this.resetStyle(w),g.onEachFeature&&g.onEachFeature(t,w),this.addLayer(w)):this},resetStyle:function(t){return t===void 0?this.eachLayer(this.resetStyle,this):(t.options=n({},t.defaultOptions),this._setLayerStyle(t,this.options.style),this)},setStyle:function(t){return this.eachLayer(function(e){this._setLayerStyle(e,t)},this)},_setLayerStyle:function(t,e){t.setStyle&&(typeof e=="function"&&(e=e(t.feature)),t.setStyle(e))}});function on(t,e){var s=t.type==="Feature"?t.geometry:t,c=s?s.coordinates:null,d=[],g=e&&e.pointToLayer,w=e&&e.coordsToLatLng||Tr,b,E,P,I;if(!c&&!s)return null;switch(s.type){case"Point":return b=w(c),ls(g,t,b,e);case"MultiPoint":for(P=0,I=c.length;P<I;P++)b=w(c[P]),d.push(ls(g,t,b,e));return new ne(d);case"LineString":case"MultiLineString":return E=sn(c,s.type==="LineString"?0:1,w),new re(E,e);case"Polygon":case"MultiPolygon":return E=sn(c,s.type==="Polygon"?1:2,w),new We(E,e);case"GeometryCollection":for(P=0,I=s.geometries.length;P<I;P++){var B=on({geometry:s.geometries[P],type:"Feature",properties:t.properties},e);B&&d.push(B)}return new ne(d);case"FeatureCollection":for(P=0,I=s.features.length;P<I;P++){var j=on(s.features[P],e);j&&d.push(j)}return new ne(d);default:throw new Error("Invalid GeoJSON object.")}}function ls(t,e,s,c){return t?t(e,s):new nn(s,c&&c.markersInheritOptions&&c)}function Tr(t){return new tt(t[1],t[0],t[2])}function sn(t,e,s){for(var c=[],d=0,g=t.length,w;d<g;d++)w=e?sn(t[d],e-1,s):(s||Tr)(t[d]),c.push(w);return c}function Ir(t,e){return t=H(t),t.alt!==void 0?[l(t.lng,e),l(t.lat,e),l(t.alt,e)]:[l(t.lng,e),l(t.lat,e)]}function an(t,e,s,c){for(var d=[],g=0,w=t.length;g<w;g++)d.push(e?an(t[g],Ft(t[g])?0:e-1,s,c):Ir(t[g],c));return!e&&s&&d.length>0&&d.push(d[0].slice()),d}function qe(t,e){return t.feature?n({},t.feature,{geometry:e}):ln(e)}function ln(t){return t.type==="Feature"||t.type==="FeatureCollection"?t:{type:"Feature",properties:{},geometry:t}}var Or={toGeoJSON:function(t){return qe(this,{type:"Point",coordinates:Ir(this.getLatLng(),t)})}};nn.include(Or),Pr.include(Or),rn.include(Or),re.include({toGeoJSON:function(t){var e=!Ft(this._latlngs),s=an(this._latlngs,e?1:0,!1,t);return qe(this,{type:(e?"Multi":"")+"LineString",coordinates:s})}}),We.include({toGeoJSON:function(t){var e=!Ft(this._latlngs),s=e&&!Ft(this._latlngs[0]),c=an(this._latlngs,s?2:e?1:0,!0,t);return e||(c=[c]),qe(this,{type:(s?"Multi":"")+"Polygon",coordinates:c})}}),Ue.include({toMultiPoint:function(t){var e=[];return this.eachLayer(function(s){e.push(s.toGeoJSON(t).geometry.coordinates)}),qe(this,{type:"MultiPoint",coordinates:e})},toGeoJSON:function(t){var e=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(e==="MultiPoint")return this.toMultiPoint(t);var s=e==="GeometryCollection",c=[];return this.eachLayer(function(d){if(d.toGeoJSON){var g=d.toGeoJSON(t);if(s)c.push(g.geometry);else{var w=ln(g);w.type==="FeatureCollection"?c.push.apply(c,w.features):c.push(w)}}}),s?qe(this,{geometries:c,type:"GeometryCollection"}):{type:"FeatureCollection",features:c}}});function hs(t,e){return new oe(t,e)}var Iu=hs,hn=qt.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(t,e,s){this._url=t,this._bounds=ht(e),y(this,s)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(V(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){st(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(t){return this.options.opacity=t,this._image&&this._updateOpacity(),this},setStyle:function(t){return t.opacity&&this.setOpacity(t.opacity),this},bringToFront:function(){return this._map&&Ve(this._image),this},bringToBack:function(){return this._map&&je(this._image),this},setUrl:function(t){return this._url=t,this._image&&(this._image.src=t),this},setBounds:function(t){return this._bounds=ht(t),this._map&&this._reset(),this},getEvents:function(){var t={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var t=this._url.tagName==="IMG",e=this._image=t?this._url:Y("img");if(V(e,"leaflet-image-layer"),this._zoomAnimated&&V(e,"leaflet-zoom-animated"),this.options.className&&V(e,this.options.className),e.onselectstart=p,e.onmousemove=p,e.onload=o(this.fire,this,"load"),e.onerror=o(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(e.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),t){this._url=e.src;return}e.src=this._url,e.alt=this.options.alt},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),s=this._map._latLngBoundsToNewLayerBounds(this._bounds,t.zoom,t.center).min;we(this._image,s,e)},_reset:function(){var t=this._image,e=new it(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),s=e.getSize();ct(t,e.min),t.style.width=s.x+"px",t.style.height=s.y+"px"},_updateOpacity:function(){Zt(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var t=this.options.errorOverlayUrl;t&&this._url!==t&&(this._url=t,this._image.src=t)},getCenter:function(){return this._bounds.getCenter()}}),Ou=function(t,e,s){return new hn(t,e,s)},cs=hn.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var t=this._url.tagName==="VIDEO",e=this._image=t?this._url:Y("video");if(V(e,"leaflet-image-layer"),this._zoomAnimated&&V(e,"leaflet-zoom-animated"),this.options.className&&V(e,this.options.className),e.onselectstart=p,e.onmousemove=p,e.onloadeddata=o(this.fire,this,"load"),t){for(var s=e.getElementsByTagName("source"),c=[],d=0;d<s.length;d++)c.push(s[d].src);this._url=s.length>0?c:[e.src];return}k(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(e.style,"objectFit")&&(e.style.objectFit="fill"),e.autoplay=!!this.options.autoplay,e.loop=!!this.options.loop,e.muted=!!this.options.muted,e.playsInline=!!this.options.playsInline;for(var g=0;g<this._url.length;g++){var w=Y("source");w.src=this._url[g],e.appendChild(w)}}});function Au(t,e,s){return new cs(t,e,s)}var us=hn.extend({_initImage:function(){var t=this._image=this._url;V(t,"leaflet-image-layer"),this._zoomAnimated&&V(t,"leaflet-zoom-animated"),this.options.className&&V(t,this.options.className),t.onselectstart=p,t.onmousemove=p}});function Du(t,e,s){return new us(t,e,s)}var te=qt.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(t,e){t&&(t instanceof tt||k(t))?(this._latlng=H(t),y(this,e)):(y(this,t),this._source=e),this.options.content&&(this._content=this.options.content)},openOn:function(t){return t=arguments.length?t:this._source._map,t.hasLayer(this)||t.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(t){return this._map?this.close():(arguments.length?this._source=t:t=this._source,this._prepareOpen(),this.openOn(t._map)),this},onAdd:function(t){this._zoomAnimated=t._zoomAnimated,this._container||this._initLayout(),t._fadeAnimated&&Zt(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),t._fadeAnimated&&Zt(this._container,1),this.bringToFront(),this.options.interactive&&(V(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(t){t._fadeAnimated?(Zt(this._container,0),this._removeTimeout=setTimeout(o(st,void 0,this._container),200)):st(this._container),this.options.interactive&&(lt(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=H(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var t={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&Ve(this._container),this},bringToBack:function(){return this._map&&je(this._container),this},_prepareOpen:function(t){var e=this._source;if(!e._map)return!1;if(e instanceof ne){e=null;var s=this._source._layers;for(var c in s)if(s[c]._map){e=s[c];break}if(!e)return!1;this._source=e}if(!t)if(e.getCenter)t=e.getCenter();else if(e.getLatLng)t=e.getLatLng();else if(e.getBounds)t=e.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(t),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var t=this._contentNode,e=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof e=="string")t.innerHTML=e;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(e)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=$(this.options.offset),s=this._getAnchor();this._zoomAnimated?ct(this._container,t.add(s)):e=e.add(t).add(s);var c=this._containerBottom=-e.y,d=this._containerLeft=-Math.round(this._containerWidth/2)+e.x;this._container.style.bottom=c+"px",this._container.style.left=d+"px"}},_getAnchor:function(){return[0,0]}});W.include({_initOverlay:function(t,e,s,c){var d=e;return d instanceof t||(d=new t(c).setContent(e)),s&&d.setLatLng(s),d}}),qt.include({_initOverlay:function(t,e,s,c){var d=s;return d instanceof t?(y(d,c),d._source=this):(d=e&&!c?e:new t(c,this),d.setContent(s)),d}});var cn=te.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(t){return t=arguments.length?t:this._source._map,!t.hasLayer(this)&&t._popup&&t._popup.options.autoClose&&t.removeLayer(t._popup),t._popup=this,te.prototype.openOn.call(this,t)},onAdd:function(t){te.prototype.onAdd.call(this,t),t.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof de||this._source.on("preclick",xe))},onRemove:function(t){te.prototype.onRemove.call(this,t),t.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof de||this._source.off("preclick",xe))},getEvents:function(){var t=te.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this.close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_initLayout:function(){var t="leaflet-popup",e=this._container=Y("div",t+" "+(this.options.className||"")+" leaflet-zoom-animated"),s=this._wrapper=Y("div",t+"-content-wrapper",e);if(this._contentNode=Y("div",t+"-content",s),gi(e),br(this._contentNode),G(e,"contextmenu",xe),this._tipContainer=Y("div",t+"-tip-container",e),this._tip=Y("div",t+"-tip",this._tipContainer),this.options.closeButton){var c=this._closeButton=Y("a",t+"-close-button",e);c.setAttribute("role","button"),c.setAttribute("aria-label","Close popup"),c.href="#close",c.innerHTML='<span aria-hidden="true">&#215;</span>',G(c,"click",function(d){Lt(d),this.close()},this)}},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var s=t.offsetWidth;s=Math.min(s,this.options.maxWidth),s=Math.max(s,this.options.minWidth),e.width=s+1+"px",e.whiteSpace="",e.height="";var c=t.offsetHeight,d=this.options.maxHeight,g="leaflet-popup-scrolled";d&&c>d?(e.height=d+"px",V(t,g)):lt(t,g),this._containerWidth=this._container.offsetWidth},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center),s=this._getAnchor();ct(this._container,e.add(s))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var t=this._map,e=parseInt(di(this._container,"marginBottom"),10)||0,s=this._container.offsetHeight+e,c=this._containerWidth,d=new F(this._containerLeft,-s-this._containerBottom);d._add(be(this._container));var g=t.layerPointToContainerPoint(d),w=$(this.options.autoPanPadding),b=$(this.options.autoPanPaddingTopLeft||w),E=$(this.options.autoPanPaddingBottomRight||w),P=t.getSize(),I=0,B=0;g.x+c+E.x>P.x&&(I=g.x+c-P.x+E.x),g.x-I-b.x<0&&(I=g.x-b.x),g.y+s+E.y>P.y&&(B=g.y+s-P.y+E.y),g.y-B-b.y<0&&(B=g.y-b.y),(I||B)&&(this.options.keepInView&&(this._autopanning=!0),t.fire("autopanstart").panBy([I,B]))}},_getAnchor:function(){return $(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),zu=function(t,e){return new cn(t,e)};W.mergeOptions({closePopupOnClick:!0}),W.include({openPopup:function(t,e,s){return this._initOverlay(cn,t,e,s).openOn(this),this},closePopup:function(t){return t=arguments.length?t:this._popup,t&&t.close(),this}}),qt.include({bindPopup:function(t,e){return this._popup=this._initOverlay(cn,this._popup,t,e),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(t){return this._popup&&(this instanceof ne||(this._popup._source=this),this._popup._prepareOpen(t||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},getPopup:function(){return this._popup},_openPopup:function(t){if(!(!this._popup||!this._map)){Le(t);var e=t.layer||t.target;if(this._popup._source===e&&!(e instanceof de)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(t.latlng);return}this._popup._source=e,this.openPopup(t.latlng)}},_movePopup:function(t){this._popup.setLatLng(t.latlng)},_onKeyPress:function(t){t.originalEvent.keyCode===13&&this._openPopup(t)}});var un=te.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(t){te.prototype.onAdd.call(this,t),this.setOpacity(this.options.opacity),t.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(t){te.prototype.onRemove.call(this,t),t.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var t=te.prototype.getEvents.call(this);return this.options.permanent||(t.preclick=this.close),t},_initLayout:function(){var t="leaflet-tooltip",e=t+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=Y("div",e),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+u(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(t){var e,s,c=this._map,d=this._container,g=c.latLngToContainerPoint(c.getCenter()),w=c.layerPointToContainerPoint(t),b=this.options.direction,E=d.offsetWidth,P=d.offsetHeight,I=$(this.options.offset),B=this._getAnchor();b==="top"?(e=E/2,s=P):b==="bottom"?(e=E/2,s=0):b==="center"?(e=E/2,s=P/2):b==="right"?(e=0,s=P/2):b==="left"?(e=E,s=P/2):w.x<g.x?(b="right",e=0,s=P/2):(b="left",e=E+(I.x+B.x)*2,s=P/2),t=t.subtract($(e,s,!0)).add(I).add(B),lt(d,"leaflet-tooltip-right"),lt(d,"leaflet-tooltip-left"),lt(d,"leaflet-tooltip-top"),lt(d,"leaflet-tooltip-bottom"),V(d,"leaflet-tooltip-"+b),ct(d,t)},_updatePosition:function(){var t=this._map.latLngToLayerPoint(this._latlng);this._setPosition(t)},setOpacity:function(t){this.options.opacity=t,this._container&&Zt(this._container,t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPosition(e)},_getAnchor:function(){return $(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Ru=function(t,e){return new un(t,e)};W.include({openTooltip:function(t,e,s){return this._initOverlay(un,t,e,s).openOn(this),this},closeTooltip:function(t){return t.close(),this}}),qt.include({bindTooltip:function(t,e){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(un,this._tooltip,t,e),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(t){if(!(!t&&this._tooltipHandlersAdded)){var e=t?"off":"on",s={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?s.add=this._openTooltip:(s.mouseover=this._openTooltip,s.mouseout=this.closeTooltip,s.click=this._openTooltip,this._map?this._addFocusListeners():s.add=this._addFocusListeners),this._tooltip.options.sticky&&(s.mousemove=this._moveTooltip),this[e](s),this._tooltipHandlersAdded=!t}},openTooltip:function(t){return this._tooltip&&(this instanceof ne||(this._tooltip._source=this),this._tooltip._prepareOpen(t)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(t){return this._tooltip&&this._tooltip.setContent(t),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(t){var e=typeof t.getElement=="function"&&t.getElement();e&&(G(e,"focus",function(){this._tooltip._source=t,this.openTooltip()},this),G(e,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(t){var e=typeof t.getElement=="function"&&t.getElement();e&&e.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(t){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var e=this;this._map.once("moveend",function(){e._openOnceFlag=!1,e._openTooltip(t)});return}this._tooltip._source=t.layer||t.target,this.openTooltip(this._tooltip.options.sticky?t.latlng:void 0)}},_moveTooltip:function(t){var e=t.latlng,s,c;this._tooltip.options.sticky&&t.originalEvent&&(s=this._map.mouseEventToContainerPoint(t.originalEvent),c=this._map.containerPointToLayerPoint(s),e=this._map.layerPointToLatLng(c)),this._tooltip.setLatLng(e)}});var ds=He.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(t){var e=t&&t.tagName==="DIV"?t:document.createElement("div"),s=this.options;if(s.html instanceof Element?(Yi(e),e.appendChild(s.html)):e.innerHTML=s.html!==!1?s.html:"",s.bgPos){var c=$(s.bgPos);e.style.backgroundPosition=-c.x+"px "+-c.y+"px"}return this._setIconStyles(e,"icon"),e},createShadow:function(){return null}});function Nu(t){return new ds(t)}He.Default=yi;var wi=qt.extend({options:{tileSize:256,opacity:1,updateWhenIdle:A.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(t){y(this,t)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(t){t._addZoomLimit(this)},onRemove:function(t){this._removeAllTiles(),st(this._container),t._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(Ve(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(je(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var t=this._clampZoom(this._map.getZoom());t!==this._tileZoom&&(this._tileZoom=t,this._updateLevels()),this._update()}return this},getEvents:function(){var t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=f(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},createTile:function(){return document.createElement("div")},getTileSize:function(){var t=this.options.tileSize;return t instanceof F?t:new F(t,t)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t){for(var e=this.getPane().children,s=-t(-1/0,1/0),c=0,d=e.length,g;c<d;c++)g=e[c].style.zIndex,e[c]!==this._container&&g&&(s=t(s,+g));isFinite(s)&&(this.options.zIndex=s+t(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!A.ielt9){Zt(this._container,this.options.opacity);var t=+new Date,e=!1,s=!1;for(var c in this._tiles){var d=this._tiles[c];if(!(!d.current||!d.loaded)){var g=Math.min(1,(t-d.loaded)/200);Zt(d.el,g),g<1?e=!0:(d.active?s=!0:this._onOpaqueTile(d),d.active=!0)}}s&&!this._noPrune&&this._pruneTiles(),e&&(ot(this._fadeFrame),this._fadeFrame=Q(this._updateOpacity,this))}},_onOpaqueTile:p,_initContainer:function(){this._container||(this._container=Y("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var t=this._tileZoom,e=this.options.maxZoom;if(t!==void 0){for(var s in this._levels)s=Number(s),this._levels[s].el.children.length||s===t?(this._levels[s].el.style.zIndex=e-Math.abs(t-s),this._onUpdateLevel(s)):(st(this._levels[s].el),this._removeTilesAtZoom(s),this._onRemoveLevel(s),delete this._levels[s]);var c=this._levels[t],d=this._map;return c||(c=this._levels[t]={},c.el=Y("div","leaflet-tile-container leaflet-zoom-animated",this._container),c.el.style.zIndex=e,c.origin=d.project(d.unproject(d.getPixelOrigin()),t).round(),c.zoom=t,this._setZoomTransform(c,d.getCenter(),d.getZoom()),p(c.el.offsetWidth),this._onCreateLevel(c)),this._level=c,c}},_onUpdateLevel:p,_onRemoveLevel:p,_onCreateLevel:p,_pruneTiles:function(){if(this._map){var t,e,s=this._map.getZoom();if(s>this.options.maxZoom||s<this.options.minZoom){this._removeAllTiles();return}for(t in this._tiles)e=this._tiles[t],e.retain=e.current;for(t in this._tiles)if(e=this._tiles[t],e.current&&!e.active){var c=e.coords;this._retainParent(c.x,c.y,c.z,c.z-5)||this._retainChildren(c.x,c.y,c.z,c.z+2)}for(t in this._tiles)this._tiles[t].retain||this._removeTile(t)}},_removeTilesAtZoom:function(t){for(var e in this._tiles)this._tiles[e].coords.z===t&&this._removeTile(e)},_removeAllTiles:function(){for(var t in this._tiles)this._removeTile(t)},_invalidateAll:function(){for(var t in this._levels)st(this._levels[t].el),this._onRemoveLevel(Number(t)),delete this._levels[t];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(t,e,s,c){var d=Math.floor(t/2),g=Math.floor(e/2),w=s-1,b=new F(+d,+g);b.z=+w;var E=this._tileCoordsToKey(b),P=this._tiles[E];return P&&P.active?(P.retain=!0,!0):(P&&P.loaded&&(P.retain=!0),w>c?this._retainParent(d,g,w,c):!1)},_retainChildren:function(t,e,s,c){for(var d=2*t;d<2*t+2;d++)for(var g=2*e;g<2*e+2;g++){var w=new F(d,g);w.z=s+1;var b=this._tileCoordsToKey(w),E=this._tiles[b];if(E&&E.active){E.retain=!0;continue}else E&&E.loaded&&(E.retain=!0);s+1<c&&this._retainChildren(d,g,s+1,c)}},_resetView:function(t){var e=t&&(t.pinch||t.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),e,e)},_animateZoom:function(t){this._setView(t.center,t.zoom,!0,t.noUpdate)},_clampZoom:function(t){var e=this.options;return e.minNativeZoom!==void 0&&t<e.minNativeZoom?e.minNativeZoom:e.maxNativeZoom!==void 0&&e.maxNativeZoom<t?e.maxNativeZoom:t},_setView:function(t,e,s,c){var d=Math.round(e);this.options.maxZoom!==void 0&&d>this.options.maxZoom||this.options.minZoom!==void 0&&d<this.options.minZoom?d=void 0:d=this._clampZoom(d);var g=this.options.updateWhenZooming&&d!==this._tileZoom;(!c||g)&&(this._tileZoom=d,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),d!==void 0&&this._update(t),s||this._pruneTiles(),this._noPrune=!!s),this._setZoomTransforms(t,e)},_setZoomTransforms:function(t,e){for(var s in this._levels)this._setZoomTransform(this._levels[s],t,e)},_setZoomTransform:function(t,e,s){var c=this._map.getZoomScale(s,t.zoom),d=t.origin.multiplyBy(c).subtract(this._map._getNewPixelOrigin(e,s)).round();A.any3d?we(t.el,d,c):ct(t.el,d)},_resetGrid:function(){var t=this._map,e=t.options.crs,s=this._tileSize=this.getTileSize(),c=this._tileZoom,d=this._map.getPixelWorldBounds(this._tileZoom);d&&(this._globalTileRange=this._pxBoundsToTileRange(d)),this._wrapX=e.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,e.wrapLng[0]],c).x/s.x),Math.ceil(t.project([0,e.wrapLng[1]],c).x/s.y)],this._wrapY=e.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([e.wrapLat[0],0],c).y/s.x),Math.ceil(t.project([e.wrapLat[1],0],c).y/s.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(t){var e=this._map,s=e._animatingZoom?Math.max(e._animateToZoom,e.getZoom()):e.getZoom(),c=e.getZoomScale(s,this._tileZoom),d=e.project(t,this._tileZoom).floor(),g=e.getSize().divideBy(c*2);return new it(d.subtract(g),d.add(g))},_update:function(t){var e=this._map;if(e){var s=this._clampZoom(e.getZoom());if(t===void 0&&(t=e.getCenter()),this._tileZoom!==void 0){var c=this._getTiledPixelBounds(t),d=this._pxBoundsToTileRange(c),g=d.getCenter(),w=[],b=this.options.keepBuffer,E=new it(d.getBottomLeft().subtract([b,-b]),d.getTopRight().add([b,-b]));if(!(isFinite(d.min.x)&&isFinite(d.min.y)&&isFinite(d.max.x)&&isFinite(d.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var P in this._tiles){var I=this._tiles[P].coords;(I.z!==this._tileZoom||!E.contains(new F(I.x,I.y)))&&(this._tiles[P].current=!1)}if(Math.abs(s-this._tileZoom)>1){this._setView(t,s);return}for(var B=d.min.y;B<=d.max.y;B++)for(var j=d.min.x;j<=d.max.x;j++){var kt=new F(j,B);if(kt.z=this._tileZoom,!!this._isValidTile(kt)){var yt=this._tiles[this._tileCoordsToKey(kt)];yt?yt.current=!0:w.push(kt)}}if(w.sort(function(Ot,Ye){return Ot.distanceTo(g)-Ye.distanceTo(g)}),w.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var $t=document.createDocumentFragment();for(j=0;j<w.length;j++)this._addTile(w[j],$t);this._level.el.appendChild($t)}}}},_isValidTile:function(t){var e=this._map.options.crs;if(!e.infinite){var s=this._globalTileRange;if(!e.wrapLng&&(t.x<s.min.x||t.x>s.max.x)||!e.wrapLat&&(t.y<s.min.y||t.y>s.max.y))return!1}if(!this.options.bounds)return!0;var c=this._tileCoordsToBounds(t);return ht(this.options.bounds).overlaps(c)},_keyToBounds:function(t){return this._tileCoordsToBounds(this._keyToTileCoords(t))},_tileCoordsToNwSe:function(t){var e=this._map,s=this.getTileSize(),c=t.scaleBy(s),d=c.add(s),g=e.unproject(c,t.z),w=e.unproject(d,t.z);return[g,w]},_tileCoordsToBounds:function(t){var e=this._tileCoordsToNwSe(t),s=new It(e[0],e[1]);return this.options.noWrap||(s=this._map.wrapLatLngBounds(s)),s},_tileCoordsToKey:function(t){return t.x+":"+t.y+":"+t.z},_keyToTileCoords:function(t){var e=t.split(":"),s=new F(+e[0],+e[1]);return s.z=+e[2],s},_removeTile:function(t){var e=this._tiles[t];e&&(st(e.el),delete this._tiles[t],this.fire("tileunload",{tile:e.el,coords:this._keyToTileCoords(t)}))},_initTile:function(t){V(t,"leaflet-tile");var e=this.getTileSize();t.style.width=e.x+"px",t.style.height=e.y+"px",t.onselectstart=p,t.onmousemove=p,A.ielt9&&this.options.opacity<1&&Zt(t,this.options.opacity)},_addTile:function(t,e){var s=this._getTilePos(t),c=this._tileCoordsToKey(t),d=this.createTile(this._wrapCoords(t),o(this._tileReady,this,t));this._initTile(d),this.createTile.length<2&&Q(o(this._tileReady,this,t,null,d)),ct(d,s),this._tiles[c]={el:d,coords:t,current:!0},e.appendChild(d),this.fire("tileloadstart",{tile:d,coords:t})},_tileReady:function(t,e,s){e&&this.fire("tileerror",{error:e,tile:s,coords:t});var c=this._tileCoordsToKey(t);s=this._tiles[c],s&&(s.loaded=+new Date,this._map._fadeAnimated?(Zt(s.el,0),ot(this._fadeFrame),this._fadeFrame=Q(this._updateOpacity,this)):(s.active=!0,this._pruneTiles()),e||(V(s.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:s.el,coords:t})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),A.ielt9||!this._map._fadeAnimated?Q(this._pruneTiles,this):setTimeout(o(this._pruneTiles,this),250)))},_getTilePos:function(t){return t.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(t){var e=new F(this._wrapX?_(t.x,this._wrapX):t.x,this._wrapY?_(t.y,this._wrapY):t.y);return e.z=t.z,e},_pxBoundsToTileRange:function(t){var e=this.getTileSize();return new it(t.min.unscaleBy(e).floor(),t.max.unscaleBy(e).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var t in this._tiles)if(!this._tiles[t].loaded)return!1;return!0}});function Bu(t){return new wi(t)}var Xe=wi.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(t,e){this._url=t,e=y(this,e),e.detectRetina&&A.retina&&e.maxZoom>0?(e.tileSize=Math.floor(e.tileSize/2),e.zoomReverse?(e.zoomOffset--,e.minZoom=Math.min(e.maxZoom,e.minZoom+1)):(e.zoomOffset++,e.maxZoom=Math.max(e.minZoom,e.maxZoom-1)),e.minZoom=Math.max(0,e.minZoom)):e.zoomReverse?e.minZoom=Math.min(e.maxZoom,e.minZoom):e.maxZoom=Math.max(e.minZoom,e.maxZoom),typeof e.subdomains=="string"&&(e.subdomains=e.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(t,e){return this._url===t&&e===void 0&&(e=!0),this._url=t,e||this.redraw(),this},createTile:function(t,e){var s=document.createElement("img");return G(s,"load",o(this._tileOnLoad,this,e,s)),G(s,"error",o(this._tileOnError,this,e,s)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(s.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(s.referrerPolicy=this.options.referrerPolicy),s.alt="",s.src=this.getTileUrl(t),s},getTileUrl:function(t){var e={r:A.retina?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var s=this._globalTileRange.max.y-t.y;this.options.tms&&(e.y=s),e["-y"]=s}return C(this._url,n(e,this.options))},_tileOnLoad:function(t,e){A.ielt9?setTimeout(o(t,this,null,e),0):t(null,e)},_tileOnError:function(t,e,s){var c=this.options.errorTileUrl;c&&e.getAttribute("src")!==c&&(e.src=c),t(s,e)},_onTileRemove:function(t){t.tile.onload=null},_getZoomForUrl:function(){var t=this._tileZoom,e=this.options.maxZoom,s=this.options.zoomReverse,c=this.options.zoomOffset;return s&&(t=e-t),t+c},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_abortLoading:function(){var t,e;for(t in this._tiles)if(this._tiles[t].coords.z!==this._tileZoom&&(e=this._tiles[t].el,e.onload=p,e.onerror=p,!e.complete)){e.src=D;var s=this._tiles[t].coords;st(e),delete this._tiles[t],this.fire("tileabort",{tile:e,coords:s})}},_removeTile:function(t){var e=this._tiles[t];if(e)return e.el.setAttribute("src",D),wi.prototype._removeTile.call(this,t)},_tileReady:function(t,e,s){if(!(!this._map||s&&s.getAttribute("src")===D))return wi.prototype._tileReady.call(this,t,e,s)}});function fs(t,e){return new Xe(t,e)}var ms=Xe.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(t,e){this._url=t;var s=n({},this.defaultWmsParams);for(var c in e)c in this.options||(s[c]=e[c]);e=y(this,e);var d=e.detectRetina&&A.retina?2:1,g=this.getTileSize();s.width=g.x*d,s.height=g.y*d,this.wmsParams=s},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var e=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[e]=this._crs.code,Xe.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._tileCoordsToNwSe(t),s=this._crs,c=vt(s.project(e[0]),s.project(e[1])),d=c.min,g=c.max,w=(this._wmsVersion>=1.3&&this._crs===ss?[d.y,d.x,g.y,g.x]:[d.x,d.y,g.x,g.y]).join(","),b=Xe.prototype.getTileUrl.call(this,t);return b+M(this.wmsParams,b,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+w},setParams:function(t,e){return n(this.wmsParams,t),e||this.redraw(),this}});function Zu(t,e){return new ms(t,e)}Xe.WMS=ms,fs.wms=Zu;var se=qt.extend({options:{padding:.1},initialize:function(t){y(this,t),u(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),V(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var t={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},_onAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,e){var s=this._map.getZoomScale(e,this._zoom),c=this._map.getSize().multiplyBy(.5+this.options.padding),d=this._map.project(this._center,e),g=c.multiplyBy(-s).add(d).subtract(this._map._getNewPixelOrigin(t,e));A.any3d?we(this._container,g,s):ct(this._container,g)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var t in this._layers)this._layers[t]._reset()},_onZoomEnd:function(){for(var t in this._layers)this._layers[t]._project()},_updatePaths:function(){for(var t in this._layers)this._layers[t]._update()},_update:function(){var t=this.options.padding,e=this._map.getSize(),s=this._map.containerPointToLayerPoint(e.multiplyBy(-t)).round();this._bounds=new it(s,s.add(e.multiplyBy(1+t*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),ps=se.extend({options:{tolerance:0},getEvents:function(){var t=se.prototype.getEvents.call(this);return t.viewprereset=this._onViewPreReset,t},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){se.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var t=this._container=document.createElement("canvas");G(t,"mousemove",this._onMouseMove,this),G(t,"click dblclick mousedown mouseup contextmenu",this._onClick,this),G(t,"mouseout",this._handleMouseOut,this),t._leaflet_disable_events=!0,this._ctx=t.getContext("2d")},_destroyContainer:function(){ot(this._redrawRequest),delete this._ctx,st(this._container),nt(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var t;this._redrawBounds=null;for(var e in this._layers)t=this._layers[e],t._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){se.prototype._update.call(this);var t=this._bounds,e=this._container,s=t.getSize(),c=A.retina?2:1;ct(e,t.min),e.width=c*s.x,e.height=c*s.y,e.style.width=s.x+"px",e.style.height=s.y+"px",A.retina&&this._ctx.scale(2,2),this._ctx.translate(-t.min.x,-t.min.y),this.fire("update")}},_reset:function(){se.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(t){this._updateDashArray(t),this._layers[u(t)]=t;var e=t._order={layer:t,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=e),this._drawLast=e,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(t){this._requestRedraw(t)},_removePath:function(t){var e=t._order,s=e.next,c=e.prev;s?s.prev=c:this._drawLast=c,c?c.next=s:this._drawFirst=s,delete t._order,delete this._layers[u(t)],this._requestRedraw(t)},_updatePath:function(t){this._extendRedrawBounds(t),t._project(),t._update(),this._requestRedraw(t)},_updateStyle:function(t){this._updateDashArray(t),this._requestRedraw(t)},_updateDashArray:function(t){if(typeof t.options.dashArray=="string"){var e=t.options.dashArray.split(/[, ]+/),s=[],c,d;for(d=0;d<e.length;d++){if(c=Number(e[d]),isNaN(c))return;s.push(c)}t.options._dashArray=s}else t.options._dashArray=t.options.dashArray},_requestRedraw:function(t){this._map&&(this._extendRedrawBounds(t),this._redrawRequest=this._redrawRequest||Q(this._redraw,this))},_extendRedrawBounds:function(t){if(t._pxBounds){var e=(t.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new it,this._redrawBounds.extend(t._pxBounds.min.subtract([e,e])),this._redrawBounds.extend(t._pxBounds.max.add([e,e]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var t=this._redrawBounds;if(t){var e=t.getSize();this._ctx.clearRect(t.min.x,t.min.y,e.x,e.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var t,e=this._redrawBounds;if(this._ctx.save(),e){var s=e.getSize();this._ctx.beginPath(),this._ctx.rect(e.min.x,e.min.y,s.x,s.y),this._ctx.clip()}this._drawing=!0;for(var c=this._drawFirst;c;c=c.next)t=c.layer,(!e||t._pxBounds&&t._pxBounds.intersects(e))&&t._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(t,e){if(this._drawing){var s,c,d,g,w=t._parts,b=w.length,E=this._ctx;if(b){for(E.beginPath(),s=0;s<b;s++){for(c=0,d=w[s].length;c<d;c++)g=w[s][c],E[c?"lineTo":"moveTo"](g.x,g.y);e&&E.closePath()}this._fillStroke(E,t)}}},_updateCircle:function(t){if(!(!this._drawing||t._empty())){var e=t._point,s=this._ctx,c=Math.max(Math.round(t._radius),1),d=(Math.max(Math.round(t._radiusY),1)||c)/c;d!==1&&(s.save(),s.scale(1,d)),s.beginPath(),s.arc(e.x,e.y/d,c,0,Math.PI*2,!1),d!==1&&s.restore(),this._fillStroke(s,t)}},_fillStroke:function(t,e){var s=e.options;s.fill&&(t.globalAlpha=s.fillOpacity,t.fillStyle=s.fillColor||s.color,t.fill(s.fillRule||"evenodd")),s.stroke&&s.weight!==0&&(t.setLineDash&&t.setLineDash(e.options&&e.options._dashArray||[]),t.globalAlpha=s.opacity,t.lineWidth=s.weight,t.strokeStyle=s.color,t.lineCap=s.lineCap,t.lineJoin=s.lineJoin,t.stroke())},_onClick:function(t){for(var e=this._map.mouseEventToLayerPoint(t),s,c,d=this._drawFirst;d;d=d.next)s=d.layer,s.options.interactive&&s._containsPoint(e)&&(!(t.type==="click"||t.type==="preclick")||!this._map._draggableMoved(s))&&(c=s);this._fireEvent(c?[c]:!1,t)},_onMouseMove:function(t){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var e=this._map.mouseEventToLayerPoint(t);this._handleMouseHover(t,e)}},_handleMouseOut:function(t){var e=this._hoveredLayer;e&&(lt(this._container,"leaflet-interactive"),this._fireEvent([e],t,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(t,e){if(!this._mouseHoverThrottled){for(var s,c,d=this._drawFirst;d;d=d.next)s=d.layer,s.options.interactive&&s._containsPoint(e)&&(c=s);c!==this._hoveredLayer&&(this._handleMouseOut(t),c&&(V(this._container,"leaflet-interactive"),this._fireEvent([c],t,"mouseover"),this._hoveredLayer=c)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,t),this._mouseHoverThrottled=!0,setTimeout(o(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(t,e,s){this._map._fireDOMEvent(e,s||e.type,t)},_bringToFront:function(t){var e=t._order;if(e){var s=e.next,c=e.prev;if(s)s.prev=c;else return;c?c.next=s:s&&(this._drawFirst=s),e.prev=this._drawLast,this._drawLast.next=e,e.next=null,this._drawLast=e,this._requestRedraw(t)}},_bringToBack:function(t){var e=t._order;if(e){var s=e.next,c=e.prev;if(c)c.next=s;else return;s?s.prev=c:c&&(this._drawLast=c),e.prev=null,e.next=this._drawFirst,this._drawFirst.prev=e,this._drawFirst=e,this._requestRedraw(t)}}});function gs(t){return A.canvas?new ps(t):null}var bi=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return document.createElement("<lvml:"+t+' class="lvml">')}}catch{}return function(t){return document.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),Fu={_initContainer:function(){this._container=Y("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(se.prototype._update.call(this),this.fire("update"))},_initPath:function(t){var e=t._container=bi("shape");V(e,"leaflet-vml-shape "+(this.options.className||"")),e.coordsize="1 1",t._path=bi("path"),e.appendChild(t._path),this._updateStyle(t),this._layers[u(t)]=t},_addPath:function(t){var e=t._container;this._container.appendChild(e),t.options.interactive&&t.addInteractiveTarget(e)},_removePath:function(t){var e=t._container;st(e),t.removeInteractiveTarget(e),delete this._layers[u(t)]},_updateStyle:function(t){var e=t._stroke,s=t._fill,c=t.options,d=t._container;d.stroked=!!c.stroke,d.filled=!!c.fill,c.stroke?(e||(e=t._stroke=bi("stroke")),d.appendChild(e),e.weight=c.weight+"px",e.color=c.color,e.opacity=c.opacity,c.dashArray?e.dashStyle=k(c.dashArray)?c.dashArray.join(" "):c.dashArray.replace(/( *, *)/g," "):e.dashStyle="",e.endcap=c.lineCap.replace("butt","flat"),e.joinstyle=c.lineJoin):e&&(d.removeChild(e),t._stroke=null),c.fill?(s||(s=t._fill=bi("fill")),d.appendChild(s),s.color=c.fillColor||c.color,s.opacity=c.fillOpacity):s&&(d.removeChild(s),t._fill=null)},_updateCircle:function(t){var e=t._point.round(),s=Math.round(t._radius),c=Math.round(t._radiusY||s);this._setPath(t,t._empty()?"M0 0":"AL "+e.x+","+e.y+" "+s+","+c+" 0,"+65535*360)},_setPath:function(t,e){t._path.v=e},_bringToFront:function(t){Ve(t._container)},_bringToBack:function(t){je(t._container)}},dn=A.vml?bi:wo,xi=se.extend({_initContainer:function(){this._container=dn("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=dn("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){st(this._container),nt(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){se.prototype._update.call(this);var t=this._bounds,e=t.getSize(),s=this._container;(!this._svgSize||!this._svgSize.equals(e))&&(this._svgSize=e,s.setAttribute("width",e.x),s.setAttribute("height",e.y)),ct(s,t.min),s.setAttribute("viewBox",[t.min.x,t.min.y,e.x,e.y].join(" ")),this.fire("update")}},_initPath:function(t){var e=t._path=dn("path");t.options.className&&V(e,t.options.className),t.options.interactive&&V(e,"leaflet-interactive"),this._updateStyle(t),this._layers[u(t)]=t},_addPath:function(t){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(t._path),t.addInteractiveTarget(t._path)},_removePath:function(t){st(t._path),t.removeInteractiveTarget(t._path),delete this._layers[u(t)]},_updatePath:function(t){t._project(),t._update()},_updateStyle:function(t){var e=t._path,s=t.options;e&&(s.stroke?(e.setAttribute("stroke",s.color),e.setAttribute("stroke-opacity",s.opacity),e.setAttribute("stroke-width",s.weight),e.setAttribute("stroke-linecap",s.lineCap),e.setAttribute("stroke-linejoin",s.lineJoin),s.dashArray?e.setAttribute("stroke-dasharray",s.dashArray):e.removeAttribute("stroke-dasharray"),s.dashOffset?e.setAttribute("stroke-dashoffset",s.dashOffset):e.removeAttribute("stroke-dashoffset")):e.setAttribute("stroke","none"),s.fill?(e.setAttribute("fill",s.fillColor||s.color),e.setAttribute("fill-opacity",s.fillOpacity),e.setAttribute("fill-rule",s.fillRule||"evenodd")):e.setAttribute("fill","none"))},_updatePoly:function(t,e){this._setPath(t,bo(t._parts,e))},_updateCircle:function(t){var e=t._point,s=Math.max(Math.round(t._radius),1),c=Math.max(Math.round(t._radiusY),1)||s,d="a"+s+","+c+" 0 1,0 ",g=t._empty()?"M0 0":"M"+(e.x-s)+","+e.y+d+s*2+",0 "+d+-s*2+",0 ";this._setPath(t,g)},_setPath:function(t,e){t._path.setAttribute("d",e)},_bringToFront:function(t){Ve(t._path)},_bringToBack:function(t){je(t._path)}});A.vml&&xi.include(Fu);function _s(t){return A.svg||A.vml?new xi(t):null}W.include({getRenderer:function(t){var e=t.options.renderer||this._getPaneRenderer(t.options.pane)||this.options.renderer||this._renderer;return e||(e=this._renderer=this._createRenderer()),this.hasLayer(e)||this.addLayer(e),e},_getPaneRenderer:function(t){if(t==="overlayPane"||t===void 0)return!1;var e=this._paneRenderers[t];return e===void 0&&(e=this._createRenderer({pane:t}),this._paneRenderers[t]=e),e},_createRenderer:function(t){return this.options.preferCanvas&&gs(t)||_s(t)}});var vs=We.extend({initialize:function(t,e){We.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){return this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return t=ht(t),[t.getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}});function $u(t,e){return new vs(t,e)}xi.create=dn,xi.pointsToPath=bo,oe.geometryToLayer=on,oe.coordsToLatLng=Tr,oe.coordsToLatLngs=sn,oe.latLngToCoords=Ir,oe.latLngsToCoords=an,oe.getFeature=qe,oe.asFeature=ln,W.mergeOptions({boxZoom:!0});var ys=Jt.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane,this._resetStateTimeout=0,t.on("unload",this._destroy,this)},addHooks:function(){G(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){nt(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){st(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(t){if(!t.shiftKey||t.which!==1&&t.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),fi(),fr(),this._startPoint=this._map.mouseEventToContainerPoint(t),G(document,{contextmenu:Le,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(t){this._moved||(this._moved=!0,this._box=Y("div","leaflet-zoom-box",this._container),V(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(t);var e=new it(this._point,this._startPoint),s=e.getSize();ct(this._box,e.min),this._box.style.width=s.x+"px",this._box.style.height=s.y+"px"},_finish:function(){this._moved&&(st(this._box),lt(this._container,"leaflet-crosshair")),mi(),mr(),nt(document,{contextmenu:Le,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(t){if(!(t.which!==1&&t.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(o(this._resetState,this),0);var e=new It(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(e).fire("boxzoomend",{boxZoomBounds:e})}},_onKeyDown:function(t){t.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});W.addInitHook("addHandler","boxZoom",ys),W.mergeOptions({doubleClickZoom:!0});var ws=Jt.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var e=this._map,s=e.getZoom(),c=e.options.zoomDelta,d=t.originalEvent.shiftKey?s-c:s+c;e.options.doubleClickZoom==="center"?e.setZoom(d):e.setZoomAround(t.containerPoint,d)}});W.addInitHook("addHandler","doubleClickZoom",ws),W.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var bs=Jt.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new ue(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),t.on("zoomend",this._onZoomEnd,this),t.whenReady(this._onZoomEnd,this))}V(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){lt(this._map._container,"leaflet-grab"),lt(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var t=this._map;if(t._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var e=ht(this._map.options.maxBounds);this._offsetLimit=vt(this._map.latLngToContainerPoint(e.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(e.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(t){if(this._map.options.inertia){var e=this._lastTime=+new Date,s=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(s),this._times.push(e),this._prunePositions(e)}this._map.fire("move",t).fire("drag",t)},_prunePositions:function(t){for(;this._positions.length>1&&t-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var t=this._map.getSize().divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(t,e){return t-(t-e)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var t=this._draggable._newPos.subtract(this._draggable._startPos),e=this._offsetLimit;t.x<e.min.x&&(t.x=this._viscousLimit(t.x,e.min.x)),t.y<e.min.y&&(t.y=this._viscousLimit(t.y,e.min.y)),t.x>e.max.x&&(t.x=this._viscousLimit(t.x,e.max.x)),t.y>e.max.y&&(t.y=this._viscousLimit(t.y,e.max.y)),this._draggable._newPos=this._draggable._startPos.add(t)}},_onPreDragWrap:function(){var t=this._worldWidth,e=Math.round(t/2),s=this._initialWorldOffset,c=this._draggable._newPos.x,d=(c-e+s)%t+e-s,g=(c+e+s)%t-e-s,w=Math.abs(d+s)<Math.abs(g+s)?d:g;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=w},_onDragEnd:function(t){var e=this._map,s=e.options,c=!s.inertia||t.noInertia||this._times.length<2;if(e.fire("dragend",t),c)e.fire("moveend");else{this._prunePositions(+new Date);var d=this._lastPos.subtract(this._positions[0]),g=(this._lastTime-this._times[0])/1e3,w=s.easeLinearity,b=d.multiplyBy(w/g),E=b.distanceTo([0,0]),P=Math.min(s.inertiaMaxSpeed,E),I=b.multiplyBy(P/E),B=P/(s.inertiaDeceleration*w),j=I.multiplyBy(-B/2).round();!j.x&&!j.y?e.fire("moveend"):(j=e._limitOffset(j,e.options.maxBounds),Q(function(){e.panBy(j,{duration:B,easeLinearity:w,noMoveStart:!0,animate:!0})}))}}});W.addInitHook("addHandler","dragging",bs),W.mergeOptions({keyboard:!0,keyboardPanDelta:80});var xs=Jt.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(t){this._map=t,this._setPanDelta(t.options.keyboardPanDelta),this._setZoomDelta(t.options.zoomDelta)},addHooks:function(){var t=this._map._container;t.tabIndex<=0&&(t.tabIndex="0"),G(t,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),nt(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var t=document.body,e=document.documentElement,s=t.scrollTop||e.scrollTop,c=t.scrollLeft||e.scrollLeft;this._map._container.focus(),window.scrollTo(c,s)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(t){var e=this._panKeys={},s=this.keyCodes,c,d;for(c=0,d=s.left.length;c<d;c++)e[s.left[c]]=[-1*t,0];for(c=0,d=s.right.length;c<d;c++)e[s.right[c]]=[t,0];for(c=0,d=s.down.length;c<d;c++)e[s.down[c]]=[0,t];for(c=0,d=s.up.length;c<d;c++)e[s.up[c]]=[0,-1*t]},_setZoomDelta:function(t){var e=this._zoomKeys={},s=this.keyCodes,c,d;for(c=0,d=s.zoomIn.length;c<d;c++)e[s.zoomIn[c]]=t;for(c=0,d=s.zoomOut.length;c<d;c++)e[s.zoomOut[c]]=-t},_addHooks:function(){G(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){nt(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e=t.keyCode,s=this._map,c;if(e in this._panKeys){if(!s._panAnim||!s._panAnim._inProgress)if(c=this._panKeys[e],t.shiftKey&&(c=$(c).multiplyBy(3)),s.options.maxBounds&&(c=s._limitOffset($(c),s.options.maxBounds)),s.options.worldCopyJump){var d=s.wrapLatLng(s.unproject(s.project(s.getCenter()).add(c)));s.panTo(d)}else s.panBy(c)}else if(e in this._zoomKeys)s.setZoom(s.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[e]);else if(e===27&&s._popup&&s._popup.options.closeOnEscapeKey)s.closePopup();else return;Le(t)}}});W.addInitHook("addHandler","keyboard",xs),W.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Ls=Jt.extend({addHooks:function(){G(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){nt(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(t){var e=Wo(t),s=this._map.options.wheelDebounceTime;this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var c=Math.max(s-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(o(this._performZoom,this),c),Le(t)},_performZoom:function(){var t=this._map,e=t.getZoom(),s=this._map.options.zoomSnap||0;t._stop();var c=this._delta/(this._map.options.wheelPxPerZoomLevel*4),d=4*Math.log(2/(1+Math.exp(-Math.abs(c))))/Math.LN2,g=s?Math.ceil(d/s)*s:d,w=t._limitZoom(e+(this._delta>0?g:-g))-e;this._delta=0,this._startTime=null,w&&(t.options.scrollWheelZoom==="center"?t.setZoom(e+w):t.setZoomAround(this._lastMousePos,e+w))}});W.addInitHook("addHandler","scrollWheelZoom",Ls);var Gu=600;W.mergeOptions({tapHold:A.touchNative&&A.safari&&A.mobile,tapTolerance:15});var Es=Jt.extend({addHooks:function(){G(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){nt(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(clearTimeout(this._holdTimeout),t.touches.length===1){var e=t.touches[0];this._startPos=this._newPos=new F(e.clientX,e.clientY),this._holdTimeout=setTimeout(o(function(){this._cancel(),this._isTapValid()&&(G(document,"touchend",Lt),G(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",e))},this),Gu),G(document,"touchend touchcancel contextmenu",this._cancel,this),G(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function t(){nt(document,"touchend",Lt),nt(document,"touchend touchcancel",t)},_cancel:function(){clearTimeout(this._holdTimeout),nt(document,"touchend touchcancel contextmenu",this._cancel,this),nt(document,"touchmove",this._onMove,this)},_onMove:function(t){var e=t.touches[0];this._newPos=new F(e.clientX,e.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(t,e){var s=new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY});s._simulated=!0,e.target.dispatchEvent(s)}});W.addInitHook("addHandler","tapHold",Es),W.mergeOptions({touchZoom:A.touch,bounceAtZoomLimits:!0});var Ms=Jt.extend({addHooks:function(){V(this._map._container,"leaflet-touch-zoom"),G(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){lt(this._map._container,"leaflet-touch-zoom"),nt(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var e=this._map;if(!(!t.touches||t.touches.length!==2||e._animatingZoom||this._zooming)){var s=e.mouseEventToContainerPoint(t.touches[0]),c=e.mouseEventToContainerPoint(t.touches[1]);this._centerPoint=e.getSize()._divideBy(2),this._startLatLng=e.containerPointToLatLng(this._centerPoint),e.options.touchZoom!=="center"&&(this._pinchStartLatLng=e.containerPointToLatLng(s.add(c)._divideBy(2))),this._startDist=s.distanceTo(c),this._startZoom=e.getZoom(),this._moved=!1,this._zooming=!0,e._stop(),G(document,"touchmove",this._onTouchMove,this),G(document,"touchend touchcancel",this._onTouchEnd,this),Lt(t)}},_onTouchMove:function(t){if(!(!t.touches||t.touches.length!==2||!this._zooming)){var e=this._map,s=e.mouseEventToContainerPoint(t.touches[0]),c=e.mouseEventToContainerPoint(t.touches[1]),d=s.distanceTo(c)/this._startDist;if(this._zoom=e.getScaleZoom(d,this._startZoom),!e.options.bounceAtZoomLimits&&(this._zoom<e.getMinZoom()&&d<1||this._zoom>e.getMaxZoom()&&d>1)&&(this._zoom=e._limitZoom(this._zoom)),e.options.touchZoom==="center"){if(this._center=this._startLatLng,d===1)return}else{var g=s._add(c)._divideBy(2)._subtract(this._centerPoint);if(d===1&&g.x===0&&g.y===0)return;this._center=e.unproject(e.project(this._pinchStartLatLng,this._zoom).subtract(g),this._zoom)}this._moved||(e._moveStart(!0,!1),this._moved=!0),ot(this._animRequest);var w=o(e._move,e,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=Q(w,this,!0),Lt(t)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,ot(this._animRequest),nt(document,"touchmove",this._onTouchMove,this),nt(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});W.addInitHook("addHandler","touchZoom",Ms),W.BoxZoom=ys,W.DoubleClickZoom=ws,W.Drag=bs,W.Keyboard=xs,W.ScrollWheelZoom=Ls,W.TapHold=Es,W.TouchZoom=Ms,i.Bounds=it,i.Browser=A,i.CRS=ie,i.Canvas=ps,i.Circle=Pr,i.CircleMarker=rn,i.Class=Bt,i.Control=Wt,i.DivIcon=ds,i.DivOverlay=te,i.DomEvent=su,i.DomUtil=ru,i.Draggable=ue,i.Evented=ye,i.FeatureGroup=ne,i.GeoJSON=oe,i.GridLayer=wi,i.Handler=Jt,i.Icon=He,i.ImageOverlay=hn,i.LatLng=tt,i.LatLngBounds=It,i.Layer=qt,i.LayerGroup=Ue,i.LineUtil=yu,i.Map=W,i.Marker=nn,i.Mixin=fu,i.Path=de,i.Point=F,i.PolyUtil=mu,i.Polygon=We,i.Polyline=re,i.Popup=cn,i.PosAnimation=qo,i.Projection=wu,i.Rectangle=vs,i.Renderer=se,i.SVG=xi,i.SVGOverlay=us,i.TileLayer=Xe,i.Tooltip=un,i.Transformation=er,i.Util=Nt,i.VideoOverlay=cs,i.bind=o,i.bounds=vt,i.canvas=gs,i.circle=ku,i.circleMarker=Su,i.control=_i,i.divIcon=Nu,i.extend=n,i.featureGroup=Eu,i.geoJSON=hs,i.geoJson=Iu,i.gridLayer=Bu,i.icon=Mu,i.imageOverlay=Ou,i.latLng=H,i.latLngBounds=ht,i.layerGroup=Lu,i.map=au,i.marker=Cu,i.point=$,i.polygon=Tu,i.polyline=Pu,i.popup=zu,i.rectangle=$u,i.setOptions=y,i.stamp=u,i.svg=_s,i.svgOverlay=Du,i.tileLayer=fs,i.tooltip=Ru,i.transformation=hi,i.version=a,i.videoOverlay=Au;var Vu=window.L;i.noConflict=function(){return window.L=Vu,this},window.L=i})});var ol=Dr((Mn,rl)=>{"use strict";(function(i,a){typeof Mn=="object"&&typeof rl<"u"?a(Mn):typeof define=="function"&&define.amd?define(["exports"],a):(i=i||self,a((i.Leaflet=i.Leaflet||{},i.Leaflet.markercluster={})))})(Mn,function(i){"use strict";var a=L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,clusterPane:L.Marker.prototype.options.pane,spiderfyOnEveryZoom:!1,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,removeOutsideVisibleBounds:!0,animate:!0,animateAddingMarkers:!1,spiderfyShapePositions:null,spiderfyDistanceMultiplier:1,spiderLegPolylineOptions:{weight:1.5,color:"#222",opacity:.5},chunkedLoading:!1,chunkInterval:200,chunkDelay:50,chunkProgress:null,polygonOptions:{}},initialize:function(r){L.Util.setOptions(this,r),this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction),this._featureGroup=L.featureGroup(),this._featureGroup.addEventParent(this),this._nonPointGroup=L.featureGroup(),this._nonPointGroup.addEventParent(this),this._inZoomAnimation=0,this._needsClustering=[],this._needsRemoving=[],this._currentShownBounds=null,this._queue=[],this._childMarkerEventHandlers={dragstart:this._childMarkerDragStart,move:this._childMarkerMoved,dragend:this._childMarkerDragEnd};var o=L.DomUtil.TRANSITION&&this.options.animate;L.extend(this,o?this._withAnimation:this._noAnimation),this._markerCluster=o?L.MarkerCluster:L.MarkerClusterNonAnimated},addLayer:function(r){if(r instanceof L.LayerGroup)return this.addLayers([r]);if(!r.getLatLng)return this._nonPointGroup.addLayer(r),this.fire("layeradd",{layer:r}),this;if(!this._map)return this._needsClustering.push(r),this.fire("layeradd",{layer:r}),this;if(this.hasLayer(r))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(r,this._maxZoom),this.fire("layeradd",{layer:r}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons();var o=r,h=this._zoom;if(r.__parent)for(;o.__parent._zoom>=h;)o=o.__parent;return this._currentShownBounds.contains(o.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(r,o):this._animationAddLayerNonAnimated(r,o)),this},removeLayer:function(r){return r instanceof L.LayerGroup?this.removeLayers([r]):r.getLatLng?this._map?r.__parent?(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(r)),this._removeLayer(r,!0),this.fire("layerremove",{layer:r}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),r.off(this._childMarkerEventHandlers,this),this._featureGroup.hasLayer(r)&&(this._featureGroup.removeLayer(r),r.clusterShow&&r.clusterShow()),this):this:(!this._arraySplice(this._needsClustering,r)&&this.hasLayer(r)&&this._needsRemoving.push({layer:r,latlng:r._latlng}),this.fire("layerremove",{layer:r}),this):(this._nonPointGroup.removeLayer(r),this.fire("layerremove",{layer:r}),this)},addLayers:function(r,o){if(!L.Util.isArray(r))return this.addLayer(r);var h=this._featureGroup,u=this._nonPointGroup,f=this.options.chunkedLoading,_=this.options.chunkInterval,p=this.options.chunkProgress,l=r.length,m=0,v=!0,y;if(this._map){var M=new Date().getTime(),x=L.bind(function(){var k=new Date().getTime();for(this._map&&this._unspiderfy&&this._unspiderfy();m<l;m++){if(f&&m%200===0){var T=new Date().getTime()-k;if(T>_)break}if(y=r[m],y instanceof L.LayerGroup){v&&(r=r.slice(),v=!1),this._extractNonGroupLayers(y,r),l=r.length;continue}if(!y.getLatLng){u.addLayer(y),o||this.fire("layeradd",{layer:y});continue}if(!this.hasLayer(y)&&(this._addLayer(y,this._maxZoom),o||this.fire("layeradd",{layer:y}),y.__parent&&y.__parent.getChildCount()===2)){var D=y.__parent.getAllChildMarkers(),S=D[0]===y?D[1]:D[0];h.removeLayer(S)}}p&&p(m,l,new Date().getTime()-M),m===l?(this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)):setTimeout(x,this.options.chunkDelay)},this);x()}else for(var C=this._needsClustering;m<l;m++){if(y=r[m],y instanceof L.LayerGroup){v&&(r=r.slice(),v=!1),this._extractNonGroupLayers(y,r),l=r.length;continue}if(!y.getLatLng){u.addLayer(y);continue}this.hasLayer(y)||C.push(y)}return this},removeLayers:function(r){var o,h,u=r.length,f=this._featureGroup,_=this._nonPointGroup,p=!0;if(!this._map){for(o=0;o<u;o++){if(h=r[o],h instanceof L.LayerGroup){p&&(r=r.slice(),p=!1),this._extractNonGroupLayers(h,r),u=r.length;continue}this._arraySplice(this._needsClustering,h),_.removeLayer(h),this.hasLayer(h)&&this._needsRemoving.push({layer:h,latlng:h._latlng}),this.fire("layerremove",{layer:h})}return this}if(this._unspiderfy){this._unspiderfy();var l=r.slice(),m=u;for(o=0;o<m;o++){if(h=l[o],h instanceof L.LayerGroup){this._extractNonGroupLayers(h,l),m=l.length;continue}this._unspiderfyLayer(h)}}for(o=0;o<u;o++){if(h=r[o],h instanceof L.LayerGroup){p&&(r=r.slice(),p=!1),this._extractNonGroupLayers(h,r),u=r.length;continue}if(!h.__parent){_.removeLayer(h),this.fire("layerremove",{layer:h});continue}this._removeLayer(h,!0,!0),this.fire("layerremove",{layer:h}),f.hasLayer(h)&&(f.removeLayer(h),h.clusterShow&&h.clusterShow())}return this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),this},clearLayers:function(){return this._map||(this._needsClustering=[],this._needsRemoving=[],delete this._gridClusters,delete this._gridUnclustered),this._noanimationUnspiderfy&&this._noanimationUnspiderfy(),this._featureGroup.clearLayers(),this._nonPointGroup.clearLayers(),this.eachLayer(function(r){r.off(this._childMarkerEventHandlers,this),delete r.__parent},this),this._map&&this._generateInitialClusters(),this},getBounds:function(){var r=new L.LatLngBounds;this._topClusterLevel&&r.extend(this._topClusterLevel._bounds);for(var o=this._needsClustering.length-1;o>=0;o--)r.extend(this._needsClustering[o].getLatLng());return r.extend(this._nonPointGroup.getBounds()),r},eachLayer:function(r,o){var h=this._needsClustering.slice(),u=this._needsRemoving,f,_,p;for(this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(h),_=h.length-1;_>=0;_--){for(f=!0,p=u.length-1;p>=0;p--)if(u[p].layer===h[_]){f=!1;break}f&&r.call(o,h[_])}this._nonPointGroup.eachLayer(r,o)},getLayers:function(){var r=[];return this.eachLayer(function(o){r.push(o)}),r},getLayer:function(r){var o=null;return r=parseInt(r,10),this.eachLayer(function(h){L.stamp(h)===r&&(o=h)}),o},hasLayer:function(r){if(!r)return!1;var o,h=this._needsClustering;for(o=h.length-1;o>=0;o--)if(h[o]===r)return!0;for(h=this._needsRemoving,o=h.length-1;o>=0;o--)if(h[o].layer===r)return!1;return!!(r.__parent&&r.__parent._group===this)||this._nonPointGroup.hasLayer(r)},zoomToShowLayer:function(r,o){var h=this._map;typeof o!="function"&&(o=function(){});var u=function(){(h.hasLayer(r)||h.hasLayer(r.__parent))&&!this._inZoomAnimation&&(this._map.off("moveend",u,this),this.off("animationend",u,this),h.hasLayer(r)?o():r.__parent._icon&&(this.once("spiderfied",o,this),r.__parent.spiderfy()))};r._icon&&this._map.getBounds().contains(r.getLatLng())?o():r.__parent._zoom<Math.round(this._map._zoom)?(this._map.on("moveend",u,this),this._map.panTo(r.getLatLng())):(this._map.on("moveend",u,this),this.on("animationend",u,this),r.__parent.zoomToBounds())},onAdd:function(r){this._map=r;var o,h,u;if(!isFinite(this._map.getMaxZoom()))throw"Map has no maxZoom specified";for(this._featureGroup.addTo(r),this._nonPointGroup.addTo(r),this._gridClusters||this._generateInitialClusters(),this._maxLat=r.options.crs.projection.MAX_LATITUDE,o=0,h=this._needsRemoving.length;o<h;o++)u=this._needsRemoving[o],u.newlatlng=u.layer._latlng,u.layer._latlng=u.latlng;for(o=0,h=this._needsRemoving.length;o<h;o++)u=this._needsRemoving[o],this._removeLayer(u.layer,!0),u.layer._latlng=u.newlatlng;this._needsRemoving=[],this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds(),this._map.on("zoomend",this._zoomEnd,this),this._map.on("moveend",this._moveEnd,this),this._spiderfierOnAdd&&this._spiderfierOnAdd(),this._bindEvents(),h=this._needsClustering,this._needsClustering=[],this.addLayers(h,!0)},onRemove:function(r){r.off("zoomend",this._zoomEnd,this),r.off("moveend",this._moveEnd,this),this._unbindEvents(),this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim",""),this._spiderfierOnRemove&&this._spiderfierOnRemove(),delete this._maxLat,this._hideCoverage(),this._featureGroup.remove(),this._nonPointGroup.remove(),this._featureGroup.clearLayers(),this._map=null},getVisibleParent:function(r){for(var o=r;o&&!o._icon;)o=o.__parent;return o||null},_arraySplice:function(r,o){for(var h=r.length-1;h>=0;h--)if(r[h]===o)return r.splice(h,1),!0},_removeFromGridUnclustered:function(r,o){for(var h=this._map,u=this._gridUnclustered,f=Math.floor(this._map.getMinZoom());o>=f&&u[o].removeObject(r,h.project(r.getLatLng(),o));o--);},_childMarkerDragStart:function(r){r.target.__dragStart=r.target._latlng},_childMarkerMoved:function(r){if(!this._ignoreMove&&!r.target.__dragStart){var o=r.target._popup&&r.target._popup.isOpen();this._moveChild(r.target,r.oldLatLng,r.latlng),o&&r.target.openPopup()}},_moveChild:function(r,o,h){r._latlng=o,this.removeLayer(r),r._latlng=h,this.addLayer(r)},_childMarkerDragEnd:function(r){var o=r.target.__dragStart;delete r.target.__dragStart,o&&this._moveChild(r.target,o,r.target._latlng)},_removeLayer:function(r,o,h){var u=this._gridClusters,f=this._gridUnclustered,_=this._featureGroup,p=this._map,l=Math.floor(this._map.getMinZoom());o&&this._removeFromGridUnclustered(r,this._maxZoom);var m=r.__parent,v=m._markers,y;for(this._arraySplice(v,r);m&&(m._childCount--,m._boundsNeedUpdate=!0,!(m._zoom<l));)o&&m._childCount<=1?(y=m._markers[0]===r?m._markers[1]:m._markers[0],u[m._zoom].removeObject(m,p.project(m._cLatLng,m._zoom)),f[m._zoom].addObject(y,p.project(y.getLatLng(),m._zoom)),this._arraySplice(m.__parent._childClusters,m),m.__parent._markers.push(y),y.__parent=m.__parent,m._icon&&(_.removeLayer(m),h||_.addLayer(y))):m._iconNeedsUpdate=!0,m=m.__parent;delete r.__parent},_isOrIsParent:function(r,o){for(;o;){if(r===o)return!0;o=o.parentNode}return!1},fire:function(r,o,h){if(o&&o.layer instanceof L.MarkerCluster){if(o.originalEvent&&this._isOrIsParent(o.layer._icon,o.originalEvent.relatedTarget))return;r="cluster"+r}L.FeatureGroup.prototype.fire.call(this,r,o,h)},listens:function(r,o){return L.FeatureGroup.prototype.listens.call(this,r,o)||L.FeatureGroup.prototype.listens.call(this,"cluster"+r,o)},_defaultIconCreateFunction:function(r){var o=r.getChildCount(),h=" marker-cluster-";return o<10?h+="small":o<100?h+="medium":h+="large",new L.DivIcon({html:"<div><span>"+o+"</span></div>",className:"marker-cluster"+h,iconSize:new L.Point(40,40)})},_bindEvents:function(){var r=this._map,o=this.options.spiderfyOnMaxZoom,h=this.options.showCoverageOnHover,u=this.options.zoomToBoundsOnClick,f=this.options.spiderfyOnEveryZoom;(o||u||f)&&this.on("clusterclick clusterkeypress",this._zoomOrSpiderfy,this),h&&(this.on("clustermouseover",this._showCoverage,this),this.on("clustermouseout",this._hideCoverage,this),r.on("zoomend",this._hideCoverage,this))},_zoomOrSpiderfy:function(r){var o=r.layer,h=o;if(!(r.type==="clusterkeypress"&&r.originalEvent&&r.originalEvent.keyCode!==13)){for(;h._childClusters.length===1;)h=h._childClusters[0];h._zoom===this._maxZoom&&h._childCount===o._childCount&&this.options.spiderfyOnMaxZoom?o.spiderfy():this.options.zoomToBoundsOnClick&&o.zoomToBounds(),this.options.spiderfyOnEveryZoom&&o.spiderfy(),r.originalEvent&&r.originalEvent.keyCode===13&&this._map._container.focus()}},_showCoverage:function(r){var o=this._map;this._inZoomAnimation||(this._shownPolygon&&o.removeLayer(this._shownPolygon),r.layer.getChildCount()>2&&r.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(r.layer.getConvexHull(),this.options.polygonOptions),o.addLayer(this._shownPolygon)))},_hideCoverage:function(){this._shownPolygon&&(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_unbindEvents:function(){var r=this.options.spiderfyOnMaxZoom,o=this.options.showCoverageOnHover,h=this.options.zoomToBoundsOnClick,u=this.options.spiderfyOnEveryZoom,f=this._map;(r||h||u)&&this.off("clusterclick clusterkeypress",this._zoomOrSpiderfy,this),o&&(this.off("clustermouseover",this._showCoverage,this),this.off("clustermouseout",this._hideCoverage,this),f.off("zoomend",this._hideCoverage,this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var r=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,r),this._topClusterLevel._recursivelyAddChildrenToMap(null,Math.round(this._map._zoom),r),this._currentShownBounds=r}},_generateInitialClusters:function(){var r=Math.ceil(this._map.getMaxZoom()),o=Math.floor(this._map.getMinZoom()),h=this.options.maxClusterRadius,u=h;typeof h!="function"&&(u=function(){return h}),this.options.disableClusteringAtZoom!==null&&(r=this.options.disableClusteringAtZoom-1),this._maxZoom=r,this._gridClusters={},this._gridUnclustered={};for(var f=r;f>=o;f--)this._gridClusters[f]=new L.DistanceGrid(u(f)),this._gridUnclustered[f]=new L.DistanceGrid(u(f));this._topClusterLevel=new this._markerCluster(this,o-1)},_addLayer:function(r,o){var h=this._gridClusters,u=this._gridUnclustered,f=Math.floor(this._map.getMinZoom()),_,p;for(this.options.singleMarkerMode&&this._overrideMarkerIcon(r),r.on(this._childMarkerEventHandlers,this);o>=f;o--){_=this._map.project(r.getLatLng(),o);var l=h[o].getNearObject(_);if(l){l._addChild(r),r.__parent=l;return}if(l=u[o].getNearObject(_),l){var m=l.__parent;m&&this._removeLayer(l,!1);var v=new this._markerCluster(this,o,l,r);h[o].addObject(v,this._map.project(v._cLatLng,o)),l.__parent=v,r.__parent=v;var y=v;for(p=o-1;p>m._zoom;p--)y=new this._markerCluster(this,p,y),h[p].addObject(y,this._map.project(l.getLatLng(),p));m._addChild(y),this._removeFromGridUnclustered(l,o);return}u[o].addObject(r,_)}this._topClusterLevel._addChild(r),r.__parent=this._topClusterLevel},_refreshClustersIcons:function(){this._featureGroup.eachLayer(function(r){r instanceof L.MarkerCluster&&r._iconNeedsUpdate&&r._updateIcon()})},_enqueue:function(r){this._queue.push(r),this._queueTimeout||(this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300))},_processQueue:function(){for(var r=0;r<this._queue.length;r++)this._queue[r].call(this);this._queue.length=0,clearTimeout(this._queueTimeout),this._queueTimeout=null},_mergeSplitClusters:function(){var r=Math.round(this._map._zoom);this._processQueue(),this._zoom<r&&this._currentShownBounds.intersects(this._getExpandedVisibleBounds())?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,r)):this._zoom>r?(this._animationStart(),this._animationZoomOut(this._zoom,r)):this._moveEnd()},_getExpandedVisibleBounds:function(){if(this.options.removeOutsideVisibleBounds){if(L.Browser.mobile)return this._checkBoundsMaxLat(this._map.getBounds())}else return this._mapBoundsInfinite;return this._checkBoundsMaxLat(this._map.getBounds().pad(1))},_checkBoundsMaxLat:function(r){var o=this._maxLat;return o!==void 0&&(r.getNorth()>=o&&(r._northEast.lat=1/0),r.getSouth()<=-o&&(r._southWest.lat=-1/0)),r},_animationAddLayerNonAnimated:function(r,o){if(o===r)this._featureGroup.addLayer(r);else if(o._childCount===2){o._addToMap();var h=o.getAllChildMarkers();this._featureGroup.removeLayer(h[0]),this._featureGroup.removeLayer(h[1])}else o._updateIcon()},_extractNonGroupLayers:function(r,o){var h=r.getLayers(),u=0,f;for(o=o||[];u<h.length;u++){if(f=h[u],f instanceof L.LayerGroup){this._extractNonGroupLayers(f,o);continue}o.push(f)}return o},_overrideMarkerIcon:function(r){var o=r.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[r]}});return o}});L.MarkerClusterGroup.include({_mapBoundsInfinite:new L.LatLngBounds(new L.LatLng(-1/0,-1/0),new L.LatLng(1/0,1/0))}),L.MarkerClusterGroup.include({_noAnimation:{_animationStart:function(){},_animationZoomIn:function(r,o){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),r),this._topClusterLevel._recursivelyAddChildrenToMap(null,o,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationZoomOut:function(r,o){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),r),this._topClusterLevel._recursivelyAddChildrenToMap(null,o,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationAddLayer:function(r,o){this._animationAddLayerNonAnimated(r,o)}},_withAnimation:{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim",this._inZoomAnimation++},_animationZoomIn:function(r,o){var h=this._getExpandedVisibleBounds(),u=this._featureGroup,f=Math.floor(this._map.getMinZoom()),_;this._ignoreMove=!0,this._topClusterLevel._recursively(h,r,f,function(p){var l=p._latlng,m=p._markers,v;for(h.contains(l)||(l=null),p._isSingleParent()&&r+1===o?(u.removeLayer(p),p._recursivelyAddChildrenToMap(null,o,h)):(p.clusterHide(),p._recursivelyAddChildrenToMap(l,o,h)),_=m.length-1;_>=0;_--)v=m[_],h.contains(v._latlng)||u.removeLayer(v)}),this._forceLayout(),this._topClusterLevel._recursivelyBecomeVisible(h,o),u.eachLayer(function(p){!(p instanceof L.MarkerCluster)&&p._icon&&p.clusterShow()}),this._topClusterLevel._recursively(h,r,o,function(p){p._recursivelyRestoreChildPositions(o)}),this._ignoreMove=!1,this._enqueue(function(){this._topClusterLevel._recursively(h,r,f,function(p){u.removeLayer(p),p.clusterShow()}),this._animationEnd()})},_animationZoomOut:function(r,o){this._animationZoomOutSingle(this._topClusterLevel,r-1,o),this._topClusterLevel._recursivelyAddChildrenToMap(null,o,this._getExpandedVisibleBounds()),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),r,this._getExpandedVisibleBounds())},_animationAddLayer:function(r,o){var h=this,u=this._featureGroup;u.addLayer(r),o!==r&&(o._childCount>2?(o._updateIcon(),this._forceLayout(),this._animationStart(),r._setPos(this._map.latLngToLayerPoint(o.getLatLng())),r.clusterHide(),this._enqueue(function(){u.removeLayer(r),r.clusterShow(),h._animationEnd()})):(this._forceLayout(),h._animationStart(),h._animationZoomOutSingle(o,this._map.getMaxZoom(),this._zoom)))}},_animationZoomOutSingle:function(r,o,h){var u=this._getExpandedVisibleBounds(),f=Math.floor(this._map.getMinZoom());r._recursivelyAnimateChildrenInAndAddSelfToMap(u,f,o+1,h);var _=this;this._forceLayout(),r._recursivelyBecomeVisible(u,h),this._enqueue(function(){if(r._childCount===1){var p=r._markers[0];this._ignoreMove=!0,p.setLatLng(p.getLatLng()),this._ignoreMove=!1,p.clusterShow&&p.clusterShow()}else r._recursively(u,h,f,function(l){l._recursivelyRemoveChildrenFromMap(u,f,o+1)});_._animationEnd()})},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")),this._inZoomAnimation--,this.fire("animationend")},_forceLayout:function(){L.Util.falseFn(document.body.offsetWidth)}}),L.markerClusterGroup=function(r){return new L.MarkerClusterGroup(r)};var n=L.MarkerCluster=L.Marker.extend({options:L.Icon.prototype.options,initialize:function(r,o,h,u){L.Marker.prototype.initialize.call(this,h?h._cLatLng||h.getLatLng():new L.LatLng(0,0),{icon:this,pane:r.options.clusterPane}),this._group=r,this._zoom=o,this._markers=[],this._childClusters=[],this._childCount=0,this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._bounds=new L.LatLngBounds,h&&this._addChild(h),u&&this._addChild(u)},getAllChildMarkers:function(r,o){r=r||[];for(var h=this._childClusters.length-1;h>=0;h--)this._childClusters[h].getAllChildMarkers(r,o);for(var u=this._markers.length-1;u>=0;u--)o&&this._markers[u].__dragStart||r.push(this._markers[u]);return r},getChildCount:function(){return this._childCount},zoomToBounds:function(r){for(var o=this._childClusters.slice(),h=this._group._map,u=h.getBoundsZoom(this._bounds),f=this._zoom+1,_=h.getZoom(),p;o.length>0&&u>f;){f++;var l=[];for(p=0;p<o.length;p++)l=l.concat(o[p]._childClusters);o=l}u>f?this._group._map.setView(this._latlng,f):u<=_?this._group._map.setView(this._latlng,_+1):this._group._map.fitBounds(this._bounds,r)},getBounds:function(){var r=new L.LatLngBounds;return r.extend(this._bounds),r},_updateIcon:function(){this._iconNeedsUpdate=!0,this._icon&&this.setIcon(this)},createIcon:function(){return this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1),this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(r,o){this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._setClusterCenter(r),r instanceof L.MarkerCluster?(o||(this._childClusters.push(r),r.__parent=this),this._childCount+=r._childCount):(o||this._markers.push(r),this._childCount++),this.__parent&&this.__parent._addChild(r,!0)},_setClusterCenter:function(r){this._cLatLng||(this._cLatLng=r._cLatLng||r._latlng)},_resetBounds:function(){var r=this._bounds;r._southWest&&(r._southWest.lat=1/0,r._southWest.lng=1/0),r._northEast&&(r._northEast.lat=-1/0,r._northEast.lng=-1/0)},_recalculateBounds:function(){var r=this._markers,o=this._childClusters,h=0,u=0,f=this._childCount,_,p,l,m;if(f!==0){for(this._resetBounds(),_=0;_<r.length;_++)l=r[_]._latlng,this._bounds.extend(l),h+=l.lat,u+=l.lng;for(_=0;_<o.length;_++)p=o[_],p._boundsNeedUpdate&&p._recalculateBounds(),this._bounds.extend(p._bounds),l=p._wLatLng,m=p._childCount,h+=l.lat*m,u+=l.lng*m;this._latlng=this._wLatLng=new L.LatLng(h/f,u/f),this._boundsNeedUpdate=!1}},_addToMap:function(r){r&&(this._backupLatlng=this._latlng,this.setLatLng(r)),this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(r,o,h){this._recursively(r,this._group._map.getMinZoom(),h-1,function(u){var f=u._markers,_,p;for(_=f.length-1;_>=0;_--)p=f[_],p._icon&&(p._setPos(o),p.clusterHide())},function(u){var f=u._childClusters,_,p;for(_=f.length-1;_>=0;_--)p=f[_],p._icon&&(p._setPos(o),p.clusterHide())})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(r,o,h,u){this._recursively(r,u,o,function(f){f._recursivelyAnimateChildrenIn(r,f._group._map.latLngToLayerPoint(f.getLatLng()).round(),h),f._isSingleParent()&&h-1===u?(f.clusterShow(),f._recursivelyRemoveChildrenFromMap(r,o,h)):f.clusterHide(),f._addToMap()})},_recursivelyBecomeVisible:function(r,o){this._recursively(r,this._group._map.getMinZoom(),o,null,function(h){h.clusterShow()})},_recursivelyAddChildrenToMap:function(r,o,h){this._recursively(h,this._group._map.getMinZoom()-1,o,function(u){if(o!==u._zoom)for(var f=u._markers.length-1;f>=0;f--){var _=u._markers[f];h.contains(_._latlng)&&(r&&(_._backupLatlng=_.getLatLng(),_.setLatLng(r),_.clusterHide&&_.clusterHide()),u._group._featureGroup.addLayer(_))}},function(u){u._addToMap(r)})},_recursivelyRestoreChildPositions:function(r){for(var o=this._markers.length-1;o>=0;o--){var h=this._markers[o];h._backupLatlng&&(h.setLatLng(h._backupLatlng),delete h._backupLatlng)}if(r-1===this._zoom)for(var u=this._childClusters.length-1;u>=0;u--)this._childClusters[u]._restorePosition();else for(var f=this._childClusters.length-1;f>=0;f--)this._childClusters[f]._recursivelyRestoreChildPositions(r)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(r,o,h,u){var f,_;this._recursively(r,o-1,h-1,function(p){for(_=p._markers.length-1;_>=0;_--)f=p._markers[_],(!u||!u.contains(f._latlng))&&(p._group._featureGroup.removeLayer(f),f.clusterShow&&f.clusterShow())},function(p){for(_=p._childClusters.length-1;_>=0;_--)f=p._childClusters[_],(!u||!u.contains(f._latlng))&&(p._group._featureGroup.removeLayer(f),f.clusterShow&&f.clusterShow())})},_recursively:function(r,o,h,u,f){var _=this._childClusters,p=this._zoom,l,m;if(o<=p&&(u&&u(this),f&&p===h&&f(this)),p<o||p<h)for(l=_.length-1;l>=0;l--)m=_[l],m._boundsNeedUpdate&&m._recalculateBounds(),r.intersects(m._bounds)&&m._recursively(r,o,h,u,f)},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount}});L.Marker.include({clusterHide:function(){var r=this.options.opacity;return this.setOpacity(0),this.options.opacity=r,this},clusterShow:function(){return this.setOpacity(this.options.opacity)}}),L.DistanceGrid=function(r){this._cellSize=r,this._sqCellSize=r*r,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(r,o){var h=this._getCoord(o.x),u=this._getCoord(o.y),f=this._grid,_=f[u]=f[u]||{},p=_[h]=_[h]||[],l=L.Util.stamp(r);this._objectPoint[l]=o,p.push(r)},updateObject:function(r,o){this.removeObject(r),this.addObject(r,o)},removeObject:function(r,o){var h=this._getCoord(o.x),u=this._getCoord(o.y),f=this._grid,_=f[u]=f[u]||{},p=_[h]=_[h]||[],l,m;for(delete this._objectPoint[L.Util.stamp(r)],l=0,m=p.length;l<m;l++)if(p[l]===r)return p.splice(l,1),m===1&&delete _[h],!0},eachObject:function(r,o){var h,u,f,_,p,l,m,v=this._grid;for(h in v){p=v[h];for(u in p)for(l=p[u],f=0,_=l.length;f<_;f++)m=r.call(o,l[f]),m&&(f--,_--)}},getNearObject:function(r){var o=this._getCoord(r.x),h=this._getCoord(r.y),u,f,_,p,l,m,v,y,M=this._objectPoint,x=this._sqCellSize,C=null;for(u=h-1;u<=h+1;u++)if(p=this._grid[u],p){for(f=o-1;f<=o+1;f++)if(l=p[f],l)for(_=0,m=l.length;_<m;_++)v=l[_],y=this._sqDist(M[L.Util.stamp(v)],r),(y<x||y<=x&&C===null)&&(x=y,C=v)}return C},_getCoord:function(r){var o=Math.floor(r/this._cellSize);return isFinite(o)?o:r},_sqDist:function(r,o){var h=o.x-r.x,u=o.y-r.y;return h*h+u*u}},function(){L.QuickHull={getDistant:function(r,o){var h=o[1].lat-o[0].lat,u=o[0].lng-o[1].lng;return u*(r.lat-o[0].lat)+h*(r.lng-o[0].lng)},findMostDistantPointFromBaseLine:function(r,o){var h=0,u=null,f=[],_,p,l;for(_=o.length-1;_>=0;_--){if(p=o[_],l=this.getDistant(p,r),l>0)f.push(p);else continue;l>h&&(h=l,u=p)}return{maxPoint:u,newPoints:f}},buildConvexHull:function(r,o){var h=[],u=this.findMostDistantPointFromBaseLine(r,o);return u.maxPoint?(h=h.concat(this.buildConvexHull([r[0],u.maxPoint],u.newPoints)),h=h.concat(this.buildConvexHull([u.maxPoint,r[1]],u.newPoints)),h):[r[0]]},getConvexHull:function(r){var o=!1,h=!1,u=!1,f=!1,_=null,p=null,l=null,m=null,v=null,y=null,M;for(M=r.length-1;M>=0;M--){var x=r[M];(o===!1||x.lat>o)&&(_=x,o=x.lat),(h===!1||x.lat<h)&&(p=x,h=x.lat),(u===!1||x.lng>u)&&(l=x,u=x.lng),(f===!1||x.lng<f)&&(m=x,f=x.lng)}h!==o?(y=p,v=_):(y=m,v=l);var C=[].concat(this.buildConvexHull([y,v],r),this.buildConvexHull([v,y],r));return C}}}(),L.MarkerCluster.include({getConvexHull:function(){var r=this.getAllChildMarkers(),o=[],h,u;for(u=r.length-1;u>=0;u--)h=r[u].getLatLng(),o.push(h);return L.QuickHull.getConvexHull(o)}}),L.MarkerCluster.include({_2PI:Math.PI*2,_circleFootSeparation:25,_circleStartAngle:0,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(!(this._group._spiderfied===this||this._group._inZoomAnimation)){var r=this.getAllChildMarkers(null,!0),o=this._group,h=o._map,u=h.latLngToLayerPoint(this._latlng),f;this._group._unspiderfy(),this._group._spiderfied=this,this._group.options.spiderfyShapePositions?f=this._group.options.spiderfyShapePositions(r.length,u):r.length>=this._circleSpiralSwitchover?f=this._generatePointsSpiral(r.length,u):(u.y+=10,f=this._generatePointsCircle(r.length,u)),this._animationSpiderfy(r,f)}},unspiderfy:function(r){this._group._inZoomAnimation||(this._animationUnspiderfy(r),this._group._spiderfied=null)},_generatePointsCircle:function(r,o){var h=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+r),u=h/this._2PI,f=this._2PI/r,_=[],p,l;for(u=Math.max(u,35),_.length=r,p=0;p<r;p++)l=this._circleStartAngle+p*f,_[p]=new L.Point(o.x+u*Math.cos(l),o.y+u*Math.sin(l))._round();return _},_generatePointsSpiral:function(r,o){var h=this._group.options.spiderfyDistanceMultiplier,u=h*this._spiralLengthStart,f=h*this._spiralFootSeparation,_=h*this._spiralLengthFactor*this._2PI,p=0,l=[],m;for(l.length=r,m=r;m>=0;m--)m<r&&(l[m]=new L.Point(o.x+u*Math.cos(p),o.y+u*Math.sin(p))._round()),p+=f/u+m*5e-4,u+=_/p;return l},_noanimationUnspiderfy:function(){var r=this._group,o=r._map,h=r._featureGroup,u=this.getAllChildMarkers(null,!0),f,_;for(r._ignoreMove=!0,this.setOpacity(1),_=u.length-1;_>=0;_--)f=u[_],h.removeLayer(f),f._preSpiderfyLatlng&&(f.setLatLng(f._preSpiderfyLatlng),delete f._preSpiderfyLatlng),f.setZIndexOffset&&f.setZIndexOffset(0),f._spiderLeg&&(o.removeLayer(f._spiderLeg),delete f._spiderLeg);r.fire("unspiderfied",{cluster:this,markers:u}),r._ignoreMove=!1,r._spiderfied=null}}),L.MarkerClusterNonAnimated=L.MarkerCluster.extend({_animationSpiderfy:function(r,o){var h=this._group,u=h._map,f=h._featureGroup,_=this._group.options.spiderLegPolylineOptions,p,l,m,v;for(h._ignoreMove=!0,p=0;p<r.length;p++)v=u.layerPointToLatLng(o[p]),l=r[p],m=new L.Polyline([this._latlng,v],_),u.addLayer(m),l._spiderLeg=m,l._preSpiderfyLatlng=l._latlng,l.setLatLng(v),l.setZIndexOffset&&l.setZIndexOffset(1e6),f.addLayer(l);this.setOpacity(.3),h._ignoreMove=!1,h.fire("spiderfied",{cluster:this,markers:r})},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}}),L.MarkerCluster.include({_animationSpiderfy:function(r,o){var h=this,u=this._group,f=u._map,_=u._featureGroup,p=this._latlng,l=f.latLngToLayerPoint(p),m=L.Path.SVG,v=L.extend({},this._group.options.spiderLegPolylineOptions),y=v.opacity,M,x,C,k,T,D;for(y===void 0&&(y=L.MarkerClusterGroup.prototype.options.spiderLegPolylineOptions.opacity),m?(v.opacity=0,v.className=(v.className||"")+" leaflet-cluster-spider-leg"):v.opacity=y,u._ignoreMove=!0,M=0;M<r.length;M++)x=r[M],D=f.layerPointToLatLng(o[M]),C=new L.Polyline([p,D],v),f.addLayer(C),x._spiderLeg=C,m&&(k=C._path,T=k.getTotalLength()+.1,k.style.strokeDasharray=T,k.style.strokeDashoffset=T),x.setZIndexOffset&&x.setZIndexOffset(1e6),x.clusterHide&&x.clusterHide(),_.addLayer(x),x._setPos&&x._setPos(l);for(u._forceLayout(),u._animationStart(),M=r.length-1;M>=0;M--)D=f.layerPointToLatLng(o[M]),x=r[M],x._preSpiderfyLatlng=x._latlng,x.setLatLng(D),x.clusterShow&&x.clusterShow(),m&&(C=x._spiderLeg,k=C._path,k.style.strokeDashoffset=0,C.setStyle({opacity:y}));this.setOpacity(.3),u._ignoreMove=!1,setTimeout(function(){u._animationEnd(),u.fire("spiderfied",{cluster:h,markers:r})},200)},_animationUnspiderfy:function(r){var o=this,h=this._group,u=h._map,f=h._featureGroup,_=r?u._latLngToNewLayerPoint(this._latlng,r.zoom,r.center):u.latLngToLayerPoint(this._latlng),p=this.getAllChildMarkers(null,!0),l=L.Path.SVG,m,v,y,M,x,C;for(h._ignoreMove=!0,h._animationStart(),this.setOpacity(1),v=p.length-1;v>=0;v--)m=p[v],m._preSpiderfyLatlng&&(m.closePopup(),m.setLatLng(m._preSpiderfyLatlng),delete m._preSpiderfyLatlng,C=!0,m._setPos&&(m._setPos(_),C=!1),m.clusterHide&&(m.clusterHide(),C=!1),C&&f.removeLayer(m),l&&(y=m._spiderLeg,M=y._path,x=M.getTotalLength()+.1,M.style.strokeDashoffset=x,y.setStyle({opacity:0})));h._ignoreMove=!1,setTimeout(function(){var k=0;for(v=p.length-1;v>=0;v--)m=p[v],m._spiderLeg&&k++;for(v=p.length-1;v>=0;v--)m=p[v],m._spiderLeg&&(m.clusterShow&&m.clusterShow(),m.setZIndexOffset&&m.setZIndexOffset(0),k>1&&f.removeLayer(m),u.removeLayer(m._spiderLeg),delete m._spiderLeg);h._animationEnd(),h.fire("unspiderfied",{cluster:o,markers:p})},200)}}),L.MarkerClusterGroup.include({_spiderfied:null,unspiderfy:function(){this._unspiderfy.apply(this,arguments)},_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this),this._map.options.zoomAnimation&&this._map.on("zoomstart",this._unspiderfyZoomStart,this),this._map.on("zoomend",this._noanimationUnspiderfy,this),L.Browser.touch||this._map.getRenderer(this)},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this),this._map.off("zoomstart",this._unspiderfyZoomStart,this),this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._map.off("zoomend",this._noanimationUnspiderfy,this),this._noanimationUnspiderfy()},_unspiderfyZoomStart:function(){this._map&&this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(r){L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching")||(this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(r))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(r){this._spiderfied&&this._spiderfied.unspiderfy(r)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(r){r._spiderLeg&&(this._featureGroup.removeLayer(r),r.clusterShow&&r.clusterShow(),r.setZIndexOffset&&r.setZIndexOffset(0),this._map.removeLayer(r._spiderLeg),delete r._spiderLeg)}}),L.MarkerClusterGroup.include({refreshClusters:function(r){return r?r instanceof L.MarkerClusterGroup?r=r._topClusterLevel.getAllChildMarkers():r instanceof L.LayerGroup?r=r._layers:r instanceof L.MarkerCluster?r=r.getAllChildMarkers():r instanceof L.Marker&&(r=[r]):r=this._topClusterLevel.getAllChildMarkers(),this._flagParentsIconsNeedUpdate(r),this._refreshClustersIcons(),this.options.singleMarkerMode&&this._refreshSingleMarkerModeMarkers(r),this},_flagParentsIconsNeedUpdate:function(r){var o,h;for(o in r)for(h=r[o].__parent;h;)h._iconNeedsUpdate=!0,h=h.__parent},_refreshSingleMarkerModeMarkers:function(r){var o,h;for(o in r)h=r[o],this.hasLayer(h)&&h.setIcon(this._overrideMarkerIcon(h))}}),L.Marker.include({refreshIconOptions:function(r,o){var h=this.options.icon;return L.setOptions(h,r),this.setIcon(h),o&&this.__parent&&this.__parent._group.refreshClusters(this),this}}),i.MarkerClusterGroup=a,i.MarkerCluster=n,Object.defineProperty(i,"__esModule",{value:!0})})});var Cc=Dr((Ec,Mc)=>{"use strict";((i,a)=>{typeof define=="function"&&define.amd?define(["leaflet"],i):typeof Ec=="object"&&(Mc.exports=i(Si())),typeof a<"u"&&a.L&&i(a.L)})(i=>{i.Editable=i.Evented.extend({statics:{FORWARD:1,BACKWARD:-1},options:{zIndex:1e3,polygonClass:i.Polygon,polylineClass:i.Polyline,markerClass:i.Marker,circleMarkerClass:i.CircleMarker,rectangleClass:i.Rectangle,circleClass:i.Circle,drawingCSSClass:"leaflet-editable-drawing",drawingCursor:"crosshair",editLayer:void 0,featuresLayer:void 0,polylineEditorClass:void 0,polygonEditorClass:void 0,markerEditorClass:void 0,circleMarkerEditorClass:void 0,rectangleEditorClass:void 0,circleEditorClass:void 0,lineGuideOptions:{},skipMiddleMarkers:!1},initialize:function(l,m){i.setOptions(this,m),this._lastZIndex=this.options.zIndex,this.map=l,this.editLayer=this.createEditLayer(),this.featuresLayer=this.createFeaturesLayer(),this.forwardLineGuide=this.createLineGuide(),this.backwardLineGuide=this.createLineGuide()},fireAndForward:function(l,m){m=m||{},m.editTools=this,this.fire(l,m),this.map.fire(l,m)},createLineGuide:function(){let l=i.extend({dashArray:"5,10",weight:1,interactive:!1},this.options.lineGuideOptions);return i.polyline([],l)},createVertexIcon:l=>i.Browser.mobile&&i.Browser.touch?new i.Editable.TouchVertexIcon(l):new i.Editable.VertexIcon(l),createEditLayer:function(){return this.options.editLayer||new i.LayerGroup().addTo(this.map)},createFeaturesLayer:function(){return this.options.featuresLayer||new i.LayerGroup().addTo(this.map)},moveForwardLineGuide:function(l){this.forwardLineGuide._latlngs.length&&(this.forwardLineGuide._latlngs[1]=l,this.forwardLineGuide._bounds.extend(l),this.forwardLineGuide.redraw())},moveBackwardLineGuide:function(l){this.backwardLineGuide._latlngs.length&&(this.backwardLineGuide._latlngs[1]=l,this.backwardLineGuide._bounds.extend(l),this.backwardLineGuide.redraw())},anchorForwardLineGuide:function(l){this.forwardLineGuide._latlngs[0]=l,this.forwardLineGuide._bounds.extend(l),this.forwardLineGuide.redraw()},anchorBackwardLineGuide:function(l){this.backwardLineGuide._latlngs[0]=l,this.backwardLineGuide._bounds.extend(l),this.backwardLineGuide.redraw()},attachForwardLineGuide:function(){this.editLayer.addLayer(this.forwardLineGuide)},attachBackwardLineGuide:function(){this.editLayer.addLayer(this.backwardLineGuide)},detachForwardLineGuide:function(){this.forwardLineGuide.setLatLngs([]),this.editLayer.removeLayer(this.forwardLineGuide)},detachBackwardLineGuide:function(){this.backwardLineGuide.setLatLngs([]),this.editLayer.removeLayer(this.backwardLineGuide)},blockEvents:function(){this._oldTargets||(this._oldTargets=this.map._targets,this.map._targets={})},unblockEvents:function(){this._oldTargets&&(this.map._targets=i.extend(this.map._targets,this._oldTargets),delete this._oldTargets)},registerForDrawing:function(l){this._drawingEditor&&this.unregisterForDrawing(this._drawingEditor),this.blockEvents(),l.reset(),this._drawingEditor=l,this.map.on("mousemove touchmove",l.onDrawingMouseMove,l),this.map.on("mousedown",this.onMousedown,this),this.map.on("mouseup",this.onMouseup,this),i.DomUtil.addClass(this.map._container,this.options.drawingCSSClass),this.defaultMapCursor=this.map._container.style.cursor,this.map._container.style.cursor=this.options.drawingCursor},unregisterForDrawing:function(l){this.unblockEvents(),i.DomUtil.removeClass(this.map._container,this.options.drawingCSSClass),this.map._container.style.cursor=this.defaultMapCursor,l=l||this._drawingEditor,l&&(this.map.off("mousemove touchmove",l.onDrawingMouseMove,l),this.map.off("mousedown",this.onMousedown,this),this.map.off("mouseup",this.onMouseup,this),l===this._drawingEditor&&(delete this._drawingEditor,l._drawing&&l.cancelDrawing()))},onMousedown:function(l){l.originalEvent.which==1&&(this._mouseDown=l,this._drawingEditor.onDrawingMouseDown(l))},onMouseup:function(l){if(this._mouseDown){let m=this._drawingEditor,v=this._mouseDown;if(this._mouseDown=null,m.onDrawingMouseUp(l),this._drawingEditor!==m)return;let y=i.point(v.originalEvent.clientX,v.originalEvent.clientY),M=i.point(l.originalEvent.clientX,l.originalEvent.clientY).distanceTo(y);Math.abs(M)<9*(window.devicePixelRatio||1)&&this._drawingEditor.onDrawingClick(l)}},drawing:function(){return this._drawingEditor?.drawing()},stopDrawing:function(){this.unregisterForDrawing()},commitDrawing:function(l){this._drawingEditor&&this._drawingEditor.commitDrawing(l)},connectCreatedToMap:function(l){return this.featuresLayer.addLayer(l)},startPolyline:function(l,m){let v=this.createPolyline([],m);return v.enableEdit(this.map).newShape(l),v},startPolygon:function(l,m){let v=this.createPolygon([],m);return v.enableEdit(this.map).newShape(l),v},startMarker:function(l,m){l=l||this.map.getCenter().clone();let v=this.createMarker(l,m);return v.enableEdit(this.map).startDrawing(),v},startCircleMarker:function(l,m){l=l||this.map.getCenter().clone();let v=this.createCircleMarker(l,m);return v.enableEdit(this.map).startDrawing(),v},startRectangle:function(l,m){let v=l||i.latLng([0,0]),y=new i.LatLngBounds(v,v),M=this.createRectangle(y,m);return M.enableEdit(this.map).startDrawing(),M},startCircle:function(l,m){l=l||this.map.getCenter().clone();let v=this.createCircle(l,m);return v.enableEdit(this.map).startDrawing(),v},startHole:(l,m)=>{l.newHole(m)},createLayer:function(l,m,v){v=i.Util.extend({editOptions:{editTools:this}},v);let y=new l(m,v);return this.fireAndForward("editable:created",{layer:y}),y},createPolyline:function(l,m){return this.createLayer(m?.polylineClass||this.options.polylineClass,l,m)},createPolygon:function(l,m){return this.createLayer(m?.polygonClass||this.options.polygonClass,l,m)},createMarker:function(l,m){return this.createLayer(m?.markerClass||this.options.markerClass,l,m)},createCircleMarker:function(l,m){return this.createLayer(m?.circleMarkerClass||this.options.circleMarkerClass,l,m)},createRectangle:function(l,m){return this.createLayer(m?.rectangleClass||this.options.rectangleClass,l,m)},createCircle:function(l,m){return this.createLayer(m?.circleClass||this.options.circleClass,l,m)}}),i.extend(i.Editable,{makeCancellable:l=>{l.cancel=()=>{l._cancelled=!0}}}),i.Map.mergeOptions({editToolsClass:i.Editable,editable:!1,editOptions:{}}),i.Map.addInitHook(function(){this.whenReady(function(){this.options.editable&&(this.editTools=new this.options.editToolsClass(this,this.options.editOptions))})}),i.Editable.VertexIcon=i.DivIcon.extend({options:{iconSize:new i.Point(8,8)}}),i.Editable.TouchVertexIcon=i.Editable.VertexIcon.extend({options:{iconSize:new i.Point(20,20)}}),i.Editable.VertexMarker=i.Marker.extend({options:{draggable:!0,className:"leaflet-div-icon leaflet-vertex-icon"},initialize:function(l,m,v,y){this.latlng=l,this.latlngs=m,this.editor=v,i.Marker.prototype.initialize.call(this,l,y),this.options.icon=this.editor.tools.createVertexIcon({className:this.options.className}),this.latlng.__vertex=this,this.connect(),this.setZIndexOffset(v.tools._lastZIndex+1)},connect:function(){this.editor.editLayer.addLayer(this)},onAdd:function(l){i.Marker.prototype.onAdd.call(this,l),this.on("drag",this.onDrag),this.on("dragstart",this.onDragStart),this.on("dragend",this.onDragEnd),this.on("mouseup",this.onMouseup),this.on("click",this.onClick),this.on("contextmenu",this.onContextMenu),this.on("mousedown touchstart",this.onMouseDown),this.on("mouseover",this.onMouseOver),this.on("mouseout",this.onMouseOut),this.addMiddleMarkers()},onRemove:function(l){this.middleMarker&&this.middleMarker.delete(),delete this.latlng.__vertex,this.off("drag",this.onDrag),this.off("dragstart",this.onDragStart),this.off("dragend",this.onDragEnd),this.off("mouseup",this.onMouseup),this.off("click",this.onClick),this.off("contextmenu",this.onContextMenu),this.off("mousedown touchstart",this.onMouseDown),this.off("mouseover",this.onMouseOver),this.off("mouseout",this.onMouseOut),i.Marker.prototype.onRemove.call(this,l)},onDrag:function(l){l.vertex=this,this.editor.onVertexMarkerDrag(l);let m=i.DomUtil.getPosition(this._icon),v=this._map.layerPointToLatLng(m);this.latlng.update(v),this._latlng=this.latlng,this.editor.refresh(),this.middleMarker&&this.middleMarker.updateLatLng();let y=this.getNext();y?.middleMarker&&y.middleMarker.updateLatLng()},onDragStart:function(l){l.vertex=this,this.editor.onVertexMarkerDragStart(l)},onDragEnd:function(l){l.vertex=this,this.editor.onVertexMarkerDragEnd(l)},onClick:function(l){l.vertex=this,this.editor.onVertexMarkerClick(l)},onMouseup:function(l){i.DomEvent.stop(l),l.vertex=this,this.editor.map.fire("mouseup",l)},onContextMenu:function(l){l.vertex=this,this.editor.onVertexMarkerContextMenu(l)},onMouseDown:function(l){l.vertex=this,this.editor.onVertexMarkerMouseDown(l)},onMouseOver:function(l){l.vertex=this,this.editor.onVertexMarkerMouseOver(l)},onMouseOut:function(l){l.vertex=this,this.editor.onVertexMarkerMouseOut(l)},delete:function(){let l=this.getNext();this.latlngs.splice(this.getIndex(),1),this.editor.editLayer.removeLayer(this),this.editor.onVertexDeleted({latlng:this.latlng,vertex:this}),this.latlngs.length||this.editor.deleteShape(this.latlngs),l&&l.resetMiddleMarker(),this.editor.refresh()},getIndex:function(){return this.latlngs.indexOf(this.latlng)},getLastIndex:function(){return this.latlngs.length-1},getPrevious:function(){if(this.latlngs.length<2)return;let l=this.getIndex(),m=l-1;l===0&&this.editor.CLOSED&&(m=this.getLastIndex());let v=this.latlngs[m];if(v)return v.__vertex},getNext:function(){if(this.latlngs.length<2)return;let l=this.getIndex(),m=l+1;l===this.getLastIndex()&&this.editor.CLOSED&&(m=0);let v=this.latlngs[m];if(v)return v.__vertex},addMiddleMarker:function(l){this.editor.hasMiddleMarkers()&&(l=l||this.getPrevious(),l&&!this.middleMarker&&(this.middleMarker=this.editor.addMiddleMarker(l,this,this.latlngs,this.editor)))},addMiddleMarkers:function(){if(!this.editor.hasMiddleMarkers())return;let l=this.getPrevious();l&&this.addMiddleMarker(l);let m=this.getNext();m&&m.resetMiddleMarker()},resetMiddleMarker:function(){this.middleMarker&&this.middleMarker.delete(),this.addMiddleMarker()},split:function(){this.editor.splitShape&&this.editor.splitShape(this.latlngs,this.getIndex())},continue:function(){if(!this.editor.continueBackward)return;let l=this.getIndex();l===0?this.editor.continueBackward(this.latlngs):l===this.getLastIndex()&&this.editor.continueForward(this.latlngs)}}),i.Editable.mergeOptions({vertexMarkerClass:i.Editable.VertexMarker}),i.Editable.MiddleMarker=i.Marker.extend({options:{opacity:.5,className:"leaflet-div-icon leaflet-middle-icon",draggable:!0},initialize:function(l,m,v,y,M){this.left=l,this.right=m,this.editor=y,this.latlngs=v,i.Marker.prototype.initialize.call(this,this.computeLatLng(),M),this._opacity=this.options.opacity,this.options.icon=this.editor.tools.createVertexIcon({className:this.options.className}),this.editor.editLayer.addLayer(this),this.setVisibility()},setVisibility:function(){let l=this._map.latLngToContainerPoint(this.left.latlng),m=this._map.latLngToContainerPoint(this.right.latlng),v=i.point(this.options.icon.options.iconSize);l.distanceTo(m)<v.x*3?this.hide():this.show()},show:function(){this.setOpacity(this._opacity)},hide:function(){this.setOpacity(0)},updateLatLng:function(){this.setLatLng(this.computeLatLng()),this.setVisibility()},computeLatLng:function(){let l=this.editor.map.latLngToContainerPoint(this.left.latlng),m=this.editor.map.latLngToContainerPoint(this.right.latlng),v=(l.y+m.y)/2,y=(l.x+m.x)/2;return this.editor.map.containerPointToLatLng([y,v])},onAdd:function(l){i.Marker.prototype.onAdd.call(this,l),i.DomEvent.on(this._icon,"mousedown touchstart",this.onMouseDown,this),l.on("zoomend",this.setVisibility,this)},onRemove:function(l){delete this.right.middleMarker,i.DomEvent.off(this._icon,"mousedown touchstart",this.onMouseDown,this),l.off("zoomend",this.setVisibility,this),i.Marker.prototype.onRemove.call(this,l)},onMouseDown:function(l){let m=i.DomUtil.getPosition(this._icon),v=this.editor.map.layerPointToLatLng(m);if(l={originalEvent:l,latlng:v},this.options.opacity===0||(i.Editable.makeCancellable(l),this.editor.onMiddleMarkerMouseDown(l),l._cancelled))return;this.latlngs.splice(this.index(),0,l.latlng),this.editor.refresh();let y=this._icon,M=this.editor.addVertexMarker(l.latlng,this.latlngs);this.editor.onNewVertex(M);let x=M._icon.parentNode;x.removeChild(M._icon),M._icon=y,x.appendChild(M._icon),M._initIcon(),M._initInteraction(),M.setOpacity(1),i.Draggable._dragging=!1,M.dragging._draggable._onDown(l.originalEvent),this.delete()},delete:function(){this.editor.editLayer.removeLayer(this)},index:function(){return this.latlngs.indexOf(this.right.latlng)}}),i.Editable.mergeOptions({middleMarkerClass:i.Editable.MiddleMarker}),i.Editable.BaseEditor=i.Handler.extend({initialize:function(l,m,v){i.setOptions(this,v),this.map=l,this.feature=m,this.feature.editor=this,this.editLayer=new i.LayerGroup,this.tools=this.options.editTools||l.editTools},addHooks:function(){this.isConnected()?this.onFeatureAdd():this.feature.once("add",this.onFeatureAdd,this),this.onEnable(),this.feature.on(this._getEvents(),this)},removeHooks:function(){this.feature.off(this._getEvents(),this),this.feature.dragging&&this.feature.dragging.disable(),this.editLayer.clearLayers(),this.tools.editLayer.removeLayer(this.editLayer),this.onDisable(),this._drawing&&this.cancelDrawing()},drawing:function(){return!!this._drawing},reset:()=>{},onFeatureAdd:function(){this.tools.editLayer.addLayer(this.editLayer),this.feature.dragging&&this.feature.dragging.enable()},hasMiddleMarkers:function(){return!this.options.skipMiddleMarkers&&!this.tools.options.skipMiddleMarkers},fireAndForward:function(l,m){m=m||{},m.layer=this.feature,this.feature.fire(l,m),this.tools.fireAndForward(l,m)},onEnable:function(){this.fireAndForward("editable:enable")},onDisable:function(){this.fireAndForward("editable:disable")},onEditing:function(){this.fireAndForward("editable:editing")},onEdited:function(){this.fireAndForward("editable:edited")},onStartDrawing:function(){this.fireAndForward("editable:drawing:start")},onEndDrawing:function(){this.fireAndForward("editable:drawing:end")},onCancelDrawing:function(){this.fireAndForward("editable:drawing:cancel")},onCommitDrawing:function(l){this.fireAndForward("editable:drawing:commit",l),this.onEdited()},onDrawingMouseDown:function(l){this.fireAndForward("editable:drawing:mousedown",l)},onDrawingMouseUp:function(l){this.fireAndForward("editable:drawing:mouseup",l)},startDrawing:function(){this._drawing||(this._drawing=i.Editable.FORWARD),this.tools.registerForDrawing(this),this.onStartDrawing()},commitDrawing:function(l){this.onCommitDrawing(l),this.endDrawing()},cancelDrawing:function(){i.Draggable._dragging=!1,this.onCancelDrawing(),this.endDrawing()},endDrawing:function(){this._drawing=!1,this.tools.unregisterForDrawing(this),this.onEndDrawing()},onDrawingClick:function(l){this.drawing()&&(i.Editable.makeCancellable(l),this.fireAndForward("editable:drawing:click",l),!l._cancelled&&(this.isConnected()||this.connect(l),this.processDrawingClick(l)))},isConnected:function(){return this.map.hasLayer(this.feature)},connect:function(){this.tools.connectCreatedToMap(this.feature),this.tools.editLayer.addLayer(this.editLayer)},onMove:function(l){this.fireAndForward("editable:drawing:move",l)},onDrawingMouseMove:function(l){this.onMove(l)},_getEvents:function(){return{dragstart:this.onDragStart,drag:this.onDrag,dragend:this.onDragEnd,remove:this.disable}},onDragStart:function(l){this.onEditing(),this.fireAndForward("editable:dragstart",l)},onDrag:function(l){this.onMove(l),this.fireAndForward("editable:drag",l)},onDragEnd:function(l){this.fireAndForward("editable:dragend",l),this.onEdited()}}),i.Editable.MarkerEditor=i.Editable.BaseEditor.extend({onDrawingMouseMove:function(l){i.Editable.BaseEditor.prototype.onDrawingMouseMove.call(this,l),this._drawing&&this.feature.setLatLng(l.latlng)},processDrawingClick:function(l){this.fireAndForward("editable:drawing:clicked",l),this.commitDrawing(l)},connect:function(l){l&&(this.feature._latlng=l.latlng),i.Editable.BaseEditor.prototype.connect.call(this,l)}}),i.Editable.CircleMarkerEditor=i.Editable.BaseEditor.extend({onDrawingMouseMove:function(l){i.Editable.BaseEditor.prototype.onDrawingMouseMove.call(this,l),this._drawing&&this.feature.setLatLng(l.latlng)},processDrawingClick:function(l){this.fireAndForward("editable:drawing:clicked",l),this.commitDrawing(l)},connect:function(l){l&&(this.feature._latlng=l.latlng),i.Editable.BaseEditor.prototype.connect.call(this,l)}}),i.Editable.PathEditor=i.Editable.BaseEditor.extend({CLOSED:!1,MIN_VERTEX:2,addHooks:function(){return i.Editable.BaseEditor.prototype.addHooks.call(this),this.feature&&(this.initVertexMarkers(),this.map.on("moveend",this.onMoveEnd,this)),this},removeHooks:function(){i.Editable.BaseEditor.prototype.removeHooks.call(this),this.feature&&this.map.off("moveend",this.onMoveEnd,this)},onMoveEnd:function(){this.initVertexMarkers()},initVertexMarkers:function(l){if(this.enabled())if(l=l||this.getLatLngs(),p(l))this.addVertexMarkers(l);else for(let m of l)this.initVertexMarkers(m)},getLatLngs:function(){return this.feature.getLatLngs()},reset:function(){this.editLayer.clearLayers(),this.initVertexMarkers()},addVertexMarker:function(l,m){return l.__vertex?(l.__vertex.connect(),l.__vertex):new this.tools.options.vertexMarkerClass(l,m,this)},onNewVertex:function(l){this.fireAndForward("editable:vertex:new",{latlng:l.latlng,vertex:l})},addVertexMarkers:function(l){let m=this.map.getBounds();for(let v of l)m.contains(v)&&this.addVertexMarker(v,l)},refreshVertexMarkers:function(l){l=l||this.getDefaultLatLngs();for(let m of l)m.__vertex.update()},addMiddleMarker:function(l,m,v){return new this.tools.options.middleMarkerClass(l,m,v,this)},onVertexMarkerClick:function(l){if(i.Editable.makeCancellable(l),this.fireAndForward("editable:vertex:click",l),l._cancelled||this.tools.drawing()&&this.tools._drawingEditor!==this)return;let m=l.vertex.getIndex(),v;l.originalEvent.ctrlKey?this.onVertexMarkerCtrlClick(l):l.originalEvent.altKey?this.onVertexMarkerAltClick(l):l.originalEvent.shiftKey?this.onVertexMarkerShiftClick(l):l.originalEvent.metaKey?this.onVertexMarkerMetaKeyClick(l):m===l.vertex.getLastIndex()&&this._drawing===i.Editable.FORWARD?m>=this.MIN_VERTEX-1&&(v=!0):m===0&&this._drawing===i.Editable.BACKWARD&&this._drawnLatLngs.length>=this.MIN_VERTEX||m===0&&this._drawing===i.Editable.FORWARD&&this._drawnLatLngs.length>=this.MIN_VERTEX&&this.CLOSED?v=!0:this.onVertexRawMarkerClick(l),this.fireAndForward("editable:vertex:clicked",l),v&&this.commitDrawing(l)},onVertexRawMarkerClick:function(l){this.fireAndForward("editable:vertex:rawclick",l),!l._cancelled&&this.vertexCanBeDeleted(l.vertex)&&l.vertex.delete()},vertexCanBeDeleted:function(l){return l.latlngs.length>this.MIN_VERTEX},onVertexDeleted:function(l){this.fireAndForward("editable:vertex:deleted",l),this.onEdited()},onVertexMarkerCtrlClick:function(l){this.fireAndForward("editable:vertex:ctrlclick",l)},onVertexMarkerShiftClick:function(l){this.fireAndForward("editable:vertex:shiftclick",l)},onVertexMarkerMetaKeyClick:function(l){this.fireAndForward("editable:vertex:metakeyclick",l)},onVertexMarkerAltClick:function(l){this.fireAndForward("editable:vertex:altclick",l)},onVertexMarkerContextMenu:function(l){this.fireAndForward("editable:vertex:contextmenu",l)},onVertexMarkerMouseDown:function(l){this.fireAndForward("editable:vertex:mousedown",l)},onVertexMarkerMouseOver:function(l){this.fireAndForward("editable:vertex:mouseover",l)},onVertexMarkerMouseOut:function(l){this.fireAndForward("editable:vertex:mouseout",l)},onMiddleMarkerMouseDown:function(l){this.fireAndForward("editable:middlemarker:mousedown",l)},onVertexMarkerDrag:function(l){this.onMove(l),this.feature._bounds&&this.extendBounds(l),this.fireAndForward("editable:vertex:drag",l)},onVertexMarkerDragStart:function(l){this.fireAndForward("editable:vertex:dragstart",l)},onVertexMarkerDragEnd:function(l){this.fireAndForward("editable:vertex:dragend",l),this.onEdited()},setDrawnLatLngs:function(l){this._drawnLatLngs=l||this.getDefaultLatLngs()},startDrawing:function(){this._drawnLatLngs||this.setDrawnLatLngs(),i.Editable.BaseEditor.prototype.startDrawing.call(this)},startDrawingForward:function(){this.startDrawing()},endDrawing:function(){this.tools.detachForwardLineGuide(),this.tools.detachBackwardLineGuide(),this._drawnLatLngs&&this._drawnLatLngs.length<this.MIN_VERTEX&&this.deleteShape(this._drawnLatLngs),i.Editable.BaseEditor.prototype.endDrawing.call(this),delete this._drawnLatLngs},addLatLng:function(l){this._drawing===i.Editable.FORWARD?this._drawnLatLngs.push(l):this._drawnLatLngs.unshift(l),this.feature._bounds.extend(l);let m=this.addVertexMarker(l,this._drawnLatLngs);this.onNewVertex(m),this.refresh()},newPointForward:function(l){this.addLatLng(l),this.tools.attachForwardLineGuide(),this.tools.anchorForwardLineGuide(l)},newPointBackward:function(l){this.addLatLng(l),this.tools.anchorBackwardLineGuide(l)},push:function(l){if(!l)return console.error("L.Editable.PathEditor.push expect a valid latlng as parameter");this._drawing===i.Editable.FORWARD?this.newPointForward(l):this.newPointBackward(l)},removeLatLng:function(l){l.__vertex.delete(),this.refresh()},pop:function(){if(this._drawnLatLngs.length<=1)return;let l;return this._drawing===i.Editable.FORWARD?l=this._drawnLatLngs[this._drawnLatLngs.length-1]:l=this._drawnLatLngs[0],this.removeLatLng(l),this._drawing===i.Editable.FORWARD?this.tools.anchorForwardLineGuide(this._drawnLatLngs[this._drawnLatLngs.length-1]):this.tools.anchorForwardLineGuide(this._drawnLatLngs[0]),l},processDrawingClick:function(l){l.vertex&&l.vertex.editor===this||(this._drawing===i.Editable.FORWARD?this.newPointForward(l.latlng):this.newPointBackward(l.latlng),this.fireAndForward("editable:drawing:clicked",l))},onDrawingMouseMove:function(l){i.Editable.BaseEditor.prototype.onDrawingMouseMove.call(this,l),this._drawing&&(this.tools.moveForwardLineGuide(l.latlng),this.tools.moveBackwardLineGuide(l.latlng))},refresh:function(){this.feature.redraw(),this.onEditing()},newShape:function(l){let m=this.addNewEmptyShape();m&&(this.setDrawnLatLngs(m[0]||m),this.startDrawingForward(),this.fireAndForward("editable:shape:new",{shape:m}),l&&this.newPointForward(l))},deleteShape:function(l,m){let v={shape:l};if(i.Editable.makeCancellable(v),this.fireAndForward("editable:shape:delete",v),!v._cancelled)return l=this._deleteShape(l,m),this.ensureNotFlat&&this.ensureNotFlat(),this.feature.setLatLngs(this.getLatLngs()),this.refresh(),this.reset(),this.fireAndForward("editable:shape:deleted",{shape:l}),this.onEdited(),l},_deleteShape:function(l,m){if(m=m||this.getLatLngs(),!m.length)return;let v=(M,x)=>M.splice(0,Number.MAX_VALUE),y=(M,x)=>(M.splice(M.indexOf(x),1),M.length||this._deleteShape(M),x);if(m===l)return v(m,l);for(let M of m){if(M===l)return y(m,l);if(M.indexOf(l)!==-1)return y(M,l)}},deleteShapeAt:function(l){let m=this.feature.shapeAt(l);if(m)return this.deleteShape(m)},appendShape:function(l){this.insertShape(l)},prependShape:function(l){this.insertShape(l,0)},insertShape:function(l,m){this.ensureMulti(),l=this.formatShape(l),m===void 0&&(m=this.feature._latlngs.length),this.feature._latlngs.splice(m,0,l),this.feature.redraw(),this._enabled&&this.reset()},extendBounds:function(l){this.feature._bounds.extend(l.vertex.latlng)},onDragStart:function(l){this.editLayer.clearLayers(),i.Editable.BaseEditor.prototype.onDragStart.call(this,l)},onDragEnd:function(l){this.initVertexMarkers(),i.Editable.BaseEditor.prototype.onDragEnd.call(this,l)}}),i.Editable.PolylineEditor=i.Editable.PathEditor.extend({startDrawingBackward:function(){this._drawing=i.Editable.BACKWARD,this.startDrawing()},continueBackward:function(l){this.drawing()||(l=l||this.getDefaultLatLngs(),this.setDrawnLatLngs(l),l.length>0&&(this.tools.attachBackwardLineGuide(),this.tools.anchorBackwardLineGuide(l[0])),this.startDrawingBackward())},continueForward:function(l){this.drawing()||(l=l||this.getDefaultLatLngs(),this.setDrawnLatLngs(l),l.length>0&&(this.tools.attachForwardLineGuide(),this.tools.anchorForwardLineGuide(l[l.length-1])),this.startDrawingForward())},getDefaultLatLngs:function(l){return l=l||this.feature._latlngs,!l.length||l[0]instanceof i.LatLng?l:this.getDefaultLatLngs(l[0])},ensureMulti:function(){this.feature._latlngs.length&&p(this.feature._latlngs)&&(this.feature._latlngs=[this.feature._latlngs])},addNewEmptyShape:function(){if(this.feature._latlngs.length){let l=[];return this.appendShape(l),l}return this.feature._latlngs},formatShape:function(l){if(p(l))return l;if(l[0])return this.formatShape(l[0])},splitShape:function(l,m){if(!m||m>=l.length-1)return;this.ensureMulti();let v=this.feature._latlngs.indexOf(l);if(v===-1)return;let y=l.slice(0,m+1),M=l.slice(m);M[0]=i.latLng(M[0].lat,M[0].lng,M[0].alt),this.feature._latlngs.splice(v,1,y,M),this.refresh(),this.reset(),this.onEdited()}}),i.Editable.PolygonEditor=i.Editable.PathEditor.extend({CLOSED:!0,MIN_VERTEX:3,newPointForward:function(l){i.Editable.PathEditor.prototype.newPointForward.call(this,l),this.tools.backwardLineGuide._latlngs.length||this.tools.anchorBackwardLineGuide(l),this._drawnLatLngs.length===2&&this.tools.attachBackwardLineGuide()},addNewEmptyHole:function(l){this.ensureNotFlat();let m=this.feature.shapeAt(l);if(!m)return;let v=[];return m.push(v),v},newHole:function(l){let m=this.addNewEmptyHole(l);m&&(this.setDrawnLatLngs(m),this.startDrawingForward(),l&&this.newPointForward(l))},addNewEmptyShape:function(){if(this.feature._latlngs.length&&this.feature._latlngs[0].length){let l=[];return this.appendShape(l),l}return this.feature._latlngs},ensureMulti:function(){this.feature._latlngs.length&&p(this.feature._latlngs[0])&&(this.feature._latlngs=[this.feature._latlngs])},ensureNotFlat:function(){(!this.feature._latlngs.length||p(this.feature._latlngs))&&(this.feature._latlngs=[this.feature._latlngs])},vertexCanBeDeleted:function(l){let m=this.feature.parentShape(l.latlngs);return i.Util.indexOf(m,l.latlngs)>0?!0:i.Editable.PathEditor.prototype.vertexCanBeDeleted.call(this,l)},getDefaultLatLngs:function(){return this.feature._latlngs.length||this.feature._latlngs.push([]),this.feature._latlngs[0]},formatShape:l=>p(l)&&(!l[0]||l[0].length!==0)?[l]:l}),i.Editable.RectangleEditor=i.Editable.PathEditor.extend({CLOSED:!0,MIN_VERTEX:4,options:{skipMiddleMarkers:!0},extendBounds:function(l){let m=l.vertex.getIndex(),v=l.vertex.getNext(),y=l.vertex.getPrevious(),M=(m+2)%4,x=l.vertex.latlngs[M],C=new i.LatLngBounds(l.latlng,x);y.latlng.update([l.latlng.lat,x.lng]),v.latlng.update([x.lat,l.latlng.lng]),this.updateBounds(C),this.refreshVertexMarkers()},onDrawingMouseDown:function(l){i.Editable.PathEditor.prototype.onDrawingMouseDown.call(this,l),this.connect();let m=this.getDefaultLatLngs();m.length===3&&m.push(l.latlng);let v=new i.LatLngBounds(l.latlng,l.latlng);this.updateBounds(v),this.updateLatLngs(v),this.refresh(),this.reset(),l.originalEvent._simulated=!1,this.map.dragging._draggable._onUp(l.originalEvent),m[3].__vertex.dragging._draggable._onDown(l.originalEvent)},onDrawingMouseUp:function(l){this.commitDrawing(l),l.originalEvent._simulated=!1,i.Editable.PathEditor.prototype.onDrawingMouseUp.call(this,l)},onDrawingMouseMove:function(l){l.originalEvent._simulated=!1,i.Editable.PathEditor.prototype.onDrawingMouseMove.call(this,l)},getDefaultLatLngs:function(l){return l||this.feature._latlngs[0]},updateBounds:function(l){this.feature._bounds=l},updateLatLngs:function(l){let m=this.getDefaultLatLngs(),v=this.feature._boundsToLatLngs(l);for(let y=0;y<m.length;y++)m[y].update(v[y])}}),i.Editable.CircleEditor=i.Editable.PathEditor.extend({MIN_VERTEX:2,options:{skipMiddleMarkers:!0},initialize:function(l,m,v){i.Editable.PathEditor.prototype.initialize.call(this,l,m,v),this._resizeLatLng=this.computeResizeLatLng()},computeResizeLatLng:function(){let l=(this.feature._radius||this.feature._mRadius)*Math.cos(Math.PI/4),m=this.map.project(this.feature._latlng);return this.map.unproject([m.x+l,m.y-l])},updateResizeLatLng:function(){this._resizeLatLng.update(this.computeResizeLatLng()),this._resizeLatLng.__vertex.update()},getLatLngs:function(){return[this.feature._latlng,this._resizeLatLng]},getDefaultLatLngs:function(){return this.getLatLngs()},onVertexMarkerDrag:function(l){l.vertex.getIndex()===1?this.resize(l):this.updateResizeLatLng(l),i.Editable.PathEditor.prototype.onVertexMarkerDrag.call(this,l)},resize:function(l){let m;this.map.options.crs?m=this.map.options.crs.distance(this.feature._latlng,l.latlng):m=this.feature._latlng.distanceTo(l.latlng),this.feature.setRadius(m)},onDrawingMouseDown:function(l){i.Editable.PathEditor.prototype.onDrawingMouseDown.call(this,l),this._resizeLatLng.update(l.latlng),this.feature._latlng.update(l.latlng),this.connect(),l.originalEvent._simulated=!1,this.map.dragging._draggable._onUp(l.originalEvent),this._resizeLatLng.__vertex.dragging._draggable._onDown(l.originalEvent)},onDrawingMouseUp:function(l){this.commitDrawing(l),l.originalEvent._simulated=!1,i.Editable.PathEditor.prototype.onDrawingMouseUp.call(this,l)},onDrawingMouseMove:function(l){l.originalEvent._simulated=!1,i.Editable.PathEditor.prototype.onDrawingMouseMove.call(this,l)},onDrag:function(l){i.Editable.PathEditor.prototype.onDrag.call(this,l),this.feature.dragging.updateLatLng(this._resizeLatLng)}});let a={createEditor:function(l){l=l||this._map;let m=this.options.editOptions?.editTools||l.editTools;if(!m)throw Error("Unable to detect Editable instance.");let v=this.options.editorClass||this.getEditorClass(m);return new v(l,this,this.options.editOptions)},enableEdit:function(l){return this.editor||this.createEditor(l),this.editor.enable(),this.editor},editEnabled:function(){return this.editor?.enabled()},disableEdit:function(){this.editor&&(this.editor.disable(),delete this.editor)},toggleEdit:function(){this.editEnabled()?this.disableEdit():this.enableEdit()},_onEditableAdd:function(){this.editor&&this.enableEdit()}},n={getEditorClass:l=>l?.options?.polylineEditorClass||i.Editable.PolylineEditor,shapeAt:function(l,m){let v=null;if(m=m||this._latlngs,!m.length)return v;if(p(m)&&this.isInLatLngs(l,m))v=m;else for(let y of m)if(this.isInLatLngs(l,y))return y;return v},isInLatLngs:function(l,m){if(!m)return!1;let v,y,M,x=[],C,k=this._clickTolerance();if(this._projectLatlngs(m,x,this._pxBounds),x=x[0],C=this._map.latLngToLayerPoint(l),!this._pxBounds.contains(C))return!1;for(v=1,M=x.length,y=0;v<M;y=v++)if(i.LineUtil.pointToSegmentDistance(C,x[y],x[v])<=k)return!0;return!1}},r={getEditorClass:l=>l?.options?.polygonEditorClass||i.Editable.PolygonEditor,shapeAt:function(l,m){let v=null;if(m=m||this._latlngs,!m.length)return v;if(p(m)&&this.isInLatLngs(l,m)&&(v=m),p(m[0])&&this.isInLatLngs(l,m[0]))v=m;else for(let y of m)if(this.isInLatLngs(l,y[0]))return y;return v},isInLatLngs:(l,m)=>{let v=!1,y,M,x,C,k;for(x=0,k=m.length,C=k-1;x<k;C=x++)y=m[x],M=m[C],y.lat>l.lat!=M.lat>l.lat&&l.lng<(M.lng-y.lng)*(l.lat-y.lat)/(M.lat-y.lat)+y.lng&&(v=!v);return v},parentShape:function(l,m){if(m=m||this._latlngs,!m)return;let v=i.Util.indexOf(m,l);if(v!==-1)return m;for(let y of m)if(v=i.Util.indexOf(y,l),v!==-1)return y}},o={getEditorClass:l=>l?.options?.markerEditorClass||i.Editable.MarkerEditor},h={getEditorClass:l=>l?.options?.circleMarkerEditorClass||i.Editable.CircleMarkerEditor},u={getEditorClass:l=>l?.options?.rectangleEditorClass||i.Editable.RectangleEditor},f={getEditorClass:l=>l?.options?.circleEditorClass||i.Editable.CircleEditor},_=function(){this.on("add",this._onEditableAdd)},p=i.LineUtil.isFlat||i.LineUtil._flat||i.Polyline._flat;i.Polyline&&(i.Polyline.include(a),i.Polyline.include(n),i.Polyline.addInitHook(_)),i.Polygon&&(i.Polygon.include(a),i.Polygon.include(r)),i.Marker&&(i.Marker.include(a),i.Marker.include(o),i.Marker.addInitHook(_)),i.CircleMarker&&(i.CircleMarker.include(a),i.CircleMarker.include(h),i.CircleMarker.addInitHook(_)),i.Rectangle&&(i.Rectangle.include(a),i.Rectangle.include(u)),i.Circle&&(i.Circle.include(a),i.Circle.include(f)),i.LatLng.prototype.update=function(l){l=i.latLng(l),this.lat=l.lat,this.lng=l.lng}},window)});var Gr=function(i){return i.DEFAULT="DEFAULT",i.EDIT="EDIT",i.SELECTION="SELECTION",i.MEASUREMENT="MEASUREMENT",i.CONNECTION="CONNECTION",i.DIAGNOSTIC="DIAGNOSTIC",i}(Gr||{}),Vr=function(i){return i.CREATE="CREATE",i.UPDATE="UPDATE",i.VIEW="VIEW",i.DELETE="DELETE",i.BATCH="BATCH",i}(Vr||{});var Qu=["switch"],Ju=["*"];function td(i,a){i&1&&(J(0,"span",10),zs(),J(1,"svg",12),Gt(2,"path",13),q(),J(3,"svg",14),Gt(4,"path",15),q()())}var ed=new Se("mat-slide-toggle-default-options",{providedIn:"root",factory:()=>({disableToggleValue:!1,hideIcon:!1,disabledInteractive:!1})}),id={provide:da,useExisting:Os(()=>bn),multi:!0},wn=class{source;checked;constructor(a,n){this.source=a,this.checked=n}},bn=(()=>{class i{_elementRef=Et(mn);_focusMonitor=Et(ia);_changeDetectorRef=Et(Ks);defaults=Et(ed);_onChange=n=>{};_onTouched=()=>{};_validatorOnChange=()=>{};_uniqueId;_checked=!1;_createChangeEvent(n){return new wn(this,n)}_labelId;get buttonId(){return`${this.id||this._uniqueId}-button`}_switchElement;focus(){this._switchElement.nativeElement.focus()}_noopAnimations;_focused;name=null;id;labelPosition="after";ariaLabel=null;ariaLabelledby=null;ariaDescribedby;required;color;disabled=!1;disableRipple=!1;tabIndex=0;get checked(){return this._checked}set checked(n){this._checked=n,this._changeDetectorRef.markForCheck()}hideIcon;disabledInteractive;change=new Br;toggleChange=new Br;get inputId(){return`${this.id||this._uniqueId}-input`}constructor(){Et(na).load(aa);let n=Et(new Rs("tabindex"),{optional:!0}),r=this.defaults,o=Et(Ns,{optional:!0});this.tabIndex=n==null?0:parseInt(n)||0,this.color=r.color||"accent",this._noopAnimations=o==="NoopAnimations",this.id=this._uniqueId=Et(ra).getId("mat-mdc-slide-toggle-"),this.hideIcon=r.hideIcon??!1,this.disabledInteractive=r.disabledInteractive??!1,this._labelId=this._uniqueId+"-label"}ngAfterContentInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(n=>{n==="keyboard"||n==="program"?(this._focused=!0,this._changeDetectorRef.markForCheck()):n||Promise.resolve().then(()=>{this._focused=!1,this._onTouched(),this._changeDetectorRef.markForCheck()})})}ngOnChanges(n){n.required&&this._validatorOnChange()}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}writeValue(n){this.checked=!!n}registerOnChange(n){this._onChange=n}registerOnTouched(n){this._onTouched=n}validate(n){return this.required&&n.value!==!0?{required:!0}:null}registerOnValidatorChange(n){this._validatorOnChange=n}setDisabledState(n){this.disabled=n,this._changeDetectorRef.markForCheck()}toggle(){this.checked=!this.checked,this._onChange(this.checked)}_emitChangeEvent(){this._onChange(this.checked),this.change.emit(this._createChangeEvent(this.checked))}_handleClick(){this.disabled||(this.toggleChange.emit(),this.defaults.disableToggleValue||(this.checked=!this.checked,this._onChange(this.checked),this.change.emit(new wn(this,this.checked))))}_getAriaLabelledBy(){return this.ariaLabelledby?this.ariaLabelledby:this.ariaLabel?null:this._labelId}static \u0275fac=function(r){return new(r||i)};static \u0275cmp=gn({type:i,selectors:[["mat-slide-toggle"]],viewQuery:function(r,o){if(r&1&&Us(Qu,5),r&2){let h;Hs(h=Ws())&&(o._switchElement=h.first)}},hostAttrs:[1,"mat-mdc-slide-toggle"],hostVars:13,hostBindings:function(r,o){r&2&&(Gs("id",o.id),_n("tabindex",null)("aria-label",null)("name",null)("aria-labelledby",null),Zs(o.color?"mat-"+o.color:""),Zr("mat-mdc-slide-toggle-focused",o._focused)("mat-mdc-slide-toggle-checked",o.checked)("_mat-animation-noopable",o._noopAnimations))},inputs:{name:"name",id:"id",labelPosition:"labelPosition",ariaLabel:[0,"aria-label","ariaLabel"],ariaLabelledby:[0,"aria-labelledby","ariaLabelledby"],ariaDescribedby:[0,"aria-describedby","ariaDescribedby"],required:[2,"required","required",Pe],color:"color",disabled:[2,"disabled","disabled",Pe],disableRipple:[2,"disableRipple","disableRipple",Pe],tabIndex:[2,"tabIndex","tabIndex",n=>n==null?0:Qs(n)],checked:[2,"checked","checked",Pe],hideIcon:[2,"hideIcon","hideIcon",Pe],disabledInteractive:[2,"disabledInteractive","disabledInteractive",Pe]},outputs:{change:"change",toggleChange:"toggleChange"},exportAs:["matSlideToggle"],features:[Ys([id,{provide:ma,useExisting:i,multi:!0}]),Ds],ngContentSelectors:Ju,decls:13,vars:27,consts:[["switch",""],["mat-internal-form-field","",3,"labelPosition"],["role","switch","type","button",1,"mdc-switch",3,"click","tabIndex","disabled"],[1,"mdc-switch__track"],[1,"mdc-switch__handle-track"],[1,"mdc-switch__handle"],[1,"mdc-switch__shadow"],[1,"mdc-elevation-overlay"],[1,"mdc-switch__ripple"],["mat-ripple","",1,"mat-mdc-slide-toggle-ripple","mat-focus-indicator",3,"matRippleTrigger","matRippleDisabled","matRippleCentered"],[1,"mdc-switch__icons"],[1,"mdc-label",3,"click","for"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--on"],["d","M19.69,5.23L8.96,15.96l-4.23-4.23L2.96,13.5l6,6L21.46,7L19.69,5.23z"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--off"],["d","M20 13H4v-2h16v2z"]],template:function(r,o){if(r&1){let h=$s();Vs(),J(0,"div",1)(1,"button",2,0),Je("click",function(){return Rr(h),Nr(o._handleClick())}),Gt(3,"span",3),J(4,"span",4)(5,"span",5)(6,"span",6),Gt(7,"span",7),q(),J(8,"span",8),Gt(9,"span",9),q(),ke(10,td,5,0,"span",10),q()()(),J(11,"label",11),Je("click",function(f){return Rr(h),Nr(f.stopPropagation())}),js(12),q()()}if(r&2){let h=qs(2);At("labelPosition",o.labelPosition),wt(),Zr("mdc-switch--selected",o.checked)("mdc-switch--unselected",!o.checked)("mdc-switch--checked",o.checked)("mdc-switch--disabled",o.disabled)("mat-mdc-slide-toggle-disabled-interactive",o.disabledInteractive),At("tabIndex",o.disabled&&!o.disabledInteractive?-1:o.tabIndex)("disabled",o.disabled&&!o.disabledInteractive),_n("id",o.buttonId)("name",o.name)("aria-label",o.ariaLabel)("aria-labelledby",o._getAriaLabelledBy())("aria-describedby",o.ariaDescribedby)("aria-required",o.required||null)("aria-checked",o.checked)("aria-disabled",o.disabled&&o.disabledInteractive?"true":null),wt(8),At("matRippleTrigger",h)("matRippleDisabled",o.disableRipple||o.disabled)("matRippleCentered",!0),wt(),Fs(o.hideIcon?-1:10),wt(),At("for",o.buttonId),_n("id",o._labelId)}},dependencies:[la,ja],styles:[`.mdc-switch{align-items:center;background:none;border:none;cursor:pointer;display:inline-flex;flex-shrink:0;margin:0;outline:none;overflow:visible;padding:0;position:relative;width:var(--mdc-switch-track-width, 52px)}.mdc-switch.mdc-switch--disabled{cursor:default;pointer-events:none}.mdc-switch.mat-mdc-slide-toggle-disabled-interactive{pointer-events:auto}.mdc-switch__track{overflow:hidden;position:relative;width:100%;height:var(--mdc-switch-track-height, 32px);border-radius:var(--mdc-switch-track-shape, var(--mat-sys-corner-full))}.mdc-switch--disabled.mdc-switch .mdc-switch__track{opacity:var(--mdc-switch-disabled-track-opacity, 0.12)}.mdc-switch__track::before,.mdc-switch__track::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";height:100%;left:0;position:absolute;width:100%;border-width:var(--mat-switch-track-outline-width, 2px);border-color:var(--mat-switch-track-outline-color, var(--mat-sys-outline))}.mdc-switch--selected .mdc-switch__track::before,.mdc-switch--selected .mdc-switch__track::after{border-width:var(--mat-switch-selected-track-outline-width, 2px);border-color:var(--mat-switch-selected-track-outline-color, transparent)}.mdc-switch--disabled .mdc-switch__track::before,.mdc-switch--disabled .mdc-switch__track::after{border-width:var(--mat-switch-disabled-unselected-track-outline-width, 2px);border-color:var(--mat-switch-disabled-unselected-track-outline-color, var(--mat-sys-on-surface))}@media(forced-colors: active){.mdc-switch__track{border-color:currentColor}}.mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:translateX(0);background:var(--mdc-switch-unselected-track-color, var(--mat-sys-surface-variant))}.mdc-switch--selected .mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.6, 1);transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch--selected .mdc-switch__track::before{transform:translateX(-100%)}.mdc-switch--selected .mdc-switch__track::before{opacity:var(--mat-switch-hidden-track-opacity, 0);transition:var(--mat-switch-hidden-track-transition, opacity 75ms)}.mdc-switch--unselected .mdc-switch__track::before{opacity:var(--mat-switch-visible-track-opacity, 1);transition:var(--mat-switch-visible-track-transition, opacity 75ms)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-hover-track-color, var(--mat-sys-surface-variant))}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-focus-track-color, var(--mat-sys-surface-variant))}.mdc-switch:enabled:active .mdc-switch__track::before{background:var(--mdc-switch-unselected-pressed-track-color, var(--mat-sys-surface-variant))}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:hover:not(:focus):not(:active) .mdc-switch__track::before,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:focus:not(:active) .mdc-switch__track::before,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:active .mdc-switch__track::before,.mdc-switch.mdc-switch--disabled .mdc-switch__track::before{background:var(--mdc-switch-disabled-unselected-track-color, var(--mat-sys-surface-variant))}.mdc-switch__track::after{transform:translateX(-100%);background:var(--mdc-switch-selected-track-color, var(--mat-sys-primary))}[dir=rtl] .mdc-switch__track::after{transform:translateX(100%)}.mdc-switch--selected .mdc-switch__track::after{transform:translateX(0)}.mdc-switch--selected .mdc-switch__track::after{opacity:var(--mat-switch-visible-track-opacity, 1);transition:var(--mat-switch-visible-track-transition, opacity 75ms)}.mdc-switch--unselected .mdc-switch__track::after{opacity:var(--mat-switch-hidden-track-opacity, 0);transition:var(--mat-switch-hidden-track-transition, opacity 75ms)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-hover-track-color, var(--mat-sys-primary))}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-focus-track-color, var(--mat-sys-primary))}.mdc-switch:enabled:active .mdc-switch__track::after{background:var(--mdc-switch-selected-pressed-track-color, var(--mat-sys-primary))}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:hover:not(:focus):not(:active) .mdc-switch__track::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:focus:not(:active) .mdc-switch__track::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:active .mdc-switch__track::after,.mdc-switch.mdc-switch--disabled .mdc-switch__track::after{background:var(--mdc-switch-disabled-selected-track-color, var(--mat-sys-on-surface))}.mdc-switch__handle-track{height:100%;pointer-events:none;position:absolute;top:0;transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);left:0;right:auto;transform:translateX(0);width:calc(100% - var(--mdc-switch-handle-width))}[dir=rtl] .mdc-switch__handle-track{left:auto;right:0}.mdc-switch--selected .mdc-switch__handle-track{transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch__handle-track{transform:translateX(-100%)}.mdc-switch__handle{display:flex;pointer-events:auto;position:absolute;top:50%;transform:translateY(-50%);left:0;right:auto;transition:width 75ms cubic-bezier(0.4, 0, 0.2, 1),height 75ms cubic-bezier(0.4, 0, 0.2, 1),margin 75ms cubic-bezier(0.4, 0, 0.2, 1);width:var(--mdc-switch-handle-width);height:var(--mdc-switch-handle-height);border-radius:var(--mdc-switch-handle-shape, var(--mat-sys-corner-full))}[dir=rtl] .mdc-switch__handle{left:auto;right:0}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle{width:var(--mat-switch-unselected-handle-size, 16px);height:var(--mat-switch-unselected-handle-size, 16px);margin:var(--mat-switch-unselected-handle-horizontal-margin, 0 8px)}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle:has(.mdc-switch__icons){margin:var(--mat-switch-unselected-with-icon-handle-horizontal-margin, 0 4px)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle{width:var(--mat-switch-selected-handle-size, 24px);height:var(--mat-switch-selected-handle-size, 24px);margin:var(--mat-switch-selected-handle-horizontal-margin, 0 24px)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle:has(.mdc-switch__icons){margin:var(--mat-switch-selected-with-icon-handle-horizontal-margin, 0 24px)}.mat-mdc-slide-toggle .mdc-switch__handle:has(.mdc-switch__icons){width:var(--mat-switch-with-icon-handle-size, 24px);height:var(--mat-switch-with-icon-handle-size, 24px)}.mat-mdc-slide-toggle .mdc-switch:active:not(.mdc-switch--disabled) .mdc-switch__handle{width:var(--mat-switch-pressed-handle-size, 28px);height:var(--mat-switch-pressed-handle-size, 28px)}.mat-mdc-slide-toggle .mdc-switch--selected:active:not(.mdc-switch--disabled) .mdc-switch__handle{margin:var(--mat-switch-selected-pressed-handle-horizontal-margin, 0 22px)}.mat-mdc-slide-toggle .mdc-switch--unselected:active:not(.mdc-switch--disabled) .mdc-switch__handle{margin:var(--mat-switch-unselected-pressed-handle-horizontal-margin, 0 2px)}.mdc-switch--disabled.mdc-switch--selected .mdc-switch__handle::after{opacity:var(--mat-switch-disabled-selected-handle-opacity, 1)}.mdc-switch--disabled.mdc-switch--unselected .mdc-switch__handle::after{opacity:var(--mat-switch-disabled-unselected-handle-opacity, 0.38)}.mdc-switch__handle::before,.mdc-switch__handle::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";width:100%;height:100%;left:0;position:absolute;top:0;transition:background-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1),border-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);z-index:-1}@media(forced-colors: active){.mdc-switch__handle::before,.mdc-switch__handle::after{border-color:currentColor}}.mdc-switch--selected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-selected-handle-color, var(--mat-sys-on-primary))}.mdc-switch--selected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-hover-handle-color, var(--mat-sys-primary-container))}.mdc-switch--selected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-focus-handle-color, var(--mat-sys-primary-container))}.mdc-switch--selected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-selected-pressed-handle-color, var(--mat-sys-primary-container))}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled.mdc-switch--selected:hover:not(:focus):not(:active) .mdc-switch__handle::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled.mdc-switch--selected:focus:not(:active) .mdc-switch__handle::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled.mdc-switch--selected:active .mdc-switch__handle::after,.mdc-switch--selected.mdc-switch--disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-selected-handle-color, var(--mat-sys-surface))}.mdc-switch--unselected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-unselected-handle-color, var(--mat-sys-outline))}.mdc-switch--unselected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-hover-handle-color, var(--mat-sys-on-surface-variant))}.mdc-switch--unselected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-focus-handle-color, var(--mat-sys-on-surface-variant))}.mdc-switch--unselected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-unselected-pressed-handle-color, var(--mat-sys-on-surface-variant))}.mdc-switch--unselected.mdc-switch--disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-unselected-handle-color, var(--mat-sys-on-surface))}.mdc-switch__handle::before{background:var(--mdc-switch-handle-surface-color)}.mdc-switch__shadow{border-radius:inherit;bottom:0;left:0;position:absolute;right:0;top:0}.mdc-switch:enabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-handle-elevation-shadow)}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:hover:not(:focus):not(:active) .mdc-switch__shadow,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:focus:not(:active) .mdc-switch__shadow,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:active .mdc-switch__shadow,.mdc-switch.mdc-switch--disabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-disabled-handle-elevation-shadow)}.mdc-switch__ripple{left:50%;position:absolute;top:50%;transform:translate(-50%, -50%);z-index:-1;width:var(--mdc-switch-state-layer-size, 40px);height:var(--mdc-switch-state-layer-size, 40px)}.mdc-switch__ripple::after{content:"";opacity:0}.mdc-switch--disabled .mdc-switch__ripple::after{display:none}.mat-mdc-slide-toggle-disabled-interactive .mdc-switch__ripple::after{display:block}.mdc-switch:hover .mdc-switch__ripple::after{opacity:.04;transition:75ms opacity cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mdc-switch .mdc-switch__ripple::after{opacity:.12}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:enabled:focus .mdc-switch__ripple::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:enabled:active .mdc-switch__ripple::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:enabled:hover:not(:focus) .mdc-switch__ripple::after,.mdc-switch--unselected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background:var(--mdc-switch-unselected-hover-state-layer-color, var(--mat-sys-on-surface))}.mdc-switch--unselected:enabled:focus .mdc-switch__ripple::after{background:var(--mdc-switch-unselected-focus-state-layer-color, var(--mat-sys-on-surface))}.mdc-switch--unselected:enabled:active .mdc-switch__ripple::after{background:var(--mdc-switch-unselected-pressed-state-layer-color, var(--mat-sys-on-surface));opacity:var(--mdc-switch-unselected-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity));transition:opacity 75ms linear}.mdc-switch--selected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background:var(--mdc-switch-selected-hover-state-layer-color, var(--mat-sys-primary))}.mdc-switch--selected:enabled:focus .mdc-switch__ripple::after{background:var(--mdc-switch-selected-focus-state-layer-color, var(--mat-sys-primary))}.mdc-switch--selected:enabled:active .mdc-switch__ripple::after{background:var(--mdc-switch-selected-pressed-state-layer-color, var(--mat-sys-primary));opacity:var(--mdc-switch-selected-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity));transition:opacity 75ms linear}.mdc-switch__icons{position:relative;height:100%;width:100%;z-index:1;transform:translateZ(0)}.mdc-switch--disabled.mdc-switch--unselected .mdc-switch__icons{opacity:var(--mdc-switch-disabled-unselected-icon-opacity, 0.38)}.mdc-switch--disabled.mdc-switch--selected .mdc-switch__icons{opacity:var(--mdc-switch-disabled-selected-icon-opacity, 0.38)}.mdc-switch__icon{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0;opacity:0;transition:opacity 30ms 0ms cubic-bezier(0.4, 0, 1, 1)}.mdc-switch--unselected .mdc-switch__icon{width:var(--mdc-switch-unselected-icon-size, 16px);height:var(--mdc-switch-unselected-icon-size, 16px);fill:var(--mdc-switch-unselected-icon-color, var(--mat-sys-surface-variant))}.mdc-switch--unselected.mdc-switch--disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-unselected-icon-color, var(--mat-sys-surface-variant))}.mdc-switch--selected .mdc-switch__icon{width:var(--mdc-switch-selected-icon-size, 16px);height:var(--mdc-switch-selected-icon-size, 16px);fill:var(--mdc-switch-selected-icon-color, var(--mat-sys-on-primary-container))}.mdc-switch--selected.mdc-switch--disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-selected-icon-color, var(--mat-sys-on-surface))}.mdc-switch--selected .mdc-switch__icon--on,.mdc-switch--unselected .mdc-switch__icon--off{opacity:1;transition:opacity 45ms 30ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle{-webkit-user-select:none;user-select:none;display:inline-block;-webkit-tap-highlight-color:rgba(0,0,0,0);outline:0}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple,.mat-mdc-slide-toggle .mdc-switch__ripple::after{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:50%;pointer-events:none}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple:not(:empty),.mat-mdc-slide-toggle .mdc-switch__ripple::after:not(:empty){transform:translateZ(0)}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mat-focus-indicator::before{content:""}.mat-mdc-slide-toggle .mat-internal-form-field{color:var(--mat-switch-label-text-color, var(--mat-sys-on-surface));font-family:var(--mat-switch-label-text-font, var(--mat-sys-body-medium-font));line-height:var(--mat-switch-label-text-line-height, var(--mat-sys-body-medium-line-height));font-size:var(--mat-switch-label-text-size, var(--mat-sys-body-medium-size));letter-spacing:var(--mat-switch-label-text-tracking, var(--mat-sys-body-medium-tracking));font-weight:var(--mat-switch-label-text-weight, var(--mat-sys-body-medium-weight))}.mat-mdc-slide-toggle .mat-ripple-element{opacity:.12}.mat-mdc-slide-toggle .mat-focus-indicator::before{border-radius:50%}.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle-track,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__icon,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::after,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::after{transition:none}.mat-mdc-slide-toggle .mdc-switch:enabled+.mdc-label{cursor:pointer}.mat-mdc-slide-toggle .mdc-switch--disabled+label{color:var(--mdc-switch-disabled-label-text-color)}
`],encapsulation:2,changeDetection:0})}return i})();var Wa=(()=>{class i{static \u0275fac=function(r){return new(r||i)};static \u0275mod=Bs({type:i});static \u0275inj=As({imports:[bn,$r,$r]})}return i})();function od(i,a){i&1&&(J(0,"mat-error"),mt(1," El nombre es obligatorio "),q())}function sd(i,a){if(i&1&&(J(0,"mat-icon",22),mt(1),q()),i&2){let n,r=Fr();wt(),Mi(" ",(n=r.layerForm.get("icon"))==null?null:n.value," ")}}function ad(i,a){if(i&1&&(J(0,"mat-option",23),mt(1),q()),i&2){let n=a.$implicit;At("value",n.id),wt(),Xs(" ",n.name," (",n.type,") ")}}function ld(i,a){if(i&1&&(J(0,"div",24)(1,"span"),mt(2),q()()),i&2){let n,r=Fr();wt(2),Mi("",(n=r.layerForm.get("elementIds"))==null||n.value==null?null:n.value.length," elementos seleccionados")}}var qa=(()=>{class i{constructor(n,r,o){this.fb=n,this.dialogRef=r,this.data=o;let h={name:"",description:"",color:"#3f51b5",icon:"layers",elementIds:[],visible:!0,isEditable:!0,priority:50},u=o.isEditing&&o.layer?O(O({},h),o.layer):h;this.layerForm=this.fb.group({name:[u.name,[ti.required]],description:[u.description],color:[u.color,[ti.required]],icon:[u.icon],elementIds:[u.elementIds||[]],visible:[u.visible],isEditable:[u.isEditable],priority:[u.priority,[ti.required,ti.min(0),ti.max(100)]]}),o.isEditing&&o.layer&&o.layer.isSystem&&(this.layerForm.get("name")?.disable(),o.layer.isEditable||(this.layerForm.get("description")?.disable(),this.layerForm.get("color")?.disable(),this.layerForm.get("icon")?.disable(),this.layerForm.get("elementIds")?.disable(),this.layerForm.get("priority")?.disable()))}ngOnInit(){}onCancel(){this.dialogRef.close()}onSave(){if(this.layerForm.invalid)return;let n=this.layerForm.value;this.data.isEditing&&this.data.layer?this.dialogRef.close(Z(O(O({},this.data.layer),n),{updatedAt:new Date})):this.dialogRef.close(n)}static{this.\u0275fac=function(r){return new(r||i)(pn(La),pn(Ca),pn(Sa))}}static{this.\u0275cmp=gn({type:i,selectors:[["app-custom-layer-form"]],decls:56,vars:9,consts:[["mat-dialog-title",""],[3,"formGroup"],["mat-dialog-content",""],[1,"form-row"],["appearance","outline",1,"full-width"],["matInput","","formControlName","name","placeholder","Ej: Zona cr\xEDtica"],[4,"ngIf"],["matInput","","formControlName","description","placeholder","Describa el prop\xF3sito de esta capa","rows","3"],[1,"form-row","color-selection"],["matInput","","type","color","formControlName","color"],["matInput","","formControlName","icon","placeholder","Ej: layers"],["matSuffix","",4,"ngIf"],["formControlName","elementIds","multiple",""],[3,"value",4,"ngFor","ngForOf"],["class","selection-summary",4,"ngIf"],[1,"form-row","toggles"],["formControlName","visible","color","primary"],["formControlName","isEditable","color","primary",3,"disabled"],["matInput","","type","number","formControlName","priority","min","0","max","100"],["mat-dialog-actions","","align","end"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"],["matSuffix",""],[3,"value"],[1,"selection-summary"]],template:function(r,o){if(r&1&&(J(0,"h2",0),mt(1),q(),J(2,"form",1)(3,"div",2)(4,"div",3)(5,"mat-form-field",4)(6,"mat-label"),mt(7,"Nombre de la capa"),q(),Gt(8,"input",5),ke(9,od,2,0,"mat-error",6),q()(),J(10,"div",3)(11,"mat-form-field",4)(12,"mat-label"),mt(13,"Descripci\xF3n"),q(),Gt(14,"textarea",7),q()(),J(15,"div",8)(16,"h4"),mt(17,"Color de la capa"),q(),J(18,"mat-form-field",4)(19,"mat-label"),mt(20,"Color"),q(),Gt(21,"input",9),q()(),J(22,"div",3)(23,"mat-form-field",4)(24,"mat-label"),mt(25,"Icono"),q(),Gt(26,"input",10),J(27,"mat-hint"),mt(28,"Nombre de icono de Material Design"),q(),ke(29,sd,2,1,"mat-icon",11),q()(),J(30,"div",3)(31,"h4"),mt(32,"Elementos en esta capa"),q(),J(33,"mat-form-field",4)(34,"mat-label"),mt(35,"Seleccionar elementos"),q(),J(36,"mat-select",12),ke(37,ad,2,3,"mat-option",13),q()(),ke(38,ld,3,1,"div",14),q(),J(39,"div",15)(40,"mat-slide-toggle",16),mt(41," Capa visible "),q(),J(42,"mat-slide-toggle",17),mt(43," Permitir edici\xF3n "),q()(),J(44,"div",3)(45,"mat-form-field",4)(46,"mat-label"),mt(47,"Prioridad"),q(),Gt(48,"input",18),J(49,"mat-hint"),mt(50,"Mayor n\xFAmero = mayor prioridad de visualizaci\xF3n"),q()()()(),J(51,"div",19)(52,"button",20),Je("click",function(){return o.onCancel()}),mt(53,"Cancelar"),q(),J(54,"button",21),Je("click",function(){return o.onSave()}),mt(55),q()()()),r&2){let h,u,f;wt(),Mi("",o.data.isEditing?"Editar":"Crear"," Capa Personalizada"),wt(),At("formGroup",o.layerForm),wt(7),At("ngIf",(h=o.layerForm.get("name"))==null?null:h.hasError("required")),wt(20),At("ngIf",(u=o.layerForm.get("icon"))==null?null:u.value),wt(8),At("ngForOf",o.data.availableElements),wt(),At("ngIf",(f=o.layerForm.get("elementIds"))==null||f.value==null?null:f.value.length),wt(4),At("disabled",o.data.isEditing===!1||!!o.data.layer&&o.data.layer.isSystem===!0),wt(12),At("disabled",o.layerForm.invalid),wt(),Mi(" ",o.data.isEditing?"Actualizar":"Crear"," ")}},dependencies:[ea,Js,ta,Ea,_a,fa,va,pa,ga,xa,ba,Ma,ya,wa,Oa,Pa,Ia,Ta,ca,ha,Ba,Na,Aa,za,Da,Ra,Fa,Za,Va,Ga,$a,Ua,sa,oa,ua,Wa,bn],styles:[".full-width[_ngcontent-%COMP%]{width:100%}.form-row[_ngcontent-%COMP%]{margin-bottom:16px}.color-selection[_ngcontent-%COMP%]{display:flex;flex-direction:column}.toggles[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.selection-summary[_ngcontent-%COMP%]{margin-top:4px;color:#0009;font-size:12px}h4[_ngcontent-%COMP%]{margin-bottom:8px;color:#0009}"],changeDetection:0})}}return i})();var Mt=[];for(let i=0;i<256;++i)Mt.push((i+256).toString(16).slice(1));function Xa(i,a=0){return(Mt[i[a+0]]+Mt[i[a+1]]+Mt[i[a+2]]+Mt[i[a+3]]+"-"+Mt[i[a+4]]+Mt[i[a+5]]+"-"+Mt[i[a+6]]+Mt[i[a+7]]+"-"+Mt[i[a+8]]+Mt[i[a+9]]+"-"+Mt[i[a+10]]+Mt[i[a+11]]+Mt[i[a+12]]+Mt[i[a+13]]+Mt[i[a+14]]+Mt[i[a+15]]).toLowerCase()}var jr,hd=new Uint8Array(16);function Ur(){if(!jr){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");jr=crypto.getRandomValues.bind(crypto)}return jr(hd)}var cd=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Hr={randomUUID:cd};function ud(i,a,n){if(Hr.randomUUID&&!a&&!i)return Hr.randomUUID();i=i||{};let r=i.random??i.rng?.()??Ur();if(r.length<16)throw new Error("Random bytes length must be >= 16");if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,a){if(n=n||0,n<0||n+16>a.length)throw new RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let o=0;o<16;++o)a[n+o]=r[o];return a}return Xa(r)}var Wr=ud;var Ya=(()=>{class i{constructor(n,r,o){this.http=n,this.dialog=r,this.logger=o,this.apiUrl="/api/layers",this.layersCache=[],this.layersLoaded=!1,this.useMock=yn.useMocks,this.layers$=new z([]),this.initDefaultLayersOnLoad()}getLayers(){return this.layersLoaded&&this.layersCache.length>0?zt([...this.layersCache]):(this.logger.debug("LayerService: Solicitando capas personalizadas."),this.useMock?(this.logger.info("LayerService: Usando datos simulados para capas personalizadas."),this.layersCache=this.getDefaultLayers(),this.layersLoaded=!0,this.layers$.next([...this.layersCache]),zt([...this.layersCache]).pipe(Ei(300))):this.http.get(this.apiUrl).pipe(Ke(n=>{this.layersCache=n,this.layersLoaded=!0,this.layers$.next([...this.layersCache]),this.logger.debug("LayerService: Capas personalizadas cargadas desde API y cacheadas.",n.length)}),Ce(n=>(this.logger.error("LayerService: Error al obtener capas personalizadas desde API.",n),yn.production?Me(()=>n):(this.logger.warn("LayerService: Usando capas por defecto como fallback."),this.layersCache=this.getDefaultLayers(),this.layersLoaded=!0,this.layers$.next([...this.layersCache]),zt([...this.layersCache]))))))}getLayersAsObservable(){return this.layersLoaded||this.getLayers().subscribe({error:n=>this.logger.error("LayerService: Error en la suscripci\xF3n inicial a getLayers.",n)}),this.layers$.asObservable()}createLayer(n){if(this.logger.debug("LayerService: Creando nueva capa personalizada.",n),this.useMock){let r=new Date,o=Z(O({},n),{id:Wr(),createdAt:r,updatedAt:r});return this.layersCache=[...this.layersCache,o],this.layers$.next([...this.layersCache]),this.logger.info("LayerService: Capa personalizada creada exitosamente (mock).",o),zt(o).pipe(Ei(300))}return this.http.post(this.apiUrl,n).pipe(Ke(r=>{this.layersCache=[...this.layersCache,r],this.layers$.next([...this.layersCache]),this.logger.info("LayerService: Capa personalizada creada exitosamente.",r)}),Ce(r=>(this.logger.error("LayerService: Error al crear capa personalizada.",r,n),Me(()=>r))))}updateLayer(n,r){if(this.logger.debug(`LayerService: Actualizando capa personalizada con ID ${n}.`,r),this.useMock){let o=this.layersCache.findIndex(u=>u.id===n);if(o===-1){let u=new Error(`No se encontr\xF3 la capa con ID ${n}`);return this.logger.error("LayerService: Error al actualizar capa personalizada (mock).",u),Me(()=>u)}let h=Z(O(O({},this.layersCache[o]),r),{updatedAt:new Date});return this.layersCache[o]=h,this.layers$.next([...this.layersCache]),this.logger.info("LayerService: Capa personalizada actualizada exitosamente (mock).",h),zt(h).pipe(Ei(300))}return this.http.patch(`${this.apiUrl}/${n}`,r).pipe(Ke(o=>{let h=this.layersCache.findIndex(u=>u.id===n);h!==-1?(this.layersCache[h]=o,this.layers$.next([...this.layersCache]),this.logger.info("LayerService: Capa personalizada actualizada exitosamente.",o)):(this.logger.warn(`LayerService: No se encontr\xF3 la capa con ID ${n} en cach\xE9 despu\xE9s de actualizar.`),this.forceRefreshLayers())}),Ce(o=>(this.logger.error(`LayerService: Error al actualizar capa personalizada con ID ${n}.`,o,r),Me(()=>o))))}deleteLayer(n){if(this.logger.debug(`LayerService: Eliminando capa personalizada con ID ${n}.`),this.useMock){if(this.layersCache.findIndex(o=>o.id===n)===-1){let o=new Error(`No se encontr\xF3 la capa con ID ${n}`);return this.logger.error("LayerService: Error al eliminar capa personalizada (mock).",o),Me(()=>o)}return this.layersCache=this.layersCache.filter(o=>o.id!==n),this.layers$.next([...this.layersCache]),this.logger.info(`LayerService: Capa personalizada con ID ${n} eliminada exitosamente (mock).`),zt(void 0).pipe(Ei(300))}return this.http.delete(`${this.apiUrl}/${n}`).pipe(Ke(()=>{this.layersCache=this.layersCache.filter(r=>r.id!==n),this.layers$.next([...this.layersCache]),this.logger.info(`LayerService: Capa personalizada con ID ${n} eliminada exitosamente.`)}),Ce(r=>(this.logger.error(`LayerService: Error al eliminar capa personalizada con ID ${n}.`,r),Me(()=>r))))}forceRefreshLayers(){return this.layersLoaded=!1,this.logger.debug("LayerService: Forzando recarga de capas personalizadas."),this.getLayers()}openLayerDialog(n){return this.logger.debug("LayerService: Abriendo di\xE1logo de capa personalizada.",n),this.dialog.open(qa,{width:"500px",data:{layer:n?O({},n):void 0}}).afterClosed().pipe(Ke(o=>{o?this.logger.debug("LayerService: Di\xE1logo de capa personalizada cerrado con resultado.",o):this.logger.debug("LayerService: Di\xE1logo de capa personalizada cerrado sin resultado (cancelado).")}))}initDefaultLayersOnLoad(){(this.useMock||!yn.production)&&this.layersCache.length===0&&!this.layersLoaded&&(this.logger.debug("LayerService: Pre-cargando capas por defecto en modo desarrollo (s\xEDncrono)."),this.layersCache=this.getDefaultLayers(),this.layers$.next([...this.layersCache]))}getDefaultLayers(){return this.logger.debug("LayerService: Obteniendo lista de capas por defecto."),[{id:"default-layer-olt",name:"OLTs (Default)",type:"VECTOR",visible:!0,opacity:1,zIndex:1,order:1,color:"#e53935",icon:"router",elements:[St.OLT],createdAt:new Date,updatedAt:new Date,description:"Capa por defecto para OLTs"},{id:"default-layer-ont",name:"ONTs (Default)",type:"VECTOR",visible:!0,opacity:1,zIndex:2,order:2,color:"#43a047",icon:"device_hub",elements:[St.ONT],createdAt:new Date,updatedAt:new Date,description:"Capa por defecto para ONTs"},{id:"default-layer-fdp",name:"FDPs (Default)",type:"VECTOR",visible:!0,opacity:1,zIndex:3,order:3,color:"#2196f3",icon:"settings_input_component",elements:[St.FDP],createdAt:new Date,updatedAt:new Date,description:"Capa por defecto para FDPs"},{id:"default-layer-splitter",name:"Splitters (Default)",type:"VECTOR",visible:!0,opacity:1,zIndex:4,order:4,color:"#ff9800",icon:"call_split",elements:[St.SPLITTER],createdAt:new Date,updatedAt:new Date,description:"Capa por defecto para Splitters"}]}static{this.\u0275fac=function(r){return new(r||i)(K(vn),K(ka),K(pt))}}static{this.\u0275prov=ft({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var Ka=(()=>{class i{constructor(n,r){this.logger=n,this.layerService=r,this.destroy$=new dt,this.initialState={selectedElement:null,selectedConnection:null,activeLayers:new Set,customLayers:[],activeCustomLayers:new Set,isDarkMode:!1,showMiniMap:!0,currentTool:"pan",hasUnsavedChanges:!1,zoomLevel:100,connections:[],historyItems:[],searchResults:[],elementPreview:null},this.stateSubject=new z(this.initialState),this.state$=this.stateSubject.asObservable(),this.selectedElementSubject=new z(null),this.editingElementSubject=new z(null),this.mapVisibilitySubject=new z(!0),this.isDirtySubject=new z(!1),this.currentViewModeSubject=new z("map"),this.diagnosticModeSubject=new z(!1),this.positionSelectionActiveSubject=new z(!1),this.selectedPositionSubject=new z(null),this.elementPreviewSubject=new z(null),this._showSearchWidget=new z(!0),this._showElementsPanel=new z(!0),this.showSearchWidget=this._showSearchWidget.asObservable(),this.showElementsPanel=this._showElementsPanel.asObservable(),this.selectedElement=new z(null),this.currentViewMode=new z("map"),this.isDirtyState=new z(!1),this.isEditingState=new z(!1),this.mapCenter=new z(Ci(18.735693,-70.162651)),this.mapZoom=new z(7),this.editingElement=new z(null),this.mapVisible=new z(!0),this.mapViewMode=new z(Gr.DEFAULT),this.elementEditMode=new z(Vr.VIEW),this.selectedConnection=new z(null),this.visibleLayers=new z([]),this.widgets=new z([]),this.widgetVisibility=new z({search:!0,"elements-panel":!0,"mini-map":!0,"layer-control":!0});let o=new Set(Object.values(St).filter(h=>typeof h=="number"));this.updateActiveLayers(o),this.layerService.getLayersAsObservable().pipe(Rt(this.destroy$)).subscribe(h=>{this.updateCustomLayersList(h)}),this.logger.debug("NetworkStateService inicializado")}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}getCurrentState(){return this.stateSubject.getValue()}updateSelectedElement(n){let r=this.getCurrentState();this.stateSubject.next(Z(O({},r),{selectedElement:n})),this.selectedElementSubject.next(n),this.logger.debug(`Elemento seleccionado actualizado: ${n?.id||"ninguno"}`)}updateActiveLayers(n){let r=this.getCurrentState();this.stateSubject.next(Z(O({},r),{activeLayers:n}))}updateCustomLayersList(n){let r=this.getCurrentState(),o=new Set;r.activeCustomLayers.forEach(h=>{n.some(u=>u.id===h)&&o.add(h)}),this.stateSubject.next(Z(O({},r),{customLayers:n,activeCustomLayers:o})),this.logger.debug("NetworkStateService: Lista de CustomLayers actualizada desde LayerService.",n.length)}updateDarkMode(n){let r=this.getCurrentState();this.stateSubject.next(Z(O({},r),{isDarkMode:n})),this.isDirtySubject.next(this.getCurrentState().hasUnsavedChanges),this.logger.debug(`NetworkStateService: modo oscuro ${n?"activado":"desactivado"}`)}updateCurrentTool(n){let r=this.getCurrentState();this.stateSubject.next(Z(O({},r),{currentTool:n}))}updateMiniMap(n){let r=this.getCurrentState();this.stateSubject.next(Z(O({},r),{showMiniMap:n}))}updateUnsavedChanges(n){let r=this.getCurrentState();this.stateSubject.next(Z(O({},r),{hasUnsavedChanges:n})),this.isDirtySubject.next(n)}updateConnections(n){let r=this.getCurrentState();this.stateSubject.next(Z(O({},r),{connections:n}))}updateCustomLayers(n){let r=this.getCurrentState();this.stateSubject.next(Z(O({},r),{customLayers:n}))}updateActiveCustomLayers(n){let r=this.getCurrentState(),o=new Set;n.forEach(h=>{r.customLayers.some(u=>u.id===h)&&o.add(h)}),this.stateSubject.next(Z(O({},r),{activeCustomLayers:o})),this.logger.debug("NetworkStateService: ActiveCustomLayers actualizado.",Array.from(o))}updateElementPreview(n,r){let o=this.getCurrentState();this.stateSubject.next(Z(O({},o),{elementPreview:n})),this.elementPreviewSubject.next(n),r&&this.logger.debug(`Vista previa de elemento actualizada. Acci\xF3n: ${r}, ID: ${n?.id||"nuevo"}`)}setSelectedElement(n){this.updateSelectedElement(n)}getSelectedElement(){return this.getCurrentState().selectedElement}getSelectedElementAsObservable(){return this.selectedElementSubject.asObservable()}isLayerActive(n){return this.getCurrentState().activeLayers.has(n)}setSelectedConnection(n){let r=this.getCurrentState();this.stateSubject.next(Z(O({},r),{selectedConnection:n})),this.selectedConnection.next(n),this.logger.debug(`Conexi\xF3n seleccionada: ${n?.id||"ninguna"}`)}toggleLayer(n){let r=this.getCurrentState(),o=new Set(r.activeLayers);o.has(n)?o.delete(n):o.add(n),this.updateActiveLayers(o),this.logger.debug(`Capa ${St[n]} alternada. Estado: ${o.has(n)}`)}toggleCustomLayer(n){let r=this.getCurrentState(),o=new Set(r.activeCustomLayers);o.has(n)?o.delete(n):o.add(n),this.updateActiveCustomLayers(o),this.logger.debug(`Capa personalizada ${n} alternada. Estado: ${o.has(n)}`)}setZoomLevel(n){let r=this.getCurrentState();this.stateSubject.next(Z(O({},r),{zoomLevel:n}))}getZoomLevel(){return this.getCurrentState().zoomLevel}setEditingElement(n){this.editingElement.next(n)}getEditingElement(){return this.editingElement.asObservable()}setMapVisibility(n){this.mapVisible.next(n)}getMapVisibility(){return this.mapVisible.asObservable()}setIsDirty(n){this.updateUnsavedChanges(n)}getIsDirty(){return this.isDirtySubject.asObservable()}hasDirtyChanges(){return this.isDirtySubject.getValue()}setCurrentViewMode(n){this.currentViewModeSubject.next(n)}getCurrentViewMode(){return this.currentViewModeSubject.asObservable()}showSnackbar(n,r="info"){this.logger.info(`[Snackbar] ${n} (${r})`)}addToHistory(n){let r=this.getCurrentState(),o=[...r.historyItems||[],n];o.length>50&&o.shift(),this.stateSubject.next(Z(O({},r),{historyItems:o}))}updateSearchResults(n){let r=this.getCurrentState();this.stateSubject.next(Z(O({},r),{searchResults:n}))}getSearchResults(){return this.getCurrentState().searchResults||[]}setShowSearchWidget(n){this._showSearchWidget.next(n)}setShowElementsPanel(n){this._showElementsPanel.next(n),this.logger.debug(`Panel de elementos: ${n?"visible":"oculto"}`)}getShowElementsPanel(){return this.showElementsPanel}setCurrentTool(n){this.updateCurrentTool(n)}clearElementPreview(){this.updateElementPreview(null),this.logger.debug("Vista previa de elemento limpiada")}setDiagnosticMode(n){this.diagnosticModeSubject.next(n),this.logger.debug(`Modo de diagn\xF3stico ${n?"activado":"desactivado"}`)}getDiagnosticMode(){return this.diagnosticModeSubject.asObservable()}setPositionSelectionActive(n){this.positionSelectionActiveSubject.next(n),this.logger.debug(`Selecci\xF3n de posici\xF3n ${n?"activada":"desactivada"}`)}getPositionSelectionActive(){return this.positionSelectionActiveSubject.asObservable()}setSelectedPosition(n){this.selectedPositionSubject.next(n),this.logger.debug(`Posici\xF3n seleccionada: [${n.lat}, ${n.lng}]`)}getSelectedPosition(){return this.selectedPositionSubject.asObservable()}resetState(){this.stateSubject.next(this.initialState),this.layerService.getLayersAsObservable().pipe(Rt(this.destroy$)).subscribe(n=>{this.updateCustomLayersList(n)}),this.logger.debug("NetworkStateService: estado restablecido a valores iniciales")}setMapCenter(n){this.mapCenter.next(n)}getMapCenterAsObservable(){return this.mapCenter.asObservable()}setMapZoom(n){this.mapZoom.next(n)}getMapZoomAsObservable(){return this.mapZoom.asObservable()}centerMapOnElement(n){n&&n.position&&(this.setMapCenter(n.position),this.setMapZoom(18))}resetMapView(){this.setMapCenter(Ci(18.735693,-70.162651)),this.setMapZoom(7)}getMapViewMode(){return this.mapViewMode.asObservable()}setMapViewMode(n){this.mapViewMode.next(n)}getElementEditMode(){return this.elementEditMode.asObservable()}setElementEditMode(n){this.elementEditMode.next(n)}getSelectedConnection(){return this.selectedConnection.asObservable()}getVisibleLayers(){return this.visibleLayers.asObservable()}setVisibleLayers(n){this.visibleLayers.next(n)}getWidgets(){return this.widgets.asObservable()}setWidgets(n){this.widgets.next(n)}updateWidgetVisibility(n,r){let o=this.widgetVisibility.getValue();this.widgetVisibility.next(Z(O({},o),{[n]:r}))}getWidgetVisibility(){return this.widgetVisibility.asObservable()}static{this.\u0275fac=function(r){return new(r||i)(K(pt),K(Ya))}}static{this.\u0275prov=ft({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var xn=(()=>{class i{constructor(n,r){this.networkStateService=n,this.logger=r,this.destroy$=new dt,this._mapState={currentTool:"pan",zoomLevel:100,isDarkMode:!1,showMiniMap:!0,historyCount:0,hasUnsavedChanges:!1,layers:[{id:"osm",name:"OpenStreetMap",visible:!0,type:"base",icon:"fa-map",description:"Mapa base est\xE1ndar",order:1},{id:"satellite",name:"Sat\xE9lite",visible:!1,type:"base",icon:"fa-satellite",description:"Vista satelital",order:2},{id:"terrain",name:"Terreno",visible:!1,type:"base",icon:"fa-mountain",description:"Mapa topogr\xE1fico",order:3},{id:"elements",name:"Elementos",visible:!0,type:"overlay",icon:"fa-network-wired",description:"Elementos de red",order:1},{id:"connections",name:"Conexiones",visible:!0,type:"overlay",icon:"fa-project-diagram",description:"Conexiones entre elementos",order:2},{id:"heatmap",name:"Mapa de calor",visible:!1,type:"overlay",icon:"fa-fire",description:"Densidad de elementos",order:3},{id:"alerts",name:"Alertas",visible:!0,type:"overlay",icon:"fa-exclamation-triangle",description:"Alertas y eventos",order:4}]},this.currentToolSubject=new z(this._mapState.currentTool),this.zoomLevelSubject=new z(this._mapState.zoomLevel),this.isDarkModeSubject=new z(this._mapState.isDarkMode),this.showMiniMapSubject=new z(this._mapState.showMiniMap),this.historyCountSubject=new z(this._mapState.historyCount),this.hasUnsavedChangesSubject=new z(this._mapState.hasUnsavedChanges),this.layersSubject=new z(this._mapState.layers),this.layerChangesSubject=new dt,this.selectedElementsSubject=new z([]),this.connectionToEditSubject=new z(null),this.currentTool=this.currentToolSubject.asObservable(),this.activeTool$=this.currentToolSubject.asObservable(),this.zoomLevel=this.zoomLevelSubject.asObservable(),this.isDarkMode=this.isDarkModeSubject.asObservable(),this.miniMapVisible=this.showMiniMapSubject.asObservable(),this.historyCount=this.historyCountSubject.asObservable(),this.hasUnsavedChanges=this.hasUnsavedChangesSubject.asObservable(),this.layers=this.layersSubject.asObservable(),this.layerChanges=this.layerChangesSubject.asObservable(),this.selectedElements$=this.selectedElementsSubject.asObservable(),this.connectionToEdit$=this.connectionToEditSubject.asObservable(),this.setupStateSubscriptions(),this.singleSelectedElement$=this.selectedElements$.pipe(zr(o=>o.length===1?o[0]:null),Rt(this.destroy$))}get activeLayers(){return this.networkStateService.state$.pipe(zr(n=>n.activeLayers?Array.from(n.activeLayers):[]))}setupStateSubscriptions(){this.networkStateService.state$.pipe(Rt(this.destroy$)).subscribe(n=>{this.isDarkModeSubject.getValue()!==n.isDarkMode&&(this.isDarkModeSubject.next(n.isDarkMode),this._mapState.isDarkMode=n.isDarkMode),this.showMiniMapSubject.getValue()!==(n.showMiniMap||this._mapState.showMiniMap)&&(this.showMiniMapSubject.next(n.showMiniMap||this._mapState.showMiniMap),this._mapState.showMiniMap=n.showMiniMap||this._mapState.showMiniMap),this.currentToolSubject.getValue()!==(n.currentTool||this._mapState.currentTool)&&(this.currentToolSubject.next(n.currentTool||this._mapState.currentTool),this._mapState.currentTool=n.currentTool||this._mapState.currentTool)})}openConnectionPropertiesDialog(n){this.logger.debug(`Solicitando apertura de di\xE1logo para editar conexi\xF3n: ${n.id}`),this.logger.debug("Detalles de la conexi\xF3n a editar:",JSON.stringify(n,null,2)),this.connectionToEditSubject.next(n)}clearConnectionToEdit(){this.connectionToEditSubject.next(null)}setTool(n){if(!this.isValidTool(n)){this.logger.warn(`Herramienta no v\xE1lida: ${n}`);return}this._mapState.currentTool=n,this.currentToolSubject.next(n),this.logger.debug(`Herramienta cambiada a: ${n}`)}setActiveTool(n){this.setTool(n)}setDarkMode(n){this.logger.debug(`Solicitando cambio de modo oscuro a NetworkStateService: ${n}`)}isValidTool(n){return["pan","select","measure","areaSelect","connect","zoomIn","zoomOut","fitToScreen","resetZoom","edit","placeElement","moveElement"].includes(n)}setZoomLevel(n){let r=Math.max(10,Math.min(200,n));this._mapState.zoomLevel=r,this.zoomLevelSubject.next(r)}toggleMiniMap(){let n=!this._mapState.showMiniMap;this._mapState.showMiniMap=n,this.showMiniMapSubject.next(n);try{typeof this.networkStateService.setMiniMapVisibility=="function"?this.networkStateService.setMiniMapVisibility(n):this.logger.debug("No se encontr\xF3 m\xE9todo para actualizar minimapa en NetworkStateService")}catch{this.logger.warn("No se pudo actualizar visibilidad del minimapa en el estado global")}}setUnsavedChanges(n){this._mapState.hasUnsavedChanges=n,this.hasUnsavedChangesSubject.next(n),this.networkStateService.updateUnsavedChanges(n)}isMiniMapVisible(){return this._mapState.showMiniMap}getAllLayers(){return[...this._mapState.layers]}toggleLayerVisibility(n){let r=this._mapState.layers.findIndex(h=>h.id===n);if(r===-1)return this.logger.warn(`Capa no encontrada: ${n}`),!1;let o=[...this._mapState.layers];return o[r].type==="base"&&!o[r].visible&&o.forEach((h,u)=>{h.type==="base"&&h.id!==n&&(o[u]=Z(O({},h),{visible:!1}))}),o[r]=Z(O({},o[r]),{visible:!o[r].visible}),this._mapState.layers=o,this.layersSubject.next(o),this.layerChangesSubject.next(),!0}addLayer(n){if(this._mapState.layers.some(o=>o.id===n.id))return this.logger.warn(`Ya existe una capa con ID: ${n.id}`),!1;let r=[...this._mapState.layers,n];return this._mapState.layers=r,this.layersSubject.next(r),this.layerChangesSubject.next(),!0}removeLayer(n){if(!this._mapState.layers.some(o=>o.id===n))return this.logger.warn(`No existe una capa con ID: ${n}`),!1;let r=this._mapState.layers.filter(o=>o.id!==n);return this._mapState.layers=r,this.layersSubject.next(r),this.layerChangesSubject.next(),!0}setSelectedElements(n){this.selectedElementsSubject.next(n),this.logger.debug(`Elementos seleccionados actualizados: ${n.length} elementos.`)}clearSelectedElements(){this.selectedElementsSubject.next([]),this.logger.debug("Selecci\xF3n de elementos limpiada.")}getSelectedElements(){return this.selectedElementsSubject.getValue()}processElementClick(n,r,o){let h=[...this.selectedElementsSubject.getValue()],u=n.id;if(o){let f=h.findIndex(_=>_.id===u);f>-1?h.splice(f,1):h.push(n),this.selectedElementsSubject.next(h)}else if(r){let f=h.findIndex(_=>_.id===u);f>-1?h.splice(f,1):h.push(n),this.selectedElementsSubject.next(h)}else h.length===1&&h[0].id===u||this.selectedElementsSubject.next([n]);this.logger.debug(`Selecci\xF3n despu\xE9s de clic: ${this.selectedElementsSubject.getValue().length} elementos`,this.selectedElementsSubject.getValue())}destroy(){this.destroy$.next(),this.destroy$.complete()}static{this.\u0275fac=function(r){return new(r||i)(K(Ka),K(pt))}}static{this.\u0275prov=ft({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var Ja=Li(Si());var En=(()=>{class i{constructor(n,r,o,h){this.elementService=n,this.logger=r,this.zone=o,this.http=h,this.destroy$=new dt,this.loadedElements=[],this.elementsById=new Map,this.elementsByType=new Map,this.elementsChanged$=new dt,this.connectionsChanged$=new dt,this.elementSelected$=new dt,this.loadedConnections=[]}loadElementsProgressively(n){let o=O(O({},{batchSize:50,maxElements:1e3}),n),h=new dt;return this.clear(),this.zone.runOutsideAngular(()=>{this.elementService.getAllElements().pipe(Is(1),Ce(u=>(this.logger.error("Error al cargar elementos:",u),h.next({loadedElements:0,totalElements:0,success:!1,error:u}),h.complete(),zt([]))),Rt(this.destroy$)).subscribe(u=>{let f=u.length,_=0,p=l=>{let m=Math.min(l+o.batchSize,Math.min(f,o.maxElements)),v=u.slice(l,m);if(this.processElements(v),_=m,o.progressCallback){let y=Math.round(_/Math.min(f,o.maxElements)*100);this.zone.run(()=>o.progressCallback?.(y))}o.elementsCallback&&this.zone.run(()=>o.elementsCallback?.(v)),m<Math.min(f,o.maxElements)?setTimeout(()=>p(m),100):this.zone.run(()=>{h.next({loadedElements:_,totalElements:f,success:!0}),h.complete(),this.elementsChanged$.next()})};p(0)})}),h.asObservable()}processElements(n){for(let r of n)this.loadedElements.push(r),r.id?this.elementsById.set(r.id,r):this.logger.warn("Elemento sin ID ignorado para mapeo ID:",r),this.elementsByType.has(r.type)||this.elementsByType.set(r.type,[]),this.elementsByType.get(r.type)?.push(r)}getElementById(n){return this.elementsById.get(n)}getElementsByType(n){return this.elementsByType.get(n)||[]}getAllElements(){return this.logger.debug("[MapElementManagerService] getAllElements solicitados"),[...this.loadedElements]}getFilteredElements(n){return this.loadedElements.filter(n)}searchElements(n){if(!n||n.trim()==="")return[];let r=n.toLowerCase();return this.loadedElements.filter(o=>!!(o.id&&o.id.toLowerCase().includes(r)||o.name&&o.name.toLowerCase().includes(r)||o.description&&o.description.toLowerCase().includes(r)))}clear(){this.loadedElements=[],this.elementsById.clear(),this.elementsByType.clear()}updateElement(n){if(!n.id)return this.logger.warn("No se puede actualizar un elemento sin ID:",n),!1;if(!this.elementsById.has(n.id))return this.logger.warn(`Elemento con ID ${n.id} no existe para actualizar`),!1;let r=this.elementsById.get(n.id),o=Z(O(O({},r),n),{createdAt:r.createdAt||new Date,updatedAt:new Date});this.elementsById.set(n.id,o);let h=this.loadedElements.findIndex(u=>u.id===n.id);return h!==-1?this.loadedElements[h]=o:this.logger.warn(`Elemento ${n.id} no encontrado en el arreglo para actualizar`),this.elementsChanged$.next(),this.logger.debug(`Elemento actualizado: ${n.id}`),!0}addElement(n){n.id||(this.logger.warn("Elemento sin ID no puede ser a\xF1adido:",n),n.id=`element-${Date.now()}-${Math.floor(Math.random()*1e3)}`,this.logger.debug("ID generado para el elemento:",n.id)),this.elementsById.set(n.id,n),this.loadedElements.push(n),this.elementsChanged$.next(),this.logger.debug(`Elemento a\xF1adido: ${n.id}, total: ${this.loadedElements.length}`)}removeElement(n){if(!this.elementsById.has(n))return!1;try{let r=this.elementsById.get(n),o=this.elementsByType.get(r.type);if(o){let u=o.findIndex(f=>f.id===n);u>=0&&o.splice(u,1)}let h=this.loadedElements.findIndex(u=>u.id===n);return h>=0&&this.loadedElements.splice(h,1),this.elementsById.delete(n),this.elementsChanged$.next(),!0}catch(r){return this.logger.error("Error al eliminar elemento:",r),!1}}selectElement(n){let r=this.elementsById.get(n);r&&this.zone.run(()=>{this.elementSelected$.next(r)})}get elementsChanged(){return this.elementsChanged$.asObservable()}get connectionsChanged(){return this.connectionsChanged$.asObservable()}get elementSelected(){return this.elementSelected$.asObservable()}destroy(){this.destroy$.next(),this.destroy$.complete(),this.clear()}getElementsByFilters(n){return this.http.post("/api/elements/filter",n)}getElementsInBounds(n){return this.loadedElements.filter(r=>{if(!r.position)return!1;let o=Ja.latLng(r.position.lat,r.position.lng);return n.contains(o)})}getAllConnections(){return this.logger.debug("[MapElementManagerService] getAllConnections solicitados"),[...this.loadedConnections]}addConnection(n){this.loadedConnections.push(n),this.logger.debug(`[MapElementManagerService] Conexi\xF3n a\xF1adida entre ${n.sourceElementId} y ${n.targetElementId}. Total: ${this.loadedConnections.length}`),this.connectionsChanged$.next()}updateConnection(n){if(!n.id)return this.logger.warn("[MapElementManagerService] No se puede actualizar una conexi\xF3n sin ID:",n),!1;let r=this.loadedConnections.findIndex(o=>o.id===n.id);if(r!==-1){let o=this.loadedConnections[r];return this.loadedConnections[r]=Z(O(O({},o),n),{updatedAt:new Date}),this.logger.debug(`[MapElementManagerService] Conexi\xF3n actualizada: ${n.id}`),this.connectionsChanged$.next(),!0}else return this.logger.warn(`[MapElementManagerService] Conexi\xF3n con ID ${n.id} no encontrada para actualizar.`),!1}static{this.\u0275fac=function(r){return new(r||i)(K(Ha),K(pt),K(Qe),K(vn))}}static{this.\u0275prov=ft({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var Vt=function(i){return i.MAP_READY="MAP_READY",i.MAP_ERROR="MAP_ERROR",i.ELEMENT_SELECTED="ELEMENT_SELECTED",i.ELEMENT_CREATED="ELEMENT_CREATED",i.ELEMENT_UPDATED="ELEMENT_UPDATED",i.ELEMENT_DELETED="ELEMENT_DELETED",i.CONNECTION_SELECTED="CONNECTION_SELECTED",i.CONNECTION_CREATED="CONNECTION_CREATED",i.CONNECTION_UPDATED="CONNECTION_UPDATED",i.CONNECTION_DELETED="CONNECTION_DELETED",i.LAYER_TOGGLED="LAYER_TOGGLED",i.ZOOM_CHANGED="ZOOM_CHANGED",i.VIEW_MODE_CHANGED="VIEW_MODE_CHANGED",i.WIDGET_LOADED="WIDGET_LOADED",i.WIDGET_ERROR="WIDGET_ERROR",i.WIDGET_ACTION="WIDGET_ACTION",i}(Vt||{}),tl=(()=>{class i{constructor(n){this.logger=n,this.eventSubject=new dt}emit(n){n.timestamp||(n.timestamp=new Date),this.logger.debug(`[EventBus] Emitiendo evento: ${n.type}`,n),this.eventSubject.next(n)}on(n){return this.eventSubject.asObservable().pipe(Ts(r=>r.type===n))}emitMapError(n,r){this.emit({type:Vt.MAP_ERROR,timestamp:new Date,payload:{error:n instanceof Error?n.message:String(n),stack:n instanceof Error?n.stack:void 0,source:r},source:r})}emitElementSelected(n){this.emit({type:Vt.ELEMENT_SELECTED,timestamp:new Date,payload:{element:n},source:n?.id})}emitConnectionSelected(n){this.emit({type:Vt.CONNECTION_SELECTED,timestamp:new Date,payload:{connection:n},source:n?.id})}emitLayerToggled(n,r){this.emit({type:Vt.LAYER_TOGGLED,timestamp:new Date,payload:{layerId:n,visible:r},source:n})}emitWidgetLoaded(n,r){this.emit({type:Vt.WIDGET_LOADED,timestamp:new Date,payload:{widgetId:n,success:r},source:n})}emitWidgetError(n,r){this.emit({type:Vt.WIDGET_ERROR,timestamp:new Date,payload:{widgetId:n,error:r instanceof Error?r.message:String(r),stack:r instanceof Error?r.stack:void 0},source:n})}static{this.\u0275fac=function(r){return new(r||i)(K(pt))}}static{this.\u0275prov=ft({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var el=(()=>{class i{constructor(){this.logger=Et(pt),this.initialState={center:[0,0],zoom:5,activeTool:"pan",selectedElementIds:[],selectedConnectionIds:[],isEditing:!1,isMeasuring:!1,isConnecting:!1},this.state=O({},this.initialState),this.mapStateSubject=new z(this.state),this.centerSubject=new z(this.state.center),this.zoomSubject=new z(this.state.zoom),this.activeToolSubject=new z(this.state.activeTool),this.selectedElementIdsSubject=new z(this.state.selectedElementIds),this.selectedConnectionIdsSubject=new z(this.state.selectedConnectionIds),this.mapState$=this.mapStateSubject.asObservable(),this.center$=this.centerSubject.asObservable(),this.zoom$=this.zoomSubject.asObservable(),this.activeTool$=this.activeToolSubject.asObservable(),this.selectedElementIds$=this.selectedElementIdsSubject.asObservable(),this.selectedConnectionIds$=this.selectedConnectionIdsSubject.asObservable(),this.logger.debug("MapStateService inicializado")}getState(){return O({},this.state)}setState(n){this.state=O(O({},this.state),n),this.mapStateSubject.next(this.state),n.center!==void 0&&this.centerSubject.next(n.center),n.zoom!==void 0&&this.zoomSubject.next(n.zoom),n.activeTool!==void 0&&this.activeToolSubject.next(n.activeTool),n.selectedElementIds!==void 0&&this.selectedElementIdsSubject.next(n.selectedElementIds),n.selectedConnectionIds!==void 0&&this.selectedConnectionIdsSubject.next(n.selectedConnectionIds),this.logger.debug("Estado del mapa actualizado",this.state)}resetState(){this.setState(this.initialState),this.logger.debug("Estado del mapa restablecido a valores iniciales")}setCenter(n){this.setState({center:n})}setZoom(n){this.setState({zoom:n})}setBounds(n){this.setState({bounds:n})}setActiveTool(n){let r=n==="edit",o=n==="measure",h=n==="connect";this.setState({activeTool:n,isEditing:r,isMeasuring:o,isConnecting:h}),this.logger.debug(`Herramienta activa cambiada a: ${n}`)}selectElement(n,r=!0){let o=r?[n]:[...this.state.selectedElementIds,n];this.setState({selectedElementIds:o}),this.logger.debug(`Elemento seleccionado: ${n}`)}deselectElement(n){let r=this.state.selectedElementIds.filter(o=>o!==n);this.setState({selectedElementIds:r}),this.logger.debug(`Elemento deseleccionado: ${n}`)}selectElements(n,r=!0){let o=r?[...n]:[...this.state.selectedElementIds,...n];this.setState({selectedElementIds:o}),this.logger.debug(`${n.length} elementos seleccionados`)}clearElementSelection(){this.setState({selectedElementIds:[]}),this.logger.debug("Selecci\xF3n de elementos limpiada")}selectConnection(n,r=!0){let o=r?[n]:[...this.state.selectedConnectionIds,n];this.setState({selectedConnectionIds:o}),this.logger.debug(`Conexi\xF3n seleccionada: ${n}`)}deselectConnection(n){let r=this.state.selectedConnectionIds.filter(o=>o!==n);this.setState({selectedConnectionIds:r}),this.logger.debug(`Conexi\xF3n deseleccionada: ${n}`)}clearConnectionSelection(){this.setState({selectedConnectionIds:[]}),this.logger.debug("Selecci\xF3n de conexiones limpiada")}clearAllSelections(){this.setState({selectedElementIds:[],selectedConnectionIds:[]}),this.logger.debug("Todas las selecciones limpiadas")}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275prov=ft({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var il=(()=>{class i{constructor(n){this.logger=n,this.VIEWPORT_MARGIN=100,this.maxRenderElements=200,this.renderQuality="medium",this.clusteringEnabled=!1,this.updateInterval=250}calculateVisibleElements(n){return Ps(this,null,function*(){let{viewport:r,zoom:o,pan:h,elements:u}=n;if(!u||u.length===0)return[];let f=this.calculateViewportBounds(r,o,h);return new Promise(_=>{setTimeout(()=>{let p=u.filter(l=>this.isElementInViewport(l,f)&&!!l.id).map(l=>l.id);_(p)},0)})})}calculateViewportBounds(n,r,o){let h=r/100,u=o.x-(n.width/2+this.VIEWPORT_MARGIN)/h,f=o.x+(n.width/2+this.VIEWPORT_MARGIN)/h,_=o.y-(n.height/2+this.VIEWPORT_MARGIN)/h,p=o.y+(n.height/2+this.VIEWPORT_MARGIN)/h;return{minX:u,minY:_,maxX:f,maxY:p}}isElementInViewport(n,r){return!n.position||typeof n.position.lat!="number"||typeof n.position.lng!="number"?!1:n.position.lng>=r.minX&&n.position.lng<=r.maxX&&n.position.lat>=r.minY&&n.position.lat<=r.maxY}calculateDetailLevel(n){return n>150?"high":n>80?"medium":"low"}optimizePerformance(){this.logger.debug("Aplicando optimizaciones de rendimiento"),this.maxRenderElements=100,this.renderQuality="low",this.clusteringEnabled=!0,this.updateInterval=500,this.logger.info("Modo de rendimiento optimizado activado")}static{this.\u0275fac=function(r){return new(r||i)(K(pt))}}static{this.\u0275prov=ft({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var nl=(()=>{class i{constructor(n,r){this.elementManager=n,this.logger=r,this.elementsChangedSubject=new dt,this.selectedElement=null,this.elementManager.elementsChanged.subscribe(()=>{this.elementsChangedSubject.next()})}get elementsChanged(){return this.elementsChangedSubject.asObservable()}getAllElements(){try{return this.elementManager.getAllElements()}catch(n){return this.logger.error("Error al obtener elementos en el adaptador",n),[]}}getElementById(n){try{return this.elementManager.getElementById(n)}catch(r){this.logger.error(`Error al obtener elemento con ID ${n} en el adaptador`,r);return}}getElementsByType(n){try{return this.elementManager.getElementsByType(n)}catch(r){return this.logger.error(`Error al obtener elementos de tipo ${n} en el adaptador`,r),[]}}selectElement(n){try{this.elementManager.selectElement(n),this.selectedElement=this.getElementById(n)||null}catch(r){this.logger.error(`Error al seleccionar elemento con ID ${n} en el adaptador`,r)}}deselectElement(){try{this.selectedElement=null}catch(n){this.logger.error("Error al deseleccionar elemento en el adaptador",n)}}getSelectedElement(){return this.selectedElement}searchElements(n){try{return this.elementManager.searchElements(n)}catch(r){return this.logger.error(`Error al buscar elementos con texto "${n}" en el adaptador`,r),[]}}addElement(n){try{if(console.log("MapElementManagerAdapter: A\xF1adiendo elemento",n),!n||!n.type){this.logger.error("Elemento inv\xE1lido para a\xF1adir",n);return}if(!n.position||typeof n.position.lat!="number"||typeof n.position.lng!="number"){this.logger.error("Posici\xF3n inv\xE1lida para a\xF1adir elemento",n);return}this.elementManager.addElement(n),this.logger.debug(`Elemento a\xF1adido correctamente: ${n.id}, tipo: ${n.type}`),this.elementsChangedSubject.next()}catch(r){this.logger.error("Error al a\xF1adir elemento en el adaptador",r)}}updateElement(n){try{return this.elementManager.updateElement(n)}catch(r){return this.logger.error(`Error al actualizar elemento con ID ${n.id} en el adaptador`,r),!1}}removeElement(n){try{return this.elementManager.removeElement(n)}catch(r){return this.logger.error(`Error al eliminar elemento con ID ${n} en el adaptador`,r),!1}}addConnection(n){try{return this.elementManager.addConnection(n),this.logger.info("[MapElementManagerAdapter] addConnection llamada a elementManager",n),zt(n)}catch(r){throw this.logger.error("[MapElementManagerAdapter] Error al intentar a\xF1adir conexi\xF3n v\xEDa elementManager",r),r}}updateConnection(n){try{let r=this.elementManager.updateConnection(n);return this.logger.info("[MapElementManagerAdapter] updateConnection llamada a elementManager",n,`Success: ${r}`),zt(r)}catch(r){return this.logger.error("[MapElementManagerAdapter] Error al intentar actualizar conexi\xF3n v\xEDa elementManager",r),zt(!1)}}updateElementPosition(n,r,o){try{console.log(`MapElementManagerAdapter: Actualizando posici\xF3n del elemento ${n} a [${o}, ${r}]`);let h=this.getElementById(n);if(!h)return this.logger.error(`No se encontr\xF3 el elemento con ID ${n} para actualizar posici\xF3n`),!1;let u=Z(O({},h),{position:{lat:o,lng:r,coordinates:[r,o],type:"Point"}}),f=this.updateElement(u);return f&&(this.logger.debug(`Posici\xF3n del elemento ${n} actualizada correctamente`),this.elementsChangedSubject.next()),f}catch(h){return this.logger.error(`Error al actualizar posici\xF3n del elemento ${n}:`,h),!1}}static{this.\u0275fac=function(r){return new(r||i)(K(En),K(pt))}}static{this.\u0275prov=ft({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var et=Li(Si()),kg=Li(ol());var sl=(()=>{class i{constructor(n,r,o,h,u){this.zone=n,this.logger=r,this.virtualizationService=o,this.mapStateManagerService=h,this.elementManagerAdapter=u,this.elementMarkers=new Map,this.connectionLines=new Map,this.connectionVertexMarkers=new Map,this.map=null,this.elementsLayer=et.default.layerGroup(),this.connectionsLayer=et.default.layerGroup(),this.clustersLayer=null,this.labelsLayer=et.default.layerGroup(),this.options={darkMode:!1,useWebGL:!0,clusteringEnabled:!0,progressiveLoading:!0,showConnections:!0},this._fps=0,this._renderedElements=0,this._visibleElements=0,this.lastFrameTime=0,this.frameCount=0,this.clusterGroup=null,this.performanceConfig={enableClustering:!0,clusterRadius:80,maxClusterRadius:80,animationDuration:300,disableClusteringAtZoom:18,maxZoom:19,useWebGL:!0,progressiveLoading:!0,useDisplayBuffers:!0,showCoverageOnHover:!1},this.elementsCountSubject=new z(0),this.elementsCountChange$=this.elementsCountSubject.asObservable(),this.renderCompleteSubject=new dt,this.renderComplete$=this.renderCompleteSubject.asObservable(),this.emergencyMode=!1,this.renderQueue=[],this.renderTimer=null,this.maxElementsPerFrame=10,this.isVirtualizationEnabled=!0,this.currentBounds=null,this.currentEditingConnection=null,this.handleKeyDown=f=>{f.key==="Enter"&&this.currentEditingConnection&&(this.logger.debug("[Renderer] Tecla Enter presionada, finalizando edici\xF3n de conexi\xF3n."),this.finishConnectionEditing()),(f.key==="Delete"||f.key==="Del")&&this.currentEditingConnection&&(this.logger.debug("[Renderer] Tecla Delete presionada, eliminando conexi\xF3n seleccionada."),this.deleteSelectedConnection())},this.startFPSMeasurement(),this.logger.debug("[NetworkMapRendererService] Constructor"),document.addEventListener("keydown",this.handleKeyDown)}initialize(n,r){this.map=n,r&&(this.options=O(O({},this.options),r)),this.elementsLayer.addTo(n),this.connectionsLayer.addTo(n),this.labelsLayer.addTo(n),this.options.clusteringEnabled&&this.initClustering(),this.startFPSMeasurement(),this.logger.debug("NetworkMapRenderer inicializado")}initClustering(){if(!this.map){this.logger.warn("[Renderer] Mapa no inicializado, no se puede inicializar clustering."),this.options.clusteringEnabled=!1;return}let n=!1;if(typeof et.default.markerClusterGroup=="function")try{this.clustersLayer=et.default.markerClusterGroup({maxClusterRadius:50,spiderfyOnMaxZoom:!0,showCoverageOnHover:!1,zoomToBoundsOnClick:!0}),this.map&&this.clustersLayer&&(this.map.addLayer(this.clustersLayer),this.logger.info("[Renderer] Clustering inicializado exitosamente con L.markerClusterGroup()."),n=!0)}catch(r){this.logger.warn(`[Renderer] Fall\xF3 L.markerClusterGroup(): ${r.message}. Se intentar\xE1n alternativas.`,r),this.clustersLayer&&this.map&&this.map.hasLayer(this.clustersLayer)&&this.map.removeLayer(this.clustersLayer),this.clustersLayer=null}else this.logger.debug("[Renderer] L.markerClusterGroup no es una funci\xF3n.");if(!n){let r=et.default.MarkerClusterGroup;if(typeof r=="function")try{this.clustersLayer=new r({maxClusterRadius:50,spiderfyOnMaxZoom:!0,showCoverageOnHover:!1,zoomToBoundsOnClick:!0}),this.map&&this.clustersLayer&&(this.map.addLayer(this.clustersLayer),this.logger.info("[Renderer] Clustering inicializado exitosamente con new L.MarkerClusterGroup()."),n=!0)}catch(o){this.logger.warn(`[Renderer] Fall\xF3 new L.MarkerClusterGroup(): ${o.message}`),console.error("[Renderer] Error object new L.MarkerClusterGroup:",o),this.clustersLayer&&this.map&&this.map.hasLayer(this.clustersLayer)&&this.map.removeLayer(this.clustersLayer),this.clustersLayer=null}else this.logger.debug("[Renderer] L.MarkerClusterGroup (PascalCase) no es una funci\xF3n.")}n?(this.options.clusteringEnabled=!0,this.clusterGroup=this.clustersLayer):(this.logger.error("[Renderer] No se pudo inicializar el clustering. Clustering deshabilitado."),this.options.clusteringEnabled=!1,this.clustersLayer=null,this.clusterGroup=null)}renderElements(n,r=null){this.map&&(this.emergencyMode&&(n=this.limitElementsForEmergencyMode(n)),!r&&this.map&&(r=this.map.getBounds()),this.zone.runOutsideAngular(()=>{this.cancelPendingRenders(),this.cleanupInvisibleMarkers(n);let{visibleElements:o,offscreenElements:h}=this.splitElementsByVisibility(n,r);this._visibleElements=o.length,this.renderQueue=[...o],this.processRenderQueue(),h.length>0&&setTimeout(()=>{this.emergencyMode||(this.renderQueue=[...this.renderQueue,...h])},2e3)}))}limitElementsForEmergencyMode(n){if(n.length<=50)return n;let o=n.filter(h=>h.type===St.OLT||h.type===St.FDP||h.type===St.SPLITTER).slice(0,50);if(o.length<50){let h=n.filter(u=>u.type!==St.OLT&&u.type!==St.FDP&&u.type!==St.SPLITTER).slice(0,50-o.length);return[...o,...h]}return o}splitElementsByVisibility(n,r){if(!r)return{visibleElements:n.slice(0,100),offscreenElements:n.slice(100)};let o=[],h=[],u=100;for(let f of n){if(!f.position){h.push(f);continue}let _=new et.default.LatLng(f.position.lat,f.position.lng);r.contains(_)&&o.length<u?o.push(f):h.push(f)}return{visibleElements:o,offscreenElements:h}}cancelPendingRenders(){this.renderTimer&&(cancelAnimationFrame(this.renderTimer),this.renderTimer=null),this.renderQueue=[]}processRenderQueue(){if(this.renderQueue.length===0){this._renderedElements=this.elementMarkers.size,this.renderCompleteSubject.next();return}this.renderQueue.splice(0,this.maxElementsPerFrame).forEach(r=>{this.createOrUpdateMarker(r)}),this._renderedElements=this.elementMarkers.size,this.renderTimer=requestAnimationFrame(()=>{this.processRenderQueue()})}createOrUpdateMarker(n){if(!n.id){this.logger.warn("[Renderer] Elemento sin ID no puede ser renderizado",n);return}if(!n.position){this.logger.warn(`[Renderer] Elemento ${n.id} sin posici\xF3n no puede ser renderizado.`);return}let r=et.default.latLng(n.position.lat,n.position.lng),o=this.elementMarkers.get(n.id),h;if(o){let u=o.getLatLng();(u.lat!==r.lat||u.lng!==r.lng)&&o.setLatLng(r);let f=this.getMarkerIcon(n);o.setIcon(f),h=o}else{let u=this.getMarkerIcon(n),f=et.default.marker(r,{icon:u,draggable:!1,title:n.name||`${n.type} ${n.id}`,riseOnHover:!0});f.element=n,this.addMarkerEvents(f,n),this.elementMarkers.set(n.id,f),h=f,this.options.clusteringEnabled&&this.clustersLayer?(this.clustersLayer.addLayer(f),this.logger.debug(`[Renderer] Marcador para elemento ${n.id} (${n.type}) a\xF1adido al cl\xFAster.`)):(this.elementsLayer.addLayer(f),this.logger.debug(`[Renderer] Marcador para elemento ${n.id} (${n.type}) a\xF1adido a la capa normal.`))}n.type===St.MANGA&&this.logger.info(`[Renderer] Elemento MANGA procesado: ${n.id} en posici\xF3n [${r.lat}, ${r.lng}]`)}addMarkerEvents(n,r){n.on("click",o=>{this.mapStateManagerService.setSelectedElements([r]),this.logger.debug(`[Renderer] Elemento seleccionado por clic en marcador: ${r.id} (${r.type})`),et.default.DomEvent.stopPropagation(o)}),n.on("dblclick",o=>{this.mapStateManagerService.setSelectedElements([r]),this.logger.debug(`[Renderer] Doble clic en marcador: ${r.id} (${r.type})`),et.default.DomEvent.stopPropagation(o)}),n.on("mouseover",()=>{n.openTooltip()}),n.on("mouseout",()=>{n.closeTooltip()})}renderConnections(n){if(!this.map){this.logger.warn("[Renderer] Mapa no inicializado, no se pueden renderizar conexiones.");return}this.logger.info(`[Renderer] Renderizando ${n.length} conexiones.`);let r=new Set(n.filter(o=>o.id).map(o=>o.id));this.connectionLines.forEach((o,h)=>{r.has(h)||(this.connectionsLayer.removeLayer(o),typeof o.disableEdit=="function"&&o.disableEdit(),this.connectionLines.delete(h),this.logger.debug(`[Renderer] Conexi\xF3n eliminada del mapa: ${h}`))}),n.forEach(o=>{if(!o.id){this.logger.warn("[Renderer] Se intent\xF3 renderizar una conexi\xF3n sin ID.",o);return}this.createOrUpdateConnection(o)})}createOrUpdateConnection(n){if(!this.map)return;if(!n.id){this.logger.error("[Renderer] Intento de crear/actualizar conexi\xF3n sin ID.");return}let r=this.elementMarkers.get(n.sourceElementId),o=this.elementMarkers.get(n.targetElementId);if(this.logger.info(`[Renderer] createOrUpdateConnection for ${n.id}: Source ID: ${n.sourceElementId} -> Marker found: ${!!r}, Target ID: ${n.targetElementId} -> Marker found: ${!!o}`),!r||!o){this.logger.warn(`[Renderer] No se encontraron marcadores de origen o destino para la conexi\xF3n ${n.id}. No se puede renderizar.`);let f=this.connectionLines.get(n.id);f&&(this.connectionsLayer.removeLayer(f),typeof f.disableEdit=="function"&&f.disableEdit(),this.connectionLines.delete(n.id));return}let h=[r.getLatLng(),...n.vertices?.map(f=>et.default.latLng(f.lat,f.lng))||[],o.getLatLng()],u=this.connectionLines.get(n.id);u?(u.setLatLngs(h),this.logger.debug(`[Renderer] Conexi\xF3n actualizada: ${n.id}`)):(u=et.default.polyline(h,{color:n.metadata?.color||"#3388ff",weight:n.metadata?.weight||3,opacity:n.metadata?.opacity||.7}).addTo(this.connectionsLayer),this.connectionLines.set(n.id,u),this.logger.debug(`[Renderer] Conexi\xF3n creada: ${n.id}`),this.map?u.enableEdit(this.map):this.logger.warn(`[Renderer] No se pudo habilitar la edici\xF3n para ${n.id} porque this.map es null.`),this.setupPolylineEditEvents(u,n))}setupPolylineEditEvents(n,r){this.map&&(n.on("editable:editing",o=>{this.logger.debug(`[Renderer] Evento 'editable:editing' para conexi\xF3n ${r.id}. Datos del evento:`,o),this.handlePolylineEdit(o.layer,r),this.currentEditingConnection={polyline:n,connection:r}}),n.on("editable:vertex:deleted",o=>{this.logger.info(`[Renderer] Evento 'editable:vertex:deleted' para conexi\xF3n ${r.id}. Datos del evento:`,o),this.handlePolylineEdit(o.layer,r),this.currentEditingConnection={polyline:n,connection:r}}),n.on("editable:vertex:dragend",o=>{this.logger.info(`[Renderer] Evento 'editable:vertex:dragend' para conexi\xF3n ${r.id}. Datos del evento:`,o),this.handlePolylineEdit(o.layer,r),this.currentEditingConnection={polyline:n,connection:r}}),n.on("click",o=>{et.default.DomEvent.stopPropagation(o.originalEvent),this.logger.debug(`[Renderer] Conexi\xF3n seleccionada: ${r.id}`),this.currentEditingConnection&&this.currentEditingConnection.polyline!==n&&this.currentEditingConnection.polyline.editor&&this.currentEditingConnection.polyline.disableEdit(),this.currentEditingConnection={polyline:n,connection:r},n.editEnabled||(n.enableEdit(this.map),n.editEnabled=!0,n.getElement()?.classList.add("connection-editing"),this.logger.debug(`[Renderer] Editor de v\xE9rtices activado para conexi\xF3n: ${r.id}`))}),n.on("dblclick",o=>{et.default.DomEvent.stopPropagation(o.originalEvent),this.logger.debug(`[Renderer] Solicitando edici\xF3n de propiedades para conexi\xF3n: ${r.id}`),this.currentEditingConnection={polyline:n,connection:r},this.mapStateManagerService.openConnectionPropertiesDialog(r)}),this.logger.debug(`[Renderer] Eventos de edici\xF3n configurados para conexi\xF3n: ${r.id}`))}handlePolylineEdit(n,r){if(!this.map)return;let o=n.getLatLngs(),h=[];o.length>2&&(h=o.slice(1,o.length-1).map(f=>Ci(f.lat,f.lng)));let u=Z(O({},r),{vertices:h});this.logger.info(`[Renderer] Actualizando conexi\xF3n ${r.id} con nuevos v\xE9rtices:`,u.vertices),this.elementManagerAdapter.updateConnection(u).subscribe({next:f=>{if(f)this.logger.info(`[Renderer] Conexi\xF3n ${r.id} actualizada en backend tras edici\xF3n.`);else{this.logger.warn(`[Renderer] Fall\xF3 la actualizaci\xF3n en backend de la conexi\xF3n ${r.id} tras edici\xF3n. Revirtiendo cambios visuales.`);let _=[this.elementMarkers.get(r.sourceElementId).getLatLng(),...r.vertices?.map(p=>et.default.latLng(p.lat,p.lng))||[],this.elementMarkers.get(r.targetElementId).getLatLng()];n.setLatLngs(_),n.editor?.reset()}},error:f=>{this.logger.error(`[Renderer] Error al actualizar conexi\xF3n ${r.id} en backend tras edici\xF3n:`,f);let _=[this.elementMarkers.get(r.sourceElementId).getLatLng(),...r.vertices?.map(p=>et.default.latLng(p.lat,p.lng))||[],this.elementMarkers.get(r.targetElementId).getLatLng()];n.setLatLngs(_),n.editor?.reset()}})}cleanupInvisibleMarkers(n){let r=new Set(n.map(o=>o.id));this.elementMarkers.forEach((o,h)=>{r.has(h)||(this.options.clusteringEnabled&&this.clustersLayer?this.clustersLayer.removeLayer(o):this.elementsLayer.removeLayer(o),this.elementMarkers.delete(h))})}clearAll(){this.map&&(this.logger.debug("[Renderer] Limpiando todas las capas del renderer."),this.connectionsLayer.clearLayers(),this.elementsLayer.clearLayers(),this.labelsLayer.clearLayers(),this.elementMarkers.clear(),this.connectionLines.forEach(n=>n.disableEdit()),this.connectionLines.clear())}updateOptions(n){let r=O({},this.options);this.options=O(O({},this.options),n),r.clusteringEnabled!==this.options.clusteringEnabled&&this.handleClusteringChange()}handleClusteringChange(){if(!this.map)return;let n=[];this.elementMarkers.forEach((r,o)=>{r.element&&n.push(r.element)}),this.clearAll(),this.options.clusteringEnabled&&this.initClustering(),this.renderElements(n)}startFPSMeasurement(){this.lastFrameTime=performance.now(),this.frameCount=0;let n=()=>{this.frameCount++;let r=performance.now(),o=r-this.lastFrameTime;o>=1e3&&(this._fps=Math.round(this.frameCount*1e3/o),this.frameCount=0,this.lastFrameTime=r),requestAnimationFrame(n)};requestAnimationFrame(n)}get performanceMetrics(){return{fps:this._fps,rendered:this._renderedElements,visible:this._visibleElements}}destroy(){this.clearAll(),this.map=null,document.removeEventListener("keydown",this.handleKeyDown)}getUseWebGL(){return this.performanceConfig.useWebGL}getProgressiveLoading(){return this.performanceConfig.progressiveLoading}getClusteringEnabled(){return this.performanceConfig.enableClustering}updateBaseLayer(n,r){if(!n)return;n.eachLayer(h=>{h instanceof et.default.TileLayer&&n.removeLayer(h)});let o={crossOrigin:!0,updateWhenIdle:!0,updateWhenZooming:!1,keepBuffer:2,maxZoom:this.performanceConfig.maxZoom,useCache:!0,useOnlyCache:!1};switch(r){case"dark":et.default.tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",Z(O({},o),{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',subdomains:"abcd"})).addTo(n);break;case"satellite":et.default.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",Z(O({},o),{attribution:"Tiles &copy; Esri"})).addTo(n);break;case"hybrid":et.default.tileLayer("https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}",Z(O({},o),{attribution:"Map data &copy; Google"})).addTo(n);break;case"light":et.default.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",Z(O({},o),{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',subdomains:"abcd"})).addTo(n);break;case"offline":et.default.tileLayer("assets/leaflet/offline-tiles/{z}/{x}/{y}.png",Z(O({},o),{errorTileUrl:"assets/leaflet/error-tiles/error-tile.png",maxZoom:18,minZoom:10})).addTo(n);break;case"osm":default:et.default.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",Z(O({},o),{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'})).addTo(n);break}}optimizeForHardware(n,r){if(n){switch(r){case"low":if(this.performanceConfig.enableClustering=!0,this.performanceConfig.clusterRadius=100,this.performanceConfig.animationDuration=0,this.clusterGroup){let o=this.clusterGroup;o&&o.options&&(o.options.maxClusterRadius=100,o.options.animate=!1,o.options.animateAddingMarkers=!1)}et.default.Util.requestAnimFrame=function(o,h,u){return setTimeout(o.bind(h),100)};break;case"medium":if(this.performanceConfig.enableClustering=!0,this.performanceConfig.clusterRadius=80,this.performanceConfig.animationDuration=200,this.clusterGroup){let o=this.clusterGroup;o&&o.options&&(o.options.maxClusterRadius=80,o.options.animate=!0,o.options.animateAddingMarkers=!1)}break;case"high":if(this.performanceConfig.enableClustering=!0,this.performanceConfig.clusterRadius=60,this.performanceConfig.animationDuration=300,this.clusterGroup){let o=this.clusterGroup;o&&o.options&&(o.options.maxClusterRadius=60,o.options.animate=!0,o.options.animateAddingMarkers=!0)}break}n&&n.invalidateSize()}}cleanup(){this.clusterGroup=null}enableEmergencyMode(){this.emergencyMode=!0,this.maxElementsPerFrame=5,this.updateOptions({useWebGL:!1,progressiveLoading:!0,clusteringEnabled:!0}),this.clearAll(),this.logger.warn("Modo de emergencia activado para rendimiento")}disableEmergencyMode(){this.emergencyMode=!1,this.maxElementsPerFrame=10,this.logger.info("Modo de emergencia desactivado")}getMarkerIcon(n){let r="assets/leaflet/map-icons/default.svg",o=[28,28],h=[14,14],u="network-element-marker";return n.type&&(r=`assets/leaflet/map-icons/${n.type.toLowerCase()}.svg`),n.status&&(u+=` status-${n.status.toLowerCase()}`),et.default.icon({iconUrl:r,iconSize:o,iconAnchor:h,className:u})}finishConnectionEditing(){this.currentEditingConnection&&(this.logger.info(`[Renderer] Finalizando edici\xF3n de conexi\xF3n: ${this.currentEditingConnection.connection.id}`),this.currentEditingConnection.polyline&&this.currentEditingConnection.polyline.editor&&(this.currentEditingConnection.polyline.disableEdit(),this.currentEditingConnection.polyline.editEnabled=!1,this.currentEditingConnection.polyline.getElement()?.classList.remove("connection-editing")),this.handlePolylineEdit(this.currentEditingConnection.polyline,this.currentEditingConnection.connection),this.currentEditingConnection=null,this.logger.debug("[Renderer] Edici\xF3n de conexi\xF3n finalizada y cambios guardados."))}deleteSelectedConnection(){if(!this.currentEditingConnection||!this.currentEditingConnection.connection.id)return;let n=this.currentEditingConnection.connection.id;this.logger.info(`[Renderer] Eliminando conexi\xF3n seleccionada: ${n}`),this.currentEditingConnection.polyline&&(typeof this.currentEditingConnection.polyline.disableEdit=="function"&&(this.currentEditingConnection.polyline.disableEdit(),this.currentEditingConnection.polyline.editEnabled=!1),this.currentEditingConnection.polyline.getElement()?.classList.remove("connection-editing"),this.connectionsLayer.removeLayer(this.currentEditingConnection.polyline)),n&&this.connectionLines.delete(n);let r=Z(O({},this.currentEditingConnection.connection),{metadata:Z(O({},this.currentEditingConnection.connection.metadata||{}),{isDeleted:!0})});this.elementManagerAdapter.updateConnection(r).subscribe({next:o=>{o?this.logger.info(`[Renderer] Conexi\xF3n ${n} marcada como eliminada correctamente`):this.logger.warn(`[Renderer] No se pudo marcar como eliminada la conexi\xF3n ${n}`)},error:o=>{this.logger.error(`[Renderer] Error al marcar como eliminada la conexi\xF3n ${n}:`,o)}}),this.currentEditingConnection=null}static{this.\u0275fac=function(r){return new(r||i)(K(Qe),K(pt),K(il),K(xn),K(nl))}}static{this.\u0275prov=ft({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var wd={value:()=>{}};function ll(){for(var i=0,a=arguments.length,n={},r;i<a;++i){if(!(r=arguments[i]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new Cn(n)}function Cn(i){this._=i}function bd(i,a){return i.trim().split(/^|\s+/).map(function(n){var r="",o=n.indexOf(".");if(o>=0&&(r=n.slice(o+1),n=n.slice(0,o)),n&&!a.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}Cn.prototype=ll.prototype={constructor:Cn,on:function(i,a){var n=this._,r=bd(i+"",n),o,h=-1,u=r.length;if(arguments.length<2){for(;++h<u;)if((o=(i=r[h]).type)&&(o=xd(n[o],i.name)))return o;return}if(a!=null&&typeof a!="function")throw new Error("invalid callback: "+a);for(;++h<u;)if(o=(i=r[h]).type)n[o]=al(n[o],i.name,a);else if(a==null)for(o in n)n[o]=al(n[o],i.name,null);return this},copy:function(){var i={},a=this._;for(var n in a)i[n]=a[n].slice();return new Cn(i)},call:function(i,a){if((o=arguments.length-2)>0)for(var n=new Array(o),r=0,o,h;r<o;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(h=this._[i],r=0,o=h.length;r<o;++r)h[r].value.apply(a,n)},apply:function(i,a,n){if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(var r=this._[i],o=0,h=r.length;o<h;++o)r[o].value.apply(a,n)}};function xd(i,a){for(var n=0,r=i.length,o;n<r;++n)if((o=i[n]).name===a)return o.value}function al(i,a,n){for(var r=0,o=i.length;r<o;++r)if(i[r].name===a){i[r]=wd,i=i.slice(0,r).concat(i.slice(r+1));break}return n!=null&&i.push({name:a,value:n}),i}var Ie=ll;var Sn="http://www.w3.org/1999/xhtml",qr={svg:"http://www.w3.org/2000/svg",xhtml:Sn,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function ae(i){var a=i+="",n=a.indexOf(":");return n>=0&&(a=i.slice(0,n))!=="xmlns"&&(i=i.slice(n+1)),qr.hasOwnProperty(a)?{space:qr[a],local:i}:i}function Ld(i){return function(){var a=this.ownerDocument,n=this.namespaceURI;return n===Sn&&a.documentElement.namespaceURI===Sn?a.createElement(i):a.createElementNS(n,i)}}function Ed(i){return function(){return this.ownerDocument.createElementNS(i.space,i.local)}}function kn(i){var a=ae(i);return(a.local?Ed:Ld)(a)}function Md(){}function Oe(i){return i==null?Md:function(){return this.querySelector(i)}}function hl(i){typeof i!="function"&&(i=Oe(i));for(var a=this._groups,n=a.length,r=new Array(n),o=0;o<n;++o)for(var h=a[o],u=h.length,f=r[o]=new Array(u),_,p,l=0;l<u;++l)(_=h[l])&&(p=i.call(_,_.__data__,l,h))&&("__data__"in _&&(p.__data__=_.__data__),f[l]=p);return new at(r,this._parents)}function Xr(i){return i==null?[]:Array.isArray(i)?i:Array.from(i)}function Cd(){return[]}function ki(i){return i==null?Cd:function(){return this.querySelectorAll(i)}}function Sd(i){return function(){return Xr(i.apply(this,arguments))}}function cl(i){typeof i=="function"?i=Sd(i):i=ki(i);for(var a=this._groups,n=a.length,r=[],o=[],h=0;h<n;++h)for(var u=a[h],f=u.length,_,p=0;p<f;++p)(_=u[p])&&(r.push(i.call(_,_.__data__,p,u)),o.push(_));return new at(r,o)}function Pi(i){return function(){return this.matches(i)}}function Pn(i){return function(a){return a.matches(i)}}var kd=Array.prototype.find;function Pd(i){return function(){return kd.call(this.children,i)}}function Td(){return this.firstElementChild}function ul(i){return this.select(i==null?Td:Pd(typeof i=="function"?i:Pn(i)))}var Id=Array.prototype.filter;function Od(){return Array.from(this.children)}function Ad(i){return function(){return Id.call(this.children,i)}}function dl(i){return this.selectAll(i==null?Od:Ad(typeof i=="function"?i:Pn(i)))}function fl(i){typeof i!="function"&&(i=Pi(i));for(var a=this._groups,n=a.length,r=new Array(n),o=0;o<n;++o)for(var h=a[o],u=h.length,f=r[o]=[],_,p=0;p<u;++p)(_=h[p])&&i.call(_,_.__data__,p,h)&&f.push(_);return new at(r,this._parents)}function Tn(i){return new Array(i.length)}function ml(){return new at(this._enter||this._groups.map(Tn),this._parents)}function Ti(i,a){this.ownerDocument=i.ownerDocument,this.namespaceURI=i.namespaceURI,this._next=null,this._parent=i,this.__data__=a}Ti.prototype={constructor:Ti,appendChild:function(i){return this._parent.insertBefore(i,this._next)},insertBefore:function(i,a){return this._parent.insertBefore(i,a)},querySelector:function(i){return this._parent.querySelector(i)},querySelectorAll:function(i){return this._parent.querySelectorAll(i)}};function pl(i){return function(){return i}}function Dd(i,a,n,r,o,h){for(var u=0,f,_=a.length,p=h.length;u<p;++u)(f=a[u])?(f.__data__=h[u],r[u]=f):n[u]=new Ti(i,h[u]);for(;u<_;++u)(f=a[u])&&(o[u]=f)}function zd(i,a,n,r,o,h,u){var f,_,p=new Map,l=a.length,m=h.length,v=new Array(l),y;for(f=0;f<l;++f)(_=a[f])&&(v[f]=y=u.call(_,_.__data__,f,a)+"",p.has(y)?o[f]=_:p.set(y,_));for(f=0;f<m;++f)y=u.call(i,h[f],f,h)+"",(_=p.get(y))?(r[f]=_,_.__data__=h[f],p.delete(y)):n[f]=new Ti(i,h[f]);for(f=0;f<l;++f)(_=a[f])&&p.get(v[f])===_&&(o[f]=_)}function Rd(i){return i.__data__}function gl(i,a){if(!arguments.length)return Array.from(this,Rd);var n=a?zd:Dd,r=this._parents,o=this._groups;typeof i!="function"&&(i=pl(i));for(var h=o.length,u=new Array(h),f=new Array(h),_=new Array(h),p=0;p<h;++p){var l=r[p],m=o[p],v=m.length,y=Nd(i.call(l,l&&l.__data__,p,r)),M=y.length,x=f[p]=new Array(M),C=u[p]=new Array(M),k=_[p]=new Array(v);n(l,m,x,C,k,y,a);for(var T=0,D=0,S,N;T<M;++T)if(S=x[T]){for(T>=D&&(D=T+1);!(N=C[D])&&++D<M;);S._next=N||null}}return u=new at(u,r),u._enter=f,u._exit=_,u}function Nd(i){return typeof i=="object"&&"length"in i?i:Array.from(i)}function _l(){return new at(this._exit||this._groups.map(Tn),this._parents)}function vl(i,a,n){var r=this.enter(),o=this,h=this.exit();return typeof i=="function"?(r=i(r),r&&(r=r.selection())):r=r.append(i+""),a!=null&&(o=a(o),o&&(o=o.selection())),n==null?h.remove():n(h),r&&o?r.merge(o).order():o}function yl(i){for(var a=i.selection?i.selection():i,n=this._groups,r=a._groups,o=n.length,h=r.length,u=Math.min(o,h),f=new Array(o),_=0;_<u;++_)for(var p=n[_],l=r[_],m=p.length,v=f[_]=new Array(m),y,M=0;M<m;++M)(y=p[M]||l[M])&&(v[M]=y);for(;_<o;++_)f[_]=n[_];return new at(f,this._parents)}function wl(){for(var i=this._groups,a=-1,n=i.length;++a<n;)for(var r=i[a],o=r.length-1,h=r[o],u;--o>=0;)(u=r[o])&&(h&&u.compareDocumentPosition(h)^4&&h.parentNode.insertBefore(u,h),h=u);return this}function bl(i){i||(i=Bd);function a(m,v){return m&&v?i(m.__data__,v.__data__):!m-!v}for(var n=this._groups,r=n.length,o=new Array(r),h=0;h<r;++h){for(var u=n[h],f=u.length,_=o[h]=new Array(f),p,l=0;l<f;++l)(p=u[l])&&(_[l]=p);_.sort(a)}return new at(o,this._parents).order()}function Bd(i,a){return i<a?-1:i>a?1:i>=a?0:NaN}function xl(){var i=arguments[0];return arguments[0]=this,i.apply(null,arguments),this}function Ll(){return Array.from(this)}function El(){for(var i=this._groups,a=0,n=i.length;a<n;++a)for(var r=i[a],o=0,h=r.length;o<h;++o){var u=r[o];if(u)return u}return null}function Ml(){let i=0;for(let a of this)++i;return i}function Cl(){return!this.node()}function Sl(i){for(var a=this._groups,n=0,r=a.length;n<r;++n)for(var o=a[n],h=0,u=o.length,f;h<u;++h)(f=o[h])&&i.call(f,f.__data__,h,o);return this}function Zd(i){return function(){this.removeAttribute(i)}}function Fd(i){return function(){this.removeAttributeNS(i.space,i.local)}}function $d(i,a){return function(){this.setAttribute(i,a)}}function Gd(i,a){return function(){this.setAttributeNS(i.space,i.local,a)}}function Vd(i,a){return function(){var n=a.apply(this,arguments);n==null?this.removeAttribute(i):this.setAttribute(i,n)}}function jd(i,a){return function(){var n=a.apply(this,arguments);n==null?this.removeAttributeNS(i.space,i.local):this.setAttributeNS(i.space,i.local,n)}}function kl(i,a){var n=ae(i);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((a==null?n.local?Fd:Zd:typeof a=="function"?n.local?jd:Vd:n.local?Gd:$d)(n,a))}function In(i){return i.ownerDocument&&i.ownerDocument.defaultView||i.document&&i||i.defaultView}function Ud(i){return function(){this.style.removeProperty(i)}}function Hd(i,a,n){return function(){this.style.setProperty(i,a,n)}}function Wd(i,a,n){return function(){var r=a.apply(this,arguments);r==null?this.style.removeProperty(i):this.style.setProperty(i,r,n)}}function Pl(i,a,n){return arguments.length>1?this.each((a==null?Ud:typeof a=="function"?Wd:Hd)(i,a,n??"")):fe(this.node(),i)}function fe(i,a){return i.style.getPropertyValue(a)||In(i).getComputedStyle(i,null).getPropertyValue(a)}function qd(i){return function(){delete this[i]}}function Xd(i,a){return function(){this[i]=a}}function Yd(i,a){return function(){var n=a.apply(this,arguments);n==null?delete this[i]:this[i]=n}}function Tl(i,a){return arguments.length>1?this.each((a==null?qd:typeof a=="function"?Yd:Xd)(i,a)):this.node()[i]}function Il(i){return i.trim().split(/^|\s+/)}function Yr(i){return i.classList||new Ol(i)}function Ol(i){this._node=i,this._names=Il(i.getAttribute("class")||"")}Ol.prototype={add:function(i){var a=this._names.indexOf(i);a<0&&(this._names.push(i),this._node.setAttribute("class",this._names.join(" ")))},remove:function(i){var a=this._names.indexOf(i);a>=0&&(this._names.splice(a,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(i){return this._names.indexOf(i)>=0}};function Al(i,a){for(var n=Yr(i),r=-1,o=a.length;++r<o;)n.add(a[r])}function Dl(i,a){for(var n=Yr(i),r=-1,o=a.length;++r<o;)n.remove(a[r])}function Kd(i){return function(){Al(this,i)}}function Qd(i){return function(){Dl(this,i)}}function Jd(i,a){return function(){(a.apply(this,arguments)?Al:Dl)(this,i)}}function zl(i,a){var n=Il(i+"");if(arguments.length<2){for(var r=Yr(this.node()),o=-1,h=n.length;++o<h;)if(!r.contains(n[o]))return!1;return!0}return this.each((typeof a=="function"?Jd:a?Kd:Qd)(n,a))}function tf(){this.textContent=""}function ef(i){return function(){this.textContent=i}}function nf(i){return function(){var a=i.apply(this,arguments);this.textContent=a??""}}function Rl(i){return arguments.length?this.each(i==null?tf:(typeof i=="function"?nf:ef)(i)):this.node().textContent}function rf(){this.innerHTML=""}function of(i){return function(){this.innerHTML=i}}function sf(i){return function(){var a=i.apply(this,arguments);this.innerHTML=a??""}}function Nl(i){return arguments.length?this.each(i==null?rf:(typeof i=="function"?sf:of)(i)):this.node().innerHTML}function af(){this.nextSibling&&this.parentNode.appendChild(this)}function Bl(){return this.each(af)}function lf(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Zl(){return this.each(lf)}function Fl(i){var a=typeof i=="function"?i:kn(i);return this.select(function(){return this.appendChild(a.apply(this,arguments))})}function hf(){return null}function $l(i,a){var n=typeof i=="function"?i:kn(i),r=a==null?hf:typeof a=="function"?a:Oe(a);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function cf(){var i=this.parentNode;i&&i.removeChild(this)}function Gl(){return this.each(cf)}function uf(){var i=this.cloneNode(!1),a=this.parentNode;return a?a.insertBefore(i,this.nextSibling):i}function df(){var i=this.cloneNode(!0),a=this.parentNode;return a?a.insertBefore(i,this.nextSibling):i}function Vl(i){return this.select(i?df:uf)}function jl(i){return arguments.length?this.property("__data__",i):this.node().__data__}function ff(i){return function(a){i.call(this,a,this.__data__)}}function mf(i){return i.trim().split(/^|\s+/).map(function(a){var n="",r=a.indexOf(".");return r>=0&&(n=a.slice(r+1),a=a.slice(0,r)),{type:a,name:n}})}function pf(i){return function(){var a=this.__on;if(a){for(var n=0,r=-1,o=a.length,h;n<o;++n)h=a[n],(!i.type||h.type===i.type)&&h.name===i.name?this.removeEventListener(h.type,h.listener,h.options):a[++r]=h;++r?a.length=r:delete this.__on}}}function gf(i,a,n){return function(){var r=this.__on,o,h=ff(a);if(r){for(var u=0,f=r.length;u<f;++u)if((o=r[u]).type===i.type&&o.name===i.name){this.removeEventListener(o.type,o.listener,o.options),this.addEventListener(o.type,o.listener=h,o.options=n),o.value=a;return}}this.addEventListener(i.type,h,n),o={type:i.type,name:i.name,value:a,listener:h,options:n},r?r.push(o):this.__on=[o]}}function Ul(i,a,n){var r=mf(i+""),o,h=r.length,u;if(arguments.length<2){var f=this.node().__on;if(f){for(var _=0,p=f.length,l;_<p;++_)for(o=0,l=f[_];o<h;++o)if((u=r[o]).type===l.type&&u.name===l.name)return l.value}return}for(f=a?gf:pf,o=0;o<h;++o)this.each(f(r[o],a,n));return this}function Hl(i,a,n){var r=In(i),o=r.CustomEvent;typeof o=="function"?o=new o(a,n):(o=r.document.createEvent("Event"),n?(o.initEvent(a,n.bubbles,n.cancelable),o.detail=n.detail):o.initEvent(a,!1,!1)),i.dispatchEvent(o)}function _f(i,a){return function(){return Hl(this,i,a)}}function vf(i,a){return function(){return Hl(this,i,a.apply(this,arguments))}}function Wl(i,a){return this.each((typeof a=="function"?vf:_f)(i,a))}function*ql(){for(var i=this._groups,a=0,n=i.length;a<n;++a)for(var r=i[a],o=0,h=r.length,u;o<h;++o)(u=r[o])&&(yield u)}var Kr=[null];function at(i,a){this._groups=i,this._parents=a}function Xl(){return new at([[document.documentElement]],Kr)}function yf(){return this}at.prototype=Xl.prototype={constructor:at,select:hl,selectAll:cl,selectChild:ul,selectChildren:dl,filter:fl,data:gl,enter:ml,exit:_l,join:vl,merge:yl,selection:yf,order:wl,sort:bl,call:xl,nodes:Ll,node:El,size:Ml,empty:Cl,each:Sl,attr:kl,style:Pl,property:Tl,classed:zl,text:Rl,html:Nl,raise:Bl,lower:Zl,append:Fl,insert:$l,remove:Gl,clone:Vl,datum:jl,on:Ul,dispatch:Wl,[Symbol.iterator]:ql};var le=Xl;function Ae(i){return typeof i=="string"?new at([[document.querySelector(i)]],[document.documentElement]):new at([[i]],Kr)}function Yl(i){let a;for(;a=i.sourceEvent;)i=a;return i}function On(i,a){if(i=Yl(i),a===void 0&&(a=i.currentTarget),a){var n=a.ownerSVGElement||a;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=i.clientX,r.y=i.clientY,r=r.matrixTransform(a.getScreenCTM().inverse()),[r.x,r.y]}if(a.getBoundingClientRect){var o=a.getBoundingClientRect();return[i.clientX-o.left-a.clientLeft,i.clientY-o.top-a.clientTop]}}return[i.pageX,i.pageY]}var Kl={passive:!1},De={capture:!0,passive:!1};function An(i){i.stopImmediatePropagation()}function me(i){i.preventDefault(),i.stopImmediatePropagation()}function Ql(i){var a=i.document.documentElement,n=Ae(i).on("dragstart.drag",me,De);"onselectstart"in a?n.on("selectstart.drag",me,De):(a.__noselect=a.style.MozUserSelect,a.style.MozUserSelect="none")}function Jl(i,a){var n=i.document.documentElement,r=Ae(i).on("dragstart.drag",null);a&&(r.on("click.drag",me,De),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}var Ii=i=>()=>i;function Oi(i,{sourceEvent:a,subject:n,target:r,identifier:o,active:h,x:u,y:f,dx:_,dy:p,dispatch:l}){Object.defineProperties(this,{type:{value:i,enumerable:!0,configurable:!0},sourceEvent:{value:a,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:o,enumerable:!0,configurable:!0},active:{value:h,enumerable:!0,configurable:!0},x:{value:u,enumerable:!0,configurable:!0},y:{value:f,enumerable:!0,configurable:!0},dx:{value:_,enumerable:!0,configurable:!0},dy:{value:p,enumerable:!0,configurable:!0},_:{value:l}})}Oi.prototype.on=function(){var i=this._.on.apply(this._,arguments);return i===this._?this:i};function wf(i){return!i.ctrlKey&&!i.button}function bf(){return this.parentNode}function xf(i,a){return a??{x:i.x,y:i.y}}function Lf(){return navigator.maxTouchPoints||"ontouchstart"in this}function Ef(){var i=wf,a=bf,n=xf,r=Lf,o={},h=Ie("start","drag","end"),u=0,f,_,p,l,m=0;function v(S){S.on("mousedown.drag",y).filter(r).on("touchstart.drag",C).on("touchmove.drag",k,Kl).on("touchend.drag touchcancel.drag",T).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function y(S,N){if(!(l||!i.call(this,S,N))){var U=D(this,a.call(this,S,N),S,N,"mouse");U&&(Ae(S.view).on("mousemove.drag",M,De).on("mouseup.drag",x,De),Ql(S.view),An(S),p=!1,f=S.clientX,_=S.clientY,U("start",S))}}function M(S){if(me(S),!p){var N=S.clientX-f,U=S.clientY-_;p=N*N+U*U>m}o.mouse("drag",S)}function x(S){Ae(S.view).on("mousemove.drag mouseup.drag",null),Jl(S.view,p),me(S),o.mouse("end",S)}function C(S,N){if(i.call(this,S,N)){var U=S.changedTouches,X=a.call(this,S,N),rt=U.length,Q,ot;for(Q=0;Q<rt;++Q)(ot=D(this,X,S,N,U[Q].identifier,U[Q]))&&(An(S),ot("start",S,U[Q]))}}function k(S){var N=S.changedTouches,U=N.length,X,rt;for(X=0;X<U;++X)(rt=o[N[X].identifier])&&(me(S),rt("drag",S,N[X]))}function T(S){var N=S.changedTouches,U=N.length,X,rt;for(l&&clearTimeout(l),l=setTimeout(function(){l=null},500),X=0;X<U;++X)(rt=o[N[X].identifier])&&(An(S),rt("end",S,N[X]))}function D(S,N,U,X,rt,Q){var ot=h.copy(),Nt=On(Q||U,N),Bt,Wi,_t;if((_t=n.call(S,new Oi("beforestart",{sourceEvent:U,target:v,identifier:rt,active:u,x:Nt[0],y:Nt[1],dx:0,dy:0,dispatch:ot}),X))!=null)return Bt=_t.x-Nt[0]||0,Wi=_t.y-Nt[1]||0,function ye(F,li,$){var it=Nt,vt;switch(F){case"start":o[rt]=ye,vt=u++;break;case"end":delete o[rt],--u;case"drag":Nt=On($||li,N),vt=u;break}ot.call(F,S,new Oi(F,{sourceEvent:li,subject:_t,target:v,identifier:rt,active:vt,x:Nt[0]+Bt,y:Nt[1]+Wi,dx:Nt[0]-it[0],dy:Nt[1]-it[1],dispatch:ot}),X)}}return v.filter=function(S){return arguments.length?(i=typeof S=="function"?S:Ii(!!S),v):i},v.container=function(S){return arguments.length?(a=typeof S=="function"?S:Ii(S),v):a},v.subject=function(S){return arguments.length?(n=typeof S=="function"?S:Ii(S),v):n},v.touchable=function(S){return arguments.length?(r=typeof S=="function"?S:Ii(!!S),v):r},v.on=function(){var S=h.on.apply(h,arguments);return S===h?v:S},v.clickDistance=function(S){return arguments.length?(m=(S=+S)*S,v):Math.sqrt(m)},v}function Dn(i,a,n){i.prototype=a.prototype=n,n.constructor=i}function Qr(i,a){var n=Object.create(i.prototype);for(var r in a)n[r]=a[r];return n}function zi(){}var Ai=.7,Nn=1/Ai,ei="\\s*([+-]?\\d+)\\s*",Di="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ee="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Mf=/^#([0-9a-f]{3,8})$/,Cf=new RegExp(`^rgb\\(${ei},${ei},${ei}\\)$`),Sf=new RegExp(`^rgb\\(${ee},${ee},${ee}\\)$`),kf=new RegExp(`^rgba\\(${ei},${ei},${ei},${Di}\\)$`),Pf=new RegExp(`^rgba\\(${ee},${ee},${ee},${Di}\\)$`),Tf=new RegExp(`^hsl\\(${Di},${ee},${ee}\\)$`),If=new RegExp(`^hsla\\(${Di},${ee},${ee},${Di}\\)$`),th={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Dn(zi,pe,{copy(i){return Object.assign(new this.constructor,this,i)},displayable(){return this.rgb().displayable()},hex:eh,formatHex:eh,formatHex8:Of,formatHsl:Af,formatRgb:ih,toString:ih});function eh(){return this.rgb().formatHex()}function Of(){return this.rgb().formatHex8()}function Af(){return lh(this).formatHsl()}function ih(){return this.rgb().formatRgb()}function pe(i){var a,n;return i=(i+"").trim().toLowerCase(),(a=Mf.exec(i))?(n=a[1].length,a=parseInt(a[1],16),n===6?nh(a):n===3?new Dt(a>>8&15|a>>4&240,a>>4&15|a&240,(a&15)<<4|a&15,1):n===8?zn(a>>24&255,a>>16&255,a>>8&255,(a&255)/255):n===4?zn(a>>12&15|a>>8&240,a>>8&15|a>>4&240,a>>4&15|a&240,((a&15)<<4|a&15)/255):null):(a=Cf.exec(i))?new Dt(a[1],a[2],a[3],1):(a=Sf.exec(i))?new Dt(a[1]*255/100,a[2]*255/100,a[3]*255/100,1):(a=kf.exec(i))?zn(a[1],a[2],a[3],a[4]):(a=Pf.exec(i))?zn(a[1]*255/100,a[2]*255/100,a[3]*255/100,a[4]):(a=Tf.exec(i))?sh(a[1],a[2]/100,a[3]/100,1):(a=If.exec(i))?sh(a[1],a[2]/100,a[3]/100,a[4]):th.hasOwnProperty(i)?nh(th[i]):i==="transparent"?new Dt(NaN,NaN,NaN,0):null}function nh(i){return new Dt(i>>16&255,i>>8&255,i&255,1)}function zn(i,a,n,r){return r<=0&&(i=a=n=NaN),new Dt(i,a,n,r)}function Df(i){return i instanceof zi||(i=pe(i)),i?(i=i.rgb(),new Dt(i.r,i.g,i.b,i.opacity)):new Dt}function ii(i,a,n,r){return arguments.length===1?Df(i):new Dt(i,a,n,r??1)}function Dt(i,a,n,r){this.r=+i,this.g=+a,this.b=+n,this.opacity=+r}Dn(Dt,ii,Qr(zi,{brighter(i){return i=i==null?Nn:Math.pow(Nn,i),new Dt(this.r*i,this.g*i,this.b*i,this.opacity)},darker(i){return i=i==null?Ai:Math.pow(Ai,i),new Dt(this.r*i,this.g*i,this.b*i,this.opacity)},rgb(){return this},clamp(){return new Dt(Re(this.r),Re(this.g),Re(this.b),Bn(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:rh,formatHex:rh,formatHex8:zf,formatRgb:oh,toString:oh}));function rh(){return`#${ze(this.r)}${ze(this.g)}${ze(this.b)}`}function zf(){return`#${ze(this.r)}${ze(this.g)}${ze(this.b)}${ze((isNaN(this.opacity)?1:this.opacity)*255)}`}function oh(){let i=Bn(this.opacity);return`${i===1?"rgb(":"rgba("}${Re(this.r)}, ${Re(this.g)}, ${Re(this.b)}${i===1?")":`, ${i})`}`}function Bn(i){return isNaN(i)?1:Math.max(0,Math.min(1,i))}function Re(i){return Math.max(0,Math.min(255,Math.round(i)||0))}function ze(i){return i=Re(i),(i<16?"0":"")+i.toString(16)}function sh(i,a,n,r){return r<=0?i=a=n=NaN:n<=0||n>=1?i=a=NaN:a<=0&&(i=NaN),new Yt(i,a,n,r)}function lh(i){if(i instanceof Yt)return new Yt(i.h,i.s,i.l,i.opacity);if(i instanceof zi||(i=pe(i)),!i)return new Yt;if(i instanceof Yt)return i;i=i.rgb();var a=i.r/255,n=i.g/255,r=i.b/255,o=Math.min(a,n,r),h=Math.max(a,n,r),u=NaN,f=h-o,_=(h+o)/2;return f?(a===h?u=(n-r)/f+(n<r)*6:n===h?u=(r-a)/f+2:u=(a-n)/f+4,f/=_<.5?h+o:2-h-o,u*=60):f=_>0&&_<1?0:u,new Yt(u,f,_,i.opacity)}function hh(i,a,n,r){return arguments.length===1?lh(i):new Yt(i,a,n,r??1)}function Yt(i,a,n,r){this.h=+i,this.s=+a,this.l=+n,this.opacity=+r}Dn(Yt,hh,Qr(zi,{brighter(i){return i=i==null?Nn:Math.pow(Nn,i),new Yt(this.h,this.s,this.l*i,this.opacity)},darker(i){return i=i==null?Ai:Math.pow(Ai,i),new Yt(this.h,this.s,this.l*i,this.opacity)},rgb(){var i=this.h%360+(this.h<0)*360,a=isNaN(i)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*a,o=2*n-r;return new Dt(Jr(i>=240?i-240:i+120,o,r),Jr(i,o,r),Jr(i<120?i+240:i-120,o,r),this.opacity)},clamp(){return new Yt(ah(this.h),Rn(this.s),Rn(this.l),Bn(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let i=Bn(this.opacity);return`${i===1?"hsl(":"hsla("}${ah(this.h)}, ${Rn(this.s)*100}%, ${Rn(this.l)*100}%${i===1?")":`, ${i})`}`}}));function ah(i){return i=(i||0)%360,i<0?i+360:i}function Rn(i){return Math.max(0,Math.min(1,i||0))}function Jr(i,a,n){return(i<60?a+(n-a)*i/60:i<180?n:i<240?a+(n-a)*(240-i)/60:a)*255}function to(i,a,n,r,o){var h=i*i,u=h*i;return((1-3*i+3*h-u)*a+(4-6*h+3*u)*n+(1+3*i+3*h-3*u)*r+u*o)/6}function ch(i){var a=i.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,a-1):Math.floor(n*a),o=i[r],h=i[r+1],u=r>0?i[r-1]:2*o-h,f=r<a-1?i[r+2]:2*h-o;return to((n-r/a)*a,u,o,h,f)}}function uh(i){var a=i.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*a),o=i[(r+a-1)%a],h=i[r%a],u=i[(r+1)%a],f=i[(r+2)%a];return to((n-r/a)*a,o,h,u,f)}}var eo=i=>()=>i;function Rf(i,a){return function(n){return i+n*a}}function Nf(i,a,n){return i=Math.pow(i,n),a=Math.pow(a,n)-i,n=1/n,function(r){return Math.pow(i+r*a,n)}}function dh(i){return(i=+i)==1?Zn:function(a,n){return n-a?Nf(a,n,i):eo(isNaN(a)?n:a)}}function Zn(i,a){var n=a-i;return n?Rf(i,n):eo(isNaN(i)?a:i)}var Fn=function i(a){var n=dh(a);function r(o,h){var u=n((o=ii(o)).r,(h=ii(h)).r),f=n(o.g,h.g),_=n(o.b,h.b),p=Zn(o.opacity,h.opacity);return function(l){return o.r=u(l),o.g=f(l),o.b=_(l),o.opacity=p(l),o+""}}return r.gamma=i,r}(1);function fh(i){return function(a){var n=a.length,r=new Array(n),o=new Array(n),h=new Array(n),u,f;for(u=0;u<n;++u)f=ii(a[u]),r[u]=f.r||0,o[u]=f.g||0,h[u]=f.b||0;return r=i(r),o=i(o),h=i(h),f.opacity=1,function(_){return f.r=r(_),f.g=o(_),f.b=h(_),f+""}}}var Bf=fh(ch),Zf=fh(uh);function jt(i,a){return i=+i,a=+a,function(n){return i*(1-n)+a*n}}var no=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,io=new RegExp(no.source,"g");function Ff(i){return function(){return i}}function $f(i){return function(a){return i(a)+""}}function ro(i,a){var n=no.lastIndex=io.lastIndex=0,r,o,h,u=-1,f=[],_=[];for(i=i+"",a=a+"";(r=no.exec(i))&&(o=io.exec(a));)(h=o.index)>n&&(h=a.slice(n,h),f[u]?f[u]+=h:f[++u]=h),(r=r[0])===(o=o[0])?f[u]?f[u]+=o:f[++u]=o:(f[++u]=null,_.push({i:u,x:jt(r,o)})),n=io.lastIndex;return n<a.length&&(h=a.slice(n),f[u]?f[u]+=h:f[++u]=h),f.length<2?_[0]?$f(_[0].x):Ff(a):(a=_.length,function(p){for(var l=0,m;l<a;++l)f[(m=_[l]).i]=m.x(p);return f.join("")})}var mh=180/Math.PI,$n={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function oo(i,a,n,r,o,h){var u,f,_;return(u=Math.sqrt(i*i+a*a))&&(i/=u,a/=u),(_=i*n+a*r)&&(n-=i*_,r-=a*_),(f=Math.sqrt(n*n+r*r))&&(n/=f,r/=f,_/=f),i*r<a*n&&(i=-i,a=-a,_=-_,u=-u),{translateX:o,translateY:h,rotate:Math.atan2(a,i)*mh,skewX:Math.atan(_)*mh,scaleX:u,scaleY:f}}var Gn;function ph(i){let a=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(i+"");return a.isIdentity?$n:oo(a.a,a.b,a.c,a.d,a.e,a.f)}function gh(i){return i==null?$n:(Gn||(Gn=document.createElementNS("http://www.w3.org/2000/svg","g")),Gn.setAttribute("transform",i),(i=Gn.transform.baseVal.consolidate())?(i=i.matrix,oo(i.a,i.b,i.c,i.d,i.e,i.f)):$n)}function _h(i,a,n,r){function o(p){return p.length?p.pop()+" ":""}function h(p,l,m,v,y,M){if(p!==m||l!==v){var x=y.push("translate(",null,a,null,n);M.push({i:x-4,x:jt(p,m)},{i:x-2,x:jt(l,v)})}else(m||v)&&y.push("translate("+m+a+v+n)}function u(p,l,m,v){p!==l?(p-l>180?l+=360:l-p>180&&(p+=360),v.push({i:m.push(o(m)+"rotate(",null,r)-2,x:jt(p,l)})):l&&m.push(o(m)+"rotate("+l+r)}function f(p,l,m,v){p!==l?v.push({i:m.push(o(m)+"skewX(",null,r)-2,x:jt(p,l)}):l&&m.push(o(m)+"skewX("+l+r)}function _(p,l,m,v,y,M){if(p!==m||l!==v){var x=y.push(o(y)+"scale(",null,",",null,")");M.push({i:x-4,x:jt(p,m)},{i:x-2,x:jt(l,v)})}else(m!==1||v!==1)&&y.push(o(y)+"scale("+m+","+v+")")}return function(p,l){var m=[],v=[];return p=i(p),l=i(l),h(p.translateX,p.translateY,l.translateX,l.translateY,m,v),u(p.rotate,l.rotate,m,v),f(p.skewX,l.skewX,m,v),_(p.scaleX,p.scaleY,l.scaleX,l.scaleY,m,v),p=l=null,function(y){for(var M=-1,x=v.length,C;++M<x;)m[(C=v[M]).i]=C.x(y);return m.join("")}}}var so=_h(ph,"px, ","px)","deg)"),ao=_h(gh,", ",")",")");var ni=0,Ni=0,Ri=0,yh=1e3,Vn,Bi,jn=0,Ne=0,Un=0,Zi=typeof performance=="object"&&performance.now?performance:Date,wh=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(i){setTimeout(i,17)};function $i(){return Ne||(wh(Gf),Ne=Zi.now()+Un)}function Gf(){Ne=0}function Fi(){this._call=this._time=this._next=null}Fi.prototype=ri.prototype={constructor:Fi,restart:function(i,a,n){if(typeof i!="function")throw new TypeError("callback is not a function");n=(n==null?$i():+n)+(a==null?0:+a),!this._next&&Bi!==this&&(Bi?Bi._next=this:Vn=this,Bi=this),this._call=i,this._time=n,lo()},stop:function(){this._call&&(this._call=null,this._time=1/0,lo())}};function ri(i,a,n){var r=new Fi;return r.restart(i,a,n),r}function bh(){$i(),++ni;for(var i=Vn,a;i;)(a=Ne-i._time)>=0&&i._call.call(void 0,a),i=i._next;--ni}function vh(){Ne=(jn=Zi.now())+Un,ni=Ni=0;try{bh()}finally{ni=0,jf(),Ne=0}}function Vf(){var i=Zi.now(),a=i-jn;a>yh&&(Un-=a,jn=i)}function jf(){for(var i,a=Vn,n,r=1/0;a;)a._call?(r>a._time&&(r=a._time),i=a,a=a._next):(n=a._next,a._next=null,a=i?i._next=n:Vn=n);Bi=i,lo(r)}function lo(i){if(!ni){Ni&&(Ni=clearTimeout(Ni));var a=i-Ne;a>24?(i<1/0&&(Ni=setTimeout(vh,i-Zi.now()-Un)),Ri&&(Ri=clearInterval(Ri))):(Ri||(jn=Zi.now(),Ri=setInterval(Vf,yh)),ni=1,wh(vh))}}function Hn(i,a,n){var r=new Fi;return a=a==null?0:+a,r.restart(o=>{r.stop(),i(o+a)},a,n),r}var Uf=Ie("start","end","cancel","interrupt"),Hf=[],Eh=0,xh=1,qn=2,Wn=3,Lh=4,Xn=5,Gi=6;function ge(i,a,n,r,o,h){var u=i.__transition;if(!u)i.__transition={};else if(n in u)return;Wf(i,n,{name:a,index:r,group:o,on:Uf,tween:Hf,time:h.time,delay:h.delay,duration:h.duration,ease:h.ease,timer:null,state:Eh})}function Vi(i,a){var n=gt(i,a);if(n.state>Eh)throw new Error("too late; already scheduled");return n}function Ct(i,a){var n=gt(i,a);if(n.state>Wn)throw new Error("too late; already running");return n}function gt(i,a){var n=i.__transition;if(!n||!(n=n[a]))throw new Error("transition not found");return n}function Wf(i,a,n){var r=i.__transition,o;r[a]=n,n.timer=ri(h,0,n.time);function h(p){n.state=xh,n.timer.restart(u,n.delay,n.time),n.delay<=p&&u(p-n.delay)}function u(p){var l,m,v,y;if(n.state!==xh)return _();for(l in r)if(y=r[l],y.name===n.name){if(y.state===Wn)return Hn(u);y.state===Lh?(y.state=Gi,y.timer.stop(),y.on.call("interrupt",i,i.__data__,y.index,y.group),delete r[l]):+l<a&&(y.state=Gi,y.timer.stop(),y.on.call("cancel",i,i.__data__,y.index,y.group),delete r[l])}if(Hn(function(){n.state===Wn&&(n.state=Lh,n.timer.restart(f,n.delay,n.time),f(p))}),n.state=qn,n.on.call("start",i,i.__data__,n.index,n.group),n.state===qn){for(n.state=Wn,o=new Array(v=n.tween.length),l=0,m=-1;l<v;++l)(y=n.tween[l].value.call(i,i.__data__,n.index,n.group))&&(o[++m]=y);o.length=m+1}}function f(p){for(var l=p<n.duration?n.ease.call(null,p/n.duration):(n.timer.restart(_),n.state=Xn,1),m=-1,v=o.length;++m<v;)o[m].call(i,l);n.state===Xn&&(n.on.call("end",i,i.__data__,n.index,n.group),_())}function _(){n.state=Gi,n.timer.stop(),delete r[a];for(var p in r)return;delete i.__transition}}function Yn(i,a){var n=i.__transition,r,o,h=!0,u;if(n){a=a==null?null:a+"";for(u in n){if((r=n[u]).name!==a){h=!1;continue}o=r.state>qn&&r.state<Xn,r.state=Gi,r.timer.stop(),r.on.call(o?"interrupt":"cancel",i,i.__data__,r.index,r.group),delete n[u]}h&&delete i.__transition}}function Mh(i){return this.each(function(){Yn(this,i)})}function qf(i,a){var n,r;return function(){var o=Ct(this,i),h=o.tween;if(h!==n){r=n=h;for(var u=0,f=r.length;u<f;++u)if(r[u].name===a){r=r.slice(),r.splice(u,1);break}}o.tween=r}}function Xf(i,a,n){var r,o;if(typeof n!="function")throw new Error;return function(){var h=Ct(this,i),u=h.tween;if(u!==r){o=(r=u).slice();for(var f={name:a,value:n},_=0,p=o.length;_<p;++_)if(o[_].name===a){o[_]=f;break}_===p&&o.push(f)}h.tween=o}}function Ch(i,a){var n=this._id;if(i+="",arguments.length<2){for(var r=gt(this.node(),n).tween,o=0,h=r.length,u;o<h;++o)if((u=r[o]).name===i)return u.value;return null}return this.each((a==null?qf:Xf)(n,i,a))}function oi(i,a,n){var r=i._id;return i.each(function(){var o=Ct(this,r);(o.value||(o.value={}))[a]=n.apply(this,arguments)}),function(o){return gt(o,r).value[a]}}function Kn(i,a){var n;return(typeof a=="number"?jt:a instanceof pe?Fn:(n=pe(a))?(a=n,Fn):ro)(i,a)}function Yf(i){return function(){this.removeAttribute(i)}}function Kf(i){return function(){this.removeAttributeNS(i.space,i.local)}}function Qf(i,a,n){var r,o=n+"",h;return function(){var u=this.getAttribute(i);return u===o?null:u===r?h:h=a(r=u,n)}}function Jf(i,a,n){var r,o=n+"",h;return function(){var u=this.getAttributeNS(i.space,i.local);return u===o?null:u===r?h:h=a(r=u,n)}}function tm(i,a,n){var r,o,h;return function(){var u,f=n(this),_;return f==null?void this.removeAttribute(i):(u=this.getAttribute(i),_=f+"",u===_?null:u===r&&_===o?h:(o=_,h=a(r=u,f)))}}function em(i,a,n){var r,o,h;return function(){var u,f=n(this),_;return f==null?void this.removeAttributeNS(i.space,i.local):(u=this.getAttributeNS(i.space,i.local),_=f+"",u===_?null:u===r&&_===o?h:(o=_,h=a(r=u,f)))}}function Sh(i,a){var n=ae(i),r=n==="transform"?ao:Kn;return this.attrTween(i,typeof a=="function"?(n.local?em:tm)(n,r,oi(this,"attr."+i,a)):a==null?(n.local?Kf:Yf)(n):(n.local?Jf:Qf)(n,r,a))}function im(i,a){return function(n){this.setAttribute(i,a.call(this,n))}}function nm(i,a){return function(n){this.setAttributeNS(i.space,i.local,a.call(this,n))}}function rm(i,a){var n,r;function o(){var h=a.apply(this,arguments);return h!==r&&(n=(r=h)&&nm(i,h)),n}return o._value=a,o}function om(i,a){var n,r;function o(){var h=a.apply(this,arguments);return h!==r&&(n=(r=h)&&im(i,h)),n}return o._value=a,o}function kh(i,a){var n="attr."+i;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(a==null)return this.tween(n,null);if(typeof a!="function")throw new Error;var r=ae(i);return this.tween(n,(r.local?rm:om)(r,a))}function sm(i,a){return function(){Vi(this,i).delay=+a.apply(this,arguments)}}function am(i,a){return a=+a,function(){Vi(this,i).delay=a}}function Ph(i){var a=this._id;return arguments.length?this.each((typeof i=="function"?sm:am)(a,i)):gt(this.node(),a).delay}function lm(i,a){return function(){Ct(this,i).duration=+a.apply(this,arguments)}}function hm(i,a){return a=+a,function(){Ct(this,i).duration=a}}function Th(i){var a=this._id;return arguments.length?this.each((typeof i=="function"?lm:hm)(a,i)):gt(this.node(),a).duration}function cm(i,a){if(typeof a!="function")throw new Error;return function(){Ct(this,i).ease=a}}function Ih(i){var a=this._id;return arguments.length?this.each(cm(a,i)):gt(this.node(),a).ease}function um(i,a){return function(){var n=a.apply(this,arguments);if(typeof n!="function")throw new Error;Ct(this,i).ease=n}}function Oh(i){if(typeof i!="function")throw new Error;return this.each(um(this._id,i))}function Ah(i){typeof i!="function"&&(i=Pi(i));for(var a=this._groups,n=a.length,r=new Array(n),o=0;o<n;++o)for(var h=a[o],u=h.length,f=r[o]=[],_,p=0;p<u;++p)(_=h[p])&&i.call(_,_.__data__,p,h)&&f.push(_);return new Pt(r,this._parents,this._name,this._id)}function Dh(i){if(i._id!==this._id)throw new Error;for(var a=this._groups,n=i._groups,r=a.length,o=n.length,h=Math.min(r,o),u=new Array(r),f=0;f<h;++f)for(var _=a[f],p=n[f],l=_.length,m=u[f]=new Array(l),v,y=0;y<l;++y)(v=_[y]||p[y])&&(m[y]=v);for(;f<r;++f)u[f]=a[f];return new Pt(u,this._parents,this._name,this._id)}function dm(i){return(i+"").trim().split(/^|\s+/).every(function(a){var n=a.indexOf(".");return n>=0&&(a=a.slice(0,n)),!a||a==="start"})}function fm(i,a,n){var r,o,h=dm(a)?Vi:Ct;return function(){var u=h(this,i),f=u.on;f!==r&&(o=(r=f).copy()).on(a,n),u.on=o}}function zh(i,a){var n=this._id;return arguments.length<2?gt(this.node(),n).on.on(i):this.each(fm(n,i,a))}function mm(i){return function(){var a=this.parentNode;for(var n in this.__transition)if(+n!==i)return;a&&a.removeChild(this)}}function Rh(){return this.on("end.remove",mm(this._id))}function Nh(i){var a=this._name,n=this._id;typeof i!="function"&&(i=Oe(i));for(var r=this._groups,o=r.length,h=new Array(o),u=0;u<o;++u)for(var f=r[u],_=f.length,p=h[u]=new Array(_),l,m,v=0;v<_;++v)(l=f[v])&&(m=i.call(l,l.__data__,v,f))&&("__data__"in l&&(m.__data__=l.__data__),p[v]=m,ge(p[v],a,n,v,p,gt(l,n)));return new Pt(h,this._parents,a,n)}function Bh(i){var a=this._name,n=this._id;typeof i!="function"&&(i=ki(i));for(var r=this._groups,o=r.length,h=[],u=[],f=0;f<o;++f)for(var _=r[f],p=_.length,l,m=0;m<p;++m)if(l=_[m]){for(var v=i.call(l,l.__data__,m,_),y,M=gt(l,n),x=0,C=v.length;x<C;++x)(y=v[x])&&ge(y,a,n,x,v,M);h.push(v),u.push(l)}return new Pt(h,u,a,n)}var pm=le.prototype.constructor;function Zh(){return new pm(this._groups,this._parents)}function gm(i,a){var n,r,o;return function(){var h=fe(this,i),u=(this.style.removeProperty(i),fe(this,i));return h===u?null:h===n&&u===r?o:o=a(n=h,r=u)}}function Fh(i){return function(){this.style.removeProperty(i)}}function _m(i,a,n){var r,o=n+"",h;return function(){var u=fe(this,i);return u===o?null:u===r?h:h=a(r=u,n)}}function vm(i,a,n){var r,o,h;return function(){var u=fe(this,i),f=n(this),_=f+"";return f==null&&(_=f=(this.style.removeProperty(i),fe(this,i))),u===_?null:u===r&&_===o?h:(o=_,h=a(r=u,f))}}function ym(i,a){var n,r,o,h="style."+a,u="end."+h,f;return function(){var _=Ct(this,i),p=_.on,l=_.value[h]==null?f||(f=Fh(a)):void 0;(p!==n||o!==l)&&(r=(n=p).copy()).on(u,o=l),_.on=r}}function $h(i,a,n){var r=(i+="")=="transform"?so:Kn;return a==null?this.styleTween(i,gm(i,r)).on("end.style."+i,Fh(i)):typeof a=="function"?this.styleTween(i,vm(i,r,oi(this,"style."+i,a))).each(ym(this._id,i)):this.styleTween(i,_m(i,r,a),n).on("end.style."+i,null)}function wm(i,a,n){return function(r){this.style.setProperty(i,a.call(this,r),n)}}function bm(i,a,n){var r,o;function h(){var u=a.apply(this,arguments);return u!==o&&(r=(o=u)&&wm(i,u,n)),r}return h._value=a,h}function Gh(i,a,n){var r="style."+(i+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(a==null)return this.tween(r,null);if(typeof a!="function")throw new Error;return this.tween(r,bm(i,a,n??""))}function xm(i){return function(){this.textContent=i}}function Lm(i){return function(){var a=i(this);this.textContent=a??""}}function Vh(i){return this.tween("text",typeof i=="function"?Lm(oi(this,"text",i)):xm(i==null?"":i+""))}function Em(i){return function(a){this.textContent=i.call(this,a)}}function Mm(i){var a,n;function r(){var o=i.apply(this,arguments);return o!==n&&(a=(n=o)&&Em(o)),a}return r._value=i,r}function jh(i){var a="text";if(arguments.length<1)return(a=this.tween(a))&&a._value;if(i==null)return this.tween(a,null);if(typeof i!="function")throw new Error;return this.tween(a,Mm(i))}function Uh(){for(var i=this._name,a=this._id,n=Qn(),r=this._groups,o=r.length,h=0;h<o;++h)for(var u=r[h],f=u.length,_,p=0;p<f;++p)if(_=u[p]){var l=gt(_,a);ge(_,i,n,p,u,{time:l.time+l.delay+l.duration,delay:0,duration:l.duration,ease:l.ease})}return new Pt(r,this._parents,i,n)}function Hh(){var i,a,n=this,r=n._id,o=n.size();return new Promise(function(h,u){var f={value:u},_={value:function(){--o===0&&h()}};n.each(function(){var p=Ct(this,r),l=p.on;l!==i&&(a=(i=l).copy(),a._.cancel.push(f),a._.interrupt.push(f),a._.end.push(_)),p.on=a}),o===0&&h()})}var Cm=0;function Pt(i,a,n,r){this._groups=i,this._parents=a,this._name=n,this._id=r}function Wh(i){return le().transition(i)}function Qn(){return++Cm}var he=le.prototype;Pt.prototype=Wh.prototype={constructor:Pt,select:Nh,selectAll:Bh,selectChild:he.selectChild,selectChildren:he.selectChildren,filter:Ah,merge:Dh,selection:Zh,transition:Uh,call:he.call,nodes:he.nodes,node:he.node,size:he.size,empty:he.empty,each:he.each,on:zh,attr:Sh,attrTween:kh,style:$h,styleTween:Gh,text:Vh,textTween:jh,remove:Rh,tween:Ch,delay:Ph,duration:Th,ease:Ih,easeVarying:Oh,end:Hh,[Symbol.iterator]:he[Symbol.iterator]};function Jn(i){return((i*=2)<=1?i*i*i:(i-=2)*i*i+2)/2}var Sm={time:null,delay:0,duration:250,ease:Jn};function km(i,a){for(var n;!(n=i.__transition)||!(n=n[a]);)if(!(i=i.parentNode))throw new Error(`transition ${a} not found`);return n}function qh(i){var a,n;i instanceof Pt?(a=i._id,i=i._name):(a=Qn(),(n=Sm).time=$i(),i=i==null?null:i+"");for(var r=this._groups,o=r.length,h=0;h<o;++h)for(var u=r[h],f=u.length,_,p=0;p<f;++p)(_=u[p])&&ge(_,i,a,p,u,n||km(_,a));return new Pt(r,this._parents,i,a)}le.prototype.interrupt=Mh;le.prototype.transition=qh;var{abs:V0,max:j0,min:U0}=Math;function Xh(i){return[+i[0],+i[1]]}function Pm(i){return[Xh(i[0]),Xh(i[1])]}var H0={name:"x",handles:["w","e"].map(ho),input:function(i,a){return i==null?null:[[+i[0],a[0][1]],[+i[1],a[1][1]]]},output:function(i){return i&&[i[0][0],i[1][0]]}},W0={name:"y",handles:["n","s"].map(ho),input:function(i,a){return i==null?null:[[a[0][0],+i[0]],[a[1][0],+i[1]]]},output:function(i){return i&&[i[0][1],i[1][1]]}},q0={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(ho),input:function(i){return i==null?null:Pm(i)},output:function(i){return i}};function ho(i){return{type:i}}var co=Math.PI,uo=2*co,Be=1e-6,Tm=uo-Be;function Yh(i){this._+=i[0];for(let a=1,n=i.length;a<n;++a)this._+=arguments[a]+i[a]}function Im(i){let a=Math.floor(i);if(!(a>=0))throw new Error(`invalid digits: ${i}`);if(a>15)return Yh;let n=10**a;return function(r){this._+=r[0];for(let o=1,h=r.length;o<h;++o)this._+=Math.round(arguments[o]*n)/n+r[o]}}var Ze=class{constructor(a){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=a==null?Yh:Im(a)}moveTo(a,n){this._append`M${this._x0=this._x1=+a},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(a,n){this._append`L${this._x1=+a},${this._y1=+n}`}quadraticCurveTo(a,n,r,o){this._append`Q${+a},${+n},${this._x1=+r},${this._y1=+o}`}bezierCurveTo(a,n,r,o,h,u){this._append`C${+a},${+n},${+r},${+o},${this._x1=+h},${this._y1=+u}`}arcTo(a,n,r,o,h){if(a=+a,n=+n,r=+r,o=+o,h=+h,h<0)throw new Error(`negative radius: ${h}`);let u=this._x1,f=this._y1,_=r-a,p=o-n,l=u-a,m=f-n,v=l*l+m*m;if(this._x1===null)this._append`M${this._x1=a},${this._y1=n}`;else if(v>Be)if(!(Math.abs(m*_-p*l)>Be)||!h)this._append`L${this._x1=a},${this._y1=n}`;else{let y=r-u,M=o-f,x=_*_+p*p,C=y*y+M*M,k=Math.sqrt(x),T=Math.sqrt(v),D=h*Math.tan((co-Math.acos((x+v-C)/(2*k*T)))/2),S=D/T,N=D/k;Math.abs(S-1)>Be&&this._append`L${a+S*l},${n+S*m}`,this._append`A${h},${h},0,0,${+(m*y>l*M)},${this._x1=a+N*_},${this._y1=n+N*p}`}}arc(a,n,r,o,h,u){if(a=+a,n=+n,r=+r,u=!!u,r<0)throw new Error(`negative radius: ${r}`);let f=r*Math.cos(o),_=r*Math.sin(o),p=a+f,l=n+_,m=1^u,v=u?o-h:h-o;this._x1===null?this._append`M${p},${l}`:(Math.abs(this._x1-p)>Be||Math.abs(this._y1-l)>Be)&&this._append`L${p},${l}`,r&&(v<0&&(v=v%uo+uo),v>Tm?this._append`A${r},${r},0,1,${m},${a-f},${n-_}A${r},${r},0,1,${m},${this._x1=p},${this._y1=l}`:v>Be&&this._append`A${r},${r},0,${+(v>=co)},${m},${this._x1=a+r*Math.cos(h)},${this._y1=n+r*Math.sin(h)}`)}rect(a,n,r,o){this._append`M${this._x0=this._x1=+a},${this._y0=this._y1=+n}h${r=+r}v${+o}h${-r}Z`}toString(){return this._}};function Kh(){return new Ze}Kh.prototype=Ze.prototype;function Om(i,a){var n,r=1;i==null&&(i=0),a==null&&(a=0);function o(){var h,u=n.length,f,_=0,p=0;for(h=0;h<u;++h)f=n[h],_+=f.x,p+=f.y;for(_=(_/u-i)*r,p=(p/u-a)*r,h=0;h<u;++h)f=n[h],f.x-=_,f.y-=p}return o.initialize=function(h){n=h},o.x=function(h){return arguments.length?(i=+h,o):i},o.y=function(h){return arguments.length?(a=+h,o):a},o.strength=function(h){return arguments.length?(r=+h,o):r},o}function Qh(i){let a=+this._x.call(null,i),n=+this._y.call(null,i);return Jh(this.cover(a,n),a,n,i)}function Jh(i,a,n,r){if(isNaN(a)||isNaN(n))return i;var o,h=i._root,u={data:r},f=i._x0,_=i._y0,p=i._x1,l=i._y1,m,v,y,M,x,C,k,T;if(!h)return i._root=u,i;for(;h.length;)if((x=a>=(m=(f+p)/2))?f=m:p=m,(C=n>=(v=(_+l)/2))?_=v:l=v,o=h,!(h=h[k=C<<1|x]))return o[k]=u,i;if(y=+i._x.call(null,h.data),M=+i._y.call(null,h.data),a===y&&n===M)return u.next=h,o?o[k]=u:i._root=u,i;do o=o?o[k]=new Array(4):i._root=new Array(4),(x=a>=(m=(f+p)/2))?f=m:p=m,(C=n>=(v=(_+l)/2))?_=v:l=v;while((k=C<<1|x)===(T=(M>=v)<<1|y>=m));return o[T]=h,o[k]=u,i}function tc(i){var a,n,r=i.length,o,h,u=new Array(r),f=new Array(r),_=1/0,p=1/0,l=-1/0,m=-1/0;for(n=0;n<r;++n)isNaN(o=+this._x.call(null,a=i[n]))||isNaN(h=+this._y.call(null,a))||(u[n]=o,f[n]=h,o<_&&(_=o),o>l&&(l=o),h<p&&(p=h),h>m&&(m=h));if(_>l||p>m)return this;for(this.cover(_,p).cover(l,m),n=0;n<r;++n)Jh(this,u[n],f[n],i[n]);return this}function ec(i,a){if(isNaN(i=+i)||isNaN(a=+a))return this;var n=this._x0,r=this._y0,o=this._x1,h=this._y1;if(isNaN(n))o=(n=Math.floor(i))+1,h=(r=Math.floor(a))+1;else{for(var u=o-n||1,f=this._root,_,p;n>i||i>=o||r>a||a>=h;)switch(p=(a<r)<<1|i<n,_=new Array(4),_[p]=f,f=_,u*=2,p){case 0:o=n+u,h=r+u;break;case 1:n=o-u,h=r+u;break;case 2:o=n+u,r=h-u;break;case 3:n=o-u,r=h-u;break}this._root&&this._root.length&&(this._root=f)}return this._x0=n,this._y0=r,this._x1=o,this._y1=h,this}function ic(){var i=[];return this.visit(function(a){if(!a.length)do i.push(a.data);while(a=a.next)}),i}function nc(i){return arguments.length?this.cover(+i[0][0],+i[0][1]).cover(+i[1][0],+i[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function bt(i,a,n,r,o){this.node=i,this.x0=a,this.y0=n,this.x1=r,this.y1=o}function rc(i,a,n){var r,o=this._x0,h=this._y0,u,f,_,p,l=this._x1,m=this._y1,v=[],y=this._root,M,x;for(y&&v.push(new bt(y,o,h,l,m)),n==null?n=1/0:(o=i-n,h=a-n,l=i+n,m=a+n,n*=n);M=v.pop();)if(!(!(y=M.node)||(u=M.x0)>l||(f=M.y0)>m||(_=M.x1)<o||(p=M.y1)<h))if(y.length){var C=(u+_)/2,k=(f+p)/2;v.push(new bt(y[3],C,k,_,p),new bt(y[2],u,k,C,p),new bt(y[1],C,f,_,k),new bt(y[0],u,f,C,k)),(x=(a>=k)<<1|i>=C)&&(M=v[v.length-1],v[v.length-1]=v[v.length-1-x],v[v.length-1-x]=M)}else{var T=i-+this._x.call(null,y.data),D=a-+this._y.call(null,y.data),S=T*T+D*D;if(S<n){var N=Math.sqrt(n=S);o=i-N,h=a-N,l=i+N,m=a+N,r=y.data}}return r}function oc(i){if(isNaN(l=+this._x.call(null,i))||isNaN(m=+this._y.call(null,i)))return this;var a,n=this._root,r,o,h,u=this._x0,f=this._y0,_=this._x1,p=this._y1,l,m,v,y,M,x,C,k;if(!n)return this;if(n.length)for(;;){if((M=l>=(v=(u+_)/2))?u=v:_=v,(x=m>=(y=(f+p)/2))?f=y:p=y,a=n,!(n=n[C=x<<1|M]))return this;if(!n.length)break;(a[C+1&3]||a[C+2&3]||a[C+3&3])&&(r=a,k=C)}for(;n.data!==i;)if(o=n,!(n=n.next))return this;return(h=n.next)&&delete n.next,o?(h?o.next=h:delete o.next,this):a?(h?a[C]=h:delete a[C],(n=a[0]||a[1]||a[2]||a[3])&&n===(a[3]||a[2]||a[1]||a[0])&&!n.length&&(r?r[k]=n:this._root=n),this):(this._root=h,this)}function sc(i){for(var a=0,n=i.length;a<n;++a)this.remove(i[a]);return this}function ac(){return this._root}function lc(){var i=0;return this.visit(function(a){if(!a.length)do++i;while(a=a.next)}),i}function hc(i){var a=[],n,r=this._root,o,h,u,f,_;for(r&&a.push(new bt(r,this._x0,this._y0,this._x1,this._y1));n=a.pop();)if(!i(r=n.node,h=n.x0,u=n.y0,f=n.x1,_=n.y1)&&r.length){var p=(h+f)/2,l=(u+_)/2;(o=r[3])&&a.push(new bt(o,p,l,f,_)),(o=r[2])&&a.push(new bt(o,h,l,p,_)),(o=r[1])&&a.push(new bt(o,p,u,f,l)),(o=r[0])&&a.push(new bt(o,h,u,p,l))}return this}function cc(i){var a=[],n=[],r;for(this._root&&a.push(new bt(this._root,this._x0,this._y0,this._x1,this._y1));r=a.pop();){var o=r.node;if(o.length){var h,u=r.x0,f=r.y0,_=r.x1,p=r.y1,l=(u+_)/2,m=(f+p)/2;(h=o[0])&&a.push(new bt(h,u,f,l,m)),(h=o[1])&&a.push(new bt(h,l,f,_,m)),(h=o[2])&&a.push(new bt(h,u,m,l,p)),(h=o[3])&&a.push(new bt(h,l,m,_,p))}n.push(r)}for(;r=n.pop();)i(r.node,r.x0,r.y0,r.x1,r.y1);return this}function uc(i){return i[0]}function dc(i){return arguments.length?(this._x=i,this):this._x}function fc(i){return i[1]}function mc(i){return arguments.length?(this._y=i,this):this._y}function ji(i,a,n){var r=new fo(a??uc,n??fc,NaN,NaN,NaN,NaN);return i==null?r:r.addAll(i)}function fo(i,a,n,r,o,h){this._x=i,this._y=a,this._x0=n,this._y0=r,this._x1=o,this._y1=h,this._root=void 0}function pc(i){for(var a={data:i.data},n=a;i=i.next;)n=n.next={data:i.data};return a}var Tt=ji.prototype=fo.prototype;Tt.copy=function(){var i=new fo(this._x,this._y,this._x0,this._y0,this._x1,this._y1),a=this._root,n,r;if(!a)return i;if(!a.length)return i._root=pc(a),i;for(n=[{source:a,target:i._root=new Array(4)}];a=n.pop();)for(var o=0;o<4;++o)(r=a.source[o])&&(r.length?n.push({source:r,target:a.target[o]=new Array(4)}):a.target[o]=pc(r));return i};Tt.add=Qh;Tt.addAll=tc;Tt.cover=ec;Tt.data=ic;Tt.extent=nc;Tt.find=rc;Tt.remove=oc;Tt.removeAll=sc;Tt.root=ac;Tt.size=lc;Tt.visit=hc;Tt.visitAfter=cc;Tt.x=dc;Tt.y=mc;function Fe(i){return function(){return i}}function _e(i){return(i()-.5)*1e-6}function Am(i){return i.index}function gc(i,a){var n=i.get(a);if(!n)throw new Error("node not found: "+a);return n}function Dm(i){var a=Am,n=m,r,o=Fe(30),h,u,f,_,p,l=1;i==null&&(i=[]);function m(C){return 1/Math.min(f[C.source.index],f[C.target.index])}function v(C){for(var k=0,T=i.length;k<l;++k)for(var D=0,S,N,U,X,rt,Q,ot;D<T;++D)S=i[D],N=S.source,U=S.target,X=U.x+U.vx-N.x-N.vx||_e(p),rt=U.y+U.vy-N.y-N.vy||_e(p),Q=Math.sqrt(X*X+rt*rt),Q=(Q-h[D])/Q*C*r[D],X*=Q,rt*=Q,U.vx-=X*(ot=_[D]),U.vy-=rt*ot,N.vx+=X*(ot=1-ot),N.vy+=rt*ot}function y(){if(u){var C,k=u.length,T=i.length,D=new Map(u.map((N,U)=>[a(N,U,u),N])),S;for(C=0,f=new Array(k);C<T;++C)S=i[C],S.index=C,typeof S.source!="object"&&(S.source=gc(D,S.source)),typeof S.target!="object"&&(S.target=gc(D,S.target)),f[S.source.index]=(f[S.source.index]||0)+1,f[S.target.index]=(f[S.target.index]||0)+1;for(C=0,_=new Array(T);C<T;++C)S=i[C],_[C]=f[S.source.index]/(f[S.source.index]+f[S.target.index]);r=new Array(T),M(),h=new Array(T),x()}}function M(){if(u)for(var C=0,k=i.length;C<k;++C)r[C]=+n(i[C],C,i)}function x(){if(u)for(var C=0,k=i.length;C<k;++C)h[C]=+o(i[C],C,i)}return v.initialize=function(C,k){u=C,p=k,y()},v.links=function(C){return arguments.length?(i=C,y(),v):i},v.id=function(C){return arguments.length?(a=C,v):a},v.iterations=function(C){return arguments.length?(l=+C,v):l},v.strength=function(C){return arguments.length?(n=typeof C=="function"?C:Fe(+C),M(),v):n},v.distance=function(C){return arguments.length?(o=typeof C=="function"?C:Fe(+C),x(),v):o},v}function _c(){let i=1;return()=>(i=(1664525*i+1013904223)%4294967296)/4294967296}function vc(i){return i.x}function yc(i){return i.y}var zm=10,Rm=Math.PI*(3-Math.sqrt(5));function Nm(i){var a,n=1,r=.001,o=1-Math.pow(r,1/300),h=0,u=.6,f=new Map,_=ri(m),p=Ie("tick","end"),l=_c();i==null&&(i=[]);function m(){v(),p.call("tick",a),n<r&&(_.stop(),p.call("end",a))}function v(x){var C,k=i.length,T;x===void 0&&(x=1);for(var D=0;D<x;++D)for(n+=(h-n)*o,f.forEach(function(S){S(n)}),C=0;C<k;++C)T=i[C],T.fx==null?T.x+=T.vx*=u:(T.x=T.fx,T.vx=0),T.fy==null?T.y+=T.vy*=u:(T.y=T.fy,T.vy=0);return a}function y(){for(var x=0,C=i.length,k;x<C;++x){if(k=i[x],k.index=x,k.fx!=null&&(k.x=k.fx),k.fy!=null&&(k.y=k.fy),isNaN(k.x)||isNaN(k.y)){var T=zm*Math.sqrt(.5+x),D=x*Rm;k.x=T*Math.cos(D),k.y=T*Math.sin(D)}(isNaN(k.vx)||isNaN(k.vy))&&(k.vx=k.vy=0)}}function M(x){return x.initialize&&x.initialize(i,l),x}return y(),a={tick:v,restart:function(){return _.restart(m),a},stop:function(){return _.stop(),a},nodes:function(x){return arguments.length?(i=x,y(),f.forEach(M),a):i},alpha:function(x){return arguments.length?(n=+x,a):n},alphaMin:function(x){return arguments.length?(r=+x,a):r},alphaDecay:function(x){return arguments.length?(o=+x,a):+o},alphaTarget:function(x){return arguments.length?(h=+x,a):h},velocityDecay:function(x){return arguments.length?(u=1-x,a):1-u},randomSource:function(x){return arguments.length?(l=x,f.forEach(M),a):l},force:function(x,C){return arguments.length>1?(C==null?f.delete(x):f.set(x,M(C)),a):f.get(x)},find:function(x,C,k){var T=0,D=i.length,S,N,U,X,rt;for(k==null?k=1/0:k*=k,T=0;T<D;++T)X=i[T],S=x-X.x,N=C-X.y,U=S*S+N*N,U<k&&(rt=X,k=U);return rt},on:function(x,C){return arguments.length>1?(p.on(x,C),a):p.on(x)}}}function Bm(){var i,a,n,r,o=Fe(-30),h,u=1,f=1/0,_=.81;function p(y){var M,x=i.length,C=ji(i,vc,yc).visitAfter(m);for(r=y,M=0;M<x;++M)a=i[M],C.visit(v)}function l(){if(i){var y,M=i.length,x;for(h=new Array(M),y=0;y<M;++y)x=i[y],h[x.index]=+o(x,y,i)}}function m(y){var M=0,x,C,k=0,T,D,S;if(y.length){for(T=D=S=0;S<4;++S)(x=y[S])&&(C=Math.abs(x.value))&&(M+=x.value,k+=C,T+=C*x.x,D+=C*x.y);y.x=T/k,y.y=D/k}else{x=y,x.x=x.data.x,x.y=x.data.y;do M+=h[x.data.index];while(x=x.next)}y.value=M}function v(y,M,x,C){if(!y.value)return!0;var k=y.x-a.x,T=y.y-a.y,D=C-M,S=k*k+T*T;if(D*D/_<S)return S<f&&(k===0&&(k=_e(n),S+=k*k),T===0&&(T=_e(n),S+=T*T),S<u&&(S=Math.sqrt(u*S)),a.vx+=k*y.value*r/S,a.vy+=T*y.value*r/S),!0;if(y.length||S>=f)return;(y.data!==a||y.next)&&(k===0&&(k=_e(n),S+=k*k),T===0&&(T=_e(n),S+=T*T),S<u&&(S=Math.sqrt(u*S)));do y.data!==a&&(D=h[y.data.index]*r/S,a.vx+=k*D,a.vy+=T*D);while(y=y.next)}return p.initialize=function(y,M){i=y,n=M,l()},p.strength=function(y){return arguments.length?(o=typeof y=="function"?y:Fe(+y),l(),p):o},p.distanceMin=function(y){return arguments.length?(u=y*y,p):Math.sqrt(u)},p.distanceMax=function(y){return arguments.length?(f=y*y,p):Math.sqrt(f)},p.theta=function(y){return arguments.length?(_=y*y,p):Math.sqrt(_)},p}function Ui(i){return function(){return i}}var mo=Math.cos;var Hi=Math.sin,xt=Math.sqrt;var $e=Math.PI,ox=$e/2,si=2*$e;function wc(i){let a=3;return i.digits=function(n){if(!arguments.length)return a;if(n==null)a=null;else{let r=Math.floor(n);if(!(r>=0))throw new RangeError(`invalid digits: ${n}`);a=r}return i},()=>new Ze(a)}var po={draw(i,a){let n=xt(a/$e);i.moveTo(n,0),i.arc(0,0,n,0,si)}};var Zm={draw(i,a){let n=xt(a/5)/2;i.moveTo(-3*n,-n),i.lineTo(-n,-n),i.lineTo(-n,-3*n),i.lineTo(n,-3*n),i.lineTo(n,-n),i.lineTo(3*n,-n),i.lineTo(3*n,n),i.lineTo(n,n),i.lineTo(n,3*n),i.lineTo(-n,3*n),i.lineTo(-n,n),i.lineTo(-3*n,n),i.closePath()}};var bc=xt(1/3),Fm=bc*2,$m={draw(i,a){let n=xt(a/Fm),r=n*bc;i.moveTo(0,-n),i.lineTo(r,0),i.lineTo(0,n),i.lineTo(-r,0),i.closePath()}};var Gm={draw(i,a){let n=xt(a),r=-n/2;i.rect(r,r,n,n)}};var Vm=.8908130915292852,xc=Hi($e/10)/Hi(7*$e/10),jm=Hi(si/10)*xc,Um=-mo(si/10)*xc,Hm={draw(i,a){let n=xt(a*Vm),r=jm*n,o=Um*n;i.moveTo(0,-n),i.lineTo(r,o);for(let h=1;h<5;++h){let u=si*h/5,f=mo(u),_=Hi(u);i.lineTo(_*n,-f*n),i.lineTo(f*r-_*o,_*r+f*o)}i.closePath()}};var go=xt(3),Wm={draw(i,a){let n=-xt(a/(go*3));i.moveTo(0,n*2),i.lineTo(-go*n,-n),i.lineTo(go*n,-n),i.closePath()}};var Ut=-.5,Ht=xt(3)/2,_o=1/xt(12),qm=(_o/2+1)*3,Xm={draw(i,a){let n=xt(a/qm),r=n/2,o=n*_o,h=r,u=n*_o+n,f=-h,_=u;i.moveTo(r,o),i.lineTo(h,u),i.lineTo(f,_),i.lineTo(Ut*r-Ht*o,Ht*r+Ut*o),i.lineTo(Ut*h-Ht*u,Ht*h+Ut*u),i.lineTo(Ut*f-Ht*_,Ht*f+Ut*_),i.lineTo(Ut*r+Ht*o,Ut*o-Ht*r),i.lineTo(Ut*h+Ht*u,Ut*u-Ht*h),i.lineTo(Ut*f+Ht*_,Ut*_-Ht*f),i.closePath()}};function Lc(i,a){let n=null,r=wc(o);i=typeof i=="function"?i:Ui(i||po),a=typeof a=="function"?a:Ui(a===void 0?64:+a);function o(){let h;if(n||(n=h=r()),i.apply(this,arguments).draw(n,+a.apply(this,arguments)),h)return n=null,h+""||null}return o.type=function(h){return arguments.length?(i=typeof h=="function"?h:Ui(h),o):i},o.size=function(h){return arguments.length?(a=typeof h=="function"?h:Ui(+h),o):a},o.context=function(h){return arguments.length?(n=h??null,o):n},o}function ve(i,a,n){this.k=i,this.x=a,this.y=n}ve.prototype={constructor:ve,scale:function(i){return i===1?this:new ve(this.k*i,this.x,this.y)},translate:function(i,a){return i===0&a===0?this:new ve(this.k,this.x+this.k*i,this.y+this.k*a)},apply:function(i){return[i[0]*this.k+this.x,i[1]*this.k+this.y]},applyX:function(i){return i*this.k+this.x},applyY:function(i){return i*this.k+this.y},invert:function(i){return[(i[0]-this.x)/this.k,(i[1]-this.y)/this.k]},invertX:function(i){return(i-this.x)/this.k},invertY:function(i){return(i-this.y)/this.k},rescaleX:function(i){return i.copy().domain(i.range().map(this.invertX,this).map(i.invert,i))},rescaleY:function(i){return i.copy().domain(i.range().map(this.invertY,this).map(i.invert,i))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var vo=new ve(1,0,0);ai.prototype=ve.prototype;function ai(i){for(;!i.__zoom;)if(!(i=i.parentNode))return vo;return i.__zoom}var R=Li(Si()),$L=Li(Cc());var OL=new Se("MapService"),Sc=new Se("NetworkStateService"),AL=new Se("MapElementService"),DL=new Se("NetworkDesignService");var KL=(()=>{class i{constructor(n,r,o){this.zone=n,this.eventBus=r,this.networkStateService=o,this.logger=Et(pt),this.mapStateService=Et(el),this.mapStateManagerService=Et(xn),this.networkMapRendererService=Et(sl),this.mapElementManagerService=Et(En),this.destroy$=new dt,this.mapElementRef=new mn(null),this.isInitialized=!1,this.isInteractionEnabled=!0,this.isReadySubject=new z(!1),this.currentToolSubject=new z("pan"),this.isReady$=this.isReadySubject.asObservable(),this.currentTool$=this.currentToolSubject.asObservable(),this.svg=null,this.container=null,this.zoomBehavior=null,this.simulation=null,this.width=0,this.height=0,this.currentMapZoom=1,this.selectedElement=null,this.currentToolActive="pan",this.isMapDarkMode=!1,this.serviceConfig=null,this.map=null,this.isPositionSelectionEnabled=!1,this.positionMarker=null,this.previewMarker=null,this.selectedPosition=null,this.selectedPositionSubject=new dt,this.measuringPoints=[],this.measurementPolyline=null,this.measurementMarkers=[],this.areaSelectionRectangle=null,this.areaSelectionStartPoint=null,this.isDrawingAreaSelection=!1,this.edgePanningZone=50,this.edgePanningSpeed=10,this.edgePanningAnimationFrameId=null,this.currentPanDirection={x:0,y:0},this.nodesData=[],this.linksData=[],this.internalIsDarkMode$=new z(!1),this.currentBaseLayerId$=new z("osm"),this.activeTileLayer=null,this.isDarkMode$=this.internalIsDarkMode$.asObservable(),this.baseLayers={osm:{id:"osm",name:"OpenStreetMap",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",options:{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',errorTileUrl:"assets/leaflet/error-tiles/error-tile.png",crossOrigin:!0,maxZoom:19}},satellite:{id:"satellite",name:"Sat\xE9lite",url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community",errorTileUrl:"assets/leaflet/error-tiles/error-tile.png",crossOrigin:!0,maxZoom:18}},terrain:{id:"terrain",name:"Terreno",url:"https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",options:{attribution:'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)',errorTileUrl:"assets/leaflet/error-tiles/error-tile.png",crossOrigin:!0,maxZoom:17}}},this.handleMapClick=h=>{if(!this.isPositionSelectionEnabled||!this.map)return;let u=h.latlng;if(this.selectedPosition={lat:u.lat,lng:u.lng},this.selectedPositionSubject.next(this.selectedPosition),this.positionMarker)this.positionMarker.setLatLng(u);else{let f=R.icon({iconUrl:"assets/leaflet/map-icons/position-marker.svg",iconSize:[32,32],iconAnchor:[16,32]});this.positionMarker=R.marker(u,{icon:f,draggable:!0}).addTo(this.map),this.positionMarker.on("dragend",()=>{if(this.positionMarker){let _=this.positionMarker.getLatLng();this.selectedPosition={lat:_.lat,lng:_.lng},this.selectedPositionSubject.next(this.selectedPosition)}})}},this.handleMapSelectionClick=h=>{this.logger.debug("Clic en mapa vac\xEDo con herramienta seleccionar. Limpiando selecci\xF3n."),this.mapStateManagerService.clearSelectedElements()},this.handleMeasureMapClick=h=>{if(!this.map||this.currentToolActive!=="measure")return;let u=h.latlng,f=0,_=0;if(this.measuringPoints.push(u),this.measuringPoints.length>=2){let m=this.measuringPoints[this.measuringPoints.length-2],v=u.distanceTo(m);f=parseFloat((v/1e3).toFixed(2))}if(this.measuringPoints.length>=2){_=0;for(let m=1;m<this.measuringPoints.length;m++)_+=this.measuringPoints[m].distanceTo(this.measuringPoints[m-1]);_=parseFloat((_/1e3).toFixed(2))}let p=R.circleMarker(u,{radius:6,color:"blue",fillColor:"#3388ff",fillOpacity:.7,weight:1}).addTo(this.map),l="";this.measuringPoints.length===1?l="Punto inicial":(l=`Segmento: ${f} km`,this.measuringPoints.length>=2&&(l+=`<br>Total: ${_} km`)),p.bindTooltip(l,{permanent:!0,direction:"top",offset:[0,-7],className:"measurement-tooltip"}).openTooltip(),this.measurementMarkers.push(p),this.measuringPoints.length>=2&&(this.measurementPolyline?this.measurementPolyline.setLatLngs(this.measuringPoints):this.measurementPolyline=R.polyline(this.measuringPoints,{color:"blue"}).addTo(this.map)),this.logger.debug(`Punto de medici\xF3n a\xF1adido: ${u}. Total puntos: ${this.measuringPoints.length}`)},this.handleAreaSelectMouseDown=h=>{if(!this.map||this.currentToolActive!=="areaSelect"||h.button!==0)return;h.preventDefault(),this.isDrawingAreaSelection=!0,this.areaSelectionStartPoint=this.map.mouseEventToLayerPoint(h),this.areaSelectionRectangle&&(this.map.removeLayer(this.areaSelectionRectangle),this.areaSelectionRectangle=null),this.map.getContainer().addEventListener("mousemove",this.handleAreaSelectMouseMove),document.addEventListener("mouseup",this.handleAreaSelectMouseUp),this.logger.debug("Inicio de selecci\xF3n por \xE1rea en:",this.areaSelectionStartPoint)},this.handleAreaSelectMouseMove=h=>{if(!this.map||!this.isDrawingAreaSelection||!this.areaSelectionStartPoint)return;let u=this.map.mouseEventToLayerPoint(h),f=R.bounds(this.areaSelectionStartPoint,u),_=R.latLngBounds(this.map.layerPointToLatLng(f.min),this.map.layerPointToLatLng(f.max));this.areaSelectionRectangle?this.areaSelectionRectangle.setBounds(_):this.areaSelectionRectangle=R.rectangle(_,{color:"#3388ff",weight:1,fillOpacity:.2}).addTo(this.map)},this.handleAreaSelectMouseUp=h=>{if(!this.map||!this.isDrawingAreaSelection||h.button!==0){this.isDrawingAreaSelection&&this.finishAreaSelection(null);return}h.preventDefault();let u=this.map.mouseEventToLayerPoint(h);this.finishAreaSelection(u)},this.handleGlobalKeyDown=h=>{(h.key==="Escape"||h.keyCode===27)&&(this.currentToolActive==="measure"&&this.measuringPoints.length>0?(this.logger.debug("Tecla Escape presionada durante la medici\xF3n. Limpiando medici\xF3n..."),this.clearCurrentMeasurement()):this.currentToolActive==="areaSelect"&&this.isDrawingAreaSelection&&(this.logger.debug("Tecla Escape presionada durante la selecci\xF3n por \xE1rea. Cancelando..."),this.finishAreaSelection(null)))},this.handleMouseMoveForEdgePanning=h=>{if(!this.map||this.currentToolActive!=="measure"&&this.currentToolActive!=="areaSelect"&&this.currentToolActive!=="connect"){this.stopEdgePanningLoop();return}let f=this.map.getContainer().getBoundingClientRect(),_=h.clientX-f.left,p=h.clientY-f.top,l=0,m=0;_<this.edgePanningZone?l=-1:_>f.width-this.edgePanningZone&&(l=1),p<this.edgePanningZone?m=-1:p>f.height-this.edgePanningZone&&(m=1),this.currentPanDirection={x:l,y:m},l!==0||m!==0?this.edgePanningAnimationFrameId||this.startEdgePanningLoop():this.stopEdgePanningLoop()},this.edgePanLoop=()=>{if(!this.map||this.currentPanDirection.x===0&&this.currentPanDirection.y===0){this.stopEdgePanningLoop();return}this.map.panBy([this.currentPanDirection.x*this.edgePanningSpeed,this.currentPanDirection.y*this.edgePanningSpeed],{animate:!1}),this.edgePanningAnimationFrameId=requestAnimationFrame(this.edgePanLoop)},this.stopEdgePanningOnMouseLeave=()=>{this.logger.debug("Mouse ha salido del contenedor del mapa, deteniendo edge panning."),this.currentPanDirection={x:0,y:0},this.stopEdgePanningLoop()},this.logger.debug("MapService inicializado"),this.mapStateService.zoom$.pipe(Rt(this.destroy$)).subscribe(h=>{this.map&&this.isInitialized&&(this.logger.debug(`MapService: Recibido nuevo nivel de zoom desde MapStateService: ${h}`),this.setZoom(h,!0))}),this.mapStateService.center$.pipe(Rt(this.destroy$)).subscribe(h=>{this.map&&this.isInitialized&&h&&(this.logger.debug(`MapService: Recibidas nuevas coordenadas de centro desde MapStateService: ${h}`),this.map.panTo(h))}),this.mapStateManagerService.activeTool$.pipe(Rt(this.destroy$)).subscribe(h=>{this.isInitialized&&(this.logger.debug(`MapService: Recibida nueva herramienta desde MapStateManagerService: ${h}`),this.handleToolChange(h))})}initializeEvents(){this.eventBus.on(Vt.WIDGET_ACTION).pipe(Rt(this.destroy$)).subscribe(n=>{if(n.payload?.component==="darkMode"&&this.toggleDarkMode(n.payload?.enabled),n.payload?.component==="elementSelected"){let r=n.payload?.element;r&&this.selectElement(r)}if(n.payload?.component==="mapReset"&&this.resetMap(),n.payload?.component==="changeBaseLayer"){let r=n.payload?.layerId;r&&this.setBaseLayer(r)}})}initialize(n){if(this.serviceConfig=n,this.container=n.container||null,!this.container){this.logger.error("Contenedor de mapa no especificado en MapService.initialize"),this.isReadySubject.next(!1);return}this.map&&this.destroyMap();let r=n.preferCanvas??!0;this.zone.runOutsideAngular(()=>{try{if(this.map=R.map(this.container,{center:n.initialCenter||[19.78375,-70.676666],zoom:n.initialZoom||16,minZoom:n.minZoom||3,maxZoom:n.maxZoom||19,zoomControl:!1,preferCanvas:r,attributionControl:!0}),this.logger.info("Instancia de Leaflet Map creada en MapService.initialize"),this.networkMapRendererService&&(this.networkMapRendererService.initialize(this.map),this.logger.debug("NetworkMapRendererService inicializado por MapService")),!R||!R.tileLayer){this.logger.error("Error: Leaflet no est\xE1 disponible. Verificar que la biblioteca est\xE9 correctamente importada");return}this.setBaseLayer(n.layerId||this.currentBaseLayerId$.value),n.isDarkMode&&this.setDarkMode(n.isDarkMode),this.setupMapEvents(n),this.isInitialized=!0,this.isReadySubject.next(!0),this.eventBus.emit({type:Vt.MAP_READY,timestamp:new Date,payload:{map:this.map}}),this.logger.debug("Mapa inicializado correctamente")}catch(o){this.logger.error("Error al inicializar el mapa:",o),this.isReadySubject.next(!1),this.eventBus.emit({type:Vt.MAP_ERROR,timestamp:new Date,payload:{error:o}})}})}setBaseLayer(n){if(!this.map){this.logger.warn("Mapa no inicializado. No se puede cambiar la capa base.");return}let r=this.baseLayers[n];if(!r){this.logger.error(`Configuraci\xF3n de capa base no encontrada para el ID: ${n}`),n!=="osm"&&this.setBaseLayer("osm");return}try{this.logger.debug(`Cambiando a capa base: ${r.name}`);let o=R.tileLayer(r.url,r.options);o.on("tileerror",h=>{this.logger.error(`Error al cargar tile para ${r.name}:`,h),this.loadBackupTiles()}),this.activeTileLayer&&this.map.removeLayer(this.activeTileLayer),o.addTo(this.map),this.activeTileLayer=o,this.currentBaseLayerId$.next(n),this.logger.debug(`Capa base ${r.name} cargada y activada.`)}catch(o){this.logger.error(`Error al cambiar a capa base ${r.name}:`,o),n!=="osm"&&(this.logger.info("Intentando cargar OpenStreetMap como fallback."),this.setBaseLayer("osm"))}}setupMapEvents(n){this.map&&(n.onElementSelect,this.map.on("zoomend",()=>{this.map}),this.map.on("moveend",()=>{this.map}))}destroyMap(){this.simulation&&this.simulation.stop(),this.map&&(this.map.remove(),this.map=null),this.svg&&(this.svg.selectAll("*").remove(),this.svg.remove(),this.svg=null),this.container=null,this.isReadySubject.next(!1)}isMapReady(){return this.isReadySubject.asObservable()}getMap(){return this.map}panTo(n){this.map&&this.map.panTo([n.lat,n.lng])}zoomTo(n){this.map&&this.map.setZoom(n)}centerOnCoordinates(n){if(this.map){let r=this.map.containerPointToLatLng([n.x,n.y]);this.map.panTo(r)}}setDarkMode(n){this.isMapDarkMode=n,this.internalIsDarkMode$.next(n),this.map&&this.updateBaseLayer(n?"dark":"osm"),this.svg&&this.svg.classed("dark-theme",n)}updateBaseLayer(n){if(this.currentBaseLayerId$.next(n),!!this.map)try{this.map.eachLayer(o=>{o instanceof R.TileLayer&&this.map?.removeLayer(o)});let r={errorTileUrl:"assets/error-tiles/error-tile.png",crossOrigin:!0,maxZoom:19};switch(n){case"dark":R.tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",Z(O({},r),{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',subdomains:"abcd"})).addTo(this.map);break;case"satellite":R.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",Z(O({},r),{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"})).addTo(this.map);break;case"hybrid":R.tileLayer("https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}",Z(O({},r),{attribution:"Map data &copy; Google"})).addTo(this.map);break;case"terrain":R.tileLayer("https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",Z(O({},r),{attribution:'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'})).addTo(this.map);break;case"offline":R.tileLayer("assets/leaflet/offline-tiles/{z}/{x}/{y}.png",Z(O({},r),{attribution:"Tiles Offline"})).addTo(this.map);break;case"osm":default:R.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",Z(O({},r),{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'})).addTo(this.map);break}this.logger.debug(`Capa base actualizada a: ${n}`)}catch(r){this.logger.error("Error al cambiar la capa base:",r),this.loadFallbackLayer()}}convertZoomLevelToPercent(n){return Math.round(n/19*100)}convertZoomPercentToLevel(n){return Math.round(n/100*19)}setTool(n){switch(this.currentToolActive=n,n){case"pan":this.enablePanMode();break;case"select":this.enableSelectMode();break;case"measure":this.enableMeasurement();break;case"area_select":this.enableAreaSelectMode(!0);break;default:this.enablePanMode()}this.eventBus.emit({type:Vt.WIDGET_ACTION,timestamp:new Date,payload:{component:"toolChanged",tool:this.currentToolActive}})}enablePanMode(){this.map&&this.map.dragging.enable()}enableSelectMode(){this.map}enableAreaSelectMode(n){this.map}getNodesData(){return this.nodesData}getLinksData(){return this.linksData}fitContentToScreen(){if(this.map&&this.nodesData.length>0){let n=this.nodesData.filter(r=>r.x!==void 0&&r.y!==void 0).map(r=>new R.LatLng(r.y||0,r.x||0));if(n.length>0){let r=R.latLngBounds(n);this.map.fitBounds(r,{padding:[30,30]})}}}getVisibleBoundingBox(){if(this.map){let n=this.map.getBounds();return{north:n.getNorth(),south:n.getSouth(),east:n.getEast(),west:n.getWest()}}return{north:90,south:-90,east:180,west:-180}}zoomIn(){if(this.map)this.map.zoomIn();else if(this.zoomBehavior&&this.svg){let r=ai(this.svg.node()).k*1.2;this.zoomBehavior.scaleBy(this.svg,1.2),this.currentMapZoom=r}}zoomOut(){if(this.map)this.map.zoomOut();else if(this.zoomBehavior&&this.svg){let r=ai(this.svg.node()).k/1.2;this.zoomBehavior.scaleBy(this.svg,1/1.2),this.currentMapZoom=r}}centerOnElement(n){if(n.position){if(this.map){let r=new R.LatLng(n.position.lat,n.position.lng);this.map.panTo(r)}else if(this.svg&&n.position.coordinates){let[r,o]=n.position.coordinates;this.centerOnCoordinates({x:r,y:o})}}}fitToScreen(){if(this.map){let n=this.getNodesData().map(h=>({id:h.id,position:{lat:h.y||0,lng:h.x||0}}));if(n.length===0)return;let r=n.filter(h=>h.position).map(h=>new R.LatLng(h.position.lat,h.position.lng));if(r.length===0)return;let o=R.latLngBounds(r);this.map.fitBounds(o,{padding:[50,50],maxZoom:15})}else this.svg&&this.zoomBehavior&&this.fitContentToScreen()}setZoom(n,r=!1){if(this.map){let o=n;this.logger.debug(`MapService: Aplicando zoom de Leaflet: ${o}, Animado: ${r}`),this.map.setZoom(o,{animate:r})}else if(this.svg&&this.zoomBehavior){let o=this.convertPercentToScale(n);this.zoomBehavior.scaleTo(this.svg,o)}}enablePositionSelection(){this.map&&(this.isPositionSelectionEnabled=!0,this.container?.classList.add("map-position-selection"),this.map.on("click",this.handleMapClick),this.logger.debug("Modo de selecci\xF3n de posici\xF3n activado"))}disablePositionSelection(){this.map&&(this.isPositionSelectionEnabled=!1,this.container?.classList.remove("map-position-selection"),this.map.off("click",this.handleMapClick),this.positionMarker&&(this.map.removeLayer(this.positionMarker),this.positionMarker=null),this.logger.debug("Modo de selecci\xF3n de posici\xF3n desactivado"))}getSelectedPosition(){return this.selectedPositionSubject.asObservable()}previewElement(n){if(!this.map||!n.position)return;this.clearPreview();let r=new R.LatLng(n.position.lat,n.position.lng),o=R.icon({iconUrl:`assets/leaflet/map-icons/${n.type.toLowerCase()}.svg`,iconSize:[32,32],iconAnchor:[16,16],className:"preview-marker"});this.previewMarker=R.marker(r,{icon:o}).addTo(this.map),this.map.panTo(r)}clearPreview(){this.map&&this.previewMarker&&(this.map.removeLayer(this.previewMarker),this.previewMarker=null)}centerMap(){this.map&&this.serviceConfig&&this.serviceConfig.initialCenter&&this.map.setView(this.serviceConfig.initialCenter,this.convertZoomPercentToLevel(this.serviceConfig.initialZoom||100))}addElementAtPosition(n,r,o){if(!this.map)return;let h=new R.LatLng(o,r);this.map.panTo(h),this.clearPreview(),this.disablePositionSelection()}updateMapElements(n,r){this.logger.debug(`Actualizaci\xF3n de elementos solicitada: ${n.length} elementos, ${r.length} conexiones`),this.nodesData=n.filter(o=>!!o.id&&!!o.position).map(o=>{let h=o.position?.lng??0,u=o.position?.lat??0;return Z(O({},o),{id:o.id,x:h,y:u,fx:o.metadata?.fixed?h:null,fy:o.metadata?.fixed?u:null})})}exportMap(n){this.map&&this.logger.debug(`Exportando mapa en formato ${n}`)}initializeMap(n){this.logger.debug("[MapService] initializeMap llamado con MapConfig",n);let r=null;if(typeof n.container=="string"){if(r=document.getElementById(n.container),!r)return this.logger.error(`Contenedor del mapa con ID '${n.container}' no encontrado en el DOM.`),Promise.reject(`Contenedor del mapa '${n.container}' no encontrado.`)}else r=n.container;if(this.container=r,!this.container)return this.logger.error("Contenedor del mapa no resuelto desde MapConfig para initializeMap"),Promise.reject("Contenedor del mapa no disponible");let o={container:this.container,initialCenter:[19.78375,-70.676666],initialZoom:n.initialZoom||16,minZoom:n.minZoom,maxZoom:n.maxZoom,layerId:"osm",preferCanvas:!0,editOptions:{},isDarkMode:n.isDarkMode||!1,onElementSelect:n.onElementSelect};return this.initialize(o),Promise.resolve()}clearMap(){}stopSimulation(){}selectElement(n){}handleConnection(n,r,o){}getMapCenter(){return{x:0,y:0}}getCurrentZoom(){return 1}clearMeasurements(){}refreshMapSize(){}convertPercentToScale(n){return 1}convertScaleToPercent(n){return 100}sendPositionToEditor(n,r){}handleElementSelectedViaEvent(n){this.selectedElement=n,n&&this.map&&n.position&&this.panTo(n.position)}resetMap(){if(this.map){let n=this.serviceConfig?.initialCenter||[19.78375,-70.676666],r=this.serviceConfig?.initialZoom||16;this.map.setView(n,r),this.clearMarkers(),this.selectedElement=null}}clearMarkers(){this.positionMarker&&this.map&&(this.map.removeLayer(this.positionMarker),this.positionMarker=null),this.previewMarker&&this.map&&(this.map.removeLayer(this.previewMarker),this.previewMarker=null),this.selectedPosition=null,this.selectedPositionSubject.next(null)}handleToolChange(n){this.currentToolActive=n;let r=this.map?.getContainer();switch(this.map&&r&&(this.map.dragging.disable(),R.DomUtil.removeClass(r,"cursor-pointer"),R.DomUtil.removeClass(r,"cursor-crosshair"),R.DomUtil.removeClass(r,"cursor-grab"),this.disableMeasurementTool(),this.disableAreaSelectionTool(),this.disableSelectionTool()),n){case"pan":this.enablePanning();break;case"select":this.enableSelection();break;case"areaSelect":this.enableAreaSelection();break;case"measure":this.enableMeasurement();break;default:this.enablePanning();break}this.logger.debug(`Herramienta cambiada a: ${n}`)}toggleDarkMode(n){this.setDarkMode(n),this.logger.debug(`Modo oscuro ${n?"activado":"desactivado"}`)}disableInteraction(){this.logger.debug("Deshabilitando interacciones del mapa")}enablePanning(){this.logger.debug("Habilitando navegaci\xF3n del mapa (pan)"),this.map&&this.map.dragging.enable()}enableSelection(){if(this.logger.debug("Habilitando selecci\xF3n de elementos"),this.map){this.map.dragging.disable();let n=this.map.getContainer();R.DomUtil.addClass(n,"cursor-pointer"),this.map.on("click",this.handleMapSelectionClick)}}disableSelectionTool(){this.map&&this.map.off("click",this.handleMapSelectionClick),this.logger.debug("Herramienta de selecci\xF3n deshabilitada.")}enableMeasurement(){if(this.logger.debug("Habilitando medici\xF3n de distancias"),this.map){this.clearCurrentMeasurement(),this.map.dragging.disable();let n=this.map.getContainer();R.DomUtil.addClass(n,"cursor-crosshair"),this.map.on("click",this.handleMeasureMapClick),n.addEventListener("mousemove",this.handleMouseMoveForEdgePanning),n.addEventListener("mouseleave",this.stopEdgePanningOnMouseLeave)}}clearCurrentMeasurement(){this.measuringPoints=[],this.measurementPolyline&&(this.map?.removeLayer(this.measurementPolyline),this.measurementPolyline=null),this.measurementMarkers.forEach(n=>this.map?.removeLayer(n)),this.measurementMarkers=[],this.logger.debug("Medici\xF3n actual limpiada.")}disableMeasurementTool(){if(this.map){this.map.off("click",this.handleMeasureMapClick);let n=this.map.getContainer();n.removeEventListener("mousemove",this.handleMouseMoveForEdgePanning),n.removeEventListener("mouseleave",this.stopEdgePanningOnMouseLeave),this.stopEdgePanningLoop()}this.clearCurrentMeasurement(),this.logger.debug("Herramienta de medici\xF3n deshabilitada.")}enableConnectionCreation(){this.logger.debug("Habilitando creaci\xF3n de conexiones")}enableAreaSelection(){if(this.logger.debug("Habilitando selecci\xF3n por \xE1rea"),this.map){this.disableAreaSelectionTool(),this.map.dragging.disable();let n=this.map.getContainer();R.DomUtil.addClass(n,"cursor-crosshair"),n.addEventListener("mousedown",this.handleAreaSelectMouseDown),n.addEventListener("mousemove",this.handleMouseMoveForEdgePanning),n.addEventListener("mouseleave",this.stopEdgePanningOnMouseLeave)}}disableAreaSelectionTool(){if(this.map){let n=this.map.getContainer();n.removeEventListener("mousedown",this.handleAreaSelectMouseDown),n.removeEventListener("mousemove",this.handleAreaSelectMouseMove),document.removeEventListener("mouseup",this.handleAreaSelectMouseUp),this.areaSelectionRectangle&&(this.map.removeLayer(this.areaSelectionRectangle),this.areaSelectionRectangle=null),this.isDrawingAreaSelection=!1,this.areaSelectionStartPoint=null,this.stopEdgePanningLoop()}this.logger.debug("Herramienta de selecci\xF3n por \xE1rea deshabilitada.")}finishAreaSelection(n){if(this.isDrawingAreaSelection=!1,this.map?.getContainer()?.removeEventListener("mousemove",this.handleAreaSelectMouseMove),document.removeEventListener("mouseup",this.handleAreaSelectMouseUp),!this.map||!this.areaSelectionStartPoint||!this.areaSelectionRectangle||!n){this.areaSelectionRectangle&&(this.map?.removeLayer(this.areaSelectionRectangle),this.areaSelectionRectangle=null),this.areaSelectionStartPoint=null,this.logger.debug("Selecci\xF3n por \xE1rea cancelada o incompleta.");return}let o=this.areaSelectionRectangle.getBounds();this.logger.debug("Selecci\xF3n por \xE1rea finalizada. Bounds:",o);let h=this.findElementsInBounds(o);this.logger.info(`Elementos seleccionados por \xE1rea: ${h.length}`,h),this.mapStateManagerService.setSelectedElements(h),this.areaSelectionRectangle&&(this.map.removeLayer(this.areaSelectionRectangle),this.areaSelectionRectangle=null),this.areaSelectionStartPoint=null,h.length>0&&this.mapStateManagerService.setTool("select")}findElementsInBounds(n){return!this.nodesData||this.nodesData.length===0?[]:this.nodesData.filter(r=>{if(typeof r.y=="number"&&typeof r.x=="number"){let o=R.latLng(r.y,r.x);return n.contains(o)}return!1})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.destroyMap(),document.removeEventListener("keydown",this.handleGlobalKeyDown),this.logger.debug("MapService destruido y desuscrito de observables, listener de teclado eliminado.")}enableElementEditing(){this.logger.debug("Habilitando edici\xF3n de elementos")}loadFallbackLayer(){try{if(!this.map){this.logger.error("El mapa no est\xE1 inicializado");return}this.logger.debug("Cargando capa fallback"),R.tileLayer("https://a.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',errorTileUrl:"assets/leaflet/error-tiles/error-tile.png",crossOrigin:!0}).addTo(this.map)}catch(n){this.logger.error("Error al cargar capa fallback:",n),this.loadOfflineTiles()}}loadOfflineTiles(){try{if(!this.map){this.logger.error("El mapa no est\xE1 inicializado");return}this.logger.debug("Intentando cargar tiles offline"),R.tileLayer("assets/leaflet/offline-tiles/{z}/{x}/{y}.png",{errorTileUrl:"assets/leaflet/error-tiles/error-tile.png",attribution:"Tiles Offline",crossOrigin:!0,minZoom:10,maxZoom:18}).addTo(this.map)}catch(n){this.logger.error("No se pudieron cargar los tiles offline:",n),this.createPlainLayer()}}createPlainLayer(){if(!this.map){this.logger.error("El mapa no est\xE1 inicializado");return}this.logger.debug("Creando capa plana como \xFAltimo recurso");let n=document.createElement("canvas");n.width=256,n.height=256;let r=n.getContext("2d");r&&(r.fillStyle="#f2f2f2",r.fillRect(0,0,256,256),r.strokeStyle="#ddd",r.strokeRect(0,0,256,256),r.font="10px Arial",r.fillStyle="#888",r.fillText("Error de carga",80,128));let o=n.toDataURL();R.tileLayer(o,{attribution:"Fallback Layer"}).addTo(this.map)}loadBackupTiles(){this.logger.debug("Cargando tiles de respaldo")}startEdgePanningLoop(){this.edgePanningAnimationFrameId||this.edgePanLoop()}stopEdgePanningLoop(){this.edgePanningAnimationFrameId&&(cancelAnimationFrame(this.edgePanningAnimationFrameId),this.edgePanningAnimationFrameId=null)}refreshElementsDisplay(){if(!this.map||!this.isInitialized||!this.networkMapRendererService||!this.mapElementManagerService){this.logger.warn("[MapService] No se puede refrescar elementos: Mapa o servicios no inicializados.");return}let n=this.mapElementManagerService.getAllElements();this.logger.debug(`[MapService] refreshElementsDisplay: Obtenidos ${n.length} elementos.`),this.networkMapRendererService.renderElements(n,this.map.getBounds());let r=this.mapElementManagerService.getAllConnections();this.logger.info(`[MapService] refreshElementsDisplay: Obtenidas ${r.length} conexiones para renderizar:`,JSON.stringify(r.map(o=>({id:o.id,source:o.sourceElementId,target:o.targetElementId})))),r&&r.length>0?(this.networkMapRendererService.renderConnections(r),this.logger.debug(`[MapService] Renderizado de conexiones solicitado para ${r.length} conexiones.`)):(this.logger.debug("[MapService] No hay conexiones para renderizar o no se pudieron obtener."),this.networkMapRendererService.renderConnections([])),this.logger.info("[MapService] Visualizaci\xF3n de elementos y conexiones refrescada.")}updateElementPreviewPosition(n,r,o){if(!this.map)return;let h=this.findElementMarker(n);h?h.setLatLng([o,r]):this.logger.debug(`No se encontr\xF3 el marcador para el elemento ${n}`)}findElementMarker(n){if(!this.map)return null;let r=null;return this.map.eachLayer(o=>{(o instanceof R.Marker&&o.options.title===n||o.elementId===n)&&(r=o)}),r}static{this.\u0275fac=function(r){return new(r||i)(K(Qe),K(tl),K(Sc,8))}}static{this.\u0275prov=ft({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();export{Wa as a,Wr as b,Ya as c,Ka as d,xn as e,Si as f,Ae as g,Ef as h,Om as i,Dm as j,Nm as k,Bm as l,po as m,Zm as n,$m as o,Gm as p,Hm as q,Wm as r,Xm as s,Lc as t,Vt as u,tl as v,el as w,il as x,En as y,nl as z,sl as A,KL as B};
