import{a as Ol,b as Dn,e as Rc}from"./chunk-3DOLLXBG.js";import{a as uo}from"./chunk-QH4WVHPL.js";import{b as vo,c as Ac,d as Zn,e as Nc,f as Eo}from"./chunk-GUCJQ5DX.js";import{a as In,b as An,c as Nn,d as Rn}from"./chunk-HOQN2RTO.js";import{a as Al,b as Kt}from"./chunk-YFTEGT7S.js";import{a as Pc,b as _o}from"./chunk-KEBTLCZL.js";import{a as vc,b as _c,c as bc,d as Cc,e as yc,f as Ec,g as wc,h as xc,i as Sc,j as Mc,k as Tc}from"./chunk-DIVOCDBU.js";import{a as Oc}from"./chunk-MZVWOBTH.js";import{b as Fc}from"./chunk-ELOSELUF.js";import{a as To,b as Ei,c as wi,d as Po,e as qc,f as Qc,g as Oo,h as xi,i as ko}from"./chunk-P65VXPTK.js";import{a as Z,b as me,c as ua,d as wo,e as $c,f as jc,g as Uc,h as Hc,i as Gc,j as ha,k as xo,l as Wc,m as So,n as Kc,o as ge,p as Mo}from"./chunk-7JRIPI7N.js";import{a as pa,b as Kl,c as Ze}from"./chunk-AFAFW5B4.js";import{a as sc,b as fc}from"./chunk-3CBYZUNU.js";import"./chunk-TXDL5GP3.js";import{a as zc,c as ga}from"./chunk-RLREG4VK.js";import{h as Lc}from"./chunk-BRMDKIJD.js";import{A as Dt,a as dc,c as pc,d as Te,e as gt,m as Xe,n as bo,o as Je,p as Pe,q as Ci,r as yi,s as gn,t as kc,u as Co,v as yo,w as Dc,x as qn,y as Ic,z as Qn}from"./chunk-AXXRXZW7.js";import{b as cc}from"./chunk-E3NR5YS4.js";import{d as mc}from"./chunk-YKHY2KRM.js";import{a as to,b as no,d as io,f as jn}from"./chunk-7CRRIESH.js";import{a as uc,b as ho}from"./chunk-DO4GAHHZ.js";import{d as gc}from"./chunk-CEJFVTAL.js";import"./chunk-PS45K6N5.js";import"./chunk-URNBDWCH.js";import{b as He,c as Un,g as Kn}from"./chunk-JGNBERAY.js";import{a as Gn,c as go,d as Wn}from"./chunk-Q2I2H6RZ.js";import{a as zn,b as ql,c as Ye,d as Ql,e as Bn,f as Vn,g as $n,h as Qt}from"./chunk-RMHD7ZOV.js";import{a as Vc}from"./chunk-LDPLFFFJ.js";import{b as Bc}from"./chunk-MHWJR3EV.js";import{a as Wl,b as eo,c as qt}from"./chunk-E7SS3VLG.js";import{a as Y,b as bt,c as Ft,d as ot,e as ma,f as ec,g as pe,h as _i,j as Ct,k as yt,l as tc,m as mn,n as so,o as bi}from"./chunk-N7T535CU.js";import{a as mo,b as lc,c as fo,d as hc,e as kt}from"./chunk-PQUQY4V4.js";import{a as We,b as Hn}from"./chunk-SFSNZG2F.js";import{a as lo,b as nc,c as co,d as ic,e as oc,f as rc,g as ac,h as po}from"./chunk-GQNYZBS2.js";import{a as ao,b as Xl,c as Jl,d as Zt}from"./chunk-NI7QRJ7Q.js";import{a as Ot,b as Ue}from"./chunk-F5P253LU.js";import{a as G}from"./chunk-PYE7UGMK.js";import"./chunk-VMUGXP3O.js";import{a as Wt,b as mt}from"./chunk-D3FDFS7S.js";import{d as oo,f as Zl,g as Yl,j as ro}from"./chunk-RWQWO3EM.js";import{a as ye}from"./chunk-ULFK375Q.js";import{A as Xi,B as Ji,b as Ln,g as Fn,h as Nl,j as Rl,k as Zi,l as Ll,m as Fl,n as zl,o as Bl,r as Vl,s as $l,t as jl,u as Ul,v as Hl,w as Gl,z as Yi}from"./chunk-JO2MD4NL.js";import{a as de,b as le,i as Ne,j as Re,k as kl,l as Dl,m as Il,n as he}from"./chunk-XJSBNB6N.js";import{k as da,l as vi,v as Me,w as Ee}from"./chunk-VH7SA6GK.js";import{E as Tl,G as Pl,H as ca,a as wl,b as xl,c as Qi,e as fi,f as Ht,i as Sl,j as Gt,m as Ml}from"./chunk-4PHUDKEH.js";import{a as On,b as Ki,c as Pt,d as Se,e as kn,f as qi,g as yl,h as El,i as Ut}from"./chunk-D4QL4JVC.js";import{$a as p,$b as E,$c as X,Aa as b,Ab as Sn,Ac as Gi,B as En,Ba as Xs,Bc as Pn,C as Rt,D as _e,Da as oa,Ec as hi,F as we,Fa as jt,Gb as s,H as na,Hb as l,I as wn,Ib as D,Ja as U,Jb as Ie,K as xn,Ka as Qe,Kb as Ae,L as $s,La as ji,Lc as pt,M as di,Mb as F,Mc as je,N as js,Na as ra,Nc as ie,O as st,Ob as C,Oc as ll,P as Us,Pa as Ve,Pb as f,Pc as cl,Q as pi,Qb as gi,Qc as dl,Rb as ui,Rc as pl,S as ia,Ta as aa,Tc as ml,Ub as lt,V as Hs,Va as Js,Vb as ct,Vc as gl,Wb as dt,Wc as ul,Xa as el,Yc as Wi,Z as Gs,Za as tl,Zb as vt,_ as Ws,_b as d,_c as hl,a as $t,aa as Ks,ac as V,ba as qs,bb as mi,bc as Mn,c as Be,ca as ke,cc as cn,cd as fl,da as R,db as I,dc as dn,dd as vl,ec as pn,f as N,fa as xe,fb as nl,g as ce,ga as Qs,gc as Ui,h as Ns,ha as te,hc as Lt,hd as _l,i as Rs,ic as _t,id as Tt,j as Ls,ja as k,jc as Hi,jd as bl,k as Fs,ka as rn,kb as q,kc as il,kd as Cl,l as zs,lb as an,lc as ol,m as Bi,ma as De,mb as sn,mc as Le,n as fe,nc as Tn,o as it,oa as P,ob as ln,oc as Mt,pa as M,pc as rl,qb as y,qc as al,r as Bs,s as se,t as Vs,ta as $i,u as ta,ua as Zs,vc as $e,wb as Ce,xb as u,xc as la,ya as Ys,yb as sa,yc as sl,z as Vi,za as _,zb as K}from"./chunk-FG6FKNI4.js";import{a as O,b as W,d as As,g as ae}from"./chunk-OXVY4BEJ.js";function Dm(i,e){i&1&&(Ie(0),D(1,"router-outlet"),Ae())}function Im(i,e){i&1&&(s(0,"div",2),D(1,"mat-spinner",3),l())}var Do=class i{initialized=!1;constructor(){}ngOnInit(){this.initialized=!0}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=q({type:i,selectors:[["app-initializer"]],decls:3,vars:2,consts:[["loading",""],[4,"ngIf","ngIfElse"],[1,"loading-screen"],["diameter","48"]],template:function(t,n){if(t&1&&y(0,Dm,2,0,"ng-container",1)(1,Im,2,0,"ng-template",null,0,al),t&2){let o=vt(2);u("ngIf",n.initialized)("ngIfElse",o)}},dependencies:[X,ie,Pt,Wt],styles:[".loading-screen[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100vh;width:100vw;background-color:#fafafa;position:fixed;top:0;left:0;z-index:9999}"]})};var Yn=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=an({type:i});static \u0275inj=rn({imports:[ca,vi,vi,ca]})}return i})();var Nm=(i,e)=>[i,e];function Rm(i,e){i&1&&(s(0,"span",15),d(1,"Network Map"),l())}function Lm(i,e){i&1&&(s(0,"span"),d(1,"Dashboard"),l())}function Fm(i,e){i&1&&(s(0,"span"),d(1,"Dise\xF1o de Red"),l())}function zm(i,e){i&1&&(s(0,"span"),d(1,"Proyectos"),l())}function Bm(i,e){if(i&1&&(s(0,"a",16)(1,"mat-icon"),d(2,"work"),l(),y(3,zm,2,0,"span",8),l()),i&2){let t=f();u("matTooltip",t.collapsed?"Proyectos":"")("matTooltipPosition","right"),p(3),u("ngIf",!t.collapsed)}}function Vm(i,e){i&1&&(s(0,"span"),d(1,"Modo Offline"),l())}function $m(i,e){i&1&&(s(0,"span"),d(1,"Configuraci\xF3n"),l())}function jm(i,e){i&1&&(s(0,"span"),d(1,"Ayuda"),l())}var Io=class i{collapsed=!1;userRoles=[];UserRole=pa;toggleCollapse(){this.collapsed=!this.collapsed}hasRole(e){return e.some(t=>this.userRoles.includes(t))}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=q({type:i,selectors:[["app-navigation-sidebar"]],inputs:{collapsed:"collapsed",userRoles:"userRoles"},decls:33,vars:25,consts:[[1,"navigation-container"],[1,"nav-header"],[1,"logo"],["src","assets/logo.svg","alt","Logo"],["class","logo-text",4,"ngIf"],["mat-icon-button","",1,"collapse-toggle",3,"click"],[1,"nav-links"],["mat-list-item","","routerLink","/dashboard","routerLinkActive","active-link",3,"matTooltip","matTooltipPosition"],[4,"ngIf"],["mat-list-item","","routerLink","/network-design","routerLinkActive","active-link",3,"matTooltip","matTooltipPosition"],["mat-list-item","","routerLink","/projects","routerLinkActive","active-link",3,"matTooltip","matTooltipPosition",4,"ngIf"],["mat-list-item","","routerLink","/offline","routerLinkActive","active-link",3,"matTooltip","matTooltipPosition"],[1,"nav-footer"],["mat-list-item","","routerLink","/settings","routerLinkActive","active-link",3,"matTooltip","matTooltipPosition"],["mat-list-item","","routerLink","/help","routerLinkActive","active-link",3,"matTooltip","matTooltipPosition"],[1,"logo-text"],["mat-list-item","","routerLink","/projects","routerLinkActive","active-link",3,"matTooltip","matTooltipPosition"]],template:function(t,n){t&1&&(s(0,"div",0)(1,"div",1)(2,"div",2),D(3,"img",3),y(4,Rm,2,0,"span",4),l(),s(5,"button",5),C("click",function(){return n.toggleCollapse()}),s(6,"mat-icon"),d(7),l()()(),D(8,"mat-divider"),s(9,"div",6)(10,"a",7)(11,"mat-icon"),d(12,"dashboard"),l(),y(13,Lm,2,0,"span",8),l(),s(14,"a",9)(15,"mat-icon"),d(16,"share"),l(),y(17,Fm,2,0,"span",8),l(),y(18,Bm,4,3,"a",10),s(19,"a",11)(20,"mat-icon"),d(21,"offline_bolt"),l(),y(22,Vm,2,0,"span",8),l()(),s(23,"div",12),D(24,"mat-divider"),s(25,"a",13)(26,"mat-icon"),d(27,"settings"),l(),y(28,$m,2,0,"span",8),l(),s(29,"a",14)(30,"mat-icon"),d(31,"help"),l(),y(32,jm,2,0,"span",8),l()()()),t&2&&(K("collapsed",n.collapsed),p(2),K("collapsed",n.collapsed),p(2),u("ngIf",!n.collapsed),p(3),E(n.collapsed?"chevron_right":"chevron_left"),p(3),u("matTooltip",n.collapsed?"Dashboard":"")("matTooltipPosition","right"),p(3),u("ngIf",!n.collapsed),p(),u("matTooltip",n.collapsed?"Dise\xF1o de Red":"")("matTooltipPosition","right"),p(3),u("ngIf",!n.collapsed),p(),u("ngIf",n.hasRole(Hi(22,Nm,n.UserRole.ADMIN,n.UserRole.OPERATOR))),p(),u("matTooltip",n.collapsed?"Modo Offline":"")("matTooltipPosition","right"),p(3),u("ngIf",!n.collapsed),p(3),u("matTooltip",n.collapsed?"Configuraci\xF3n":"")("matTooltipPosition","right"),p(3),u("ngIf",!n.collapsed),p(),u("matTooltip",n.collapsed?"Ayuda":"")("matTooltipPosition","right"),p(3),u("ngIf",!n.collapsed))},dependencies:[X,ie,Ut,kn,qi,Yn,qt,eo,Ot,le,de,Ue,Ee,Me],styles:[".navigation-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:240px;transition:width .3s ease;background-color:#fff;box-shadow:0 2px 8px #0000001a}.navigation-container.collapsed[_ngcontent-%COMP%]{width:64px}.nav-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:16px;height:64px}.logo[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:32px;width:32px;object-fit:contain;background-color:transparent;border-radius:4px}.logo-text[_ngcontent-%COMP%]{font-size:18px;font-weight:500}.nav-links[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding-top:8px}.nav-links[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], .nav-footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;height:48px;padding:0 16px;color:#000000de;text-decoration:none;transition:background-color .2s ease}.nav-links[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, .nav-footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#0000000a}.active-link[_ngcontent-%COMP%]{background-color:#2196f31a!important;color:#2196f3!important}.active-link[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#2196f3}.nav-footer[_ngcontent-%COMP%]{padding-bottom:8px}"]})};var Yt=class i{shortcuts=[];keydownSubscription;destroy$=new N;activeContexts=new Set(["global"]);shortcutsChanged$=new N;constructor(){this.keydownSubscription=Vi(document,"keydown").pipe(R(this.destroy$),_e(e=>!this.isInputElement(e.target))).subscribe(e=>this.handleKeyDown(e)),this.registerDefaultShortcuts()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.keydownSubscription&&this.keydownSubscription.unsubscribe()}registerShortcut(e){let t=this.shortcuts.findIndex(n=>n.id===e.id);t>=0?this.shortcuts[t]=O({},e):this.shortcuts.push(O({},e)),this.shortcutsChanged$.next(this.shortcuts)}registerShortcuts(e){e.forEach(t=>this.registerShortcut(t))}unregisterShortcut(e){this.shortcuts=this.shortcuts.filter(t=>t.id!==e),this.shortcutsChanged$.next(this.shortcuts)}setShortcutEnabled(e,t){let n=this.shortcuts.find(o=>o.id===e);n&&(n.disabled=!t,this.shortcutsChanged$.next(this.shortcuts))}getAllShortcuts(){return[...this.shortcuts]}getActiveShortcuts(){return this.shortcuts.filter(e=>!e.disabled&&this.isShortcutInActiveContext(e))}setActiveContext(e){this.activeContexts.clear(),this.activeContexts.add("global"),Array.isArray(e)?e.forEach(t=>this.activeContexts.add(t)):this.activeContexts.add(e),this.shortcutsChanged$.next(this.shortcuts)}addActiveContext(e){this.activeContexts.add(e),this.shortcutsChanged$.next(this.shortcuts)}removeActiveContext(e){e!=="global"&&(this.activeContexts.delete(e),this.shortcutsChanged$.next(this.shortcuts))}getActiveContexts(){return Array.from(this.activeContexts)}getShortcutsChanges(){return this.shortcutsChanged$.asObservable()}handleKeyDown(e){let t=this.findMatchingShortcut(e);t&&(e.preventDefault(),e.stopPropagation(),this.triggerShortcutEvent(t.id))}findMatchingShortcut(e){let t=e.key.toLowerCase();return this.shortcuts.filter(o=>!o.disabled&&this.isShortcutInActiveContext(o)).find(o=>{if(o.key.toLowerCase()!==t)return!1;let r=o.modifiers||{};return!(r.ctrl!==void 0&&r.ctrl!==e.ctrlKey||r.alt!==void 0&&r.alt!==e.altKey||r.shift!==void 0&&r.shift!==e.shiftKey||r.meta!==void 0&&r.meta!==e.metaKey)})||null}isShortcutInActiveContext(e){return!e.contexts||e.contexts.length===0?!0:e.contexts.some(t=>this.activeContexts.has(t))}triggerShortcutEvent(e){let t=new CustomEvent("app-shortcut",{detail:{id:e},bubbles:!0});document.dispatchEvent(t)}isInputElement(e){if(!e)return!1;let t=e.tagName.toLowerCase(),n=t==="input"||t==="textarea",o=e.isContentEditable;if(n){let r=e.type?.toLowerCase();return!["button","checkbox","radio","submit","reset"].includes(r)}return o}registerDefaultShortcuts(){let e=[{id:"help",key:"h",modifiers:{ctrl:!0,shift:!0},description:"Mostrar esta ayuda",group:"General",contexts:["global"]},{id:"zoom-in",key:"=",modifiers:{ctrl:!0},description:"Acercar",group:"Visualizaci\xF3n",contexts:["map"]},{id:"zoom-out",key:"-",modifiers:{ctrl:!0},description:"Alejar",group:"Visualizaci\xF3n",contexts:["map"]},{id:"zoom-reset",key:"0",modifiers:{ctrl:!0},description:"Restablecer zoom",group:"Visualizaci\xF3n",contexts:["map"]},{id:"fit-screen",key:"f",description:"Ajustar a la pantalla",group:"Visualizaci\xF3n",contexts:["map"]},{id:"pan-mode",key:"p",description:"Modo panor\xE1mico",group:"Herramientas",contexts:["map"]},{id:"select-mode",key:"s",description:"Modo selecci\xF3n",group:"Herramientas",contexts:["map"]},{id:"save",key:"s",modifiers:{ctrl:!0},description:"Guardar cambios",group:"Edici\xF3n",contexts:["editor","batch-editor"]},{id:"cancel",key:"Escape",description:"Cancelar operaci\xF3n actual",group:"General",contexts:["global"]},{id:"delete",key:"Delete",description:"Eliminar elemento seleccionado",group:"Edici\xF3n",contexts:["editor","map"]},{id:"undo",key:"z",modifiers:{ctrl:!0},description:"Deshacer",group:"Edici\xF3n",contexts:["editor","map","batch-editor"]},{id:"redo",key:"y",modifiers:{ctrl:!0},description:"Rehacer",group:"Edici\xF3n",contexts:["editor","map","batch-editor"]},{id:"refresh",key:"r",modifiers:{ctrl:!0},description:"Actualizar datos",group:"Datos",contexts:["global"]}];this.registerShortcuts(e)}static \u0275fac=function(t){return new(t||i)};static \u0275prov=k({token:i,factory:i.\u0275fac,providedIn:"root"})};function Gm(i,e){if(i&1&&(s(0,"mat-chip"),d(1),l()),i&2){let t=e.$implicit;p(),E(t)}}function Wm(i,e){if(i&1&&(s(0,"div",10)(1,"span",11),d(2,"Contextos activos:"),l(),s(3,"mat-chip-set"),y(4,Gm,2,1,"mat-chip",12),l()()),i&2){let t=f();p(4),u("ngForOf",t.activeContexts)}}function Km(i,e){if(i&1&&(s(0,"div",13)(1,"mat-icon"),d(2,"keyboard"),l(),s(3,"p"),d(4),l()()),i&2){let t=f();p(4),V("No hay atajos de teclado ",t.showAllShortcuts?"registrados":"activos","")}}function qm(i,e){i&1&&(s(0,"th",22),d(1,"Contexto"),l())}function Qm(i,e){if(i&1&&(s(0,"span"),d(1),l()),i&2){let t=f(2).$implicit;p(),V("+",t.contexts.length-1,"")}}function Zm(i,e){if(i&1&&(s(0,"td",26)(1,"span",27),d(2),y(3,Qm,2,1,"span",28),l()()),i&2){let t=f().$implicit,n=f(3);p(),u("matTooltip",n.getContextsLabel(t)),p(),V(" ",t.contexts&&t.contexts.length?t.contexts[0]:"Global"," "),p(),u("ngIf",t.contexts&&t.contexts.length>1)}}function Ym(i,e){if(i&1&&(s(0,"tr")(1,"td",23)(2,"kbd"),d(3),l()(),s(4,"td",24),d(5),l(),y(6,Zm,4,3,"td",25),l()),i&2){let t=e.$implicit,n=f(3);K("inactive",n.showAllShortcuts&&!n.isShortcutActive(t)),p(3),E(n.formatKeyCombo(t)),p(2),V(" ",t.description," "),p(),u("ngIf",n.showAllShortcuts)}}function Xm(i,e){if(i&1&&(s(0,"mat-expansion-panel",16)(1,"mat-expansion-panel-header")(2,"mat-panel-title"),d(3),l()(),s(4,"div",17)(5,"table")(6,"thead")(7,"tr")(8,"th",18),d(9,"Atajo"),l(),s(10,"th",19),d(11,"Descripci\xF3n"),l(),y(12,qm,2,0,"th",20),l()(),s(13,"tbody"),y(14,Ym,7,5,"tr",21),l()()()()),i&2){let t=e.$implicit,n=f(2);u("expanded",!0),p(3),V(" ",t.name," "),p(9),u("ngIf",n.showAllShortcuts),p(2),u("ngForOf",t.shortcuts)}}function Jm(i,e){if(i&1&&(s(0,"div",14),y(1,Xm,15,4,"mat-expansion-panel",15),l()),i&2){let t=f();p(),u("ngForOf",t.shortcutGroups)}}var No=class i{constructor(e,t){this.dialogRef=e;this.keyboardShortcutsService=t}shortcutGroups=[];activeContexts=[];showAllShortcuts=!1;ngOnInit(){this.activeContexts=this.keyboardShortcutsService.getActiveContexts(),this.loadShortcuts()}loadShortcuts(){let e=this.showAllShortcuts?this.keyboardShortcutsService.getAllShortcuts():this.keyboardShortcutsService.getActiveShortcuts(),t=new Map;e.forEach(n=>{t.has(n.group)||t.set(n.group,[]),t.get(n.group)?.push(n)}),this.shortcutGroups=Array.from(t.entries()).map(([n,o])=>({name:n,shortcuts:o})).sort((n,o)=>n.name.localeCompare(o.name))}formatKeyCombo(e){let t=e.modifiers||{},n=[];t.ctrl&&n.push("Ctrl"),t.alt&&n.push("Alt"),t.shift&&n.push("Shift"),t.meta&&n.push("Meta");let o=this.formatKey(e.key);return n.push(o),n.join(" + ")}formatKey(e){let t={arrowup:"\u2191",arrowdown:"\u2193",arrowleft:"\u2190",arrowright:"\u2192",enter:"Enter",escape:"Esc",space:"Espacio",delete:"Delete",backspace:"Backspace",tab:"Tab"},n=e.toLowerCase();return t[n]||e.toUpperCase()}toggleShowAllShortcuts(){this.showAllShortcuts=!this.showAllShortcuts,this.loadShortcuts()}isShortcutActive(e){return!e.contexts||e.contexts.length===0?!0:e.contexts.some(t=>this.activeContexts.includes(t))}getContextsLabel(e){return!e.contexts||e.contexts.length===0?"General":e.contexts.join(", ")}close(){this.dialogRef.close()}static \u0275fac=function(t){return new(t||i)(I(zn),I(Yt))};static \u0275cmp=q({type:i,selectors:[["app-shortcuts-help-dialog"]],decls:17,vars:4,consts:[[1,"shortcuts-dialog"],["mat-dialog-title",""],[1,"dialog-actions"],["mat-button","",1,"toggle-button",3,"click"],["mat-icon-button","","aria-label","Cerrar",3,"click"],["class","contexts-info",4,"ngIf"],["class","empty-state",4,"ngIf"],["class","shortcut-groups",4,"ngIf"],["align","end"],["mat-button","",3,"click"],[1,"contexts-info"],[1,"contexts-label"],[4,"ngFor","ngForOf"],[1,"empty-state"],[1,"shortcut-groups"],[3,"expanded",4,"ngFor","ngForOf"],[3,"expanded"],[1,"shortcuts-table"],[1,"shortcut-header"],[1,"description-header"],["class","context-header",4,"ngIf"],[3,"inactive",4,"ngFor","ngForOf"],[1,"context-header"],[1,"shortcut-key"],[1,"shortcut-description"],["class","shortcut-context",4,"ngIf"],[1,"shortcut-context"],[3,"matTooltip"],[4,"ngIf"]],template:function(t,n){t&1&&(s(0,"div",0)(1,"h2",1)(2,"span"),d(3,"Atajos de teclado"),l(),s(4,"div",2)(5,"button",3),C("click",function(){return n.toggleShowAllShortcuts()}),d(6),l(),s(7,"button",4),C("click",function(){return n.close()}),s(8,"mat-icon"),d(9,"close"),l()()()(),y(10,Wm,5,1,"div",5),s(11,"mat-dialog-content"),y(12,Km,5,1,"div",6)(13,Jm,2,1,"div",7),l(),s(14,"mat-dialog-actions",8)(15,"button",9),C("click",function(){return n.close()}),d(16,"Cerrar"),l()()()),t&2&&(p(6),V(" ",n.showAllShortcuts?"Mostrar solo activos":"Mostrar todos"," "),p(4),u("ngIf",n.activeContexts.length>0),p(2),u("ngIf",n.shortcutGroups.length===0),p(),u("ngIf",n.shortcutGroups.length>0))},dependencies:[X,je,ie,le,de,he,Re,Ne,Qt,Bn,$n,Vn,jn,to,no,io,Zt,ao,Xl,Ee,Me],styles:[".shortcuts-dialog[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;padding-right:0}.shortcuts-dialog[_ngcontent-%COMP%]   .dialog-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.shortcuts-dialog[_ngcontent-%COMP%]   .toggle-button[_ngcontent-%COMP%]{font-size:12px;height:32px;line-height:32px}.shortcuts-dialog[_ngcontent-%COMP%]   mat-dialog-content[_ngcontent-%COMP%]{max-height:70vh;min-height:300px}.shortcuts-dialog[_ngcontent-%COMP%]   .contexts-info[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:16px;padding:0 16px}.shortcuts-dialog[_ngcontent-%COMP%]   .contexts-info[_ngcontent-%COMP%]   .contexts-label[_ngcontent-%COMP%]{margin-right:8px;font-weight:500;color:#0009}.shortcuts-dialog[_ngcontent-%COMP%]   .contexts-info[_ngcontent-%COMP%]   mat-chip-set[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:4px}.shortcuts-dialog[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]{height:200px;display:flex;flex-direction:column;justify-content:center;align-items:center;color:#0000008a}.shortcuts-dialog[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;height:48px;width:48px;margin-bottom:16px}.shortcuts-dialog[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px}.shortcuts-dialog[_ngcontent-%COMP%]   .shortcut-groups[_ngcontent-%COMP%]   mat-expansion-panel[_ngcontent-%COMP%]{margin-bottom:16px}.shortcuts-dialog[_ngcontent-%COMP%]   .shortcut-groups[_ngcontent-%COMP%]   mat-expansion-panel[_ngcontent-%COMP%]:last-child{margin-bottom:0}.shortcuts-dialog[_ngcontent-%COMP%]   .shortcuts-table[_ngcontent-%COMP%]{width:100%}.shortcuts-dialog[_ngcontent-%COMP%]   .shortcuts-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.shortcuts-dialog[_ngcontent-%COMP%]   .shortcuts-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:left;padding:8px;font-weight:500;color:#0009;border-bottom:1px solid rgba(0,0,0,.12)}.shortcuts-dialog[_ngcontent-%COMP%]   .shortcuts-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border-bottom:1px solid rgba(0,0,0,.12)}.shortcuts-dialog[_ngcontent-%COMP%]   .shortcuts-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:last-child{border-bottom:none}.shortcuts-dialog[_ngcontent-%COMP%]   .shortcuts-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr.inactive[_ngcontent-%COMP%]{opacity:.5}.shortcuts-dialog[_ngcontent-%COMP%]   .shortcuts-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px 8px}.shortcuts-dialog[_ngcontent-%COMP%]   .shortcuts-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td.shortcut-key[_ngcontent-%COMP%]{width:20%;min-width:120px}.shortcuts-dialog[_ngcontent-%COMP%]   .shortcuts-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td.shortcut-description[_ngcontent-%COMP%]{width:60%}.shortcuts-dialog[_ngcontent-%COMP%]   .shortcuts-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td.shortcut-context[_ngcontent-%COMP%]{width:20%;color:#0009;font-size:12px}.shortcuts-dialog[_ngcontent-%COMP%]   kbd[_ngcontent-%COMP%]{display:inline-block;padding:4px 8px;font-family:monospace;font-size:14px;line-height:1;color:#444;background-color:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px #0003;white-space:nowrap;margin:0 2px}.dark-theme[_nghost-%COMP%]   .shortcuts-dialog[_ngcontent-%COMP%]   .contexts-info[_ngcontent-%COMP%]   .contexts-label[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   .shortcuts-dialog[_ngcontent-%COMP%]   .contexts-info[_ngcontent-%COMP%]   .contexts-label[_ngcontent-%COMP%]{color:#ffffffb3}.dark-theme[_nghost-%COMP%]   .shortcuts-dialog[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   .shortcuts-dialog[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]{color:#ffffffb3}.dark-theme[_nghost-%COMP%]   .shortcuts-dialog[_ngcontent-%COMP%]   .shortcuts-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   .shortcuts-dialog[_ngcontent-%COMP%]   .shortcuts-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{color:#ffffffb3;border-bottom:1px solid rgba(255,255,255,.12)}.dark-theme[_nghost-%COMP%]   .shortcuts-dialog[_ngcontent-%COMP%]   .shortcuts-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   .shortcuts-dialog[_ngcontent-%COMP%]   .shortcuts-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border-bottom:1px solid rgba(255,255,255,.12)}.dark-theme[_nghost-%COMP%]   .shortcuts-dialog[_ngcontent-%COMP%]   .shortcuts-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td.shortcut-context[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   .shortcuts-dialog[_ngcontent-%COMP%]   .shortcuts-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td.shortcut-context[_ngcontent-%COMP%]{color:#ffffffb3}.dark-theme[_nghost-%COMP%]   .shortcuts-dialog[_ngcontent-%COMP%]   kbd[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   .shortcuts-dialog[_ngcontent-%COMP%]   kbd[_ngcontent-%COMP%]{color:#e0e0e0;background-color:#424242;border-color:#666;box-shadow:0 1px #ffffff1a}.shortcuts-dialog-container[_ngcontent-%COMP%]   .mat-mdc-dialog-container[_ngcontent-%COMP%]{padding:16px}.shortcuts-dialog-content[_ngcontent-%COMP%]{max-height:80vh;padding:0}.shortcuts-list[_ngcontent-%COMP%]{padding:16px}.shortcut-item[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:12px;padding:8px;border-radius:4px}.shortcut-item[_ngcontent-%COMP%]:hover{background-color:#0000000a}.shortcut-combo[_ngcontent-%COMP%]{min-width:120px;background-color:#f5f5f5;padding:4px 8px;border-radius:4px;font-family:monospace;font-weight:700;text-align:center;white-space:nowrap;margin-right:16px;font-size:14px;box-shadow:0 1px 2px #0000001a}.shortcut-description[_ngcontent-%COMP%]{flex:1;font-size:14px}.shortcut-context[_ngcontent-%COMP%]{font-size:12px;color:#0000008a;margin-left:8px;display:flex;align-items:center}.shortcut-context[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;height:16px;width:16px;margin-right:4px}  .mat-tab-body-content{padding:8px 0}  .mat-dialog-container{padding:0}  .mat-dialog-title{margin:0;padding:16px 16px 0}  .mat-dialog-actions{margin:0;padding:8px 16px 16px}"]})};var Xt=class i{constructor(e){this.dialog=e;document.addEventListener("app-shortcut",t=>{t.detail&&t.detail.id==="help"&&this.showKeyboardShortcutsHelp()})}showKeyboardShortcutsHelp(){this.dialog.open(No,{width:"600px",maxWidth:"90vw",maxHeight:"80vh",panelClass:"shortcuts-dialog-container"})}static \u0275fac=function(t){return new(t||i)(P(Ye))};static \u0275prov=k({token:i,factory:i.\u0275fac,providedIn:"root"})};function eg(i,e){i&1&&(s(0,"div",26)(1,"mat-icon"),d(2,"notifications_none"),l(),s(3,"p"),d(4,"No hay notificaciones nuevas"),l()())}function tg(i,e){i&1&&(s(0,"mat-icon"),d(1,"account_circle"),l())}function ng(i,e){if(i&1&&D(0,"img",27),i&2){let t=f();u("src",t.userAvatar,tl)}}var ig={"/dashboard":"Dashboard","/network-design":"Dise\xF1o de Red","/projects":"Proyectos","/offline":"Modo Offline","/settings":"Configuraci\xF3n","/profile":"Mi Perfil","/help":"Ayuda"},Ro=class i{constructor(e,t,n){this.authService=e;this.router=t;this.helpService=n}navCollapsed=!1;pageTitle="Dashboard";notificationCount=0;userName="Usuario";userAvatar=null;userRoles=[];subscriptions=new $t;ngOnInit(){this.loadUserData(),this.subscriptions.add(this.router.events.pipe(_e(e=>e instanceof On),se(e=>{let t="/"+e.urlAfterRedirects.split("/")[1];return ig[t]||"Network Map"})).subscribe(e=>{this.pageTitle=e}))}ngOnDestroy(){this.subscriptions.unsubscribe()}toggleSidebar(){this.navCollapsed=!this.navCollapsed}logout(){this.authService.logout()}markAllAsRead(){this.notificationCount=0}loadUserData(){let e=this.authService.getCurrentUser();e&&(this.userName=`${e.firstName} ${e.lastName}`,this.userAvatar=null,this.userRoles=[e.role])}showKeyboardShortcuts(){this.helpService.showKeyboardShortcutsHelp()}static \u0275fac=function(t){return new(t||i)(I(Ze),I(Se),I(Xt))};static \u0275cmp=q({type:i,selectors:[["app-main-layout"]],decls:54,vars:13,consts:[["notificationsMenu","matMenu"],["userMenu","matMenu"],[1,"layout-container"],[3,"collapsed","userRoles"],[1,"content-container"],[1,"top-toolbar"],[1,"toolbar-left"],["mat-icon-button","",3,"click"],[1,"page-title"],[1,"toolbar-actions"],["mat-icon-button","","matTooltip","Atajos de teclado",3,"click"],["mat-icon-button","",3,"matMenuTriggerFor"],["matBadgeColor","warn","aria-hidden","false",3,"matBadge","matBadgeHidden"],[1,"notifications-menu"],[1,"notification-header"],["mat-button","","color","primary",3,"click"],["class","empty-notifications",4,"ngIf"],["mat-button","",1,"user-menu-button",3,"matMenuTriggerFor"],[1,"user-avatar"],[4,"ngIf"],["alt","Avatar",3,"src",4,"ngIf"],[1,"username"],["mat-menu-item","","routerLink","/profile"],["mat-menu-item","","routerLink","/settings"],["mat-menu-item","",3,"click"],[1,"main-content"],[1,"empty-notifications"],["alt","Avatar",3,"src"]],template:function(t,n){if(t&1){let o=F();s(0,"div",2),D(1,"app-navigation-sidebar",3),s(2,"div",4)(3,"mat-toolbar",5)(4,"div",6)(5,"button",7),C("click",function(){return _(o),b(n.toggleSidebar())}),s(6,"mat-icon"),d(7,"menu"),l()(),s(8,"h1",8),d(9),l()(),s(10,"div",9)(11,"button",10),C("click",function(){return _(o),b(n.showKeyboardShortcuts())}),s(12,"mat-icon"),d(13,"keyboard"),l()(),s(14,"button",11)(15,"mat-icon",12),d(16," notifications "),l()(),s(17,"mat-menu",13,0)(19,"div",14)(20,"h3"),d(21,"Notificaciones"),l(),s(22,"button",15),C("click",function(){return _(o),b(n.markAllAsRead())}),d(23,"Marcar todas como le\xEDdas"),l()(),D(24,"mat-divider"),y(25,eg,5,0,"div",16),l(),s(26,"button",17)(27,"div",18),y(28,tg,2,0,"mat-icon",19)(29,ng,1,1,"img",20),l(),s(30,"span",21),d(31),l(),s(32,"mat-icon"),d(33,"arrow_drop_down"),l()(),s(34,"mat-menu",null,1)(36,"button",22)(37,"mat-icon"),d(38,"person"),l(),s(39,"span"),d(40,"Mi Perfil"),l()(),s(41,"button",23)(42,"mat-icon"),d(43,"settings"),l(),s(44,"span"),d(45,"Configuraci\xF3n"),l()(),D(46,"mat-divider"),s(47,"button",24),C("click",function(){return _(o),b(n.logout())}),s(48,"mat-icon"),d(49,"exit_to_app"),l(),s(50,"span"),d(51,"Cerrar Sesi\xF3n"),l()()()()(),s(52,"div",25),D(53,"router-outlet"),l()()()}if(t&2){let o=vt(18),r=vt(35);p(),u("collapsed",n.navCollapsed)("userRoles",n.userRoles),p(),K("nav-collapsed",n.navCollapsed),p(7),E(n.pageTitle),p(5),u("matMenuTriggerFor",o),p(),u("matBadge",n.notificationCount)("matBadgeHidden",n.notificationCount===0),p(10),u("ngIf",n.notificationCount===0),p(),u("matMenuTriggerFor",r),p(2),u("ngIf",!n.userAvatar),p(),u("ngIf",n.userAvatar),p(2),E(n.userName)}},dependencies:[X,ie,Ut,Pt,kn,Dn,Ol,le,de,Rn,An,In,Nn,he,Re,Ne,Yn,Kt,Al,Ue,Ot,Ee,Me,Io],styles:[".layout-container[_ngcontent-%COMP%]{display:flex;height:100vh;width:100vw;overflow:hidden}.content-container[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;width:calc(100% - 240px);transition:width .3s ease}.content-container.nav-collapsed[_ngcontent-%COMP%]{width:calc(100% - 64px)}.top-toolbar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;background-color:#fff;color:#000000de;border-bottom:1px solid #e0e0e0;padding:0 16px}.toolbar-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.page-title[_ngcontent-%COMP%]{font-size:20px;font-weight:500;margin:0}.toolbar-actions[_ngcontent-%COMP%], .user-menu-button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.user-avatar[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:32px;height:32px;border-radius:50%;background-color:#f0f0f0;overflow:hidden}.user-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.username[_ngcontent-%COMP%]{max-width:150px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.main-content[_ngcontent-%COMP%]{flex:1;overflow:auto;padding:16px;background-color:#f5f5f5}.notifications-menu[_ngcontent-%COMP%]{min-width:320px}.notification-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px}.notification-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-weight:500}.empty-notifications[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:24px;color:#757575}.empty-notifications[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;height:48px;width:48px;margin-bottom:8px}"]})};var Xc=(i,e)=>{let t=M(Ze),n=M(Se);return t.isAuthenticated()?!0:(n.navigate(["/auth/login"],{queryParams:{returnUrl:e.url}}),!1)};var Jc=(i,e)=>{let t=M(Ze),n=M(Se);return t.isAuthenticated()?(n.navigate(["/dashboard"]),!1):!0};var ed=i=>{let e=M(Ze),t=M(Se);return e.isAuthenticated()&&e.hasAnyRole(i)?!0:t.createUrlTree(["/dashboard"])};var og=[[["",8,"widget-header"]]],rg=[".widget-header"];function ag(i,e){if(i&1&&(s(0,"div",4)(1,"span",5),d(2,"Descripci\xF3n:"),l(),s(3,"span",6),d(4),l()()),i&2){let t=f(2);p(4),E(t.selectedElement.description)}}function sg(i,e){if(i&1&&(s(0,"div",4)(1,"span",5),d(2,"Posici\xF3n:"),l(),s(3,"span",6),d(4),Le(5,"number"),Le(6,"number"),l()()),i&2){let t=f(2);p(4),Mn(" ",Mt(5,2,t.selectedElement.position.lat,"1.6-6"),", ",Mt(6,5,t.selectedElement.position.lng,"1.6-6")," ")}}function lg(i,e){if(i&1){let t=F();s(0,"div",1),ui(1),s(2,"div",2)(3,"h3"),d(4),l(),D(5,"mat-divider"),s(6,"div",3)(7,"div",4)(8,"span",5),d(9,"ID:"),l(),s(10,"span",6),d(11),l()(),s(12,"div",4)(13,"span",5),d(14,"Tipo:"),l(),s(15,"span",6),d(16),l()(),y(17,ag,5,1,"div",7)(18,sg,7,8,"div",7),l(),s(19,"div",8)(20,"button",9),C("click",function(){_(t);let o=f();return b(o.onEditElement())}),s(21,"mat-icon"),d(22,"edit"),l(),d(23," Editar "),l(),s(24,"button",10),C("click",function(){_(t);let o=f();return b(o.onDeleteElement())}),s(25,"mat-icon"),d(26,"delete"),l(),d(27," Eliminar "),l(),s(28,"button",11),C("click",function(){_(t);let o=f();return b(o.onLocateElement())}),s(29,"mat-icon"),d(30,"my_location"),l(),d(31," Localizar "),l(),s(32,"button",11),C("click",function(){_(t);let o=f();return b(o.onViewConnections())}),s(33,"mat-icon"),d(34,"link"),l(),d(35," Ver conexiones "),l()()()()}if(i&2){let t=f();p(4),E(t.selectedElement.name||"Elemento sin nombre"),p(7),E(t.selectedElement.id),p(5),E(t.selectedElement.type),p(),u("ngIf",t.selectedElement.description),p(),u("ngIf",t.selectedElement.position)}}var Lo=class i{selectedElement=null;widgetAction=new U;widgetError=new U;widgetUpdate=new U;viewConnections=new U;onEditElement(){this.selectedElement&&this.widgetAction.emit({source:"element-properties-widget",type:"action",timestamp:new Date,action:"edit",elementId:this.selectedElement.id,actionData:{element:this.selectedElement}})}onDeleteElement(){this.selectedElement&&this.widgetAction.emit({source:"element-properties-widget",type:"action",timestamp:new Date,action:"delete",elementId:this.selectedElement.id,actionData:{element:this.selectedElement}})}onLocateElement(){this.selectedElement&&this.widgetAction.emit({source:"element-properties-widget",type:"action",timestamp:new Date,action:"locate",elementId:this.selectedElement.id,actionData:{element:this.selectedElement}})}onViewConnections(){this.selectedElement?.id&&this.viewConnections.emit(this.selectedElement.id)}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=q({type:i,selectors:[["app-element-properties-widget"]],inputs:{selectedElement:"selectedElement"},outputs:{widgetAction:"widgetAction",widgetError:"widgetError",widgetUpdate:"widgetUpdate",viewConnections:"viewConnections"},ngContentSelectors:rg,decls:1,vars:1,consts:[["class","widget-container",4,"ngIf"],[1,"widget-container"],[1,"widget-content"],[1,"element-properties"],[1,"property-row"],[1,"property-label"],[1,"property-value"],["class","property-row",4,"ngIf"],[1,"actions"],["mat-button","","color","primary",3,"click"],["mat-button","","color","warn",3,"click"],["mat-button","",3,"click"]],template:function(t,n){t&1&&(gi(og),y(0,lg,36,5,"div",0)),t&2&&u("ngIf",n.selectedElement)},dependencies:[X,ie,Wi,he,Re,le,de,Ue,Ot,jn],styles:[".widget-container[_ngcontent-%COMP%]{width:300px;max-height:400px;overflow-y:auto}.widget-content[_ngcontent-%COMP%]{padding:16px}h3[_ngcontent-%COMP%]{margin-top:0;margin-bottom:12px;font-size:16px;font-weight:500;color:#333}.element-properties[_ngcontent-%COMP%]{margin:12px 0}.property-row[_ngcontent-%COMP%]{display:flex;margin-bottom:8px}.property-label[_ngcontent-%COMP%]{font-weight:500;min-width:100px;color:#555}.property-value[_ngcontent-%COMP%]{flex:1;word-break:break-word}.actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-top:16px}"],changeDetection:0})};var Fo=class i{constructor(){}static \u0275fac=function(t){return new(t||i)};static \u0275prov=k({token:i,factory:i.\u0275fac,providedIn:"root"})};var nd=i=>({width:i}),pg=()=>[];function mg(i,e){i&1&&(s(0,"div",23),D(1,"div",24)(2,"div",24)(3,"div",25),s(4,"div",26),D(5,"div",27)(6,"div",24)(7,"div",24),l()())}function gg(i,e){if(i&1&&(s(0,"div",29)(1,"span",30),d(2,"Descripci\xF3n:"),l(),s(3,"span",38),d(4),l()()),i&2){let t=f(3);p(4),E(t.element.description)}}function ug(i,e){if(i&1&&(s(0,"span"),d(1),l()),i&2){let t=f(4);p(),V("Alt: ",t.element.position.altitude,"m")}}function hg(i,e){if(i&1&&(s(0,"div",39)(1,"div",40)(2,"mat-icon"),d(3,"location_on"),l(),s(4,"span"),d(5,"Ubicaci\xF3n"),l()(),s(6,"div",41)(7,"span"),d(8),Le(9,"number"),l(),s(10,"span"),d(11),Le(12,"number"),l(),y(13,ug,2,1,"span",42),s(14,"button",43)(15,"mat-icon"),d(16,"map"),l()()()()),i&2){let t=f(3);p(8),V("Lat: ",Mt(9,3,t.element.position.coordinates[1],"1.6-6"),""),p(3),V("Lon: ",Mt(12,6,t.element.position.coordinates[0],"1.6-6"),""),p(2),u("ngIf",t.element.position.altitude)}}function fg(i,e){if(i&1&&(s(0,"div",29)(1,"span",30),d(2,"Fabricante:"),l(),s(3,"span",31),d(4),l()()),i&2){let t=f(4);p(4),E(t.element.manufacturer)}}function vg(i,e){if(i&1&&(s(0,"div",29)(1,"span",30),d(2,"Modelo:"),l(),s(3,"span",31),d(4),l()()),i&2){let t=f(4);p(4),E(t.element.model)}}function _g(i,e){if(i&1&&(s(0,"div",29)(1,"span",30),d(2,"Total puertos:"),l(),s(3,"span",31),d(4),l()()),i&2){let t=f(4);p(4),E(t.element.portCount)}}function bg(i,e){if(i&1&&(s(0,"div",46)(1,"div",47)(2,"span",48),d(3,"PON"),l(),s(4,"span",49),d(5),l()(),s(6,"div",47)(7,"span",48),d(8,"Distribuci\xF3n"),l(),s(9,"span",49),d(10),l()(),s(11,"div",47)(12,"span",48),d(13,"Uplink"),l(),s(14,"span",49),d(15),l()()()),i&2){let t=f(4);p(),K("active",t.isPonPortActive(t.element)),p(4),E(t.element.ponPorts||0),p(),K("active",t.isDistributionPortActive(t.element)),p(4),E(t.element.distributionPorts||0),p(),K("active",t.isUplinkPortActive(t.element)),p(4),E(t.element.uplinkPorts||0)}}function Cg(i,e){if(i&1&&(s(0,"div",44)(1,"div",40)(2,"mat-icon"),d(3,"memory"),l(),s(4,"span"),d(5,"Informaci\xF3n OLT"),l()(),y(6,fg,5,1,"div",32)(7,vg,5,1,"div",32)(8,_g,5,1,"div",32)(9,bg,16,9,"div",45),l()),i&2){let t=f(3);p(6),u("ngIf",t.element.manufacturer),p(),u("ngIf",t.element.model),p(),u("ngIf",t.element.portCount),p(),u("ngIf",t.element.ponPorts||t.element.distributionPorts||t.element.uplinkPorts)}}function yg(i,e){if(i&1&&(s(0,"div",29)(1,"span",30),d(2,"Fabricante:"),l(),s(3,"span",31),d(4),l()()),i&2){let t=f(4);p(4),E(t.element.manufacturer)}}function Eg(i,e){if(i&1&&(s(0,"div",29)(1,"span",30),d(2,"Modelo:"),l(),s(3,"span",31),d(4),l()()),i&2){let t=f(4);p(4),E(t.element.model)}}function wg(i,e){if(i&1&&(s(0,"div",29)(1,"span",30),d(2,"N\xB0 Serie:"),l(),s(3,"span",31),d(4),l()()),i&2){let t=f(4);p(4),E(t.element.serialNumber)}}function xg(i,e){if(i&1&&(s(0,"div",29)(1,"span",30),d(2,"Est\xE1ndar PON:"),l(),s(3,"span",31),d(4),l()()),i&2){let t=f(4);p(4),E(t.element.ponStandard)}}function Sg(i,e){if(i&1&&(s(0,"div",51)(1,"span",30),d(2,"Se\xF1al:"),l(),s(3,"div",52),D(4,"div",53),l(),s(5,"span",54),d(6),l()()),i&2){let t=f(4);p(4),u("ngStyle",_t(3,nd,t.element.signalStrength>=-25?"100%":t.element.signalStrength>=-28?"80%":t.element.signalStrength>=-32?"60%":t.element.signalStrength>=-35?"40%":"20%"))("ngClass",t.element.signalStrength>=-28?"excellent":t.element.signalStrength>=-32?"good":t.element.signalStrength>=-35?"fair":"poor"),p(2),V("",t.element.signalStrength," dBm")}}function Mg(i,e){if(i&1&&(s(0,"div",44)(1,"div",40)(2,"mat-icon"),d(3,"router"),l(),s(4,"span"),d(5,"Informaci\xF3n ONT"),l()(),y(6,yg,5,1,"div",32)(7,Eg,5,1,"div",32)(8,wg,5,1,"div",32)(9,xg,5,1,"div",32)(10,Sg,7,5,"div",50),l()),i&2){let t=f(3);p(6),u("ngIf",t.element.manufacturer),p(),u("ngIf",t.element.model),p(),u("ngIf",t.element.serialNumber),p(),u("ngIf",t.element.ponStandard),p(),u("ngIf",t.element.signalStrength!==void 0)}}function Tg(i,e){if(i&1&&(s(0,"div",29)(1,"span",30),d(2,"Relaci\xF3n:"),l(),s(3,"span",31),d(4),l()()),i&2){let t=f(4);p(4),E(t.element.splitRatio)}}function Pg(i,e){if(i&1&&(s(0,"div",29)(1,"span",30),d(2,"Puertos de salida:"),l(),s(3,"span",31),d(4),l()()),i&2){let t=f(4);p(4),E(t.element.outputPorts)}}function Og(i,e){i&1&&D(0,"div",60)}function kg(i,e){if(i&1&&(s(0,"div",56),D(1,"div",57),s(2,"div",58),y(3,Og,1,0,"div",59),l()()),i&2){let t=f(4);p(3),u("ngForOf",Lt(1,pg).constructor(t.getOutputPortCount(t.element.splitRatio)))}}function Dg(i,e){if(i&1&&(s(0,"div",29)(1,"span",30),d(2,"Instalaci\xF3n:"),l(),s(3,"span",31),d(4),Le(5,"date"),l()()),i&2){let t=f(4);p(4),E(Mt(5,1,t.element.installationDate,"dd/MM/yyyy"))}}function Ig(i,e){if(i&1&&(s(0,"div",44)(1,"div",40)(2,"mat-icon"),d(3,"device_hub"),l(),s(4,"span"),d(5,"Informaci\xF3n Splitter"),l()(),y(6,Tg,5,1,"div",32)(7,Pg,5,1,"div",32)(8,kg,4,2,"div",55)(9,Dg,6,4,"div",32),l()),i&2){let t=f(3);p(6),u("ngIf",t.element.splitRatio),p(),u("ngIf",t.element.outputPorts),p(),u("ngIf",t.element.splitRatio),p(),u("ngIf",t.element.installationDate)}}function Ag(i,e){if(i&1&&(s(0,"div",29)(1,"span",30),d(2,"Fabricante:"),l(),s(3,"span",31),d(4),l()()),i&2){let t=f(4);p(4),E(t.element.manufacturer)}}function Ng(i,e){if(i&1&&(s(0,"div",29)(1,"span",30),d(2,"Modelo:"),l(),s(3,"span",31),d(4),l()()),i&2){let t=f(4);p(4),E(t.element.model)}}function Rg(i,e){if(i&1&&(s(0,"div",62)(1,"span",30),d(2,"Capacidad de puertos:"),l(),s(3,"div",63),D(4,"div",64),l(),s(5,"span",65),d(6),l()()),i&2){let t=f(4);p(4),u("ngStyle",_t(4,nd,t.getPortUsagePercentage(t.element)+"%"))("ngClass",t.isPortUsageCritical(t.element)?"critical":t.isPortUsageWarning(t.element)?"warning":"normal"),p(2),Mn("",t.element.usedPorts||0," de ",t.element.totalPortCapacity,"")}}function Lg(i,e){if(i&1&&(s(0,"div",44)(1,"div",40)(2,"mat-icon"),d(3,"grid_on"),l(),s(4,"span"),d(5,"Informaci\xF3n ODF"),l()(),y(6,Ag,5,1,"div",32)(7,Ng,5,1,"div",32)(8,Rg,7,6,"div",61),l()),i&2){let t=f(3);p(6),u("ngIf",t.element.manufacturer),p(),u("ngIf",t.element.model),p(),u("ngIf",t.element.totalPortCapacity)}}function Fg(i,e){if(i&1&&(s(0,"div",29)(1,"span",30),d(2,"\xDAltimo mantenimiento:"),l(),s(3,"span",31),d(4),Le(5,"date"),l()()),i&2){let t=f(4);p(4),E(Mt(5,1,t.element.lastMaintenance,"dd/MM/yyyy"))}}function zg(i,e){if(i&1&&(s(0,"div",29)(1,"span",30),d(2,"Pr\xF3ximo mantenimiento:"),l(),s(3,"span",31),d(4),Le(5,"date"),l()()),i&2){let t=f(4);p(4),E(Mt(5,1,t.element.nextMaintenance,"dd/MM/yyyy"))}}function Bg(i,e){if(i&1&&(s(0,"div",29)(1,"span",30),d(2,"Creado:"),l(),s(3,"span",31),d(4),Le(5,"date"),l()()),i&2){let t=f(4);p(4),E(Mt(5,1,t.element.createdAt,"dd/MM/yyyy"))}}function Vg(i,e){if(i&1&&(s(0,"div",44)(1,"div",40)(2,"mat-icon"),d(3,"info"),l(),s(4,"span"),d(5,"Informaci\xF3n adicional"),l()(),y(6,Fg,6,4,"div",32)(7,zg,6,4,"div",32)(8,Bg,6,4,"div",32),l()),i&2){let t=f(3);p(6),u("ngIf",t.element.lastMaintenance),p(),u("ngIf",t.element.nextMaintenance),p(),u("ngIf",t.element.createdAt)}}function $g(i,e){if(i&1&&(s(0,"div",77),D(1,"span",78),s(2,"span",79),d(3),l()()),i&2){let t=f().$implicit,n=f(5);p(),u("ngClass",n.getConnectionStatus(t)),p(2),E(n.getConnectionStatus(t))}}function jg(i,e){if(i&1){let t=F();s(0,"div",69)(1,"button",70),C("click",function(){let o=_(t).$implicit,r=f(5);return b(r.navigateToElement(o.targetElementId))}),s(2,"mat-icon",71),d(3),l(),s(4,"div",72)(5,"span",73),d(6),l(),s(7,"span",74),d(8),l()(),y(9,$g,4,2,"div",75),s(10,"mat-icon",76),d(11,"chevron_right"),l()()()}if(i&2){let t=e.$implicit,n=f(5);p(2),u("ngClass",n.getElementStatusClass(n.getConnectionTargetStatus(t))),p(),V(" ",n.getElementTypeIcon(n.getConnectionTargetType(t))," "),p(3),E(n.getConnectionTargetName(t)),p(2),E(n.getElementTypeName(n.getConnectionTargetType(t))),p(),u("ngIf",n.hasConnectionStatus(t))}}function Ug(i,e){if(i&1&&(Ie(0),y(1,jg,12,5,"div",68),Ae()),i&2){let t=f(4);p(),u("ngForOf",t.extendedConnections)}}function Hg(i,e){if(i&1){let t=F();s(0,"div",69)(1,"button",70),C("click",function(){let o=_(t).$implicit,r=f(5);return b(r.navigateToElement(o))}),s(2,"mat-icon",80),d(3,"grid_view"),l(),s(4,"div",72)(5,"span",73),d(6,"ODF conectado"),l(),s(7,"span",74),d(8,"Marco de Distribuci\xF3n \xD3ptica"),l()(),s(9,"mat-icon",76),d(10,"chevron_right"),l()()()}}function Gg(i,e){if(i&1&&(Ie(0),y(1,Hg,11,0,"div",68),Ae()),i&2){let t=f(4);p(),u("ngForOf",t.element.odfIds)}}function Wg(i,e){if(i&1){let t=F();Ie(0),s(1,"div",69)(2,"button",70),C("click",function(){_(t);let o=f(4);return b(o.navigateToElement(o.element.oltId))}),s(3,"mat-icon",80),d(4,"router"),l(),s(5,"div",72)(6,"span",73),d(7,"OLT conectado"),l(),s(8,"span",74),d(9,"Terminal de L\xEDnea \xD3ptica"),l()(),s(10,"mat-icon",76),d(11,"chevron_right"),l()()(),Ae()}}function Kg(i,e){if(i&1&&(s(0,"div",66)(1,"div",40)(2,"mat-icon"),d(3,"link"),l(),s(4,"span"),d(5,"Elementos relacionados"),l()(),s(6,"div",67),y(7,Ug,2,1,"ng-container",42)(8,Gg,2,1,"ng-container",42)(9,Wg,12,0,"ng-container",42),l()()),i&2){let t=f(3);p(7),u("ngIf",t.extendedConnections==null?null:t.extendedConnections.length),p(),u("ngIf",t.element.type==="OLT"&&(t.element.odfIds==null?null:t.element.odfIds.length)),p(),u("ngIf",t.element.type==="ONT"&&t.element.oltId)}}function qg(i,e){if(i&1&&(s(0,"div",28)(1,"div",29)(2,"span",30),d(3,"C\xF3digo:"),l(),s(4,"span",31),d(5),l()(),y(6,gg,5,1,"div",32)(7,hg,17,9,"div",33),Ie(8,34),y(9,Cg,10,4,"div",35)(10,Mg,11,5,"div",35)(11,Ig,10,4,"div",35)(12,Lg,9,3,"div",35)(13,Vg,9,3,"div",36),Ae(),y(14,Kg,10,3,"div",37),l()),i&2){let t=f(2);p(5),E(t.element.id||"No disponible"),p(),u("ngIf",t.element.description),p(),u("ngIf",t.element.position==null?null:t.element.position.coordinates),p(),u("ngSwitch",t.element.type),p(),u("ngSwitchCase","OLT"),p(),u("ngSwitchCase","ONT"),p(),u("ngSwitchCase","SPLITTER"),p(),u("ngSwitchCase","ODF"),p(2),u("ngIf",t.hasRelatedElements)}}function Qg(i,e){if(i&1){let t=F();s(0,"div",2)(1,"mat-card",3)(2,"div",4)(3,"div",5)(4,"div",6)(5,"mat-icon",7),d(6),l()(),s(7,"div",8)(8,"h2",9),d(9),l(),s(10,"div",10)(11,"span",11),d(12),l(),s(13,"span",12),d(14),Le(15,"slice"),l()(),s(16,"div",13),D(17,"span",14),d(18),l()()(),s(19,"div",15)(20,"button",16),C("click",function(){_(t);let o=f();return b(o.onEdit())}),s(21,"mat-icon"),d(22,"edit"),l()(),s(23,"button",17),C("click",function(){_(t);let o=f();return b(o.onViewHistory())}),s(24,"mat-icon"),d(25,"history"),l()(),s(26,"button",18),C("click",function(){_(t);let o=f();return b(o.onClose())}),s(27,"mat-icon"),d(28,"close"),l()()()(),s(29,"mat-card-content"),y(30,mg,8,0,"div",19)(31,qg,15,9,"div",20),l()(),s(32,"div",21)(33,"button",22),C("click",function(){_(t);let o=f();return b(o.onDelete())}),s(34,"mat-icon"),d(35,"delete"),l(),s(36,"span"),d(37,"Eliminar"),l()()()()}if(i&2){let t=f();u("@slideInOut",void 0),p(4),u("ngClass",t.getElementStatusClass(t.element.status)),p(2),E(t.element.type==="OLT"?"router":t.element.type==="ONT"?"device_hub":t.element.type==="SPLITTER"?"call_split":t.element.type==="ODF"?"grid_view":t.element.type==="TERMINAL_BOX"?"inbox":t.element.type==="FIBER_THREAD"?"timeline":t.element.type==="MANGA"?"category":"settings_input_component"),p(3),E(t.element.name||"Sin nombre"),p(3),E(t.getElementTypeName(t.element.type)),p(2),V("ID: ",rl(15,10,t.element.id,0,8),"..."),p(2),u("ngClass",t.getElementStatusClass(t.element.status)),p(2),V(" ",t.element.status," "),p(12),u("ngIf",t.loading),p(),u("ngIf",!t.loading)}}function Zg(i,e){if(i&1){let t=F();s(0,"app-element-properties-widget",81),C("viewConnections",function(o){_(t);let r=f();return b(r.onViewConnections(o))}),l()}if(i&2){let t=f();u("selectedElement",t.element)}}var zo=class i{constructor(e){this.elementHistoryService=e}destroy$=new N;element=null;loading=!1;loadingRelated=!1;elementManagementService=M(sc);networkStateService=M(Te);dialog=M(Ye);router=M(Se);snackBar=M(He);cdr=M($e);viewConnections=new U;get hasRelatedElements(){return this.element?this.element.connections?.length?!0:!!(this.element.type==="OLT"&&this.element.odfIds?.length||this.element.type==="ONT"&&this.element.oltId):!1}get extendedConnections(){return this.element?.connections?this.element.connections.map((e,t)=>({id:e,name:`Conexi\xF3n ${t+1}`,type:"FIBER",status:"ACTIVE",sourceElementId:this.element.id,targetElementId:e,targetName:`Elemento ${e.substring(0,8)}`,targetType:"NODE",targetStatus:"ACTIVE",connectionStatus:"connected"})):[]}ngOnInit(){this.subscribeToSelectedElement(),this.subscribeToNetworkState()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}subscribeToSelectedElement(){this.elementManagementService.getSelectedElement().pipe(R(this.destroy$)).subscribe({next:e=>{this.startLoadingElement(e)},error:e=>{this.handleElementLoadError(e)}})}startLoadingElement(e){this.loading=!0,this.cdr.markForCheck(),setTimeout(()=>{this.element=e,this.loading=!1,this.cdr.markForCheck()},300)}handleElementLoadError(e){console.error("Error obteniendo elemento seleccionado:",e),this.loading=!1,this.snackBar.open("Error al cargar datos del elemento","Cerrar",{duration:5e3,panelClass:["error-snackbar"]}),this.cdr.markForCheck()}subscribeToNetworkState(){this.networkStateService.getSelectedElementAsObservable().pipe(R(this.destroy$)).subscribe(e=>{e&&(this.elementManagementService.selectElement(e),this.cdr.markForCheck())})}getElementTypeName(e){return{OLT:"Terminal de L\xEDnea \xD3ptica",ONT:"Terminal de Red \xD3ptica",ODF:"Marco de Distribuci\xF3n \xD3ptica",EDFA:"Amplificador de Fibra",SPLITTER:"Divisor \xD3ptico",MANGA:"Manga",TERMINAL_BOX:"Caja Terminal",FIBER_THREAD:"Hilo de Fibra",FIBER_CONNECTION:"Conexi\xF3n de Fibra",RACK:"Rack",SLACK_FIBER:"Flojo de Fibra",CUSTOM:"Personalizado"}[e]||e.toString()}getElementStatusClass(e){return`status-${e.toLowerCase()}`}getStatusIconName(e){return{ACTIVE:"check_circle",INACTIVE:"cancel",MAINTENANCE:"build",ERROR:"error",PLANNING:"schedule"}[e]||"help"}getElementTypeIcon(e){return{OLT:"router",ONT:"device_hub",ODF:"grid_view",EDFA:"amp_stories",SPLITTER:"call_split",MANGA:"category",TERMINAL_BOX:"inbox",FIBER_THREAD:"timeline",FIBER_CONNECTION:"compare_arrows",RACK:"layers",SLACK_FIBER:"waves",CUSTOM:"settings_input_component"}[e]||"settings_input_component"}getOutputPortCount(e){if(!e)return 0;let t=e.match(/\d+:(\d+)/);return t&&t[1]?parseInt(t[1],10):0}navigateToElement(e){e&&this.router.navigate(["network","elements",e])}onEdit(){this.element?.id&&this.router.navigate(["network","elements",this.element.id,"edit"])}onDelete(){if(!this.element?.id)return;this.dialog.open(uo,{width:"400px",data:{title:"Eliminar elemento",message:`\xBFEst\xE1 seguro que desea eliminar el elemento "${this.element.name}"?`,confirmText:"Eliminar",cancelText:"Cancelar"}}).afterClosed().subscribe(t=>{if(t&&this.element?.id)try{let n=this.element.id;this.elementManagementService.deleteElement(n),this.handleDeleteSuccess()}catch(n){this.handleDeleteError(n)}finally{this.cdr.markForCheck()}})}handleDeleteSuccess(){this.snackBar.open("Elemento eliminado con \xE9xito","Cerrar",{duration:3e3}),this.onClose()}handleDeleteError(e){let t=e.message||"Error al eliminar el elemento";this.snackBar.open(t,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]})}onClose(){if(this.element=null,this.elementManagementService)try{this.elementManagementService.selectElement(null)}catch(e){console.error("Error al limpiar selecci\xF3n:",e)}this.cdr.markForCheck()}onViewHistory(){if(!this.element?.id)return;let e=this.snackBar.open("Cargando historial...","",{duration:0,panelClass:"info-snackbar"});import("./chunk-BLSFIP4A.js").then(({ElementHistoryDialogComponent:t})=>{let n=this.dialog.open(t,{width:"600px",maxWidth:"90vw",maxHeight:"90vh",data:{element:this.element},panelClass:"history-dialog"});e.dismiss()}).catch(t=>{console.error("Error al cargar el componente de historial:",t),e.dismiss(),this.snackBar.open("Error al cargar la interfaz de historial","Cerrar",{duration:5e3,panelClass:["error-snackbar"]})})}getConnectionTargetName(e){return e.targetName||"Elemento desconocido"}getConnectionTargetType(e){return e.targetType||"CUSTOM"}getConnectionTargetStatus(e){return e.targetStatus||"INACTIVE"}hasConnectionStatus(e){return!!e.connectionStatus}getConnectionStatus(e){return e.connectionStatus||"unknown"}isPonPortActive(e){return!!e?.ponPorts&&e.ponPorts>0}isDistributionPortActive(e){return!!e?.distributionPorts&&e.distributionPorts>0}isUplinkPortActive(e){return!!e?.uplinkPorts&&e.uplinkPorts>0}getPortUsagePercentage(e){let t=this.getPortUsageRatio(e);return t<0?0:Math.min(Math.round(t*100),100)}isPortUsageCritical(e){return this.getPortUsageRatio(e)>.9}isPortUsageWarning(e){let t=this.getPortUsageRatio(e);return t>.75&&t<=.9}getPortUsageRatio(e){return!e||!e.totalPortCapacity||e.totalPortCapacity<=0?-1:(e.usedPorts||0)/e.totalPortCapacity}onViewConnections(e){this.viewConnections.emit(e)}static \u0275fac=function(t){return new(t||i)(I(Fo))};static \u0275cmp=q({type:i,selectors:[["app-element-quick-view"]],outputs:{viewConnections:"viewConnections"},decls:2,vars:2,consts:[["class","element-quick-view-container",4,"ngIf"],[3,"selectedElement","viewConnections",4,"ngIf"],[1,"element-quick-view-container"],[1,"element-card"],[1,"card-header"],[1,"header-content"],[1,"element-icon-container",3,"ngClass"],[1,"element-icon"],[1,"element-info"],[1,"element-name"],[1,"element-meta"],[1,"element-type"],[1,"element-id"],[1,"element-status",3,"ngClass"],[1,"status-indicator"],[1,"action-buttons"],["mat-icon-button","","matTooltip","Editar elemento","aria-label","Editar",1,"action-button","edit-button",3,"click"],["mat-icon-button","","matTooltip","Ver historial","aria-label","Ver historial",1,"action-button","history-button",3,"click"],["mat-icon-button","","matTooltip","Cerrar","aria-label","Cerrar",1,"close-button",3,"click"],["class","skeleton-loader",4,"ngIf"],["class","content-section",4,"ngIf"],[1,"floating-action-menu"],["mat-fab","","extended","","color","warn","matTooltip","Eliminar elemento",1,"delete-fab",3,"click"],[1,"skeleton-loader"],[1,"skeleton-line"],[1,"skeleton-line",2,"width","70%"],[1,"skeleton-section"],[1,"skeleton-title"],[1,"content-section"],[1,"info-row"],[1,"info-label"],[1,"info-value"],["class","info-row",4,"ngIf"],["class","location-info",4,"ngIf"],[3,"ngSwitch"],["class","specific-info",4,"ngSwitchCase"],["class","specific-info",4,"ngSwitchDefault"],["class","related-elements",4,"ngIf"],[1,"info-value","description"],[1,"location-info"],[1,"section-title"],[1,"coordinates"],[4,"ngIf"],["mat-icon-button","","matTooltip","Ver en mapa","aria-label","Ver en mapa",1,"map-button"],[1,"specific-info"],["class","port-summary",4,"ngIf"],[1,"port-summary"],[1,"port-item"],[1,"port-label"],[1,"port-value"],["class","signal-strength animated",4,"ngIf"],[1,"signal-strength","animated"],[1,"signal-meter"],[1,"signal-bar",3,"ngStyle","ngClass"],[1,"signal-value"],["class","split-ratio-visual",4,"ngIf"],[1,"split-ratio-visual"],[1,"split-input"],[1,"split-outputs"],["class","split-output",4,"ngFor","ngForOf"],[1,"split-output"],["class","capacity-meter",4,"ngIf"],[1,"capacity-meter"],[1,"progress-container"],[1,"progress-bar",3,"ngStyle","ngClass"],[1,"capacity-text"],[1,"related-elements"],[1,"related-elements-list"],["class","related-element-item",4,"ngFor","ngForOf"],[1,"related-element-item"],["mat-stroked-button","",1,"related-element-button",3,"click"],[1,"element-type-icon",3,"ngClass"],[1,"related-element-info"],[1,"related-element-name"],[1,"related-element-type"],["class","connection-status",4,"ngIf"],[1,"navigate-icon"],[1,"connection-status"],[1,"connection-indicator",3,"ngClass"],[1,"connection-label"],[1,"element-type-icon"],[3,"viewConnections","selectedElement"]],template:function(t,n){t&1&&y(0,Qg,38,14,"div",0)(1,Zg,1,1,"app-element-properties-widget",1),t&2&&(u("ngIf",n.element),p(),u("ngIf",n.element))},dependencies:[X,pt,je,ie,pl,ll,cl,dl,hl,Wi,gl,po,lo,co,le,de,he,Re,Ne,Dl,Qt,Un,mt,Ee,Me,Lo],encapsulation:2,data:{animation:[Ft("slideInOut",[_i("void",pe({transform:"translateX(30px)",opacity:0})),Ct("void => *",[ot("300ms cubic-bezier(0.25, 0.8, 0.25, 1)",pe({transform:"translateX(0)",opacity:1}))]),Ct("* => void",[ot("250ms cubic-bezier(0.25, 0.8, 0.25, 1)",pe({transform:"translateX(30px)",opacity:0}))])]),Ft("fadeIn",[Ct(":enter",[pe({opacity:0}),ot("400ms ease-out",pe({opacity:1}))])]),Ft("staggerItems",[Ct(":enter",[yt(".info-row, .specific-info, .related-elements",[pe({opacity:0,transform:"translateY(10px)"}),tc(80,[ot("300ms cubic-bezier(0.25, 0.8, 0.25, 1)",pe({opacity:1,transform:"translateY(0)"}))])],{optional:!0})])])]},changeDetection:0})};function Xg(i,e){i&1&&(s(0,"div",12),D(1,"mat-spinner",13),s(2,"p"),d(3,"Cargando conexiones..."),l()())}function Jg(i,e){if(i&1){let t=F();s(0,"div",14)(1,"mat-icon"),d(2,"link_off"),l(),s(3,"p"),d(4,"Este elemento no tiene conexiones establecidas."),l(),s(5,"button",15),C("click",function(){_(t);let o=f();return b(o.onAddConnection())}),s(6,"mat-icon"),d(7,"add_link"),l(),d(8," A\xF1adir conexi\xF3n "),l()()}}function eu(i,e){i&1&&(s(0,"mat-header-cell"),d(1,"Origen"),l())}function tu(i,e){if(i&1&&(s(0,"mat-cell")(1,"div",29)(2,"mat-icon",7),d(3),l(),d(4),l()()),i&2){let t=e.$implicit,n=f(3);p(2),u("matTooltip",n.getConnectionElementTypeLabel(t.sourceType||"")),p(),V(" ",n.getConnectionElementIcon(t.sourceType||"")," "),p(),V(" ",t.sourceName||"Desconocido"," ")}}function nu(i,e){i&1&&(s(0,"mat-header-cell"),d(1,"Tipo"),l())}function iu(i,e){if(i&1&&(s(0,"mat-cell"),d(1),l()),i&2){let t=e.$implicit,n=f(3);p(),V(" ",n.getConnectionTypeLabel(t.type)," ")}}function ou(i,e){i&1&&(s(0,"mat-header-cell"),d(1,"Estado"),l())}function ru(i,e){if(i&1&&(s(0,"mat-cell")(1,"span"),d(2),l()()),i&2){let t=e.$implicit;p(),Sn("status-badge "+(t.status==null?null:t.status.toLowerCase())),p(),V(" ",t.status||"Desconocido"," ")}}function au(i,e){i&1&&(s(0,"mat-header-cell"),d(1,"Acciones"),l())}function su(i,e){if(i&1){let t=F();s(0,"mat-cell")(1,"button",30),C("click",function(){let o=_(t).$implicit,r=f(3);return b(r.onEditConnection(o))}),s(2,"mat-icon"),d(3,"edit"),l()(),s(4,"button",31),C("click",function(){let o=_(t).$implicit,r=f(3);return b(r.onViewElement(o.sourceElementId))}),s(5,"mat-icon"),d(6,"visibility"),l()(),s(7,"button",32),C("click",function(){let o=_(t).$implicit,r=f(3);return b(r.onDeleteConnection(o))}),s(8,"mat-icon"),d(9,"link_off"),l()()()}}function lu(i,e){i&1&&D(0,"mat-header-row")}function cu(i,e){i&1&&D(0,"mat-row")}function du(i,e){if(i&1&&(s(0,"mat-expansion-panel",18)(1,"mat-expansion-panel-header")(2,"mat-panel-title")(3,"mat-icon",19),d(4,"arrow_downward"),l(),d(5),l()(),s(6,"mat-table",20),Ie(7,21),y(8,eu,2,0,"mat-header-cell",22)(9,tu,5,3,"mat-cell",23),Ae(),Ie(10,24),y(11,nu,2,0,"mat-header-cell",22)(12,iu,2,1,"mat-cell",23),Ae(),Ie(13,25),y(14,ou,2,0,"mat-header-cell",22)(15,ru,3,3,"mat-cell",23),Ae(),Ie(16,26),y(17,au,2,0,"mat-header-cell",22)(18,su,10,0,"mat-cell",23),Ae(),y(19,lu,1,0,"mat-header-row",27)(20,cu,1,0,"mat-row",28),l()()),i&2){let t=f(2);p(5),V(" Conexiones entrantes (",t.incomingConnections.length,") "),p(),u("dataSource",t.incomingConnections),p(13),u("matHeaderRowDef",t.displayedColumns),p(),u("matRowDefColumns",t.displayedColumns)}}function pu(i,e){i&1&&(s(0,"mat-header-cell"),d(1,"Destino"),l())}function mu(i,e){if(i&1&&(s(0,"mat-cell")(1,"div",29)(2,"mat-icon",7),d(3),l(),d(4),l()()),i&2){let t=e.$implicit,n=f(3);p(2),u("matTooltip",n.getConnectionElementTypeLabel(t.targetType||"")),p(),V(" ",n.getConnectionElementIcon(t.targetType||"")," "),p(),V(" ",t.targetName||"Desconocido"," ")}}function gu(i,e){i&1&&(s(0,"mat-header-cell"),d(1,"Tipo"),l())}function uu(i,e){if(i&1&&(s(0,"mat-cell"),d(1),l()),i&2){let t=e.$implicit,n=f(3);p(),V(" ",n.getConnectionTypeLabel(t.type)," ")}}function hu(i,e){i&1&&(s(0,"mat-header-cell"),d(1,"Estado"),l())}function fu(i,e){if(i&1&&(s(0,"mat-cell")(1,"span"),d(2),l()()),i&2){let t=e.$implicit;p(),Sn("status-badge "+(t.status==null?null:t.status.toLowerCase())),p(),V(" ",t.status||"Desconocido"," ")}}function vu(i,e){i&1&&(s(0,"mat-header-cell"),d(1,"Acciones"),l())}function _u(i,e){if(i&1){let t=F();s(0,"mat-cell")(1,"button",30),C("click",function(){let o=_(t).$implicit,r=f(3);return b(r.onEditConnection(o))}),s(2,"mat-icon"),d(3,"edit"),l()(),s(4,"button",33),C("click",function(){let o=_(t).$implicit,r=f(3);return b(r.onViewElement(o.targetElementId))}),s(5,"mat-icon"),d(6,"visibility"),l()(),s(7,"button",32),C("click",function(){let o=_(t).$implicit,r=f(3);return b(r.onDeleteConnection(o))}),s(8,"mat-icon"),d(9,"link_off"),l()()()}}function bu(i,e){i&1&&D(0,"mat-header-row")}function Cu(i,e){i&1&&D(0,"mat-row")}function yu(i,e){if(i&1&&(s(0,"mat-expansion-panel",18)(1,"mat-expansion-panel-header")(2,"mat-panel-title")(3,"mat-icon",19),d(4,"arrow_upward"),l(),d(5),l()(),s(6,"mat-table",20),Ie(7,21),y(8,pu,2,0,"mat-header-cell",22)(9,mu,5,3,"mat-cell",23),Ae(),Ie(10,24),y(11,gu,2,0,"mat-header-cell",22)(12,uu,2,1,"mat-cell",23),Ae(),Ie(13,25),y(14,hu,2,0,"mat-header-cell",22)(15,fu,3,3,"mat-cell",23),Ae(),Ie(16,26),y(17,vu,2,0,"mat-header-cell",22)(18,_u,10,0,"mat-cell",23),Ae(),y(19,bu,1,0,"mat-header-row",27)(20,Cu,1,0,"mat-row",28),l()()),i&2){let t=f(2);p(5),V(" Conexiones salientes (",t.outgoingConnections.length,") "),p(),u("dataSource",t.outgoingConnections),p(13),u("matHeaderRowDef",t.displayedColumns),p(),u("matRowDefColumns",t.displayedColumns)}}function Eu(i,e){if(i&1&&(s(0,"div",16),y(1,du,21,4,"mat-expansion-panel",17)(2,yu,21,4,"mat-expansion-panel",17),l()),i&2){let t=f();p(),u("ngIf",t.incomingConnections.length),p(),u("ngIf",t.outgoingConnections.length)}}function wu(i,e){if(i&1){let t=F();s(0,"mat-card-actions")(1,"button",15),C("click",function(){_(t);let o=f();return b(o.onAddConnection())}),s(2,"mat-icon"),d(3,"add_link"),l(),d(4," A\xF1adir conexi\xF3n "),l(),s(5,"button",34),C("click",function(){_(t);let o=f();return b(o.refreshConnections())}),s(6,"mat-icon"),d(7,"refresh"),l(),d(8," Actualizar "),l()()}}var Bo=class i{constructor(e,t){this.connectionService=e;this.elementService=t}elementId="";close=new U;editConnection=new U;addConnection=new U;deleteConnection=new U;viewElement=new U;elementData=null;incomingConnections=[];outgoingConnections=[];loading=!1;displayedColumns=["source","type","status","actions"];destroy$=new N;ngOnInit(){this.loadElement(),this.loadConnections()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadElement(){this.elementId&&(this.loading=!0,this.elementService.getElementById(this.elementId).pipe(R(this.destroy$)).subscribe(e=>{this.elementData=e,this.loading=!1},e=>{console.error("Error al cargar el elemento:",e),this.loading=!1}))}loadConnections(){this.elementId&&(this.loading=!0,this.connectionService.getConnectionsByElementId(this.elementId).pipe(R(this.destroy$)).subscribe(e=>{this.processConnections(e),this.loading=!1},e=>{console.error("Error al cargar conexiones:",e),this.loading=!1}))}refreshConnections(){this.loadConnections()}processConnections(e){return ae(this,null,function*(){if(this.incomingConnections=[],this.outgoingConnections=[],!e||!e.length)return;let t=e.map(n=>ae(this,null,function*(){let o=O({},n);if(n.sourceElementId===this.elementId)try{let r=yield this.elementService.getElementById(n.targetElementId).toPromise();r&&(o.targetName=r.name,o.targetType=r.type),this.outgoingConnections.push(o)}catch(r){console.error(`Error al obtener elemento destino ${n.targetElementId}:`,r),o.targetName="Elemento no encontrado",o.targetType="UNKNOWN",this.outgoingConnections.push(o)}else try{let r=yield this.elementService.getElementById(n.sourceElementId).toPromise();r&&(o.sourceName=r.name,o.sourceType=r.type),this.incomingConnections.push(o)}catch(r){console.error(`Error al obtener elemento origen ${n.sourceElementId}:`,r),o.sourceName="Elemento no encontrado",o.sourceType="UNKNOWN",this.incomingConnections.push(o)}}));try{yield Promise.all(t),this.incomingConnections.sort((n,o)=>(n.sourceName||"").localeCompare(o.sourceName||"")),this.outgoingConnections.sort((n,o)=>(n.targetName||"").localeCompare(o.targetName||""))}catch(n){console.error("Error al procesar conexiones:",n)}})}getElementTypeLabel(){if(!this.elementData)return"Elemento";switch(this.elementData.type){case"DROP_CABLE":return"Cable de Acometida";case"OLT":return"Terminal de L\xEDnea \xD3ptica";case"ONT":return"Terminal de Red \xD3ptica";case"DISTRIBUTION_CABLE":return"Cable de Distribuci\xF3n";case"FEEDER_CABLE":return"Cable de Alimentaci\xF3n";case"FDP":return"Punto de Distribuci\xF3n de Fibra";case"SPLITTER":return"Divisor \xD3ptico";default:return this.elementData.type||"Elemento"}}getElementDescription(){return this.elementData?this.elementData.description||`Elemento de red de tipo ${this.getElementTypeLabel()}`:""}getElementIcon(){if(!this.elementData)return"device_unknown";switch(this.elementData.type){case"DROP_CABLE":return"cable";case"OLT":return"router";case"ONT":return"devices";case"DISTRIBUTION_CABLE":case"FEEDER_CABLE":return"lan";case"FDP":return"hub";case"SPLITTER":return"call_split";default:return"device_hub"}}getConnectionElementTypeLabel(e){switch(e){case"DROP_CABLE":return"Cable de Acometida";case"OLT":return"Terminal de L\xEDnea \xD3ptica";case"ONT":return"Terminal de Red \xD3ptica";case"DISTRIBUTION_CABLE":return"Cable de Distribuci\xF3n";case"FEEDER_CABLE":return"Cable de Alimentaci\xF3n";case"FDP":return"Punto de Distribuci\xF3n de Fibra";case"SPLITTER":return"Divisor \xD3ptico";default:return e||"Elemento"}}getConnectionElementIcon(e){switch(e){case"DROP_CABLE":return"cable";case"OLT":return"router";case"ONT":return"devices";case"DISTRIBUTION_CABLE":case"FEEDER_CABLE":return"lan";case"FDP":return"hub";case"SPLITTER":return"call_split";default:return"device_hub"}}getConnectionTypeLabel(e){switch(e){case"FIBER":return"Fibra \xD3ptica";case"COPPER":return"Cobre";case"WIRELESS":return"Inal\xE1mbrica";case"LOGICAL":return"L\xF3gica";default:return e||"Desconocido"}}onClose(){this.close.emit()}onAddConnection(){this.addConnection.emit(this.elementId)}onEditConnection(e){this.editConnection.emit(e)}onDeleteConnection(e){this.deleteConnection.emit(e)}onViewElement(e){this.viewElement.emit(e)}static \u0275fac=function(t){return new(t||i)(I(ho),I(kt))};static \u0275cmp=q({type:i,selectors:[["app-element-connections-view"]],inputs:{elementId:"elementId"},outputs:{close:"close",editConnection:"editConnection",addConnection:"addConnection",deleteConnection:"deleteConnection",viewElement:"viewElement"},decls:25,vars:12,consts:[[1,"connections-container"],[1,"connections-header"],[1,"title"],[1,"controls"],["mat-icon-button","","matTooltip","Cerrar",3,"click"],[1,"connections-content"],["mat-card-avatar","",1,"element-avatar"],[3,"matTooltip"],["class","loading-container",4,"ngIf"],["class","no-connections",4,"ngIf"],["class","connections-list",4,"ngIf"],[4,"ngIf"],[1,"loading-container"],["diameter","40"],[1,"no-connections"],["mat-flat-button","","color","primary",3,"click"],[1,"connections-list"],["expanded","",4,"ngIf"],["expanded",""],[1,"panel-icon"],[1,"connections-table",3,"dataSource"],["matColumnDef","source"],[4,"matHeaderCellDef"],[4,"matCellDef"],["matColumnDef","type"],["matColumnDef","status"],["matColumnDef","actions"],[4,"matHeaderRowDef"],[4,"matRowDef","matRowDefColumns"],[1,"element-chip"],["mat-icon-button","","matTooltip","Editar conexi\xF3n",3,"click"],["mat-icon-button","","matTooltip","Ver elemento origen",3,"click"],["mat-icon-button","","color","warn","matTooltip","Eliminar conexi\xF3n",3,"click"],["mat-icon-button","","matTooltip","Ver elemento destino",3,"click"],["mat-button","",3,"click"]],template:function(t,n){t&1&&(s(0,"div",0)(1,"div",1)(2,"div",2),d(3),l(),s(4,"div",3)(5,"button",4),C("click",function(){return n.onClose()}),s(6,"mat-icon"),d(7,"close"),l()()()(),s(8,"div",5)(9,"mat-card")(10,"mat-card-header")(11,"div",6)(12,"mat-icon",7),d(13),l()(),s(14,"mat-card-title"),d(15),l(),s(16,"mat-card-subtitle")(17,"span"),d(18),l(),d(19),l()(),s(20,"mat-card-content"),y(21,Xg,4,0,"div",8)(22,Jg,9,0,"div",9)(23,Eu,3,2,"div",10),l(),y(24,wu,9,0,"mat-card-actions",11),l()()()),t&2&&(p(3),V("Conexiones de ",n.getElementTypeLabel(),""),p(9),u("matTooltip",n.getElementDescription()),p(),E(n.getElementIcon()),p(2),E((n.elementData==null?null:n.elementData.name)||"Elemento sin nombre"),p(2),Sn("status-badge "+(n.elementData==null||n.elementData.status==null?null:n.elementData.status.toLowerCase())),p(),E((n.elementData==null?null:n.elementData.status)||"Desconocido"),p(),V(" ID: ",n.elementData==null?null:n.elementData.id," "),p(2),u("ngIf",n.loading),p(),u("ngIf",!n.loading&&!n.incomingConnections.length&&!n.outgoingConnections.length),p(),u("ngIf",!n.loading&&(n.incomingConnections.length||n.outgoingConnections.length)),p(),u("ngIf",!n.loading&&(n.incomingConnections.length||n.outgoingConnections.length)))},dependencies:[X,ie,po,lo,oc,ac,co,rc,ic,nc,he,Re,Ne,le,de,Ue,jn,to,no,io,Kt,Zt,Ee,Me,mt,Wt,Tc,vc,bc,wc,Cc,_c,xc,yc,Ec,Sc,Mc],styles:[".connections-container[_ngcontent-%COMP%]{width:580px;box-shadow:0 2px 8px #00000026;border-radius:4px;overflow:hidden;background-color:#fff;max-height:calc(100vh - 100px);display:flex;flex-direction:column}.connections-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background-color:#f5f5f5;border-bottom:1px solid #ddd;z-index:2}.title[_ngcontent-%COMP%]{font-weight:700}.connections-content[_ngcontent-%COMP%]{padding:0;overflow-y:auto;flex:1}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 0}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:16px;color:#666}.no-connections[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 0;color:#666}.no-connections[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;margin-bottom:16px;color:#aaa}.no-connections[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:24px}.connections-list[_ngcontent-%COMP%]{margin-top:16px}.connections-table[_ngcontent-%COMP%]{width:100%}.element-avatar[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;background-color:#f0f0f0;border-radius:50%}.element-chip[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}mat-expansion-panel[_ngcontent-%COMP%]{margin-bottom:12px}.panel-icon[_ngcontent-%COMP%]{margin-right:8px;color:#666}mat-panel-title[_ngcontent-%COMP%]{display:flex;align-items:center}.status-badge[_ngcontent-%COMP%]{display:inline-block;padding:2px 6px;border-radius:4px;font-size:12px}.status-badge.active[_ngcontent-%COMP%]{background-color:#e6f4ea;color:#137333}.status-badge.inactive[_ngcontent-%COMP%]{background-color:#f8f9fa;color:#5f6368}.status-badge.faulty[_ngcontent-%COMP%]{background-color:#fce8e6;color:#c5221f}.status-badge.inservice[_ngcontent-%COMP%]{background-color:#e8f0fe;color:#1967d2}.status-badge.planned[_ngcontent-%COMP%]{background-color:#fff0b3;color:#b06000}mat-card-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:8px 16px 16px}"]})};var xu=["createMenu"],Su=()=>["/network-design/map"],Mu=()=>["/network-design/elements"],Tu=()=>["/network-design/connections"],Pu=()=>["/network-design/monitoring"],Ou=i=>({"map-hidden":i});function ku(i,e){if(i&1){let t=F();Ie(0),s(1,"button",16),C("click",function(){let o=_(t).$implicit,r=f();return b(r.createNewElement(o.id))}),s(2,"mat-icon"),d(3),l(),s(4,"span"),d(5),l()(),Ae()}if(i&2){let t=e.$implicit;p(3),E(t.id==="fdp"?"dns":t.id==="olt"?"router":t.id==="ont"?"device_hub":t.id==="edfa"?"wifi_tethering":t.id==="splitter"?"call_split":t.id==="manga"?"view_comfy":t.id==="fiber_connection"?"timeline":"category"),p(2),E(t.name)}}function Du(i,e){if(i&1){let t=F();s(0,"app-element-quick-view",17),C("viewConnections",function(o){_(t);let r=f();return b(r.openConnectionsView(o))}),l()}}function Iu(i,e){if(i&1){let t=F();s(0,"app-element-connections-view",18),C("close",function(){_(t);let o=f();return b(o.closeConnectionsView())}),l()}if(i&2){let t=f();u("elementId",t.connectionsElementId)}}var Vo=class i{constructor(e,t,n,o,r,a,c,m,g){this.router=e;this.route=t;this.networkStateService=n;this.logger=o;this.dialog=r;this.snackBar=a;this.mapStateManager=c;this.cdr=m;this.ngZone=g}routerOutlet;createMenu;elementTypes=[{id:"fdp",name:"Punto de Distribuci\xF3n (FDP)"},{id:"olt",name:"Terminal de L\xEDnea \xD3ptica (OLT)"},{id:"ont",name:"Terminal de Red \xD3ptica (ONT)"},{id:"edfa",name:"Amplificador \xD3ptico (EDFA)"},{id:"splitter",name:"Divisor \xD3ptico (Splitter)"},{id:"manga",name:"Caja de Empalme (Manga)"},{id:"fiber_connection",name:"Conexi\xF3n de Fibra"}];animationState="map";isLoading=!1;mapVisible=!0;selectedElement=null;showElementsPanel=!0;showConnectionsView=!1;connectionsElementId=null;destroy$=new N;ngOnInit(){this.setupRouteListener(),this.subscribeToStateChanges(),this.setupConnectionEditorSubscription()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setupRouteListener(){this.router.events.pipe(_e(e=>e instanceof On),R(this.destroy$)).subscribe(()=>{let e=this.route.firstChild;if(e){let t=e.snapshot.data.animation||"map";this.animationState!==t&&(t==="error"?this.ngZone.runOutsideAngular(()=>{setTimeout(()=>{this.animationState=t,this.logger.debug(`Estado de animaci\xF3n actualizado: ${this.animationState}`),this.cdr.detectChanges()})}):(this.animationState=t,this.logger.debug(`Estado de animaci\xF3n actualizado: ${this.animationState}`)))}})}subscribeToStateChanges(){this.networkStateService.getEditingElement().pipe(R(this.destroy$)).subscribe(e=>{this.selectedElement=e,e&&this.logger.debug(`Elemento seleccionado: ${e.name} (${e.id})`)}),this.networkStateService.getMapVisibility().pipe(R(this.destroy$)).subscribe(e=>{this.mapVisible=e,this.logger.debug(`Visibilidad del mapa: ${e?"visible":"oculto"}`)}),this.networkStateService.getShowElementsPanel().pipe(R(this.destroy$)).subscribe(e=>{this.showElementsPanel=e}),this.networkStateService.setShowElementsPanel(!0)}setupConnectionEditorSubscription(){this.mapStateManager.connectionToEdit$.pipe(R(this.destroy$)).subscribe(e=>{this.logger.debug(`Recibido evento connectionToEdit$: ${e?e.id:"null"}`),e&&(this.logger.debug(`Abriendo di\xE1logo para editar conexi\xF3n: ${e.id}`),this.openConnectionPropertiesDialog(e),this.mapStateManager.clearConnectionToEdit())})}openConnectionPropertiesDialog(e){this.logger.debug(`Intentando abrir di\xE1logo de conexi\xF3n para: ${e.id}`,e);try{let t={connection:e||null,mode:"edit"};this.logger.debug("Datos para el di\xE1logo:",t);let n=this.dialog.open(fc,{width:"600px",maxWidth:"95vw",maxHeight:"90vh",panelClass:"connection-editor-dialog",disableClose:!1,autoFocus:!0,data:t});this.logger.debug("Di\xE1logo de conexi\xF3n abierto correctamente"),n.afterClosed().pipe(R(this.destroy$)).subscribe(o=>{this.logger.debug("Di\xE1logo de conexi\xF3n cerrado",o),o&&(this.logger.debug("Conexi\xF3n actualizada:",o),this.snackBar.open("Propiedades de conexi\xF3n actualizadas","OK",{duration:3e3,panelClass:"success-snackbar"}))})}catch(t){this.logger.error("Error al abrir el di\xE1logo de conexi\xF3n:",t)}}prepareRoute(e){if(!e||!e.activatedRouteData)return"map";let t=e.activatedRouteData.animation||"map";return t==="error"&&this.animationState!=="error"&&this.ngZone.runOutsideAngular(()=>{setTimeout(()=>{this.animationState=t,this.cdr.detectChanges()})}),t}createNewElement(e){this.router.navigate(["/network-design/element",e,"new"]),this.logger.debug(`Navegando a creaci\xF3n de nuevo elemento: ${e}`)}openConnectionsView(e){this.connectionsElementId=e,this.showConnectionsView=!0}closeConnectionsView(){this.showConnectionsView=!1,this.connectionsElementId=null}static \u0275fac=function(t){return new(t||i)(I(Se),I(Ki),I(Te),I(G),I(Ye),I(He),I(gt),I($e),I(Qe))};static \u0275cmp=q({type:i,selectors:[["app-network-design-layout"]],viewQuery:function(t,n){if(t&1&&(lt(Pt,5),lt(xu,5)),t&2){let o;ct(o=dt())&&(n.routerOutlet=o.first),ct(o=dt())&&(n.createMenu=o.first)}},decls:44,vars:16,consts:[["elementMenu","matMenu"],["outlet","outlet"],[1,"network-design-layout"],[1,"design-header"],[1,"design-nav"],["mat-button","","routerLinkActive","active",3,"routerLink"],[1,"menu-container"],["mat-button","",1,"create-button",3,"matMenuTriggerFor"],[1,"element-type-menu"],[4,"ngFor","ngForOf"],[1,"design-content"],[1,"network-design-content"],[1,"network-design-container",3,"ngClass"],[1,"router-container"],["class","element-details-panel",3,"viewConnections",4,"ngIf"],["class","connections-view-overlay",3,"elementId","close",4,"ngIf"],["mat-menu-item","",3,"click"],[1,"element-details-panel",3,"viewConnections"],[1,"connections-view-overlay",3,"close","elementId"]],template:function(t,n){if(t&1&&(s(0,"div",2)(1,"header",3)(2,"h1"),d(3,"Dise\xF1o de Red"),l(),s(4,"nav",4)(5,"a",5)(6,"mat-icon"),d(7,"map"),l(),s(8,"span"),d(9,"Mapa de Red"),l()(),s(10,"a",5)(11,"mat-icon"),d(12,"category"),l(),s(13,"span"),d(14,"Elementos"),l()(),s(15,"a",5)(16,"mat-icon"),d(17,"device_hub"),l(),s(18,"span"),d(19,"Conexiones"),l()(),s(20,"a",5)(21,"mat-icon"),d(22,"monitoring"),l(),s(23,"span"),d(24,"Monitoreo"),l()(),s(25,"div",6)(26,"button",7)(27,"mat-icon"),d(28,"add_circle"),l(),s(29,"span"),d(30,"Crear Nuevo Elemento"),l(),s(31,"mat-icon"),d(32,"arrow_drop_down"),l()(),s(33,"mat-menu",8,0),y(35,ku,6,2,"ng-container",9),l()()()(),s(36,"main",10)(37,"div",11)(38,"div",12)(39,"div",13),D(40,"router-outlet",null,1),l()(),y(42,Du,1,0,"app-element-quick-view",14)(43,Iu,1,1,"app-element-connections-view",15),l()()()),t&2){let o=vt(34),r=vt(41);p(5),u("routerLink",Lt(10,Su)),p(5),u("routerLink",Lt(11,Mu)),p(5),u("routerLink",Lt(12,Tu)),p(5),u("routerLink",Lt(13,Pu)),p(6),u("matMenuTriggerFor",o),p(9),u("ngForOf",n.elementTypes),p(3),u("ngClass",_t(14,Ou,!n.mapVisible)),p(),u("@routeAnimations",n.prepareRoute(r)),p(3),u("ngIf",n.selectedElement&&n.showElementsPanel),p(),u("ngIf",n.showConnectionsView&&n.connectionsElementId)}},dependencies:[X,pt,je,ie,Ut,Pt,kn,qi,he,kl,Re,le,de,Ee,Rn,An,In,Nn,Ue,zo,Bo],styles:['@charset "UTF-8";[_ngcontent-%COMP%]:root{--primary-color: #3F51B5;--primary-rgb: 63, 81, 181;--primary-color-hover: rgb(52.4655737705, 67.4557377049, 150.7344262295);--accent-color: #FF4081;--warn-color: #F44336;--background-color: #F5F5F5;--surface-color: #ffffff;--surface-lighter: #f9f9f9;--surface-darker: #eeeeee;--text-color: #212121;--text-secondary-color: hsl(0, 0%, -12.0588235294%);--text-hint-color: hsl(0, 0%, -32.0588235294%);--text-disabled-color: hsl(0, 0%, -52.0588235294%);--primary-contrast-color: white;--accent-contrast-color: white;--warn-contrast-color: white;--olt-color: #4CAF50;--ont-color: #2196F3;--odf-color: #FFC107;--edfa-color: #9C27B0;--splitter-color: #FF5722;--manga-color: #607D8B;--terminal-box-color: #FF9800;--slack-fiber-color: #80DEEA;--spacing-unit: 4px;--spacing-xxs: .125rem;--spacing-xs: .25rem;--spacing-sm: .5rem;--spacing-md: .75rem;--spacing-lg: 1rem;--spacing-xl: 1.5rem;--spacing-xxl: 2rem;--shadow-xs: 0 1px 2px rgba(0,0,0,.05);--shadow-sm: 0 1px 3px rgba(0, 0, 0, .1);--shadow-md: 0 2px 4px rgba(0, 0, 0, .1);--shadow-lg: 0 4px 6px rgba(0, 0, 0, .1);--border-radius-sm: 2px;--border-radius-md: 4px;--border-radius-lg: 8px;--border-radius-round: 50%;--border-color: #e0e0e0;--border-width-normal: 1px;--border-width-strong: 4px;--border-radius-pill: 20px;--border-color-light: rgb(249.5, 249.5, 249.5);--border-color-dark: rgb(198.5, 198.5, 198.5);--color-success: #4caf50;--color-warning: #ff8f00;--color-danger: #c62828;--color-info: #2196F3;--color-neutral: #9e9e9e;--color-success-bg: #e8f5e9;--color-warning-bg: #fff8e1;--color-danger-bg: #ffebee;--color-info-bg: rgb(226.5384615385, 241.5384615385, 253.4615384615);--color-maintenance-bg: #e3f2fd;--status-inactive-fg: #757575;--status-inactive-bg: #f5f5f5;--color-success-contrast: white;--color-warning-contrast: white;--color-danger-contrast: white;--color-info-contrast: #212121;--color-maintenance-contrast: white;--font-family: "Roboto, Segoe UI, sans-serif";--font-size-xxs: .625rem;--font-size-xs: .75rem;--font-size-sm: .875rem;--font-size-md: 1rem;--font-size-lg: 1.125rem;--font-size-xl: 1.25rem;--font-size-xxl: 1.5rem;--font-size-display: 2.5rem;--transition-fast: .15s ease-in-out;--transition-normal: .3s ease-in-out;--transition-slow: .5s ease-in-out;--status-active: #4caf50;--status-inactive: #757575;--status-maintenance: #1565c0;--status-planning: #2196F3;--status-unknown: var(--color-neutral);--status-fault: #c62828;--surface-overlay-light: rgba(255, 255, 255, .85);--surface-overlay-light-strong: rgba(255, 255, 255, .95);--border-color-semitransparent: rgba(0, 0, 0, .1);--primary-bg-subtle: rgba(63, 81, 181, .15);--surface-action-hover: rgb(242.8571428571, 242.8571428571, 242.8571428571);--surface-button: var(--surface-color);--surface-button-hover: var(--surface-action-hover);--text-color-button: var(--text-color);--scrollbar-track-color: #f1f1f1;--scrollbar-thumb-color: #c1c1c1;--scrollbar-thumb-hover-color: #a8a8a8;--z-index-map-base: 1;--z-index-map-elements: 5;--z-index-map-widgets-overlay: 50;--z-index-map-overlay: 100;--z-index-network-design-panels: 900;--z-index-debug-info: 999;--z-index-floating-panel-base: 1000;--z-index-performance-widget: 1000;--z-index-elements-panel: 1001;--z-index-layer-control: 1001;--z-index-sidebar: 1005;--z-index-map-legend: 1005;--z-index-sidebar-mobile: 1010;--z-index-loading-overlay: 1050;--z-index-dialog: 1075;--z-index-toolbar: 1100;--z-index-tooltip: 1150;--z-index-map-controls: 1201;--toolbar-height: 46px;--toolbar-button-height: 30px;--toolbar-button-height-mobile: 32px;--action-button-height: 40px;--menu-item-height: 42px;--icon-size-sm: 18px;--icon-size-md: 20px;--tooltip-bg-color: rgba(33, 33, 33, .95);--primary-ripple-color: rgba(var(--primary-rgb), .1)}[_ngcontent-%COMP%]:root.dark-theme, body.dark-theme[_ngcontent-%COMP%]{--background-color: #121212;--surface-color: #1e1e1e;--surface-lighter: rgb(42.75, 42.75, 42.75);--surface-darker: #121212;--text-color: #e0e0e0;--text-secondary-color: rgb(185.75, 185.75, 185.75);--text-hint-color: rgb(147.5, 147.5, 147.5);--text-disabled-color: rgb(109.25, 109.25, 109.25);--border-color: #444444;--border-color-light: rgb(93.5, 93.5, 93.5);--border-color-dark: rgb(42.5, 42.5, 42.5);--color-success-bg: rgb(51.8181818182, 119.1818181818, 57);--color-warning-bg: rgb(174, 133.4, 0);--color-danger-bg: rgb(184, 0, 27.6);--color-info-bg: rgb(8.9230769231, 95.9230769231, 165.0769230769);--color-maintenance-bg: rgb(11.6, 98.6, 162.4);--shadow-xs: 0 1px 2px rgba(0,0,0,.3);--shadow-sm: 0 1px 3px rgba(0,0,0,.4);--shadow-md: 0 2px 4px rgba(0,0,0,.5);--shadow-lg: 0 4px 6px rgba(0,0,0,.5);--surface-overlay-light: rgba(40, 40, 40, .85);--surface-overlay-light-strong: rgba(30, 30, 30, .95);--border-color-semitransparent: rgba(255, 255, 255, .1);--status-inactive-fg: hsl(0, 0%, 100.8823529412%);--status-inactive-bg: #383838;--primary-bg-subtle: rgba(63, 81, 181, .25);--surface-action-hover: rgb(55.5, 55.5, 55.5);--surface-button: var(--surface-color);--surface-button-hover: var(--surface-action-hover);--text-color-button: var(--text-color);--scrollbar-track-color: #333333;--scrollbar-thumb-color: #666666;--scrollbar-thumb-hover-color: #888888}.standard-panel-ui[_ngcontent-%COMP%]{background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-lg);overflow:hidden;display:flex;flex-direction:column}.standard-panel-ui[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-md);background-color:var(--surface-lighter);border-bottom:1px solid var(--border-color)}.standard-panel-ui[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:var(--font-size-md);font-weight:500;color:var(--text-color)}.standard-panel-ui[_ngcontent-%COMP%]   .panel-content[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-content[_ngcontent-%COMP%]{padding:var(--spacing-md);flex-grow:1;overflow-y:auto;color:var(--text-color)}.standard-panel-ui[_ngcontent-%COMP%]   .panel-actions[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:var(--spacing-sm);padding:var(--spacing-sm) var(--spacing-md);border-top:1px solid var(--border-color)}.standard-panel-ui[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]{display:flex;margin-bottom:var(--spacing-sm)}.standard-panel-ui[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]   .info-label[_ngcontent-%COMP%]{width:100px;font-weight:500;color:var(--text-secondary-color)}.standard-panel-ui[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]   .info-value[_ngcontent-%COMP%]{flex:1;color:var(--text-color)}.simple-panel-ui[_ngcontent-%COMP%]{background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-lg);padding:var(--spacing-md);color:var(--text-color)}.side-panel[_ngcontent-%COMP%]{background-color:var(--surface-color);border-radius:var(--border-radius-sm, 4px);box-shadow:var(--shadow-sm, 0 2px 10px rgba(0, 0, 0, .08));height:100%;width:var(--side-panel-width, 320px);display:flex;flex-direction:column;overflow:hidden}@media (max-width: 768px){.side-panel[_ngcontent-%COMP%]{width:var(--side-panel-width-tablet, 280px)}}@media (max-width: 600px){.side-panel[_ngcontent-%COMP%]{width:var(--side-panel-width-mobile, 100%);max-width:100vw}}.side-panel[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%]{height:var(--panel-header-height, 44px);min-height:var(--panel-header-height, 44px);display:flex;align-items:center;justify-content:space-between;padding:0 var(--spacing-sm);border-bottom:1px solid var(--border-color, rgba(0, 0, 0, .1))}.side-panel[_ngcontent-%COMP%]   .panel-content[_ngcontent-%COMP%]{flex:1;overflow:auto}.map-base-container[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;overflow:hidden;background-color:var(--background-color);transition:background-color var(--transition-normal)}.network-design[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}.network-design__toolbar[_ngcontent-%COMP%]{padding:0 var(--spacing-md);background-color:var(--primary-color);color:var(--primary-contrast-color);box-shadow:var(--shadow-md)}.network-design__header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-md);background-color:var(--primary-color);color:var(--primary-contrast-color);box-shadow:var(--shadow-md)}.network-design__header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:var(--font-size-xl);font-weight:500}.network-design__main[_ngcontent-%COMP%]{flex:1;display:flex;overflow:hidden;position:relative;padding:var(--spacing-md);background-color:var(--surface-color)}@media (max-width: 768px){.network-design__main[_ngcontent-%COMP%]{margin-left:0;padding:var(--spacing-sm)}}.network-design__main[_ngcontent-%COMP%]   .network-design__map[_ngcontent-%COMP%]{flex:1;position:relative;border-radius:var(--border-radius-md);overflow:hidden;box-shadow:var(--shadow-md);background-color:var(--surface-darker)}.network-design__main[_ngcontent-%COMP%]   .network-design__sidebar[_ngcontent-%COMP%]{width:300px;padding:var(--spacing-md);background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-md);margin-left:var(--spacing-md);overflow-y:auto;border-right:1px solid var(--border-color)}@media (max-width: 768px){.network-design__main[_ngcontent-%COMP%]   .network-design__sidebar[_ngcontent-%COMP%]{width:100%;position:fixed;top:0;left:0;height:100%;z-index:1000;transform:translate(-100%);transition:transform var(--transition-normal);margin-left:0;border-right:none}.network-design__main[_ngcontent-%COMP%]   .network-design__sidebar--open[_ngcontent-%COMP%]{transform:translate(0)}}.network-design__footer[_ngcontent-%COMP%]{padding:var(--spacing-md);background-color:var(--surface-lighter);border-top:1px solid var(--border-color);font-size:var(--font-size-sm);color:var(--text-color)}.network-design__element[_ngcontent-%COMP%]{padding:var(--spacing-md);margin-bottom:var(--spacing-md);background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-sm);transition:box-shadow var(--transition-fast)}.network-design__element[_ngcontent-%COMP%]:hover{box-shadow:var(--shadow-md)}.network-design__element--selected[_ngcontent-%COMP%]{border-left:4px solid var(--primary-color)}.status-badge-base[_ngcontent-%COMP%], .status-maintenance[_ngcontent-%COMP%], .status-warning[_ngcontent-%COMP%], .status-fault[_ngcontent-%COMP%], .status-inactive[_ngcontent-%COMP%], .status-active[_ngcontent-%COMP%]{display:inline-block;padding:var(--spacing-xs) var(--spacing-sm);border-radius:var(--border-radius-sm);font-size:var(--font-size-sm);font-weight:500}.status-active[_ngcontent-%COMP%]{background-color:var(--color-success-bg);color:var(--color-success-contrast)}.status-inactive[_ngcontent-%COMP%]{background-color:var(--status-inactive-bg);color:var(--status-inactive-fg)}.status-fault[_ngcontent-%COMP%]{background-color:var(--color-danger-bg);color:var(--color-danger-contrast)}.status-warning[_ngcontent-%COMP%]{background-color:var(--color-warning-bg);color:var(--color-warning-contrast)}.status-maintenance[_ngcontent-%COMP%]{background-color:var(--color-maintenance-bg);color:var(--color-maintenance-contrast)}.network-utils__status-badge[_ngcontent-%COMP%]{display:inline-block;padding:var(--spacing-xs) var(--spacing-sm);border-radius:var(--border-radius-sm);font-size:var(--font-size-xs);font-weight:500;text-transform:uppercase}.network-utils__status-badge--active[_ngcontent-%COMP%]{background-color:var(--color-success-bg);color:var(--color-success-contrast)}.network-utils__status-badge--inactive[_ngcontent-%COMP%]{background-color:var(--status-inactive-bg);color:var(--status-inactive-fg)}.network-utils__status-badge--maintenance[_ngcontent-%COMP%]{background-color:var(--color-maintenance-bg);color:var(--color-maintenance-contrast)}.network-utils__loading[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:var(--spacing-lg);color:var(--text-color)}.network-utils__error[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-md);background-color:#ffebee;color:var(--color-danger);border-radius:var(--border-radius-md)}.network-design-layout[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;overflow:hidden;position:relative;background-color:var(--background-color);color:var(--text-color)}.network-design-layout[_ngcontent-%COMP%]   .design-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:0 var(--spacing-md, 16px);height:64px;background-color:var(--surface-color, white);box-shadow:var(--shadow-sm, 0 2px 4px rgba(0, 0, 0, .1));z-index:10}.network-design-layout[_ngcontent-%COMP%]   .design-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:var(--font-size-xl, 20px);font-weight:500;color:var(--text-color-strong, rgba(0, 0, 0, .87))}.network-design-layout[_ngcontent-%COMP%]   .design-nav[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-sm, 8px)}.network-design-layout[_ngcontent-%COMP%]   .design-nav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{height:36px;min-width:80px}.network-design-layout[_ngcontent-%COMP%]   .design-nav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:var(--spacing-sm, 8px)}.network-design-layout[_ngcontent-%COMP%]   .design-nav[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]{background-color:rgba(var(--primary-color-rgb, 63, 81, 181),.1);color:var(--primary-color)}.network-design-layout[_ngcontent-%COMP%]   .design-nav[_ngcontent-%COMP%]   .menu-container[_ngcontent-%COMP%]{position:relative;display:inline-block}.network-design-layout[_ngcontent-%COMP%]   .design-nav[_ngcontent-%COMP%]   .create-button[_ngcontent-%COMP%]{margin-left:var(--spacing-sm, 8px);background-color:rgba(var(--primary-color-rgb, 63, 81, 181),.05)}.network-design-layout[_ngcontent-%COMP%]   .design-nav[_ngcontent-%COMP%]   .create-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]:first-child{margin-right:var(--spacing-sm, 8px)}.network-design-layout[_ngcontent-%COMP%]   .design-nav[_ngcontent-%COMP%]   .create-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]:last-child{margin-left:var(--spacing-xs, 4px);font-size:var(--font-size-xl, 18px)}.network-design-layout[_ngcontent-%COMP%]   .design-content[_ngcontent-%COMP%]{flex:1;min-height:0;display:flex;overflow:hidden;width:100%}.network-design-layout[_ngcontent-%COMP%]   .design-content[_ngcontent-%COMP%]   .network-design-content[_ngcontent-%COMP%]{position:relative;flex:1;width:100%;height:100%;display:flex}.network-design-layout[_ngcontent-%COMP%]   .design-content[_ngcontent-%COMP%]   .network-design-content[_ngcontent-%COMP%]   .network-design-container[_ngcontent-%COMP%]{flex:1;position:relative;overflow:hidden;transition:width .3s ease;width:100%;height:100%}.network-design-layout[_ngcontent-%COMP%]   .design-content[_ngcontent-%COMP%]   .network-design-content[_ngcontent-%COMP%]   .network-design-container.map-hidden[_ngcontent-%COMP%]{display:none}.network-design-layout[_ngcontent-%COMP%]   .design-content[_ngcontent-%COMP%]   .network-design-content[_ngcontent-%COMP%]   .network-design-container[_ngcontent-%COMP%]   .router-container[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;overflow:hidden}.network-design-layout[_ngcontent-%COMP%]   .design-content[_ngcontent-%COMP%]   .network-design-content[_ngcontent-%COMP%]   .element-details-panel[_ngcontent-%COMP%]{width:380px;height:100%;box-shadow:var(--shadow-left-md, -2px 0 8px rgba(0, 0, 0, .1));z-index:5;position:absolute;right:0;top:0;background-color:rgba(var(--surface-color-rgb, 255, 255, 255),.95)}  .element-type-menu{margin-top:4px}  .element-type-menu .mat-mdc-menu-content{padding:8px 0}  .element-type-menu .mat-mdc-menu-item{height:48px;line-height:48px}  .element-type-menu .mat-mdc-menu-item mat-icon{margin-right:12px}@media (max-width: 768px){.design-nav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:none}.design-nav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:0}.design-nav[_ngcontent-%COMP%]   .create-button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:none}.design-content[_ngcontent-%COMP%]   .network-design-content[_ngcontent-%COMP%]{flex-direction:column}.design-content[_ngcontent-%COMP%]   .network-design-content[_ngcontent-%COMP%]   .network-design-container.map-hidden[_ngcontent-%COMP%]{margin-right:0;margin-bottom:var(--element-details-panel-height-mobile, 300px)}.design-content[_ngcontent-%COMP%]   .network-design-content[_ngcontent-%COMP%]   .element-details-panel[_ngcontent-%COMP%]{width:100%;height:var(--element-details-panel-height-mobile, 300px);min-height:var(--element-details-panel-height-mobile, 300px);border-left:none;border-top:1px solid var(--border-color)}}@media (max-width: 600px){.element-details-panel[_ngcontent-%COMP%]{width:100%;position:absolute;top:0;right:0;z-index:var(--z-index-details-panel, 130)}}'],data:{animation:[Ft("routeAnimations",[Ct("map <=> editor",[pe({position:"relative"}),yt(":enter, :leave",[pe({position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",flexDirection:"column"})],{optional:!0}),yt(":enter",[pe({opacity:0})],{optional:!0}),ma([yt(":leave",[ot("200ms ease-out",pe({opacity:0}))],{optional:!0}),yt(":enter",[ot("200ms ease-in",pe({opacity:1}))],{optional:!0})])]),Ct("* <=> *",[pe({position:"relative"}),yt(":enter, :leave",[pe({position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",flexDirection:"column"})],{optional:!0}),yt(":enter",[pe({opacity:0})],{optional:!0}),ma([yt(":leave",[ot("200ms ease-out",pe({opacity:0}))],{optional:!0}),yt(":enter",[ot("300ms ease-in",pe({opacity:1}))],{optional:!0})])])])]}})};var $o=class i{goBack(){window.history.back()}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=q({type:i,selectors:[["app-error"]],decls:9,vars:0,consts:[[1,"error-container"],[1,"error-icon"],["mat-raised-button","","color","primary",3,"click"]],template:function(t,n){t&1&&(s(0,"div",0)(1,"mat-icon",1),d(2,"error_outline"),l(),s(3,"h1"),d(4,"Error"),l(),s(5,"p"),d(6,"Ha ocurrido un error inesperado."),l(),s(7,"button",2),C("click",function(){return n.goBack()}),d(8," Volver "),l()())},dependencies:[X,he,Re,le,de],styles:[".error-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;text-align:center}.error-icon[_ngcontent-%COMP%]{font-size:64px;height:64px;width:64px;color:#f44336;margin-bottom:16px}h1[_ngcontent-%COMP%]{margin-bottom:16px}p[_ngcontent-%COMP%]{margin-bottom:24px}"]})};var Jt=class i{constructor(e,t){this.dialog=e;this.networkStateService=t}canDeactivate(e){return e.elementForm?.dirty?this.dialog.open(uo,{width:"400px",data:{title:"Cambios sin guardar",message:"\xBFEst\xE1s seguro de que deseas salir? Los cambios no guardados se perder\xE1n.",confirmText:"Salir sin guardar",cancelText:"Continuar editando",confirmButtonColor:"warn"}}).afterClosed().pipe(ke(t=>(this.networkStateService.setIsDirty(!t),fe(!!t)))):(this.networkStateService.setIsDirty(!1),fe(!0))}static \u0275fac=function(t){return new(t||i)(P(Ye),P(Te))};static \u0275prov=k({token:i,factory:i.\u0275fac,providedIn:"root"})};var Ru=["mapContainer"];function Lu(i,e){if(i&1&&(s(0,"p",34),d(1),l()),i&2){let t=f();Ce("aria-label",t.data.description),p(),E(t.data.description)}}function Fu(i,e){i&1&&(s(0,"div",35),D(1,"mat-spinner",36),s(2,"span"),d(3,"Buscando ubicaci\xF3n..."),l()())}function zu(i,e){if(i&1&&(s(0,"div",37)(1,"mat-icon",38),d(2,"error"),l(),s(3,"span"),d(4),l()()),i&2){let t=f();p(4),E(t.error)}}function Bu(i,e){i&1&&(s(0,"div",39),D(1,"mat-spinner",40),s(2,"span"),d(3,"Cargando mapa..."),l()())}function Vu(i,e){if(i&1&&(s(0,"div",41)(1,"mat-icon"),d(2,"place"),l(),s(3,"span"),d(4),l()()),i&2){let t=f();p(4),E(t.isWithinDominicanRepublic()?"Ubicaci\xF3n v\xE1lida":"Fuera de Rep\xFAblica Dominicana")}}function $u(i,e){if(i&1&&(s(0,"div",42)(1,"div",43)(2,"mat-icon"),d(3,"location_on"),l(),s(4,"span"),d(5),l()(),s(6,"div",43)(7,"mat-icon"),d(8,"check_circle"),l(),s(9,"span"),d(10,"Dentro de Rep\xFAblica Dominicana"),l()()()),i&2){let t=f();p(5),V("Coordenadas: ",t.getCoordinatesString(),"")}}var Ca=-90,ya=90,Ea=-180,wa=180,jo={north:19.9302,south:17.4701,west:-72.0035,east:-68.32},Uo=class i{constructor(e,t,n,o,r,a,c){this.mapService=e;this.networkDesignService=t;this.networkStateService=n;this.snackBar=o;this.cdr=r;this.dialogRef=a;this.data=c;this.position=this.convertToExtendedPosition(this.validateInitialPosition(c.position))}mapContainer;position;searchQuery="";loading=!1;error=null;isValidPosition=!1;mapInitialized=!1;destroy$=new N;defaultPosition={coordinates:[-70.6946,19.8006],lng:-70.6946,lat:19.8006,type:"Point"};ngOnInit(){(!this.position.coordinates||this.position.coordinates.length!==2)&&(this.position=O({},this.defaultPosition)),this.validatePosition(),this.networkStateService.setPositionSelectionActive(!0),this.cdr.markForCheck()}ngAfterViewInit(){setTimeout(()=>this.initializeMap(),0),this.setupKeyboardNavigation()}ngOnDestroy(){this.networkStateService.setPositionSelectionActive(!1),this.destroy$.next(),this.destroy$.complete(),this.mapService.destroyMap()}validateInitialPosition(e){if(!e||!e.coordinates||e.coordinates.length!==2)return O({},this.defaultPosition);let[t,n]=e.coordinates;return isNaN(t)||isNaN(n)||t<Ea||t>wa||n<Ca||n>ya?(console.warn("Coordenadas iniciales inv\xE1lidas, usando posici\xF3n por defecto"),O({},this.defaultPosition)):O({},e)}convertToExtendedPosition(e){let t=e.coordinates??[this.defaultPosition.lng,this.defaultPosition.lat];return W(O({},e),{lng:t[0],lat:t[1]})}updateCoordinates(){if(isNaN(this.position.lat)||isNaN(this.position.lng)){this.error="Las coordenadas deben ser valores num\xE9ricos",this.isValidPosition=!1,this.cdr.markForCheck();return}if(this.position.lat<Ca||this.position.lat>ya||this.position.lng<Ea||this.position.lng>wa){this.error=`Coordenadas fuera de rango. Latitud debe estar entre ${Ca} y ${ya}, Longitud entre ${Ea} y ${wa}`,this.isValidPosition=!1,this.cdr.markForCheck();return}this.position.lat=parseFloat(this.position.lat.toFixed(6)),this.position.lng=parseFloat(this.position.lng.toFixed(6)),this.position.coordinates=[this.position.lng,this.position.lat],this.validatePosition(),this.mapService.updateMarkerPosition(this.position),this.isValidPosition&&this.showSuccessToast("Coordenadas actualizadas"),this.cdr.markForCheck()}setupKeyboardNavigation(){this.mapContainer&&this.mapContainer.nativeElement&&Vi(this.mapContainer.nativeElement,"keydown").pipe(R(this.destroy$),_e(e=>["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key))).subscribe(e=>{e.preventDefault();let t=1e-4,n=this.position.lat,o=this.position.lng;switch(e.key){case"ArrowUp":n+=t;break;case"ArrowDown":n-=t;break;case"ArrowLeft":o-=t;break;case"ArrowRight":o+=t;break}this.position.lat=n,this.position.lng=o,this.updateCoordinates()})}initializeMap(){try{if(!this.mapContainer||!this.mapContainer.nativeElement)throw new Error("Contenedor del mapa no disponible");if(typeof this.mapService.initializeMap=="function")this.mapService.initializeMap(this.mapContainer.nativeElement,this.position),this.setupMapEvents(),this.showSuccessToast("Mapa cargado correctamente"),this.mapInitialized=!0,this.cdr.markForCheck();else throw new Error("M\xE9todo initializeMap no disponible en el servicio de mapa")}catch(e){console.error("Error al inicializar el mapa:",e),this.error=e instanceof Error?e.message:"Error al inicializar el mapa",this.snackBar.open("Error al cargar el mapa. Por favor, intente nuevamente.","Cerrar",{duration:5e3,panelClass:["error-snackbar"]}),this.cdr.markForCheck()}}setupMapEvents(){try{typeof this.mapService.onMapClick=="function"&&this.mapService.onMapClick(e=>{this.updatePosition(e),this.pulseMarker(),this.cdr.markForCheck()}),typeof this.mapService.onMarkerDragEnd=="function"&&this.mapService.onMarkerDragEnd(e=>{this.updatePosition(e),this.showSuccessToast("Posici\xF3n actualizada"),this.cdr.markForCheck()}),typeof this.mapService.onZoomChange=="function"&&this.mapService.onZoomChange().pipe(R(this.destroy$)).subscribe(e=>{this.mapInitialized=!0,this.cdr.markForCheck()})}catch(e){console.error("Error al configurar eventos del mapa:",e)}}updatePosition(e){this.position=this.convertToExtendedPosition(e),this.position.lat=parseFloat(this.position.lat.toFixed(6)),this.position.lng=parseFloat(this.position.lng.toFixed(6)),this.position.coordinates=[this.position.lng,this.position.lat],this.validatePosition(),this.cdr.markForCheck()}validatePosition(){let e=this.networkDesignService.validatePosition(this.position),t=this.isWithinDominicanRepublic();this.isValidPosition=e&&t,e?t?this.error=null:this.error="La posici\xF3n debe estar dentro del territorio de Rep\xFAblica Dominicana":this.error="La posici\xF3n seleccionada est\xE1 fuera de los l\xEDmites permitidos",this.cdr.markForCheck()}searchLocation(){return ae(this,null,function*(){if(this.searchQuery.trim()){this.loading=!0,this.error=null,this.cdr.markForCheck();try{let e=yield this.mapService.searchLocation(this.searchQuery);if(e){if(this.updatePosition(e),!this.isValidPosition)throw this.isWithinDominicanRepublic()?new Error("La ubicaci\xF3n est\xE1 fuera de los l\xEDmites permitidos"):new Error("La ubicaci\xF3n est\xE1 fuera de Rep\xFAblica Dominicana");this.showSuccessToast("Ubicaci\xF3n encontrada")}else throw new Error("No se encontr\xF3 la ubicaci\xF3n")}catch(e){this.error=e instanceof Error?e.message:"Error al buscar la ubicaci\xF3n",this.snackBar.open(this.error,"Cerrar",{duration:4e3,panelClass:["error-snackbar"]})}finally{this.loading=!1,this.cdr.markForCheck()}}})}centerMap(){this.mapService.centerMap(),this.showSuccessToast("Mapa centrado")}zoomIn(){this.mapService.zoomIn()}zoomOut(){this.mapService.zoomOut()}onConfirm(){if(!this.isValidPosition){this.error="La posici\xF3n seleccionada no es v\xE1lida",this.snackBar.open(this.error,"Cerrar",{duration:3e3,panelClass:["error-snackbar"]});return}try{let e=lc([this.position.lng,this.position.lat],{altitude:this.position.altitude});this.networkStateService.setSelectedPosition(e),this.pulseMarker(),setTimeout(()=>{this.dialogRef.close(e)},300)}catch(e){console.error("Error al confirmar posici\xF3n:",e),this.snackBar.open("Error al procesar coordenadas","Cerrar",{duration:3e3,panelClass:["error-snackbar"]})}}onCancel(){this.dialogRef.close()}getCoordinatesString(){return`${this.position.lat.toFixed(6)}, ${this.position.lng.toFixed(6)}`}isWithinDominicanRepublic(){return this.position.lat>=jo.south&&this.position.lat<=jo.north&&this.position.lng>=jo.west&&this.position.lng<=jo.east}getMapAriaLabel(){return`Mapa interactivo. Haga clic para seleccionar ubicaci\xF3n. Posici\xF3n actual: ${this.getCoordinatesString()}`}getStatusText(){return this.isWithinDominicanRepublic()?"Posici\xF3n v\xE1lida dentro de Rep\xFAblica Dominicana":"Posici\xF3n inv\xE1lida, fuera de Rep\xFAblica Dominicana"}showSuccessToast(e){this.snackBar.open(e,"",{duration:2e3,panelClass:["success-snackbar"],horizontalPosition:"center",verticalPosition:"bottom"})}pulseMarker(){try{typeof this.mapService.pulseMarker=="function"?this.mapService.pulseMarker():typeof this.mapService.centerMap=="function"&&this.mapService.centerMap()}catch(e){console.warn("La animaci\xF3n del marcador no est\xE1 disponible:",e)}}static \u0275fac=function(t){return new(t||i)(I(vo),I(_o),I(Te),I(He),I($e),I(zn),I(ql))};static \u0275cmp=q({type:i,selectors:[["app-map-position-dialog"]],viewQuery:function(t,n){if(t&1&&lt(Ru,5),t&2){let o;ct(o=dt())&&(n.mapContainer=o.first)}},decls:73,vars:26,consts:[["mapContainer",""],["charset","utf-8"],["role","dialog","aria-labelledby","dialog-title",1,"map-position-dialog"],["mat-dialog-title","","id","dialog-title"],[1,"title-icon"],["class","dialog-description",4,"ngIf"],[1,"search-container"],["appearance","outline",1,"search-field"],["matInput","","placeholder","Ej: Ciudad, Direcci\xF3n, etc.","aria-label","Buscar ubicaci\xF3n",3,"ngModelChange","keyup.enter","ngModel","disabled"],["mat-icon-button","","matSuffix","","matTooltip","Buscar","aria-label","Buscar ubicaci\xF3n",1,"search-button",3,"click","disabled"],["class","loading-indicator","aria-live","polite",4,"ngIf"],["class","error-message","aria-live","assertive",4,"ngIf"],[1,"map-container"],["aria-label","Controles del mapa",1,"map-controls"],["mat-mini-fab","","color","primary","matTooltip","Centrar mapa","aria-label","Centrar mapa en la posici\xF3n actual",1,"map-control-button",3,"click"],["mat-mini-fab","","color","primary","matTooltip","Acercar","aria-label","Acercar el mapa",1,"map-control-button",3,"click"],["mat-mini-fab","","color","primary","matTooltip","Alejar","aria-label","Alejar el mapa",1,"map-control-button",3,"click"],["role","application","tabindex","0",1,"map"],["class","map-status-overlay",4,"ngIf"],["class","map-indicator",4,"ngIf"],["aria-labelledby","coordinates-heading",1,"coordinates-container"],["id","coordinates-heading"],[1,"coordinates-fields"],["appearance","outline"],["matInput","","type","number","step","0.000001","aria-label","Latitud","min","-90","max","90",3,"ngModelChange","change","ngModel"],["align","start"],["matInput","","type","number","step","0.000001","aria-label","Longitud","min","-180","max","180",3,"ngModelChange","change","ngModel"],["aria-live","polite",1,"coordinates-display"],[1,"coordinates-text"],["class","position-info","aria-live","polite",4,"ngIf"],["role","note","aria-label","Instrucciones de uso",1,"instructions"],["align","end"],["mat-button","","aria-label","Cancelar y cerrar di\xE1logo",1,"cancel-button",3,"click"],["mat-raised-button","","color","primary","aria-label","Confirmar selecci\xF3n de posici\xF3n",1,"confirm-button",3,"click","disabled"],[1,"dialog-description"],["aria-live","polite",1,"loading-indicator"],["diameter","30"],["aria-live","assertive",1,"error-message"],["color","warn"],[1,"map-status-overlay"],["diameter","40"],[1,"map-indicator"],["aria-live","polite",1,"position-info"],[1,"info-item"]],template:function(t,n){if(t&1){let o=F();D(0,"meta",1),s(1,"div",2)(2,"h2",3)(3,"mat-icon",4),d(4,"place"),l(),d(5),l(),s(6,"mat-dialog-content"),y(7,Lu,2,2,"p",5),s(8,"div",6)(9,"mat-form-field",7)(10,"mat-label"),d(11,"Buscar ubicaci\xF3n"),l(),s(12,"input",8),pn("ngModelChange",function(a){return _(o),dn(n.searchQuery,a)||(n.searchQuery=a),b(a)}),C("keyup.enter",function(){return _(o),b(n.searchLocation())}),l(),s(13,"button",9),C("click",function(){return _(o),b(n.searchLocation())}),s(14,"mat-icon"),d(15),l()()()(),y(16,Fu,4,0,"div",10)(17,zu,5,1,"div",11),s(18,"div",12)(19,"div",13)(20,"button",14),C("click",function(){return _(o),b(n.centerMap())}),s(21,"mat-icon"),d(22,"my_location"),l()(),s(23,"button",15),C("click",function(){return _(o),b(n.zoomIn())}),s(24,"mat-icon"),d(25,"add"),l()(),s(26,"button",16),C("click",function(){return _(o),b(n.zoomOut())}),s(27,"mat-icon"),d(28,"remove"),l()()(),D(29,"div",17,0),y(31,Bu,4,0,"div",18)(32,Vu,5,1,"div",19),l(),s(33,"div",20)(34,"h3",21)(35,"mat-icon"),d(36,"explore"),l(),d(37," Coordenadas "),l(),s(38,"div",22)(39,"mat-form-field",23)(40,"mat-label"),d(41,"Latitud"),l(),s(42,"input",24),pn("ngModelChange",function(a){return _(o),dn(n.position.lat,a)||(n.position.lat=a),b(a)}),C("change",function(){return _(o),b(n.updateCoordinates())}),l(),s(43,"mat-hint",25),d(44,"Entre -90 y 90"),l()(),s(45,"mat-form-field",23)(46,"mat-label"),d(47,"Longitud"),l(),s(48,"input",26),pn("ngModelChange",function(a){return _(o),dn(n.position.lng,a)||(n.position.lng=a),b(a)}),C("change",function(){return _(o),b(n.updateCoordinates())}),l(),s(49,"mat-hint",25),d(50,"Entre -180 y 180"),l()()(),s(51,"div",27)(52,"span",28),d(53),l(),s(54,"span")(55,"mat-icon"),d(56),l(),d(57),l()()(),y(58,$u,11,1,"div",29),s(59,"div",30)(60,"mat-icon"),d(61,"info"),l(),s(62,"span"),d(63,"Haga clic en el mapa o arrastre el marcador para seleccionar una ubicaci\xF3n"),l()()(),s(64,"mat-dialog-actions",31)(65,"button",32),C("click",function(){return _(o),b(n.onCancel())}),s(66,"mat-icon"),d(67,"close"),l(),d(68," Cancelar "),l(),s(69,"button",33),C("click",function(){return _(o),b(n.onConfirm())}),s(70,"mat-icon"),d(71,"check"),l(),d(72," Confirmar "),l()()()}t&2&&(p(5),V(" ",n.data.title||"Seleccionar Posici\xF3n"," "),p(2),u("ngIf",n.data.description),p(5),cn("ngModel",n.searchQuery),u("disabled",n.loading),Ce("aria-invalid",!!n.error),p(),u("disabled",n.loading||!n.searchQuery.trim()),p(2),E(n.loading?"hourglass_empty":"search"),p(),u("ngIf",n.loading),p(),u("ngIf",n.error),p(12),Ce("aria-label",n.getMapAriaLabel()),p(2),u("ngIf",!n.mapInitialized),p(),u("ngIf",n.mapInitialized),p(10),cn("ngModel",n.position.lat),Ce("aria-invalid",!n.isValidPosition),p(6),cn("ngModel",n.position.lng),Ce("aria-invalid",!n.isValidPosition),p(5),E(n.getCoordinatesString()),p(),K("valid-position",n.isWithinDominicanRepublic())("invalid-position",!n.isWithinDominicanRepublic()),Ce("aria-label",n.getStatusText()),p(2),E(n.isWithinDominicanRepublic()?"check_circle":"error"),p(),V(" ",n.isWithinDominicanRepublic()?"Posici\xF3n v\xE1lida":"Fuera de l\xEDmites"," "),p(),u("ngIf",n.isValidPosition),p(11),u("disabled",!n.isValidPosition))},dependencies:[X,ie,Xi,Ln,Fl,Fn,Gl,Hl,Zi,Qt,Bn,$n,Vn,he,Re,Ne,Il,Wn,go,ro,oo,Zl,Yl,Gn,le,de,Kn,qt,Ee,Me,mt,Wt,Un],encapsulation:2,changeDetection:0})};var en={origin:()=>mo(0,0),domincanRepublic:()=>mo(18.735693,-70.162651),santo_domingo:()=>mo(18.4821,-69.9312)};var ju={useMocks:!0,apiUrl:"http://localhost:3000/api",featureFlags:{enableMockData:!0}};var Ho=class i{logger=M(G);connectionsSubject=new ce([]);connectionInProgressSubject=new ce({state:"IDLE"});connections$=this.connectionsSubject.asObservable();connectionInProgress$=this.connectionInProgressSubject.asObservable();connections=[];constructor(){this.logger.debug("MapConnectionService inicializado")}setConnections(e){this.connections=[...e],this.connectionsSubject.next(this.connections),this.logger.debug(`Cargadas ${e.length} conexiones`)}getConnections(){return[...this.connections]}getConnectionById(e){return this.connections.find(t=>t.id===e)}getConnectionsForElement(e){return this.connections.filter(t=>t.sourceElementId===e||t.targetElementId===e)}getConnectionBetweenElements(e,t){return this.connections.find(n=>n.sourceElementId===e&&n.targetElementId===t||n.sourceElementId===t&&n.targetElementId===e)}startConnectionCreation(){this.connectionInProgressSubject.next({state:"IDLE"}),this.logger.debug("Iniciando creaci\xF3n de conexi\xF3n")}selectSourceElement(e){if(!this.isValidConnectionEndpoint(e)){this.setConnectionError("El elemento seleccionado no puede ser usado como origen de conexi\xF3n");return}this.connectionInProgressSubject.next({sourceElement:e,state:"SOURCE_SELECTED"}),this.logger.debug(`Elemento origen seleccionado: ${e.id}`)}selectTargetElement(e){let t=this.connectionInProgressSubject.value;if(t.state!=="SOURCE_SELECTED"||!t.sourceElement){this.setConnectionError("Debe seleccionar primero un elemento origen");return}if(t.sourceElement.id===e.id){this.setConnectionError("El origen y destino no pueden ser el mismo elemento");return}if(!this.isValidConnectionEndpoint(e)){this.setConnectionError("El elemento seleccionado no puede ser usado como destino de conexi\xF3n");return}if(!this.areElementsCompatible(t.sourceElement,e)){this.setConnectionError("Los elementos seleccionados no son compatibles para conexi\xF3n");return}this.connectionInProgressSubject.next(W(O({},t),{targetElement:e,state:"TARGET_SELECTED"})),this.logger.debug(`Elemento destino seleccionado: ${e.id}`)}finishConnection(){return ae(this,null,function*(){let e=this.connectionInProgressSubject.value;if(e.state!=="TARGET_SELECTED"||!e.sourceElement||!e.targetElement){this.setConnectionError("No hay una conexi\xF3n v\xE1lida en progreso");return}try{let t=e.sourceElement.id,n=e.targetElement.id;if(!t||!n){this.setConnectionError("Los elementos de origen o destino no tienen IDs");return}let o={id:`conn-${Date.now()}`,name:`Conexi\xF3n ${t}-${n}`,sourceElementId:t,targetElementId:n,status:"ACTIVE",type:this.determineConnectionType(e.sourceElement,e.targetElement)};return e.sourceElement.type==="OLT"&&e.targetElement.type==="ONT"&&(o.name=`OLT-ONT-${Date.now()}`,o.description=`Conexi\xF3n entre ${e.sourceElement.name} y ${e.targetElement.name}`),this.connections=[...this.connections,o],this.connectionsSubject.next(this.connections),this.resetConnectionCreation(),this.logger.debug(`Conexi\xF3n creada: ${o.id}`),o}catch(t){this.logger.error("Error al crear la conexi\xF3n",t),this.setConnectionError("Error al crear la conexi\xF3n");return}})}cancelConnectionCreation(){this.resetConnectionCreation(),this.logger.debug("Creaci\xF3n de conexi\xF3n cancelada")}updateConnection(e,t){let n=this.connections.findIndex(o=>o.id===e);if(n===-1){this.logger.warn(`Conexi\xF3n no encontrada: ${e}`);return}this.connections=[...this.connections.slice(0,n),O(O({},this.connections[n]),t),...this.connections.slice(n+1)],this.connectionsSubject.next(this.connections),this.logger.debug(`Conexi\xF3n actualizada: ${e}`)}deleteConnection(e){let t=this.connections.findIndex(n=>n.id===e);if(t===-1){this.logger.warn(`Conexi\xF3n no encontrada: ${e}`);return}this.connections=[...this.connections.slice(0,t),...this.connections.slice(t+1)],this.connectionsSubject.next(this.connections),this.logger.debug(`Conexi\xF3n eliminada: ${e}`)}isValidConnectionEndpoint(e){return["OLT","ONT","ODF","SPLITTER","MANGA","FDP","TERMINAL_BOX"].includes(e.type)}areElementsCompatible(e,t){let n={OLT:["ODF","SPLITTER"],ODF:["OLT","SPLITTER","MANGA","FDP"],SPLITTER:["OLT","ODF","FDP","TERMINAL_BOX","SPLITTER"],MANGA:["ODF","FDP","TERMINAL_BOX"],FDP:["ODF","SPLITTER","MANGA","TERMINAL_BOX"],TERMINAL_BOX:["SPLITTER","MANGA","FDP","ONT"],ONT:["TERMINAL_BOX"]};return n[e.type]?.includes(t.type)||n[t.type]?.includes(e.type)||!1}determineConnectionType(e,t){return e.type==="OLT"&&t.type==="ODF"||t.type==="OLT"&&e.type==="ODF"?"OLT-ODF":e.type==="ODF"&&t.type==="SPLITTER"||t.type==="ODF"&&e.type==="SPLITTER"?"ODF-SPLITTER":e.type==="SPLITTER"&&t.type==="TERMINAL_BOX"||t.type==="SPLITTER"&&e.type==="TERMINAL_BOX"?"SPLITTER-TERMINAL":e.type==="TERMINAL_BOX"&&t.type==="ONT"||t.type==="TERMINAL_BOX"&&e.type==="ONT"?"TERMINAL-ONT":"FIBER"}setConnectionError(e){this.connectionInProgressSubject.next({state:"FAILED",error:e}),this.logger.warn(`Error en creaci\xF3n de conexi\xF3n: ${e}`),setTimeout(()=>this.resetConnectionCreation(),3e3)}resetConnectionCreation(){this.connectionInProgressSubject.next({state:"IDLE"})}createConnection(e){if(!e.sourceElement||!e.targetElement)return it(()=>new Error("Elementos de origen o destino no definidos"));if(!e.sourceElement.id||!e.targetElement.id)return it(()=>new Error("Los elementos de origen o destino no tienen IDs"));let t={id:`conn-${Date.now()}`,name:e.name||`Conexi\xF3n ${e.sourceElement.name} a ${e.targetElement.name}`,sourceElementId:e.sourceElement.id,targetElementId:e.targetElement.id,status:"ACTIVE",type:this.determineConnectionType(e.sourceElement,e.targetElement),properties:{}};return e.waypoints&&e.waypoints.length>0&&(t.points=e.waypoints),this.logger.debug("Creando nueva conexi\xF3n:",t),ju.useMocks?(t.id=`conn-${Date.now()}-${Math.floor(Math.random()*1e3)}`,t.createdAt=new Date,this.addConnectionToLocalList(t),fe(t).pipe(di(300),xe(()=>this.logger.debug("Conexi\xF3n creada localmente:",t)))):fe(t).pipe(di(300),xe(()=>this.logger.debug("Conexi\xF3n simulada:",t)))}addConnectionToLocalList(e){this.connections=[...this.connections,e],this.connectionsSubject.next(this.connections)}static \u0275fac=function(t){return new(t||i)};static \u0275prov=k({token:i,factory:i.\u0275fac,providedIn:"root"})};var It=class i{constructor(e){this.logger=e;this.logger.debug("MapEventsService inicializado")}eventSubject=new ce(null);cancelActionsSubject=new N;dispatch(e){this.logger.debug(`Evento del mapa emitido: ${e.type}`),this.eventSubject.next(e)}getEvents(){return this.eventSubject.asObservable().pipe(_e(e=>e!==null))}getEventsByType(e){return this.getEvents().pipe(_e(t=>t.type===e))}on(e){return this.getEventsByType(e)}cancelAction(e,t="Cancelled by user"){this.logger.debug(`Solicitud de cancelaci\xF3n para acci\xF3n: ${e}`),this.cancelActionsSubject.next(e),this.dispatch({type:"action_cancelled",timestamp:new Date,action:e,reason:t})}onActionCancelled(e){return this.cancelActionsSubject.asObservable().pipe(_e(t=>t===e),se(()=>{}))}withCancellation(e,t){let n=this.onActionCancelled(e);return t(n)}selectElement(e){this.dispatch({type:"element_selected",timestamp:new Date,element:e})}selectConnection(e){this.dispatch({type:"connection_selected",timestamp:new Date,connection:e})}createConnection(e){this.dispatch({type:"connection_created",timestamp:new Date,connection:e})}createElement(e){this.dispatch({type:"element_created",timestamp:new Date,element:e})}deleteElement(e,t){this.dispatch({type:"element_deleted",timestamp:new Date,elementId:e,elementName:t})}completeMeasurement(e,t,n){this.dispatch({type:"measurement_completed",timestamp:new Date,sourceElement:e,targetElement:t,distance:n})}toggleLayer(e,t){this.dispatch({type:"layer_toggled",timestamp:new Date,layerType:e,active:t})}changeZoom(e){this.dispatch({type:"zoom_changed",timestamp:new Date,level:e})}changeTool(e,t){this.dispatch({type:"tool_changed",timestamp:new Date,tool:e,previousTool:t})}mapClicked(e){this.dispatch({type:"map_clicked",timestamp:new Date,position:e})}dragStarted(e,t){this.dispatch({type:"drag_started",timestamp:new Date,elementId:e,startPosition:t})}dragEnded(e,t){this.dispatch({type:"drag_ended",timestamp:new Date,elementId:e,endPosition:t})}updateElement(e,t){this.dispatch({type:"element_updated",timestamp:new Date,element:e,previousState:t})}updateConnection(e,t){this.dispatch({type:"connection_updated",timestamp:new Date,connection:e,previousState:t})}mapCenterChanged(e,t){this.dispatch({type:"map_center_changed",timestamp:new Date,center:e,zoom:t})}mapBoundsChanged(e){this.dispatch({type:"map_bounds_changed",timestamp:new Date,bounds:e})}mapReady(e){this.dispatch({type:"map_ready",timestamp:new Date,mapInstance:e})}mapError(e,t){this.dispatch({type:"map_error",timestamp:new Date,error:e,context:t})}static \u0275fac=function(t){return new(t||i)(P(G))};static \u0275prov=k({token:i,factory:i.\u0275fac,providedIn:"root"})};var ei=class i{constructor(e){this.logger=e}initialize(e,t={}){return new Promise((n,o)=>{try{let r=this.initializeMapContainer(e,t);if(!r.success){o(new Error(r.errorMessage));return}t.darkMode?e.classList.add("dark-theme"):e.classList.remove("dark-theme"),t.enableOfflineMode&&e.setAttribute("data-offline-mode","true"),t.async?setTimeout(()=>n(r),100):n(r)}catch(r){this.logger.error("Error en initialize:",r),o(r)}})}initializeMapContainer(e,t={}){if(!e){let r="Contenedor de mapa no disponible";return this.logger.error(r),{success:!1,errorMessage:r}}let n=t.minSize||10,o=e.getBoundingClientRect();if(o.width<n||o.height<n){let r=`Dimensiones del contenedor incorrectas: ${o.width}x${o.height}`;return this.logger.error(r),{success:!1,errorMessage:r}}return t.width&&(e.style.width=`${t.width}px`),t.height&&(e.style.height=`${t.height}px`),t.cssClass&&e.classList.add(t.cssClass),this.logger.debug(`Contenedor de mapa inicializado: ${o.width}x${o.height}`),{success:!0,dimensions:{width:o.width,height:o.height}}}showInitializationError(e,t,n,o){this.logger.error(`Error de inicializaci\xF3n en ${t}: ${e}`),n&&o&&o.run(()=>{n.open(`Error: ${e}`,"Cerrar",{duration:fo.ui.snackbarDuration,panelClass:"error-snackbar"})})}refreshContainer(e,t){e&&setTimeout(()=>{let n=e.getBoundingClientRect();this.logger.debug(`Contenedor actualizado: ${n.width}x${n.height}`),t.markForCheck()},0)}hasValidDimensions(e,t=10,n=10){if(!e)return!1;let o=e.getBoundingClientRect();return o.width>=t&&o.height>=n}setupAutoFill(e){e&&(e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.right="0",e.style.bottom="0",e.style.width="100%",e.style.height="100%")}addDebugVisualization(e,t){if(!fo.debugging.componentBoundaries||!fo.debugging.componentBoundaries)return;e.style.border="1px dashed rgba(255, 0, 0, 0.5)";let n=document.createElement("div");n.textContent=t,n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.fontSize="10px",n.style.background="rgba(255, 0, 0, 0.7)",n.style.color="white",n.style.padding="2px 5px",n.style.zIndex="9999",e.appendChild(n)}static \u0275fac=function(t){return new(t||i)(P(G))};static \u0275prov=k({token:i,factory:i.\u0275fac,providedIn:"root"})};var ad={OLT:"Terminal de L\xEDnea \xD3ptica",ONT:"Terminal de Red \xD3ptica",FDP:"Punto de Distribuci\xF3n de Fibra",ODF:"Marco de Distribuci\xF3n \xD3ptica",EDFA:"Amplificador de Fibra",SPLITTER:"Divisor \xD3ptico",MANGA:"Manga de Empalme",TERMINAL_BOX:"Caja Terminal",FIBER_THREAD:"Hilo de Fibra",FIBER_CONNECTION:"Conexi\xF3n de Fibra",FIBER_SPLICE:"Empalme de Fibra",FIBER_CABLE:"Cable de Fibra",FIBER_STRAND:"Hilo de Fibra",DROP_CABLE:"Cable de Acometida",DISTRIBUTION_CABLE:"Cable de Distribuci\xF3n",FEEDER_CABLE:"Cable Alimentador",BACKBONE_CABLE:"Cable Troncal",ROUTER:"Router",RACK:"Rack",MSAN:"Nodo de Acceso Multi-Servicio",NETWORK_GRAPH:"Grafo de Red",WDM_FILTER:"Filtro WDM",COHERENT_TRANSPONDER:"Transpondedor Coherente",WAVELENGTH_ROUTER:"Enrutador de Longitudes de Onda",OPTICAL_SWITCH:"Conmutador \xD3ptico",ROADM:"Multiplexor \xD3ptico Reconfigurable",OPTICAL_AMPLIFIER:"Amplificador \xD3ptico",SLACK_FIBER:"Flojo de Fibra",CUSTOM:"Elemento Personalizado",CABINET:"Gabinete",CHAMBER:"C\xE1mara/Pozo",POLE:"Poste",BUILDING:"Edificio",SITE:"Sitio/Local",NODE:"Nodo",PATCH_PANEL:"Panel de Parcheo",FIBER_CLOSURE:"Cierre de Fibra",SWITCH:"Switch",MULTIPLEXER:"Multiplexor",DEMULTIPLEXER:"Demultiplexor",REPEATER:"Repetidor",ATTENUATOR:"Atenuador",CONNECTOR:"Conector",CROSS_CONNECT:"Cruzada",SUBSCRIBER:"Abonado/Cliente",SERVICE_POINT:"Punto de Servicio",AGGREGATION_POINT:"Punto de Agregaci\xF3n",SPLICE_BOX:"Caja de Empalme",NAP:"Punto de Acceso a la Red",FAT:"Terminal de Acceso de Fibra",DISTRIBUTION_BOX:"Caja de Distribuci\xF3n",ACCESS_POINT:"Punto de Acceso",HUB:"Concentrador",GATEWAY:"Pasarela",DUCT:"Ducto/Canalizaci\xF3n",WSS:"Switch Selectivo de Longitud de Onda",RF_OVERLAY_SYSTEM:"Sistema RF Overlay",MONITORING_SYSTEM:"Sistema de Monitorizaci\xF3n",ROUTE:"Ruta",SERVICE_AREA:"\xC1rea de Servicio",MDU_BUILDING:"Edificio MDU"},iy={OLT:"router",ONT:"device_hub",FDP:"cable",ODF:"settings_input_hdmi",EDFA:"electrical_services",SPLITTER:"call_split",MANGA:"manga",TERMINAL_BOX:"inbox",FIBER_THREAD:"timeline",FIBER_CONNECTION:"timeline",FIBER_SPLICE:"settings_input_component",FIBER_CABLE:"settings_ethernet",FIBER_STRAND:"settings_ethernet",DROP_CABLE:"settings_ethernet",DISTRIBUTION_CABLE:"settings_ethernet",FEEDER_CABLE:"settings_ethernet",BACKBONE_CABLE:"settings_ethernet",ROUTER:"wifi_tethering",RACK:"dns",MSAN:"device_hub",NETWORK_GRAPH:"share",WDM_FILTER:"filter_alt",COHERENT_TRANSPONDER:"dvr",WAVELENGTH_ROUTER:"router",OPTICAL_SWITCH:"swap_horiz",ROADM:"swap_calls",OPTICAL_AMPLIFIER:"trending_up",SLACK_FIBER:"waves",CUSTOM:"extension",CABINET:"inventory_2",CHAMBER:"architecture",POLE:"candlestick_chart",BUILDING:"apartment",SITE:"location_on",NODE:"hub",PATCH_PANEL:"dashboard",FIBER_CLOSURE:"all_inbox",SWITCH:"swap_horiz",MULTIPLEXER:"call_merge",DEMULTIPLEXER:"call_split",REPEATER:"repeat",ATTENUATOR:"tune",CONNECTOR:"link",CROSS_CONNECT:"compare_arrows",SUBSCRIBER:"person",SERVICE_POINT:"room_service",AGGREGATION_POINT:"merge_type",SPLICE_BOX:"inbox",NAP:"network_cell",FAT:"router",DISTRIBUTION_BOX:"inventory",ACCESS_POINT:"wifi",HUB:"hub",GATEWAY:"vpn_lock",DUCT:"alt_route",WSS:"settings_ethernet",RF_OVERLAY_SYSTEM:"settings_input_antenna",MONITORING_SYSTEM:"monitor_heart",ROUTE:"alt_route",SERVICE_AREA:"map",MDU_BUILDING:"apartment"},sd={ACTIVE:"status-active",INACTIVE:"status-inactive",MAINTENANCE:"status-maintenance",ERROR:"status-error",PLANNING:"status-planning",FAULT:"status-fault",PLANNED:"status-planned",BUILDING:"status-building",RESERVE:"status-reserved",DECOMMISSIONED:"status-decommissioned",WARNING:"status-warning",CRITICAL:"status-critical",UNKNOWN:"status-unknown"},oy={ACTIVE:"Activo",INACTIVE:"Inactivo",MAINTENANCE:"En mantenimiento",ERROR:"Error",PLANNING:"Planificaci\xF3n",FAULT:"Con fallo",PLANNED:"Planificado",BUILDING:"En construcci\xF3n",RESERVE:"Reservado",DECOMMISSIONED:"Fuera de servicio",WARNING:"Con advertencias",CRITICAL:"Estado cr\xEDtico",UNKNOWN:"Desconocido"},ry={ACTIVE_EQUIPMENT:["OLT","ONT","EDFA","ROUTER","MSAN","ROADM","COHERENT_TRANSPONDER","OPTICAL_SWITCH","OPTICAL_AMPLIFIER","SWITCH","MULTIPLEXER","DEMULTIPLEXER","REPEATER","HUB","GATEWAY","ACCESS_POINT"],PASSIVE_EQUIPMENT:["ODF","FDP","SPLITTER","MANGA","TERMINAL_BOX","RACK","WDM_FILTER","PATCH_PANEL","FIBER_CLOSURE","ATTENUATOR","CONNECTOR","CROSS_CONNECT","SPLICE_BOX","NAP","FAT","DISTRIBUTION_BOX"],INFRASTRUCTURE:["CABINET","CHAMBER","POLE","BUILDING","SITE","NODE"],CABLES:["FIBER_CABLE","DROP_CABLE","DISTRIBUTION_CABLE","FEEDER_CABLE","BACKBONE_CABLE","FIBER_THREAD","FIBER_STRAND","SLACK_FIBER"],CONNECTIONS:["FIBER_CONNECTION","FIBER_SPLICE"],VIRTUAL:["NETWORK_GRAPH","WAVELENGTH_ROUTER"],CLIENTS:["SUBSCRIBER","SERVICE_POINT","AGGREGATION_POINT"],CUSTOM:["CUSTOM"]};var Sa=(r=>(r.DEBUG="debug",r.INFO="info",r.WARN="warn",r.ERROR="error",r.PERFORMANCE="performance",r))(Sa||{}),ti=class i{constructor(e){this.injector=e;this.logger=this.injector.get(G),this.cdr=this.injector.get($e),this.zone=this.injector.get(Qe),this.snackBar=this.injector.get(He),this.elementService=this.injector.get(kt),this.networkStateService=this.injector.get(Te),this.mapEventsService=this.injector.get(It),this.mapInitializer=this.injector.get(ei),this.utils=this.injector.get(hc),this.checkDebugMode()}destroy$=new N;isLoading=!0;error=null;mapInitialized=!1;logger;cdr;zone;snackBar;elementService;networkStateService;mapEventsService;mapInitializer;utils;memoizationCache=new Map;debugMode=!1;enabledLogLevels=new Set(["error","warn"]);memoStats={hits:0,misses:0,expired:0,totalEntries:0};checkDebugMode(){if(localStorage.getItem("networkmap_debug_mode")==="true"){this.debugMode=!0,this.enableAllLogLevels(),this.logDebug("Modo debug activado desde localStorage");return}if(typeof window<"u"){let t=new URLSearchParams(window.location.search);t.get("debug")==="true"&&(this.debugMode=!0,this.enableAllLogLevels(),this.logDebug("Modo debug activado desde URL"));let o=t.get("logLevels");o&&this.configureLogLevels(o.split(","))}}enableAllLogLevels(){this.enabledLogLevels=new Set(Object.values(Sa))}configureLogLevels(e){!e||e.length===0||(this.enabledLogLevels.clear(),e.forEach(t=>{let n=t.toLowerCase();Object.values(Sa).includes(n)&&this.enabledLogLevels.add(n)}),this.enabledLogLevels.add("error"))}logDebug(e,t,n="debug"){if(!this.debugMode&&!this.enabledLogLevels.has(n))return;let o=this.constructor.name,a=`[${new Date().toISOString()}] [${o}] ${e}`;switch(n){case"info":t?this.logger.info(a,t):this.logger.info(a);break;case"warn":t?this.logger.warn(a,t):this.logger.warn(a);break;case"error":t?this.logger.error(a,t):this.logger.error(a);break;case"performance":t?this.logger.debug(`[PERFORMANCE] ${a}`,t):this.logger.debug(`[PERFORMANCE] ${a}`);break;case"debug":default:t?this.logger.debug(a,t):this.logger.debug(a)}}memoize(e,t,n=5e3){let o=`${this.constructor.name}_${e}`,r=Date.now(),a=this.memoizationCache.get(o);if(a){if(r-a.timestamp<a.ttl)return a.hitCount++,this.memoStats.hits++,this.logDebug(`Cache hit para: ${o} (hit count: ${a.hitCount})`,{ttl:a.ttl,age:r-a.timestamp},"performance"),a.value;this.memoStats.expired++,this.logDebug(`Cache expired para: ${o}`,{age:r-a.timestamp,ttl:a.ttl},"performance")}else this.memoStats.misses++;let c=performance.now(),m=t(),g=performance.now()-c;return this.memoizationCache.set(o,{value:m,timestamp:r,ttl:n,hitCount:1}),this.memoStats.totalEntries=this.memoizationCache.size,this.logDebug(`Cache miss para: ${o}, calculado en ${g.toFixed(2)}ms`,{executionTime:g,cacheSize:this.memoizationCache.size},"performance"),m}clearMemoization(e){if(e){let t=`${this.constructor.name}_${e}`;this.memoizationCache.delete(t),this.logDebug(`Cach\xE9 limpiada para: ${t}`,null,"performance")}else{let t=this.memoizationCache.size;this.memoizationCache.clear(),this.logDebug(`Toda la cach\xE9 de memoizaci\xF3n ha sido limpiada (${t} entradas)`,null,"performance")}this.memoStats.totalEntries=this.memoizationCache.size}getMemoizationStats(){let e=this.memoStats.hits/(this.memoStats.hits+this.memoStats.misses);return this.logDebug("Estad\xEDsticas de memoizaci\xF3n:",W(O({},this.memoStats),{hitRatio:isNaN(e)?0:e.toFixed(2),cacheSize:this.memoizationCache.size}),"performance"),O({},this.memoStats)}handleError(e,t="Error en el componente de mapa",n=!0){this.error=t,this.isLoading=!1;let o=this.constructor.name,r=e?e.message||JSON.stringify(e):"Error desconocido";this.logger.error(`[${o}] ${t}`,{component:o,message:t,error:r,timestamp:new Date().toISOString(),stack:e?.stack}),n&&this.zone.run(()=>{this.snackBar.open(`Error: ${t}`,"Cerrar",{duration:5e3,panelClass:"error-snackbar"}),this.cdr.markForCheck()}),e&&(e.name==="NetworkError"||e.name==="DataCorruptionError")&&this.clearMemoization()}validateContainerDimensions(e,t=100,n=100){if(!e)return this.logDebug("Contenedor no disponible",null,"warn"),!1;let o=e.clientWidth,r=e.clientHeight;return o<t||r<n?(this.logDebug(`Dimensiones de contenedor inv\xE1lidas: ${o}x${r}`,{width:o,height:r,minWidth:t,minHeight:n},"warn"),!1):(this.logDebug(`Dimensiones de contenedor v\xE1lidas: ${o}x${r}`,{width:o,height:r,minWidth:t,minHeight:n},"debug"),!0)}initializeMapContainer(e){this.logDebug("Inicializando contenedor de mapa",{container:e.id||"sin-id",dimensions:`${e.clientWidth}x${e.clientHeight}`},"info");let t=this.mapInitializer.initializeMapContainer(e);return t.success?!0:(this.handleError(null,t.errorMessage||"Error al inicializar contenedor"),!1)}completeLoading(){let e=performance.now();this.isLoading=!1,this.mapInitialized=!0,this.logDebug("Carga completada",{loadingTime:e},"info"),this.cdr.markForCheck()}getElementTypeName(e){return this.memoize(`elementTypeName_${e}`,()=>ad[e]||`Tipo ${e}`,6e4)}getElementStatusClass(e){return this.memoize(`elementStatusClass_${e}`,()=>sd[e]||"status-unknown",6e4)}calculateDistance(e,t,n,o){return this.memoize(`distance_${e}_${t}_${n}_${o}`,()=>this.utils.calculateDistance(e,t,n,o),3e4)}formatDate(e){return this.utils.formatDate(e)}cleanup(){this.logDebug("Limpiando recursos",this.getMemoizationStats(),"info"),this.clearMemoization(),this.destroy$.next(),this.destroy$.complete()}handleElementSelected(e){this.mapEventsService.selectElement(e),this.logDebug("Elemento seleccionado",e?{id:e.id,name:e.name,type:e.type}:null,"info")}handleConnectionSelected(e){this.mapEventsService.selectConnection(e),this.logDebug("Conexi\xF3n seleccionada",e?{id:e.id,type:e.type}:null,"info")}ngOnInit(){try{let e=performance.now();this.logDebug("Inicializando componente",null,"info"),this.initializeComponent();let t=performance.now()-e;this.logDebug(`Componente inicializado en ${t.toFixed(2)}ms`,{initTime:t},"performance")}catch(e){this.handleError(e,"Error al inicializar componente")}}ngOnDestroy(){this.logDebug("Destruyendo componente",null,"info"),this.cleanup()}static \u0275fac=function(t){return new(t||i)(I(jt))};static \u0275dir=sn({type:i})};var Uu=["mapContainer"],Hu=["mapSvg"];function Gu(i,e){i&1&&(s(0,"div",11),D(1,"mat-spinner",12),s(2,"span"),d(3,"Cargando mapa..."),l()()),i&2&&(p(),u("diameter",48))}function Wu(i,e){if(i&1){let t=F();s(0,"div",13)(1,"p"),d(2),l(),s(3,"button",14),C("click",function(){_(t);let o=f();return b(o.retryLoading())}),d(4,"Reintentar"),l()()}if(i&2){let t=f();p(2),E(t.errorMessage)}}var Si=class i extends ti{mapContainerEl;mapSvgEl;set activeLayers(e){this._activeLayers=e,this.refreshMap()}get activeLayers(){return this._activeLayers}set tool(e){this._tool=e,this.updateCursor()}get tool(){return this._tool}set darkMode(e){this.isDarkMode=e,this.applyTheme()}set loading(e){this.isLoading=e,this.cdr.markForCheck()}elementSelected=new U;connectionSelected=new U;zoomChanged=new U;mapError=new U;mapLoaded=new U;cursorPositionChanged=new U;measurementComplete=new U;width=800;height=600;isDarkMode=!1;errorMessage=null;zoomScale=1;panOffset={x:0,y:0};isDragging=!1;dragStart={x:0,y:0};lastPanOffset={x:0,y:0};_tool="pan";_activeLayers=[];elements=[];connections=[];selectedElement=null;selectedConnection=null;stateManager;elementManager;performanceService;interactionService;connectionService=null;zone;constructor(e){super(e),this.stateManager=e.get(gt),this.elementManager=e.get(qn),this.performanceService=e.get(Zn),this.interactionService=e.get(Eo),this.zone=e.get(Qe);try{this.connectionService=e.get(Ho),this.logDebug("MapConnectionService inicializado correctamente")}catch{this.logDebug("MapConnectionService no disponible, algunas funciones de conexi\xF3n podr\xEDan estar limitadas",null,"warn")}this.logDebug("MapViewComponent inicializado")}initializeComponent(){this.setupSubscriptions()}ngAfterViewInit(){this.updateDimensions(),this.generateGrid(),this.loadElements(),setTimeout(()=>{this.finishLoading()},1500)}setupSubscriptions(){if(this.stateManager.activeLayers.pipe(R(this.destroy$)).subscribe(e=>{this._activeLayers=e,this.refreshMap()}),this.stateManager.currentTool.pipe(R(this.destroy$)).subscribe(e=>{this._tool=e,this.updateCursor()}),this.interactionService)try{let e=this.injector.get(yo,null);e?(this.logDebug("Usando observables de selecci\xF3n de MapStateService"),e.selectedElementIds$.pipe(R(this.destroy$)).subscribe(t=>{if(t&&t.length>0){let n=t[0],o=this.elements.find(r=>r.id===n)||null;this.selectedElement?.id!==o?.id&&(this.selectedElement=o,this.updateSelectionIndicators(),this.elementSelected.emit(o),this.cdr.markForCheck())}else this.selectedElement&&(this.selectedElement=null,this.updateSelectionIndicators(),this.elementSelected.emit(null),this.cdr.markForCheck())}),e.selectedConnectionIds$.pipe(R(this.destroy$)).subscribe(t=>{if(t&&t.length>0){let n=t[0],o=this.connections.find(r=>r.id===n)||null;this.selectedConnection?.id!==o?.id&&(this.selectedConnection=o,this.updateSelectionIndicators(),this.connectionSelected.emit(o),this.cdr.markForCheck())}else this.selectedConnection&&(this.selectedConnection=null,this.updateSelectionIndicators(),this.connectionSelected.emit(null),this.cdr.markForCheck())})):this.elementManager&&this.elementManager.elementSelected?(this.logDebug("Usando observable elementSelected de ElementManager"),this.elementManager.elementSelected.pipe(R(this.destroy$)).subscribe(t=>{this.selectedElement?.id!==t?.id&&(this.selectedElement=t,this.updateSelectionIndicators(),this.elementSelected.emit(t),this.cdr.markForCheck())})):this.logDebug("No se encontraron observables de selecci\xF3n, usando selecci\xF3n manual",null,"warn")}catch(e){this.logDebug("Error al configurar suscripciones de selecci\xF3n",e,"error")}else this.logDebug("InteractionService no disponible, la selecci\xF3n funcionar\xE1 solo manualmente",null,"warn")}updateDimensions(){if(this.mapContainerEl&&this.mapContainerEl.nativeElement){let e=this.mapContainerEl.nativeElement.getBoundingClientRect();this.width=e.width,this.height=e.height,this.cdr.markForCheck()}}generateGrid(){if(!this.mapSvgEl||!this.mapSvgEl.nativeElement){this.logDebug("No se puede generar el grid: elemento SVG no disponible",null,"warn");return}try{let t=this.mapSvgEl.nativeElement.querySelector(".grid-container");if(!t){this.logDebug("No se encuentra el contenedor de la cuadr\xEDcula",null,"warn");return}for(;t.firstChild;)t.removeChild(t.firstChild);let n=50,o=5e3,r=document.createElementNS("http://www.w3.org/2000/svg","rect");r.setAttribute("x",(-o).toString()),r.setAttribute("y",(-o).toString()),r.setAttribute("width",(o*2).toString()),r.setAttribute("height",(o*2).toString()),r.setAttribute("fill",this.isDarkMode?"#2D3748":"#E8EEF2"),t.appendChild(r);for(let m=-o;m<=o;m+=n){let g=document.createElementNS("http://www.w3.org/2000/svg","line");g.setAttribute("x1",m.toString()),g.setAttribute("y1",(-o).toString()),g.setAttribute("x2",m.toString()),g.setAttribute("y2",o.toString()),g.setAttribute("class","grid-line"),g.setAttribute("stroke",this.isDarkMode?"#777777":"#aaaaaa"),g.setAttribute("stroke-width","1"),t.appendChild(g)}for(let m=-o;m<=o;m+=n){let g=document.createElementNS("http://www.w3.org/2000/svg","line");g.setAttribute("x1",(-o).toString()),g.setAttribute("y1",m.toString()),g.setAttribute("x2",o.toString()),g.setAttribute("y2",m.toString()),g.setAttribute("class","grid-line"),g.setAttribute("stroke",this.isDarkMode?"#777777":"#aaaaaa"),g.setAttribute("stroke-width","1"),t.appendChild(g)}let a=document.createElementNS("http://www.w3.org/2000/svg","line");a.setAttribute("x1",(-o).toString()),a.setAttribute("y1","0"),a.setAttribute("x2",o.toString()),a.setAttribute("y2","0"),a.setAttribute("class","grid-axis"),a.setAttribute("stroke",this.isDarkMode?"#999999":"#666666"),a.setAttribute("stroke-width","2"),t.appendChild(a);let c=document.createElementNS("http://www.w3.org/2000/svg","line");c.setAttribute("x1","0"),c.setAttribute("y1",(-o).toString()),c.setAttribute("x2","0"),c.setAttribute("y2",o.toString()),c.setAttribute("class","grid-axis"),c.setAttribute("stroke",this.isDarkMode?"#999999":"#666666"),c.setAttribute("stroke-width","2"),t.appendChild(c),this.panOffset={x:this.width/2,y:this.height/2},this.lastPanOffset=O({},this.panOffset),this.logDebug("Grid generado correctamente")}catch(e){this.logDebug("Error al generar el grid",e,"error")}}loadElements(){if(this.isLoading=!0,this.errorMessage=null,this.cdr.markForCheck(),!this.elementManager){this.logDebug("ElementManager no disponible, finalizando carga",null,"warn"),setTimeout(()=>{this.finishLoading()},500);return}this.logDebug("Iniciando carga de elementos del mapa",null,"info"),setTimeout(()=>{try{let e=performance.now();this.elementManager.loadElementsProgressively({batchSize:50,maxElements:1e3,progressCallback:t=>{t%10===0&&this.zone.run(()=>{this.logDebug(`Progreso de carga: ${t}%`,null,"info"),this.cdr.detectChanges()})},elementsCallback:t=>{if(!t||!Array.isArray(t)){this.logDebug("Elementos recibidos con formato incorrecto",t,"warn");return}let n=t.filter(o=>{if(!o)return!1;let r=o.position;return Array.isArray(r)&&r.length>=2||r&&typeof r=="object"&&(typeof r.lat=="number"&&typeof r.lng=="number"||Array.isArray(r.coordinates)&&r.coordinates.length>=2)?!0:(this.logDebug(`Elemento con posici\xF3n inv\xE1lida: ${o.id||"(sin ID)"} - Tipo: ${o.type}`,{positionType:r?typeof r:"undefined"},"debug"),!1)});n.length!==t.length&&this.logDebug(`Filtrados ${t.length-n.length} elementos con posiciones inv\xE1lidas`,null,"warn"),this.zone.run(()=>{this.renderElements(n),this.cdr.detectChanges()})}}).subscribe({next:t=>{let n=Math.round(performance.now()-e);this.zone.run(()=>{if(t&&t.success){let o=this.elementManager.getAllElements&&typeof this.elementManager.getAllElements=="function"?this.elementManager.getAllElements():[];this.elements=o,this.performanceService&&typeof this.performanceService.startMonitoring=="function"&&this.performanceService.startMonitoring(),this.refreshMap(),this.logDebug(`Carga de elementos completada con \xE9xito en ${n}ms`,{elementsCount:this.elements.length,loadTimeMs:n},"info"),setTimeout(()=>this.finishLoading(),100)}else this.errorMessage="Error al cargar elementos",this.mapError.emit(this.errorMessage),this.logDebug("Error en la carga de elementos",t,"error"),this.finishLoading()})},error:t=>{let n=Math.round(performance.now()-e);this.zone.run(()=>{this.handleError(t,"Error al cargar el mapa");let o=t?.message||"Error desconocido";this.errorMessage=`Error al cargar el mapa: ${o}`,this.mapError.emit(this.errorMessage),this.logDebug(`Error de carga despu\xE9s de ${n}ms`,t,"error"),this.finishLoading()})}})}catch(e){this.zone.run(()=>{this.handleError(e,"Error al iniciar la carga del mapa");let t=e?.message||"Inicializaci\xF3n fallida";this.errorMessage=`Error al iniciar la carga: ${t}`,this.mapError.emit(this.errorMessage),this.logDebug("Error cr\xEDtico al iniciar la carga del mapa",e,"error"),this.finishLoading()})}},100)}finishLoading(){this.zone.run(()=>{this.isLoading=!1,this.elements.length===0&&this.addSampleElements(),this.cdr.markForCheck(),this.mapLoaded.emit(),setTimeout(()=>this.cdr.detectChanges(),0)})}addSampleElements(){this.logDebug("Agregando elementos de muestra al mapa");try{let e=[{id:"sample-olt-1",type:"OLT",name:"OLT Muestra 1",position:en.origin(),status:"ACTIVE"},{id:"sample-splitter-1",type:"SPLITTER",name:"Splitter Muestra 1",position:en.santo_domingo(),status:"ACTIVE"},{id:"sample-splitter-2",type:"SPLITTER",name:"Splitter Muestra 2",position:en.domincanRepublic(),status:"ACTIVE"},{id:"sample-fdp-1",type:"FDP",name:"FDP Muestra 1",position:en.santo_domingo(),status:"ACTIVE"},{id:"sample-fdp-2",type:"FDP",name:"FDP Muestra 2",position:en.domincanRepublic(),status:"ACTIVE"},{id:"sample-ont-1",type:"ONT",name:"ONT Muestra 1",position:en.santo_domingo(),status:"ACTIVE"},{id:"sample-ont-2",type:"ONT",name:"ONT Muestra 2",position:en.domincanRepublic(),status:"ACTIVE"}],t=[{id:"sample-conn-1",name:"Conexi\xF3n 1",sourceElementId:"sample-olt-1",targetElementId:"sample-splitter-1",type:"FIBER",status:"ACTIVE"},{id:"sample-conn-2",name:"Conexi\xF3n 2",sourceElementId:"sample-olt-1",targetElementId:"sample-splitter-2",type:"FIBER",status:"ACTIVE"},{id:"sample-conn-3",name:"Conexi\xF3n 3",sourceElementId:"sample-splitter-1",targetElementId:"sample-fdp-1",type:"FIBER",status:"ACTIVE"},{id:"sample-conn-4",name:"Conexi\xF3n 4",sourceElementId:"sample-splitter-2",targetElementId:"sample-fdp-2",type:"FIBER",status:"ACTIVE"},{id:"sample-conn-5",name:"Conexi\xF3n 5",sourceElementId:"sample-fdp-1",targetElementId:"sample-ont-1",type:"FIBER",status:"ACTIVE"},{id:"sample-conn-6",name:"Conexi\xF3n 6",sourceElementId:"sample-fdp-2",targetElementId:"sample-ont-2",type:"FIBER",status:"ACTIVE"}];if(this.elements=e,this.connections=t,this._activeLayers=["OLT","SPLITTER","FDP","ONT"],this.renderElements(this.elements),this.renderConnections(),this.elements.length>0){let n=this.elements[0].position;n&&typeof n=="object"&&n.lat!==void 0&&n.lng!==void 0&&this.centerMap([n.lng,n.lat])}}catch(e){this.logDebug("Error al agregar elementos de muestra",e,"error")}}refreshMap(){if(!this.mapSvgEl){this.logDebug("No se puede refrescar el mapa: elemento SVG no disponible",null,"warn");return}let e=this.elements.filter(t=>this.activeLayers.includes(t.type));this.renderElements(e),this.updateSelectionIndicators(),this.performanceService&&typeof this.performanceService.registerMapUpdate=="function"&&this.performanceService.registerMapUpdate({elementsCount:e.length,timestamp:Date.now(),visibleLayers:this.activeLayers}),this.cdr.markForCheck()}renderElements(e){if(!this.mapSvgEl||!this.mapSvgEl.nativeElement){this.logDebug("No se pueden renderizar elementos: elemento SVG no disponible",null,"warn");return}try{let n=this.mapSvgEl.nativeElement.querySelector(".elements-layer");if(!n){this.logDebug("No se encuentra la capa para elementos",null,"warn");return}for(;n.firstChild;)n.removeChild(n.firstChild);this.elementManager&&this.renderConnections(),this.logDebug(`Renderizando ${e.length} elementos en el mapa`,null,"info");let o=0;e.forEach(r=>{let a=0,c=0;if(Array.isArray(r.position)&&r.position.length>=2)[a,c]=r.position;else if(r.position&&typeof r.position=="object")if(typeof r.position.lat=="number"&&typeof r.position.lng=="number")a=r.position.lng*100,c=r.position.lat*100;else if(Array.isArray(r.position.coordinates)&&r.position.coordinates.length>=2)a=r.position.coordinates[0]*100,c=r.position.coordinates[1]*100;else{this.logDebug(`Elemento con formato de posici\xF3n no soportado: ${r.id||"(sin ID)"}`);return}else{this.logDebug(`Elemento sin posici\xF3n v\xE1lida: ${r.id||"(sin ID)"}`);return}let m=document.createElementNS("http://www.w3.org/2000/svg","g");m.setAttribute("class",`network-element element-type-${r.type}`),m.setAttribute("data-element-id",r.id||""),m.setAttribute("data-element-type",r.type),m.setAttribute("transform",`translate(${a}, ${c})`);let g=this.createElementShape(r);if(m.appendChild(g),r.name){let h=document.createElementNS("http://www.w3.org/2000/svg","text");h.setAttribute("x","0"),h.setAttribute("y","20"),h.setAttribute("text-anchor","middle"),h.setAttribute("fill",this.isDarkMode?"#ffffff":"#333333"),h.setAttribute("font-size","10"),h.setAttribute("class","element-label"),h.textContent=r.name||"",m.appendChild(h)}m.addEventListener("mousedown",h=>{h.stopPropagation(),this.tool==="select"&&this.selectElement(r)}),n.appendChild(m),o++}),this.logDebug(`Elementos renderizados con \xE9xito: ${o} de ${e.length}`),o===0&&e.length>0&&this.logDebug("No se pudo renderizar ning\xFAn elemento aunque la lista no est\xE1 vac\xEDa",{elementsSample:e.slice(0,3)},"warn"),o>0&&this.panOffset.x===0&&this.panOffset.y===0&&this.centerMap([0,0])}catch(t){this.logDebug("Error al renderizar elementos",t,"error")}}createElementShape(e){let t;switch(e.type){case"OLT":t=document.createElementNS("http://www.w3.org/2000/svg","rect"),t.setAttribute("x","-10"),t.setAttribute("y","-10"),t.setAttribute("width","20"),t.setAttribute("height","20"),t.setAttribute("rx","3"),t.setAttribute("fill","#4CAF50");break;case"ONT":t=document.createElementNS("http://www.w3.org/2000/svg","circle"),t.setAttribute("cx","0"),t.setAttribute("cy","0"),t.setAttribute("r","8"),t.setAttribute("fill","#F44336");break;case"SPLITTER":t=document.createElementNS("http://www.w3.org/2000/svg","polygon"),t.setAttribute("points","0,-8 8,0 0,8 -8,0"),t.setAttribute("fill","#FF9800");break;default:t=document.createElementNS("http://www.w3.org/2000/svg","circle"),t.setAttribute("cx","0"),t.setAttribute("cy","0"),t.setAttribute("r","6"),t.setAttribute("fill","#9E9E9E")}return t.setAttribute("stroke","#333"),t.setAttribute("stroke-width","1"),t}renderConnections(){if(!this.mapSvgEl||!this.mapSvgEl.nativeElement){this.logDebug("No se pueden renderizar conexiones: elemento SVG no disponible",null,"warn");return}try{let t=this.mapSvgEl.nativeElement.querySelector(".connections-layer");if(!t){this.logDebug("No se encuentra la capa de conexiones",null,"warn");return}for(;t.firstChild;)t.removeChild(t.firstChild);let n=[];this.connectionService&&typeof this.connectionService.getConnections=="function"?(n=this.connectionService.getConnections(),this.logDebug(`Obtenidas ${n.length} conexiones del servicio MapConnectionService`)):(this.logDebug("MapConnectionService no disponible, buscando en ElementManager",null,"info"),this.elementManager&&typeof this.elementManager.getConnections=="function"?(n=this.elementManager.getConnections()||[],this.logDebug(`Obtenidas ${n.length} conexiones de ElementManager`)):(this.logDebug("M\xE9todo getConnections no disponible, usando alternativa",null,"warn"),n=this.connections));let o=n.filter(r=>{if(!r.sourceElementId||!r.targetElementId)return!1;let a=this.elements.find(m=>m.id===r.sourceElementId),c=this.elements.find(m=>m.id===r.targetElementId);return!a||!c?!1:this.activeLayers.includes(a.type)&&this.activeLayers.includes(c.type)});this.connections=n,this.logDebug(`Renderizando ${o.length} conexiones visibles de ${n.length} totales`),o.forEach(r=>{let a=this.elements.find(z=>z.id===r.sourceElementId),c=this.elements.find(z=>z.id===r.targetElementId);if(!a?.position||!c?.position)return;let m=0,g=0;if(Array.isArray(a.position)&&a.position.length>=2)[m,g]=a.position;else if(a.position&&typeof a.position=="object")if(typeof a.position.lat=="number"&&typeof a.position.lng=="number")m=a.position.lng*100,g=a.position.lat*100;else if(Array.isArray(a.position.coordinates)&&a.position.coordinates.length>=2)m=a.position.coordinates[0]*100,g=a.position.coordinates[1]*100;else return;else return;let h=0,v=0;if(Array.isArray(c.position)&&c.position.length>=2)[h,v]=c.position;else if(c.position&&typeof c.position=="object")if(typeof c.position.lat=="number"&&typeof c.position.lng=="number")h=c.position.lng*100,v=c.position.lat*100;else if(Array.isArray(c.position.coordinates)&&c.position.coordinates.length>=2)h=c.position.coordinates[0]*100,v=c.position.coordinates[1]*100;else return;else return;let w=document.createElementNS("http://www.w3.org/2000/svg","line");w.setAttribute("x1",m.toString()),w.setAttribute("y1",g.toString()),w.setAttribute("x2",h.toString()),w.setAttribute("y2",v.toString());let T=r.status||"unknown",x,S=String(T);S==="active"||S==="ACTIVE"?x="#4CAF50":S==="inactive"||S==="INACTIVE"?x="#F44336":S==="warning"||S==="WARNING"||S==="degraded"||S==="DEGRADED"?x="#FF9800":x="#9E9E9E",w.setAttribute("stroke",x),w.setAttribute("stroke-width","2"),w.setAttribute("class",`connection-line connection-status-${T}`),w.setAttribute("data-connection-id",r.id||""),w.setAttribute("data-source-id",r.sourceElementId),w.setAttribute("data-target-id",r.targetElementId),w.addEventListener("mousedown",z=>{z.stopPropagation(),this.tool==="select"&&this.selectConnection(r)}),t.appendChild(w)})}catch(e){this.logDebug("Error al renderizar conexiones",e,"error")}}selectElement(e){this.selectedElement=e,this.selectedConnection=null,this.updateSelectionIndicators(),this.elementSelected.emit(e),this.cdr.markForCheck()}selectConnection(e){this.selectedConnection=e,this.selectedElement=null,this.updateSelectionIndicators(),this.connectionSelected.emit(e),this.cdr.markForCheck()}updateSelectionIndicators(){if(!(!this.mapSvgEl||!this.mapSvgEl.nativeElement))try{let t=this.mapSvgEl.nativeElement.querySelector(".selection-layer");if(!t){this.logDebug("No se encuentra la capa de selecci\xF3n",null,"warn");return}for(;t.firstChild;)t.removeChild(t.firstChild);this.selectedElement?this.createElementSelectionIndicator(t,this.selectedElement):this.selectedConnection&&this.createConnectionSelectionIndicator(t,this.selectedConnection)}catch(e){this.logDebug("Error al actualizar indicadores de selecci\xF3n",e,"error")}}createElementSelectionIndicator(e,t){if(!t.position||!Array.isArray(t.position)||t.position.length<2)return;let n=t.position[0],o=t.position[1],r=document.createElementNS("http://www.w3.org/2000/svg","circle");r.setAttribute("cx",n.toString()),r.setAttribute("cy",o.toString()),r.setAttribute("r","16"),r.setAttribute("fill","none"),r.setAttribute("stroke","#1976d2"),r.setAttribute("stroke-width","2"),r.setAttribute("stroke-dasharray","4,2"),r.setAttribute("class","selection-indicator pulse-effect");let a=document.createElementNS("http://www.w3.org/2000/svg","animate");a.setAttribute("attributeName","r"),a.setAttribute("from","16"),a.setAttribute("to","18"),a.setAttribute("dur","1s"),a.setAttribute("repeatCount","indefinite"),a.setAttribute("values","16;18;16"),a.setAttribute("keyTimes","0;0.5;1"),r.appendChild(a),e.appendChild(r)}createConnectionSelectionIndicator(e,t){let n=this.elements.find(v=>v.id===t.sourceElementId),o=this.elements.find(v=>v.id===t.targetElementId);if(!n?.position||!o?.position||!Array.isArray(n.position)||n.position.length<2||!Array.isArray(o.position)||o.position.length<2)return;let r=n.position[0],a=n.position[1],c=o.position[0],m=o.position[1],g=document.createElementNS("http://www.w3.org/2000/svg","line");g.setAttribute("x1",r.toString()),g.setAttribute("y1",a.toString()),g.setAttribute("x2",c.toString()),g.setAttribute("y2",m.toString()),g.setAttribute("stroke","#1976d2"),g.setAttribute("stroke-width","4"),g.setAttribute("stroke-dasharray","6,3"),g.setAttribute("class","selection-indicator");let h=document.createElementNS("http://www.w3.org/2000/svg","animate");h.setAttribute("attributeName","stroke-dashoffset"),h.setAttribute("from","0"),h.setAttribute("to","12"),h.setAttribute("dur","1s"),h.setAttribute("repeatCount","indefinite"),g.appendChild(h),e.appendChild(g)}updateCursor(){if(!this.mapContainerEl)return;let e=this.mapContainerEl.nativeElement;switch(this.tool){case"pan":e.style.cursor=this.isDragging?"grabbing":"grab";break;case"select":e.style.cursor="pointer";break;case"measure":e.style.cursor="crosshair";break;case"connect":e.style.cursor="cell";break;default:e.style.cursor="default"}}applyTheme(){this.cdr.markForCheck()}onMouseDown(e){e.button===0&&(this.isDragging=this.tool==="pan",this.dragStart={x:e.clientX,y:e.clientY},this.lastPanOffset=O({},this.panOffset),this.updateCursor(),e.preventDefault())}onMouseMove(e){let t=this.mapSvgEl.nativeElement.getBoundingClientRect(),n={x:e.clientX-t.left,y:e.clientY-t.top};this.cursorPositionChanged.emit(n),this.isDragging&&(this.panOffset={x:this.lastPanOffset.x+(e.clientX-this.dragStart.x),y:this.lastPanOffset.y+(e.clientY-this.dragStart.y)},this.cdr.markForCheck())}onMouseUp(e){this.isDragging=!1,this.updateCursor()}onWheel(e){e.preventDefault();let t=e.deltaY<0?1:-1,o=Math.max(.1,Math.min(3,this.zoomScale+t*.1));this.zoomScale=o;let r=Math.round(o*100);this.zoomChanged.emit(r),this.cdr.markForCheck()}retryLoading(){this.errorMessage=null,this.loadElements()}setZoomLevel(e){this.zoomScale=e/100,this.cdr.markForCheck()}zoomIn(){let e=Math.min(3,this.zoomScale+.1);this.zoomScale=e,this.zoomChanged.emit(Math.round(e*100)),this.cdr.markForCheck()}zoomOut(){let e=Math.max(.1,this.zoomScale-.1);this.zoomScale=e,this.zoomChanged.emit(Math.round(e*100)),this.cdr.markForCheck()}fitToScreen(){this.zoomScale=1,this.panOffset={x:0,y:0},this.zoomChanged.emit(100),this.cdr.markForCheck()}centerMap(e){if(!this.mapContainerEl||!this.mapContainerEl.nativeElement){this.logger.warn("Contenedor del mapa no disponible para centrar.");return}let t=this.width/2,n=this.height/2;this.panOffset={x:t-e[0]*this.zoomScale,y:n-e[1]*this.zoomScale},this.lastPanOffset=O({},this.panOffset),this.refreshMap(),this.logger.debug(`Mapa centrado en [${e[0]}, ${e[1]}] con panOffset:`,this.panOffset),this.cdr.markForCheck()}static \u0275fac=function(t){return new(t||i)(I(jt))};static \u0275cmp=q({type:i,selectors:[["app-map-view"]],viewQuery:function(t,n){if(t&1&&(lt(Uu,7),lt(Hu,7)),t&2){let o;ct(o=dt())&&(n.mapContainerEl=o.first),ct(o=dt())&&(n.mapSvgEl=o.first)}},inputs:{activeLayers:"activeLayers",tool:"tool",darkMode:"darkMode",loading:"loading"},outputs:{elementSelected:"elementSelected",connectionSelected:"connectionSelected",zoomChanged:"zoomChanged",mapError:"mapError",mapLoaded:"mapLoaded",cursorPositionChanged:"cursorPositionChanged",measurementComplete:"measurementComplete"},features:[ln],decls:11,vars:19,consts:[["mapContainer",""],["mapSvg",""],["tabindex","0",1,"map-view-container",3,"mousedown","mousemove","mouseup","wheel"],["class","loading-overlay fade-in",4,"ngIf"],["class","error-message fade-in",4,"ngIf"],[1,"svg-wrapper"],[1,"map-svg","fade-in"],[1,"grid-container"],[1,"connections-layer"],[1,"elements-layer"],[1,"selection-layer"],[1,"loading-overlay","fade-in"],[3,"diameter"],[1,"error-message","fade-in"],[1,"retry-btn",3,"click"]],template:function(t,n){if(t&1){let o=F();s(0,"div",2,0),C("mousedown",function(a){return _(o),b(n.onMouseDown(a))})("mousemove",function(a){return _(o),b(n.onMouseMove(a))})("mouseup",function(a){return _(o),b(n.onMouseUp(a))})("wheel",function(a){return _(o),b(n.onWheel(a))}),y(2,Gu,4,1,"div",3)(3,Wu,5,1,"div",4),s(4,"div",5),Xs(),s(5,"svg",6,1),D(7,"g",7)(8,"g",8)(9,"g",9)(10,"g",10),l()()()}t&2&&(K("dark-mode",n.isDarkMode)("loading",n.isLoading)("dragging",n.isDragging)("has-error",!!n.errorMessage),p(2),u("ngIf",n.isLoading),p(),u("ngIf",n.errorMessage),p(2),K("interactive",!n.isLoading&&!n.errorMessage)("has-selection",!!n.selectedElement||!!n.selectedConnection),Ce("width",n.width)("height",n.height),p(2),Ce("transform","translate("+n.panOffset.x+","+n.panOffset.y+") scale("+n.zoomScale+")"),p(),Ce("transform","translate("+n.panOffset.x+","+n.panOffset.y+") scale("+n.zoomScale+")"),p(),Ce("transform","translate("+n.panOffset.x+","+n.panOffset.y+") scale("+n.zoomScale+")"))},dependencies:[X,ie,mt,Wt],styles:['@charset "UTF-8";[_ngcontent-%COMP%]:root{--primary-color: #3F51B5;--primary-rgb: 63, 81, 181;--primary-color-hover: rgb(52.4655737705, 67.4557377049, 150.7344262295);--accent-color: #FF4081;--warn-color: #F44336;--background-color: #F5F5F5;--surface-color: #ffffff;--surface-lighter: #f9f9f9;--surface-darker: #eeeeee;--text-color: #212121;--text-secondary-color: hsl(0, 0%, -12.0588235294%);--text-hint-color: hsl(0, 0%, -32.0588235294%);--text-disabled-color: hsl(0, 0%, -52.0588235294%);--primary-contrast-color: white;--accent-contrast-color: white;--warn-contrast-color: white;--olt-color: #4CAF50;--ont-color: #2196F3;--odf-color: #FFC107;--edfa-color: #9C27B0;--splitter-color: #FF5722;--manga-color: #607D8B;--terminal-box-color: #FF9800;--slack-fiber-color: #80DEEA;--spacing-unit: 4px;--spacing-xxs: .125rem;--spacing-xs: .25rem;--spacing-sm: .5rem;--spacing-md: .75rem;--spacing-lg: 1rem;--spacing-xl: 1.5rem;--spacing-xxl: 2rem;--shadow-xs: 0 1px 2px rgba(0,0,0,.05);--shadow-sm: 0 1px 3px rgba(0, 0, 0, .1);--shadow-md: 0 2px 4px rgba(0, 0, 0, .1);--shadow-lg: 0 4px 6px rgba(0, 0, 0, .1);--border-radius-sm: 2px;--border-radius-md: 4px;--border-radius-lg: 8px;--border-radius-round: 50%;--border-color: #e0e0e0;--border-width-normal: 1px;--border-width-strong: 4px;--border-radius-pill: 20px;--border-color-light: rgb(249.5, 249.5, 249.5);--border-color-dark: rgb(198.5, 198.5, 198.5);--color-success: #4caf50;--color-warning: #ff8f00;--color-danger: #c62828;--color-info: #2196F3;--color-neutral: #9e9e9e;--color-success-bg: #e8f5e9;--color-warning-bg: #fff8e1;--color-danger-bg: #ffebee;--color-info-bg: rgb(226.5384615385, 241.5384615385, 253.4615384615);--color-maintenance-bg: #e3f2fd;--status-inactive-fg: #757575;--status-inactive-bg: #f5f5f5;--color-success-contrast: white;--color-warning-contrast: white;--color-danger-contrast: white;--color-info-contrast: #212121;--color-maintenance-contrast: white;--font-family: "Roboto, Segoe UI, sans-serif";--font-size-xxs: .625rem;--font-size-xs: .75rem;--font-size-sm: .875rem;--font-size-md: 1rem;--font-size-lg: 1.125rem;--font-size-xl: 1.25rem;--font-size-xxl: 1.5rem;--font-size-display: 2.5rem;--transition-fast: .15s ease-in-out;--transition-normal: .3s ease-in-out;--transition-slow: .5s ease-in-out;--status-active: #4caf50;--status-inactive: #757575;--status-maintenance: #1565c0;--status-planning: #2196F3;--status-unknown: var(--color-neutral);--status-fault: #c62828;--surface-overlay-light: rgba(255, 255, 255, .85);--surface-overlay-light-strong: rgba(255, 255, 255, .95);--border-color-semitransparent: rgba(0, 0, 0, .1);--primary-bg-subtle: rgba(63, 81, 181, .15);--surface-action-hover: rgb(242.8571428571, 242.8571428571, 242.8571428571);--surface-button: var(--surface-color);--surface-button-hover: var(--surface-action-hover);--text-color-button: var(--text-color);--scrollbar-track-color: #f1f1f1;--scrollbar-thumb-color: #c1c1c1;--scrollbar-thumb-hover-color: #a8a8a8;--z-index-map-base: 1;--z-index-map-elements: 5;--z-index-map-widgets-overlay: 50;--z-index-map-overlay: 100;--z-index-network-design-panels: 900;--z-index-debug-info: 999;--z-index-floating-panel-base: 1000;--z-index-performance-widget: 1000;--z-index-elements-panel: 1001;--z-index-layer-control: 1001;--z-index-sidebar: 1005;--z-index-map-legend: 1005;--z-index-sidebar-mobile: 1010;--z-index-loading-overlay: 1050;--z-index-dialog: 1075;--z-index-toolbar: 1100;--z-index-tooltip: 1150;--z-index-map-controls: 1201;--toolbar-height: 46px;--toolbar-button-height: 30px;--toolbar-button-height-mobile: 32px;--action-button-height: 40px;--menu-item-height: 42px;--icon-size-sm: 18px;--icon-size-md: 20px;--tooltip-bg-color: rgba(33, 33, 33, .95);--primary-ripple-color: rgba(var(--primary-rgb), .1)}[_ngcontent-%COMP%]:root.dark-theme, body.dark-theme[_ngcontent-%COMP%]{--background-color: #121212;--surface-color: #1e1e1e;--surface-lighter: rgb(42.75, 42.75, 42.75);--surface-darker: #121212;--text-color: #e0e0e0;--text-secondary-color: rgb(185.75, 185.75, 185.75);--text-hint-color: rgb(147.5, 147.5, 147.5);--text-disabled-color: rgb(109.25, 109.25, 109.25);--border-color: #444444;--border-color-light: rgb(93.5, 93.5, 93.5);--border-color-dark: rgb(42.5, 42.5, 42.5);--color-success-bg: rgb(51.8181818182, 119.1818181818, 57);--color-warning-bg: rgb(174, 133.4, 0);--color-danger-bg: rgb(184, 0, 27.6);--color-info-bg: rgb(8.9230769231, 95.9230769231, 165.0769230769);--color-maintenance-bg: rgb(11.6, 98.6, 162.4);--shadow-xs: 0 1px 2px rgba(0,0,0,.3);--shadow-sm: 0 1px 3px rgba(0,0,0,.4);--shadow-md: 0 2px 4px rgba(0,0,0,.5);--shadow-lg: 0 4px 6px rgba(0,0,0,.5);--surface-overlay-light: rgba(40, 40, 40, .85);--surface-overlay-light-strong: rgba(30, 30, 30, .95);--border-color-semitransparent: rgba(255, 255, 255, .1);--status-inactive-fg: hsl(0, 0%, 100.8823529412%);--status-inactive-bg: #383838;--primary-bg-subtle: rgba(63, 81, 181, .25);--surface-action-hover: rgb(55.5, 55.5, 55.5);--surface-button: var(--surface-color);--surface-button-hover: var(--surface-action-hover);--text-color-button: var(--text-color);--scrollbar-track-color: #333333;--scrollbar-thumb-color: #666666;--scrollbar-thumb-hover-color: #888888}.standard-panel-ui[_ngcontent-%COMP%]{background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-lg);overflow:hidden;display:flex;flex-direction:column}.standard-panel-ui[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-md);background-color:var(--surface-lighter);border-bottom:1px solid var(--border-color)}.standard-panel-ui[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:var(--font-size-md);font-weight:500;color:var(--text-color)}.standard-panel-ui[_ngcontent-%COMP%]   .panel-content[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-content[_ngcontent-%COMP%]{padding:var(--spacing-md);flex-grow:1;overflow-y:auto;color:var(--text-color)}.standard-panel-ui[_ngcontent-%COMP%]   .panel-actions[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:var(--spacing-sm);padding:var(--spacing-sm) var(--spacing-md);border-top:1px solid var(--border-color)}.standard-panel-ui[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]{display:flex;margin-bottom:var(--spacing-sm)}.standard-panel-ui[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]   .info-label[_ngcontent-%COMP%]{width:100px;font-weight:500;color:var(--text-secondary-color)}.standard-panel-ui[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]   .info-value[_ngcontent-%COMP%]{flex:1;color:var(--text-color)}.simple-panel-ui[_ngcontent-%COMP%]{background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-lg);padding:var(--spacing-md);color:var(--text-color)}.side-panel[_ngcontent-%COMP%]{background-color:var(--surface-color);border-radius:var(--border-radius-sm, 4px);box-shadow:var(--shadow-sm, 0 2px 10px rgba(0, 0, 0, .08));height:100%;width:var(--side-panel-width, 320px);display:flex;flex-direction:column;overflow:hidden}@media (max-width: 768px){.side-panel[_ngcontent-%COMP%]{width:var(--side-panel-width-tablet, 280px)}}@media (max-width: 600px){.side-panel[_ngcontent-%COMP%]{width:var(--side-panel-width-mobile, 100%);max-width:100vw}}.side-panel[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%]{height:var(--panel-header-height, 44px);min-height:var(--panel-header-height, 44px);display:flex;align-items:center;justify-content:space-between;padding:0 var(--spacing-sm);border-bottom:1px solid var(--border-color, rgba(0, 0, 0, .1))}.side-panel[_ngcontent-%COMP%]   .panel-content[_ngcontent-%COMP%]{flex:1;overflow:auto}.map-base-container[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;overflow:hidden;background-color:var(--background-color);transition:background-color var(--transition-normal)}.network-design[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}.network-design__toolbar[_ngcontent-%COMP%]{padding:0 var(--spacing-md);background-color:var(--primary-color);color:var(--primary-contrast-color);box-shadow:var(--shadow-md)}.network-design__header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-md);background-color:var(--primary-color);color:var(--primary-contrast-color);box-shadow:var(--shadow-md)}.network-design__header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:var(--font-size-xl);font-weight:500}.network-design__main[_ngcontent-%COMP%]{flex:1;display:flex;overflow:hidden;position:relative;padding:var(--spacing-md);background-color:var(--surface-color)}@media (max-width: 768px){.network-design__main[_ngcontent-%COMP%]{margin-left:0;padding:var(--spacing-sm)}}.network-design__main[_ngcontent-%COMP%]   .network-design__map[_ngcontent-%COMP%]{flex:1;position:relative;border-radius:var(--border-radius-md);overflow:hidden;box-shadow:var(--shadow-md);background-color:var(--surface-darker)}.network-design__main[_ngcontent-%COMP%]   .network-design__sidebar[_ngcontent-%COMP%]{width:300px;padding:var(--spacing-md);background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-md);margin-left:var(--spacing-md);overflow-y:auto;border-right:1px solid var(--border-color)}@media (max-width: 768px){.network-design__main[_ngcontent-%COMP%]   .network-design__sidebar[_ngcontent-%COMP%]{width:100%;position:fixed;top:0;left:0;height:100%;z-index:1000;transform:translate(-100%);transition:transform var(--transition-normal);margin-left:0;border-right:none}.network-design__main[_ngcontent-%COMP%]   .network-design__sidebar--open[_ngcontent-%COMP%]{transform:translate(0)}}.network-design__footer[_ngcontent-%COMP%]{padding:var(--spacing-md);background-color:var(--surface-lighter);border-top:1px solid var(--border-color);font-size:var(--font-size-sm);color:var(--text-color)}.network-design__element[_ngcontent-%COMP%]{padding:var(--spacing-md);margin-bottom:var(--spacing-md);background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-sm);transition:box-shadow var(--transition-fast)}.network-design__element[_ngcontent-%COMP%]:hover{box-shadow:var(--shadow-md)}.network-design__element--selected[_ngcontent-%COMP%]{border-left:4px solid var(--primary-color)}.status-badge-base[_ngcontent-%COMP%], .status-maintenance[_ngcontent-%COMP%], .status-warning[_ngcontent-%COMP%], .status-fault[_ngcontent-%COMP%], .status-inactive[_ngcontent-%COMP%], .status-active[_ngcontent-%COMP%]{display:inline-block;padding:var(--spacing-xs) var(--spacing-sm);border-radius:var(--border-radius-sm);font-size:var(--font-size-sm);font-weight:500}.status-active[_ngcontent-%COMP%]{background-color:var(--color-success-bg);color:var(--color-success-contrast)}.status-inactive[_ngcontent-%COMP%]{background-color:var(--status-inactive-bg);color:var(--status-inactive-fg)}.status-fault[_ngcontent-%COMP%]{background-color:var(--color-danger-bg);color:var(--color-danger-contrast)}.status-warning[_ngcontent-%COMP%]{background-color:var(--color-warning-bg);color:var(--color-warning-contrast)}.status-maintenance[_ngcontent-%COMP%]{background-color:var(--color-maintenance-bg);color:var(--color-maintenance-contrast)}.network-utils__status-badge[_ngcontent-%COMP%]{display:inline-block;padding:var(--spacing-xs) var(--spacing-sm);border-radius:var(--border-radius-sm);font-size:var(--font-size-xs);font-weight:500;text-transform:uppercase}.network-utils__status-badge--active[_ngcontent-%COMP%]{background-color:var(--color-success-bg);color:var(--color-success-contrast)}.network-utils__status-badge--inactive[_ngcontent-%COMP%]{background-color:var(--status-inactive-bg);color:var(--status-inactive-fg)}.network-utils__status-badge--maintenance[_ngcontent-%COMP%]{background-color:var(--color-maintenance-bg);color:var(--color-maintenance-contrast)}.network-utils__loading[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:var(--spacing-lg);color:var(--text-color)}.network-utils__error[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-md);background-color:#ffebee;color:var(--color-danger);border-radius:var(--border-radius-md)}.map-view-container[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;overflow:hidden;background-color:var(--surface-level-1, #f5f5f5);cursor:grab;display:block!important}.map-view-container.loading[_ngcontent-%COMP%]{cursor:wait}.map-view-container.dragging[_ngcontent-%COMP%]{cursor:grabbing}.svg-wrapper[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;top:0;left:0;overflow:hidden;display:block!important}.map-svg[_ngcontent-%COMP%]{width:100%;height:100%;display:block!important;position:absolute;top:0;left:0;touch-action:none;z-index:1;background-color:#fff}.loading-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;background-color:var(--surface-overlay-light, rgba(255, 255, 255, .7));z-index:10;opacity:0;transition:opacity var(--transition-normal, .3s) ease-out,z-index 0s var(--transition-normal, .3s);pointer-events:none}.map-view-container.loading[_ngcontent-%COMP%]   .loading-overlay[_ngcontent-%COMP%]{opacity:1;z-index:10;transition:opacity var(--transition-normal, .3s) ease-in;pointer-events:all}.error-message[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);padding:var(--spacing-lg, 20px);background-color:var(--color-danger-bg-strong, rgba(244, 67, 54, .9));color:var(--color-danger-contrast, white);border-radius:var(--border-radius-md, 4px);text-align:center;z-index:11}.error-message[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:var(--spacing-sm, 10px);padding:var(--spacing-xs, 8px) var(--spacing-md, 16px);background-color:var(--surface-color, white);color:var(--color-danger, #f44336);border:none;border-radius:var(--border-radius-md, 4px);cursor:pointer}.grid-container[_ngcontent-%COMP%]   line[_ngcontent-%COMP%]{stroke:var(--grid-line-color, #aaa);stroke-width:1;opacity:.7}.grid-container[_ngcontent-%COMP%]   .grid-axis[_ngcontent-%COMP%]{stroke:var(--grid-axis-color, #666);stroke-width:2;opacity:.9}.connections-layer[_ngcontent-%COMP%]   path[_ngcontent-%COMP%], .connections-layer[_ngcontent-%COMP%]   line[_ngcontent-%COMP%]{stroke-width:var(--connection-stroke-width, 3);fill:none;opacity:.8}.elements-layer[_ngcontent-%COMP%]   circle[_ngcontent-%COMP%], .elements-layer[_ngcontent-%COMP%]   rect[_ngcontent-%COMP%], .elements-layer[_ngcontent-%COMP%]   polygon[_ngcontent-%COMP%]{stroke:var(--element-stroke-color, #333);stroke-width:var(--element-stroke-width, 1.5);fill-opacity:.9}.selection-layer[_ngcontent-%COMP%]   .selection-indicator[_ngcontent-%COMP%]{stroke:var(--selection-highlight-color, #2196F3);stroke-width:var(--selection-stroke-width, 3);stroke-dasharray:5;fill:none;opacity:1}.fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-in-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.pulse-effect[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse 1.5s infinite}@keyframes _ngcontent-%COMP%_pulse{0%{transform:scale(1);opacity:1}50%{transform:scale(1.05);opacity:.8}to{transform:scale(1);opacity:1}}[_nghost-%COMP%]{display:block!important;width:100%;height:100%;position:relative}[_nghost-%COMP%]   .elements-layer[_ngcontent-%COMP%]   .network-element[_ngcontent-%COMP%]{cursor:pointer;transition:transform .2s ease-in-out}[_nghost-%COMP%]   .elements-layer[_ngcontent-%COMP%]   .network-element[_ngcontent-%COMP%]:hover{transform:scale(1.1)}[_nghost-%COMP%]   .connections-layer[_ngcontent-%COMP%]   .connection-line[_ngcontent-%COMP%]{stroke-width:3;transition:stroke-width .2s ease-in-out}[_nghost-%COMP%]   .connections-layer[_ngcontent-%COMP%]   .connection-line[_ngcontent-%COMP%]:hover{stroke-width:4}'],changeDetection:0})};function yd(i){let e=i.cloneNode(!0),t=e.querySelectorAll("[id]"),n=i.nodeName.toLowerCase();e.removeAttribute("id");for(let o=0;o<t.length;o++)t[o].removeAttribute("id");return n==="canvas"?dd(i,e):(n==="input"||n==="select"||n==="textarea")&&cd(i,e),ld("canvas",i,e,dd),ld("input, textarea, select",i,e,cd),e}function ld(i,e,t,n){let o=e.querySelectorAll(i);if(o.length){let r=t.querySelectorAll(i);for(let a=0;a<o.length;a++)n(o[a],r[a])}}var Ku=0;function cd(i,e){e.type!=="file"&&(e.value=i.value),e.type==="radio"&&e.name&&(e.name=`mat-clone-${e.name}-${Ku++}`)}function dd(i,e){let t=e.getContext("2d");if(t)try{t.drawImage(i,0,0)}catch{}}function Na(i){let e=i.getBoundingClientRect();return{top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.width,height:e.height,x:e.x,y:e.y}}function Pa(i,e,t){let{top:n,bottom:o,left:r,right:a}=i;return t>=n&&t<=o&&e>=r&&e<=a}function Pi(i,e,t){i.top+=e,i.bottom=i.top+i.height,i.left+=t,i.right=i.left+i.width}function pd(i,e,t,n){let{top:o,right:r,bottom:a,left:c,width:m,height:g}=i,h=m*e,v=g*e;return n>o-v&&n<a+v&&t>c-h&&t<r+h}var Go=class{_document;positions=new Map;constructor(e){this._document=e}clear(){this.positions.clear()}cache(e){this.clear(),this.positions.set(this._document,{scrollPosition:this.getViewportScrollPosition()}),e.forEach(t=>{this.positions.set(t,{scrollPosition:{top:t.scrollTop,left:t.scrollLeft},clientRect:Na(t)})})}handleScroll(e){let t=fi(e),n=this.positions.get(t);if(!n)return null;let o=n.scrollPosition,r,a;if(t===this._document){let g=this.getViewportScrollPosition();r=g.top,a=g.left}else r=t.scrollTop,a=t.scrollLeft;let c=o.top-r,m=o.left-a;return this.positions.forEach((g,h)=>{g.clientRect&&t!==h&&t.contains(h)&&Pi(g.clientRect,c,m)}),o.top=r,o.left=a,{top:c,left:m}}getViewportScrollPosition(){return{top:window.scrollY,left:window.scrollX}}};function Ed(i,e){let t=i.rootNodes;if(t.length===1&&t[0].nodeType===e.ELEMENT_NODE)return t[0];let n=e.createElement("div");return t.forEach(o=>n.appendChild(o)),n}function Ra(i,e,t){for(let n in e)if(e.hasOwnProperty(n)){let o=e[n];o?i.setProperty(n,o,t?.has(n)?"important":""):i.removeProperty(n)}return i}function ni(i,e){let t=e?"":"none";Ra(i.style,{"touch-action":e?"":"none","-webkit-user-drag":e?"":"none","-webkit-tap-highlight-color":e?"":"transparent","user-select":t,"-ms-user-select":t,"-webkit-user-select":t,"-moz-user-select":t})}function md(i,e,t){Ra(i.style,{position:e?"":"fixed",top:e?"":"0",opacity:e?"":"0",left:e?"":"-999em"},t)}function Wo(i,e){return e&&e!="none"?i+" "+e:i}function gd(i,e){i.style.width=`${e.width}px`,i.style.height=`${e.height}px`,i.style.transform=Ko(e.left,e.top)}function Ko(i,e){return`translate3d(${Math.round(i)}px, ${Math.round(e)}px, 0)`}function ud(i){let e=i.toLowerCase().indexOf("ms")>-1?1:1e3;return parseFloat(i)*e}function qu(i){let e=getComputedStyle(i),t=Ma(e,"transition-property"),n=t.find(c=>c==="transform"||c==="all");if(!n)return 0;let o=t.indexOf(n),r=Ma(e,"transition-duration"),a=Ma(e,"transition-delay");return ud(r[o])+ud(a[o])}function Ma(i,e){return i.getPropertyValue(e).split(",").map(n=>n.trim())}var Qu=new Set(["position"]),Oa=class{_document;_rootElement;_direction;_initialDomRect;_previewTemplate;_previewClass;_pickupPositionOnPage;_initialTransform;_zIndex;_renderer;_previewEmbeddedView;_preview;get element(){return this._preview}constructor(e,t,n,o,r,a,c,m,g,h){this._document=e,this._rootElement=t,this._direction=n,this._initialDomRect=o,this._previewTemplate=r,this._previewClass=a,this._pickupPositionOnPage=c,this._initialTransform=m,this._zIndex=g,this._renderer=h}attach(e){this._preview=this._createPreview(),e.appendChild(this._preview),hd(this._preview)&&this._preview.showPopover()}destroy(){this._preview.remove(),this._previewEmbeddedView?.destroy(),this._preview=this._previewEmbeddedView=null}setTransform(e){this._preview.style.transform=e}getBoundingClientRect(){return this._preview.getBoundingClientRect()}addClass(e){this._preview.classList.add(e)}getTransitionDuration(){return qu(this._preview)}addEventListener(e,t){return this._renderer.listen(this._preview,e,t)}_createPreview(){let e=this._previewTemplate,t=this._previewClass,n=e?e.template:null,o;if(n&&e){let r=e.matchSize?this._initialDomRect:null,a=e.viewContainer.createEmbeddedView(n,e.context);a.detectChanges(),o=Ed(a,this._document),this._previewEmbeddedView=a,e.matchSize?gd(o,r):o.style.transform=Ko(this._pickupPositionOnPage.x,this._pickupPositionOnPage.y)}else o=yd(this._rootElement),gd(o,this._initialDomRect),this._initialTransform&&(o.style.transform=this._initialTransform);return Ra(o.style,{"pointer-events":"none",margin:hd(o)?"0 auto 0 0":"0",position:"fixed",top:"0",left:"0","z-index":this._zIndex+""},Qu),ni(o,!1),o.classList.add("cdk-drag-preview"),o.setAttribute("popover","manual"),o.setAttribute("dir",this._direction),t&&(Array.isArray(t)?t.forEach(r=>o.classList.add(r)):o.classList.add(t)),o}};function hd(i){return"showPopover"in i}var Zu={passive:!0},fd={passive:!1},Yu={passive:!1,capture:!0},Xu=800,vd=new Set(["position"]),ka=class{_config;_document;_ngZone;_viewportRuler;_dragDropRegistry;_renderer;_rootElementCleanups;_cleanupShadowRootSelectStart;_preview;_previewContainer;_placeholderRef;_placeholder;_pickupPositionInElement;_pickupPositionOnPage;_anchor;_passiveTransform={x:0,y:0};_activeTransform={x:0,y:0};_initialTransform;_hasStartedDragging=Ve(!1);_hasMoved;_initialContainer;_initialIndex;_parentPositions;_moveEvents=new N;_pointerDirectionDelta;_pointerPositionAtLastDirectionChange;_lastKnownPointerPosition;_rootElement;_ownerSVGElement;_rootElementTapHighlight;_pointerMoveSubscription=$t.EMPTY;_pointerUpSubscription=$t.EMPTY;_scrollSubscription=$t.EMPTY;_resizeSubscription=$t.EMPTY;_lastTouchEventTime;_dragStartTime;_boundaryElement=null;_nativeInteractionsEnabled=!0;_initialDomRect;_previewRect;_boundaryRect;_previewTemplate;_placeholderTemplate;_handles=[];_disabledHandles=new Set;_dropContainer;_direction="ltr";_parentDragRef;_cachedShadowRoot;lockAxis;dragStartDelay=0;previewClass;scale=1;get disabled(){return this._disabled||!!(this._dropContainer&&this._dropContainer.disabled)}set disabled(e){e!==this._disabled&&(this._disabled=e,this._toggleNativeDragInteractions(),this._handles.forEach(t=>ni(t,e)))}_disabled=!1;beforeStarted=new N;started=new N;released=new N;ended=new N;entered=new N;exited=new N;dropped=new N;moved=this._moveEvents;data;constrainPosition;constructor(e,t,n,o,r,a,c){this._config=t,this._document=n,this._ngZone=o,this._viewportRuler=r,this._dragDropRegistry=a,this._renderer=c,this.withRootElement(e).withParent(t.parentDragRef||null),this._parentPositions=new Go(n),a.registerDragItem(this)}getPlaceholderElement(){return this._placeholder}getRootElement(){return this._rootElement}getVisibleElement(){return this.isDragging()?this.getPlaceholderElement():this.getRootElement()}withHandles(e){this._handles=e.map(n=>Gt(n)),this._handles.forEach(n=>ni(n,this.disabled)),this._toggleNativeDragInteractions();let t=new Set;return this._disabledHandles.forEach(n=>{this._handles.indexOf(n)>-1&&t.add(n)}),this._disabledHandles=t,this}withPreviewTemplate(e){return this._previewTemplate=e,this}withPlaceholderTemplate(e){return this._placeholderTemplate=e,this}withRootElement(e){let t=Gt(e);return t!==this._rootElement&&(this._removeRootElementListeners(),this._rootElementCleanups=this._ngZone.runOutsideAngular(()=>[Ht(this._renderer,t,"mousedown",this._pointerDown,fd),Ht(this._renderer,t,"touchstart",this._pointerDown,Zu),Ht(this._renderer,t,"dragstart",this._nativeDragStart,fd)]),this._initialTransform=void 0,this._rootElement=t),typeof SVGElement<"u"&&this._rootElement instanceof SVGElement&&(this._ownerSVGElement=this._rootElement.ownerSVGElement),this}withBoundaryElement(e){return this._boundaryElement=e?Gt(e):null,this._resizeSubscription.unsubscribe(),e&&(this._resizeSubscription=this._viewportRuler.change(10).subscribe(()=>this._containInsideBoundaryOnResize())),this}withParent(e){return this._parentDragRef=e,this}dispose(){this._removeRootElementListeners(),this.isDragging()&&this._rootElement?.remove(),this._anchor?.remove(),this._destroyPreview(),this._destroyPlaceholder(),this._dragDropRegistry.removeDragItem(this),this._removeListeners(),this.beforeStarted.complete(),this.started.complete(),this.released.complete(),this.ended.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this._moveEvents.complete(),this._handles=[],this._disabledHandles.clear(),this._dropContainer=void 0,this._resizeSubscription.unsubscribe(),this._parentPositions.clear(),this._boundaryElement=this._rootElement=this._ownerSVGElement=this._placeholderTemplate=this._previewTemplate=this._anchor=this._parentDragRef=null}isDragging(){return this._hasStartedDragging()&&this._dragDropRegistry.isDragging(this)}reset(){this._rootElement.style.transform=this._initialTransform||"",this._activeTransform={x:0,y:0},this._passiveTransform={x:0,y:0}}disableHandle(e){!this._disabledHandles.has(e)&&this._handles.indexOf(e)>-1&&(this._disabledHandles.add(e),ni(e,!0))}enableHandle(e){this._disabledHandles.has(e)&&(this._disabledHandles.delete(e),ni(e,this.disabled))}withDirection(e){return this._direction=e,this}_withDropContainer(e){this._dropContainer=e}getFreeDragPosition(){let e=this.isDragging()?this._activeTransform:this._passiveTransform;return{x:e.x,y:e.y}}setFreeDragPosition(e){return this._activeTransform={x:0,y:0},this._passiveTransform.x=e.x,this._passiveTransform.y=e.y,this._dropContainer||this._applyRootElementTransform(e.x,e.y),this}withPreviewContainer(e){return this._previewContainer=e,this}_sortFromLastPointerPosition(){let e=this._lastKnownPointerPosition;e&&this._dropContainer&&this._updateActiveDropContainer(this._getConstrainedPointerPosition(e),e)}_removeListeners(){this._pointerMoveSubscription.unsubscribe(),this._pointerUpSubscription.unsubscribe(),this._scrollSubscription.unsubscribe(),this._cleanupShadowRootSelectStart?.(),this._cleanupShadowRootSelectStart=void 0}_destroyPreview(){this._preview?.destroy(),this._preview=null}_destroyPlaceholder(){this._placeholder?.remove(),this._placeholderRef?.destroy(),this._placeholder=this._placeholderRef=null}_pointerDown=e=>{if(this.beforeStarted.next(),this._handles.length){let t=this._getTargetHandle(e);t&&!this._disabledHandles.has(t)&&!this.disabled&&this._initializeDragSequence(t,e)}else this.disabled||this._initializeDragSequence(this._rootElement,e)};_pointerMove=e=>{let t=this._getPointerPositionOnPage(e);if(!this._hasStartedDragging()){let o=Math.abs(t.x-this._pickupPositionOnPage.x),r=Math.abs(t.y-this._pickupPositionOnPage.y);if(o+r>=this._config.dragStartThreshold){let c=Date.now()>=this._dragStartTime+this._getDragStartDelay(e),m=this._dropContainer;if(!c){this._endDragSequence(e);return}(!m||!m.isDragging()&&!m.isReceiving())&&(e.cancelable&&e.preventDefault(),this._hasStartedDragging.set(!0),this._ngZone.run(()=>this._startDragSequence(e)))}return}e.cancelable&&e.preventDefault();let n=this._getConstrainedPointerPosition(t);if(this._hasMoved=!0,this._lastKnownPointerPosition=t,this._updatePointerDirectionDelta(n),this._dropContainer)this._updateActiveDropContainer(n,t);else{let o=this.constrainPosition?this._initialDomRect:this._pickupPositionOnPage,r=this._activeTransform;r.x=n.x-o.x+this._passiveTransform.x,r.y=n.y-o.y+this._passiveTransform.y,this._applyRootElementTransform(r.x,r.y)}this._moveEvents.observers.length&&this._ngZone.run(()=>{this._moveEvents.next({source:this,pointerPosition:n,event:e,distance:this._getDragDistance(n),delta:this._pointerDirectionDelta})})};_pointerUp=e=>{this._endDragSequence(e)};_endDragSequence(e){if(this._dragDropRegistry.isDragging(this)&&(this._removeListeners(),this._dragDropRegistry.stopDragging(this),this._toggleNativeDragInteractions(),this._handles&&(this._rootElement.style.webkitTapHighlightColor=this._rootElementTapHighlight),!!this._hasStartedDragging()))if(this.released.next({source:this,event:e}),this._dropContainer)this._dropContainer._stopScrolling(),this._animatePreviewToPlaceholder().then(()=>{this._cleanupDragArtifacts(e),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)});else{this._passiveTransform.x=this._activeTransform.x;let t=this._getPointerPositionOnPage(e);this._passiveTransform.y=this._activeTransform.y,this._ngZone.run(()=>{this.ended.next({source:this,distance:this._getDragDistance(t),dropPoint:t,event:e})}),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)}}_startDragSequence(e){Mi(e)&&(this._lastTouchEventTime=Date.now()),this._toggleNativeDragInteractions();let t=this._getShadowRoot(),n=this._dropContainer;if(t&&this._ngZone.runOutsideAngular(()=>{this._cleanupShadowRootSelectStart=Ht(this._renderer,t,"selectstart",Ju,Yu)}),n){let o=this._rootElement,r=o.parentNode,a=this._placeholder=this._createPlaceholderElement(),c=this._anchor=this._anchor||this._document.createComment("");r.insertBefore(c,o),this._initialTransform=o.style.transform||"",this._preview=new Oa(this._document,this._rootElement,this._direction,this._initialDomRect,this._previewTemplate||null,this.previewClass||null,this._pickupPositionOnPage,this._initialTransform,this._config.zIndex||1e3,this._renderer),this._preview.attach(this._getPreviewInsertionPoint(r,t)),md(o,!1,vd),this._document.body.appendChild(r.replaceChild(a,o)),this.started.next({source:this,event:e}),n.start(),this._initialContainer=n,this._initialIndex=n.getItemIndex(this)}else this.started.next({source:this,event:e}),this._initialContainer=this._initialIndex=void 0;this._parentPositions.cache(n?n.getScrollableParents():[])}_initializeDragSequence(e,t){this._parentDragRef&&t.stopPropagation();let n=this.isDragging(),o=Mi(t),r=!o&&t.button!==0,a=this._rootElement,c=fi(t),m=!o&&this._lastTouchEventTime&&this._lastTouchEventTime+Xu>Date.now(),g=o?xl(t):wl(t);if(c&&c.draggable&&t.type==="mousedown"&&t.preventDefault(),n||r||m||g)return;if(this._handles.length){let w=a.style;this._rootElementTapHighlight=w.webkitTapHighlightColor||"",w.webkitTapHighlightColor="transparent"}this._hasMoved=!1,this._hasStartedDragging.set(this._hasMoved),this._removeListeners(),this._initialDomRect=this._rootElement.getBoundingClientRect(),this._pointerMoveSubscription=this._dragDropRegistry.pointerMove.subscribe(this._pointerMove),this._pointerUpSubscription=this._dragDropRegistry.pointerUp.subscribe(this._pointerUp),this._scrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(w=>this._updateOnScroll(w)),this._boundaryElement&&(this._boundaryRect=Na(this._boundaryElement));let h=this._previewTemplate;this._pickupPositionInElement=h&&h.template&&!h.matchSize?{x:0,y:0}:this._getPointerPositionInElement(this._initialDomRect,e,t);let v=this._pickupPositionOnPage=this._lastKnownPointerPosition=this._getPointerPositionOnPage(t);this._pointerDirectionDelta={x:0,y:0},this._pointerPositionAtLastDirectionChange={x:v.x,y:v.y},this._dragStartTime=Date.now(),this._dragDropRegistry.startDragging(this,t)}_cleanupDragArtifacts(e){md(this._rootElement,!0,vd),this._anchor.parentNode.replaceChild(this._rootElement,this._anchor),this._destroyPreview(),this._destroyPlaceholder(),this._initialDomRect=this._boundaryRect=this._previewRect=this._initialTransform=void 0,this._ngZone.run(()=>{let t=this._dropContainer,n=t.getItemIndex(this),o=this._getPointerPositionOnPage(e),r=this._getDragDistance(o),a=t._isOverContainer(o.x,o.y);this.ended.next({source:this,distance:r,dropPoint:o,event:e}),this.dropped.next({item:this,currentIndex:n,previousIndex:this._initialIndex,container:t,previousContainer:this._initialContainer,isPointerOverContainer:a,distance:r,dropPoint:o,event:e}),t.drop(this,n,this._initialIndex,this._initialContainer,a,r,o,e),this._dropContainer=this._initialContainer})}_updateActiveDropContainer({x:e,y:t},{x:n,y:o}){let r=this._initialContainer._getSiblingContainerFromPosition(this,e,t);!r&&this._dropContainer!==this._initialContainer&&this._initialContainer._isOverContainer(e,t)&&(r=this._initialContainer),r&&r!==this._dropContainer&&this._ngZone.run(()=>{this.exited.next({item:this,container:this._dropContainer}),this._dropContainer.exit(this),this._dropContainer=r,this._dropContainer.enter(this,e,t,r===this._initialContainer&&r.sortingDisabled?this._initialIndex:void 0),this.entered.next({item:this,container:r,currentIndex:r.getItemIndex(this)})}),this.isDragging()&&(this._dropContainer._startScrollingIfNecessary(n,o),this._dropContainer._sortItem(this,e,t,this._pointerDirectionDelta),this.constrainPosition?this._applyPreviewTransform(e,t):this._applyPreviewTransform(e-this._pickupPositionInElement.x,t-this._pickupPositionInElement.y))}_animatePreviewToPlaceholder(){if(!this._hasMoved)return Promise.resolve();let e=this._placeholder.getBoundingClientRect();this._preview.addClass("cdk-drag-animating"),this._applyPreviewTransform(e.left,e.top);let t=this._preview.getTransitionDuration();return t===0?Promise.resolve():this._ngZone.runOutsideAngular(()=>new Promise(n=>{let o=c=>{(!c||this._preview&&fi(c)===this._preview.element&&c.propertyName==="transform")&&(a(),n(),clearTimeout(r))},r=setTimeout(o,t*1.5),a=this._preview.addEventListener("transitionend",o)}))}_createPlaceholderElement(){let e=this._placeholderTemplate,t=e?e.template:null,n;return t?(this._placeholderRef=e.viewContainer.createEmbeddedView(t,e.context),this._placeholderRef.detectChanges(),n=Ed(this._placeholderRef,this._document)):n=yd(this._rootElement),n.style.pointerEvents="none",n.classList.add("cdk-drag-placeholder"),n}_getPointerPositionInElement(e,t,n){let o=t===this._rootElement?null:t,r=o?o.getBoundingClientRect():e,a=Mi(n)?n.targetTouches[0]:n,c=this._getViewportScrollPosition(),m=a.pageX-r.left-c.left,g=a.pageY-r.top-c.top;return{x:r.left-e.left+m,y:r.top-e.top+g}}_getPointerPositionOnPage(e){let t=this._getViewportScrollPosition(),n=Mi(e)?e.touches[0]||e.changedTouches[0]||{pageX:0,pageY:0}:e,o=n.pageX-t.left,r=n.pageY-t.top;if(this._ownerSVGElement){let a=this._ownerSVGElement.getScreenCTM();if(a){let c=this._ownerSVGElement.createSVGPoint();return c.x=o,c.y=r,c.matrixTransform(a.inverse())}}return{x:o,y:r}}_getConstrainedPointerPosition(e){let t=this._dropContainer?this._dropContainer.lockAxis:null,{x:n,y:o}=this.constrainPosition?this.constrainPosition(e,this,this._initialDomRect,this._pickupPositionInElement):e;if(this.lockAxis==="x"||t==="x"?o=this._pickupPositionOnPage.y-(this.constrainPosition?this._pickupPositionInElement.y:0):(this.lockAxis==="y"||t==="y")&&(n=this._pickupPositionOnPage.x-(this.constrainPosition?this._pickupPositionInElement.x:0)),this._boundaryRect){let{x:r,y:a}=this.constrainPosition?{x:0,y:0}:this._pickupPositionInElement,c=this._boundaryRect,{width:m,height:g}=this._getPreviewRect(),h=c.top+a,v=c.bottom-(g-a),w=c.left+r,T=c.right-(m-r);n=_d(n,w,T),o=_d(o,h,v)}return{x:n,y:o}}_updatePointerDirectionDelta(e){let{x:t,y:n}=e,o=this._pointerDirectionDelta,r=this._pointerPositionAtLastDirectionChange,a=Math.abs(t-r.x),c=Math.abs(n-r.y);return a>this._config.pointerDirectionChangeThreshold&&(o.x=t>r.x?1:-1,r.x=t),c>this._config.pointerDirectionChangeThreshold&&(o.y=n>r.y?1:-1,r.y=n),o}_toggleNativeDragInteractions(){if(!this._rootElement||!this._handles)return;let e=this._handles.length>0||!this.isDragging();e!==this._nativeInteractionsEnabled&&(this._nativeInteractionsEnabled=e,ni(this._rootElement,e))}_removeRootElementListeners(){this._rootElementCleanups?.forEach(e=>e()),this._rootElementCleanups=void 0}_applyRootElementTransform(e,t){let n=1/this.scale,o=Ko(e*n,t*n),r=this._rootElement.style;this._initialTransform==null&&(this._initialTransform=r.transform&&r.transform!="none"?r.transform:""),r.transform=Wo(o,this._initialTransform)}_applyPreviewTransform(e,t){let n=this._previewTemplate?.template?void 0:this._initialTransform,o=Ko(e,t);this._preview.setTransform(Wo(o,n))}_getDragDistance(e){let t=this._pickupPositionOnPage;return t?{x:e.x-t.x,y:e.y-t.y}:{x:0,y:0}}_cleanupCachedDimensions(){this._boundaryRect=this._previewRect=void 0,this._parentPositions.clear()}_containInsideBoundaryOnResize(){let{x:e,y:t}=this._passiveTransform;if(e===0&&t===0||this.isDragging()||!this._boundaryElement)return;let n=this._rootElement.getBoundingClientRect(),o=this._boundaryElement.getBoundingClientRect();if(o.width===0&&o.height===0||n.width===0&&n.height===0)return;let r=o.left-n.left,a=n.right-o.right,c=o.top-n.top,m=n.bottom-o.bottom;o.width>n.width?(r>0&&(e+=r),a>0&&(e-=a)):e=0,o.height>n.height?(c>0&&(t+=c),m>0&&(t-=m)):t=0,(e!==this._passiveTransform.x||t!==this._passiveTransform.y)&&this.setFreeDragPosition({y:t,x:e})}_getDragStartDelay(e){let t=this.dragStartDelay;return typeof t=="number"?t:Mi(e)?t.touch:t?t.mouse:0}_updateOnScroll(e){let t=this._parentPositions.handleScroll(e);if(t){let n=fi(e);this._boundaryRect&&n!==this._boundaryElement&&n.contains(this._boundaryElement)&&Pi(this._boundaryRect,t.top,t.left),this._pickupPositionOnPage.x+=t.left,this._pickupPositionOnPage.y+=t.top,this._dropContainer||(this._activeTransform.x-=t.left,this._activeTransform.y-=t.top,this._applyRootElementTransform(this._activeTransform.x,this._activeTransform.y))}}_getViewportScrollPosition(){return this._parentPositions.positions.get(this._document)?.scrollPosition||this._parentPositions.getViewportScrollPosition()}_getShadowRoot(){return this._cachedShadowRoot===void 0&&(this._cachedShadowRoot=Qi(this._rootElement)),this._cachedShadowRoot}_getPreviewInsertionPoint(e,t){let n=this._previewContainer||"global";if(n==="parent")return e;if(n==="global"){let o=this._document;return t||o.fullscreenElement||o.webkitFullscreenElement||o.mozFullScreenElement||o.msFullscreenElement||o.body}return Gt(n)}_getPreviewRect(){return(!this._previewRect||!this._previewRect.width&&!this._previewRect.height)&&(this._previewRect=this._preview?this._preview.getBoundingClientRect():this._initialDomRect),this._previewRect}_nativeDragStart=e=>{if(this._handles.length){let t=this._getTargetHandle(e);t&&!this._disabledHandles.has(t)&&!this.disabled&&e.preventDefault()}else this.disabled||e.preventDefault()};_getTargetHandle(e){return this._handles.find(t=>e.target&&(e.target===t||t.contains(e.target)))}};function _d(i,e,t){return Math.max(e,Math.min(t,i))}function Mi(i){return i.type[0]==="t"}function Ju(i){i.preventDefault()}function Qo(i,e,t){let n=bd(e,i.length-1),o=bd(t,i.length-1);if(n===o)return;let r=i[n],a=o<n?-1:1;for(let c=n;c!==o;c+=a)i[c]=i[c+a];i[o]=r}function bd(i,e){return Math.max(0,Math.min(e,i))}var qo=class{_dragDropRegistry;_element;_sortPredicate;_itemPositions=[];_activeDraggables;orientation="vertical";direction;constructor(e){this._dragDropRegistry=e}_previousSwap={drag:null,delta:0,overlaps:!1};start(e){this.withItems(e)}sort(e,t,n,o){let r=this._itemPositions,a=this._getItemIndexFromPointerPosition(e,t,n,o);if(a===-1&&r.length>0)return null;let c=this.orientation==="horizontal",m=r.findIndex(z=>z.drag===e),g=r[a],h=r[m].clientRect,v=g.clientRect,w=m>a?1:-1,T=this._getItemOffsetPx(h,v,w),x=this._getSiblingOffsetPx(m,r,w),S=r.slice();return Qo(r,m,a),r.forEach((z,Q)=>{if(S[Q]===z)return;let ne=z.drag===e,re=ne?T:x,H=ne?e.getPlaceholderElement():z.drag.getRootElement();z.offset+=re;let oe=Math.round(z.offset*(1/z.drag.scale));c?(H.style.transform=Wo(`translate3d(${oe}px, 0, 0)`,z.initialTransform),Pi(z.clientRect,0,re)):(H.style.transform=Wo(`translate3d(0, ${oe}px, 0)`,z.initialTransform),Pi(z.clientRect,re,0))}),this._previousSwap.overlaps=Pa(v,t,n),this._previousSwap.drag=g.drag,this._previousSwap.delta=c?o.x:o.y,{previousIndex:m,currentIndex:a}}enter(e,t,n,o){let r=o==null||o<0?this._getItemIndexFromPointerPosition(e,t,n):o,a=this._activeDraggables,c=a.indexOf(e),m=e.getPlaceholderElement(),g=a[r];if(g===e&&(g=a[r+1]),!g&&(r==null||r===-1||r<a.length-1)&&this._shouldEnterAsFirstChild(t,n)&&(g=a[0]),c>-1&&a.splice(c,1),g&&!this._dragDropRegistry.isDragging(g)){let h=g.getRootElement();h.parentElement.insertBefore(m,h),a.splice(r,0,e)}else this._element.appendChild(m),a.push(e);m.style.transform="",this._cacheItemPositions()}withItems(e){this._activeDraggables=e.slice(),this._cacheItemPositions()}withSortPredicate(e){this._sortPredicate=e}reset(){this._activeDraggables?.forEach(e=>{let t=e.getRootElement();if(t){let n=this._itemPositions.find(o=>o.drag===e)?.initialTransform;t.style.transform=n||""}}),this._itemPositions=[],this._activeDraggables=[],this._previousSwap.drag=null,this._previousSwap.delta=0,this._previousSwap.overlaps=!1}getActiveItemsSnapshot(){return this._activeDraggables}getItemIndex(e){return(this.orientation==="horizontal"&&this.direction==="rtl"?this._itemPositions.slice().reverse():this._itemPositions).findIndex(n=>n.drag===e)}updateOnScroll(e,t){this._itemPositions.forEach(({clientRect:n})=>{Pi(n,e,t)}),this._itemPositions.forEach(({drag:n})=>{this._dragDropRegistry.isDragging(n)&&n._sortFromLastPointerPosition()})}withElementContainer(e){this._element=e}_cacheItemPositions(){let e=this.orientation==="horizontal";this._itemPositions=this._activeDraggables.map(t=>{let n=t.getVisibleElement();return{drag:t,offset:0,initialTransform:n.style.transform||"",clientRect:Na(n)}}).sort((t,n)=>e?t.clientRect.left-n.clientRect.left:t.clientRect.top-n.clientRect.top)}_getItemOffsetPx(e,t,n){let o=this.orientation==="horizontal",r=o?t.left-e.left:t.top-e.top;return n===-1&&(r+=o?t.width-e.width:t.height-e.height),r}_getSiblingOffsetPx(e,t,n){let o=this.orientation==="horizontal",r=t[e].clientRect,a=t[e+n*-1],c=r[o?"width":"height"]*n;if(a){let m=o?"left":"top",g=o?"right":"bottom";n===-1?c-=a.clientRect[m]-r[g]:c+=r[m]-a.clientRect[g]}return c}_shouldEnterAsFirstChild(e,t){if(!this._activeDraggables.length)return!1;let n=this._itemPositions,o=this.orientation==="horizontal";if(n[0].drag!==this._activeDraggables[0]){let a=n[n.length-1].clientRect;return o?e>=a.right:t>=a.bottom}else{let a=n[0].clientRect;return o?e<=a.left:t<=a.top}}_getItemIndexFromPointerPosition(e,t,n,o){let r=this.orientation==="horizontal",a=this._itemPositions.findIndex(({drag:c,clientRect:m})=>{if(c===e)return!1;if(o){let g=r?o.x:o.y;if(c===this._previousSwap.drag&&this._previousSwap.overlaps&&g===this._previousSwap.delta)return!1}return r?t>=Math.floor(m.left)&&t<Math.floor(m.right):n>=Math.floor(m.top)&&n<Math.floor(m.bottom)});return a===-1||!this._sortPredicate(a,e)?-1:a}},Da=class{_document;_dragDropRegistry;_element;_sortPredicate;_rootNode;_activeItems;_previousSwap={drag:null,deltaX:0,deltaY:0,overlaps:!1};_relatedNodes=[];constructor(e,t){this._document=e,this._dragDropRegistry=t}start(e){let t=this._element.childNodes;this._relatedNodes=[];for(let n=0;n<t.length;n++){let o=t[n];this._relatedNodes.push([o,o.nextSibling])}this.withItems(e)}sort(e,t,n,o){let r=this._getItemIndexFromPointerPosition(e,t,n),a=this._previousSwap;if(r===-1||this._activeItems[r]===e)return null;let c=this._activeItems[r];if(a.drag===c&&a.overlaps&&a.deltaX===o.x&&a.deltaY===o.y)return null;let m=this.getItemIndex(e),g=e.getPlaceholderElement(),h=c.getRootElement();r>m?h.after(g):h.before(g),Qo(this._activeItems,m,r);let v=this._getRootNode().elementFromPoint(t,n);return a.deltaX=o.x,a.deltaY=o.y,a.drag=c,a.overlaps=h===v||h.contains(v),{previousIndex:m,currentIndex:r}}enter(e,t,n,o){let r=o==null||o<0?this._getItemIndexFromPointerPosition(e,t,n):o;r===-1&&(r=this._getClosestItemIndexToPointer(e,t,n));let a=this._activeItems[r],c=this._activeItems.indexOf(e);c>-1&&this._activeItems.splice(c,1),a&&!this._dragDropRegistry.isDragging(a)?(this._activeItems.splice(r,0,e),a.getRootElement().before(e.getPlaceholderElement())):(this._activeItems.push(e),this._element.appendChild(e.getPlaceholderElement()))}withItems(e){this._activeItems=e.slice()}withSortPredicate(e){this._sortPredicate=e}reset(){let e=this._element,t=this._previousSwap;for(let n=this._relatedNodes.length-1;n>-1;n--){let[o,r]=this._relatedNodes[n];o.parentNode===e&&o.nextSibling!==r&&(r===null?e.appendChild(o):r.parentNode===e&&e.insertBefore(o,r))}this._relatedNodes=[],this._activeItems=[],t.drag=null,t.deltaX=t.deltaY=0,t.overlaps=!1}getActiveItemsSnapshot(){return this._activeItems}getItemIndex(e){return this._activeItems.indexOf(e)}updateOnScroll(){this._activeItems.forEach(e=>{this._dragDropRegistry.isDragging(e)&&e._sortFromLastPointerPosition()})}withElementContainer(e){e!==this._element&&(this._element=e,this._rootNode=void 0)}_getItemIndexFromPointerPosition(e,t,n){let o=this._getRootNode().elementFromPoint(Math.floor(t),Math.floor(n)),r=o?this._activeItems.findIndex(a=>{let c=a.getRootElement();return o===c||c.contains(o)}):-1;return r===-1||!this._sortPredicate(r,e)?-1:r}_getRootNode(){return this._rootNode||(this._rootNode=Qi(this._element)||this._document),this._rootNode}_getClosestItemIndexToPointer(e,t,n){if(this._activeItems.length===0)return-1;if(this._activeItems.length===1)return 0;let o=1/0,r=-1;for(let a=0;a<this._activeItems.length;a++){let c=this._activeItems[a];if(c!==e){let{x:m,y:g}=c.getRootElement().getBoundingClientRect(),h=Math.hypot(t-m,n-g);h<o&&(o=h,r=a)}}return r}},Cd=.05,wd=.05,ut=function(i){return i[i.NONE=0]="NONE",i[i.UP=1]="UP",i[i.DOWN=2]="DOWN",i}(ut||{}),qe=function(i){return i[i.NONE=0]="NONE",i[i.LEFT=1]="LEFT",i[i.RIGHT=2]="RIGHT",i}(qe||{}),Ia=class{_dragDropRegistry;_ngZone;_viewportRuler;element;disabled=!1;sortingDisabled=!1;lockAxis;autoScrollDisabled=!1;autoScrollStep=2;enterPredicate=()=>!0;sortPredicate=()=>!0;beforeStarted=new N;entered=new N;exited=new N;dropped=new N;sorted=new N;receivingStarted=new N;receivingStopped=new N;data;_container;_isDragging=!1;_parentPositions;_sortStrategy;_domRect;_draggables=[];_siblings=[];_activeSiblings=new Set;_viewportScrollSubscription=$t.EMPTY;_verticalScrollDirection=ut.NONE;_horizontalScrollDirection=qe.NONE;_scrollNode;_stopScrollTimers=new N;_cachedShadowRoot=null;_document;_scrollableElements=[];_initialScrollSnap;_direction="ltr";constructor(e,t,n,o,r){this._dragDropRegistry=t,this._ngZone=o,this._viewportRuler=r;let a=this.element=Gt(e);this._document=n,this.withOrientation("vertical").withElementContainer(a),t.registerDropContainer(this),this._parentPositions=new Go(n)}dispose(){this._stopScrolling(),this._stopScrollTimers.complete(),this._viewportScrollSubscription.unsubscribe(),this.beforeStarted.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this.sorted.complete(),this.receivingStarted.complete(),this.receivingStopped.complete(),this._activeSiblings.clear(),this._scrollNode=null,this._parentPositions.clear(),this._dragDropRegistry.removeDropContainer(this)}isDragging(){return this._isDragging}start(){this._draggingStarted(),this._notifyReceivingSiblings()}enter(e,t,n,o){this._draggingStarted(),o==null&&this.sortingDisabled&&(o=this._draggables.indexOf(e)),this._sortStrategy.enter(e,t,n,o),this._cacheParentPositions(),this._notifyReceivingSiblings(),this.entered.next({item:e,container:this,currentIndex:this.getItemIndex(e)})}exit(e){this._reset(),this.exited.next({item:e,container:this})}drop(e,t,n,o,r,a,c,m={}){this._reset(),this.dropped.next({item:e,currentIndex:t,previousIndex:n,container:this,previousContainer:o,isPointerOverContainer:r,distance:a,dropPoint:c,event:m})}withItems(e){let t=this._draggables;return this._draggables=e,e.forEach(n=>n._withDropContainer(this)),this.isDragging()&&(t.filter(o=>o.isDragging()).every(o=>e.indexOf(o)===-1)?this._reset():this._sortStrategy.withItems(this._draggables)),this}withDirection(e){return this._direction=e,this._sortStrategy instanceof qo&&(this._sortStrategy.direction=e),this}connectedTo(e){return this._siblings=e.slice(),this}withOrientation(e){if(e==="mixed")this._sortStrategy=new Da(this._document,this._dragDropRegistry);else{let t=new qo(this._dragDropRegistry);t.direction=this._direction,t.orientation=e,this._sortStrategy=t}return this._sortStrategy.withElementContainer(this._container),this._sortStrategy.withSortPredicate((t,n)=>this.sortPredicate(t,n,this)),this}withScrollableParents(e){let t=this._container;return this._scrollableElements=e.indexOf(t)===-1?[t,...e]:e.slice(),this}withElementContainer(e){if(e===this._container)return this;let t=Gt(this.element),n=this._scrollableElements.indexOf(this._container),o=this._scrollableElements.indexOf(e);return n>-1&&this._scrollableElements.splice(n,1),o>-1&&this._scrollableElements.splice(o,1),this._sortStrategy&&this._sortStrategy.withElementContainer(e),this._cachedShadowRoot=null,this._scrollableElements.unshift(e),this._container=e,this}getScrollableParents(){return this._scrollableElements}getItemIndex(e){return this._isDragging?this._sortStrategy.getItemIndex(e):this._draggables.indexOf(e)}isReceiving(){return this._activeSiblings.size>0}_sortItem(e,t,n,o){if(this.sortingDisabled||!this._domRect||!pd(this._domRect,Cd,t,n))return;let r=this._sortStrategy.sort(e,t,n,o);r&&this.sorted.next({previousIndex:r.previousIndex,currentIndex:r.currentIndex,container:this,item:e})}_startScrollingIfNecessary(e,t){if(this.autoScrollDisabled)return;let n,o=ut.NONE,r=qe.NONE;if(this._parentPositions.positions.forEach((a,c)=>{c===this._document||!a.clientRect||n||pd(a.clientRect,Cd,e,t)&&([o,r]=eh(c,a.clientRect,this._direction,e,t),(o||r)&&(n=c))}),!o&&!r){let{width:a,height:c}=this._viewportRuler.getViewportSize(),m={width:a,height:c,top:0,right:a,bottom:c,left:0};o=xd(m,t),r=Sd(m,e),n=window}n&&(o!==this._verticalScrollDirection||r!==this._horizontalScrollDirection||n!==this._scrollNode)&&(this._verticalScrollDirection=o,this._horizontalScrollDirection=r,this._scrollNode=n,(o||r)&&n?this._ngZone.runOutsideAngular(this._startScrollInterval):this._stopScrolling())}_stopScrolling(){this._stopScrollTimers.next()}_draggingStarted(){let e=this._container.style;this.beforeStarted.next(),this._isDragging=!0,this._initialScrollSnap=e.msScrollSnapType||e.scrollSnapType||"",e.scrollSnapType=e.msScrollSnapType="none",this._sortStrategy.start(this._draggables),this._cacheParentPositions(),this._viewportScrollSubscription.unsubscribe(),this._listenToScrollEvents()}_cacheParentPositions(){this._parentPositions.cache(this._scrollableElements),this._domRect=this._parentPositions.positions.get(this._container).clientRect}_reset(){this._isDragging=!1;let e=this._container.style;e.scrollSnapType=e.msScrollSnapType=this._initialScrollSnap,this._siblings.forEach(t=>t._stopReceiving(this)),this._sortStrategy.reset(),this._stopScrolling(),this._viewportScrollSubscription.unsubscribe(),this._parentPositions.clear()}_startScrollInterval=()=>{this._stopScrolling(),En(0,Ls).pipe(R(this._stopScrollTimers)).subscribe(()=>{let e=this._scrollNode,t=this.autoScrollStep;this._verticalScrollDirection===ut.UP?e.scrollBy(0,-t):this._verticalScrollDirection===ut.DOWN&&e.scrollBy(0,t),this._horizontalScrollDirection===qe.LEFT?e.scrollBy(-t,0):this._horizontalScrollDirection===qe.RIGHT&&e.scrollBy(t,0)})};_isOverContainer(e,t){return this._domRect!=null&&Pa(this._domRect,e,t)}_getSiblingContainerFromPosition(e,t,n){return this._siblings.find(o=>o._canReceive(e,t,n))}_canReceive(e,t,n){if(!this._domRect||!Pa(this._domRect,t,n)||!this.enterPredicate(e,this))return!1;let o=this._getShadowRoot().elementFromPoint(t,n);return o?o===this._container||this._container.contains(o):!1}_startReceiving(e,t){let n=this._activeSiblings;!n.has(e)&&t.every(o=>this.enterPredicate(o,this)||this._draggables.indexOf(o)>-1)&&(n.add(e),this._cacheParentPositions(),this._listenToScrollEvents(),this.receivingStarted.next({initiator:e,receiver:this,items:t}))}_stopReceiving(e){this._activeSiblings.delete(e),this._viewportScrollSubscription.unsubscribe(),this.receivingStopped.next({initiator:e,receiver:this})}_listenToScrollEvents(){this._viewportScrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(e=>{if(this.isDragging()){let t=this._parentPositions.handleScroll(e);t&&this._sortStrategy.updateOnScroll(t.top,t.left)}else this.isReceiving()&&this._cacheParentPositions()})}_getShadowRoot(){if(!this._cachedShadowRoot){let e=Qi(this._container);this._cachedShadowRoot=e||this._document}return this._cachedShadowRoot}_notifyReceivingSiblings(){let e=this._sortStrategy.getActiveItemsSnapshot().filter(t=>t.isDragging());this._siblings.forEach(t=>t._startReceiving(this,e))}};function xd(i,e){let{top:t,bottom:n,height:o}=i,r=o*wd;return e>=t-r&&e<=t+r?ut.UP:e>=n-r&&e<=n+r?ut.DOWN:ut.NONE}function Sd(i,e){let{left:t,right:n,width:o}=i,r=o*wd;return e>=t-r&&e<=t+r?qe.LEFT:e>=n-r&&e<=n+r?qe.RIGHT:qe.NONE}function eh(i,e,t,n,o){let r=xd(e,o),a=Sd(e,n),c=ut.NONE,m=qe.NONE;if(r){let g=i.scrollTop;r===ut.UP?g>0&&(c=ut.UP):i.scrollHeight-g>i.clientHeight&&(c=ut.DOWN)}if(a){let g=i.scrollLeft;t==="rtl"?a===qe.RIGHT?g<0&&(m=qe.RIGHT):i.scrollWidth+g>i.clientWidth&&(m=qe.LEFT):a===qe.LEFT?g>0&&(m=qe.LEFT):i.scrollWidth-g>i.clientWidth&&(m=qe.RIGHT)}return[c,m]}var Ti={capture:!0},Ta={passive:!1,capture:!0},th=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275cmp=q({type:i,selectors:[["ng-component"]],hostAttrs:["cdk-drag-resets-container",""],decls:0,vars:0,template:function(n,o){},styles:[`@layer cdk-resets{.cdk-drag-preview{background:none;border:none;padding:0;color:inherit;inset:auto}}.cdk-drag-placeholder *,.cdk-drag-preview *{pointer-events:none !important}
`],encapsulation:2,changeDetection:0})}return i})(),La=(()=>{class i{_ngZone=M(Qe);_document=M(hi);_styleLoader=M(Ml);_renderer=M(mi).createRenderer(null,null);_cleanupDocumentTouchmove;_dropInstances=new Set;_dragInstances=new Set;_activeDragInstances=Ve([]);_globalListeners;_draggingPredicate=t=>t.isDragging();_domNodesToDirectives=null;pointerMove=new N;pointerUp=new N;scroll=new N;constructor(){}registerDropContainer(t){this._dropInstances.has(t)||this._dropInstances.add(t)}registerDragItem(t){this._dragInstances.add(t),this._dragInstances.size===1&&this._ngZone.runOutsideAngular(()=>{this._cleanupDocumentTouchmove?.(),this._cleanupDocumentTouchmove=Ht(this._renderer,this._document,"touchmove",this._persistentTouchmoveListener,Ta)})}removeDropContainer(t){this._dropInstances.delete(t)}removeDragItem(t){this._dragInstances.delete(t),this.stopDragging(t),this._dragInstances.size===0&&this._cleanupDocumentTouchmove?.()}startDragging(t,n){if(!(this._activeDragInstances().indexOf(t)>-1)&&(this._styleLoader.load(th),this._activeDragInstances.update(o=>[...o,t]),this._activeDragInstances().length===1)){let o=n.type.startsWith("touch"),r=c=>this.pointerUp.next(c),a=[["scroll",c=>this.scroll.next(c),Ti],["selectstart",this._preventDefaultWhileDragging,Ta]];o?a.push(["touchend",r,Ti],["touchcancel",r,Ti]):a.push(["mouseup",r,Ti]),o||a.push(["mousemove",c=>this.pointerMove.next(c),Ta]),this._ngZone.runOutsideAngular(()=>{this._globalListeners=a.map(([c,m,g])=>Ht(this._renderer,this._document,c,m,g))})}}stopDragging(t){this._activeDragInstances.update(n=>{let o=n.indexOf(t);return o>-1?(n.splice(o,1),[...n]):n}),this._activeDragInstances().length===0&&this._clearGlobalListeners()}isDragging(t){return this._activeDragInstances().indexOf(t)>-1}scrolled(t){let n=[this.scroll];return t&&t!==this._document&&n.push(new Be(o=>this._ngZone.runOutsideAngular(()=>{let r=Ht(this._renderer,t,"scroll",a=>{this._activeDragInstances().length&&o.next(a)},Ti);return()=>{r()}}))),Rt(...n)}registerDirectiveNode(t,n){this._domNodesToDirectives??=new WeakMap,this._domNodesToDirectives.set(t,n)}removeDirectiveNode(t){this._domNodesToDirectives?.delete(t)}getDragDirectiveForNode(t){return this._domNodesToDirectives?.get(t)||null}ngOnDestroy(){this._dragInstances.forEach(t=>this.removeDragItem(t)),this._dropInstances.forEach(t=>this.removeDropContainer(t)),this._domNodesToDirectives=null,this._clearGlobalListeners(),this.pointerMove.complete(),this.pointerUp.complete()}_preventDefaultWhileDragging=t=>{this._activeDragInstances().length>0&&t.preventDefault()};_persistentTouchmoveListener=t=>{this._activeDragInstances().length>0&&(this._activeDragInstances().some(this._draggingPredicate)&&t.preventDefault(),this.pointerMove.next(t))};_clearGlobalListeners(){this._globalListeners?.forEach(t=>t()),this._globalListeners=void 0}static \u0275fac=function(n){return new(n||i)};static \u0275prov=k({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),nh={dragStartThreshold:5,pointerDirectionChangeThreshold:5},Md=(()=>{class i{_document=M(hi);_ngZone=M(Qe);_viewportRuler=M(da);_dragDropRegistry=M(La);_renderer=M(mi).createRenderer(null,null);constructor(){}createDrag(t,n=nh){return new ka(t,n,this._document,this._ngZone,this._viewportRuler,this._dragDropRegistry,this._renderer)}createDropList(t){return new Ia(t,this._dragDropRegistry,this._document,this._ngZone,this._viewportRuler)}static \u0275fac=function(n){return new(n||i)};static \u0275prov=k({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),Aa=new De("CDK_DRAG_PARENT");var Td=new De("CdkDragHandle"),Zo=(()=>{class i{element=M(ra);_parentDrag=M(Aa,{optional:!0,skipSelf:!0});_dragDropRegistry=M(La);_stateChanges=new N;get disabled(){return this._disabled}set disabled(t){this._disabled=t,this._stateChanges.next(this)}_disabled=!1;constructor(){this._parentDrag?._addHandle(this)}ngAfterViewInit(){if(!this._parentDrag){let t=this.element.nativeElement.parentElement;for(;t;){let n=this._dragDropRegistry.getDragDirectiveForNode(t);if(n){this._parentDrag=n,n._addHandle(this);break}t=t.parentElement}}}ngOnDestroy(){this._parentDrag?._removeHandle(this),this._stateChanges.complete()}static \u0275fac=function(n){return new(n||i)};static \u0275dir=sn({type:i,selectors:[["","cdkDragHandle",""]],hostAttrs:[1,"cdk-drag-handle"],inputs:{disabled:[2,"cdkDragHandleDisabled","disabled",la]},features:[Ui([{provide:Td,useExisting:i}])]})}return i})(),ih=new De("CDK_DRAG_CONFIG"),oh=new De("CdkDropList"),Yo=(()=>{class i{element=M(ra);dropContainer=M(oh,{optional:!0,skipSelf:!0});_ngZone=M(Qe);_viewContainerRef=M(nl);_dir=M(Tl,{optional:!0});_changeDetectorRef=M($e);_selfHandle=M(Td,{optional:!0,self:!0});_parentDrag=M(Aa,{optional:!0,skipSelf:!0});_dragDropRegistry=M(La);_destroyed=new N;_handles=new ce([]);_previewTemplate;_placeholderTemplate;_dragRef;data;lockAxis;rootElementSelector;boundaryElement;dragStartDelay;freeDragPosition;get disabled(){return this._disabled||!!(this.dropContainer&&this.dropContainer.disabled)}set disabled(t){this._disabled=t,this._dragRef.disabled=this._disabled}_disabled;constrainPosition;previewClass;previewContainer;scale=1;started=new U;released=new U;ended=new U;entered=new U;exited=new U;dropped=new U;moved=new Be(t=>{let n=this._dragRef.moved.pipe(se(o=>({source:this,pointerPosition:o.pointerPosition,event:o.event,delta:o.delta,distance:o.distance}))).subscribe(t);return()=>{n.unsubscribe()}});_injector=M(jt);constructor(){let t=this.dropContainer,n=M(ih,{optional:!0}),o=M(Md);this._dragRef=o.createDrag(this.element,{dragStartThreshold:n&&n.dragStartThreshold!=null?n.dragStartThreshold:5,pointerDirectionChangeThreshold:n&&n.pointerDirectionChangeThreshold!=null?n.pointerDirectionChangeThreshold:5,zIndex:n?.zIndex}),this._dragRef.data=this,this._dragDropRegistry.registerDirectiveNode(this.element.nativeElement,this),n&&this._assignDefaults(n),t&&(this._dragRef._withDropContainer(t._dropListRef),t.addItem(this),t._dropListRef.beforeStarted.pipe(R(this._destroyed)).subscribe(()=>{this._dragRef.scale=this.scale})),this._syncInputs(this._dragRef),this._handleEvents(this._dragRef)}getPlaceholderElement(){return this._dragRef.getPlaceholderElement()}getRootElement(){return this._dragRef.getRootElement()}reset(){this._dragRef.reset()}getFreeDragPosition(){return this._dragRef.getFreeDragPosition()}setFreeDragPosition(t){this._dragRef.setFreeDragPosition(t)}ngAfterViewInit(){el(()=>{this._updateRootElement(),this._setupHandlesListener(),this._dragRef.scale=this.scale,this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)},{injector:this._injector})}ngOnChanges(t){let n=t.rootElementSelector,o=t.freeDragPosition;n&&!n.firstChange&&this._updateRootElement(),this._dragRef.scale=this.scale,o&&!o.firstChange&&this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)}ngOnDestroy(){this.dropContainer&&this.dropContainer.removeItem(this),this._dragDropRegistry.removeDirectiveNode(this.element.nativeElement),this._ngZone.runOutsideAngular(()=>{this._handles.complete(),this._destroyed.next(),this._destroyed.complete(),this._dragRef.dispose()})}_addHandle(t){let n=this._handles.getValue();n.push(t),this._handles.next(n)}_removeHandle(t){let n=this._handles.getValue(),o=n.indexOf(t);o>-1&&(n.splice(o,1),this._handles.next(n))}_setPreviewTemplate(t){this._previewTemplate=t}_resetPreviewTemplate(t){t===this._previewTemplate&&(this._previewTemplate=null)}_setPlaceholderTemplate(t){this._placeholderTemplate=t}_resetPlaceholderTemplate(t){t===this._placeholderTemplate&&(this._placeholderTemplate=null)}_updateRootElement(){let t=this.element.nativeElement,n=t;this.rootElementSelector&&(n=t.closest!==void 0?t.closest(this.rootElementSelector):t.parentElement?.closest(this.rootElementSelector)),this._dragRef.withRootElement(n||t)}_getBoundaryElement(){let t=this.boundaryElement;return t?typeof t=="string"?this.element.nativeElement.closest(t):Gt(t):null}_syncInputs(t){t.beforeStarted.subscribe(()=>{if(!t.isDragging()){let n=this._dir,o=this.dragStartDelay,r=this._placeholderTemplate?{template:this._placeholderTemplate.templateRef,context:this._placeholderTemplate.data,viewContainer:this._viewContainerRef}:null,a=this._previewTemplate?{template:this._previewTemplate.templateRef,context:this._previewTemplate.data,matchSize:this._previewTemplate.matchSize,viewContainer:this._viewContainerRef}:null;t.disabled=this.disabled,t.lockAxis=this.lockAxis,t.scale=this.scale,t.dragStartDelay=typeof o=="object"&&o?o:Sl(o),t.constrainPosition=this.constrainPosition,t.previewClass=this.previewClass,t.withBoundaryElement(this._getBoundaryElement()).withPlaceholderTemplate(r).withPreviewTemplate(a).withPreviewContainer(this.previewContainer||"global"),n&&t.withDirection(n.value)}}),t.beforeStarted.pipe(xn(1)).subscribe(()=>{if(this._parentDrag){t.withParent(this._parentDrag._dragRef);return}let n=this.element.nativeElement.parentElement;for(;n;){let o=this._dragDropRegistry.getDragDirectiveForNode(n);if(o){t.withParent(o._dragRef);break}n=n.parentElement}})}_handleEvents(t){t.started.subscribe(n=>{this.started.emit({source:this,event:n.event}),this._changeDetectorRef.markForCheck()}),t.released.subscribe(n=>{this.released.emit({source:this,event:n.event})}),t.ended.subscribe(n=>{this.ended.emit({source:this,distance:n.distance,dropPoint:n.dropPoint,event:n.event}),this._changeDetectorRef.markForCheck()}),t.entered.subscribe(n=>{this.entered.emit({container:n.container.data,item:this,currentIndex:n.currentIndex})}),t.exited.subscribe(n=>{this.exited.emit({container:n.container.data,item:this})}),t.dropped.subscribe(n=>{this.dropped.emit({previousIndex:n.previousIndex,currentIndex:n.currentIndex,previousContainer:n.previousContainer.data,container:n.container.data,isPointerOverContainer:n.isPointerOverContainer,item:this,distance:n.distance,dropPoint:n.dropPoint,event:n.event})})}_assignDefaults(t){let{lockAxis:n,dragStartDelay:o,constrainPosition:r,previewClass:a,boundaryElement:c,draggingDisabled:m,rootElementSelector:g,previewContainer:h}=t;this.disabled=m??!1,this.dragStartDelay=o||0,n&&(this.lockAxis=n),r&&(this.constrainPosition=r),a&&(this.previewClass=a),c&&(this.boundaryElement=c),g&&(this.rootElementSelector=g),h&&(this.previewContainer=h)}_setupHandlesListener(){this._handles.pipe(xe(t=>{let n=t.map(o=>o.element);this._selfHandle&&this.rootElementSelector&&n.push(this.element),this._dragRef.withHandles(n)}),ke(t=>Rt(...t.map(n=>n._stateChanges.pipe(qs(n))))),R(this._destroyed)).subscribe(t=>{let n=this._dragRef,o=t.element.nativeElement;t.disabled?n.disableHandle(o):n.enableHandle(o)})}static \u0275fac=function(n){return new(n||i)};static \u0275dir=sn({type:i,selectors:[["","cdkDrag",""]],hostAttrs:[1,"cdk-drag"],hostVars:4,hostBindings:function(n,o){n&2&&K("cdk-drag-disabled",o.disabled)("cdk-drag-dragging",o._dragRef.isDragging())},inputs:{data:[0,"cdkDragData","data"],lockAxis:[0,"cdkDragLockAxis","lockAxis"],rootElementSelector:[0,"cdkDragRootElement","rootElementSelector"],boundaryElement:[0,"cdkDragBoundary","boundaryElement"],dragStartDelay:[0,"cdkDragStartDelay","dragStartDelay"],freeDragPosition:[0,"cdkDragFreeDragPosition","freeDragPosition"],disabled:[2,"cdkDragDisabled","disabled",la],constrainPosition:[0,"cdkDragConstrainPosition","constrainPosition"],previewClass:[0,"cdkDragPreviewClass","previewClass"],previewContainer:[0,"cdkDragPreviewContainer","previewContainer"],scale:[2,"cdkDragScale","scale",sl]},outputs:{started:"cdkDragStarted",released:"cdkDragReleased",ended:"cdkDragEnded",entered:"cdkDragEntered",exited:"cdkDragExited",dropped:"cdkDragDropped",moved:"cdkDragMoved"},exportAs:["cdkDrag"],features:[Ui([{provide:Aa,useExisting:i}]),Ys]})}return i})();var Xo=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=an({type:i});static \u0275inj=rn({providers:[Md],imports:[vi]})}return i})();var rh=(i,e,t)=>({expanded:i,draggable:e,"cdk-drag-disabled":t});function ah(i,e){i&1&&(s(0,"h3"),d(1,"Capas"),l())}function sh(i,e){if(i&1){let t=F();s(0,"div",15),C("click",function(){let o=_(t).$implicit,r=f(3);return b(r.toggleBaseLayer(o))}),s(1,"mat-icon",16),d(2),l(),s(3,"span",17),d(4),l(),s(5,"mat-icon",18),d(6),l()()}if(i&2){let t=e.$implicit;K("active",t.visible),u("matTooltip",t.description),p(2),E(t.icon||"map"),p(2),E(t.name),p(2),E(t.visible?"radio_button_checked":"radio_button_unchecked")}}function lh(i,e){i&1&&(s(0,"div",19),d(1," No hay capas base disponibles. "),l())}function ch(i,e){if(i&1&&(s(0,"div",12),y(1,sh,7,6,"div",13)(2,lh,2,0,"div",14),l()),i&2){let t=f(2);p(),u("ngForOf",t.baseLayers),p(),u("ngIf",t.baseLayers.length===0)}}function dh(i,e){if(i&1){let t=F();s(0,"div",21),C("click",function(){let o=_(t).$implicit,r=f(3);return b(r.toggleOverlayLayer(o))}),s(1,"mat-icon",16),d(2),l(),s(3,"span",17),d(4),l(),s(5,"mat-icon",22),d(6),l()()}if(i&2){let t=e.$implicit;K("active",t.visible),u("matTooltip",t.description),p(2),E(t.icon||"layers_clear"),p(2),E(t.name),p(2),E(t.visible?"check_box":"check_box_outline_blank")}}function ph(i,e){i&1&&(s(0,"div",19),d(1," No hay capas superpuestas disponibles. "),l())}function mh(i,e){if(i&1&&(s(0,"div",12),y(1,dh,7,6,"div",20)(2,ph,2,0,"div",14),l()),i&2){let t=f(2);p(),u("ngForOf",t.overlayLayers),p(),u("ngIf",t.overlayLayers.length===0)}}function gh(i,e){if(i&1){let t=F();s(0,"div",8)(1,"div",9)(2,"div",10),C("click",function(){_(t);let o=f();return b(o.toggleBaseExpand())}),s(3,"span"),d(4,"Capas Base"),l(),s(5,"mat-icon"),d(6),l()(),y(7,ch,3,2,"div",11),l(),s(8,"div",9)(9,"div",10),C("click",function(){_(t);let o=f();return b(o.toggleOverlaysExpand())}),s(10,"span"),d(11,"Capas Superpuestas"),l(),s(12,"mat-icon"),d(13),l()(),y(14,mh,3,2,"div",11),l()()}if(i&2){let t=f();p(6),E(t.expandedBase?"expand_less":"expand_more"),p(),u("ngIf",t.expandedBase),p(6),E(t.expandedOverlays?"expand_less":"expand_more"),p(),u("ngIf",t.expandedOverlays)}}function uh(i,e){i&1&&(s(0,"div",23)(1,"span",24),d(2,"Arrastra desde el encabezado para mover."),l()())}var Jo=class i{constructor(e,t){this.mapStateManager=e;this.logger=t}position="top-right";_baseLayers=[];_overlayLayers=[];baseLayers=[];overlayLayers=[];baseLayerChanged=new U;overlayLayerChanged=new U;expandedLayers=!1;expandedBase=!0;expandedOverlays=!0;isDraggable=!1;panelPosition=null;destroy$=new N;get positionClass(){return`lc-${this.position}`}ngOnInit(){this.mapStateManager.layerChanges.pipe(R(this.destroy$)).subscribe(()=>{this.loadLayers()}),this.loadLayers(),this.loadSavedPosition(),this.baseLayers.length===0&&this.createDefaultBaseLayers()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadLayers(){try{let e=this.mapStateManager.getAllLayers();this._baseLayers=e.filter(t=>t.type==="base").sort((t,n)=>t.order-n.order),this._overlayLayers=e.filter(t=>t.type==="overlay").sort((t,n)=>t.order-n.order),this._baseLayers.length===0&&this.createDefaultBaseLayers(),this._overlayLayers.length===0&&this.createDefaultOverlayLayers(),this.baseLayers=this._baseLayers.map(t=>({id:t.id,name:t.name,visible:t.visible,description:t.description,icon:t.icon})),this.overlayLayers=this._overlayLayers.map(t=>({id:t.id,name:t.name,visible:t.visible,description:t.description,icon:t.icon}))}catch(e){this.logger.error("Error al cargar capas:",e)}}createDefaultBaseLayers(){this._baseLayers=[{id:"osm",name:"OpenStreetMap",visible:!0,type:"base",icon:"fa-map",description:"Mapa base est\xE1ndar",order:1},{id:"satellite",name:"Sat\xE9lite",visible:!1,type:"base",icon:"fa-satellite-dish",description:"Vista satelital",order:2},{id:"terrain",name:"Terreno",visible:!1,type:"base",icon:"fa-mountain",description:"Mapa topogr\xE1fico y de terreno",order:3}],this.baseLayers=this._baseLayers.map(e=>({id:e.id,name:e.name,visible:e.visible,description:e.description,icon:e.icon}))}createDefaultOverlayLayers(){this._overlayLayers=[{id:"elements",name:"Elementos",visible:!0,type:"overlay",icon:"fa-network-wired",description:"Elementos de la red",order:1},{id:"connections",name:"Conexiones",visible:!0,type:"overlay",icon:"fa-project-diagram",description:"Conexiones entre elementos",order:2},{id:"labels",name:"Etiquetas",visible:!0,type:"overlay",icon:"fa-tag",description:"Nombres de los elementos",order:3},{id:"grid",name:"Cuadr\xEDcula",visible:!1,type:"overlay",icon:"fa-th",description:"Cuadr\xEDcula de coordenadas",order:4}],this.overlayLayers=this._overlayLayers.map(e=>({id:e.id,name:e.name,visible:e.visible,description:e.description,icon:e.icon}))}toggleBaseLayer(e){this.baseLayers.forEach(t=>{t.visible=t.id===e.id}),this._baseLayers.forEach(t=>{let n=t.id===e.id;t.visible!==n&&(t.visible=n,this.mapStateManager.toggleLayerVisibility(t.id))}),this.baseLayerChanged.emit(e)}toggleOverlayLayer(e){e.visible=!e.visible;let t=this._overlayLayers.find(n=>n.id===e.id);t&&(t.visible=e.visible,this.mapStateManager.toggleLayerVisibility(t.id)),this.overlayLayerChanged.emit(e)}toggleExpand(){this.expandedLayers=!this.expandedLayers}toggleBaseExpand(){this.expandedBase=!this.expandedBase}toggleOverlaysExpand(){this.expandedOverlays=!this.expandedOverlays}toggleDraggable(){this.isDraggable=!this.isDraggable,!this.isDraggable&&this.panelPosition||this.isDraggable&&this.panelPosition,this.logger.debug(`LayerControlComponent: Draggable toggled to ${this.isDraggable}`)}onPanelDragEnded(e){if(!this.isDraggable)return;let t={x:(this.panelPosition?.x||0)+e.distance.x,y:(this.panelPosition?.y||0)+e.distance.y};this.panelPosition=t,e.source.element.nativeElement.style.transform=`translate3d(${t.x}px, ${t.y}px, 0)`,this.logger.debug("LayerControlComponent: Panel drag ended",e.distance,"New position:",this.panelPosition),this.saveCurrentPosition()}saveCurrentPosition(){if(this.panelPosition)try{localStorage.setItem("layer-control-position",JSON.stringify(this.panelPosition))}catch(e){console.warn("No se pudo guardar la posici\xF3n del panel de capas",e)}}loadSavedPosition(){try{let e=localStorage.getItem("layer-control-position");e&&(this.panelPosition=JSON.parse(e))}catch(e){console.warn("No se pudo cargar la posici\xF3n guardada del panel de capas",e)}}static \u0275fac=function(t){return new(t||i)(I(gt),I(G))};static \u0275cmp=q({type:i,selectors:[["app-layer-control"]],inputs:{position:"position"},outputs:{baseLayerChanged:"baseLayerChanged",overlayLayerChanged:"overlayLayerChanged"},decls:21,vars:27,consts:[["cdkDrag","",1,"layer-control-container","layer-control-panel",3,"cdkDragEnded","ngClass","cdkDragDisabled","cdkDragBoundary"],["cdkDragHandle","",1,"layer-control-header",3,"mousedown"],[1,"header-left"],["mat-icon-button","",1,"drag-handle-button",3,"click","matTooltip"],[4,"ngIf"],["mat-icon-button","",1,"layer-toggle-button",3,"click","matTooltip"],["class","layer-content",4,"ngIf"],["class","layer-control-footer",4,"ngIf"],[1,"layer-content"],[1,"layer-group"],[1,"group-header",3,"click"],["class","group-content",4,"ngIf"],[1,"group-content"],["class","layer-item base-layer",3,"active","matTooltip","click",4,"ngFor","ngForOf"],["class","no-layers-message",4,"ngIf"],[1,"layer-item","base-layer",3,"click","matTooltip"],[1,"layer-icon"],[1,"layer-name"],[1,"layer-status"],[1,"no-layers-message"],["class","layer-item overlay-layer",3,"active","matTooltip","click",4,"ngFor","ngForOf"],[1,"layer-item","overlay-layer",3,"click","matTooltip"],[1,"layer-toggle"],[1,"layer-control-footer"],[1,"drag-hint"]],template:function(t,n){t&1&&(s(0,"pre"),d(1),Le(2,"json"),l(),s(3,"pre"),d(4),Le(5,"json"),l(),s(6,"pre"),d(7),Le(8,"json"),l(),s(9,"div",0),C("cdkDragEnded",function(r){return n.onPanelDragEnded(r)}),s(10,"div",1),C("mousedown",function(r){return r.stopPropagation()}),s(11,"div",2)(12,"button",3),C("click",function(){return n.toggleDraggable()}),s(13,"mat-icon"),d(14),l()(),y(15,ah,2,0,"h3",4),l(),s(16,"button",5),C("click",function(){return n.toggleExpand()}),s(17,"mat-icon"),d(18),l()()(),y(19,gh,15,4,"div",6)(20,uh,3,0,"div",7),l()),t&2&&(p(),V("positionClass: ",Tn(2,17,n.positionClass),""),p(3),V("expandedLayers: ",Tn(5,19,n.expandedLayers),""),p(3),V("isDraggable: ",Tn(8,21,n.isDraggable),""),p(2),Sn(n.positionClass),sa("transform",n.panelPosition?"translate3d("+n.panelPosition.x+"px, "+n.panelPosition.y+"px, 0)":null),u("ngClass",il(23,rh,n.expandedLayers,n.isDraggable,!n.isDraggable))("cdkDragDisabled",!n.isDraggable)("cdkDragBoundary",".map-container"),p(3),u("matTooltip",n.isDraggable?"Desactivar arrastre":"Activar arrastre"),p(2),E(n.isDraggable?"lock_open":"lock"),p(),u("ngIf",n.expandedLayers),p(),u("matTooltip",n.expandedLayers?"Contraer panel":"Expandir panel"),p(2),E(n.expandedLayers?"keyboard_arrow_down":"layers"),p(),u("ngIf",n.expandedLayers),p(),u("ngIf",n.isDraggable&&n.expandedLayers))},dependencies:[X,pt,je,ie,ul,he,Ne,Ee,Me,Xo,Yo,Zo,le,de],styles:['@charset "UTF-8";[_ngcontent-%COMP%]:root{--primary-color: #3F51B5;--primary-rgb: 63, 81, 181;--primary-color-hover: rgb(52.4655737705, 67.4557377049, 150.7344262295);--accent-color: #FF4081;--warn-color: #F44336;--background-color: #F5F5F5;--surface-color: #ffffff;--surface-lighter: #f9f9f9;--surface-darker: #eeeeee;--text-color: #212121;--text-secondary-color: hsl(0, 0%, -12.0588235294%);--text-hint-color: hsl(0, 0%, -32.0588235294%);--text-disabled-color: hsl(0, 0%, -52.0588235294%);--primary-contrast-color: white;--accent-contrast-color: white;--warn-contrast-color: white;--olt-color: #4CAF50;--ont-color: #2196F3;--odf-color: #FFC107;--edfa-color: #9C27B0;--splitter-color: #FF5722;--manga-color: #607D8B;--terminal-box-color: #FF9800;--slack-fiber-color: #80DEEA;--spacing-unit: 4px;--spacing-xxs: .125rem;--spacing-xs: .25rem;--spacing-sm: .5rem;--spacing-md: .75rem;--spacing-lg: 1rem;--spacing-xl: 1.5rem;--spacing-xxl: 2rem;--shadow-xs: 0 1px 2px rgba(0,0,0,.05);--shadow-sm: 0 1px 3px rgba(0, 0, 0, .1);--shadow-md: 0 2px 4px rgba(0, 0, 0, .1);--shadow-lg: 0 4px 6px rgba(0, 0, 0, .1);--border-radius-sm: 2px;--border-radius-md: 4px;--border-radius-lg: 8px;--border-radius-round: 50%;--border-color: #e0e0e0;--border-width-normal: 1px;--border-width-strong: 4px;--border-radius-pill: 20px;--border-color-light: rgb(249.5, 249.5, 249.5);--border-color-dark: rgb(198.5, 198.5, 198.5);--color-success: #4caf50;--color-warning: #ff8f00;--color-danger: #c62828;--color-info: #2196F3;--color-neutral: #9e9e9e;--color-success-bg: #e8f5e9;--color-warning-bg: #fff8e1;--color-danger-bg: #ffebee;--color-info-bg: rgb(226.5384615385, 241.5384615385, 253.4615384615);--color-maintenance-bg: #e3f2fd;--status-inactive-fg: #757575;--status-inactive-bg: #f5f5f5;--color-success-contrast: white;--color-warning-contrast: white;--color-danger-contrast: white;--color-info-contrast: #212121;--color-maintenance-contrast: white;--font-family: "Roboto, Segoe UI, sans-serif";--font-size-xxs: .625rem;--font-size-xs: .75rem;--font-size-sm: .875rem;--font-size-md: 1rem;--font-size-lg: 1.125rem;--font-size-xl: 1.25rem;--font-size-xxl: 1.5rem;--font-size-display: 2.5rem;--transition-fast: .15s ease-in-out;--transition-normal: .3s ease-in-out;--transition-slow: .5s ease-in-out;--status-active: #4caf50;--status-inactive: #757575;--status-maintenance: #1565c0;--status-planning: #2196F3;--status-unknown: var(--color-neutral);--status-fault: #c62828;--surface-overlay-light: rgba(255, 255, 255, .85);--surface-overlay-light-strong: rgba(255, 255, 255, .95);--border-color-semitransparent: rgba(0, 0, 0, .1);--primary-bg-subtle: rgba(63, 81, 181, .15);--surface-action-hover: rgb(242.8571428571, 242.8571428571, 242.8571428571);--surface-button: var(--surface-color);--surface-button-hover: var(--surface-action-hover);--text-color-button: var(--text-color);--scrollbar-track-color: #f1f1f1;--scrollbar-thumb-color: #c1c1c1;--scrollbar-thumb-hover-color: #a8a8a8;--z-index-map-base: 1;--z-index-map-elements: 5;--z-index-map-widgets-overlay: 50;--z-index-map-overlay: 100;--z-index-network-design-panels: 900;--z-index-debug-info: 999;--z-index-floating-panel-base: 1000;--z-index-performance-widget: 1000;--z-index-elements-panel: 1001;--z-index-layer-control: 1001;--z-index-sidebar: 1005;--z-index-map-legend: 1005;--z-index-sidebar-mobile: 1010;--z-index-loading-overlay: 1050;--z-index-dialog: 1075;--z-index-toolbar: 1100;--z-index-tooltip: 1150;--z-index-map-controls: 1201;--toolbar-height: 46px;--toolbar-button-height: 30px;--toolbar-button-height-mobile: 32px;--action-button-height: 40px;--menu-item-height: 42px;--icon-size-sm: 18px;--icon-size-md: 20px;--tooltip-bg-color: rgba(33, 33, 33, .95);--primary-ripple-color: rgba(var(--primary-rgb), .1)}[_ngcontent-%COMP%]:root.dark-theme, body.dark-theme[_ngcontent-%COMP%]{--background-color: #121212;--surface-color: #1e1e1e;--surface-lighter: rgb(42.75, 42.75, 42.75);--surface-darker: #121212;--text-color: #e0e0e0;--text-secondary-color: rgb(185.75, 185.75, 185.75);--text-hint-color: rgb(147.5, 147.5, 147.5);--text-disabled-color: rgb(109.25, 109.25, 109.25);--border-color: #444444;--border-color-light: rgb(93.5, 93.5, 93.5);--border-color-dark: rgb(42.5, 42.5, 42.5);--color-success-bg: rgb(51.8181818182, 119.1818181818, 57);--color-warning-bg: rgb(174, 133.4, 0);--color-danger-bg: rgb(184, 0, 27.6);--color-info-bg: rgb(8.9230769231, 95.9230769231, 165.0769230769);--color-maintenance-bg: rgb(11.6, 98.6, 162.4);--shadow-xs: 0 1px 2px rgba(0,0,0,.3);--shadow-sm: 0 1px 3px rgba(0,0,0,.4);--shadow-md: 0 2px 4px rgba(0,0,0,.5);--shadow-lg: 0 4px 6px rgba(0,0,0,.5);--surface-overlay-light: rgba(40, 40, 40, .85);--surface-overlay-light-strong: rgba(30, 30, 30, .95);--border-color-semitransparent: rgba(255, 255, 255, .1);--status-inactive-fg: hsl(0, 0%, 100.8823529412%);--status-inactive-bg: #383838;--primary-bg-subtle: rgba(63, 81, 181, .25);--surface-action-hover: rgb(55.5, 55.5, 55.5);--surface-button: var(--surface-color);--surface-button-hover: var(--surface-action-hover);--text-color-button: var(--text-color);--scrollbar-track-color: #333333;--scrollbar-thumb-color: #666666;--scrollbar-thumb-hover-color: #888888}.standard-panel-ui[_ngcontent-%COMP%]{background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-lg);overflow:hidden;display:flex;flex-direction:column}.standard-panel-ui[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .layer-control-header[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-md);background-color:var(--surface-lighter);border-bottom:1px solid var(--border-color)}.standard-panel-ui[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .layer-control-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:var(--font-size-md);font-weight:500;color:var(--text-color)}.standard-panel-ui[_ngcontent-%COMP%]   .panel-content[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .layer-content[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-content[_ngcontent-%COMP%]{padding:var(--spacing-md);flex-grow:1;overflow-y:auto;color:var(--text-color)}.standard-panel-ui[_ngcontent-%COMP%]   .panel-actions[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:var(--spacing-sm);padding:var(--spacing-sm) var(--spacing-md);border-top:1px solid var(--border-color)}.standard-panel-ui[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]{display:flex;margin-bottom:var(--spacing-sm)}.standard-panel-ui[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]   .info-label[_ngcontent-%COMP%]{width:100px;font-weight:500;color:var(--text-secondary-color)}.standard-panel-ui[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]   .info-value[_ngcontent-%COMP%]{flex:1;color:var(--text-color)}.simple-panel-ui[_ngcontent-%COMP%]{background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-lg);padding:var(--spacing-md);color:var(--text-color)}.side-panel[_ngcontent-%COMP%]{background-color:var(--surface-color);border-radius:var(--border-radius-sm, 4px);box-shadow:var(--shadow-sm, 0 2px 10px rgba(0, 0, 0, .08));height:100%;width:var(--side-panel-width, 320px);display:flex;flex-direction:column;overflow:hidden}@media (max-width: 768px){.side-panel[_ngcontent-%COMP%]{width:var(--side-panel-width-tablet, 280px)}}@media (max-width: 600px){.side-panel[_ngcontent-%COMP%]{width:var(--side-panel-width-mobile, 100%);max-width:100vw}}.side-panel[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%], .side-panel[_ngcontent-%COMP%]   .layer-control-header[_ngcontent-%COMP%]{height:var(--panel-header-height, 44px);min-height:var(--panel-header-height, 44px);display:flex;align-items:center;justify-content:space-between;padding:0 var(--spacing-sm);border-bottom:1px solid var(--border-color, rgba(0, 0, 0, .1))}.side-panel[_ngcontent-%COMP%]   .panel-content[_ngcontent-%COMP%], .side-panel[_ngcontent-%COMP%]   .layer-content[_ngcontent-%COMP%]{flex:1;overflow:auto}.map-base-container[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;overflow:hidden;background-color:var(--background-color);transition:background-color var(--transition-normal)}.network-design[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}.network-design__toolbar[_ngcontent-%COMP%]{padding:0 var(--spacing-md);background-color:var(--primary-color);color:var(--primary-contrast-color);box-shadow:var(--shadow-md)}.network-design__header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-md);background-color:var(--primary-color);color:var(--primary-contrast-color);box-shadow:var(--shadow-md)}.network-design__header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:var(--font-size-xl);font-weight:500}.network-design__main[_ngcontent-%COMP%]{flex:1;display:flex;overflow:hidden;position:relative;padding:var(--spacing-md);background-color:var(--surface-color)}@media (max-width: 768px){.network-design__main[_ngcontent-%COMP%]{margin-left:0;padding:var(--spacing-sm)}}.network-design__main[_ngcontent-%COMP%]   .network-design__map[_ngcontent-%COMP%]{flex:1;position:relative;border-radius:var(--border-radius-md);overflow:hidden;box-shadow:var(--shadow-md);background-color:var(--surface-darker)}.network-design__main[_ngcontent-%COMP%]   .network-design__sidebar[_ngcontent-%COMP%]{width:300px;padding:var(--spacing-md);background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-md);margin-left:var(--spacing-md);overflow-y:auto;border-right:1px solid var(--border-color)}@media (max-width: 768px){.network-design__main[_ngcontent-%COMP%]   .network-design__sidebar[_ngcontent-%COMP%]{width:100%;position:fixed;top:0;left:0;height:100%;z-index:1000;transform:translate(-100%);transition:transform var(--transition-normal);margin-left:0;border-right:none}.network-design__main[_ngcontent-%COMP%]   .network-design__sidebar--open[_ngcontent-%COMP%]{transform:translate(0)}}.network-design__footer[_ngcontent-%COMP%]{padding:var(--spacing-md);background-color:var(--surface-lighter);border-top:1px solid var(--border-color);font-size:var(--font-size-sm);color:var(--text-color)}.network-design__element[_ngcontent-%COMP%]{padding:var(--spacing-md);margin-bottom:var(--spacing-md);background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-sm);transition:box-shadow var(--transition-fast)}.network-design__element[_ngcontent-%COMP%]:hover{box-shadow:var(--shadow-md)}.network-design__element--selected[_ngcontent-%COMP%]{border-left:4px solid var(--primary-color)}.status-badge-base[_ngcontent-%COMP%], .status-maintenance[_ngcontent-%COMP%], .status-warning[_ngcontent-%COMP%], .status-fault[_ngcontent-%COMP%], .status-inactive[_ngcontent-%COMP%], .status-active[_ngcontent-%COMP%]{display:inline-block;padding:var(--spacing-xs) var(--spacing-sm);border-radius:var(--border-radius-sm);font-size:var(--font-size-sm);font-weight:500}.status-active[_ngcontent-%COMP%]{background-color:var(--color-success-bg);color:var(--color-success-contrast)}.status-inactive[_ngcontent-%COMP%]{background-color:var(--status-inactive-bg);color:var(--status-inactive-fg)}.status-fault[_ngcontent-%COMP%]{background-color:var(--color-danger-bg);color:var(--color-danger-contrast)}.status-warning[_ngcontent-%COMP%]{background-color:var(--color-warning-bg);color:var(--color-warning-contrast)}.status-maintenance[_ngcontent-%COMP%]{background-color:var(--color-maintenance-bg);color:var(--color-maintenance-contrast)}.network-utils__status-badge[_ngcontent-%COMP%]{display:inline-block;padding:var(--spacing-xs) var(--spacing-sm);border-radius:var(--border-radius-sm);font-size:var(--font-size-xs);font-weight:500;text-transform:uppercase}.network-utils__status-badge--active[_ngcontent-%COMP%]{background-color:var(--color-success-bg);color:var(--color-success-contrast)}.network-utils__status-badge--inactive[_ngcontent-%COMP%]{background-color:var(--status-inactive-bg);color:var(--status-inactive-fg)}.network-utils__status-badge--maintenance[_ngcontent-%COMP%]{background-color:var(--color-maintenance-bg);color:var(--color-maintenance-contrast)}.network-utils__loading[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:var(--spacing-lg);color:var(--text-color)}.network-utils__error[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-md);background-color:#ffebee;color:var(--color-danger);border-radius:var(--border-radius-md)}.layer-control-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;position:absolute;z-index:var(--z-index-floating-panel, 1000);background-color:var(--floating-panel-bg, var(--surface-ground, #fff));border-radius:var(--border-radius-md, 6px);box-shadow:var(--floating-panel-shadow, 0 2px 10px rgba(0, 0, 0, .1));min-width:var(--floating-panel-min-width, 280px);max-width:var(--floating-panel-max-width, 450px);max-height:var(--floating-panel-max-height, 85vh);overflow:hidden;--floating-panel-bg: var(--surface-color, #fff);--floating-panel-color: var(--text-color, #333);--floating-panel-shadow: var(--floating-panel-shadow, 0 6px 24px rgba(0, 0, 0, .25), 0 1.5px 4px rgba(0, 0, 0, .15));--floating-panel-header-bg: var(--primary-color, #3f51b5);--floating-panel-header-color: var(--primary-contrast-color, white);width:var(--layer-control-width, 300px);max-height:var(--layer-control-max-height, 80vh);z-index:var(--z-index-layer-control, 1001);max-width:320px;margin:0;--floating-panel-content-padding: 0;--floating-panel-header-title-size: var(--font-size-md, 16px)}.layer-control-container[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%], .layer-control-container[_ngcontent-%COMP%]   .layer-control-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:var(--floating-panel-header-padding, 10px) var(--floating-panel-header-padding-x, var(--spacing-md, 16px));border-bottom:var(--floating-panel-header-border, 1px solid var(--border-color-light, rgba(0, 0, 0, .08)));background-color:var(--floating-panel-header-bg, var(--surface-a, #f8f9fa));color:var(--floating-panel-header-color, var(--text-color-secondary, #495057));border-top-left-radius:inherit;border-top-right-radius:inherit;flex-shrink:0}.layer-control-container[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%]   .panel-title[_ngcontent-%COMP%], .layer-control-container[_ngcontent-%COMP%]   .layer-control-header[_ngcontent-%COMP%]   .panel-title[_ngcontent-%COMP%]{font-weight:var(--floating-panel-title-weight, 600);font-size:var(--floating-panel-title-font-size, var(--font-size-md, 1rem));margin:0;flex-grow:1;line-height:1.4}.layer-control-container[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%]   .panel-actions[_ngcontent-%COMP%], .layer-control-container[_ngcontent-%COMP%]   .layer-control-header[_ngcontent-%COMP%]   .panel-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-xs, 8px)}.layer-control-container[_ngcontent-%COMP%]   .panel-content[_ngcontent-%COMP%], .layer-control-container[_ngcontent-%COMP%]   .layer-content[_ngcontent-%COMP%]{padding:var(--floating-panel-content-padding, var(--spacing-md, 16px));max-height:var(--floating-panel-content-max-height, calc(85vh - 100px) );overflow-x:hidden;overflow-y:auto;flex-grow:1;background-color:var(--floating-panel-content-bg, var(--surface-ground, #fff))}.layer-control-container[_ngcontent-%COMP%]   .panel-content.no-padding[_ngcontent-%COMP%], .layer-control-container[_ngcontent-%COMP%]   .no-padding.layer-content[_ngcontent-%COMP%]{padding:0}.layer-control-container[_ngcontent-%COMP%]   .panel-footer[_ngcontent-%COMP%], .layer-control-container[_ngcontent-%COMP%]   .layer-control-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center;padding:var(--floating-panel-footer-padding, var(--spacing-sm, 12px)) var(--floating-panel-footer-padding-x, var(--spacing-md, 16px));border-top:var(--floating-panel-footer-border, 1px solid var(--border-color-light, rgba(0, 0, 0, .08)));background-color:var(--floating-panel-footer-bg, var(--surface-a, #f8f9fa));border-bottom-left-radius:inherit;border-bottom-right-radius:inherit;flex-shrink:0;gap:var(--spacing-sm, 8px)}@media (max-width: 768px){.layer-control-container[_ngcontent-%COMP%]{width:var(--layer-control-width-tablet, 280px);max-height:var(--layer-control-max-height-tablet, 50vh)}}.layer-control-panel[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%;height:100%}.layer-control-header[_ngcontent-%COMP%]{padding:var(--spacing-xs, 8px) var(--spacing-sm, 12px)}.layer-control-header[_ngcontent-%COMP%]   .header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-sm, 8px)}.layer-control-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-weight:var(--floating-panel-title-weight, 500);font-size:var(--floating-panel-header-title-size);color:var(--floating-panel-header-color, inherit)}.layer-control-header[_ngcontent-%COMP%]   .drag-handle-button[_ngcontent-%COMP%], .layer-control-header[_ngcontent-%COMP%]   .layer-toggle-button[_ngcontent-%COMP%]{width:32px;height:32px;line-height:32px;color:var(--floating-panel-header-color, inherit)}.layer-control-header[_ngcontent-%COMP%]   .drag-handle-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .layer-control-header[_ngcontent-%COMP%]   .layer-toggle-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.layer-content[_ngcontent-%COMP%]{padding:var(--spacing-md, 16px);overflow-y:auto;flex-grow:1}.layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]{margin-bottom:var(--spacing-md, 16px)}.layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]:last-child{margin-bottom:0}.layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]   .group-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-sm, 8px) var(--spacing-xs, 4px);background-color:var(--surface-lighter, rgba(0, 0, 0, .03));border-radius:var(--border-radius-sm, 4px);cursor:pointer;margin-bottom:var(--spacing-sm, 8px)}.layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]   .group-header[_ngcontent-%COMP%]:hover{background-color:var(--surface-hover, rgba(0, 0, 0, .06))}.layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]   .group-header[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{flex:1;font-weight:500;font-size:var(--font-size-sm, 14px);color:var(--text-secondary-color)}.layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]   .group-header[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px;color:var(--text-hint-color)}.layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]   .layer-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:var(--spacing-sm, 8px);border-radius:var(--border-radius-sm, 4px);cursor:pointer;gap:var(--spacing-sm, 8px);margin-bottom:var(--spacing-xs, 4px)}.layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]   .layer-item[_ngcontent-%COMP%]:hover{background-color:var(--surface-hover, rgba(0, 0, 0, .04))}.layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]   .layer-item.active[_ngcontent-%COMP%]{background-color:var(--primary-bg-subtle, rgba(var(--primary-color-rgb, 63, 81, 181), .1))}.layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]   .layer-item.active[_ngcontent-%COMP%]   .layer-name[_ngcontent-%COMP%]{font-weight:500;color:var(--primary-color, #3f51b5)}.layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]   .layer-item[_ngcontent-%COMP%]   .layer-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px;color:var(--text-secondary-color)}.layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]   .layer-item[_ngcontent-%COMP%]   .layer-icon.active[_ngcontent-%COMP%]{color:var(--primary-color, #3f51b5)}.layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]   .layer-item[_ngcontent-%COMP%]   .layer-name[_ngcontent-%COMP%]{flex:1;font-size:var(--font-size-sm, 14px);color:var(--text-color);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]   .layer-item[_ngcontent-%COMP%]   .layer-status[_ngcontent-%COMP%], .layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]   .layer-item[_ngcontent-%COMP%]   .layer-toggle[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px;color:var(--primary-color, #3f51b5);opacity:.8}.layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]   .layer-item.active[_ngcontent-%COMP%]   .layer-status[_ngcontent-%COMP%], .layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]   .layer-item.active[_ngcontent-%COMP%]   .layer-toggle[_ngcontent-%COMP%]{opacity:1}.layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]   .no-layers-message[_ngcontent-%COMP%]{padding:var(--spacing-sm, 8px);color:var(--text-hint-color);font-size:var(--font-size-sm, 13px);text-align:center}.layer-control-footer[_ngcontent-%COMP%]{padding:var(--spacing-sm, 8px) var(--spacing-md, 16px);text-align:center}.layer-control-footer[_ngcontent-%COMP%]   .drag-hint[_ngcontent-%COMP%]{font-size:var(--font-size-xs, 12px);color:var(--text-hint-color)}@media (max-width: 480px){.layer-control-container[_ngcontent-%COMP%]{width:calc(100% - 32px);max-height:calc(100vh - 80px)}}@media (max-width: 480px) and (max-width: 480px){.layer-control-container[_ngcontent-%COMP%]{width:100%;height:auto;max-height:var(--floating-panel-max-height-mobile, calc(100dvh - 40px) );inset:auto 0 0!important;border-radius:var(--floating-panel-radius-mobile-top, 16px 16px 0 0);margin:0;transform:none!important;box-shadow:var(--floating-panel-shadow-mobile, 0 -4px 15px rgba(0, 0, 0, .12));position:fixed!important;z-index:var(--z-index-fullscreen-mobile-panel, 1050);min-width:100%;min-height:auto}.layer-control-container[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%], .layer-control-container[_ngcontent-%COMP%]   .layer-control-header[_ngcontent-%COMP%]{padding-top:var(--spacing-md, 16px);padding-bottom:var(--spacing-md, 16px)}.layer-control-container[_ngcontent-%COMP%]   .panel-content[_ngcontent-%COMP%], .layer-control-container[_ngcontent-%COMP%]   .layer-content[_ngcontent-%COMP%]{max-height:var(--floating-panel-content-max-height-mobile, calc(100dvh - 120px) )}.layer-control-container[_ngcontent-%COMP%]   .panel-footer[_ngcontent-%COMP%], .layer-control-container[_ngcontent-%COMP%]   .layer-control-footer[_ngcontent-%COMP%]{padding-bottom:var(--spacing-md, 16px)}}']})};var er=class i{constructor(e,t,n,o){this.elementManager=e;this.mapStateManager=t;this.logger=n;this.fb=o}showFilters=!0;position="left";elementSelected=new U;isExpanded=!0;activeTab="elements";viewMode="list";searchControl=new Rl("");searchResults=[];isSearching=!1;elements=[];filteredElements=[];selectedElement=null;elementTypeFilter=null;pageSize=20;currentPage=1;totalPages=1;totalItems=0;elementTypes=Object.values(We);elementStatuses=Object.values(Hn);advancedFiltersForm;savedFilterSets=[];activeAdvancedFilters=[];customAttributes=[];favoriteElements=[];showOnlyFavorites=!1;destroy$=new N;isLoadingFilters=!1;isLoadingElements=!1;networkDesignService=M(_o);ngOnInit(){this.advancedFiltersForm=this.fb.group({types:[[]],statuses:[[]],text:[""],createdFrom:[""],createdTo:[""],capacityMin:[""],capacityMax:[""],isWaterproof:[!1]}),this.applyFilters(),this.loadFavorites(),this.searchControl.valueChanges.pipe(wn(300),st(),R(this.destroy$)).subscribe(e=>{this.performSearch(e)})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}toggleExpansion(){this.isExpanded=!this.isExpanded,this.isExpanded&&setTimeout(()=>window.dispatchEvent(new Event("resize")),300)}detectCustomAttributes(){try{let e=new Map;for(let t of this.elements){let n=t.properties;if(n)for(let r of Object.keys(n)){let a=n[r];e.has(r)||e.set(r,{type:typeof a,values:new Set}),e.get(r).values.add(a)}let o=t.metadata;if(o)for(let r of Object.keys(o)){let a=o[r];e.has(r)||e.set(r,{type:typeof a,values:new Set}),e.get(r).values.add(a)}}this.customAttributes=Array.from(e.entries()).map(([t,n])=>({key:t,label:this.formatAttributeLabel(t),type:n.type,values:Array.from(n.values).filter(o=>o!=null)}));for(let t of this.customAttributes)this.advancedFiltersForm.get(t.key)||this.advancedFiltersForm.addControl(t.key,this.fb.control(""))}catch(e){this.handleError("Error al detectar atributos personalizados",e)}}formatAttributeLabel(e){return e.replace(/_/g," ").replace(/([A-Z])/g," $1").replace(/^./,t=>t.toUpperCase())}applyFilters(){let e={page:this.currentPage,pageSize:this.pageSize,filter:{}};this.elementTypeFilter;let t=this.advancedFiltersForm.value;t.text&&(e.filter.name=t.text),t.statuses&&t.statuses.length>0&&(e.filter.status=t.statuses.join(",")),this.loadElementsFromServer(this.elementTypeFilter,e)}loadElementsFromServer(e,t){if(!e){this.logger.info("loadElementsFromServer: No se especific\xF3 ElementType. No se cargar\xE1n elementos."),this.elements=[],this.filteredElements=[],this.totalItems=0,this.updatePagination();return}this.isLoadingElements=!0,this.networkDesignService.getElementsByType(e,t).pipe(R(this.destroy$),pi(()=>this.isLoadingElements=!1)).subscribe({next:n=>{this.elements=n.items,this.totalItems=n.totalItems,this.pageSize=n.pageSize,this.currentPage=n.currentPage,this.detectCustomAttributes();let o=[...this.elements];this.showOnlyFavorites&&(o=o.filter(r=>this.isFavorite(r))),this.filteredElements=o,this.updatePagination()},error:n=>{this.handleError(`Error al cargar elementos de tipo ${e} desde el servidor`,n),this.elements=[],this.filteredElements=[],this.totalItems=0,this.updatePagination()}})}updatePagination(){this.totalPages=Math.max(1,Math.ceil(this.totalItems/this.pageSize))}getCurrentPageElements(){return this.filteredElements}performSearch(e){this.isSearching=!0;try{if(!e){this.searchResults=[],this.isSearching=!1;return}let t=e.toLowerCase();this.searchResults=this.elements.filter(n=>n.id?.toString().toLowerCase().includes(t)||n.name?.toLowerCase().includes(t)||n.description&&n.description.toLowerCase().includes(t)||n.notes&&n.notes.toLowerCase().includes(t))}catch(t){this.handleError("Error al realizar b\xFAsqueda",t)}finally{this.isSearching=!1}}selectElement(e){this.selectedElement=e,this.elementSelected.emit(e);try{typeof this.mapStateManager.highlightElement=="function"?this.mapStateManager.highlightElement(e.id):this.elementManager.selectElement(e.id||"")}catch(t){this.logger.warn("No se pudo resaltar el elemento en el mapa",t)}}filterByType(e){this.elementTypeFilter=e,this.currentPage=1,this.applyFilters()}setActiveTab(e){this.activeTab=e}toggleViewMode(){this.viewMode=this.viewMode==="list"?"grid":"list"}dropElement(e){Qo(this.filteredElements,e.previousIndex,e.currentIndex)}loadFavorites(){try{let e=localStorage.getItem("favorite-elements");if(e){let t=JSON.parse(e);this.favoriteElements=this.elements.filter(n=>t.includes(n.id||""))}}catch(e){this.logger.warn("Error al cargar favoritos",e)}}saveFavorites(){try{let e=this.favoriteElements.map(t=>t.id||"");localStorage.setItem("favorite-elements",JSON.stringify(e))}catch(e){this.logger.warn("Error al guardar favoritos",e)}}isFavorite(e){return this.favoriteElements.some(t=>t.id===e.id)}toggleFavorite(e,t){t&&t.stopPropagation(),this.isFavorite(e)?this.favoriteElements=this.favoriteElements.filter(n=>n.id!==e.id):this.favoriteElements.push(e),this.saveFavorites(),this.showOnlyFavorites&&this.applyFilters()}toggleFavoritesFilter(){this.showOnlyFavorites=!this.showOnlyFavorites,this.applyFilters()}getElementTypeIcon(e){return{SPLITTER:"call_split",OLT:"router",ONT:"device_hub",FDP:"account_tree",FIBER_CABLE:"timeline",EDFA:"settings_input_component",FIBER_SPLICE:"fiber_smart_record",ODF:"grid_on",ROADM:"hub",PATCH_PANEL:"dns"}[e]||"category"}getElementTypeColor(e){return{SPLITTER:"#4caf50",OLT:"#2196f3",ONT:"#9c27b0",FDP:"#ff9800",FIBER_CABLE:"#607d8b",EDFA:"#e91e63",FIBER_SPLICE:"#00bcd4",ODF:"#8bc34a",ROADM:"#673ab7",PATCH_PANEL:"#795548"}[e]||"#757575"}goToPage(e){e>=1&&e<=this.totalPages&&e!==this.currentPage&&(this.currentPage=e,this.applyFilters())}handleError(e,t){this.logger.error(e,t),console.error(`${e}: ${t?.message||"Error desconocido"}`)}static \u0275fac=function(t){return new(t||i)(I(qn),I(gt),I(G),I(Yi))};static \u0275dir=sn({type:i,inputs:{showFilters:"showFilters",position:"position"},outputs:{elementSelected:"elementSelected"}})};var fh=(i,e)=>({expanded:i,"cdk-drag-disabled":e});function vh(i,e){i&1&&(s(0,"h3",7),d(1,"Elementos"),l())}function _h(i,e){if(i&1){let t=F();s(0,"button",11),C("click",function(){_(t);let o=f(2);return b(o.setActiveTab("filters"))}),d(1,"Filtros"),l()}if(i&2){let t=f(2);K("active",t.activeTab==="filters")}}function bh(i,e){if(i&1){let t=F();s(0,"button",11),C("click",function(){let o=_(t).$implicit,r=f(3);return b(r.filterByType(o))}),d(1),l()}if(i&2){let t=e.$implicit,n=f(3);K("selected",n.elementTypeFilter===t),p(),E(t)}}function Ch(i,e){if(i&1){let t=F();s(0,"div",22),C("click",function(){let o=_(t).$implicit,r=f(3);return b(r.selectElement(o))}),s(1,"div",23),d(2),l(),s(3,"div",24),d(4),l(),s(5,"div",25),d(6),l()()}if(i&2){let t=e.$implicit,n=f(3);K("selected",(n.selectedElement==null?null:n.selectedElement.id)===t.id),p(2),E(t.id),p(2),E(t.type),p(2),E(t.name||"Sin nombre")}}function yh(i,e){i&1&&(s(0,"div",26),d(1," No hay elementos para mostrar "),l())}function Eh(i,e){if(i&1){let t=F();s(0,"div",27)(1,"button",28),C("click",function(){_(t);let o=f(3);return b(o.goToPage(o.currentPage-1))}),d(2,"Anterior"),l(),s(3,"span"),d(4),l(),s(5,"button",28),C("click",function(){_(t);let o=f(3);return b(o.goToPage(o.currentPage+1))}),d(6,"Siguiente"),l()()}if(i&2){let t=f(3);p(),u("disabled",t.currentPage===1),p(3),Mn("",t.currentPage," / ",t.totalPages,""),p(),u("disabled",t.currentPage===t.totalPages)}}function wh(i,e){if(i&1){let t=F();s(0,"div",14)(1,"div",15)(2,"span"),d(3,"Filtrar por tipo:"),l(),s(4,"div",16)(5,"button",11),C("click",function(){_(t);let o=f(2);return b(o.filterByType(null))}),d(6,"Todos"),l(),y(7,bh,2,3,"button",17),l()(),s(8,"div",18),y(9,Ch,7,5,"div",19)(10,yh,2,0,"div",20),l(),y(11,Eh,7,4,"div",21),l()}if(i&2){let t=f(2);p(5),K("selected",t.elementTypeFilter===null),p(2),u("ngForOf",t.elementTypes),p(2),u("ngForOf",t.getCurrentPageElements()),p(),u("ngIf",t.getCurrentPageElements().length===0),p(),u("ngIf",t.totalPages>1)}}function xh(i,e){if(i&1){let t=F();s(0,"button",37),C("click",function(){_(t);let o=f(3);return b(o.searchControl.setValue(""))}),d(1,"\u2715"),l()}}function Sh(i,e){i&1&&(s(0,"span",38),d(1,"\u{1F50D}"),l())}function Mh(i,e){i&1&&D(0,"div",39)}function Th(i,e){if(i&1){let t=F();s(0,"div",22),C("click",function(){let o=_(t).$implicit,r=f(3);return b(r.selectElement(o))}),s(1,"div",23),d(2),l(),s(3,"div",24),d(4),l(),s(5,"div",25),d(6),l()()}if(i&2){let t=e.$implicit,n=f(3);K("selected",(n.selectedElement==null?null:n.selectedElement.id)===t.id),p(2),E(t.id),p(2),E(t.type),p(2),E(t.name||"Sin nombre")}}function Ph(i,e){i&1&&(s(0,"div",40),d(1," No se encontraron resultados "),l())}function Oh(i,e){i&1&&(s(0,"div",41),d(1," Ingresa un texto para buscar "),l())}function kh(i,e){if(i&1&&(s(0,"div",14)(1,"div",29)(2,"div",30),D(3,"input",31),y(4,xh,2,0,"button",32)(5,Sh,2,0,"span",33)(6,Mh,1,0,"div",34),l(),s(7,"div",18),y(8,Th,7,5,"div",19)(9,Ph,2,0,"div",35)(10,Oh,2,0,"div",36),l()()()),i&2){let t=f(2);p(3),u("formControl",t.searchControl),p(),u("ngIf",t.searchControl.value),p(),u("ngIf",!t.isSearching),p(),u("ngIf",t.isSearching),p(2),u("ngForOf",t.searchResults),p(),u("ngIf",t.searchResults.length===0&&t.searchControl.value),p(),u("ngIf",!t.searchControl.value)}}function Dh(i,e){if(i&1&&(s(0,"option",50),d(1),l()),i&2){let t=e.$implicit;u("value",t),p(),E(t)}}function Ih(i,e){if(i&1){let t=F();s(0,"div",14)(1,"div",42)(2,"form",43),C("ngSubmit",function(){_(t);let o=f(2);return b(o.applyAdvancedFilters())}),s(3,"div",44)(4,"label"),d(5,"Tipo de elemento"),l(),s(6,"select",45),y(7,Dh,2,2,"option",46),l()(),s(8,"div",47)(9,"button",48),d(10,"Aplicar"),l(),s(11,"button",49),C("click",function(){_(t);let o=f(2);return b(o.resetAdvancedFilters())}),d(12,"Limpiar"),l()()()()()}if(i&2){let t=f(2);p(2),u("formGroup",t.advancedFiltersForm),p(5),u("ngForOf",t.elementTypes)}}function Ah(i,e){if(i&1){let t=F();s(0,"div",8)(1,"div",9)(2,"div",10)(3,"button",11),C("click",function(){_(t);let o=f();return b(o.setActiveTab("elements"))}),d(4,"Elementos"),l(),s(5,"button",11),C("click",function(){_(t);let o=f();return b(o.setActiveTab("search"))}),d(6,"B\xFAsqueda"),l(),y(7,_h,2,2,"button",12),l(),y(8,wh,12,6,"div",13)(9,kh,11,7,"div",13)(10,Ih,13,2,"div",13),l()()}if(i&2){let t=f();p(3),K("active",t.activeTab==="elements"),p(2),K("active",t.activeTab==="search"),p(2),u("ngIf",t.showFilters),p(),u("ngIf",t.activeTab==="elements"),p(),u("ngIf",t.activeTab==="search"),p(),u("ngIf",t.activeTab==="filters"&&t.showFilters)}}var tr=class i extends er{constructor(t,n,o,r,a,c){super(t,n,o,r);this.snackBar=a;this.interactionService=c;this.position="right",this.loadSavedPosition()}autoUpdateOnMapMove=!0;isDraggable=!1;panelPosition=null;toggleDraggable(){this.isDraggable=!this.isDraggable,this.showMessage(this.isDraggable?"Panel desbloqueado":"Panel bloqueado")}onPanelDragEnded(t){if(this.isDraggable){let o=t.source.element.nativeElement.getBoundingClientRect();this.panelPosition={x:o.left,y:o.top},this.saveCurrentPosition()}}saveCurrentPosition(){if(this.panelPosition)try{localStorage.setItem("elements-panel-position",JSON.stringify(this.panelPosition))}catch(t){this.logger.warn("No se pudo guardar la posici\xF3n del panel",t)}}loadSavedPosition(){try{let t=localStorage.getItem("elements-panel-position");t&&(this.panelPosition=JSON.parse(t))}catch(t){this.logger.warn("No se pudo cargar la posici\xF3n guardada del panel",t)}}ngOnInit(){super.ngOnInit();let t=this.mapStateManager;this.autoUpdateOnMapMove&&t.mapMoved&&t.mapMoved.pipe(R(this.destroy$)).subscribe(()=>{this.logger.info("Map moved, re-applying filters to load elements from server."),this.applyFilters()})}loadElementsInMapBounds(){this.logger.info("loadElementsInMapBounds called, re-applying filters."),this.applyFilters()}showMessage(t){this.snackBar.open(t,"Cerrar",{duration:5e3,panelClass:["info-snackbar"]})}selectElement(t){super.selectElement(t),this.interactionService.selectElement(t)}toggleAutoUpdate(){this.autoUpdateOnMapMove=!this.autoUpdateOnMapMove,this.autoUpdateOnMapMove&&this.loadElementsInMapBounds()}handleError(t,n){super.handleError(t,n),this.showMessage(`${t}: ${n?.message||"Error desconocido"}`)}refreshElements(){this.logger.info("Refreshing elements by calling applyFilters()."),this.applyFilters(),this.showMessage("Panel de elementos actualizado")}applyAdvancedFilters(){this.applyFilters(),this.activeTab="elements",this.showMessage("Filtros aplicados al panel de mapa")}resetAdvancedFilters(){this.elementTypeFilter=null,this.applyFilters(),this.showMessage("Filtros restablecidos")}saveFilterSet(){this.showMessage("Esta funci\xF3n no est\xE1 disponible en el panel de mapa")}loadFilterSet(t){this.showMessage("Esta funci\xF3n no est\xE1 disponible en el panel de mapa")}removeActiveFilter(t){}static \u0275fac=function(n){return new(n||i)(I(qn),I(gt),I(G),I(Yi),I(He),I(Eo))};static \u0275cmp=q({type:i,selectors:[["app-elements-panel"]],features:[ln],decls:11,vars:11,consts:[["cdkDrag","",1,"elements-panel-container",3,"cdkDragEnded","ngClass","cdkDragDisabled","cdkDragBoundary"],["cdkDragHandle","",1,"panel-header",3,"mousedown"],["mat-icon-button","",3,"click","matTooltip"],["class","panel-title",4,"ngIf"],[1,"spacer"],["mat-icon-button","",3,"click"],["class","panel-content",4,"ngIf"],[1,"panel-title"],[1,"panel-content"],[1,"tab-container"],[1,"tab-header"],[3,"click"],[3,"active","click",4,"ngIf"],["class","tab-content",4,"ngIf"],[1,"tab-content"],[1,"quick-filter"],[1,"type-toggle-group"],[3,"selected","click",4,"ngFor","ngForOf"],[1,"elements-list"],["class","element-item",3,"selected","click",4,"ngFor","ngForOf"],["class","no-elements",4,"ngIf"],["class","pagination",4,"ngIf"],[1,"element-item",3,"click"],[1,"element-id"],[1,"element-type"],[1,"element-name"],[1,"no-elements"],[1,"pagination"],[3,"click","disabled"],[1,"search-container"],[1,"search-input"],["placeholder","Buscar por ID, nombre o descripci\xF3n",3,"formControl"],["class","clear-button",3,"click",4,"ngIf"],["class","search-icon",4,"ngIf"],["class","search-spinner",4,"ngIf"],["class","no-results",4,"ngIf"],["class","search-hint",4,"ngIf"],[1,"clear-button",3,"click"],[1,"search-icon"],[1,"search-spinner"],[1,"no-results"],[1,"search-hint"],[1,"filters-form"],[3,"ngSubmit","formGroup"],[1,"form-group"],["formControlName","types","multiple",""],[3,"value",4,"ngFor","ngForOf"],[1,"form-actions"],["type","submit",1,"primary-button"],["type","button",1,"secondary-button",3,"click"],[3,"value"]],template:function(n,o){n&1&&(s(0,"div",0),C("cdkDragEnded",function(a){return o.onPanelDragEnded(a)}),s(1,"div",1),C("mousedown",function(a){return a.stopPropagation()}),s(2,"button",2),C("click",function(){return o.toggleDraggable()}),s(3,"mat-icon"),d(4),l()(),y(5,vh,2,0,"h3",3),D(6,"span",4),s(7,"button",5),C("click",function(){return o.toggleExpansion()}),s(8,"mat-icon"),d(9),l()()(),y(10,Ah,11,8,"div",6),l()),n&2&&(u("ngClass",Hi(8,fh,o.isExpanded,!o.isDraggable))("cdkDragDisabled",!o.isDraggable)("cdkDragBoundary",".map-container"),p(2),u("matTooltip",o.isDraggable?"Desactivar arrastre":"Activar arrastre"),p(2),E(o.isDraggable?"lock_open":"lock"),p(),u("ngIf",o.isExpanded),p(4),E(o.isExpanded?"chevron_left":"chevron_right"),p(),u("ngIf",o.isExpanded))},dependencies:[X,pt,je,ie,Ji,Ll,$l,Ul,Ln,jl,Fn,Nl,zl,Bl,Vl,Xo,Yo,Zo,he,Ne,le,de,Gn,Wn,Kn,cc,Ue,Ee,Me,mt,mc,Un,Rc,Zt,Kt,dc,Lc,gc,Yn,Dn,qt,Fc],styles:[`:host{display:block;height:100%}.elements-panel-container{height:100%;width:320px;background:#fff;box-shadow:0 2px 10px #0000001a;display:flex;flex-direction:column;transition:width .3s ease;overflow:hidden}.elements-panel-container.expanded{width:320px}.elements-panel-container:not(.expanded){width:50px}.panel-header{height:48px;display:flex;align-items:center;padding:0 16px;background-color:#3f51b5;color:#fff;font-weight:500}.spacer{flex:1}.panel-content{flex:1;display:flex;flex-direction:column;overflow:hidden}.tab-container{display:flex;flex-direction:column;height:100%}.tab-header{display:flex;border-bottom:1px solid #e0e0e0}.tab-header button{flex:1;padding:12px;background:none;border:none;cursor:pointer;font-size:14px;color:#757575;transition:all .2s}.tab-header button.active{color:#3f51b5;border-bottom:2px solid #3f51b5;font-weight:500}.tab-content{flex:1;overflow-y:auto;padding:16px}.quick-filter{margin-bottom:16px}.quick-filter span{display:block;font-size:12px;margin-bottom:8px;color:#757575}.type-toggle-group{display:flex;flex-wrap:wrap;gap:4px}.type-toggle-group button{padding:6px 12px;font-size:12px;border:1px solid #e0e0e0;border-radius:4px;background:#fff;cursor:pointer;transition:all .2s}.type-toggle-group button.selected{background:#e3f2fd;border-color:#2196f3;color:#2196f3}.elements-list{display:flex;flex-direction:column;gap:4px}.element-item{padding:8px 12px;border-left:3px solid transparent;cursor:pointer;transition:all .2s}.element-item:hover{background-color:#f5f5f5}.element-item.selected{border-left-color:#3f51b5;background-color:#3f51b514}.element-id{font-weight:500;font-size:14px}.element-type{font-size:12px;color:#757575;margin-top:2px}.element-name{font-size:13px;margin-top:2px}.pagination{display:flex;justify-content:space-between;align-items:center;padding-top:16px;border-top:1px solid #f0f0f0;margin-top:16px}.pagination button{padding:6px 12px;background:#f5f5f5;border:1px solid #e0e0e0;border-radius:4px;cursor:pointer}.pagination button:disabled{opacity:.5;cursor:default}.search-container{display:flex;flex-direction:column;gap:16px}.search-input{position:relative;display:flex;align-items:center}.search-input input{width:100%;padding:10px 40px 10px 16px;border:1px solid #e0e0e0;border-radius:4px;font-size:14px}.search-icon,.clear-button{position:absolute;right:12px}.clear-button{border:none;background:none;cursor:pointer;color:#757575}.search-spinner{width:20px;height:20px;border:2px solid rgba(63,81,181,.3);border-top-color:#3f51b5;border-radius:50%;position:absolute;right:12px;animation:spin 1s linear infinite}@keyframes spin{to{transform:rotate(360deg)}}.no-elements,.no-results,.search-hint{text-align:center;color:#757575;font-style:italic;padding:20px 0}.filters-form{display:flex;flex-direction:column;gap:16px}.form-group{display:flex;flex-direction:column;gap:8px}.form-group label{font-size:12px;font-weight:500;color:#757575}.form-group select{padding:10px;border:1px solid #e0e0e0;border-radius:4px}.form-actions{display:flex;gap:8px;margin-top:16px}.primary-button{padding:8px 16px;background:#3f51b5;color:#fff;border:none;border-radius:4px;cursor:pointer}.secondary-button{padding:8px 16px;background:#fff;color:#3f51b5;border:1px solid #3f51b5;border-radius:4px;cursor:pointer}
`],encapsulation:2,data:{animation:[Ft("expandCollapse",[_i("expanded",pe({width:"350px",opacity:1})),_i("collapsed",pe({width:"0px",opacity:.9})),Ct("expanded <=> collapsed",ot("300ms ease-in-out"))]),Ft("fadeIn",[Ct(":enter",[pe({opacity:0}),ot("200ms",pe({opacity:1}))])])]}})};var ir=(r=>(r.LOW="LOW",r.MEDIUM="MEDIUM",r.HIGH="HIGH",r.ULTRA="ULTRA",r.AUTO="AUTO",r))(ir||{}),nr=class i{performanceService=M(Zn);logger=M(G);performanceMetricsSubject=new ce({fps:0,renderTime:0,elementCount:0,memoryUsage:0,elapsed:0});mapStatisticsSubject=new ce({totalElements:0,totalConnections:0,visibleConnections:0,totalAlerts:0,performanceLevel:"Desconocido",memoryUsageFormatted:"0 MB",loadTime:0});optimizationConfigSubject=new ce({level:"AUTO",autoOptimize:!0,maxVisibleElements:1e3,clusteringEnabled:!0,virtualScrollingEnabled:!0});performanceMetrics=this.performanceMetricsSubject.asObservable();mapStatistics=this.mapStatisticsSubject.asObservable();optimizationConfig=this.optimizationConfigSubject.asObservable();lastPerformanceScore=0;constructor(){this.initializeSubscriptions(),this.logger.debug("MapRenderingService inicializado - Adaptador para MapPerformanceService")}initializeSubscriptions(){this.performanceService.getMetrics().subscribe(e=>{this.performanceMetricsSubject.next(e),this.calculatePerformanceScore()}),this.performanceService.getMapStatistics().subscribe(e=>{this.mapStatisticsSubject.next(e)}),this.performanceService.config$.subscribe(e=>{this.optimizationConfigSubject.next({level:this.determineOptimizationLevel(e),autoOptimize:e.autoOptimize,maxVisibleElements:e.maxVisibleElements,clusteringEnabled:e.enableClustering,virtualScrollingEnabled:e.enableVirtualization})})}determineOptimizationLevel(e){return e.autoOptimize?"AUTO":e.enableClustering&&e.enableVirtualization?"HIGH":e.enableClustering||e.enableVirtualization?"MEDIUM":"LOW"}calculatePerformanceScore(){let e=this.performanceMetricsSubject.value,t=Math.min(e.fps/60,1),n=Math.max(0,1-e.renderTime/100),o=1;e.elementCount>1e3&&(o=Math.max(.5,1e3/e.elementCount));let r=(t*.5+n*.3+o*.2)*100;return this.lastPerformanceScore=Math.round(r),this.lastPerformanceScore}setOptimizationLevel(e){let t=this.optimizationConfigSubject.value;this.optimizationConfigSubject.next(W(O({},t),{level:e})),this.performanceService.updateConfig({autoOptimize:e==="AUTO",enableClustering:e!=="LOW",enableVirtualization:e==="HIGH"||e==="ULTRA"}),this.logger.debug(`Nivel de optimizaci\xF3n actualizado a: ${e}`)}setAutoOptimization(e){let t=this.optimizationConfigSubject.value;this.optimizationConfigSubject.next(W(O({},t),{autoOptimize:e,level:e?"AUTO":t.level})),this.performanceService.updateConfig({autoOptimize:e}),this.logger.debug(`Optimizaci\xF3n autom\xE1tica ${e?"activada":"desactivada"}`)}static \u0275fac=function(t){return new(t||i)};static \u0275prov=k({token:i,factory:i.\u0275fac,providedIn:"root"})};var Fa=i=>({active:i}),Rh=(i,e,t,n)=>[i,e,t,n];function Lh(i,e){i&1&&(s(0,"span"),d(1,"Rendimiento"),l())}function Fh(i,e){if(i&1&&(s(0,"div",23)(1,"div",24)(2,"span",25),d(3,"Elementos:"),l(),s(4,"span",20),d(5),l()(),s(6,"div",24)(7,"span",25),d(8,"Conexiones:"),l(),s(9,"span",20),d(10),l()(),s(11,"div",24)(12,"span",25),d(13,"Conexiones visibles:"),l(),s(14,"span",20),d(15),l()(),s(16,"div",24)(17,"span",25),d(18,"Memoria:"),l(),s(19,"span",20),d(20),l()(),s(21,"div",24)(22,"span",25),d(23,"Nivel:"),l(),s(24,"span",20),d(25),l()()()),i&2){let t=f(3);p(5),E(t.statistics.totalElements),p(5),E(t.statistics.totalConnections),p(5),E(t.statistics.visibleConnections),p(5),E(t.statistics.memoryUsageFormatted),p(5),E(t.statistics.performanceLevel)}}function zh(i,e){if(i&1&&(s(0,"div",13)(1,"div",14)(2,"div",15)(3,"span",16),d(4),l()(),s(5,"div",17),d(6,"Puntuaci\xF3n de rendimiento"),l()(),s(7,"div",18)(8,"div",19)(9,"div",20),d(10),l(),s(11,"div",21),d(12,"FPS"),l()(),s(13,"div",19)(14,"div",20),d(15),l(),s(16,"div",21),d(17,"ms"),l()()(),y(18,Fh,26,5,"div",22),l()),i&2){let t=f(2);p(2),u("ngClass",t.getPerformanceClass()),p(2),E(t.performanceScore),p(6),E(t.formatFps(t.metrics.fps)),p(5),E(t.metrics.renderTime.toFixed(1)),p(3),u("ngIf",t.statistics)}}function Bh(i,e){if(i&1){let t=F();s(0,"button",35),C("click",function(){let o=_(t).$implicit,r=f(4);return b(r.setOptimizationLevel(o))}),d(1),l()}if(i&2){let t=e.$implicit,n=f(4);u("ngClass",_t(2,Fa,n.currentOptimizationLevel===t)),p(),V(" ",t," ")}}function Vh(i,e){if(i&1&&(s(0,"div",27)(1,"label"),d(2,"Nivel de optimizaci\xF3n"),l(),s(3,"div",33),y(4,Bh,2,4,"button",34),l()()),i&2){let t=f(3);p(4),u("ngForOf",ol(1,Rh,t.optLevels.LOW,t.optLevels.MEDIUM,t.optLevels.HIGH,t.optLevels.ULTRA))}}function $h(i,e){i&1&&(s(0,"p"),d(1," La optimizaci\xF3n autom\xE1tica ajusta el rendimiento seg\xFAn las condiciones actuales. "),l())}function jh(i,e){i&1&&(s(0,"p"),d(1," Has seleccionado optimizaci\xF3n manual. Selecciona el nivel adecuado para tu hardware. "),l())}function Uh(i,e){if(i&1){let t=F();s(0,"div",13)(1,"div",26)(2,"div",27)(3,"label"),d(4,"Optimizaci\xF3n autom\xE1tica"),l(),s(5,"div",28)(6,"input",29),C("change",function(){_(t);let o=f(2);return b(o.toggleAutoOptimization())}),l(),D(7,"span",30),l()(),y(8,Vh,5,6,"div",31),s(9,"div",32),y(10,$h,2,0,"p",4)(11,jh,2,0,"p",4),l()()()}if(i&2){let t=f(2);p(6),u("checked",t.autoOptimizationEnabled),p(2),u("ngIf",!t.autoOptimizationEnabled),p(2),u("ngIf",t.autoOptimizationEnabled),p(),u("ngIf",!t.autoOptimizationEnabled)}}function Hh(i,e){if(i&1){let t=F();s(0,"div",9)(1,"div",10)(2,"button",11),C("click",function(){_(t);let o=f();return b(o.setActiveTab("performance"))}),d(3," M\xE9tricas "),l(),s(4,"button",11),C("click",function(){_(t);let o=f();return b(o.setActiveTab("optimization"))}),d(5," Optimizaci\xF3n "),l()(),y(6,zh,19,5,"div",12)(7,Uh,12,4,"div",12),l()}if(i&2){let t=f();p(2),u("ngClass",_t(4,Fa,t.activeTab==="performance")),p(2),u("ngClass",_t(6,Fa,t.activeTab==="optimization")),p(2),u("ngIf",t.activeTab==="performance"&&t.metrics),p(),u("ngIf",t.activeTab==="optimization")}}var or=class i{constructor(e,t){this.renderingService=e;this.cdr=t}expanded=!1;position="bottom-right";metrics=null;statistics=null;performanceScore=0;optLevels=ir;currentOptimizationLevel="AUTO";autoOptimizationEnabled=!0;isExpanded=!1;activeTab="performance";destroy$=new N;updateView$=new N;ngOnInit(){this.isExpanded=this.expanded,this.updateView$.pipe(wn(16),R(this.destroy$)).subscribe(()=>this.cdr.detectChanges()),this.renderingService.performanceMetrics.pipe(R(this.destroy$)).subscribe(e=>{this.metrics=e,this.performanceScore=this.renderingService.calculatePerformanceScore(),this.updateView$.next()}),this.renderingService.mapStatistics.pipe(R(this.destroy$)).subscribe(e=>{this.statistics=e,this.updateView$.next()}),this.renderingService.optimizationConfig.pipe(R(this.destroy$)).subscribe(e=>{this.currentOptimizationLevel=e.level,this.updateView$.next()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.updateView$.complete()}toggleExpand(){this.isExpanded=!this.isExpanded,this.cdr.markForCheck()}setActiveTab(e){this.activeTab!==e&&(this.activeTab=e,this.cdr.markForCheck())}setOptimizationLevel(e){e!==this.currentOptimizationLevel&&(Object.values(ir).includes(e)?(this.renderingService.setOptimizationLevel(e),this.currentOptimizationLevel=e,this.cdr.markForCheck()):console.warn(`Nivel de optimizaci\xF3n no v\xE1lido: ${e}`))}toggleAutoOptimization(){this.autoOptimizationEnabled=!this.autoOptimizationEnabled,this.renderingService.setAutoOptimization(this.autoOptimizationEnabled),this.cdr.markForCheck()}getPerformanceClass(){return this.performanceScore?this.performanceScore>=80?"high":this.performanceScore>=50?"medium":"low":"unknown"}formatFps(e){return e===void 0||isNaN(e)?"0":e.toFixed(0)}static \u0275fac=function(t){return new(t||i)(I(nr),I($e))};static \u0275cmp=q({type:i,selectors:[["app-performance-widget"]],inputs:{expanded:"expanded",position:"position"},decls:11,vars:5,consts:[[1,"performance-widget",3,"ngClass"],[1,"panel-header"],[1,"panel-title"],[1,"fa","fa-tachometer-alt"],[4,"ngIf"],[1,"performance-indicator",3,"ngClass"],[1,"panel-actions"],["mat-icon-button","",3,"click"],["class","panel-content",4,"ngIf"],[1,"panel-content"],[1,"tabs"],[1,"tab-button",3,"click","ngClass"],["class","tab-content",4,"ngIf"],[1,"tab-content"],[1,"performance-score"],[1,"score-gauge",3,"ngClass"],[1,"score-value"],[1,"score-label"],[1,"metrics-grid"],[1,"metric-item"],[1,"metric-value"],[1,"metric-label"],["class","metrics-list",4,"ngIf"],[1,"metrics-list"],[1,"metric-row"],[1,"metric-name"],[1,"optimization-controls"],[1,"control-group"],[1,"toggle-switch"],["type","checkbox",3,"change","checked"],[1,"slider"],["class","control-group",4,"ngIf"],[1,"optimization-info"],[1,"optimization-levels"],["class","level-button",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"level-button",3,"click","ngClass"]],template:function(t,n){t&1&&(s(0,"div",0)(1,"div",1)(2,"h2",2),D(3,"i",3),y(4,Lh,2,0,"span",4),D(5,"div",5),l(),s(6,"div",6)(7,"button",7),C("click",function(){return n.toggleExpand()}),s(8,"mat-icon"),d(9),l()()()(),y(10,Hh,8,8,"div",8),l()),t&2&&(u("ngClass",n.position),p(4),u("ngIf",n.isExpanded),p(),u("ngClass",n.getPerformanceClass()),p(4),E(n.isExpanded?"expand_less":"expand_more"),p(),u("ngIf",n.isExpanded))},dependencies:[X,pt,je,ie,le,de],styles:['@charset "UTF-8";[_ngcontent-%COMP%]:root{--primary-color: #3F51B5;--primary-rgb: 63, 81, 181;--primary-color-hover: rgb(52.4655737705, 67.4557377049, 150.7344262295);--accent-color: #FF4081;--warn-color: #F44336;--background-color: #F5F5F5;--surface-color: #ffffff;--surface-lighter: #f9f9f9;--surface-darker: #eeeeee;--text-color: #212121;--text-secondary-color: hsl(0, 0%, -12.0588235294%);--text-hint-color: hsl(0, 0%, -32.0588235294%);--text-disabled-color: hsl(0, 0%, -52.0588235294%);--primary-contrast-color: white;--accent-contrast-color: white;--warn-contrast-color: white;--olt-color: #4CAF50;--ont-color: #2196F3;--odf-color: #FFC107;--edfa-color: #9C27B0;--splitter-color: #FF5722;--manga-color: #607D8B;--terminal-box-color: #FF9800;--slack-fiber-color: #80DEEA;--spacing-unit: 4px;--spacing-xxs: .125rem;--spacing-xs: .25rem;--spacing-sm: .5rem;--spacing-md: .75rem;--spacing-lg: 1rem;--spacing-xl: 1.5rem;--spacing-xxl: 2rem;--shadow-xs: 0 1px 2px rgba(0,0,0,.05);--shadow-sm: 0 1px 3px rgba(0, 0, 0, .1);--shadow-md: 0 2px 4px rgba(0, 0, 0, .1);--shadow-lg: 0 4px 6px rgba(0, 0, 0, .1);--border-radius-sm: 2px;--border-radius-md: 4px;--border-radius-lg: 8px;--border-radius-round: 50%;--border-color: #e0e0e0;--border-width-normal: 1px;--border-width-strong: 4px;--border-radius-pill: 20px;--border-color-light: rgb(249.5, 249.5, 249.5);--border-color-dark: rgb(198.5, 198.5, 198.5);--color-success: #4caf50;--color-warning: #ff8f00;--color-danger: #c62828;--color-info: #2196F3;--color-neutral: #9e9e9e;--color-success-bg: #e8f5e9;--color-warning-bg: #fff8e1;--color-danger-bg: #ffebee;--color-info-bg: rgb(226.5384615385, 241.5384615385, 253.4615384615);--color-maintenance-bg: #e3f2fd;--status-inactive-fg: #757575;--status-inactive-bg: #f5f5f5;--color-success-contrast: white;--color-warning-contrast: white;--color-danger-contrast: white;--color-info-contrast: #212121;--color-maintenance-contrast: white;--font-family: "Roboto, Segoe UI, sans-serif";--font-size-xxs: .625rem;--font-size-xs: .75rem;--font-size-sm: .875rem;--font-size-md: 1rem;--font-size-lg: 1.125rem;--font-size-xl: 1.25rem;--font-size-xxl: 1.5rem;--font-size-display: 2.5rem;--transition-fast: .15s ease-in-out;--transition-normal: .3s ease-in-out;--transition-slow: .5s ease-in-out;--status-active: #4caf50;--status-inactive: #757575;--status-maintenance: #1565c0;--status-planning: #2196F3;--status-unknown: var(--color-neutral);--status-fault: #c62828;--surface-overlay-light: rgba(255, 255, 255, .85);--surface-overlay-light-strong: rgba(255, 255, 255, .95);--border-color-semitransparent: rgba(0, 0, 0, .1);--primary-bg-subtle: rgba(63, 81, 181, .15);--surface-action-hover: rgb(242.8571428571, 242.8571428571, 242.8571428571);--surface-button: var(--surface-color);--surface-button-hover: var(--surface-action-hover);--text-color-button: var(--text-color);--scrollbar-track-color: #f1f1f1;--scrollbar-thumb-color: #c1c1c1;--scrollbar-thumb-hover-color: #a8a8a8;--z-index-map-base: 1;--z-index-map-elements: 5;--z-index-map-widgets-overlay: 50;--z-index-map-overlay: 100;--z-index-network-design-panels: 900;--z-index-debug-info: 999;--z-index-floating-panel-base: 1000;--z-index-performance-widget: 1000;--z-index-elements-panel: 1001;--z-index-layer-control: 1001;--z-index-sidebar: 1005;--z-index-map-legend: 1005;--z-index-sidebar-mobile: 1010;--z-index-loading-overlay: 1050;--z-index-dialog: 1075;--z-index-toolbar: 1100;--z-index-tooltip: 1150;--z-index-map-controls: 1201;--toolbar-height: 46px;--toolbar-button-height: 30px;--toolbar-button-height-mobile: 32px;--action-button-height: 40px;--menu-item-height: 42px;--icon-size-sm: 18px;--icon-size-md: 20px;--tooltip-bg-color: rgba(33, 33, 33, .95);--primary-ripple-color: rgba(var(--primary-rgb), .1)}[_ngcontent-%COMP%]:root.dark-theme, body.dark-theme[_ngcontent-%COMP%]{--background-color: #121212;--surface-color: #1e1e1e;--surface-lighter: rgb(42.75, 42.75, 42.75);--surface-darker: #121212;--text-color: #e0e0e0;--text-secondary-color: rgb(185.75, 185.75, 185.75);--text-hint-color: rgb(147.5, 147.5, 147.5);--text-disabled-color: rgb(109.25, 109.25, 109.25);--border-color: #444444;--border-color-light: rgb(93.5, 93.5, 93.5);--border-color-dark: rgb(42.5, 42.5, 42.5);--color-success-bg: rgb(51.8181818182, 119.1818181818, 57);--color-warning-bg: rgb(174, 133.4, 0);--color-danger-bg: rgb(184, 0, 27.6);--color-info-bg: rgb(8.9230769231, 95.9230769231, 165.0769230769);--color-maintenance-bg: rgb(11.6, 98.6, 162.4);--shadow-xs: 0 1px 2px rgba(0,0,0,.3);--shadow-sm: 0 1px 3px rgba(0,0,0,.4);--shadow-md: 0 2px 4px rgba(0,0,0,.5);--shadow-lg: 0 4px 6px rgba(0,0,0,.5);--surface-overlay-light: rgba(40, 40, 40, .85);--surface-overlay-light-strong: rgba(30, 30, 30, .95);--border-color-semitransparent: rgba(255, 255, 255, .1);--status-inactive-fg: hsl(0, 0%, 100.8823529412%);--status-inactive-bg: #383838;--primary-bg-subtle: rgba(63, 81, 181, .25);--surface-action-hover: rgb(55.5, 55.5, 55.5);--surface-button: var(--surface-color);--surface-button-hover: var(--surface-action-hover);--text-color-button: var(--text-color);--scrollbar-track-color: #333333;--scrollbar-thumb-color: #666666;--scrollbar-thumb-hover-color: #888888}.standard-panel-ui[_ngcontent-%COMP%]{background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-lg);overflow:hidden;display:flex;flex-direction:column}.standard-panel-ui[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-md);background-color:var(--surface-lighter);border-bottom:1px solid var(--border-color)}.standard-panel-ui[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:var(--font-size-md);font-weight:500;color:var(--text-color)}.standard-panel-ui[_ngcontent-%COMP%]   .panel-content[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-content[_ngcontent-%COMP%]{padding:var(--spacing-md);flex-grow:1;overflow-y:auto;color:var(--text-color)}.standard-panel-ui[_ngcontent-%COMP%]   .panel-actions[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:var(--spacing-sm);padding:var(--spacing-sm) var(--spacing-md);border-top:1px solid var(--border-color)}.standard-panel-ui[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]{display:flex;margin-bottom:var(--spacing-sm)}.standard-panel-ui[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]   .info-label[_ngcontent-%COMP%]{width:100px;font-weight:500;color:var(--text-secondary-color)}.standard-panel-ui[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]   .info-value[_ngcontent-%COMP%]{flex:1;color:var(--text-color)}.simple-panel-ui[_ngcontent-%COMP%]{background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-lg);padding:var(--spacing-md);color:var(--text-color)}.side-panel[_ngcontent-%COMP%]{background-color:var(--surface-color);border-radius:var(--border-radius-sm, 4px);box-shadow:var(--shadow-sm, 0 2px 10px rgba(0, 0, 0, .08));height:100%;width:var(--side-panel-width, 320px);display:flex;flex-direction:column;overflow:hidden}@media (max-width: 768px){.side-panel[_ngcontent-%COMP%]{width:var(--side-panel-width-tablet, 280px)}}@media (max-width: 600px){.side-panel[_ngcontent-%COMP%]{width:var(--side-panel-width-mobile, 100%);max-width:100vw}}.side-panel[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%]{height:var(--panel-header-height, 44px);min-height:var(--panel-header-height, 44px);display:flex;align-items:center;justify-content:space-between;padding:0 var(--spacing-sm);border-bottom:1px solid var(--border-color, rgba(0, 0, 0, .1))}.side-panel[_ngcontent-%COMP%]   .panel-content[_ngcontent-%COMP%]{flex:1;overflow:auto}.map-base-container[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;overflow:hidden;background-color:var(--background-color);transition:background-color var(--transition-normal)}.network-design[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}.network-design__toolbar[_ngcontent-%COMP%]{padding:0 var(--spacing-md);background-color:var(--primary-color);color:var(--primary-contrast-color);box-shadow:var(--shadow-md)}.network-design__header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-md);background-color:var(--primary-color);color:var(--primary-contrast-color);box-shadow:var(--shadow-md)}.network-design__header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:var(--font-size-xl);font-weight:500}.network-design__main[_ngcontent-%COMP%]{flex:1;display:flex;overflow:hidden;position:relative;padding:var(--spacing-md);background-color:var(--surface-color)}@media (max-width: 768px){.network-design__main[_ngcontent-%COMP%]{margin-left:0;padding:var(--spacing-sm)}}.network-design__main[_ngcontent-%COMP%]   .network-design__map[_ngcontent-%COMP%]{flex:1;position:relative;border-radius:var(--border-radius-md);overflow:hidden;box-shadow:var(--shadow-md);background-color:var(--surface-darker)}.network-design__main[_ngcontent-%COMP%]   .network-design__sidebar[_ngcontent-%COMP%]{width:300px;padding:var(--spacing-md);background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-md);margin-left:var(--spacing-md);overflow-y:auto;border-right:1px solid var(--border-color)}@media (max-width: 768px){.network-design__main[_ngcontent-%COMP%]   .network-design__sidebar[_ngcontent-%COMP%]{width:100%;position:fixed;top:0;left:0;height:100%;z-index:1000;transform:translate(-100%);transition:transform var(--transition-normal);margin-left:0;border-right:none}.network-design__main[_ngcontent-%COMP%]   .network-design__sidebar--open[_ngcontent-%COMP%]{transform:translate(0)}}.network-design__footer[_ngcontent-%COMP%]{padding:var(--spacing-md);background-color:var(--surface-lighter);border-top:1px solid var(--border-color);font-size:var(--font-size-sm);color:var(--text-color)}.network-design__element[_ngcontent-%COMP%]{padding:var(--spacing-md);margin-bottom:var(--spacing-md);background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-sm);transition:box-shadow var(--transition-fast)}.network-design__element[_ngcontent-%COMP%]:hover{box-shadow:var(--shadow-md)}.network-design__element--selected[_ngcontent-%COMP%]{border-left:4px solid var(--primary-color)}.status-badge-base[_ngcontent-%COMP%], .status-maintenance[_ngcontent-%COMP%], .status-warning[_ngcontent-%COMP%], .status-fault[_ngcontent-%COMP%], .status-inactive[_ngcontent-%COMP%], .status-active[_ngcontent-%COMP%]{display:inline-block;padding:var(--spacing-xs) var(--spacing-sm);border-radius:var(--border-radius-sm);font-size:var(--font-size-sm);font-weight:500}.status-active[_ngcontent-%COMP%]{background-color:var(--color-success-bg);color:var(--color-success-contrast)}.status-inactive[_ngcontent-%COMP%]{background-color:var(--status-inactive-bg);color:var(--status-inactive-fg)}.status-fault[_ngcontent-%COMP%]{background-color:var(--color-danger-bg);color:var(--color-danger-contrast)}.status-warning[_ngcontent-%COMP%]{background-color:var(--color-warning-bg);color:var(--color-warning-contrast)}.status-maintenance[_ngcontent-%COMP%]{background-color:var(--color-maintenance-bg);color:var(--color-maintenance-contrast)}.network-utils__status-badge[_ngcontent-%COMP%]{display:inline-block;padding:var(--spacing-xs) var(--spacing-sm);border-radius:var(--border-radius-sm);font-size:var(--font-size-xs);font-weight:500;text-transform:uppercase}.network-utils__status-badge--active[_ngcontent-%COMP%]{background-color:var(--color-success-bg);color:var(--color-success-contrast)}.network-utils__status-badge--inactive[_ngcontent-%COMP%]{background-color:var(--status-inactive-bg);color:var(--status-inactive-fg)}.network-utils__status-badge--maintenance[_ngcontent-%COMP%]{background-color:var(--color-maintenance-bg);color:var(--color-maintenance-contrast)}.network-utils__loading[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:var(--spacing-lg);color:var(--text-color)}.network-utils__error[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-md);background-color:#ffebee;color:var(--color-danger);border-radius:var(--border-radius-md)}.performance-widget[_ngcontent-%COMP%]{display:flex;flex-direction:column;z-index:var(--z-index-floating-panel, 1000);background-color:var(--floating-panel-bg, var(--surface-ground, #fff));border-radius:var(--border-radius-md, 6px);box-shadow:var(--floating-panel-shadow, 0 2px 10px rgba(0, 0, 0, .1));min-width:var(--floating-panel-min-width, 280px);max-width:var(--floating-panel-max-width, 450px);max-height:var(--floating-panel-max-height, 85vh);overflow:hidden;bottom:var(--spacing-md, 16px);right:var(--spacing-md, 16px);min-width:var(--floating-panel-min-width-sm, 200px);max-width:var(--floating-panel-max-width-sm, 350px);--floating-panel-bg: var(--surface-color, #fff);--floating-panel-color: var(--text-color, #333);--floating-panel-shadow: var(--floating-panel-shadow, 0 6px 24px rgba(0, 0, 0, .25), 0 1.5px 4px rgba(0, 0, 0, .15));--floating-panel-header-bg: var(--primary-color, #3f51b5);--floating-panel-width: var(--performance-widget-width, 280px);--floating-panel-max-height: calc(70vh - 100px) ;--floating-panel-content-padding: 0;--floating-panel-header-border: none;--floating-panel-header-bg: var(--primary-color, #1976d2);--floating-panel-header-color: var(--primary-contrast-color, white);position:absolute;bottom:16px;right:16px;z-index:1000;max-width:280px;margin:0}.performance-widget[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:var(--floating-panel-header-padding, 10px) var(--floating-panel-header-padding-x, var(--spacing-md, 16px));border-bottom:var(--floating-panel-header-border, 1px solid var(--border-color-light, rgba(0, 0, 0, .08)));background-color:var(--floating-panel-header-bg, var(--surface-a, #f8f9fa));color:var(--floating-panel-header-color, var(--text-color-secondary, #495057));border-top-left-radius:inherit;border-top-right-radius:inherit;flex-shrink:0}.performance-widget[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%]   .panel-title[_ngcontent-%COMP%]{font-weight:var(--floating-panel-title-weight, 600);font-size:var(--floating-panel-title-font-size, var(--font-size-md, 1rem));margin:0;flex-grow:1;line-height:1.4}.performance-widget[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%]   .panel-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-xs, 8px)}.performance-widget[_ngcontent-%COMP%]   .panel-content[_ngcontent-%COMP%]{padding:var(--floating-panel-content-padding, var(--spacing-md, 16px));max-height:var(--floating-panel-content-max-height, calc(85vh - 100px) );overflow-x:hidden;overflow-y:auto;flex-grow:1;background-color:var(--floating-panel-content-bg, var(--surface-ground, #fff))}.performance-widget[_ngcontent-%COMP%]   .panel-content.no-padding[_ngcontent-%COMP%]{padding:0}.performance-widget[_ngcontent-%COMP%]   .panel-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center;padding:var(--floating-panel-footer-padding, var(--spacing-sm, 12px)) var(--floating-panel-footer-padding-x, var(--spacing-md, 16px));border-top:var(--floating-panel-footer-border, 1px solid var(--border-color-light, rgba(0, 0, 0, .08)));background-color:var(--floating-panel-footer-bg, var(--surface-a, #f8f9fa));border-bottom-left-radius:inherit;border-bottom-right-radius:inherit;flex-shrink:0;gap:var(--spacing-sm, 8px)}@media (max-width: 768px){.performance-widget[_ngcontent-%COMP%]{bottom:60px;right:8px;--floating-panel-width: 240px}}.performance-widget[_ngcontent-%COMP%]   .panel-title[_ngcontent-%COMP%]{display:flex;align-items:center}.performance-widget[_ngcontent-%COMP%]   .panel-title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .performance-widget[_ngcontent-%COMP%]   .panel-title[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:var(--spacing-xs, 8px);font-size:var(--icon-size-md, 16px)}.performance-widget[_ngcontent-%COMP%]   .performance-indicator[_ngcontent-%COMP%]{width:12px;height:12px;border-radius:50%;margin-left:var(--spacing-xs, 4px)}.performance-widget[_ngcontent-%COMP%]   .performance-indicator.high[_ngcontent-%COMP%]{background-color:var(--color-success, #4caf50)}.performance-widget[_ngcontent-%COMP%]   .performance-indicator.medium[_ngcontent-%COMP%]{background-color:var(--color-warning, #ff9800)}.performance-widget[_ngcontent-%COMP%]   .performance-indicator.low[_ngcontent-%COMP%]{background-color:var(--color-danger, #f44336)}.performance-widget[_ngcontent-%COMP%]   .performance-indicator.unknown[_ngcontent-%COMP%]{background-color:var(--color-neutral-light, #bdbdbd)}.tabs[_ngcontent-%COMP%]{display:flex;background-color:var(--surface-lighter, #f5f5f5);border-bottom:1px solid var(--border-color, #e0e0e0)}.tabs[_ngcontent-%COMP%]   .tab-button[_ngcontent-%COMP%]{flex:1;padding:var(--spacing-sm, 10px);background:none;border:none;font-size:var(--font-size-sm, 13px);color:var(--text-color, rgba(0, 0, 0, .87));cursor:pointer;transition:var(--transition-fast, .15s)}.tabs[_ngcontent-%COMP%]   .tab-button[_ngcontent-%COMP%]:hover{background-color:var(--surface-hover, #eeeeee)}.tabs[_ngcontent-%COMP%]   .tab-button.active[_ngcontent-%COMP%]{color:var(--primary-color, #1976d2);font-weight:500;border-bottom:2px solid var(--primary-color, #1976d2)}.tab-content[_ngcontent-%COMP%]{padding:var(--spacing-md, 15px)}.performance-score[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin-bottom:var(--spacing-lg, 20px)}.performance-score[_ngcontent-%COMP%]   .score-gauge[_ngcontent-%COMP%]{width:var(--gauge-size, 80px);height:var(--gauge-size, 80px);border-radius:50%;display:flex;justify-content:center;align-items:center;margin-bottom:var(--spacing-sm, 8px);border-width:2px;border-style:solid}.performance-score[_ngcontent-%COMP%]   .score-gauge.high[_ngcontent-%COMP%]{background-color:var(--color-success-bg, rgba(76, 175, 80, .15));border-color:var(--color-success, #4caf50);color:var(--color-success-dark, #2e7d32)}.performance-score[_ngcontent-%COMP%]   .score-gauge.medium[_ngcontent-%COMP%]{background-color:var(--color-warning-bg, rgba(255, 152, 0, .15));border-color:var(--color-warning, #ff9800);color:var(--color-warning-dark, #ef6c00)}.performance-score[_ngcontent-%COMP%]   .score-gauge.low[_ngcontent-%COMP%]{background-color:var(--color-danger-bg, rgba(244, 67, 54, .15));border-color:var(--color-danger, #f44336);color:var(--color-danger-dark, #c62828)}.performance-score[_ngcontent-%COMP%]   .score-gauge.unknown[_ngcontent-%COMP%]{background-color:var(--color-neutral-bg, rgba(189, 189, 189, .15));border-color:var(--color-neutral-light, #bdbdbd);color:var(--color-neutral-dark, #757575)}.performance-score[_ngcontent-%COMP%]   .score-gauge[_ngcontent-%COMP%]   .score-value[_ngcontent-%COMP%]{font-size:var(--font-size-xxxl, 24px);font-weight:600}.performance-score[_ngcontent-%COMP%]   .score-label[_ngcontent-%COMP%]{font-size:var(--font-size-xs, 12px);color:var(--text-secondary-color, rgba(0, 0, 0, .6))}.metrics-grid[_ngcontent-%COMP%]{display:flex;justify-content:space-around;margin-bottom:var(--spacing-lg, 20px)}.metrics-grid[_ngcontent-%COMP%]   .metric-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.metrics-grid[_ngcontent-%COMP%]   .metric-item[_ngcontent-%COMP%]   .metric-value[_ngcontent-%COMP%]{font-size:var(--font-size-xl, 18px);font-weight:600;color:var(--text-color, rgba(0, 0, 0, .87))}.metrics-grid[_ngcontent-%COMP%]   .metric-item[_ngcontent-%COMP%]   .metric-label[_ngcontent-%COMP%]{font-size:var(--font-size-xs, 12px);color:var(--text-secondary-color, rgba(0, 0, 0, .6))}.metrics-list[_ngcontent-%COMP%]{background-color:var(--surface-lighter, #f9f9f9);border-radius:var(--border-radius-sm, 4px);padding:var(--spacing-sm, 10px)}.metrics-list[_ngcontent-%COMP%]   .metric-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:var(--spacing-xs, 6px) 0;font-size:var(--font-size-sm, 13px);border-bottom:1px solid var(--border-color-light, #eeeeee)}.metrics-list[_ngcontent-%COMP%]   .metric-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.metrics-list[_ngcontent-%COMP%]   .metric-row[_ngcontent-%COMP%]   .metric-name[_ngcontent-%COMP%]{color:var(--text-secondary-color, rgba(0, 0, 0, .6))}.metrics-list[_ngcontent-%COMP%]   .metric-row[_ngcontent-%COMP%]   .metric-value[_ngcontent-%COMP%]{font-weight:500;color:var(--text-color, rgba(0, 0, 0, .87))}.optimization-controls[_ngcontent-%COMP%]   .control-group[_ngcontent-%COMP%]{margin-bottom:var(--spacing-md, 15px)}.optimization-controls[_ngcontent-%COMP%]   .control-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:var(--spacing-sm, 8px);font-size:var(--font-size-sm, 13px);font-weight:500}.optimization-controls[_ngcontent-%COMP%]   .toggle-switch[_ngcontent-%COMP%]{position:relative;display:inline-block;width:var(--toggle-width, 44px);height:var(--toggle-height, 24px)}.optimization-controls[_ngcontent-%COMP%]   .toggle-switch[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{opacity:0;width:0;height:0}.optimization-controls[_ngcontent-%COMP%]   .toggle-switch[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]{background-color:var(--primary-color, #1976d2)}.optimization-controls[_ngcontent-%COMP%]   .toggle-switch[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]:before{transform:translate(var(--toggle-thumb-translate, 20px))}.optimization-controls[_ngcontent-%COMP%]   .toggle-switch[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]{position:absolute;cursor:pointer;inset:0;background-color:var(--color-neutral, #ccc);transition:var(--transition-normal, .4s);border-radius:var(--toggle-height, 24px)}.optimization-controls[_ngcontent-%COMP%]   .toggle-switch[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]:before{position:absolute;content:"";height:var(--toggle-thumb-size, 18px);width:var(--toggle-thumb-size, 18px);left:var(--toggle-thumb-margin, 3px);bottom:var(--toggle-thumb-margin, 3px);background-color:#fff;transition:var(--transition-normal, .4s);border-radius:50%}.optimization-controls[_ngcontent-%COMP%]   .optimization-levels[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:var(--spacing-xs, 6px)}.optimization-controls[_ngcontent-%COMP%]   .optimization-levels[_ngcontent-%COMP%]   .level-button[_ngcontent-%COMP%]{padding:var(--spacing-xs, 6px) var(--spacing-sm, 12px);border-radius:var(--border-radius-pill, 16px);border:1px solid var(--border-color, #e0e0e0);background:none;font-size:var(--font-size-xs, 12px);cursor:pointer;text-transform:capitalize;transition:var(--transition-fast, .15s)}.optimization-controls[_ngcontent-%COMP%]   .optimization-levels[_ngcontent-%COMP%]   .level-button[_ngcontent-%COMP%]:hover{background-color:var(--surface-hover, #f5f5f5)}.optimization-controls[_ngcontent-%COMP%]   .optimization-levels[_ngcontent-%COMP%]   .level-button.active[_ngcontent-%COMP%]{background-color:var(--primary-color, #1976d2);color:var(--primary-contrast-color, white);border-color:var(--primary-color, #1976d2)}.optimization-controls[_ngcontent-%COMP%]   .optimization-info[_ngcontent-%COMP%]{margin-top:var(--spacing-md, 15px);padding:var(--spacing-sm, 10px);background-color:var(--surface-lighter, #f5f5f5);border-radius:var(--border-radius-sm, 4px);font-size:var(--font-size-xs, 12px);line-height:1.4;color:var(--text-secondary-color, rgba(0, 0, 0, .6))}@media (max-width: 768px){.performance-widget[_ngcontent-%COMP%]{--floating-panel-width: var(--performance-widget-width-mobile, 240px)}}'],changeDetection:0})};var Qw={OLT:"#E57373",ONT:"#81C784",FDP:"#64B5F6",EDFA:"#FFD54F",SPLITTER:"#BA68C8",MANGA:"#4DB6AC",TERMINAL_BOX:"#F06292",FIBER_CONNECTION:"#A1887F",FIBER_SPLICE:"#FF8A65",FIBER_CABLE:"#7986CB",FIBER_STRAND:"#4FC3F7",FIBER_THREAD:"#4FC3F7",SLACK_FIBER:"#80DEEA",DROP_CABLE:"#9575CD",DISTRIBUTION_CABLE:"#7E57C2",FEEDER_CABLE:"#673AB7",BACKBONE_CABLE:"#5E35B1",MSAN:"#FB8C00",ODF:"#00897B",ROUTER:"#D32F2F",RACK:"#757575",NETWORK_GRAPH:"#0288D1",WDM_FILTER:"#FFA000",COHERENT_TRANSPONDER:"#8D6E63",WAVELENGTH_ROUTER:"#26A69A",OPTICAL_SWITCH:"#7CB342",ROADM:"#AB47BC",CUSTOM:"#607D8B",CABINET:"#795548",CHAMBER:"#8D6E63",POLE:"#BDBDBD",BUILDING:"#546E7A",SITE:"#455A64",NODE:"#37474F",PATCH_PANEL:"#00BCD4",FIBER_CLOSURE:"#26A69A",SWITCH:"#F44336",MULTIPLEXER:"#9C27B0",DEMULTIPLEXER:"#8E24AA",REPEATER:"#3F51B5",ATTENUATOR:"#EC407A",CONNECTOR:"#9E9D24",CROSS_CONNECT:"#AFB42B",SUBSCRIBER:"#1976D2",SERVICE_POINT:"#0097A7",AGGREGATION_POINT:"#00796B",SPLICE_BOX:"#43A047",NAP:"#7CB342",FAT:"#C0CA33",DISTRIBUTION_BOX:"#FDD835",ACCESS_POINT:"#FFB300",HUB:"#FB8C00",GATEWAY:"#F4511E",ROUTE:"#78909C",SERVICE_AREA:"#AED581",MDU_BUILDING:"#B2DFDB",DUCT:"#B0BEC5",WSS:"#90A4AE",RF_OVERLAY_SYSTEM:"#FFD600",MONITORING_SYSTEM:"#00B8D4",OPTICAL_AMPLIFIER:"#EF6C00",default:"#78909C"},Zw={ACTIVE:"#4CAF50",INACTIVE:"#9E9E9E",UNKNOWN:"#9E9E9E",WARNING:"#FFA726",CRITICAL:"#E53935",FAULT:"#E53935",MAINTENANCE:"#42A5F5",PLANNED:"#8D6E63",BUILDING:"#FBC02D",RESERVE:"#7CB342",DECOMMISSIONED:"#78909C",ERROR:"#D32F2F",PLANNING:"#9575CD",default:"#9E9E9E"},ii={OLT:"router",ONT:"devices",FDP:"settings_input_component",EDFA:"amp_stories",SPLITTER:"call_split",MANGA:"track_changes",TERMINAL_BOX:"inbox",FIBER_CONNECTION:"timeline",FIBER_SPLICE:"hub",FIBER_CABLE:"cable",FIBER_STRAND:"fiber_manual_record",FIBER_THREAD:"fiber_manual_record",SLACK_FIBER:"waves",DROP_CABLE:"swap_horiz",DISTRIBUTION_CABLE:"compare_arrows",FEEDER_CABLE:"sync_alt",BACKBONE_CABLE:"all_inclusive",MSAN:"dns",ODF:"grid_view",ROUTER:"wifi",RACK:"inventory_2",NETWORK_GRAPH:"share",WDM_FILTER:"filter_alt",COHERENT_TRANSPONDER:"memory",WAVELENGTH_ROUTER:"settings_input_hdmi",OPTICAL_SWITCH:"switch_right",ROADM:"swap_calls",CUSTOM:"extension",CABINET:"inventory_2",CHAMBER:"architecture",POLE:"candlestick_chart",BUILDING:"apartment",SITE:"location_on",NODE:"hub",PATCH_PANEL:"dashboard",FIBER_CLOSURE:"all_inbox",SWITCH:"swap_horiz",MULTIPLEXER:"call_merge",DEMULTIPLEXER:"call_split",REPEATER:"repeat",ATTENUATOR:"tune",CONNECTOR:"link",CROSS_CONNECT:"compare_arrows",SUBSCRIBER:"person",SERVICE_POINT:"room_service",AGGREGATION_POINT:"merge_type",SPLICE_BOX:"inbox",NAP:"network_cell",FAT:"router",DISTRIBUTION_BOX:"inventory",ACCESS_POINT:"wifi",HUB:"hub",GATEWAY:"vpn_lock",ROUTE:"alt_route",SERVICE_AREA:"map",MDU_BUILDING:"apartment",DUCT:"alt_route",WSS:"settings_ethernet",RF_OVERLAY_SYSTEM:"settings_input_antenna",MONITORING_SYSTEM:"monitor_heart",OPTICAL_AMPLIFIER:"trending_up",default:"device_unknown"},rr={OLT:"Terminal de L\xEDnea \xD3ptica",ONT:"Terminal de Red \xD3ptica",FDP:"Punto de Distribuci\xF3n",EDFA:"Amplificador \xD3ptico",SPLITTER:"Divisor \xD3ptico",MANGA:"Manga",TERMINAL_BOX:"Caja Terminal",FIBER_CONNECTION:"Conexi\xF3n de Fibra",FIBER_SPLICE:"Empalme",FIBER_CABLE:"Cable de Fibra",FIBER_STRAND:"Hilo de Fibra",FIBER_THREAD:"Hilo de Fibra",SLACK_FIBER:"Flojo de Fibra",DROP_CABLE:"Cable de Acometida",DISTRIBUTION_CABLE:"Cable de Distribuci\xF3n",FEEDER_CABLE:"Cable Alimentador",BACKBONE_CABLE:"Cable Troncal",MSAN:"Nodo de Acceso Multi-Servicio",ODF:"Distribuidor de Fibra \xD3ptica",ROUTER:"Router",RACK:"Rack",NETWORK_GRAPH:"Grafo de Red",WDM_FILTER:"Filtro WDM",COHERENT_TRANSPONDER:"Transpondedor Coherente",WAVELENGTH_ROUTER:"Router de Longitudes de Onda",OPTICAL_SWITCH:"Conmutador \xD3ptico",ROADM:"Multiplexor \xD3ptico Reconfigurable",CUSTOM:"Elemento Personalizado",CABINET:"Gabinete",CHAMBER:"C\xE1mara/Pozo",POLE:"Poste",BUILDING:"Edificio",SITE:"Sitio/Local",NODE:"Nodo",PATCH_PANEL:"Panel de Parcheo",FIBER_CLOSURE:"Cierre de Fibra",SWITCH:"Switch",MULTIPLEXER:"Multiplexor",DEMULTIPLEXER:"Demultiplexor",REPEATER:"Repetidor",ATTENUATOR:"Atenuador",CONNECTOR:"Conector",CROSS_CONNECT:"Cruzada",SUBSCRIBER:"Abonado/Cliente",SERVICE_POINT:"Punto de Servicio",AGGREGATION_POINT:"Punto de Agregaci\xF3n",SPLICE_BOX:"Caja de Empalme",NAP:"Punto de Acceso a la Red",FAT:"Terminal de Acceso de Fibra",DISTRIBUTION_BOX:"Caja de Distribuci\xF3n",ACCESS_POINT:"Punto de Acceso",HUB:"Concentrador",GATEWAY:"Pasarela",ROUTE:"Ruta",SERVICE_AREA:"\xC1rea de Servicio",MDU_BUILDING:"Edificio MDU",DUCT:"Ducto/Canalizaci\xF3n",WSS:"Switch Selectivo de Longitud de Onda",RF_OVERLAY_SYSTEM:"Sistema RF Overlay",MONITORING_SYSTEM:"Sistema de Monitorizaci\xF3n",OPTICAL_AMPLIFIER:"Amplificador \xD3ptico",default:"Elemento Desconocido"},Yw={OLT:L(Pe,15*2.5),ONT:L(Xe,15),FDP:L(yi,15*1.5),EDFA:L(Je,15*1.5),SPLITTER:L(bo,15*1.5),MANGA:L(Ci,15*1.5),FIBER_SPLICE:L(gn,15*1.2),FIBER_CABLE:L(Pe,15*1.8),FIBER_STRAND:L(Xe,15*.8),TERMINAL_BOX:L(Je,15*1.5),FIBER_CONNECTION:L(yi,15),FIBER_THREAD:L(Xe,15*.8),SLACK_FIBER:L(gn,15*1.5),DROP_CABLE:L(Pe,15*1.4),DISTRIBUTION_CABLE:L(Pe,15*1.6),FEEDER_CABLE:L(Pe,15*1.8),BACKBONE_CABLE:L(Pe,15*2),MSAN:L(Je,15*2),ODF:L(Pe,15*2.2),ROUTER:L(Je,15*1.8),RACK:L(Pe,15*2.4),NETWORK_GRAPH:L(Xe,15*2.2),WDM_FILTER:L(yi,15*1.8),COHERENT_TRANSPONDER:L(Je,15*1.7),WAVELENGTH_ROUTER:L(gn,15*1.8),OPTICAL_SWITCH:L(bo,15*1.8),ROADM:L(Ci,15*1.8),CUSTOM:L(Xe,15*1.4),CABINET:L(Pe,15*2),CHAMBER:L(Pe,15*1.8),POLE:L(gn,15*2),BUILDING:L(Pe,15*2.8),SITE:L(Je,15*2.2),NODE:L(yi,15*2),PATCH_PANEL:L(Pe,15*2),FIBER_CLOSURE:L(Pe,15*1.6),SWITCH:L(Je,15*1.8),MULTIPLEXER:L(Ci,15*1.7),DEMULTIPLEXER:L(Ci,15*1.7),REPEATER:L(gn,15*1.5),ATTENUATOR:L(bo,15*1.5),CONNECTOR:L(Xe,15*1),CROSS_CONNECT:L(gn,15*1.5),SUBSCRIBER:L(Je,15*1.4),SERVICE_POINT:L(Xe,15*1.2),AGGREGATION_POINT:L(Je,15*1.5),SPLICE_BOX:L(Pe,15*1.5),NAP:L(Je,15*1.4),FAT:L(Pe,15*1.6),DISTRIBUTION_BOX:L(Pe,15*1.5),ACCESS_POINT:L(Xe,15*1.2),HUB:L(Xe,15*2),GATEWAY:L(Je,15*1.8),ROUTE:L(Pe,15*1.2),SERVICE_AREA:L(Xe,15*1.2),MDU_BUILDING:L(Pe,15*1.2),DUCT:L(Pe,15*1.2),WSS:L(Je,15*1.2),RF_OVERLAY_SYSTEM:L(Xe,15*1.2),MONITORING_SYSTEM:L(Xe,15*1.2),OPTICAL_AMPLIFIER:L(Je,15*1.6),default:L(Xe,15)};function L(i,e){return kc().type(i).size(e)()||""}var ar="network-map:user-layer-settings",At=class i{constructor(e,t){this.logger=e;this.networkStateService=t;this.initializeLayerPersistence(),this.subscribeToActiveLayerChangesForPersistence()}destroy$=new N;layerIcons={OLT:"router",ONT:"device_hub",FDP:"cable",SPLITTER:"call_split",EDFA:"electrical_services",MANGA:"cable",TERMINAL_BOX:"inbox",MSAN:"device_hub",ODF:"settings_input_hdmi",ROUTER:"wifi_tethering",RACK:"dns",FIBER_CONNECTION:"timeline",FIBER_THREAD:"linear_scale",FIBER_CABLE:"cable",FIBER_SPLICE:"settings_input_component",FIBER_STRAND:"linear_scale",DROP_CABLE:"settings_ethernet",DISTRIBUTION_CABLE:"settings_ethernet",FEEDER_CABLE:"settings_ethernet",BACKBONE_CABLE:"settings_ethernet",NETWORK_GRAPH:"bubble_chart",WDM_FILTER:"filter_alt",OPTICAL_SWITCH:"swap_horiz",ROADM:"swap_calls",COHERENT_TRANSPONDER:"multiline_chart",WAVELENGTH_ROUTER:"waves",OPTICAL_AMPLIFIER:"trending_up",SLACK_FIBER:"waves"};initializeLayerPersistence(){try{let e=this.loadUserSettings();if(e&&e.activeLayers){let t=new Set(e.activeLayers.filter(n=>this.isValidElementType(n)));this.networkStateService.updateActiveLayers(t),this.logger.debug("LayerManagerService: NetworkStateService.activeLayers inicializado desde localStorage con capas: ",Array.from(t).map(n=>this.getLayerName(n)))}else this.saveUserSettings(this.networkStateService.getCurrentState().activeLayers),this.logger.debug("LayerManagerService: No hay configuraci\xF3n guardada o es inv\xE1lida. Usando estado de NetworkStateService y persistiendo.")}catch(e){this.logger.error("Error al inicializar la persistencia de capas",e),this.saveUserSettings(this.networkStateService.getCurrentState().activeLayers)}}subscribeToActiveLayerChangesForPersistence(){this.networkStateService.state$.pipe(se(e=>e.activeLayers),st((e,t)=>{if(e.size!==t.size)return!1;for(let n of e)if(!t.has(n))return!1;return!0}),R(this.destroy$)).subscribe(e=>{try{this.saveUserSettings(e)}catch(t){this.logger.error("Error al persistir cambios de activeLayers desde NetworkStateService",t)}})}getActiveLayers(){return this.networkStateService.state$.pipe(se(e=>Array.from(e.activeLayers)),st((e,t)=>e.length===t.length&&e.every((n,o)=>n===t[o])))}isLayerActive(e){return this.networkStateService.state$.pipe(se(t=>t.activeLayers.has(e)),st())}isLayerActiveSync(e){try{return this.isValidElementType(e)?this.networkStateService.getCurrentState().activeLayers.has(e):(this.logger.warn(`Verificaci\xF3n de capa activa para tipo no v\xE1lido: ${e}`),!1)}catch(t){return this.logger.error(`Error al verificar si la capa ${this.getLayerName(e)} est\xE1 activa`,t),!1}}toggleLayer(e,t){try{if(!this.isValidElementType(e)){this.logger.warn(`Intento de alternar tipo de elemento no v\xE1lido: ${e}`);return}let n=this.networkStateService.getCurrentState().activeLayers.has(e);if(n===(t!==void 0?t:!n))return;this.networkStateService.toggleLayer(e)}catch(n){this.logger.error(`Error al alternar la capa ${this.getLayerName(e)} en LayerManagerService`,n)}}activateLayers(e){try{let t=e.filter(r=>{let a=this.isValidElementType(r);return a||this.logger.warn(`Tipo de elemento no v\xE1lido al activar: ${r}`),a});if(t.length===0)return;let n=this.networkStateService.getCurrentState().activeLayers,o=t.filter(r=>!n.has(r));if(o.length>0){let r=new Set([...n,...o]);this.networkStateService.updateActiveLayers(r),this.logger.debug("LayerManagerService: M\xFAltiples capas activadas v\xEDa NetworkStateService:",o.map(a=>this.getLayerName(a)))}}catch(t){this.logger.error("Error al activar m\xFAltiples capas en LayerManagerService",t)}}deactivateLayers(e){try{let t=e.filter(r=>{let a=this.isValidElementType(r);return a||this.logger.warn(`Tipo de elemento no v\xE1lido al desactivar: ${r}`),a});if(t.length===0)return;let n=this.networkStateService.getCurrentState().activeLayers,o=t.filter(r=>n.has(r));if(o.length>0){let r=new Set(n);o.forEach(a=>r.delete(a)),this.networkStateService.updateActiveLayers(r),this.logger.debug("LayerManagerService: M\xFAltiples capas desactivadas v\xEDa NetworkStateService:",o.map(a=>this.getLayerName(a)))}}catch(t){this.logger.error("Error al desactivar m\xFAltiples capas en LayerManagerService",t)}}getLayerIcon(e){try{return this.isValidElementType(e)?this.layerIcons[e]||"layers":(this.logger.warn(`Solicitando icono para tipo no v\xE1lido: ${e}`),"warning")}catch(t){return this.logger.error(`Error al obtener icono para la capa ${this.getLayerName(e)}`,t),"error"}}resetToDefaultLayers(){try{let e=new Set(["OLT","ONT","FDP","SPLITTER","ODF"]);this.networkStateService.updateActiveLayers(e),this.logger.debug("LayerManagerService: Capas restablecidas a valores predeterminados en NetworkStateService")}catch(e){this.logger.error("Error al restablecer capas predeterminadas en LayerManagerService",e)}}saveUserSettings(e){try{let t={activeLayers:Array.from(e),lastUpdated:Date.now()};localStorage.setItem(ar,JSON.stringify(t)),this.logger.debug("LayerManagerService: Configuraci\xF3n de capas guardada en localStorage",t.activeLayers)}catch(t){this.logger.error("Error al guardar configuraci\xF3n de capas en localStorage",t)}}loadUserSettings(){try{let e=localStorage.getItem(ar);if(!e)return this.logger.debug("LayerManagerService: No hay configuraci\xF3n de capas guardada en localStorage."),null;let t=JSON.parse(e);return!t||!Array.isArray(t.activeLayers)?(this.logger.warn("LayerManagerService: Configuraci\xF3n de capas en localStorage es inv\xE1lida o corrupta."),localStorage.removeItem(ar),null):(t.activeLayers=t.activeLayers.filter(n=>this.isValidElementType(n)),this.logger.debug("LayerManagerService: Configuraci\xF3n de capas cargada desde localStorage:",t.activeLayers),t)}catch(e){return this.logger.error("Error al cargar configuraci\xF3n de capas desde localStorage",e),localStorage.removeItem(ar),null}}isValidElementType(e){return typeof e=="string"?Object.values(We).includes(e):!1}getLayerName(e){try{let t=We[e];return t!==void 0?t:`Tipo desconocido (${e})`}catch{return`Error (${e})`}}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.logger.debug("LayerManagerService destruido")}static \u0275fac=function(t){return new(t||i)(P(G),P(Te))};static \u0275prov=k({token:i,factory:i.\u0275fac,providedIn:"root"})};function Gh(i,e){if(i&1&&(s(0,"mat-chip",17)(1,"mat-icon",18),d(2),l(),d(3),l()),i&2){let t=e.$implicit,n=f();u("matTooltip",n.getLayerName(t)),p(2),E(n.getLayerIcon(t)),p(),V(" ",n.getLayerName(t)," ")}}function Wh(i,e){i&1&&(s(0,"p",19),d(1," No hay capas activas. Activa algunas capas en el mapa. "),l())}function Kh(i,e){if(i&1&&(s(0,"p",28),d(1),l()),i&2){let t=f().$implicit;p(),V(" ",t.description," ")}}function qh(i,e){if(i&1&&(s(0,"mat-chip",17)(1,"mat-icon",18),d(2),l(),d(3),l()),i&2){let t=e.$implicit,n=f(2);u("matTooltip",n.getLayerName(t)),p(2),E(n.getLayerIcon(t)),p(),V(" ",n.getLayerName(t)," ")}}function Qh(i,e){if(i&1&&(s(0,"mat-chip"),d(1),l()),i&2){let t=f().$implicit,n=f();p(),V(" +",t.layers.length-n.CONSTANTS.MAX_VISIBLE_LAYERS_IN_PRESET," m\xE1s ")}}function Zh(i,e){if(i&1){let t=F();s(0,"mat-list-item",20)(1,"div",21)(2,"div",22)(3,"h4"),d(4),l(),s(5,"span",23),d(6),l()(),y(7,Kh,2,1,"p",24),s(8,"mat-chip-listbox"),y(9,qh,4,3,"mat-chip",3)(10,Qh,2,1,"mat-chip",25),l()(),s(11,"div",6)(12,"button",26),C("click",function(){let o=_(t).$implicit,r=f();return b(r.loadPreset(o))}),s(13,"mat-icon"),d(14,"play_arrow"),l()(),s(15,"button",27),C("click",function(){let o=_(t).$implicit,r=f();return b(r.deletePreset(o))}),s(16,"mat-icon"),d(17,"delete"),l()()()()}if(i&2){let t=e.$implicit,n=f();p(4),E(t.name),p(2),V(" ",n.formatDate(t.updatedAt)," "),p(),u("ngIf",t.description),p(2),u("ngForOf",t.layers.slice(0,n.CONSTANTS.MAX_VISIBLE_LAYERS_IN_PRESET)),p(),u("ngIf",t.layers.length>n.CONSTANTS.MAX_VISIBLE_LAYERS_IN_PRESET)}}function Yh(i,e){i&1&&(s(0,"p",19),d(1," No hay presets guardados. Guarda tu configuraci\xF3n actual para comenzar. "),l())}var za={USER_PRESETS_STORAGE_KEY:"network-map:layer-presets",COLORS:{TEXT_SECONDARY:"#666"},MAX_VISIBLE_LAYERS_IN_PRESET:3,SPACING:{DEFAULT:"16px",SMALL:"8px",XSMALL:"4px"}},sr=class i{constructor(e,t,n,o){this.layerManager=e;this.logger=t;this.dialogRef=n;this.cdr=o}CONSTANTS=za;activeLayers=[];presets=[];newPresetName="";newPresetDescription="";destroy$=new N;ngOnInit(){this.layerManager.getActiveLayers().pipe(R(this.destroy$)).subscribe(e=>{this.activeLayers=e,this.cdr.markForCheck()}),this.loadPresets()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}formatDate(e){return new Date(e).toLocaleDateString()}getLayerName(e){return this.layerManager.getLayerName(e)}getLayerIcon(e){return this.layerManager.getLayerIcon(e)}saveCurrentAsPreset(){if(!(!this.newPresetName||this.activeLayers.length===0))try{let e=Date.now(),t={id:`preset_${e}`,name:this.newPresetName,description:this.newPresetDescription||void 0,layers:[...this.activeLayers],createdAt:e,updatedAt:e};this.presets.push(t),this.savePresets(),this.newPresetName="",this.newPresetDescription="",this.logger.debug("Nuevo preset guardado",t),this.cdr.markForCheck()}catch(e){this.logger.error("Error al guardar preset",e)}}loadPreset(e){try{this.layerManager.deactivateLayers(this.activeLayers),this.layerManager.activateLayers(e.layers),this.logger.debug("Preset cargado",e),e.updatedAt=Date.now(),this.savePresets(),this.cdr.markForCheck()}catch(t){this.logger.error("Error al cargar preset",t)}}deletePreset(e){try{let t=this.presets.findIndex(n=>n.id===e.id);t!==-1&&(this.presets.splice(t,1),this.savePresets(),this.logger.debug("Preset eliminado",e),this.cdr.markForCheck())}catch(t){this.logger.error("Error al eliminar preset",t)}}resetToDefault(){try{this.layerManager.resetToDefaultLayers(),this.logger.debug("Capas restablecidas a valores predeterminados")}catch(e){this.logger.error("Error al restablecer capas",e)}}loadPresets(){try{let e=localStorage.getItem(za.USER_PRESETS_STORAGE_KEY);e&&(this.presets=JSON.parse(e),this.logger.debug("Presets cargados desde localStorage",this.presets),this.cdr.markForCheck())}catch(e){this.logger.error("Error al cargar presets",e),this.presets=[],this.cdr.markForCheck()}}savePresets(){try{localStorage.setItem(za.USER_PRESETS_STORAGE_KEY,JSON.stringify(this.presets)),this.logger.debug("Presets guardados en localStorage")}catch(e){this.logger.error("Error al guardar presets",e)}}static \u0275fac=function(t){return new(t||i)(I(At),I(G),I(zn),I($e))};static \u0275cmp=q({type:i,selectors:[["app-layer-settings"]],decls:35,vars:7,consts:[[1,"layer-settings-container"],["mat-dialog-title",""],[1,"current-layers-section"],[3,"matTooltip",4,"ngFor","ngForOf"],["class","empty-state",4,"ngIf"],[1,"presets-section"],[1,"preset-actions"],["appearance","outline",1,"preset-name-field"],["matInput","","placeholder","Mi configuraci\xF3n",3,"ngModelChange","ngModel"],["appearance","outline",1,"preset-description-field"],["matInput","","placeholder","Descripci\xF3n del preset...",3,"ngModelChange","ngModel"],["mat-raised-button","","color","primary",3,"click","disabled"],["role","list"],["role","listitem","class","preset-item",4,"ngFor","ngForOf"],["align","end"],["mat-button","",3,"click"],["mat-button","","mat-dialog-close","","cdkFocusInitial",""],[3,"matTooltip"],[1,"layer-icon"],[1,"empty-state"],["role","listitem",1,"preset-item"],[1,"preset-details"],[1,"preset-header"],[1,"preset-date"],["class","preset-description",4,"ngIf"],[4,"ngIf"],["mat-icon-button","","matTooltip","Cargar preset",3,"click"],["mat-icon-button","","matTooltip","Eliminar preset",3,"click"],[1,"preset-description"]],template:function(t,n){t&1&&(s(0,"div",0)(1,"h2",1),d(2,"Configuraci\xF3n de Capas"),l(),s(3,"mat-dialog-content")(4,"div",2)(5,"h3"),d(6,"Capas Actuales"),l(),s(7,"mat-chip-listbox"),y(8,Gh,4,3,"mat-chip",3),l(),y(9,Wh,2,0,"p",4),l(),D(10,"mat-divider"),s(11,"div",5)(12,"h3"),d(13,"Presets Guardados"),l(),s(14,"div",6)(15,"mat-form-field",7)(16,"mat-label"),d(17,"Nombre del Preset"),l(),s(18,"input",8),pn("ngModelChange",function(r){return dn(n.newPresetName,r)||(n.newPresetName=r),r}),l()(),s(19,"mat-form-field",9)(20,"mat-label"),d(21,"Descripci\xF3n (opcional)"),l(),s(22,"input",10),pn("ngModelChange",function(r){return dn(n.newPresetDescription,r)||(n.newPresetDescription=r),r}),l()(),s(23,"button",11),C("click",function(){return n.saveCurrentAsPreset()}),s(24,"mat-icon"),d(25,"save"),l(),d(26," Guardar Actual "),l()(),s(27,"mat-list",12),y(28,Zh,18,5,"mat-list-item",13),l(),y(29,Yh,2,0,"p",4),l()(),s(30,"mat-dialog-actions",14)(31,"button",15),C("click",function(){return n.resetToDefault()}),d(32," Restablecer Predeterminado "),l(),s(33,"button",16),d(34," Cerrar "),l()()()),t&2&&(p(8),u("ngForOf",n.activeLayers),p(),u("ngIf",n.activeLayers.length===0),p(9),cn("ngModel",n.newPresetName),p(4),cn("ngModel",n.newPresetDescription),p(),u("disabled",!n.newPresetName||n.activeLayers.length===0),p(5),u("ngForOf",n.presets),p(),u("ngIf",n.presets.length===0))},dependencies:[X,je,ie,Xi,Ln,Fn,Zi,Ji,Qt,Ql,Bn,$n,Vn,he,Re,Ne,le,de,Wn,go,ro,oo,Gn,Kn,Zt,ao,Jl,qt,Wl,eo,Ot,Ue,Ee,Me],styles:[".layer-settings-container[_ngcontent-%COMP%]{padding:0;max-width:600px;width:100%}.current-layers-section[_ngcontent-%COMP%], .presets-section[_ngcontent-%COMP%]{margin:16px 0}h3[_ngcontent-%COMP%]{font-size:16px;font-weight:500;margin-bottom:12px}.layer-icon[_ngcontent-%COMP%]{margin-right:4px;font-size:16px;height:16px;width:16px;vertical-align:middle}mat-chip-listbox[_ngcontent-%COMP%]{margin-bottom:12px}.preset-actions[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;margin-bottom:16px;gap:8px}.preset-name-field[_ngcontent-%COMP%]{flex:2;min-width:200px}.preset-description-field[_ngcontent-%COMP%]{flex:3;min-width:250px}.preset-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:8px}.preset-details[_ngcontent-%COMP%]{flex:1}.preset-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.preset-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;font-weight:500}.preset-date[_ngcontent-%COMP%]{font-size:12px;color:var(--text-secondary-color, #666)}.preset-description[_ngcontent-%COMP%]{font-size:14px;color:var(--text-secondary-color, #666);margin:4px 0 8px}.empty-state[_ngcontent-%COMP%]{color:var(--text-secondary-color, #666);font-style:italic;text-align:center;padding:16px}mat-divider[_ngcontent-%COMP%]{margin:16px 0}"],changeDetection:0})};var lr=class i{constructor(e){this.logger=e;this.dbReady=new Promise(t=>{this.dbReadyResolver=t}),this.initDatabase()}DB_NAME="network-map-storage";DB_VERSION=1;STORE_NAME="cache-store";db=null;dbReady;dbReadyResolver;initDatabase(){return ae(this,null,function*(){try{let e=indexedDB.open(this.DB_NAME,this.DB_VERSION);e.onupgradeneeded=t=>{let n=t.target.result;n.objectStoreNames.contains(this.STORE_NAME)||(n.createObjectStore(this.STORE_NAME,{keyPath:"key"}),this.logger.debug("Almac\xE9n de cach\xE9 creado"))},e.onsuccess=t=>{this.db=t.target.result,this.logger.debug("Base de datos inicializada correctamente"),this.dbReadyResolver(!0)},e.onerror=t=>{this.logger.error("Error al inicializar la base de datos",t.target.error),this.dbReadyResolver(!1)}}catch(e){this.logger.error("Error inesperado al inicializar la base de datos:",e),this.dbReadyResolver(!1)}})}setItem(e,t){return ae(this,null,function*(){if(this.isLargeObject(t))return this.setItemInIndexedDB(e,t);try{localStorage.setItem(e,JSON.stringify({key:e,value:t,timestamp:Date.now()}))}catch(n){return this.logger.error(`Error al guardar ${e} en localStorage:`,n),this.setItemInIndexedDB(e,t)}})}setItemInIndexedDB(e,t){return ae(this,null,function*(){if(!(yield this.dbReady)||!this.db)throw new Error("Base de datos no disponible");return new Promise((o,r)=>{try{let m=this.db.transaction([this.STORE_NAME],"readwrite").objectStore(this.STORE_NAME).put({key:e,value:t,timestamp:Date.now()});m.onsuccess=()=>o(),m.onerror=g=>{this.logger.error(`Error al guardar ${e} en IndexedDB:`,m.error),r(m.error)}}catch(a){this.logger.error(`Error al guardar ${e} en IndexedDB:`,a),r(a)}})})}getItem(e){return ae(this,null,function*(){try{let t=localStorage.getItem(e);if(t)return JSON.parse(t).value}catch(t){this.logger.warn(`No se pudo obtener ${e} de localStorage:`,t)}return this.getItemFromIndexedDB(e)})}getItemFromIndexedDB(e){return ae(this,null,function*(){return!(yield this.dbReady)||!this.db?null:new Promise((n,o)=>{try{let c=this.db.transaction([this.STORE_NAME],"readonly").objectStore(this.STORE_NAME).get(e);c.onsuccess=()=>{c.result?n(c.result.value):n(null)},c.onerror=()=>{this.logger.error(`Error al obtener ${e} de IndexedDB:`,c.error),o(c.error)}}catch(r){this.logger.error(`Error al acceder a IndexedDB para ${e}:`,r),n(null)}})})}removeItem(e){return ae(this,null,function*(){try{localStorage.removeItem(e)}catch(t){this.logger.warn(`Error al eliminar ${e} de localStorage:`,t)}yield this.removeItemFromIndexedDB(e)})}removeItemFromIndexedDB(e){return ae(this,null,function*(){if(!(!(yield this.dbReady)||!this.db))return new Promise(n=>{try{let a=this.db.transaction([this.STORE_NAME],"readwrite").objectStore(this.STORE_NAME).delete(e);a.onsuccess=()=>n(),a.onerror=()=>{this.logger.error(`Error al eliminar ${e} de IndexedDB:`,a.error),n()}}catch(o){this.logger.error(`Error al acceder a IndexedDB para eliminar ${e}:`,o),n()}})})}getKeys(e=""){return ae(this,null,function*(){let t=[];for(let o=0;o<localStorage.length;o++){let r=localStorage.key(o);r&&r.startsWith(e)&&t.push(r)}let n=yield this.getKeysFromIndexedDB(e);return t.push(...n),[...new Set(t)]})}getKeysFromIndexedDB(e){return ae(this,null,function*(){return!(yield this.dbReady)||!this.db?[]:new Promise(n=>{try{let r=this.db.transaction([this.STORE_NAME],"readonly").objectStore(this.STORE_NAME),a=[],c=r.openCursor();c.onsuccess=m=>{let g=m.target.result;if(g){let h=g.value.key;h.startsWith(e)&&a.push(h),g.continue()}else n(a)},c.onerror=()=>{this.logger.error("Error al obtener claves de IndexedDB:",c.error),n([])}}catch(o){this.logger.error("Error al acceder a IndexedDB para obtener claves:",o),n([])}})})}clear(e){return ae(this,null,function*(){if(e){let t=yield this.getKeys(e);for(let n of t)yield this.removeItem(n)}else localStorage.clear(),yield this.clearIndexedDB()})}clearIndexedDB(){return ae(this,null,function*(){if(!(!(yield this.dbReady)||!this.db))return new Promise(t=>{try{let r=this.db.transaction([this.STORE_NAME],"readwrite").objectStore(this.STORE_NAME).clear();r.onsuccess=()=>{this.logger.debug("IndexedDB limpiado correctamente"),t()},r.onerror=()=>{this.logger.error("Error al limpiar IndexedDB:",r.error),t()}}catch(n){this.logger.error("Error al acceder a IndexedDB para limpiarlo:",n),t()}})})}isLargeObject(e){return e instanceof Blob||e instanceof File||e instanceof ArrayBuffer||typeof e=="object"&&JSON.stringify(e).length>100*1024}static \u0275fac=function(t){return new(t||i)(P(G))};static \u0275prov=k({token:i,factory:i.\u0275fac,providedIn:"root"})};var cr=class i{constructor(e,t,n){this.http=e;this.storage=t;this.logger=n;window.addEventListener("online",()=>this.handleConnectionChange(!0)),window.addEventListener("offline",()=>this.handleConnectionChange(!1)),this.loadCache()}isOnline=navigator.onLine;tileCache=new Map;offlineMapAssetsPath="assets/leaflet/offline-tiles";maxCacheSize=50*1024*1024;cacheVersion="1.0.0";handleConnectionChange(e){this.isOnline=e,this.logger.debug(`Conexi\xF3n cambiada: ${e?"Online":"Offline"}`),e&&this.syncPendingData()}isNetworkAvailable(){return this.isOnline}getResource(e,t={}){let n={maxAge:t.maxAge||864e5,version:t.version||this.cacheVersion,cacheOnly:t.cacheOnly||!1};return Bi(this.getFromCache(e,n.version,n.maxAge)).pipe(ke(o=>o?fe(o):!this.isOnline||n.cacheOnly?it(()=>new Error("No hay conexi\xF3n y el recurso no est\xE1 en cach\xE9")):this.http.get(e).pipe(xe(r=>this.saveToCache(e,r,n.version)),we(r=>(this.logger.error(`Error al obtener ${e}:`,r),it(()=>r))))))}getTileImage(e,t,n){let o=`${e}/${t}/${n}`,r=`https://tile.openstreetmap.org/${o}.png`,a=this.tileCache.get(o);return a&&Date.now()-a.timestamp<30*24*60*60*1e3?fe(a.data):this.isOnline?this.http.get(r,{responseType:"blob"}).pipe(xe(c=>{this.tileCache.set(o,{data:c,timestamp:Date.now(),version:this.cacheVersion}),this.storage.setItem(`tile:${o}`,c),this.cleanupCache()}),we(c=>this.getOfflineTile(e,t,n))):this.getOfflineTile(e,t,n)}getOfflineTile(e,t,n){let o=`${this.offlineMapAssetsPath}/${e}/${t}/${n}.png`;return this.http.get(o,{responseType:"blob"}).pipe(we(r=>this.http.get("assets/leaflet/error-tiles/error-tile.png",{responseType:"blob"})))}loadCache(){return ae(this,null,function*(){try{let e=yield this.storage.getKeys("tile:");for(let t of e){let n=t.replace("tile:",""),o=yield this.storage.getItem(t);o&&this.tileCache.set(n,{data:o,timestamp:Date.now(),version:this.cacheVersion})}this.logger.debug(`Cach\xE9 cargado: ${this.tileCache.size} tiles`)}catch(e){this.logger.error("Error al cargar cach\xE9:",e)}})}cleanupCache(){if(this.tileCache.size<=100)return;let e=Array.from(this.tileCache.entries()).sort((t,n)=>t[1].timestamp-n[1].timestamp);for(;this.tileCache.size>1e3;){let[t]=e.shift()||[];t&&(this.tileCache.delete(t),this.storage.removeItem(`tile:${t}`))}}saveToCache(e,t,n){this.storage.setItem(e,{data:t,timestamp:Date.now(),version:n})}getFromCache(e,t,n){return ae(this,null,function*(){try{let o=yield this.storage.getItem(e);if(o&&o.version===t&&Date.now()-o.timestamp<n)return o.data}catch(o){this.logger.error(`Error al obtener ${e} de cach\xE9:`,o)}return null})}syncPendingData(){this.logger.debug("Sincronizando datos pendientes...")}prepareOfflineResources(e,t=[13,14,15]){let n=[];for(let o of t){let r=this.long2tile(e.west,o),a=this.long2tile(e.east,o),c=this.lat2tile(e.north,o),m=this.lat2tile(e.south,o);for(let g=r;g<=a;g++)for(let h=c;h<=m;h++)n.push({z:o,x:g,y:h})}return new Be(o=>{let r=n.length,a=0,c=(m,g)=>{let h=Math.min(m+g,r),v=n.slice(m,h);if(v.length===0){o.next({total:r,current:a,status:"Completado"}),o.complete();return}let w=v.map(T=>this.getTileImage(T.z,T.x,T.y).toPromise().then(()=>{a++,o.next({total:r,current:a,status:`Descargando tiles (${a}/${r})`})}).catch(()=>{a++}));Promise.all(w).then(()=>{c(h,g)})};o.next({total:r,current:a,status:"Iniciando descarga..."}),c(0,10)})}long2tile(e,t){return Math.floor((e+180)/360*Math.pow(2,t))}lat2tile(e,t){return Math.floor((1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(e*Math.PI/180))/Math.PI)/2*Math.pow(2,t))}static \u0275fac=function(t){return new(t||i)(P(Tt),P(lr),P(G))};static \u0275prov=k({token:i,factory:i.\u0275fac,providedIn:"root"})};function Jh(i,e){if(i&1&&(s(0,"mat-icon"),d(1),l()),i&2){let t=f().$implicit;p(),E(t.icon)}}function ef(i,e){if(i&1&&(s(0,"mat-icon"),d(1),l()),i&2){let t=f(2);p(),E(t.ELEMENT_ICONS.default)}}function tf(i,e){if(i&1){let t=F();s(0,"button",28),C("click",function(){let o=_(t).$implicit,r=f();return b(r.onSelectElementType(o.key))}),y(1,Jh,2,1,"mat-icon",29)(2,ef,2,1,"mat-icon",29),s(3,"span"),d(4),l()()}if(i&2){let t=e.$implicit,n=f();p(),u("ngIf",t.icon&&t.icon!==n.ELEMENT_ICONS.default),p(),u("ngIf",!t.icon||t.icon===n.ELEMENT_ICONS.default),p(2),E(t.name)}}function nf(i,e){if(i&1){let t=F();s(0,"button",30),C("click",function(){let o=_(t).$implicit,r=f();return b(r.toggleLayerVisibility(o.type))}),s(1,"mat-icon",5),d(2),l()()}if(i&2){let t=e.$implicit,n=f();K("active",n.isLayerActive(t.type)),u("matTooltip",t.tooltip),Ce("aria-pressed",n.isLayerActive(t.type))("aria-label","Mostrar u ocultar capa de "+t.tooltip),p(2),E(t.icon)}}function of(i,e){if(i&1){let t=F();s(0,"button",28),C("click",function(){let o=_(t).$implicit,r=f();return b(r.toggleLayerVisibility(o.type))}),s(1,"mat-icon",31),d(2),l(),s(3,"span"),d(4),l()()}if(i&2){let t=e.$implicit,n=f();p(),u("color",n.isLayerActive(t.type)?"primary":""),p(),V(" ",n.isLayerActive(t.type)?"check_box":"check_box_outline_blank"," "),p(2),E(t.tooltip)}}var pr=class i{activeTool="pan";exportButtonPulsing=!1;settingsButtonPulsing=!1;layers=[{type:"OLT",icon:"router",tooltip:"OLTs"},{type:"ONT",icon:"device_hub",tooltip:"ONTs"},{type:"FDP",icon:"cable",tooltip:"FDPs"},{type:"SPLITTER",icon:"call_split",tooltip:"Splitters"},{type:"ODF",icon:"settings_input_hdmi",tooltip:"ODFs"}];additionalLayers=[{type:"MSAN",icon:"device_hub",tooltip:"MSANs"},{type:"EDFA",icon:"electrical_services",tooltip:"EDFAs"},{type:"MANGA",icon:"cable",tooltip:"Mangas"},{type:"TERMINAL_BOX",icon:"inbox",tooltip:"Cajas Terminales"},{type:"FIBER_CONNECTION",icon:"timeline",tooltip:"Conexiones"},{type:"FIBER_THREAD",icon:"timeline",tooltip:"Hilos de Fibra"},{type:"ROUTER",icon:"wifi_tethering",tooltip:"Routers"},{type:"RACK",icon:"dns",tooltip:"Racks"},{type:"WDM_FILTER",icon:"filter_alt",tooltip:"Filtros WDM"},{type:"OPTICAL_SWITCH",icon:"swap_horiz",tooltip:"Conmutadores \xD3pticos"},{type:"ROADM",icon:"swap_calls",tooltip:"ROADMs"},{type:"FIBER_SPLICE",icon:"settings_input_component",tooltip:"Empalmes"},{type:"DROP_CABLE",icon:"settings_ethernet",tooltip:"Cables de Acometida"},{type:"DISTRIBUTION_CABLE",icon:"settings_ethernet",tooltip:"Cables de Distribuci\xF3n"},{type:"FEEDER_CABLE",icon:"settings_ethernet",tooltip:"Cables Alimentadores"},{type:"BACKBONE_CABLE",icon:"settings_ethernet",tooltip:"Cables Troncales"}];selectedElements=[];isCreatingConnection=!1;addElement=new U;toggleLayer=new U;centerMap=new U;clearSelection=new U;zoomIn=new U;zoomOut=new U;createConnection=new U;exportMap=new U;openSettings=new U;showSearchWidget=!0;showElementsPanel=!0;toggleSearchWidget=new U;toggleElementsPanel=new U;diagnosticClick=new U;helpClick=new U;prepareOfflineModeRequest=new U;toolChanged=new U;activeLayers=[];destroy$=new N;isOfflineMode=!1;mapEventsService=M(It);layerManager=M(At);dialog=M(Ye);offlineService=M(cr);snackBar=M(He);logger=M(G);addableElementTypes=[];ELEMENT_ICONS=ii;constructor(){}isLayerActive(e){return!this.activeLayers||!Array.isArray(this.activeLayers)||this.activeLayers.length===0?!0:this.activeLayers.includes(e)}getElementTypeName(e){return zc(e)}setActiveTool(e){if(this.activeTool===e)return;let t=this.activeTool;this.activeTool=e,this.mapEventsService.changeTool(e,t),this.toolChanged.emit(e),this.announceForScreenReader(`Herramienta ${this.getToolName(e)} activada`),console.log("NetworkToolbar: Herramienta cambiada a",e,new Date().toISOString())}getToolName(e){return{pan:"Mover",select:"Seleccionar",measure:"Medir",connect:"Conectar",areaSelect:"Selecci\xF3n por \xE1rea",zoomIn:"Acercar",zoomOut:"Alejar",fitToScreen:"Ajustar a pantalla",resetZoom:"Restablecer zoom"}[e]||e}onAddElement(){this.logger.debug("Men\xFA para a\xF1adir elemento abierto desde NetworkToolbar.")}toggleLayerVisibility(e){console.log("NetworkToolbar: Solicitud para alternar capa",e,new Date().toISOString());let t=this.isLayerActive(e);this.toggleLayer.emit(e);let n=t?"ocultada":"mostrada",o=this.getElementTypeName(e);this.announceForScreenReader(`Capa ${o} ${n}`)}onCenterMap(){console.log("NetworkToolbar: Solicitud para centrar mapa",new Date().toISOString()),this.centerMap.emit(),this.announceForScreenReader("Mapa centrado")}onClearSelection(){console.log("NetworkToolbar: Solicitud para limpiar selecci\xF3n",new Date().toISOString()),this.clearSelection.emit();let e=Array.isArray(this.selectedElements)?this.selectedElements.length:0;this.announceForScreenReader(`Selecci\xF3n de ${e} elementos limpiada`)}onZoomIn(){console.log("NetworkToolbar: Solicitud de zoom in",new Date().toISOString()),this.zoomIn.emit(),this.announceForScreenReader("Zoom aumentado")}onZoomOut(){console.log("NetworkToolbar: Solicitud de zoom out",new Date().toISOString()),this.zoomOut.emit(),this.announceForScreenReader("Zoom disminuido")}onCreateConnection(){console.log("NetworkToolbar: Solicitud para crear conexi\xF3n",new Date().toISOString()),this.isCreatingConnection=!this.isCreatingConnection,this.createConnection.emit();let e=this.isCreatingConnection?"iniciada":"cancelada";this.announceForScreenReader(`Creaci\xF3n de conexi\xF3n ${e}`)}onToggleSearchWidget(){console.log("NetworkToolbar: Solicitud para alternar widget de b\xFAsqueda",new Date().toISOString()),this.toggleSearchWidget.emit();let e=this.showSearchWidget?"ocultado":"mostrado";this.announceForScreenReader(`Buscador ${e}`)}onToggleElementsPanel(){console.log("NetworkToolbar: Solicitud para alternar panel de elementos",new Date().toISOString()),this.toggleElementsPanel.emit();let e=this.showElementsPanel?"ocultado":"mostrado";this.announceForScreenReader(`Panel de elementos ${e}`)}onExportMap(){console.log("NetworkToolbar: Solicitud para exportar mapa",new Date().toISOString()),this.exportMap.emit(),this.announceForScreenReader("Exportando mapa")}onOpenSettings(){console.log("NetworkToolbar: Solicitud para abrir configuraci\xF3n"),this.settingsButtonPulsing=!0,setTimeout(()=>this.settingsButtonPulsing=!1,500),this.openSettings.emit()}onNavigateToDiagnostic(){console.log("NetworkToolbar: Solicitud para navegar a diagn\xF3stico"),this.diagnosticClick.emit()}onOpenHelp(){console.log("NetworkToolbar: Solicitud para abrir ayuda"),this.helpClick.emit()}openLayerSettings(){this.dialog.open(sr,{width:"600px",maxHeight:"80vh",panelClass:"layer-settings-dialog"})}prepareOfflineMode(){if(this.isOfflineMode=!this.isOfflineMode,this.isOfflineMode){if(!this.offlineService.isNetworkAvailable()){this.snackBar.open("Ya est\xE1s en modo offline. No es posible descargar datos adicionales sin conexi\xF3n.","Cerrar",{duration:5e3,panelClass:["warning-snackbar"]});return}this.prepareOfflineModeRequest.emit(!0)}else this.snackBar.open("Modo normal activado","Cerrar",{duration:2e3}),this.prepareOfflineModeRequest.emit(!1)}ngOnInit(){this.prepareAddableElementTypes(),this.additionalLayers.sort((e,t)=>e.tooltip.localeCompare(t.tooltip)),this.layers.forEach(e=>{e.icon=this.layerManager.getLayerIcon(e.type)}),this.additionalLayers.forEach(e=>{e.icon=this.layerManager.getLayerIcon(e.type)}),console.log("NetworkToolbarComponent: ngOnInit")}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),console.error("NetworkToolbarComponent: ngOnDestroy FUE LLAMADO!");debugger}handleKeyboardEvent(e){switch(e.key){case"z":(e.ctrlKey||e.metaKey)&&(this.onZoomIn(),e.preventDefault());break;case"x":(e.ctrlKey||e.metaKey)&&(this.onZoomOut(),e.preventDefault());break;case"c":(e.ctrlKey||e.metaKey)&&(this.onCenterMap(),e.preventDefault());break;case"Escape":(Array.isArray(this.selectedElements)?this.selectedElements.length>0:this.selectedElements>0)&&(this.onClearSelection(),e.preventDefault());break;case"f":(e.ctrlKey||e.metaKey)&&(this.onToggleSearchWidget(),e.preventDefault());break;case"h":(e.ctrlKey||e.metaKey)&&(this.onOpenHelp(),e.preventDefault());break}}announceForScreenReader(e){let t=document.getElementById("network-toolbar-announcer");t||(t=document.createElement("div"),t.id="network-toolbar-announcer",t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.classList.add("sr-only"),document.body.appendChild(t)),t.textContent=e,setTimeout(()=>{t.textContent=""},3e3)}prepareAddableElementTypes(){this.addableElementTypes=Object.entries(rr).filter(([e,t])=>e!=="default"&&e!=="FIBER_CONNECTION"&&e!=="FIBER_SPLICE"&&e!=="FIBER_STRAND"&&e!=="FIBER_THREAD"&&e!=="NETWORK_GRAPH").map(([e,t])=>({key:e,name:t,icon:ii[e]||ii.default}))}onSelectElementType(e,t){console.log("Clic en elemento detectado:",e),t&&(t.stopPropagation(),t.preventDefault());try{this.addElement.emit(e),this.logger.debug(`Solicitud para a\xF1adir elemento de tipo: ${e} desde NetworkToolbar`)}catch(n){console.error("Error al seleccionar tipo de elemento:",n),this.snackBar.open("Error al seleccionar el tipo de elemento","Cerrar",{duration:3e3})}}getElementIcon(e){return ii[e]||ii.default}onMoveElementClicked(){this.setActiveTool("moveElement")}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=q({type:i,selectors:[["app-network-toolbar"]],hostBindings:function(t,n){t&1&&C("keydown",function(r){return n.handleKeyboardEvent(r)})},inputs:{activeTool:"activeTool",selectedElements:"selectedElements",isCreatingConnection:"isCreatingConnection",showSearchWidget:"showSearchWidget",showElementsPanel:"showElementsPanel",activeLayers:"activeLayers"},outputs:{addElement:"addElement",toggleLayer:"toggleLayer",centerMap:"centerMap",clearSelection:"clearSelection",zoomIn:"zoomIn",zoomOut:"zoomOut",createConnection:"createConnection",exportMap:"exportMap",openSettings:"openSettings",toggleSearchWidget:"toggleSearchWidget",toggleElementsPanel:"toggleElementsPanel",diagnosticClick:"diagnosticClick",helpClick:"helpClick",prepareOfflineModeRequest:"prepareOfflineModeRequest",toolChanged:"toolChanged"},decls:64,vars:34,consts:[["addElementMenu","matMenu"],["layersMenu","matMenu"],["role","toolbar","aria-label","Herramientas de dise\xF1o de red",1,"network-toolbar"],["role","group","aria-label","Navegaci\xF3n del mapa",1,"toolbar-section"],["mat-icon-button","","matTooltip","Centrar Mapa","aria-label","Centrar mapa",3,"click"],["aria-hidden","true"],["mat-icon-button","","matTooltip","Acercar","aria-label","Acercar mapa",3,"click"],["mat-icon-button","","matTooltip","Alejar","aria-label","Alejar mapa",3,"click"],["vertical","","aria-hidden","true"],["role","group","aria-label","Herramientas de mapa",1,"toolbar-section"],["mat-icon-button","","matTooltip","Mover (Pan)","aria-label","Mover el mapa (modo navegaci\xF3n)",3,"click"],["mat-icon-button","","matTooltip","Seleccionar","aria-label","Seleccionar elementos",3,"click"],["mat-icon-button","","matTooltip","Medir distancia","aria-label","Medir distancia entre puntos",3,"click"],["mat-icon-button","","matTooltip","Selecci\xF3n por \xE1rea","aria-label","Seleccionar elementos por \xE1rea",3,"click"],["role","group","aria-label","Acciones de elementos",1,"toolbar-section"],["mat-icon-button","","matTooltip","A\xF1adir Elemento","aria-label","A\xF1adir nuevo elemento",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["mat-icon-button","","matTooltip","Crear Conexi\xF3n","aria-label","Crear conexi\xF3n entre elementos",3,"click"],["role","group","aria-label","Capas del mapa",1,"toolbar-section"],["mat-icon-button","",3,"matTooltip","active","click",4,"ngFor","ngForOf"],["mat-icon-button","","matTooltip","M\xE1s capas","aria-label","Mostrar m\xE1s capas disponibles",3,"matMenuTriggerFor"],["mat-icon-button","","matTooltip","Configuraci\xF3n de capas","aria-label","Configurar capas",3,"click"],["role","group","aria-label","Herramientas adicionales",1,"toolbar-section"],["mat-icon-button","","matTooltip","Exportar Mapa","aria-label","Exportar mapa actual",3,"click"],["mat-icon-button","","matTooltip","Configuraci\xF3n","aria-label","Abrir configuraci\xF3n",3,"click"],["role","group","aria-label","Visibilidad de paneles",1,"toolbar-section"],["mat-icon-button","","aria-label","Mostrar u ocultar buscador",3,"click","matTooltip"],["mat-icon-button","","aria-label","Mostrar u ocultar panel de elementos",3,"click","matTooltip"],["mat-menu-item","",3,"click"],[4,"ngIf"],["mat-icon-button","",3,"click","matTooltip"],[3,"color"]],template:function(t,n){if(t&1){let o=F();s(0,"div",2)(1,"div",3)(2,"button",4),C("click",function(){return _(o),b(n.onCenterMap())}),s(3,"mat-icon",5),d(4,"center_focus_strong"),l()(),s(5,"button",6),C("click",function(){return _(o),b(n.onZoomIn())}),s(6,"mat-icon",5),d(7,"zoom_in"),l()(),s(8,"button",7),C("click",function(){return _(o),b(n.onZoomOut())}),s(9,"mat-icon",5),d(10,"zoom_out"),l()()(),D(11,"mat-divider",8),s(12,"div",9)(13,"button",10),C("click",function(){return _(o),b(n.setActiveTool("pan"))}),s(14,"mat-icon",5),d(15,"pan_tool"),l()(),s(16,"button",11),C("click",function(){return _(o),b(n.setActiveTool("select"))}),s(17,"mat-icon",5),d(18,"touch_app"),l()(),s(19,"button",12),C("click",function(){return _(o),b(n.setActiveTool("measure"))}),s(20,"mat-icon",5),d(21,"straighten"),l()(),s(22,"button",13),C("click",function(){return _(o),b(n.setActiveTool("areaSelect"))}),s(23,"mat-icon",5),d(24,"select_all"),l()()(),D(25,"mat-divider",8),s(26,"div",14)(27,"button",15)(28,"mat-icon",5),d(29,"add_circle"),l()(),s(30,"mat-menu",null,0),y(32,tf,5,3,"button",16),l(),s(33,"button",17),C("click",function(){return _(o),b(n.onCreateConnection())}),s(34,"mat-icon",5),d(35,"timeline"),l()()(),D(36,"mat-divider",8),s(37,"div",18),y(38,nf,3,6,"button",19),s(39,"button",20)(40,"mat-icon",5),d(41,"more_horiz"),l()(),s(42,"button",21),C("click",function(){return _(o),b(n.openLayerSettings())}),s(43,"mat-icon",5),d(44,"settings"),l()(),s(45,"mat-menu",null,1),y(47,of,5,3,"button",16),l()(),D(48,"mat-divider",8),s(49,"div",22)(50,"button",23),C("click",function(){return _(o),b(n.onExportMap())}),s(51,"mat-icon",5),d(52,"file_download"),l()(),s(53,"button",24),C("click",function(){return _(o),b(n.onOpenSettings())}),s(54,"mat-icon",5),d(55,"settings"),l()()(),D(56,"mat-divider",8),s(57,"div",25)(58,"button",26),C("click",function(){return _(o),b(n.onToggleSearchWidget())}),s(59,"mat-icon",5),d(60),l()(),s(61,"button",27),C("click",function(){return _(o),b(n.onToggleElementsPanel())}),s(62,"mat-icon",5),d(63),l()()()()}if(t&2){let o=vt(31),r=vt(46);p(13),K("active",n.activeTool==="pan"),Ce("aria-pressed",n.activeTool==="pan"),p(3),K("active",n.activeTool==="select"),Ce("aria-pressed",n.activeTool==="select"),p(3),K("active",n.activeTool==="measure"),Ce("aria-pressed",n.activeTool==="measure"),p(3),K("active",n.activeTool==="areaSelect"),Ce("aria-pressed",n.activeTool==="areaSelect"),p(5),u("matMenuTriggerFor",o),p(5),u("ngForOf",n.addableElementTypes),p(),K("active",n.isCreatingConnection),Ce("aria-pressed",n.isCreatingConnection),p(5),u("ngForOf",n.layers),p(),u("matMenuTriggerFor",r),p(8),u("ngForOf",n.additionalLayers),p(3),K("pulse-effect",n.exportButtonPulsing),p(3),K("pulse-effect",n.settingsButtonPulsing),p(5),K("active",n.showSearchWidget),u("matTooltip",n.showSearchWidget?"Ocultar buscador":"Mostrar buscador"),Ce("aria-pressed",n.showSearchWidget),p(2),E(n.showSearchWidget?"search_off":"search"),p(),K("active",n.showElementsPanel),u("matTooltip",n.showElementsPanel?"Ocultar panel de elementos":"Mostrar panel de elementos"),Ce("aria-pressed",n.showElementsPanel),p(2),E(n.showElementsPanel?"view_sidebar_off":"view_sidebar")}},dependencies:[X,je,ie,Ut,Dn,he,Ne,le,de,Rn,An,In,Nn,Ue,Ot,Ee,Me,Kt],styles:['@charset "UTF-8";.network-toolbar[_ngcontent-%COMP%]{display:flex;padding:4px 10px;background-color:#fff;border-bottom:1px solid #e0e0e0;box-shadow:0 3px 5px #0000001f;z-index:1100;position:relative;height:52px;align-items:center;gap:2px}.toolbar-section[_ngcontent-%COMP%]{display:flex;padding:0 5px;align-items:center;gap:3px}button.active[_ngcontent-%COMP%]{color:#1976d2;background-color:#1976d21f;font-weight:500;box-shadow:0 1px 3px #0000001a}button[mat-icon-button][_ngcontent-%COMP%]{transition:all .2s ease;border-radius:4px;display:flex;justify-content:center;align-items:center}button[mat-icon-button][_ngcontent-%COMP%]:hover{background-color:#0000000a;transform:translateY(-1px)}button[mat-icon-button][_ngcontent-%COMP%]:active{background-color:#00000014;transform:translateY(0)}mat-divider[_ngcontent-%COMP%]{height:38px;margin:0 5px;opacity:.5}mat-icon-button[_ngcontent-%COMP%], [mat-icon-button][_ngcontent-%COMP%]{width:40px!important;height:40px!important;line-height:40px!important;padding:0!important;margin:0 2px!important}mat-icon[_ngcontent-%COMP%]{font-size:22px;height:22px;width:22px;margin:auto;display:flex;justify-content:center;align-items:center}@media (max-width: 768px) and (min-width: 601px){.network-toolbar[_ngcontent-%COMP%]{height:48px;padding:4px 8px}mat-icon-button[_ngcontent-%COMP%], [mat-icon-button][_ngcontent-%COMP%]{width:36px!important;height:36px!important;line-height:36px!important}mat-icon[_ngcontent-%COMP%]{font-size:20px;height:20px;width:20px}mat-divider[_ngcontent-%COMP%]{height:34px}}@keyframes _ngcontent-%COMP%_pulseEffect{0%{transform:scale(1);box-shadow:0 0 #1976d266}70%{transform:scale(1.05);box-shadow:0 0 5px 10px #1976d200}to{transform:scale(1);box-shadow:0 0 #1976d200}}.pulse-effect[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulseEffect .5s ease-out}@media (max-width: 600px){.network-toolbar[_ngcontent-%COMP%]{flex-wrap:wrap;justify-content:space-between;height:auto;padding:4px}.toolbar-section[_ngcontent-%COMP%]{margin:2px;flex-wrap:wrap;justify-content:center}mat-divider[vertical][_ngcontent-%COMP%]{display:none}mat-icon-button[_ngcontent-%COMP%], [mat-icon-button][_ngcontent-%COMP%]{width:32px!important;height:32px!important;line-height:32px!important}mat-icon[_ngcontent-%COMP%]{font-size:18px;height:18px;width:18px}}'],changeDetection:0})};var rf=["mapContainer"],af=["*"],sf=()=>[],lf=i=>({"dark-theme":i});function cf(i,e){if(i&1){let t=F();s(0,"app-map-view",12),C("elementSelected",function(o){_(t);let r=f();return b(r.onElementSelected(o))})("mapLoaded",function(){_(t);let o=f();return b(o.onMapLoaded())}),l()}if(i&2){let t=f();u("darkMode",t.darkMode)("tool",t.activeTool)("loading",!t.isMapReady)}}function df(i,e){i&1&&D(0,"div",13)}function pf(i,e){i&1&&(s(0,"div",14)(1,"div",15),d(2,"\u26A0\uFE0F"),l(),s(3,"div",16)(4,"strong"),d(5,"No se pudo inicializar el mapa."),l(),D(6,"br"),d(7," Verifica que el contenedor tenga dimensiones v\xE1lidas y que la red est\xE9 disponible."),D(8,"br"),d(9," Si el problema persiste, revisa la consola del navegador. "),l()())}function mf(i,e){if(i&1){let t=F();s(0,"app-elements-panel",17),C("elementSelected",function(o){_(t);let r=f();return b(r.onElementSelected(o))}),l()}}function gf(i,e){if(i&1){let t=F();s(0,"app-layer-control",18),C("baseLayerChanged",function(o){_(t);let r=f();return b(r.onBaseLayerChanged(o))}),l()}}function uf(i,e){if(i&1&&(s(0,"div",19)(1,"span",20),d(2),l(),s(3,"span",20),d(4),l(),s(5,"span",20),d(6),l(),s(7,"span",20),d(8),l()()),i&2){let t=f();p(2),V("FPS: ",t.performanceMetrics.fps,""),p(2),V("Elementos: ",t.performanceMetrics.elementCount,""),p(2),V("Memoria: ",t.performanceMetrics.memoryUsageFormatted,""),p(2),V("Modo: ",t.useStandaloneComponents?"Standalone":"Legacy","")}}function hf(i,e){i&1&&(s(0,"div",21),D(1,"div",22),s(2,"span"),d(3,"Cargando mapa..."),l()())}function ff(i,e){i&1&&D(0,"app-performance-widget")}var mr=class i extends ti{mapContainerRef;mapViewComponent;initialZoom=16;initialCenter=[19.78375,-70.676666];darkMode=!1;showControls=!0;showMiniMap=!0;showLayerControl=!0;isMapReady=!1;showElementsPanel=!0;showWidgets=!0;showSearchWidget=!0;isDebugMode=!0;get isDarkTheme(){return this.darkMode}performanceMetrics={fps:0,elementCount:0,memoryUsage:0,memoryUsageFormatted:"0 MB"};activeTool="pan";elementTypeToPlace=null;firstElementForConnection=null;console=console;mapService=M(Dt);mapToolsService=M(Ac);mapStateService=M(yo);mapPerformanceService=M(Zn);standaloneAdapter=M(Nc);elementManagerAdapter=M(Ic);route=M(Ki);stateManager=M(gt);router=M(Se);snackBar=M(He);dialog=M(Ye);cdr=M($e);mapEventsService=M(It);useStandaloneComponents=!1;constructor(e){if(super(e),this.logDebug("MapContainerComponent inicializado"),!this.mapService||!this.mapStateService||!this.stateManager){this.logger.error("MapContainerComponent: Fall\xF3 la inyecci\xF3n de servicios cr\xEDticos");return}this.validateComponentConsistency(),this.useStandaloneComponents=!1;try{let t=this.standaloneAdapter.getFeatureFlag("enableStandaloneMode");this.logDebug(`Bandera enableStandaloneMode desde servicio: ${t}`)}catch(t){this.logDebug("Error al obtener la bandera enableStandaloneMode",t)}}loadHtml2Canvas(){return ae(this,null,function*(){return(yield import("./chunk-5MGQ7NMG.js")).default})}initializeComponent(){this.logDebug("Inicializando componente MapContainer"),this.setupSubscriptions()}setupSubscriptions(){this.route.data.subscribe(e=>{if(e&&e.mapConfig){let t=e.mapConfig;t.initialZoom&&(this.initialZoom=t.initialZoom),t.initialCenter&&(this.initialCenter=t.initialCenter),this.logDebug("Configuraci\xF3n de mapa cargada desde ruta:",t)}}),this.mapPerformanceService.initialize({enableFPSMonitoring:!0,autoOptimize:!0}),this.mapStateService.mapState$.pipe(R(this.destroy$)).subscribe(e=>{this.logDebug("Estado del mapa actualizado",e)}),this.stateManager.currentTool.pipe(R(this.destroy$)).subscribe(e=>{this.activeTool=e,this.logDebug(`Herramienta activa: ${e}`)}),this.elementManagerAdapter.elementsChanged.pipe(R(this.destroy$)).subscribe(()=>{this.logDebug("Elementos actualizados a trav\xE9s del adaptador standalone. Forzando detecci\xF3n de cambios y refresco del mapa."),this.cdr.detectChanges(),this.mapService&&this.mapService.refreshElementsDisplay()}),this.standaloneAdapter.featureFlags.pipe(R(this.destroy$)).subscribe(e=>{this.useStandaloneComponents!==!1&&(this.useStandaloneComponents=e.enableStandaloneMode),this.logDebug(`Modo standalone evaluado a: ${this.useStandaloneComponents} (Bandera servicio: ${e.enableStandaloneMode})`)}),this.stateManager.singleSelectedElement$.pipe(R(this.destroy$)).subscribe(e=>{if(!e||!e.id){this.activeTool==="connect"&&this.firstElementForConnection;return}this.activeTool==="select"?(this.logDebug(`Elemento individual seleccionado: ${e.id}, tipo: ${e.type}. Navegando a editor.`),this.router.navigate(["elements/edit",e.id],{relativeTo:this.route.parent})):this.activeTool==="connect"&&this.handleElementSelectionForConnection(e)}),setInterval(()=>{this.performanceMetrics={fps:Math.round(Math.random()*60),elementCount:Math.round(Math.random()*1e3),memoryUsage:Math.random()*100,memoryUsageFormatted:`${Math.round(Math.random()*100)} MB`}},1e3)}ngAfterViewInit(){if(this.logger.debug("MapContainer ngAfterViewInit: Verificando estado de visibilidad de paneles."),this.logger.debug(`Current panel visibility - isMapReady: ${this.isMapReady}, showElementsPanel: ${this.showElementsPanel}, showLayerControl: ${this.showLayerControl}`),!this.mapContainerRef){this.logger.error("MapContainer ngAfterViewInit: mapContainerRef no est\xE1 disponible. No se puede inicializar el mapa."),this.handleError(new Error("Referencia al contenedor del mapa no disponible"),"No se pudo acceder al contenedor del mapa");return}this.initializeMap();let e="ID_ELEMENTO_1_REAL",t="ID_ELEMENTO_2_REAL";setTimeout(()=>{if(e!=="ID_ELEMENTO_1_REAL"&&t!=="ID_ELEMENTO_2_REAL"){let n={id:`conn-${e}-${t}-${Date.now()}`,sourceElementId:e,targetElementId:t,type:"FIBER",status:"ACTIVE",name:`Conexi\xF3n ${e} <-> ${t}`};this.elementManagerAdapter.addConnection(n).subscribe({next:o=>this.logger.info("[MapContainerPrueba] Conexi\xF3n de prueba a\xF1adida v\xEDa adaptador:",o),error:o=>this.logger.error("[MapContainerPrueba] Error a\xF1adiendo conexi\xF3n de prueba:",o)})}else this.logger.warn("[MapContainerPrueba] Los IDs de los elementos para la conexi\xF3n de prueba no fueron reemplazados. No se a\xF1adir\xE1 la conexi\xF3n de prueba.")},7e3)}onElementSelected(e){if(this.logDebug("Elemento seleccionado en MapContainer:",e),this.handleElementSelected(e),!e||!e.id){this.elementManagerAdapter.deselectElement();return}this.elementManagerAdapter.selectElement(e.id),this.activeTool==="moveElement"&&this.snackBar.open(`Elemento "${e.name}" seleccionado. ${e.type==="MANGA"?"(MANGA)":""} Arr\xE1stralo en el mapa para moverlo.`,"Entendido",{duration:3e3}),e.type==="MANGA"&&this.logger.debug("Elemento MANGA seleccionado:",e)}onMapLoaded(){this.isMapReady=!0,this.logger.debug("Mapa cargado correctamente en el componente standalone"),this.logger.debug(`Panel visibility after map loaded - isMapReady: ${this.isMapReady}, showElementsPanel: ${this.showElementsPanel}, showLayerControl: ${this.showLayerControl}`),this.useStandaloneComponents&&this.stateManager.setTool("pan"),this.completeLoading()}initializeMap(){if(!this.mapContainerRef){this.logger.error("MapContainer: mapContainerRef no est\xE1 definido. No se puede inicializar el mapa."),this.handleError(new Error("Referencia al contenedor del mapa no disponible"),"No se pudo acceder al contenedor del mapa");return}if(!this.validateContainerDimensions(this.mapContainerRef.nativeElement)){this.handleError(new Error("Contenedor de mapa inv\xE1lido"),"El contenedor del mapa no tiene dimensiones v\xE1lidas");return}if(this.useStandaloneComponents){this.logDebug("Usando implementaci\xF3n de mapa con componentes standalone"),setTimeout(()=>{this.isMapReady=!0,this.cdr.detectChanges(),this.logDebug("Mapa marcado como listo (forzado)")},1e3);return}if(!this.mapContainerRef.nativeElement){this.logger.error("MapContainer: mapContainerRef.nativeElement no est\xE1 disponible"),this.handleError(new Error("Elemento nativo del contenedor no disponible"),"No se pudo acceder al elemento DOM del mapa");return}let e={container:this.mapContainerRef.nativeElement,initialZoom:this.initialZoom,initialCenter:this.initialCenter,isDarkMode:this.darkMode};this.mapService.initialize(e),this.mapService.isReady$.pipe(R(this.destroy$)).subscribe(t=>{this.isMapReady=t,this.logDebug(`Mapa legacy ${t?"listo":"no listo"}`),t&&(this.mapStateService.setZoom(this.initialZoom),this.mapStateService.setCenter(this.initialCenter),this.mapStateService.setActiveTool("pan"))})}setTool(e){console.log("MapContainer: Cambiando herramienta a",e),this.logger.info(`[MapContainer] setTool CALLED WITH: ${e}`),this.stateManager.setTool(e)}onMapMouseDown(e){if(console.log("MapContainer: Evento mousedown en mapa"),this.activeTool==="moveElement"){let t=this.getSelectedElement();if(t){let n=e.target;if(n.closest(".leaflet-marker-icon")||n.closest(".network-element")||n.classList.contains("network-element")||n.classList.contains("leaflet-marker-icon")){this.startDraggingElement(t,e);return}}}}onMapMouseMove(e){}onMapMouseUp(e){console.log("MapContainer: Evento mouseup en mapa")}onMapClick(e){return ae(this,null,function*(){if(this.logger.debug(`MapContainer: Map clicked. Active tool: ${this.activeTool}`,e),this.activeTool==="placeElement"&&this.elementTypeToPlace){e.stopPropagation();let t=this.mapService.getMap(),n;if(t&&(n=t.mouseEventToLatLng(e)),n){let o={lat:n.lat,lng:n.lng};this.logger.info(`Placing element of type ${this.elementTypeToPlace} at`,o),this.dialog.open(ga,{width:"700px",maxHeight:"90vh",data:{type:this.elementTypeToPlace,position:{lat:o.lat,lng:o.lng,coordinates:[o.lng,o.lat],type:"Point"},isNewElement:!0},panelClass:"element-editor-dialog",disableClose:!0}).afterClosed().subscribe(a=>{if(a){console.log("Resultado del di\xE1logo:",a);let c=a.element||a;this.elementManagerAdapter.addElement(c),this.snackBar.open(`Elemento ${c.name} a\xF1adido.`,"Cerrar",{duration:3e3}),setTimeout(()=>{this.mapService.refreshElementsDisplay()},500)}this.elementTypeToPlace=null,this.setTool("select")})}else this.logger.warn("No se pudieron obtener coordenadas del clic del mapa para colocar elemento (MapService.getMap() o mouseEventToLatLng fall\xF3)."),this.snackBar.open("No se pudo determinar la ubicaci\xF3n. Intente de nuevo.","Cerrar",{duration:3e3}),this.setTool("select"),this.elementTypeToPlace=null}else this.activeTool==="connect"?this.logger.debug("Clic en mapa mientras la herramienta es connect. La selecci\xF3n de elementos la maneja singleSelectedElement$."):this.activeTool})}handleElementSelectionForConnection(e){if(!e||!e.id){this.logger.error("handleElementSelectionForConnection llamado con elemento inv\xE1lido.");return}if(!this.firstElementForConnection)this.firstElementForConnection=e,this.logger.info(`Primer elemento para conexi\xF3n seleccionado: ${e.name} (ID: ${e.id})`),this.snackBar.open(`Elemento origen: ${e.name}. Selecciona el elemento destino.`,"Entendido",{duration:3500});else{if(this.firstElementForConnection.id===e.id){this.logger.warn("Se ha seleccionado el mismo elemento como origen y destino."),this.snackBar.open("No puedes conectar un elemento consigo mismo.","Cerrar",{duration:3e3});return}let t=e;this.logger.info(`Segundo elemento para conexi\xF3n seleccionado: ${t.name} (ID: ${t.id})`);let n={id:`conn-${this.firstElementForConnection.id}-${t.id}-${Date.now()}`,sourceElementId:this.firstElementForConnection.id,targetElementId:t.id,type:"FIBER",status:"PLANNED",name:`Conexi\xF3n ${this.firstElementForConnection.name} - ${t.name}`,vertices:[]};this.elementManagerAdapter.addConnection(n).subscribe({next:o=>{this.logger.info("Conexi\xF3n creada exitosamente:",o),this.snackBar.open(`Conexi\xF3n creada: ${o.name}`,"Cerrar",{duration:3e3}),this.mapService.refreshElementsDisplay()},error:o=>{this.logger.error("Error al crear la conexi\xF3n:",o),this.snackBar.open("Error al crear la conexi\xF3n.","Cerrar",{duration:3e3,panelClass:"error-snackbar"})},complete:()=>{this.firstElementForConnection=null,this.setTool("select")}})}}onMapDoubleClick(e){if(console.log("MapContainer: Evento dblclick en mapa"),this.activeTool!=="select")return;let t=e.target;if(t.closest(".network-element")||t.classList.contains("network-element")||t.closest(".leaflet-marker-icon")||t.classList.contains("leaflet-marker-icon")){let o=this.getSelectedElement();o?(this.logger.info(`Elemento seleccionado para edici\xF3n mediante doble clic: ${o.id} (${o.type})`),this.dialog.open(ga,{width:"700px",maxHeight:"90vh",data:{element:o,isNewElement:!1},panelClass:"element-editor-dialog",disableClose:!1}).afterClosed().subscribe(a=>{if(a){let c=a.element||a;this.elementManagerAdapter.updateElement(c)?(this.snackBar.open(`Elemento ${c.name} actualizado.`,"Cerrar",{duration:3e3}),this.mapService.refreshElementsDisplay()):this.snackBar.open("Error al actualizar el elemento.","Cerrar",{duration:3e3,panelClass:"error-snackbar"})}})):this.logger.warn("Doble clic sobre elemento pero no hay elemento seleccionado actualmente.")}}centerMap(e){console.log("MapContainer: Solicitud para centrar mapa en",e),e&&(this.useStandaloneComponents?this.mapViewComponent?(this.mapViewComponent.centerMap(e),this.logger.debug("Centering map via MapViewComponent",e)):this.logger.warn("MapViewComponent not available to center map."):this.mapStateService.setCenter(e))}setZoom(e){if(console.log("MapContainer: Cambiando zoom en",e),this.useStandaloneComponents)this.mapViewComponent?e>0?this.mapViewComponent.zoomIn():e<0&&this.mapViewComponent.zoomOut():this.logger.warn("MapViewComponent not available to set zoom.");else{let t=this.mapStateService.getState().zoom||this.initialZoom,n=t;e>0?n=t+1:e<0&&(n=Math.max(1,t-1)),this.mapStateService.setZoom(n)}}selectElement(e){this.elementManagerAdapter.selectElement(e)}deselectElement(){this.elementManagerAdapter.deselectElement()}getSelectedElement(){return this.elementManagerAdapter.getSelectedElement()}validateComponentConsistency(){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.logDebug("Verificaci\xF3n de consistencia completada: MapContainerComponent ahora extiende de BaseMapComponent")},0)})}get currentViewport(){let e=this.mapStateService.getState().bounds;return e?{minX:e[0][0],minY:e[0][1],maxX:e[1][0],maxY:e[1][1]}:null}onAddElement(e){this.logger.debug(`MapContainer: Solicitud para iniciar la colocaci\xF3n del elemento tipo: ${e}`),e?(this.elementTypeToPlace=e,this.setTool("placeElement"),this.snackBar.open(`Modo "Colocar ${rr[e]||e}" activado. Haz clic en el mapa.`,"Entendido",{duration:3500})):this.logger.warn("onAddElement llamado sin elementType")}onToggleLayer(e){console.log("MapContainer: Procesando solicitud para alternar capa",e,new Date().toISOString()),this.logDebug("MapContainer: Procesando solicitud para alternar capa",e);try{this.mapEventsService.toggleLayer(e,!0),this.cdr.detectChanges()}catch(t){this.logger.error("Error al alternar capa",t)}}onExportMap(){console.log("MapContainer: Procesando solicitud para exportar mapa",new Date().toISOString()),this.logDebug("MapContainer: Procesando solicitud para exportar mapa");try{this.snackBar.open("Preparando exportaci\xF3n del mapa...","",{duration:2e3});let e=document.querySelector(".map-container")||document.getElementById("map");if(!e)throw new Error("No se pudo encontrar el elemento del mapa para exportar");let t={useCORS:!0,allowTaint:!0,backgroundColor:this.darkMode?"#303030":"#f5f5f5",scale:2,logging:!1};e instanceof HTMLElement&&this.loadHtml2Canvas().then(n=>{n(e,t).then(o=>{this.addMapMetadata(o),this.showExportDialog(o)}).catch(o=>{this.logger.error("Error al generar imagen del mapa",o),this.snackBar.open("Error al exportar el mapa: "+o.message,"Cerrar",{duration:5e3,panelClass:"error-snackbar"})})}).catch(n=>{this.logger.error("Error al cargar html2canvas",n),this.snackBar.open("Error al cargar la librer\xEDa de exportaci\xF3n","Cerrar",{duration:5e3,panelClass:"error-snackbar"})})}catch(e){this.logger.error("Error al iniciar exportaci\xF3n del mapa",e),this.snackBar.open("Error al iniciar exportaci\xF3n del mapa","Cerrar",{duration:5e3,panelClass:"error-snackbar"})}}addMapMetadata(e){try{let t=e.getContext("2d");if(!t)return;t.save(),t.fillStyle=this.darkMode?"rgba(255, 255, 255, 0.8)":"rgba(0, 0, 0, 0.7)",t.font="bold 14px Arial";let n=this.mapStateService.getState().zoom||this.initialZoom,o=this.mapStateService.getState().center||this.initialCenter,r=new Date().toLocaleString();if(t.fillText(`Exportado: ${r}`,10,e.height-60),t.fillText(`Zoom: ${n}`,10,e.height-40),o&&o.length===2){let a=o[0].toFixed(6),c=o[1].toFixed(6);t.fillText(`Centro: ${a}, ${c}`,10,e.height-20)}t.restore()}catch(t){this.logger.error("Error al a\xF1adir metadatos a la exportaci\xF3n",t)}}showExportDialog(e){try{e.toBlob(t=>{if(!t)throw new Error("No se pudo convertir la imagen para exportar");let n=URL.createObjectURL(t),o=[{label:"Descargar PNG",action:()=>this.downloadImage(n,"mapa-de-red.png")},{label:"Copiar al portapapeles",action:()=>this.copyToClipboard(e)},{label:"Compartir...",action:()=>this.shareImage(t)}];this.downloadImage(n,"mapa-de-red.png"),this.snackBar.open("Mapa exportado con \xE9xito","Cerrar",{duration:3e3})},"image/png")}catch(t){this.logger.error("Error al mostrar di\xE1logo de exportaci\xF3n",t),this.snackBar.open("Error al finalizar la exportaci\xF3n del mapa","Cerrar",{duration:5e3,panelClass:"error-snackbar"})}}downloadImage(e,t){try{let n=document.createElement("a");n.href=e,n.download=t,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),setTimeout(()=>URL.revokeObjectURL(e),100)}catch(n){this.logger.error("Error al descargar imagen",n),this.snackBar.open("Error al descargar imagen","Cerrar",{duration:3e3})}}copyToClipboard(e){try{e.toBlob(t=>ae(this,null,function*(){if(!t)throw new Error("No se pudo convertir la imagen para copiar");if(navigator.clipboard&&navigator.clipboard.write){let n=new ClipboardItem({[t.type]:t});yield navigator.clipboard.write([n]),this.snackBar.open("Imagen copiada al portapapeles","Cerrar",{duration:2e3})}else{let n=document.createElement("img");n.src=e.toDataURL(),document.body.appendChild(n);let o=window.getSelection(),r=document.createRange();r.selectNode(n),o?.removeAllRanges(),o?.addRange(r),document.execCommand("copy"),document.body.removeChild(n),this.snackBar.open("Imagen copiada al portapapeles (modo compatible)","Cerrar",{duration:2e3})}}))}catch(t){this.logger.error("Error al copiar al portapapeles",t),this.snackBar.open("No se pudo copiar la imagen al portapapeles","Cerrar",{duration:3e3})}}shareImage(e){try{if(navigator.share){let t=new File([e],"mapa-de-red.png",{type:"image/png"});navigator.share({title:"Mapa de Red",text:"Mapa de Red exportado desde la aplicaci\xF3n",files:[t]}).then(()=>{this.snackBar.open("Mapa compartido con \xE9xito","Cerrar",{duration:2e3})}).catch(n=>{n.name!=="AbortError"&&(this.logger.error("Error al compartir",n),this.snackBar.open("Error al compartir: "+n.message,"Cerrar",{duration:3e3}))})}else this.snackBar.open("Tu navegador no admite compartir im\xE1genes directamente","Cerrar",{duration:3e3})}catch(t){this.logger.error("Error al compartir imagen",t),this.snackBar.open("Error al compartir imagen","Cerrar",{duration:3e3})}}onOpenSettings(){console.log("MapContainer: Procesando solicitud para abrir configuraci\xF3n",new Date().toISOString()),this.logDebug("MapContainer: Procesando solicitud para abrir configuraci\xF3n"),this.router.navigate(["network-design","settings"],{relativeTo:this.route,queryParams:{returnUrl:this.router.url}})}onToggleSearchWidget(){console.log("MapContainer: Procesando solicitud para alternar widget de b\xFAsqueda",new Date().toISOString()),this.logDebug("MapContainer: Procesando solicitud para alternar widget de b\xFAsqueda"),this.showSearchWidget=!this.showSearchWidget,this.cdr.detectChanges()}onToggleElementsPanel(){console.log("MapContainer: Procesando solicitud para alternar panel de elementos",new Date().toISOString()),this.logDebug("MapContainer: Procesando solicitud para alternar panel de elementos"),this.showElementsPanel=!this.showElementsPanel,this.cdr.detectChanges()}onDiagnosticClick(){console.log("MapContainer: Procesando solicitud para diagn\xF3stico",new Date().toISOString()),this.logDebug("MapContainer: Procesando solicitud para diagn\xF3stico"),this.router.navigate(["network-design","diagnostic"],{relativeTo:this.route})}onHelpClick(){console.log("MapContainer: Procesando solicitud para ayuda",new Date().toISOString()),this.logDebug("MapContainer: Procesando solicitud para ayuda");let e={width:"80%",maxWidth:"800px",maxHeight:"80vh",data:{section:"map",context:this.activeTool}};this.router.navigate(["help","map"],{queryParams:{tool:this.activeTool}})}getSelectedElementsForToolbar(){let e=this.elementManagerAdapter.getSelectedElement();return e?[e]:[]}onBaseLayerChanged(e){if(this.useStandaloneComponents){this.logger.warn("El cambio de capa base no est\xE1 implementado para el modo standalone en MapContainerComponent.");return}e&&e.id?(this.logger.debug(`MapContainer: Solicitud para cambiar capa base a: ${e.id} (${e.name})`),this.mapService.setBaseLayer(e.id)):this.logger.warn("MapContainer: Se recibi\xF3 un evento baseLayerChanged sin un ID de capa v\xE1lido.",e)}onPrepareOfflineModeRequest(e){console.log(`MapContainer: Solicitud para modo offline: ${e}`,new Date().toISOString()),this.logDebug(`MapContainer: Solicitud para modo offline: ${e}`),e?this.snackBar.open("Iniciando preparaci\xF3n para modo offline...","Entendido",{duration:3e3}):this.snackBar.open("Cancelando preparaci\xF3n para modo offline / Volviendo a modo online.","Entendido",{duration:3e3}),this.cdr.detectChanges()}startDraggingElement(e,t){if(this.activeTool!=="moveElement"||!e||!e.id)return;let n=e.id;if(!n){this.logger.warn("No se puede iniciar el arrastre: el elemento no tiene ID");return}this.logger.debug(`Iniciando arrastre del elemento: ${n}`);let o=this.mapService.getMap();if(!o)return;let r=o.mouseEventToLatLng(t);this.mapEventsService.dragStarted(n,{x:r.lng,y:r.lat});let a=m=>{if(!o)return;let g=o.mouseEventToLatLng(m);this.updateElementPositionDuringDrag(n,g.lng,g.lat)},c=m=>{if(!o)return;let g=o.mouseEventToLatLng(m);this.finalizeElementDrag(n,g.lng,g.lat),document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",c)};document.addEventListener("mousemove",a),document.addEventListener("mouseup",c),t.preventDefault(),t.stopPropagation()}updateElementPositionDuringDrag(e,t,n){this.mapService.updateElementPreviewPosition(e,t,n)}finalizeElementDrag(e,t,n){this.logger.debug(`Finalizando arrastre del elemento: ${e} en posici\xF3n [${n}, ${t}]`),this.mapEventsService.dragEnded(e,{x:t,y:n}),this.elementManagerAdapter.updateElementPosition(e,t,n),this.snackBar.open("Posici\xF3n del elemento actualizada","Cerrar",{duration:2e3}),setTimeout(()=>{this.mapService.refreshElementsDisplay()},100)}static \u0275fac=function(t){return new(t||i)(I(jt))};static \u0275cmp=q({type:i,selectors:[["app-map-container"]],viewQuery:function(t,n){if(t&1&&(lt(rf,7),lt(Si,5)),t&2){let o;ct(o=dt())&&(n.mapContainerRef=o.first),ct(o=dt())&&(n.mapViewComponent=o.first)}},inputs:{initialZoom:"initialZoom",initialCenter:"initialCenter",darkMode:"darkMode",showControls:"showControls",showMiniMap:"showMiniMap",showLayerControl:"showLayerControl"},features:[ln],ngContentSelectors:af,decls:14,vars:20,consts:[["mapContainer",""],[3,"addElement","toggleLayer","centerMap","clearSelection","zoomIn","zoomOut","createConnection","exportMap","openSettings","toggleSearchWidget","toggleElementsPanel","diagnosticClick","toolChanged","helpClick","prepareOfflineModeRequest","selectedElements","isCreatingConnection","showSearchWidget","showElementsPanel","activeLayers","activeTool"],[1,"map-container",3,"mousedown","mousemove","mouseup","click","dblclick","ngClass"],[3,"darkMode","tool","loading","elementSelected","mapLoaded",4,"ngIf"],["id","map","class","map",4,"ngIf"],["class","map-error-message",4,"ngIf"],["position","left",3,"elementSelected",4,"ngIf"],["position","top-right",3,"baseLayerChanged",4,"ngIf"],["class","performance-info",4,"ngIf"],["class","map-loading",4,"ngIf"],[1,"map-widgets-container"],[4,"ngIf"],[3,"elementSelected","mapLoaded","darkMode","tool","loading"],["id","map",1,"map"],[1,"map-error-message"],[1,"map-error-icon"],[1,"map-error-text"],["position","left",3,"elementSelected"],["position","top-right",3,"baseLayerChanged"],[1,"performance-info"],[1,"performance-metric"],[1,"map-loading"],[1,"spinner"]],template:function(t,n){if(t&1){let o=F();gi(),s(0,"app-network-toolbar",1),Le(1,"async"),C("addElement",function(a){return _(o),b(n.onAddElement(a))})("toggleLayer",function(a){return _(o),b(n.onToggleLayer(a))})("centerMap",function(){return _(o),b(n.centerMap(n.initialCenter))})("clearSelection",function(){return _(o),b(n.deselectElement())})("zoomIn",function(){return _(o),b(n.setZoom(1))})("zoomOut",function(){return _(o),b(n.setZoom(-1))})("createConnection",function(){return _(o),b(n.setTool("connect"))})("exportMap",function(){return _(o),b(n.onExportMap())})("openSettings",function(){return _(o),b(n.onOpenSettings())})("toggleSearchWidget",function(){return _(o),b(n.onToggleSearchWidget())})("toggleElementsPanel",function(){return _(o),b(n.onToggleElementsPanel())})("diagnosticClick",function(){return _(o),b(n.onDiagnosticClick())})("toolChanged",function(a){return _(o),b(n.setTool(a))})("helpClick",function(){return _(o),b(n.onHelpClick())})("prepareOfflineModeRequest",function(a){return _(o),b(n.onPrepareOfflineModeRequest(a))}),l(),s(2,"div",2,0),C("mousedown",function(a){return _(o),b(n.onMapMouseDown(a))})("mousemove",function(a){return _(o),b(n.onMapMouseMove(a))})("mouseup",function(a){return _(o),b(n.onMapMouseUp(a))})("click",function(a){return _(o),b(n.onMapClick(a))})("dblclick",function(a){return _(o),b(n.onMapDoubleClick(a))}),y(4,cf,1,3,"app-map-view",3)(5,df,1,0,"div",4)(6,pf,10,0,"div",5)(7,mf,1,0,"app-elements-panel",6)(8,gf,1,0,"app-layer-control",7)(9,uf,9,4,"div",8)(10,hf,4,0,"div",9),l(),s(11,"div",10),ui(12),l(),y(13,ff,1,0,"app-performance-widget",11)}t&2&&(u("selectedElements",n.getSelectedElementsForToolbar())("isCreatingConnection",n.activeTool==="connect")("showSearchWidget",n.showSearchWidget)("showElementsPanel",n.showElementsPanel)("activeLayers",Tn(1,15,n.stateManager.activeLayers)||Lt(17,sf))("activeTool",n.activeTool),p(2),u("ngClass",_t(18,lf,n.isDarkTheme)),p(2),u("ngIf",n.useStandaloneComponents),p(),u("ngIf",!n.useStandaloneComponents),p(),u("ngIf",!n.isMapReady&&!n.useStandaloneComponents),p(),u("ngIf",n.isMapReady&&n.showElementsPanel),p(),u("ngIf",n.showLayerControl),p(),u("ngIf",n.isDebugMode),p(),u("ngIf",!n.isMapReady&&!n.useStandaloneComponents),p(3),u("ngIf",n.showWidgets&&n.isMapReady))},dependencies:[X,pt,ie,ml,tr,Jo,mt,le,he,Si,or,pr],styles:['@charset "UTF-8";[_ngcontent-%COMP%]:root{--primary-color: #3F51B5;--primary-rgb: 63, 81, 181;--primary-color-hover: rgb(52.4655737705, 67.4557377049, 150.7344262295);--accent-color: #FF4081;--warn-color: #F44336;--background-color: #F5F5F5;--surface-color: #ffffff;--surface-lighter: #f9f9f9;--surface-darker: #eeeeee;--text-color: #212121;--text-secondary-color: hsl(0, 0%, -12.0588235294%);--text-hint-color: hsl(0, 0%, -32.0588235294%);--text-disabled-color: hsl(0, 0%, -52.0588235294%);--primary-contrast-color: white;--accent-contrast-color: white;--warn-contrast-color: white;--olt-color: #4CAF50;--ont-color: #2196F3;--odf-color: #FFC107;--edfa-color: #9C27B0;--splitter-color: #FF5722;--manga-color: #607D8B;--terminal-box-color: #FF9800;--slack-fiber-color: #80DEEA;--spacing-unit: 4px;--spacing-xxs: .125rem;--spacing-xs: .25rem;--spacing-sm: .5rem;--spacing-md: .75rem;--spacing-lg: 1rem;--spacing-xl: 1.5rem;--spacing-xxl: 2rem;--shadow-xs: 0 1px 2px rgba(0,0,0,.05);--shadow-sm: 0 1px 3px rgba(0, 0, 0, .1);--shadow-md: 0 2px 4px rgba(0, 0, 0, .1);--shadow-lg: 0 4px 6px rgba(0, 0, 0, .1);--border-radius-sm: 2px;--border-radius-md: 4px;--border-radius-lg: 8px;--border-radius-round: 50%;--border-color: #e0e0e0;--border-width-normal: 1px;--border-width-strong: 4px;--border-radius-pill: 20px;--border-color-light: rgb(249.5, 249.5, 249.5);--border-color-dark: rgb(198.5, 198.5, 198.5);--color-success: #4caf50;--color-warning: #ff8f00;--color-danger: #c62828;--color-info: #2196F3;--color-neutral: #9e9e9e;--color-success-bg: #e8f5e9;--color-warning-bg: #fff8e1;--color-danger-bg: #ffebee;--color-info-bg: rgb(226.5384615385, 241.5384615385, 253.4615384615);--color-maintenance-bg: #e3f2fd;--status-inactive-fg: #757575;--status-inactive-bg: #f5f5f5;--color-success-contrast: white;--color-warning-contrast: white;--color-danger-contrast: white;--color-info-contrast: #212121;--color-maintenance-contrast: white;--font-family: "Roboto, Segoe UI, sans-serif";--font-size-xxs: .625rem;--font-size-xs: .75rem;--font-size-sm: .875rem;--font-size-md: 1rem;--font-size-lg: 1.125rem;--font-size-xl: 1.25rem;--font-size-xxl: 1.5rem;--font-size-display: 2.5rem;--transition-fast: .15s ease-in-out;--transition-normal: .3s ease-in-out;--transition-slow: .5s ease-in-out;--status-active: #4caf50;--status-inactive: #757575;--status-maintenance: #1565c0;--status-planning: #2196F3;--status-unknown: var(--color-neutral);--status-fault: #c62828;--surface-overlay-light: rgba(255, 255, 255, .85);--surface-overlay-light-strong: rgba(255, 255, 255, .95);--border-color-semitransparent: rgba(0, 0, 0, .1);--primary-bg-subtle: rgba(63, 81, 181, .15);--surface-action-hover: rgb(242.8571428571, 242.8571428571, 242.8571428571);--surface-button: var(--surface-color);--surface-button-hover: var(--surface-action-hover);--text-color-button: var(--text-color);--scrollbar-track-color: #f1f1f1;--scrollbar-thumb-color: #c1c1c1;--scrollbar-thumb-hover-color: #a8a8a8;--z-index-map-base: 1;--z-index-map-elements: 5;--z-index-map-widgets-overlay: 50;--z-index-map-overlay: 100;--z-index-network-design-panels: 900;--z-index-debug-info: 999;--z-index-floating-panel-base: 1000;--z-index-performance-widget: 1000;--z-index-elements-panel: 1001;--z-index-layer-control: 1001;--z-index-sidebar: 1005;--z-index-map-legend: 1005;--z-index-sidebar-mobile: 1010;--z-index-loading-overlay: 1050;--z-index-dialog: 1075;--z-index-toolbar: 1100;--z-index-tooltip: 1150;--z-index-map-controls: 1201;--toolbar-height: 46px;--toolbar-button-height: 30px;--toolbar-button-height-mobile: 32px;--action-button-height: 40px;--menu-item-height: 42px;--icon-size-sm: 18px;--icon-size-md: 20px;--tooltip-bg-color: rgba(33, 33, 33, .95);--primary-ripple-color: rgba(var(--primary-rgb), .1)}[_ngcontent-%COMP%]:root.dark-theme, body.dark-theme[_ngcontent-%COMP%]{--background-color: #121212;--surface-color: #1e1e1e;--surface-lighter: rgb(42.75, 42.75, 42.75);--surface-darker: #121212;--text-color: #e0e0e0;--text-secondary-color: rgb(185.75, 185.75, 185.75);--text-hint-color: rgb(147.5, 147.5, 147.5);--text-disabled-color: rgb(109.25, 109.25, 109.25);--border-color: #444444;--border-color-light: rgb(93.5, 93.5, 93.5);--border-color-dark: rgb(42.5, 42.5, 42.5);--color-success-bg: rgb(51.8181818182, 119.1818181818, 57);--color-warning-bg: rgb(174, 133.4, 0);--color-danger-bg: rgb(184, 0, 27.6);--color-info-bg: rgb(8.9230769231, 95.9230769231, 165.0769230769);--color-maintenance-bg: rgb(11.6, 98.6, 162.4);--shadow-xs: 0 1px 2px rgba(0,0,0,.3);--shadow-sm: 0 1px 3px rgba(0,0,0,.4);--shadow-md: 0 2px 4px rgba(0,0,0,.5);--shadow-lg: 0 4px 6px rgba(0,0,0,.5);--surface-overlay-light: rgba(40, 40, 40, .85);--surface-overlay-light-strong: rgba(30, 30, 30, .95);--border-color-semitransparent: rgba(255, 255, 255, .1);--status-inactive-fg: hsl(0, 0%, 100.8823529412%);--status-inactive-bg: #383838;--primary-bg-subtle: rgba(63, 81, 181, .25);--surface-action-hover: rgb(55.5, 55.5, 55.5);--surface-button: var(--surface-color);--surface-button-hover: var(--surface-action-hover);--text-color-button: var(--text-color);--scrollbar-track-color: #333333;--scrollbar-thumb-color: #666666;--scrollbar-thumb-hover-color: #888888}.standard-panel-ui[_ngcontent-%COMP%]{background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-lg);overflow:hidden;display:flex;flex-direction:column}.standard-panel-ui[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-md);background-color:var(--surface-lighter);border-bottom:1px solid var(--border-color)}.standard-panel-ui[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:var(--font-size-md);font-weight:500;color:var(--text-color)}.standard-panel-ui[_ngcontent-%COMP%]   .panel-content[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-content[_ngcontent-%COMP%]{padding:var(--spacing-md);flex-grow:1;overflow-y:auto;color:var(--text-color)}.standard-panel-ui[_ngcontent-%COMP%]   .panel-actions[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:var(--spacing-sm);padding:var(--spacing-sm) var(--spacing-md);border-top:1px solid var(--border-color)}.standard-panel-ui[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]{display:flex;margin-bottom:var(--spacing-sm)}.standard-panel-ui[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]   .info-label[_ngcontent-%COMP%]{width:100px;font-weight:500;color:var(--text-secondary-color)}.standard-panel-ui[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]   .info-value[_ngcontent-%COMP%]{flex:1;color:var(--text-color)}.simple-panel-ui[_ngcontent-%COMP%]{background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-lg);padding:var(--spacing-md);color:var(--text-color)}.side-panel[_ngcontent-%COMP%]{background-color:var(--surface-color);border-radius:var(--border-radius-sm, 4px);box-shadow:var(--shadow-sm, 0 2px 10px rgba(0, 0, 0, .08));height:100%;width:var(--side-panel-width, 320px);display:flex;flex-direction:column;overflow:hidden}@media (max-width: 768px){.side-panel[_ngcontent-%COMP%]{width:var(--side-panel-width-tablet, 280px)}}@media (max-width: 600px){.side-panel[_ngcontent-%COMP%]{width:var(--side-panel-width-mobile, 100%);max-width:100vw}}.side-panel[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%]{height:var(--panel-header-height, 44px);min-height:var(--panel-header-height, 44px);display:flex;align-items:center;justify-content:space-between;padding:0 var(--spacing-sm);border-bottom:1px solid var(--border-color, rgba(0, 0, 0, .1))}.side-panel[_ngcontent-%COMP%]   .panel-content[_ngcontent-%COMP%]{flex:1;overflow:auto}.map-base-container[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;overflow:hidden;background-color:var(--background-color);transition:background-color var(--transition-normal)}.network-design[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}.network-design__toolbar[_ngcontent-%COMP%]{padding:0 var(--spacing-md);background-color:var(--primary-color);color:var(--primary-contrast-color);box-shadow:var(--shadow-md)}.network-design__header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-md);background-color:var(--primary-color);color:var(--primary-contrast-color);box-shadow:var(--shadow-md)}.network-design__header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:var(--font-size-xl);font-weight:500}.network-design__main[_ngcontent-%COMP%]{flex:1;display:flex;overflow:hidden;position:relative;padding:var(--spacing-md);background-color:var(--surface-color)}@media (max-width: 768px){.network-design__main[_ngcontent-%COMP%]{margin-left:0;padding:var(--spacing-sm)}}.network-design__main[_ngcontent-%COMP%]   .network-design__map[_ngcontent-%COMP%]{flex:1;position:relative;border-radius:var(--border-radius-md);overflow:hidden;box-shadow:var(--shadow-md);background-color:var(--surface-darker)}.network-design__main[_ngcontent-%COMP%]   .network-design__sidebar[_ngcontent-%COMP%]{width:300px;padding:var(--spacing-md);background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-md);margin-left:var(--spacing-md);overflow-y:auto;border-right:1px solid var(--border-color)}@media (max-width: 768px){.network-design__main[_ngcontent-%COMP%]   .network-design__sidebar[_ngcontent-%COMP%]{width:100%;position:fixed;top:0;left:0;height:100%;z-index:1000;transform:translate(-100%);transition:transform var(--transition-normal);margin-left:0;border-right:none}.network-design__main[_ngcontent-%COMP%]   .network-design__sidebar--open[_ngcontent-%COMP%]{transform:translate(0)}}.network-design__footer[_ngcontent-%COMP%]{padding:var(--spacing-md);background-color:var(--surface-lighter);border-top:1px solid var(--border-color);font-size:var(--font-size-sm);color:var(--text-color)}.network-design__element[_ngcontent-%COMP%]{padding:var(--spacing-md);margin-bottom:var(--spacing-md);background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-sm);transition:box-shadow var(--transition-fast)}.network-design__element[_ngcontent-%COMP%]:hover{box-shadow:var(--shadow-md)}.network-design__element--selected[_ngcontent-%COMP%]{border-left:4px solid var(--primary-color)}.status-badge-base[_ngcontent-%COMP%], .status-maintenance[_ngcontent-%COMP%], .status-warning[_ngcontent-%COMP%], .status-fault[_ngcontent-%COMP%], .status-inactive[_ngcontent-%COMP%], .status-active[_ngcontent-%COMP%]{display:inline-block;padding:var(--spacing-xs) var(--spacing-sm);border-radius:var(--border-radius-sm);font-size:var(--font-size-sm);font-weight:500}.status-active[_ngcontent-%COMP%]{background-color:var(--color-success-bg);color:var(--color-success-contrast)}.status-inactive[_ngcontent-%COMP%]{background-color:var(--status-inactive-bg);color:var(--status-inactive-fg)}.status-fault[_ngcontent-%COMP%]{background-color:var(--color-danger-bg);color:var(--color-danger-contrast)}.status-warning[_ngcontent-%COMP%]{background-color:var(--color-warning-bg);color:var(--color-warning-contrast)}.status-maintenance[_ngcontent-%COMP%]{background-color:var(--color-maintenance-bg);color:var(--color-maintenance-contrast)}.network-utils__status-badge[_ngcontent-%COMP%]{display:inline-block;padding:var(--spacing-xs) var(--spacing-sm);border-radius:var(--border-radius-sm);font-size:var(--font-size-xs);font-weight:500;text-transform:uppercase}.network-utils__status-badge--active[_ngcontent-%COMP%]{background-color:var(--color-success-bg);color:var(--color-success-contrast)}.network-utils__status-badge--inactive[_ngcontent-%COMP%]{background-color:var(--status-inactive-bg);color:var(--status-inactive-fg)}.network-utils__status-badge--maintenance[_ngcontent-%COMP%]{background-color:var(--color-maintenance-bg);color:var(--color-maintenance-contrast)}.network-utils__loading[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:var(--spacing-lg);color:var(--text-color)}.network-utils__error[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-md);background-color:#ffebee;color:var(--color-danger);border-radius:var(--border-radius-md)}.widget-container[_ngcontent-%COMP%]{position:absolute;z-index:var(--z-index-widgets-container, 1000);top:var(--spacing-sm, 8px);right:var(--spacing-sm, 8px);width:var(--widget-container-width, 300px);max-height:var(--widget-container-max-height, 70vh);overflow-y:auto;background-color:var(--surface-overlay-light, rgba(255, 255, 255, .7));padding:var(--spacing-xs, 4px) var(--spacing-sm, 8px);border-radius:var(--border-radius-md, 4px);font-size:var(--font-size-xs, 12px);box-shadow:var(--shadow-sm, 0 1px 3px rgba(0, 0, 0, .12))}.widget-container[_ngcontent-%COMP%]   .performance-metric[_ngcontent-%COMP%]{margin-right:var(--spacing-sm, 8px)}.widget-container[_ngcontent-%COMP%]   .performance-metric[_ngcontent-%COMP%]:last-child{margin-right:0}.map-widgets-container[_ngcontent-%COMP%]{position:absolute;z-index:var(--z-index-widgets-container, 1000);inset:0;pointer-events:none;display:flex;flex-direction:column;gap:var(--spacing-sm, 8px)}.mini-map-container[_ngcontent-%COMP%]{position:absolute;bottom:var(--spacing-lg, 20px);left:var(--spacing-lg, 20px);z-index:var(--z-index-map-widgets-overlay, 50);background-color:var(--surface-overlay-light, rgba(255, 255, 255, .8));z-index:var(--z-index-loading-overlay, 1050)}.mini-map-container[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{width:var(--spinner-size-lg, 50px);height:var(--spinner-size-lg, 50px);border:var(--spinner-border-width, 5px) solid var(--spinner-track-color, rgba(0, 0, 0, .1));border-radius:50%;border-top-color:var(--primary-color, #3f51b5);animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:var(--spacing-md, 12px)}.mini-map-container[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:var(--font-size-lg, 18px);color:var(--text-color, #333)}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.map-loading-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background-color:var(--surface-overlay-light, rgba(255, 255, 255, .9));z-index:var(--z-index-loading-overlay, 1050);display:flex;flex-direction:column;justify-content:center;align-items:center}.map-loading-overlay[_ngcontent-%COMP%]   .loading-message[_ngcontent-%COMP%]{font-size:var(--font-size-xl, 18px);font-weight:500}@media (max-width: 768px){.widget-container[_ngcontent-%COMP%]{width:var(--widget-container-width-tablet, 250px)}}@media (max-width: 480px){.widget-container[_ngcontent-%COMP%]{width:100%;max-width:none;top:auto;bottom:0;right:0;max-height:var(--widget-container-max-height-mobile, 40vh)}}[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;position:relative;overflow:hidden}.map-container[_ngcontent-%COMP%]{flex:1;position:relative;width:100%;overflow:hidden;background-color:var(--surface-level-1, #f5f5f5)}#map[_ngcontent-%COMP%], .map[_ngcontent-%COMP%]{width:100%;height:100%}.map-widgets-container[_ngcontent-%COMP%]{position:absolute;z-index:var(--z-index-widgets-container, 1000);inset:0;pointer-events:none}.map-widgets-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{pointer-events:auto}.map-loading-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background-color:var(--surface-overlay-light, rgba(255, 255, 255, .9));z-index:var(--z-index-loading-overlay, 1050);display:flex;flex-direction:column;justify-content:center;align-items:center;box-shadow:0 6px 24px #0000001a;animation:fadeInUp .35s cubic-bezier(.23,1,.32,1)}.map-loading-overlay[_ngcontent-%COMP%]   .loading-spinner[_ngcontent-%COMP%]{margin-bottom:var(--spacing-md, 16px)}.map-loading-overlay[_ngcontent-%COMP%]   .loading-message[_ngcontent-%COMP%]{font-size:var(--font-size-lg, 18px);font-weight:500;color:var(--text-color, #333333)}.map-error-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background-color:var(--surface-overlay-light-strong, rgba(255, 255, 255, .95));z-index:var(--z-index-loading-overlay, 1050);display:flex;flex-direction:column;justify-content:center;align-items:center;padding:var(--spacing-lg, 24px);text-align:center;box-shadow:0 6px 24px #ff00001a;animation:fadeInUp .35s cubic-bezier(.23,1,.32,1)}.map-error-overlay[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:var(--icon-size-xxxl, 48px);height:var(--icon-size-xxxl, 48px);width:var(--icon-size-xxxl, 48px);margin-bottom:var(--spacing-md, 16px);color:var(--color-danger, #f44336)}.map-error-overlay[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:var(--font-size-xl, 20px);font-weight:500;margin:0 0 var(--spacing-md, 16px) 0;color:var(--color-danger, #f44336)}.map-error-overlay[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:var(--font-size-md, 16px);max-width:400px;margin:0 0 var(--spacing-lg, 24px) 0;color:var(--text-color, #333333)}.map-error-overlay[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:var(--button-padding-y, var(--spacing-sm, 8px)) var(--button-padding-x, var(--spacing-md, 16px));background-color:var(--button-bg-color, var(--primary-color, #007bff));color:var(--button-text-color, white);border:var(--button-border, none);border-radius:var(--button-border-radius, var(--border-radius-md, 4px));min-width:150px}.map-content[_ngcontent-%COMP%]{flex:1;position:relative;width:100%;height:100%;z-index:var(--z-index-map-base, 1)}.map-content[_ngcontent-%COMP%]     .leaflet-container{width:100%!important;height:100%!important;background-color:var(--surface-level-1, #f5f5f5)!important;z-index:var(--z-index-map-base, 1)}.cursor-position[_ngcontent-%COMP%]{position:absolute;bottom:var(--spacing-lg, 20px);left:var(--spacing-lg, 20px);background-color:var(--surface-overlay-light, rgba(255, 255, 255, .9));padding:var(--spacing-xs, 5px) var(--spacing-sm, 10px);border-radius:var(--border-radius-md, 4px);font-size:var(--font-size-xs, 12px);box-shadow:var(--shadow-sm, 0 1px 3px rgba(0, 0, 0, .12));z-index:var(--z-index-map-widgets-overlay, 50);color:var(--text-color, #333)}.save-notification[_ngcontent-%COMP%]{position:absolute;top:var(--spacing-lg, 20px);right:var(--spacing-lg, 20px);background-color:var(--color-success-bg-strong, rgba(76, 175, 80, .9));color:var(--color-success-contrast, white);padding:var(--spacing-sm, 10px) var(--spacing-md, 15px);border-radius:var(--border-radius-md, 4px);display:flex;align-items:center;box-shadow:var(--shadow-md, 0 2px 6px rgba(0, 0, 0, .15));z-index:var(--z-index-dialog, 1075)}.save-notification[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:var(--spacing-sm, 8px)}.measurement-info[_ngcontent-%COMP%]{position:absolute;top:var(--spacing-xl, 80px);right:var(--spacing-lg, 20px);width:var(--measurement-info-width, 300px);background-color:var(--surface-color, white);border-radius:var(--border-radius-lg, 8px);box-shadow:var(--shadow-md, 0 2px 6px rgba(0, 0, 0, .15));z-index:var(--z-index-floating-panel-base, 1000);overflow:hidden;color:var(--text-color, #333)}.measurement-info[_ngcontent-%COMP%]   .measurement-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-sm, 10px) var(--spacing-md, 15px);background-color:var(--primary-color, #3f51b5);color:var(--primary-contrast-color, white)}.measurement-info[_ngcontent-%COMP%]   .measurement-content[_ngcontent-%COMP%]{padding:var(--spacing-md, 15px)}.measurement-info[_ngcontent-%COMP%]   .measurement-content[_ngcontent-%COMP%]   .measurement-distance[_ngcontent-%COMP%]{margin-top:var(--spacing-sm, 10px);font-size:var(--font-size-lg, 16px)}.measurement-info[_ngcontent-%COMP%]   .measurement-actions[_ngcontent-%COMP%]{padding:var(--spacing-sm, 10px);display:flex;justify-content:flex-end;border-top:1px solid var(--border-color, #eee)}app-network-toolbar[_ngcontent-%COMP%]{z-index:var(--z-index-toolbar, 1100);position:relative}.element-tooltip[_ngcontent-%COMP%]{position:absolute;background-color:var(--tooltip-bg-color, var(--surface-color, white));border-radius:var(--border-radius-sm, 4px);padding:var(--spacing-xs, 4px) var(--spacing-sm, 8px);box-shadow:var(--shadow-md, 0 2px 6px rgba(0, 0, 0, .15));font-size:var(--font-size-xs, 12px);color:var(--tooltip-text-color, var(--text-color, #333));max-width:200px;z-index:var(--z-index-tooltip, 1150);pointer-events:none}.element-tooltip__title[_ngcontent-%COMP%]{font-weight:500}.map-container[_ngcontent-%COMP%]:empty:after{content:"\\26a0\\fe0f  Error: No se pudo cargar el contenedor del mapa";display:flex;align-items:center;justify-content:center;height:100%;width:100%;background-color:var(--color-warning-bg-subtle, #ffcccc);color:var(--color-warning-contrast-strong, #d32f2f);font-size:var(--font-size-lg, 16px);font-weight:700;z-index:var(--z-index-map-base, 1)}.leaflet-container[_ngcontent-%COMP%]:not(:has(.leaflet-tile)):after{content:"\\26a0\\fe0f  Error: No se pudieron cargar las capas del mapa";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background-color:var(--surface-overlay-light, rgba(255, 255, 255, .9));padding:var(--spacing-sm, 12px) var(--spacing-md, 16px);border-radius:var(--border-radius-md, 4px);color:var(--color-danger-strong, #d32f2f);font-weight:700;z-index:var(--z-index-loading-overlay, 1050)}.map-error-message[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;background:var(--color-warning-bg, #fff3cd);color:var(--color-warning-contrast, #856404);border:1px solid var(--color-warning-border, #ffeeba);border-radius:var(--border-radius-lg, 8px);padding:var(--spacing-xl, 24px);margin:var(--spacing-lg, 16px) auto;max-width:400px;font-size:var(--font-size-md, 16px);box-shadow:var(--shadow-sm, 0 2px 8px rgba(0, 0, 0, .05));z-index:var(--z-index-map-overlay, 100)}.map-error-icon[_ngcontent-%COMP%]{font-size:var(--icon-size-xxxxl, 48px);margin-bottom:var(--spacing-md, 12px)}.map-error-text[_ngcontent-%COMP%]{text-align:center}.performance-info[_ngcontent-%COMP%]{position:absolute;bottom:var(--spacing-sm, 10px);left:var(--spacing-sm, 10px);background:#0009;color:#fff;padding:var(--spacing-xs, 5px) var(--spacing-sm, 10px);border-radius:var(--border-radius-md, 4px);font-size:var(--font-size-xs, 12px);z-index:var(--z-index-debug-info, 999)}.performance-metric[_ngcontent-%COMP%]{margin-right:var(--spacing-sm, 10px)}  .leaflet-popup-content-wrapper{border-radius:var(--border-radius-md, 4px);background-color:var(--surface-color, white);color:var(--text-color, #333)}  .leaflet-popup-tip{background-color:var(--surface-color, white)}  .leaflet-control-zoom{border-radius:var(--border-radius-md, 4px);border:none}  .leaflet-control-zoom a.leaflet-control-zoom-in,   .leaflet-control-zoom a.leaflet-control-zoom-out{border-radius:var(--border-radius-md, 4px)!important;background-color:var(--surface-button, var(--surface-color, white));color:var(--text-color-button, var(--text-color, #333));transition:background-color var(--transition-fast, .2s) ease}  .leaflet-control-zoom a.leaflet-control-zoom-in:hover,   .leaflet-control-zoom a.leaflet-control-zoom-out:hover{background-color:var(--surface-button-hover, var(--surface-hover, #f0f0f0))}  .marker-cluster{background-color:var(--primary-bg-semitransparent, rgba(63, 81, 181, .4))}  .marker-cluster div{background-color:var(--primary-bg-strong-semitransparent, rgba(63, 81, 181, .8));color:var(--primary-contrast-color, white);font-weight:700;border-radius:50%}  .marker-cluster:hover{background-color:var(--primary-bg-hover-semitransparent, rgba(63, 81, 181, .6))}  .leaflet-tooltip{background-color:var(--tooltip-leaflet-bg, var(--surface-overlay-light, rgba(255, 255, 255, .9)));color:var(--tooltip-leaflet-text-color, var(--text-color, #333));border:none;box-shadow:var(--shadow-md, 0 2px 6px rgba(0, 0, 0, .2));padding:var(--spacing-xs, 4px) var(--spacing-sm, 8px);font-size:var(--font-size-xs, 12px);border-radius:var(--border-radius-sm, 4px)}  .leaflet-control-attribution{background-color:var(--surface-overlay-light-semitransparent, rgba(255, 255, 255, .7))!important;color:var(--text-secondary-color, #666)!important}  .leaflet-marker-icon{cursor:pointer}'],changeDetection:0})};var kd=[{path:"",redirectTo:"map",pathMatch:"full"},{path:"map",component:mr,data:{animation:"map",breadcrumb:"Mapa",preload:!0,mapConfig:{initialZoom:16,initialCenter:[19.78375,-70.676666]}}},{path:"elements",loadComponent:()=>import("./chunk-TDOEUGWI.js").then(i=>i.ElementDetailsComponent),data:{animation:"list",breadcrumb:"Elementos"}},{path:"connections",loadComponent:()=>import("./chunk-6BJZWBWM.js").then(i=>i.ConnectionEditorComponent),data:{animation:"connections",breadcrumb:"Conexiones"}},{path:"monitoring",loadComponent:()=>import("./chunk-GHYN4P3R.js").then(i=>i.NetworkHealthWidgetComponent),data:{animation:"monitoring",breadcrumb:"Monitoreo"}},{path:"editor",loadComponent:()=>import("./chunk-X4GFUT5R.js").then(i=>i.ElementEditorComponent),canDeactivate:[Jt],data:{animation:"editor",breadcrumb:"Editor"}},{path:"editor/:id",loadComponent:()=>import("./chunk-X4GFUT5R.js").then(i=>i.ElementEditorComponent),canDeactivate:[Jt],data:{animation:"editor",breadcrumb:"Editor"}},{path:"elements/create",title:"Crear Elemento",loadComponent:()=>import("./chunk-X4GFUT5R.js").then(i=>i.ElementEditorComponent),canDeactivate:[Jt]},{path:"elements/:type/create",title:"Crear Elemento",loadComponent:()=>import("./chunk-X4GFUT5R.js").then(i=>i.ElementEditorComponent),canDeactivate:[Jt]},{path:"elements/:id",title:"Detalles del Elemento",loadComponent:()=>import("./chunk-TDOEUGWI.js").then(i=>i.ElementDetailsComponent)},{path:"elements/:id/edit",title:"Editar Elemento",loadComponent:()=>import("./chunk-X4GFUT5R.js").then(i=>i.ElementEditorComponent),canDeactivate:[Jt]},{path:"elements/:id/history",title:"Historial del Elemento",loadComponent:()=>import("./chunk-MDGX7YM5.js").then(i=>i.ElementHistoryComponent)},{path:"history/:id",loadComponent:()=>import("./chunk-MDGX7YM5.js").then(i=>i.ElementHistoryComponent),data:{animation:"history",breadcrumb:"Historial"}},{path:"diagnostic",loadComponent:()=>import("./chunk-3EMMQAWR.js").then(i=>i.MapDiagnosticComponent),data:{animation:"diagnostic",breadcrumb:"Diagn\xF3stico"}},{path:"position-selector",component:Uo,data:{animation:"position-selector",breadcrumb:"Selector de Posici\xF3n",isFullPage:!0}},{path:"error",component:$o,data:{animation:"error",breadcrumb:"Error"}},{path:"element/:type/edit/:id",loadComponent:()=>import("./chunk-X4GFUT5R.js").then(i=>i.ElementEditorComponent),data:{animation:"editor",breadcrumb:"Editor"}},{path:"element/:type/new",loadComponent:()=>import("./chunk-X4GFUT5R.js").then(i=>i.ElementEditorComponent),data:{animation:"editor",breadcrumb:"Nuevo"}},{path:"element/:type/batch",loadComponent:()=>import("./chunk-NCIAQR7F.js").then(i=>i.BatchElementEditorComponent),data:{animation:"editor",breadcrumb:"Editor por Lotes",icon:"library_add"}},{path:"element/history/:id",loadComponent:()=>import("./chunk-MDGX7YM5.js").then(i=>i.ElementHistoryComponent),data:{animation:"history",breadcrumb:"Historial",icon:"history"}},{path:"**",redirectTo:"error",data:{error:{code:404,message:"P\xE1gina no encontrada",description:"La ruta solicitada no existe en el sistema."}}}];var Dd=[{path:"",component:Do,children:[{path:"auth",canActivate:[Jc],loadComponent:()=>import("./chunk-L3P53UZK.js").then(i=>i.AuthComponent),loadChildren:()=>import("./chunk-IYLMOIIY.js").then(i=>i.authRoutes)},{path:"",component:Ro,canActivate:[Xc],children:[{path:"dashboard",loadComponent:()=>import("./chunk-FBMQJRTA.js").then(i=>i.DashboardLayoutComponent),loadChildren:()=>import("./chunk-J6FCQYPT.js").then(i=>i.DASHBOARD_ROUTES)},{path:"network-design",component:Vo,children:kd,data:{breadcrumb:"Dise\xF1o de Red",icon:"map",preload:!0}},{path:"projects",loadComponent:()=>import("./chunk-FO4J7YSL.js").then(i=>i.ProjectsComponent),loadChildren:()=>import("./chunk-NNPQEK5T.js").then(i=>i.PROJECTS_ROUTES),canMatch:[()=>ed(["admin","operator"])]},{path:"offline",loadComponent:()=>import("./chunk-RA4N25DE.js").then(i=>i.OfflineComponent),loadChildren:()=>import("./chunk-ZJDNCC2V.js").then(i=>i.OFFLINE_ROUTES)},{path:"",redirectTo:"dashboard",pathMatch:"full"}]}]},{path:"**",redirectTo:"dashboard"}];function Id(i){return new te(3e3,!1)}function vf(){return new te(3100,!1)}function _f(){return new te(3101,!1)}function bf(i){return new te(3001,!1)}function Cf(i){return new te(3003,!1)}function yf(i){return new te(3004,!1)}function Nd(i,e){return new te(3005,!1)}function Rd(){return new te(3006,!1)}function Ld(){return new te(3007,!1)}function Fd(i,e){return new te(3008,!1)}function zd(i){return new te(3002,!1)}function Bd(i,e,t,n,o){return new te(3010,!1)}function Vd(){return new te(3011,!1)}function $d(){return new te(3012,!1)}function jd(){return new te(3200,!1)}function Ud(){return new te(3202,!1)}function Hd(){return new te(3013,!1)}function Gd(i){return new te(3014,!1)}function Wd(i){return new te(3015,!1)}function Kd(i){return new te(3016,!1)}function qd(i,e){return new te(3404,!1)}function Ef(i){return new te(3502,!1)}function Qd(i){return new te(3503,!1)}function Zd(){return new te(3300,!1)}function Yd(i){return new te(3504,!1)}function Xd(i){return new te(3301,!1)}function Jd(i,e){return new te(3302,!1)}function ep(i){return new te(3303,!1)}function tp(i,e){return new te(3400,!1)}function np(i){return new te(3401,!1)}function ip(i){return new te(3402,!1)}function op(i,e){return new te(3505,!1)}function Bt(i){switch(i.length){case 0:return new mn;case 1:return i[0];default:return new so(i)}}function ja(i,e,t=new Map,n=new Map){let o=[],r=[],a=-1,c=null;if(e.forEach(m=>{let g=m.get("offset"),h=g==a,v=h&&c||new Map;m.forEach((w,T)=>{let x=T,S=w;if(T!=="offset")switch(x=i.normalizePropertyName(x,o),S){case bi:S=t.get(T);break;case bt:S=n.get(T);break;default:S=i.normalizeStyleValue(T,x,S,o);break}v.set(x,S)}),h||r.push(v),c=v,a=g}),o.length)throw Ef(o);return r}function gr(i,e,t,n){switch(e){case"start":i.onStart(()=>n(t&&Ba(t,"start",i)));break;case"done":i.onDone(()=>n(t&&Ba(t,"done",i)));break;case"destroy":i.onDestroy(()=>n(t&&Ba(t,"destroy",i)));break}}function Ba(i,e,t){let n=t.totalTime,o=!!t.disabled,r=ur(i.element,i.triggerName,i.fromState,i.toState,e||i.phaseName,n??i.totalTime,o),a=i._data;return a!=null&&(r._data=a),r}function ur(i,e,t,n,o="",r=0,a){return{element:i,triggerName:e,fromState:t,toState:n,phaseName:o,totalTime:r,disabled:!!a}}function et(i,e,t){let n=i.get(e);return n||i.set(e,n=t),n}function Ua(i){let e=i.indexOf(":"),t=i.substring(1,e),n=i.slice(e+1);return[t,n]}var wf=typeof document>"u"?null:document.documentElement;function hr(i){let e=i.parentNode||i.host||null;return e===wf?null:e}function xf(i){return i.substring(1,6)=="ebkit"}var un=null,Ad=!1;function rp(i){un||(un=Sf()||{},Ad=un.style?"WebkitAppearance"in un.style:!1);let e=!0;return un.style&&!xf(i)&&(e=i in un.style,!e&&Ad&&(e="Webkit"+i.charAt(0).toUpperCase()+i.slice(1)in un.style)),e}function Sf(){return typeof document<"u"?document.body:null}function Ha(i,e){for(;e;){if(e===i)return!0;e=hr(e)}return!1}function Ga(i,e,t){if(t)return Array.from(i.querySelectorAll(e));let n=i.querySelector(e);return n?[n]:[]}var Mf=1e3,Wa="{{",Tf="}}",Ka="ng-enter",fr="ng-leave",Oi="ng-trigger",ki=".ng-trigger",qa="ng-animating",vr=".ng-animating";function Nt(i){if(typeof i=="number")return i;let e=i.match(/^(-?[\.\d]+)(m?s)/);return!e||e.length<2?0:Va(parseFloat(e[1]),e[2])}function Va(i,e){switch(e){case"s":return i*Mf;default:return i}}function Di(i,e,t){return i.hasOwnProperty("duration")?i:Pf(i,e,t)}function Pf(i,e,t){let n=/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i,o,r=0,a="";if(typeof i=="string"){let c=i.match(n);if(c===null)return e.push(Id(i)),{duration:0,delay:0,easing:""};o=Va(parseFloat(c[1]),c[2]);let m=c[3];m!=null&&(r=Va(parseFloat(m),c[4]));let g=c[5];g&&(a=g)}else o=i;if(!t){let c=!1,m=e.length;o<0&&(e.push(vf()),c=!0),r<0&&(e.push(_f()),c=!0),c&&e.splice(m,0,Id(i))}return{duration:o,delay:r,easing:a}}function ap(i){return i.length?i[0]instanceof Map?i:i.map(e=>new Map(Object.entries(e))):[]}function wt(i,e,t){e.forEach((n,o)=>{let r=_r(o);t&&!t.has(o)&&t.set(o,i.style[r]),i.style[r]=n})}function tn(i,e){e.forEach((t,n)=>{let o=_r(n);i.style[o]=""})}function oi(i){return Array.isArray(i)?i.length==1?i[0]:ec(i):i}function sp(i,e,t){let n=e.params||{},o=Qa(i);o.length&&o.forEach(r=>{n.hasOwnProperty(r)||t.push(bf(r))})}var $a=new RegExp(`${Wa}\\s*(.+?)\\s*${Tf}`,"g");function Qa(i){let e=[];if(typeof i=="string"){let t;for(;t=$a.exec(i);)e.push(t[1]);$a.lastIndex=0}return e}function ri(i,e,t){let n=`${i}`,o=n.replace($a,(r,a)=>{let c=e[a];return c==null&&(t.push(Cf(a)),c=""),c.toString()});return o==n?i:o}var Of=/-+([a-z0-9])/g;function _r(i){return i.replace(Of,(...e)=>e[1].toUpperCase())}function lp(i,e){return i===0||e===0}function cp(i,e,t){if(t.size&&e.length){let n=e[0],o=[];if(t.forEach((r,a)=>{n.has(a)||o.push(a),n.set(a,r)}),o.length)for(let r=1;r<e.length;r++){let a=e[r];o.forEach(c=>a.set(c,br(i,c)))}}return e}function tt(i,e,t){switch(e.type){case Y.Trigger:return i.visitTrigger(e,t);case Y.State:return i.visitState(e,t);case Y.Transition:return i.visitTransition(e,t);case Y.Sequence:return i.visitSequence(e,t);case Y.Group:return i.visitGroup(e,t);case Y.Animate:return i.visitAnimate(e,t);case Y.Keyframes:return i.visitKeyframes(e,t);case Y.Style:return i.visitStyle(e,t);case Y.Reference:return i.visitReference(e,t);case Y.AnimateChild:return i.visitAnimateChild(e,t);case Y.AnimateRef:return i.visitAnimateRef(e,t);case Y.Query:return i.visitQuery(e,t);case Y.Stagger:return i.visitStagger(e,t);default:throw yf(e.type)}}function br(i,e){return window.getComputedStyle(i)[e]}var ms=(()=>{class i{validateStyleProperty(t){return rp(t)}containsElement(t,n){return Ha(t,n)}getParentElement(t){return hr(t)}query(t,n,o){return Ga(t,n,o)}computeStyle(t,n,o){return o||""}animate(t,n,o,r,a,c=[],m){return new mn(o,r)}static \u0275fac=function(n){return new(n||i)};static \u0275prov=k({token:i,factory:i.\u0275fac})}return i})(),fn=class{static NOOP=new ms},vn=class{};var kf=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]),xr=class extends vn{normalizePropertyName(e,t){return _r(e)}normalizeStyleValue(e,t,n,o){let r="",a=n.toString().trim();if(kf.has(t)&&n!==0&&n!=="0")if(typeof n=="number")r="px";else{let c=n.match(/^[+-]?[\d\.]+([a-z]*)$/);c&&c[1].length==0&&o.push(Nd(e,n))}return a+r}};var Sr="*";function Df(i,e){let t=[];return typeof i=="string"?i.split(/\s*,\s*/).forEach(n=>If(n,t,e)):t.push(i),t}function If(i,e,t){if(i[0]==":"){let m=Af(i,t);if(typeof m=="function"){e.push(m);return}i=m}let n=i.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(n==null||n.length<4)return t.push(Wd(i)),e;let o=n[1],r=n[2],a=n[3];e.push(dp(o,a));let c=o==Sr&&a==Sr;r[0]=="<"&&!c&&e.push(dp(a,o))}function Af(i,e){switch(i){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,n)=>parseFloat(n)>parseFloat(t);case":decrement":return(t,n)=>parseFloat(n)<parseFloat(t);default:return e.push(Kd(i)),"* => *"}}var Cr=new Set(["true","1"]),yr=new Set(["false","0"]);function dp(i,e){let t=Cr.has(i)||yr.has(i),n=Cr.has(e)||yr.has(e);return(o,r)=>{let a=i==Sr||i==o,c=e==Sr||e==r;return!a&&t&&typeof o=="boolean"&&(a=o?Cr.has(i):yr.has(i)),!c&&n&&typeof r=="boolean"&&(c=r?Cr.has(e):yr.has(e)),a&&c}}var Cp=":self",Nf=new RegExp(`s*${Cp}s*,?`,"g");function yp(i,e,t,n){return new ts(i).build(e,t,n)}var pp="",ts=class{_driver;constructor(e){this._driver=e}build(e,t,n){let o=new ns(t);return this._resetContextStyleTimingState(o),tt(this,oi(e),o)}_resetContextStyleTimingState(e){e.currentQuerySelector=pp,e.collectedStyles=new Map,e.collectedStyles.set(pp,new Map),e.currentTime=0}visitTrigger(e,t){let n=t.queryCount=0,o=t.depCount=0,r=[],a=[];return e.name.charAt(0)=="@"&&t.errors.push(Rd()),e.definitions.forEach(c=>{if(this._resetContextStyleTimingState(t),c.type==Y.State){let m=c,g=m.name;g.toString().split(/\s*,\s*/).forEach(h=>{m.name=h,r.push(this.visitState(m,t))}),m.name=g}else if(c.type==Y.Transition){let m=this.visitTransition(c,t);n+=m.queryCount,o+=m.depCount,a.push(m)}else t.errors.push(Ld())}),{type:Y.Trigger,name:e.name,states:r,transitions:a,queryCount:n,depCount:o,options:null}}visitState(e,t){let n=this.visitStyle(e.styles,t),o=e.options&&e.options.params||null;if(n.containsDynamicStyles){let r=new Set,a=o||{};n.styles.forEach(c=>{c instanceof Map&&c.forEach(m=>{Qa(m).forEach(g=>{a.hasOwnProperty(g)||r.add(g)})})}),r.size&&t.errors.push(Fd(e.name,[...r.values()]))}return{type:Y.State,name:e.name,style:n,options:o?{params:o}:null}}visitTransition(e,t){t.queryCount=0,t.depCount=0;let n=tt(this,oi(e.animation),t),o=Df(e.expr,t.errors);return{type:Y.Transition,matchers:o,animation:n,queryCount:t.queryCount,depCount:t.depCount,options:hn(e.options)}}visitSequence(e,t){return{type:Y.Sequence,steps:e.steps.map(n=>tt(this,n,t)),options:hn(e.options)}}visitGroup(e,t){let n=t.currentTime,o=0,r=e.steps.map(a=>{t.currentTime=n;let c=tt(this,a,t);return o=Math.max(o,t.currentTime),c});return t.currentTime=o,{type:Y.Group,steps:r,options:hn(e.options)}}visitAnimate(e,t){let n=zf(e.timings,t.errors);t.currentAnimateTimings=n;let o,r=e.styles?e.styles:pe({});if(r.type==Y.Keyframes)o=this.visitKeyframes(r,t);else{let a=e.styles,c=!1;if(!a){c=!0;let g={};n.easing&&(g.easing=n.easing),a=pe(g)}t.currentTime+=n.duration+n.delay;let m=this.visitStyle(a,t);m.isEmptyStep=c,o=m}return t.currentAnimateTimings=null,{type:Y.Animate,timings:n,style:o,options:null}}visitStyle(e,t){let n=this._makeStyleAst(e,t);return this._validateStyleAst(n,t),n}_makeStyleAst(e,t){let n=[],o=Array.isArray(e.styles)?e.styles:[e.styles];for(let c of o)typeof c=="string"?c===bt?n.push(c):t.errors.push(zd(c)):n.push(new Map(Object.entries(c)));let r=!1,a=null;return n.forEach(c=>{if(c instanceof Map&&(c.has("easing")&&(a=c.get("easing"),c.delete("easing")),!r)){for(let m of c.values())if(m.toString().indexOf(Wa)>=0){r=!0;break}}}),{type:Y.Style,styles:n,easing:a,offset:e.offset,containsDynamicStyles:r,options:null}}_validateStyleAst(e,t){let n=t.currentAnimateTimings,o=t.currentTime,r=t.currentTime;n&&r>0&&(r-=n.duration+n.delay),e.styles.forEach(a=>{typeof a!="string"&&a.forEach((c,m)=>{let g=t.collectedStyles.get(t.currentQuerySelector),h=g.get(m),v=!0;h&&(r!=o&&r>=h.startTime&&o<=h.endTime&&(t.errors.push(Bd(m,h.startTime,h.endTime,r,o)),v=!1),r=h.startTime),v&&g.set(m,{startTime:r,endTime:o}),t.options&&sp(c,t.options,t.errors)})})}visitKeyframes(e,t){let n={type:Y.Keyframes,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push(Vd()),n;let o=1,r=0,a=[],c=!1,m=!1,g=0,h=e.steps.map(Q=>{let ne=this._makeStyleAst(Q,t),re=ne.offset!=null?ne.offset:Ff(ne.styles),H=0;return re!=null&&(r++,H=ne.offset=re),m=m||H<0||H>1,c=c||H<g,g=H,a.push(H),ne});m&&t.errors.push($d()),c&&t.errors.push(jd());let v=e.steps.length,w=0;r>0&&r<v?t.errors.push(Ud()):r==0&&(w=o/(v-1));let T=v-1,x=t.currentTime,S=t.currentAnimateTimings,z=S.duration;return h.forEach((Q,ne)=>{let re=w>0?ne==T?1:w*ne:a[ne],H=re*z;t.currentTime=x+S.delay+H,S.duration=H,this._validateStyleAst(Q,t),Q.offset=re,n.styles.push(Q)}),n}visitReference(e,t){return{type:Y.Reference,animation:tt(this,oi(e.animation),t),options:hn(e.options)}}visitAnimateChild(e,t){return t.depCount++,{type:Y.AnimateChild,options:hn(e.options)}}visitAnimateRef(e,t){return{type:Y.AnimateRef,animation:this.visitReference(e.animation,t),options:hn(e.options)}}visitQuery(e,t){let n=t.currentQuerySelector,o=e.options||{};t.queryCount++,t.currentQuery=e;let[r,a]=Rf(e.selector);t.currentQuerySelector=n.length?n+" "+r:r,et(t.collectedStyles,t.currentQuerySelector,new Map);let c=tt(this,oi(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=n,{type:Y.Query,selector:r,limit:o.limit||0,optional:!!o.optional,includeSelf:a,animation:c,originalSelector:e.selector,options:hn(e.options)}}visitStagger(e,t){t.currentQuery||t.errors.push(Hd());let n=e.timings==="full"?{duration:0,delay:0,easing:"full"}:Di(e.timings,t.errors,!0);return{type:Y.Stagger,animation:tt(this,oi(e.animation),t),timings:n,options:null}}};function Rf(i){let e=!!i.split(/\s*,\s*/).find(t=>t==Cp);return e&&(i=i.replace(Nf,"")),i=i.replace(/@\*/g,ki).replace(/@\w+/g,t=>ki+"-"+t.slice(1)).replace(/:animating/g,vr),[i,e]}function Lf(i){return i?O({},i):null}var ns=class{errors;queryCount=0;depCount=0;currentTransition=null;currentQuery=null;currentQuerySelector=null;currentAnimateTimings=null;currentTime=0;collectedStyles=new Map;options=null;unsupportedCSSPropertiesFound=new Set;constructor(e){this.errors=e}};function Ff(i){if(typeof i=="string")return null;let e=null;if(Array.isArray(i))i.forEach(t=>{if(t instanceof Map&&t.has("offset")){let n=t;e=parseFloat(n.get("offset")),n.delete("offset")}});else if(i instanceof Map&&i.has("offset")){let t=i;e=parseFloat(t.get("offset")),t.delete("offset")}return e}function zf(i,e){if(i.hasOwnProperty("duration"))return i;if(typeof i=="number"){let r=Di(i,e).duration;return Za(r,0,"")}let t=i;if(t.split(/\s+/).some(r=>r.charAt(0)=="{"&&r.charAt(1)=="{")){let r=Za(0,0,"");return r.dynamic=!0,r.strValue=t,r}let o=Di(t,e);return Za(o.duration,o.delay,o.easing)}function hn(i){return i?(i=O({},i),i.params&&(i.params=Lf(i.params))):i={},i}function Za(i,e,t){return{duration:i,delay:e,easing:t}}function gs(i,e,t,n,o,r,a=null,c=!1){return{type:1,element:i,keyframes:e,preStyleProps:t,postStyleProps:n,duration:o,delay:r,totalTime:o+r,easing:a,subTimeline:c}}var Ai=class{_map=new Map;get(e){return this._map.get(e)||[]}append(e,t){let n=this._map.get(e);n||this._map.set(e,n=[]),n.push(...t)}has(e){return this._map.has(e)}clear(){this._map.clear()}},Bf=1,Vf=":enter",$f=new RegExp(Vf,"g"),jf=":leave",Uf=new RegExp(jf,"g");function Ep(i,e,t,n,o,r=new Map,a=new Map,c,m,g=[]){return new is().buildKeyframes(i,e,t,n,o,r,a,c,m,g)}var is=class{buildKeyframes(e,t,n,o,r,a,c,m,g,h=[]){g=g||new Ai;let v=new os(e,t,g,o,r,h,[]);v.options=m;let w=m.delay?Nt(m.delay):0;v.currentTimeline.delayNextStep(w),v.currentTimeline.setStyles([a],null,v.errors,m),tt(this,n,v);let T=v.timelines.filter(x=>x.containsAnimation());if(T.length&&c.size){let x;for(let S=T.length-1;S>=0;S--){let z=T[S];if(z.element===t){x=z;break}}x&&!x.allowOnlyTimelineStyles()&&x.setStyles([c],null,v.errors,m)}return T.length?T.map(x=>x.buildKeyframes()):[gs(t,[],[],[],0,w,"",!1)]}visitTrigger(e,t){}visitState(e,t){}visitTransition(e,t){}visitAnimateChild(e,t){let n=t.subInstructions.get(t.element);if(n){let o=t.createSubContext(e.options),r=t.currentTimeline.currentTime,a=this._visitSubInstructions(n,o,o.options);r!=a&&t.transformIntoNewTimeline(a)}t.previousNode=e}visitAnimateRef(e,t){let n=t.createSubContext(e.options);n.transformIntoNewTimeline(),this._applyAnimationRefDelays([e.options,e.animation.options],t,n),this.visitReference(e.animation,n),t.transformIntoNewTimeline(n.currentTimeline.currentTime),t.previousNode=e}_applyAnimationRefDelays(e,t,n){for(let o of e){let r=o?.delay;if(r){let a=typeof r=="number"?r:Nt(ri(r,o?.params??{},t.errors));n.delayNextStep(a)}}}_visitSubInstructions(e,t,n){let r=t.currentTimeline.currentTime,a=n.duration!=null?Nt(n.duration):null,c=n.delay!=null?Nt(n.delay):null;return a!==0&&e.forEach(m=>{let g=t.appendInstructionToTimeline(m,a,c);r=Math.max(r,g.duration+g.delay)}),r}visitReference(e,t){t.updateOptions(e.options,!0),tt(this,e.animation,t),t.previousNode=e}visitSequence(e,t){let n=t.subContextCount,o=t,r=e.options;if(r&&(r.params||r.delay)&&(o=t.createSubContext(r),o.transformIntoNewTimeline(),r.delay!=null)){o.previousNode.type==Y.Style&&(o.currentTimeline.snapshotCurrentStyles(),o.previousNode=Mr);let a=Nt(r.delay);o.delayNextStep(a)}e.steps.length&&(e.steps.forEach(a=>tt(this,a,o)),o.currentTimeline.applyStylesToKeyframe(),o.subContextCount>n&&o.transformIntoNewTimeline()),t.previousNode=e}visitGroup(e,t){let n=[],o=t.currentTimeline.currentTime,r=e.options&&e.options.delay?Nt(e.options.delay):0;e.steps.forEach(a=>{let c=t.createSubContext(e.options);r&&c.delayNextStep(r),tt(this,a,c),o=Math.max(o,c.currentTimeline.currentTime),n.push(c.currentTimeline)}),n.forEach(a=>t.currentTimeline.mergeTimelineCollectedStyles(a)),t.transformIntoNewTimeline(o),t.previousNode=e}_visitTiming(e,t){if(e.dynamic){let n=e.strValue,o=t.params?ri(n,t.params,t.errors):n;return Di(o,t.errors)}else return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,t){let n=t.currentAnimateTimings=this._visitTiming(e.timings,t),o=t.currentTimeline;n.delay&&(t.incrementTime(n.delay),o.snapshotCurrentStyles());let r=e.style;r.type==Y.Keyframes?this.visitKeyframes(r,t):(t.incrementTime(n.duration),this.visitStyle(r,t),o.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}visitStyle(e,t){let n=t.currentTimeline,o=t.currentAnimateTimings;!o&&n.hasCurrentStyleProperties()&&n.forwardFrame();let r=o&&o.easing||e.easing;e.isEmptyStep?n.applyEmptyStep(r):n.setStyles(e.styles,r,t.errors,t.options),t.previousNode=e}visitKeyframes(e,t){let n=t.currentAnimateTimings,o=t.currentTimeline.duration,r=n.duration,c=t.createSubContext().currentTimeline;c.easing=n.easing,e.styles.forEach(m=>{let g=m.offset||0;c.forwardTime(g*r),c.setStyles(m.styles,m.easing,t.errors,t.options),c.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(c),t.transformIntoNewTimeline(o+r),t.previousNode=e}visitQuery(e,t){let n=t.currentTimeline.currentTime,o=e.options||{},r=o.delay?Nt(o.delay):0;r&&(t.previousNode.type===Y.Style||n==0&&t.currentTimeline.hasCurrentStyleProperties())&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=Mr);let a=n,c=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!o.optional,t.errors);t.currentQueryTotal=c.length;let m=null;c.forEach((g,h)=>{t.currentQueryIndex=h;let v=t.createSubContext(e.options,g);r&&v.delayNextStep(r),g===t.element&&(m=v.currentTimeline),tt(this,e.animation,v),v.currentTimeline.applyStylesToKeyframe();let w=v.currentTimeline.currentTime;a=Math.max(a,w)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(a),m&&(t.currentTimeline.mergeTimelineCollectedStyles(m),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}visitStagger(e,t){let n=t.parentContext,o=t.currentTimeline,r=e.timings,a=Math.abs(r.duration),c=a*(t.currentQueryTotal-1),m=a*t.currentQueryIndex;switch(r.duration<0?"reverse":r.easing){case"reverse":m=c-m;break;case"full":m=n.currentStaggerTime;break}let h=t.currentTimeline;m&&h.delayNextStep(m);let v=h.currentTime;tt(this,e.animation,t),t.previousNode=e,n.currentStaggerTime=o.currentTime-v+(o.startTime-n.currentTimeline.startTime)}},Mr={},os=class i{_driver;element;subInstructions;_enterClassName;_leaveClassName;errors;timelines;parentContext=null;currentTimeline;currentAnimateTimings=null;previousNode=Mr;subContextCount=0;options={};currentQueryIndex=0;currentQueryTotal=0;currentStaggerTime=0;constructor(e,t,n,o,r,a,c,m){this._driver=e,this.element=t,this.subInstructions=n,this._enterClassName=o,this._leaveClassName=r,this.errors=a,this.timelines=c,this.currentTimeline=m||new Tr(this._driver,t,0),c.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,t){if(!e)return;let n=e,o=this.options;n.duration!=null&&(o.duration=Nt(n.duration)),n.delay!=null&&(o.delay=Nt(n.delay));let r=n.params;if(r){let a=o.params;a||(a=this.options.params={}),Object.keys(r).forEach(c=>{(!t||!a.hasOwnProperty(c))&&(a[c]=ri(r[c],a,this.errors))})}}_copyOptions(){let e={};if(this.options){let t=this.options.params;if(t){let n=e.params={};Object.keys(t).forEach(o=>{n[o]=t[o]})}}return e}createSubContext(e=null,t,n){let o=t||this.element,r=new i(this._driver,o,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(o,n||0));return r.previousNode=this.previousNode,r.currentAnimateTimings=this.currentAnimateTimings,r.options=this._copyOptions(),r.updateOptions(e),r.currentQueryIndex=this.currentQueryIndex,r.currentQueryTotal=this.currentQueryTotal,r.parentContext=this,this.subContextCount++,r}transformIntoNewTimeline(e){return this.previousNode=Mr,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,t,n){let o={duration:t??e.duration,delay:this.currentTimeline.currentTime+(n??0)+e.delay,easing:""},r=new rs(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,o,e.stretchStartingKeyframe);return this.timelines.push(r),o}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,t,n,o,r,a){let c=[];if(o&&c.push(this.element),e.length>0){e=e.replace($f,"."+this._enterClassName),e=e.replace(Uf,"."+this._leaveClassName);let m=n!=1,g=this._driver.query(this.element,e,m);n!==0&&(g=n<0?g.slice(g.length+n,g.length):g.slice(0,n)),c.push(...g)}return!r&&c.length==0&&a.push(Gd(t)),c}},Tr=class i{_driver;element;startTime;_elementTimelineStylesLookup;duration=0;easing=null;_previousKeyframe=new Map;_currentKeyframe=new Map;_keyframes=new Map;_styleSummary=new Map;_localTimelineStyles=new Map;_globalTimelineStyles;_pendingStyles=new Map;_backFill=new Map;_currentEmptyStepKeyframe=null;constructor(e,t,n,o){this._driver=e,this.element=t,this.startTime=n,this._elementTimelineStylesLookup=o,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(e){let t=this._keyframes.size===1&&this._pendingStyles.size;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,t){return this.applyStylesToKeyframe(),new i(this._driver,e,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=Bf,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,t){this._localTimelineStyles.set(e,t),this._globalTimelineStyles.set(e,t),this._styleSummary.set(e,{time:this.currentTime,value:t})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&this._previousKeyframe.set("easing",e);for(let[t,n]of this._globalTimelineStyles)this._backFill.set(t,n||bt),this._currentKeyframe.set(t,bt);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,t,n,o){t&&this._previousKeyframe.set("easing",t);let r=o&&o.params||{},a=Hf(e,this._globalTimelineStyles);for(let[c,m]of a){let g=ri(m,r,n);this._pendingStyles.set(c,g),this._localTimelineStyles.has(c)||this._backFill.set(c,this._globalTimelineStyles.get(c)??bt),this._updateStyle(c,g)}}applyStylesToKeyframe(){this._pendingStyles.size!=0&&(this._pendingStyles.forEach((e,t)=>{this._currentKeyframe.set(t,e)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((e,t)=>{this._currentKeyframe.has(t)||this._currentKeyframe.set(t,e)}))}snapshotCurrentStyles(){for(let[e,t]of this._localTimelineStyles)this._pendingStyles.set(e,t),this._updateStyle(e,t)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){let e=[];for(let t in this._currentKeyframe)e.push(t);return e}mergeTimelineCollectedStyles(e){e._styleSummary.forEach((t,n)=>{let o=this._styleSummary.get(n);(!o||t.time>o.time)&&this._updateStyle(n,t.value)})}buildKeyframes(){this.applyStylesToKeyframe();let e=new Set,t=new Set,n=this._keyframes.size===1&&this.duration===0,o=[];this._keyframes.forEach((c,m)=>{let g=new Map([...this._backFill,...c]);g.forEach((h,v)=>{h===bi?e.add(v):h===bt&&t.add(v)}),n||g.set("offset",m/this.duration),o.push(g)});let r=[...e.values()],a=[...t.values()];if(n){let c=o[0],m=new Map(c);c.set("offset",0),m.set("offset",1),o=[c,m]}return gs(this.element,o,r,a,this.duration,this.startTime,this.easing,!1)}},rs=class extends Tr{keyframes;preStyleProps;postStyleProps;_stretchStartingKeyframe;timings;constructor(e,t,n,o,r,a,c=!1){super(e,t,a.delay),this.keyframes=n,this.preStyleProps=o,this.postStyleProps=r,this._stretchStartingKeyframe=c,this.timings={duration:a.duration,delay:a.delay,easing:a.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:t,duration:n,easing:o}=this.timings;if(this._stretchStartingKeyframe&&t){let r=[],a=n+t,c=t/a,m=new Map(e[0]);m.set("offset",0),r.push(m);let g=new Map(e[0]);g.set("offset",mp(c)),r.push(g);let h=e.length-1;for(let v=1;v<=h;v++){let w=new Map(e[v]),T=w.get("offset"),x=t+T*n;w.set("offset",mp(x/a)),r.push(w)}n=a,t=0,o="",e=r}return gs(this.element,e,this.preStyleProps,this.postStyleProps,n,t,o,!0)}};function mp(i,e=3){let t=Math.pow(10,e-1);return Math.round(i*t)/t}function Hf(i,e){let t=new Map,n;return i.forEach(o=>{if(o==="*"){n??=e.keys();for(let r of n)t.set(r,bt)}else for(let[r,a]of o)t.set(r,a)}),t}function gp(i,e,t,n,o,r,a,c,m,g,h,v,w){return{type:0,element:i,triggerName:e,isRemovalTransition:o,fromState:t,fromStyles:r,toState:n,toStyles:a,timelines:c,queriedElements:m,preStyleProps:g,postStyleProps:h,totalTime:v,errors:w}}var Ya={},Pr=class{_triggerName;ast;_stateStyles;constructor(e,t,n){this._triggerName=e,this.ast=t,this._stateStyles=n}match(e,t,n,o){return Gf(this.ast.matchers,e,t,n,o)}buildStyles(e,t,n){let o=this._stateStyles.get("*");return e!==void 0&&(o=this._stateStyles.get(e?.toString())||o),o?o.buildStyles(t,n):new Map}build(e,t,n,o,r,a,c,m,g,h){let v=[],w=this.ast.options&&this.ast.options.params||Ya,T=c&&c.params||Ya,x=this.buildStyles(n,T,v),S=m&&m.params||Ya,z=this.buildStyles(o,S,v),Q=new Set,ne=new Map,re=new Map,H=o==="void",oe={params:wp(S,w),delay:this.ast.options?.delay},J=h?[]:Ep(e,t,this.ast.animation,r,a,x,z,oe,g,v),ve=0;return J.forEach(ue=>{ve=Math.max(ue.duration+ue.delay,ve)}),v.length?gp(t,this._triggerName,n,o,H,x,z,[],[],ne,re,ve,v):(J.forEach(ue=>{let ft=ue.element,yn=et(ne,ft,new Set);ue.preStyleProps.forEach(nn=>yn.add(nn));let Os=et(re,ft,new Set);ue.postStyleProps.forEach(nn=>Os.add(nn)),ft!==t&&Q.add(ft)}),gp(t,this._triggerName,n,o,H,x,z,J,[...Q.values()],ne,re,ve))}};function Gf(i,e,t,n,o){return i.some(r=>r(e,t,n,o))}function wp(i,e){let t=O({},e);return Object.entries(i).forEach(([n,o])=>{o!=null&&(t[n]=o)}),t}var as=class{styles;defaultParams;normalizer;constructor(e,t,n){this.styles=e,this.defaultParams=t,this.normalizer=n}buildStyles(e,t){let n=new Map,o=wp(e,this.defaultParams);return this.styles.styles.forEach(r=>{typeof r!="string"&&r.forEach((a,c)=>{a&&(a=ri(a,o,t));let m=this.normalizer.normalizePropertyName(c,t);a=this.normalizer.normalizeStyleValue(c,m,a,t),n.set(c,a)})}),n}};function Wf(i,e,t){return new ss(i,e,t)}var ss=class{name;ast;_normalizer;transitionFactories=[];fallbackTransition;states=new Map;constructor(e,t,n){this.name=e,this.ast=t,this._normalizer=n,t.states.forEach(o=>{let r=o.options&&o.options.params||{};this.states.set(o.name,new as(o.style,r,n))}),up(this.states,"true","1"),up(this.states,"false","0"),t.transitions.forEach(o=>{this.transitionFactories.push(new Pr(e,o,this.states))}),this.fallbackTransition=Kf(e,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,t,n,o){return this.transitionFactories.find(a=>a.match(e,t,n,o))||null}matchStyles(e,t,n){return this.fallbackTransition.buildStyles(e,t,n)}};function Kf(i,e,t){let n=[(a,c)=>!0],o={type:Y.Sequence,steps:[],options:null},r={type:Y.Transition,animation:o,matchers:n,options:null,queryCount:0,depCount:0};return new Pr(i,r,e)}function up(i,e,t){i.has(e)?i.has(t)||i.set(t,i.get(e)):i.has(t)&&i.set(e,i.get(t))}var qf=new Ai,ls=class{bodyNode;_driver;_normalizer;_animations=new Map;_playersById=new Map;players=[];constructor(e,t,n){this.bodyNode=e,this._driver=t,this._normalizer=n}register(e,t){let n=[],o=[],r=yp(this._driver,t,n,o);if(n.length)throw Qd(n);this._animations.set(e,r)}_buildPlayer(e,t,n){let o=e.element,r=ja(this._normalizer,e.keyframes,t,n);return this._driver.animate(o,r,e.duration,e.delay,e.easing,[],!0)}create(e,t,n={}){let o=[],r=this._animations.get(e),a,c=new Map;if(r?(a=Ep(this._driver,t,r,Ka,fr,new Map,new Map,n,qf,o),a.forEach(h=>{let v=et(c,h.element,new Map);h.postStyleProps.forEach(w=>v.set(w,null))})):(o.push(Zd()),a=[]),o.length)throw Yd(o);c.forEach((h,v)=>{h.forEach((w,T)=>{h.set(T,this._driver.computeStyle(v,T,bt))})});let m=a.map(h=>{let v=c.get(h.element);return this._buildPlayer(h,new Map,v)}),g=Bt(m);return this._playersById.set(e,g),g.onDestroy(()=>this.destroy(e)),this.players.push(g),g}destroy(e){let t=this._getPlayer(e);t.destroy(),this._playersById.delete(e);let n=this.players.indexOf(t);n>=0&&this.players.splice(n,1)}_getPlayer(e){let t=this._playersById.get(e);if(!t)throw Xd(e);return t}listen(e,t,n,o){let r=ur(t,"","","");return gr(this._getPlayer(e),n,r,o),()=>{}}command(e,t,n,o){if(n=="register"){this.register(e,o[0]);return}if(n=="create"){let a=o[0]||{};this.create(e,t,a);return}let r=this._getPlayer(e);switch(n){case"play":r.play();break;case"pause":r.pause();break;case"reset":r.reset();break;case"restart":r.restart();break;case"finish":r.finish();break;case"init":r.init();break;case"setPosition":r.setPosition(parseFloat(o[0]));break;case"destroy":this.destroy(e);break}}},hp="ng-animate-queued",Qf=".ng-animate-queued",Xa="ng-animate-disabled",Zf=".ng-animate-disabled",Yf="ng-star-inserted",Xf=".ng-star-inserted",Jf=[],xp={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},e0={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},xt="__ng_removed",Ni=class{namespaceId;value;options;get params(){return this.options.params}constructor(e,t=""){this.namespaceId=t;let n=e&&e.hasOwnProperty("value"),o=n?e.value:e;if(this.value=n0(o),n){let r=e,{value:a}=r,c=As(r,["value"]);this.options=c}else this.options={};this.options.params||(this.options.params={})}absorbOptions(e){let t=e.params;if(t){let n=this.options.params;Object.keys(t).forEach(o=>{n[o]==null&&(n[o]=t[o])})}}},Ii="void",Ja=new Ni(Ii),cs=class{id;hostElement;_engine;players=[];_triggers=new Map;_queue=[];_elementListeners=new Map;_hostClassName;constructor(e,t,n){this.id=e,this.hostElement=t,this._engine=n,this._hostClassName="ng-tns-"+e,ht(t,this._hostClassName)}listen(e,t,n,o){if(!this._triggers.has(t))throw Jd(n,t);if(n==null||n.length==0)throw ep(t);if(!i0(n))throw tp(n,t);let r=et(this._elementListeners,e,[]),a={name:t,phase:n,callback:o};r.push(a);let c=et(this._engine.statesByElement,e,new Map);return c.has(t)||(ht(e,Oi),ht(e,Oi+"-"+t),c.set(t,Ja)),()=>{this._engine.afterFlush(()=>{let m=r.indexOf(a);m>=0&&r.splice(m,1),this._triggers.has(t)||c.delete(t)})}}register(e,t){return this._triggers.has(e)?!1:(this._triggers.set(e,t),!0)}_getTrigger(e){let t=this._triggers.get(e);if(!t)throw np(e);return t}trigger(e,t,n,o=!0){let r=this._getTrigger(t),a=new Ri(this.id,t,e),c=this._engine.statesByElement.get(e);c||(ht(e,Oi),ht(e,Oi+"-"+t),this._engine.statesByElement.set(e,c=new Map));let m=c.get(t),g=new Ni(n,this.id);if(!(n&&n.hasOwnProperty("value"))&&m&&g.absorbOptions(m.options),c.set(t,g),m||(m=Ja),!(g.value===Ii)&&m.value===g.value){if(!a0(m.params,g.params)){let S=[],z=r.matchStyles(m.value,m.params,S),Q=r.matchStyles(g.value,g.params,S);S.length?this._engine.reportError(S):this._engine.afterFlush(()=>{tn(e,z),wt(e,Q)})}return}let w=et(this._engine.playersByElement,e,[]);w.forEach(S=>{S.namespaceId==this.id&&S.triggerName==t&&S.queued&&S.destroy()});let T=r.matchTransition(m.value,g.value,e,g.params),x=!1;if(!T){if(!o)return;T=r.fallbackTransition,x=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:T,fromState:m,toState:g,player:a,isFallbackTransition:x}),x||(ht(e,hp),a.onStart(()=>{ai(e,hp)})),a.onDone(()=>{let S=this.players.indexOf(a);S>=0&&this.players.splice(S,1);let z=this._engine.playersByElement.get(e);if(z){let Q=z.indexOf(a);Q>=0&&z.splice(Q,1)}}),this.players.push(a),w.push(a),a}deregister(e){this._triggers.delete(e),this._engine.statesByElement.forEach(t=>t.delete(e)),this._elementListeners.forEach((t,n)=>{this._elementListeners.set(n,t.filter(o=>o.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);let t=this._engine.playersByElement.get(e);t&&(t.forEach(n=>n.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,t){let n=this._engine.driver.query(e,ki,!0);n.forEach(o=>{if(o[xt])return;let r=this._engine.fetchNamespacesByElement(o);r.size?r.forEach(a=>a.triggerLeaveAnimation(o,t,!1,!0)):this.clearElementCache(o)}),this._engine.afterFlushAnimationsDone(()=>n.forEach(o=>this.clearElementCache(o)))}triggerLeaveAnimation(e,t,n,o){let r=this._engine.statesByElement.get(e),a=new Map;if(r){let c=[];if(r.forEach((m,g)=>{if(a.set(g,m.value),this._triggers.has(g)){let h=this.trigger(e,g,Ii,o);h&&c.push(h)}}),c.length)return this._engine.markElementAsRemoved(this.id,e,!0,t,a),n&&Bt(c).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){let t=this._elementListeners.get(e),n=this._engine.statesByElement.get(e);if(t&&n){let o=new Set;t.forEach(r=>{let a=r.name;if(o.has(a))return;o.add(a);let m=this._triggers.get(a).fallbackTransition,g=n.get(a)||Ja,h=new Ni(Ii),v=new Ri(this.id,a,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:a,transition:m,fromState:g,toState:h,player:v,isFallbackTransition:!0})})}}removeNode(e,t){let n=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),this.triggerLeaveAnimation(e,t,!0))return;let o=!1;if(n.totalAnimations){let r=n.players.length?n.playersByQueriedElement.get(e):[];if(r&&r.length)o=!0;else{let a=e;for(;a=a.parentNode;)if(n.statesByElement.get(a)){o=!0;break}}}if(this.prepareLeaveAnimationListeners(e),o)n.markElementAsRemoved(this.id,e,!1,t);else{let r=e[xt];(!r||r===xp)&&(n.afterFlush(()=>this.clearElementCache(e)),n.destroyInnerAnimations(e),n._onRemovalComplete(e,t))}}insertNode(e,t){ht(e,this._hostClassName)}drainQueuedTransitions(e){let t=[];return this._queue.forEach(n=>{let o=n.player;if(o.destroyed)return;let r=n.element,a=this._elementListeners.get(r);a&&a.forEach(c=>{if(c.name==n.triggerName){let m=ur(r,n.triggerName,n.fromState.value,n.toState.value);m._data=e,gr(n.player,c.phase,m,c.callback)}}),o.markedForDestroy?this._engine.afterFlush(()=>{o.destroy()}):t.push(n)}),this._queue=[],t.sort((n,o)=>{let r=n.transition.ast.depCount,a=o.transition.ast.depCount;return r==0||a==0?r-a:this._engine.driver.containsElement(n.element,o.element)?1:-1})}destroy(e){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}},ds=class{bodyNode;driver;_normalizer;players=[];newHostElements=new Map;playersByElement=new Map;playersByQueriedElement=new Map;statesByElement=new Map;disabledNodes=new Set;totalAnimations=0;totalQueuedPlayers=0;_namespaceLookup={};_namespaceList=[];_flushFns=[];_whenQuietFns=[];namespacesByHostElement=new Map;collectedEnterElements=[];collectedLeaveElements=[];onRemovalComplete=(e,t)=>{};_onRemovalComplete(e,t){this.onRemovalComplete(e,t)}constructor(e,t,n){this.bodyNode=e,this.driver=t,this._normalizer=n}get queuedPlayers(){let e=[];return this._namespaceList.forEach(t=>{t.players.forEach(n=>{n.queued&&e.push(n)})}),e}createNamespace(e,t){let n=new cs(e,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(n,t):(this.newHostElements.set(t,n),this.collectEnterElement(t)),this._namespaceLookup[e]=n}_balanceNamespaceList(e,t){let n=this._namespaceList,o=this.namespacesByHostElement;if(n.length-1>=0){let a=!1,c=this.driver.getParentElement(t);for(;c;){let m=o.get(c);if(m){let g=n.indexOf(m);n.splice(g+1,0,e),a=!0;break}c=this.driver.getParentElement(c)}a||n.unshift(e)}else n.push(e);return o.set(t,e),e}register(e,t){let n=this._namespaceLookup[e];return n||(n=this.createNamespace(e,t)),n}registerTrigger(e,t,n){let o=this._namespaceLookup[e];o&&o.register(t,n)&&this.totalAnimations++}destroy(e,t){e&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{let n=this._fetchNamespace(e);this.namespacesByHostElement.delete(n.hostElement);let o=this._namespaceList.indexOf(n);o>=0&&this._namespaceList.splice(o,1),n.destroy(t),delete this._namespaceLookup[e]}))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){let t=new Set,n=this.statesByElement.get(e);if(n){for(let o of n.values())if(o.namespaceId){let r=this._fetchNamespace(o.namespaceId);r&&t.add(r)}}return t}trigger(e,t,n,o){if(Er(t)){let r=this._fetchNamespace(e);if(r)return r.trigger(t,n,o),!0}return!1}insertNode(e,t,n,o){if(!Er(t))return;let r=t[xt];if(r&&r.setForRemoval){r.setForRemoval=!1,r.setForMove=!0;let a=this.collectedLeaveElements.indexOf(t);a>=0&&this.collectedLeaveElements.splice(a,1)}if(e){let a=this._fetchNamespace(e);a&&a.insertNode(t,n)}o&&this.collectEnterElement(t)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),ht(e,Xa)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),ai(e,Xa))}removeNode(e,t,n){if(Er(t)){let o=e?this._fetchNamespace(e):null;o?o.removeNode(t,n):this.markElementAsRemoved(e,t,!1,n);let r=this.namespacesByHostElement.get(t);r&&r.id!==e&&r.removeNode(t,n)}else this._onRemovalComplete(t,n)}markElementAsRemoved(e,t,n,o,r){this.collectedLeaveElements.push(t),t[xt]={namespaceId:e,setForRemoval:o,hasAnimation:n,removedBeforeQueried:!1,previousTriggersValues:r}}listen(e,t,n,o,r){return Er(t)?this._fetchNamespace(e).listen(t,n,o,r):()=>{}}_buildInstruction(e,t,n,o,r){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,n,o,e.fromState.options,e.toState.options,t,r)}destroyInnerAnimations(e){let t=this.driver.query(e,ki,!0);t.forEach(n=>this.destroyActiveAnimationsForElement(n)),this.playersByQueriedElement.size!=0&&(t=this.driver.query(e,vr,!0),t.forEach(n=>this.finishActiveQueriedAnimationOnElement(n)))}destroyActiveAnimationsForElement(e){let t=this.playersByElement.get(e);t&&t.forEach(n=>{n.queued?n.markedForDestroy=!0:n.destroy()})}finishActiveQueriedAnimationOnElement(e){let t=this.playersByQueriedElement.get(e);t&&t.forEach(n=>n.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return Bt(this.players).onDone(()=>e());e()})}processLeaveNode(e){let t=e[xt];if(t&&t.setForRemoval){if(e[xt]=xp,t.namespaceId){this.destroyInnerAnimations(e);let n=this._fetchNamespace(t.namespaceId);n&&n.clearElementCache(e)}this._onRemovalComplete(e,t.setForRemoval)}e.classList?.contains(Xa)&&this.markElementAsDisabled(e,!1),this.driver.query(e,Zf,!0).forEach(n=>{this.markElementAsDisabled(n,!1)})}flush(e=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((n,o)=>this._balanceNamespaceList(n,o)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let n=0;n<this.collectedEnterElements.length;n++){let o=this.collectedEnterElements[n];ht(o,Yf)}if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){let n=[];try{t=this._flushAnimations(n,e)}finally{for(let o=0;o<n.length;o++)n[o]()}}else for(let n=0;n<this.collectedLeaveElements.length;n++){let o=this.collectedLeaveElements[n];this.processLeaveNode(o)}if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(n=>n()),this._flushFns=[],this._whenQuietFns.length){let n=this._whenQuietFns;this._whenQuietFns=[],t.length?Bt(t).onDone(()=>{n.forEach(o=>o())}):n.forEach(o=>o())}}reportError(e){throw ip(e)}_flushAnimations(e,t){let n=new Ai,o=[],r=new Map,a=[],c=new Map,m=new Map,g=new Map,h=new Set;this.disabledNodes.forEach(A=>{h.add(A);let B=this.driver.query(A,Qf,!0);for(let j=0;j<B.length;j++)h.add(B[j])});let v=this.bodyNode,w=Array.from(this.statesByElement.keys()),T=_p(w,this.collectedEnterElements),x=new Map,S=0;T.forEach((A,B)=>{let j=Ka+S++;x.set(B,j),A.forEach(ee=>ht(ee,j))});let z=[],Q=new Set,ne=new Set;for(let A=0;A<this.collectedLeaveElements.length;A++){let B=this.collectedLeaveElements[A],j=B[xt];j&&j.setForRemoval&&(z.push(B),Q.add(B),j.hasAnimation?this.driver.query(B,Xf,!0).forEach(ee=>Q.add(ee)):ne.add(B))}let re=new Map,H=_p(w,Array.from(Q));H.forEach((A,B)=>{let j=fr+S++;re.set(B,j),A.forEach(ee=>ht(ee,j))}),e.push(()=>{T.forEach((A,B)=>{let j=x.get(B);A.forEach(ee=>ai(ee,j))}),H.forEach((A,B)=>{let j=re.get(B);A.forEach(ee=>ai(ee,j))}),z.forEach(A=>{this.processLeaveNode(A)})});let oe=[],J=[];for(let A=this._namespaceList.length-1;A>=0;A--)this._namespaceList[A].drainQueuedTransitions(t).forEach(j=>{let ee=j.player,Oe=j.element;if(oe.push(ee),this.collectedEnterElements.length){let ze=Oe[xt];if(ze&&ze.setForMove){if(ze.previousTriggersValues&&ze.previousTriggersValues.has(j.triggerName)){let on=ze.previousTriggersValues.get(j.triggerName),at=this.statesByElement.get(j.element);if(at&&at.has(j.triggerName)){let zi=at.get(j.triggerName);zi.value=on,at.set(j.triggerName,zi)}}ee.destroy();return}}let St=!v||!this.driver.containsElement(v,Oe),nt=re.get(Oe),Vt=x.get(Oe),be=this._buildInstruction(j,n,Vt,nt,St);if(be.errors&&be.errors.length){J.push(be);return}if(St){ee.onStart(()=>tn(Oe,be.fromStyles)),ee.onDestroy(()=>wt(Oe,be.toStyles)),o.push(ee);return}if(j.isFallbackTransition){ee.onStart(()=>tn(Oe,be.fromStyles)),ee.onDestroy(()=>wt(Oe,be.toStyles)),o.push(ee);return}let Is=[];be.timelines.forEach(ze=>{ze.stretchStartingKeyframe=!0,this.disabledNodes.has(ze.element)||Is.push(ze)}),be.timelines=Is,n.append(Oe,be.timelines);let km={instruction:be,player:ee,element:Oe};a.push(km),be.queriedElements.forEach(ze=>et(c,ze,[]).push(ee)),be.preStyleProps.forEach((ze,on)=>{if(ze.size){let at=m.get(on);at||m.set(on,at=new Set),ze.forEach((zi,ea)=>at.add(ea))}}),be.postStyleProps.forEach((ze,on)=>{let at=g.get(on);at||g.set(on,at=new Set),ze.forEach((zi,ea)=>at.add(ea))})});if(J.length){let A=[];J.forEach(B=>{A.push(op(B.triggerName,B.errors))}),oe.forEach(B=>B.destroy()),this.reportError(A)}let ve=new Map,ue=new Map;a.forEach(A=>{let B=A.element;n.has(B)&&(ue.set(B,B),this._beforeAnimationBuild(A.player.namespaceId,A.instruction,ve))}),o.forEach(A=>{let B=A.element;this._getPreviousPlayers(B,!1,A.namespaceId,A.triggerName,null).forEach(ee=>{et(ve,B,[]).push(ee),ee.destroy()})});let ft=z.filter(A=>bp(A,m,g)),yn=new Map;vp(yn,this.driver,ne,g,bt).forEach(A=>{bp(A,m,g)&&ft.push(A)});let nn=new Map;T.forEach((A,B)=>{vp(nn,this.driver,new Set(A),m,bi)}),ft.forEach(A=>{let B=yn.get(A),j=nn.get(A);yn.set(A,new Map([...B?.entries()??[],...j?.entries()??[]]))});let Jr=[],ks=[],Ds={};a.forEach(A=>{let{element:B,player:j,instruction:ee}=A;if(n.has(B)){if(h.has(B)){j.onDestroy(()=>wt(B,ee.toStyles)),j.disabled=!0,j.overrideTotalTime(ee.totalTime),o.push(j);return}let Oe=Ds;if(ue.size>1){let nt=B,Vt=[];for(;nt=nt.parentNode;){let be=ue.get(nt);if(be){Oe=be;break}Vt.push(nt)}Vt.forEach(be=>ue.set(be,Oe))}let St=this._buildAnimation(j.namespaceId,ee,ve,r,nn,yn);if(j.setRealPlayer(St),Oe===Ds)Jr.push(j);else{let nt=this.playersByElement.get(Oe);nt&&nt.length&&(j.parentPlayer=Bt(nt)),o.push(j)}}else tn(B,ee.fromStyles),j.onDestroy(()=>wt(B,ee.toStyles)),ks.push(j),h.has(B)&&o.push(j)}),ks.forEach(A=>{let B=r.get(A.element);if(B&&B.length){let j=Bt(B);A.setRealPlayer(j)}}),o.forEach(A=>{A.parentPlayer?A.syncPlayerEvents(A.parentPlayer):A.destroy()});for(let A=0;A<z.length;A++){let B=z[A],j=B[xt];if(ai(B,fr),j&&j.hasAnimation)continue;let ee=[];if(c.size){let St=c.get(B);St&&St.length&&ee.push(...St);let nt=this.driver.query(B,vr,!0);for(let Vt=0;Vt<nt.length;Vt++){let be=c.get(nt[Vt]);be&&be.length&&ee.push(...be)}}let Oe=ee.filter(St=>!St.destroyed);Oe.length?o0(this,B,Oe):this.processLeaveNode(B)}return z.length=0,Jr.forEach(A=>{this.players.push(A),A.onDone(()=>{A.destroy();let B=this.players.indexOf(A);this.players.splice(B,1)}),A.play()}),Jr}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,t,n,o,r){let a=[];if(t){let c=this.playersByQueriedElement.get(e);c&&(a=c)}else{let c=this.playersByElement.get(e);if(c){let m=!r||r==Ii;c.forEach(g=>{g.queued||!m&&g.triggerName!=o||a.push(g)})}}return(n||o)&&(a=a.filter(c=>!(n&&n!=c.namespaceId||o&&o!=c.triggerName))),a}_beforeAnimationBuild(e,t,n){let o=t.triggerName,r=t.element,a=t.isRemovalTransition?void 0:e,c=t.isRemovalTransition?void 0:o;for(let m of t.timelines){let g=m.element,h=g!==r,v=et(n,g,[]);this._getPreviousPlayers(g,h,a,c,t.toState).forEach(T=>{let x=T.getRealPlayer();x.beforeDestroy&&x.beforeDestroy(),T.destroy(),v.push(T)})}tn(r,t.fromStyles)}_buildAnimation(e,t,n,o,r,a){let c=t.triggerName,m=t.element,g=[],h=new Set,v=new Set,w=t.timelines.map(x=>{let S=x.element;h.add(S);let z=S[xt];if(z&&z.removedBeforeQueried)return new mn(x.duration,x.delay);let Q=S!==m,ne=r0((n.get(S)||Jf).map(ve=>ve.getRealPlayer())).filter(ve=>{let ue=ve;return ue.element?ue.element===S:!1}),re=r.get(S),H=a.get(S),oe=ja(this._normalizer,x.keyframes,re,H),J=this._buildPlayer(x,oe,ne);if(x.subTimeline&&o&&v.add(S),Q){let ve=new Ri(e,c,S);ve.setRealPlayer(J),g.push(ve)}return J});g.forEach(x=>{et(this.playersByQueriedElement,x.element,[]).push(x),x.onDone(()=>t0(this.playersByQueriedElement,x.element,x))}),h.forEach(x=>ht(x,qa));let T=Bt(w);return T.onDestroy(()=>{h.forEach(x=>ai(x,qa)),wt(m,t.toStyles)}),v.forEach(x=>{et(o,x,[]).push(T)}),T}_buildPlayer(e,t,n){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,n):new mn(e.duration,e.delay)}},Ri=class{namespaceId;triggerName;element;_player=new mn;_containsRealPlayer=!1;_queuedCallbacks=new Map;destroyed=!1;parentPlayer=null;markedForDestroy=!1;disabled=!1;queued=!0;totalTime=0;constructor(e,t,n){this.namespaceId=e,this.triggerName=t,this.element=n}setRealPlayer(e){this._containsRealPlayer||(this._player=e,this._queuedCallbacks.forEach((t,n)=>{t.forEach(o=>gr(e,n,void 0,o))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){let t=this._player;t.triggerCallback&&e.onStart(()=>t.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,t){et(this._queuedCallbacks,e,[]).push(t)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return this.queued?!1:this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){let t=this._player;t.triggerCallback&&t.triggerCallback(e)}};function t0(i,e,t){let n=i.get(e);if(n){if(n.length){let o=n.indexOf(t);n.splice(o,1)}n.length==0&&i.delete(e)}return n}function n0(i){return i??null}function Er(i){return i&&i.nodeType===1}function i0(i){return i=="start"||i=="done"}function fp(i,e){let t=i.style.display;return i.style.display=e??"none",t}function vp(i,e,t,n,o){let r=[];t.forEach(m=>r.push(fp(m)));let a=[];n.forEach((m,g)=>{let h=new Map;m.forEach(v=>{let w=e.computeStyle(g,v,o);h.set(v,w),(!w||w.length==0)&&(g[xt]=e0,a.push(g))}),i.set(g,h)});let c=0;return t.forEach(m=>fp(m,r[c++])),a}function _p(i,e){let t=new Map;if(i.forEach(c=>t.set(c,[])),e.length==0)return t;let n=1,o=new Set(e),r=new Map;function a(c){if(!c)return n;let m=r.get(c);if(m)return m;let g=c.parentNode;return t.has(g)?m=g:o.has(g)?m=n:m=a(g),r.set(c,m),m}return e.forEach(c=>{let m=a(c);m!==n&&t.get(m).push(c)}),t}function ht(i,e){i.classList?.add(e)}function ai(i,e){i.classList?.remove(e)}function o0(i,e,t){Bt(t).onDone(()=>i.processLeaveNode(e))}function r0(i){let e=[];return Sp(i,e),e}function Sp(i,e){for(let t=0;t<i.length;t++){let n=i[t];n instanceof so?Sp(n.players,e):e.push(n)}}function a0(i,e){let t=Object.keys(i),n=Object.keys(e);if(t.length!=n.length)return!1;for(let o=0;o<t.length;o++){let r=t[o];if(!e.hasOwnProperty(r)||i[r]!==e[r])return!1}return!0}function bp(i,e,t){let n=t.get(i);if(!n)return!1;let o=e.get(i);return o?n.forEach(r=>o.add(r)):e.set(i,n),t.delete(i),!0}var si=class{_driver;_normalizer;_transitionEngine;_timelineEngine;_triggerCache={};onRemovalComplete=(e,t)=>{};constructor(e,t,n){this._driver=t,this._normalizer=n,this._transitionEngine=new ds(e.body,t,n),this._timelineEngine=new ls(e.body,t,n),this._transitionEngine.onRemovalComplete=(o,r)=>this.onRemovalComplete(o,r)}registerTrigger(e,t,n,o,r){let a=e+"-"+o,c=this._triggerCache[a];if(!c){let m=[],g=[],h=yp(this._driver,r,m,g);if(m.length)throw qd(o,m);c=Wf(o,h,this._normalizer),this._triggerCache[a]=c}this._transitionEngine.registerTrigger(t,o,c)}register(e,t){this._transitionEngine.register(e,t)}destroy(e,t){this._transitionEngine.destroy(e,t)}onInsert(e,t,n,o){this._transitionEngine.insertNode(e,t,n,o)}onRemove(e,t,n){this._transitionEngine.removeNode(e,t,n)}disableAnimations(e,t){this._transitionEngine.markElementAsDisabled(e,t)}process(e,t,n,o){if(n.charAt(0)=="@"){let[r,a]=Ua(n),c=o;this._timelineEngine.command(r,t,a,c)}else this._transitionEngine.trigger(e,t,n,o)}listen(e,t,n,o,r){if(n.charAt(0)=="@"){let[a,c]=Ua(n);return this._timelineEngine.listen(a,t,c,r)}return this._transitionEngine.listen(e,t,n,o,r)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(e){this._transitionEngine.afterFlushAnimationsDone(e)}};function s0(i,e){let t=null,n=null;return Array.isArray(e)&&e.length?(t=es(e[0]),e.length>1&&(n=es(e[e.length-1]))):e instanceof Map&&(t=es(e)),t||n?new l0(i,t,n):null}var l0=(()=>{class i{_element;_startStyles;_endStyles;static initialStylesByElement=new WeakMap;_state=0;_initialStyles;constructor(t,n,o){this._element=t,this._startStyles=n,this._endStyles=o;let r=i.initialStylesByElement.get(t);r||i.initialStylesByElement.set(t,r=new Map),this._initialStyles=r}start(){this._state<1&&(this._startStyles&&wt(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(wt(this._element,this._initialStyles),this._endStyles&&(wt(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(i.initialStylesByElement.delete(this._element),this._startStyles&&(tn(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(tn(this._element,this._endStyles),this._endStyles=null),wt(this._element,this._initialStyles),this._state=3)}}return i})();function es(i){let e=null;return i.forEach((t,n)=>{c0(n)&&(e=e||new Map,e.set(n,t))}),e}function c0(i){return i==="display"||i==="position"}var Or=class{element;keyframes;options;_specialStyles;_onDoneFns=[];_onStartFns=[];_onDestroyFns=[];_duration;_delay;_initialized=!1;_finished=!1;_started=!1;_destroyed=!1;_finalKeyframe;_originalOnDoneFns=[];_originalOnStartFns=[];domPlayer;time=0;parentPlayer=null;currentSnapshot=new Map;constructor(e,t,n,o){this.element=e,this.keyframes=t,this.options=n,this._specialStyles=o,this._duration=n.duration,this._delay=n.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;let e=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,e,this.options),this._finalKeyframe=e.length?e[e.length-1]:new Map;let t=()=>this._onFinish();this.domPlayer.addEventListener("finish",t),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",t)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(e){let t=[];return e.forEach(n=>{t.push(Object.fromEntries(n))}),t}_triggerWebAnimation(e,t,n){return e.animate(this._convertKeyframesToObject(t),n)}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(e=>e()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){this.domPlayer===void 0&&this.init(),this.domPlayer.currentTime=e*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){let e=new Map;this.hasStarted()&&this._finalKeyframe.forEach((n,o)=>{o!=="offset"&&e.set(o,this._finished?n:br(this.element,o))}),this.currentSnapshot=e}triggerCallback(e){let t=e==="start"?this._onStartFns:this._onDoneFns;t.forEach(n=>n()),t.length=0}},kr=class{validateStyleProperty(e){return!0}validateAnimatableStyleProperty(e){return!0}containsElement(e,t){return Ha(e,t)}getParentElement(e){return hr(e)}query(e,t,n){return Ga(e,t,n)}computeStyle(e,t,n){return br(e,t)}animate(e,t,n,o,r,a=[]){let c=o==0?"both":"forwards",m={duration:n,delay:o,fill:c};r&&(m.easing=r);let g=new Map,h=a.filter(T=>T instanceof Or);lp(n,o)&&h.forEach(T=>{T.currentSnapshot.forEach((x,S)=>g.set(S,x))});let v=ap(t).map(T=>new Map(T));v=cp(e,v,g);let w=s0(e,v);return new Or(e,v,m,w)}};var wr="@",Mp="@.disabled",Dr=class{namespaceId;delegate;engine;_onDestroy;\u0275type=0;constructor(e,t,n,o){this.namespaceId=e,this.delegate=t,this.engine=n,this._onDestroy=o}get data(){return this.delegate.data}destroyNode(e){this.delegate.destroyNode?.(e)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}insertBefore(e,t,n,o=!0){this.delegate.insertBefore(e,t,n),this.engine.onInsert(this.namespaceId,t,e,o)}removeChild(e,t,n){this.parentNode(t)&&this.engine.onRemove(this.namespaceId,t,this.delegate)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,n,o){this.delegate.setAttribute(e,t,n,o)}removeAttribute(e,t,n){this.delegate.removeAttribute(e,t,n)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,n,o){this.delegate.setStyle(e,t,n,o)}removeStyle(e,t,n){this.delegate.removeStyle(e,t,n)}setProperty(e,t,n){t.charAt(0)==wr&&t==Mp?this.disableAnimations(e,!!n):this.delegate.setProperty(e,t,n)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,n,o){return this.delegate.listen(e,t,n,o)}disableAnimations(e,t){this.engine.disableAnimations(e,t)}},ps=class extends Dr{factory;constructor(e,t,n,o,r){super(t,n,o,r),this.factory=e,this.namespaceId=t}setProperty(e,t,n){t.charAt(0)==wr?t.charAt(1)=="."&&t==Mp?(n=n===void 0?!0:!!n,this.disableAnimations(e,n)):this.engine.process(this.namespaceId,e,t.slice(1),n):this.delegate.setProperty(e,t,n)}listen(e,t,n,o){if(t.charAt(0)==wr){let r=d0(e),a=t.slice(1),c="";return a.charAt(0)!=wr&&([a,c]=p0(a)),this.engine.listen(this.namespaceId,r,a,c,m=>{let g=m._data||-1;this.factory.scheduleListenerCallback(g,n,m)})}return this.delegate.listen(e,t,n,o)}};function d0(i){switch(i){case"body":return document.body;case"document":return document;case"window":return window;default:return i}}function p0(i){let e=i.indexOf("."),t=i.substring(0,e),n=i.slice(e+1);return[t,n]}var Ir=class{delegate;engine;_zone;_currentId=0;_microtaskId=1;_animationCallbacksBuffer=[];_rendererCache=new Map;_cdRecurDepth=0;constructor(e,t,n){this.delegate=e,this.engine=t,this._zone=n,t.onRemovalComplete=(o,r)=>{r?.removeChild(null,o)}}createRenderer(e,t){let n="",o=this.delegate.createRenderer(e,t);if(!e||!t?.data?.animation){let g=this._rendererCache,h=g.get(o);if(!h){let v=()=>g.delete(o);h=new Dr(n,o,this.engine,v),g.set(o,h)}return h}let r=t.id,a=t.id+"-"+this._currentId;this._currentId++,this.engine.register(a,e);let c=g=>{Array.isArray(g)?g.forEach(c):this.engine.registerTrigger(r,a,e,g.name,g)};return t.data.animation.forEach(c),new ps(this,a,o,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(e,t,n){if(e>=0&&e<this._microtaskId){this._zone.run(()=>t(n));return}let o=this._animationCallbacksBuffer;o.length==0&&queueMicrotask(()=>{this._zone.run(()=>{o.forEach(r=>{let[a,c]=r;a(c)}),this._animationCallbacksBuffer=[]})}),o.push([t,n])}end(){this._cdRecurDepth--,this._cdRecurDepth==0&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}componentReplaced(e){this.engine.flush(),this.delegate.componentReplaced?.(e)}};var g0=(()=>{class i extends si{constructor(t,n,o){super(t,n,o)}ngOnDestroy(){this.flush()}static \u0275fac=function(n){return new(n||i)(P(hi),P(fn),P(vn))};static \u0275prov=k({token:i,factory:i.\u0275fac})}return i})();function u0(){return new xr}function h0(i,e,t){return new Ir(i,e,t)}var Tp=[{provide:vn,useFactory:u0},{provide:si,useClass:g0},{provide:mi,useFactory:h0,deps:[fl,si,Qe]}],k1=[{provide:fn,useClass:ms},{provide:aa,useValue:"NoopAnimations"},...Tp],f0=[{provide:fn,useFactory:()=>new kr},{provide:aa,useFactory:()=>"BrowserAnimations"},...Tp];function Pp(){return Js("NgEagerAnimations"),[...f0]}var Fi="PERFORM_ACTION",_0="REFRESH",Np="RESET",Rp="ROLLBACK",Lp="COMMIT",Fp="SWEEP",zp="TOGGLE_ACTION",b0="SET_ACTIONS_ACTIVE",Bp="JUMP_TO_STATE",Vp="JUMP_TO_ACTION",Ms="IMPORT_STATE",$p="LOCK_CHANGES",jp="PAUSE_RECORDING",li=class{constructor(e,t){if(this.action=e,this.timestamp=t,this.type=Fi,typeof e.type>"u")throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?')}},us=class{constructor(){this.type=_0}},hs=class{constructor(e){this.timestamp=e,this.type=Np}},fs=class{constructor(e){this.timestamp=e,this.type=Rp}},vs=class{constructor(e){this.timestamp=e,this.type=Lp}},_s=class{constructor(){this.type=Fp}},bs=class{constructor(e){this.id=e,this.type=zp}};var Cs=class{constructor(e){this.index=e,this.type=Bp}},ys=class{constructor(e){this.actionId=e,this.type=Vp}},Es=class{constructor(e){this.nextLiftedState=e,this.type=Ms}},ws=class{constructor(e){this.status=e,this.type=$p}},xs=class{constructor(e){this.status=e,this.type=jp}};var Lr=new De("@ngrx/store-devtools Options"),Op=new De("@ngrx/store-devtools Initial Config");function Up(){return null}var C0="NgRx Store DevTools";function y0(i){let e={maxAge:!1,monitor:Up,actionSanitizer:void 0,stateSanitizer:void 0,name:C0,serialize:!1,logOnly:!1,autoPause:!1,trace:!1,traceLimit:75,features:{pause:!0,lock:!0,persist:!0,export:!0,import:"custom",jump:!0,skip:!0,reorder:!0,dispatch:!0,test:!0},connectInZone:!1},t=typeof i=="function"?i():i,n=t.logOnly?{pause:!0,export:!0,test:!0}:!1,o=t.features||n||e.features;o.import===!0&&(o.import="custom");let r=Object.assign({},e,{features:o},t);if(r.maxAge&&r.maxAge<2)throw new Error(`Devtools 'maxAge' cannot be less than 2, got ${r.maxAge}`);return r}function kp(i,e){return i.filter(t=>e.indexOf(t)<0)}function Hp(i){let{computedStates:e,currentStateIndex:t}=i;if(t>=e.length){let{state:o}=e[e.length-1];return o}let{state:n}=e[t];return n}function Li(i){return new li(i,+Date.now())}function E0(i,e){return Object.keys(e).reduce((t,n)=>{let o=Number(n);return t[o]=Gp(i,e[o],o),t},{})}function Gp(i,e,t){return W(O({},e),{action:i(e.action,t)})}function w0(i,e){return e.map((t,n)=>({state:Wp(i,t.state,n),error:t.error}))}function Wp(i,e,t){return i(e,t)}function Kp(i){return i.predicate||i.actionsSafelist||i.actionsBlocklist}function x0(i,e,t,n){let o=[],r={},a=[];return i.stagedActionIds.forEach((c,m)=>{let g=i.actionsById[c];g&&(m&&Ts(i.computedStates[m],g,e,t,n)||(r[c]=g,o.push(c),a.push(i.computedStates[m])))}),W(O({},i),{stagedActionIds:o,actionsById:r,computedStates:a})}function Ts(i,e,t,n,o){let r=t&&!t(i,e.action),a=n&&!e.action.type.match(n.map(m=>Dp(m)).join("|")),c=o&&e.action.type.match(o.map(m=>Dp(m)).join("|"));return r||a||c}function Dp(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function qp(i){return{ngZone:i?M(Qe):null,connectInZone:i}}var Fr=(()=>{class i extends wo{static{this.\u0275fac=(()=>{let t;return function(o){return(t||(t=oa(i)))(o||i)}})()}static{this.\u0275prov=k({token:i,factory:i.\u0275fac})}}return i})(),Ar={START:"START",DISPATCH:"DISPATCH",STOP:"STOP",ACTION:"ACTION"},Ss=new De("@ngrx/store-devtools Redux Devtools Extension"),Qp=(()=>{class i{constructor(t,n,o){this.config=n,this.dispatcher=o,this.zoneConfig=qp(this.config.connectInZone),this.devtoolsExtension=t,this.createActionStreams()}notify(t,n){if(this.devtoolsExtension)if(t.type===Fi){if(n.isLocked||n.isPaused)return;let o=Hp(n);if(Kp(this.config)&&Ts(o,t,this.config.predicate,this.config.actionsSafelist,this.config.actionsBlocklist))return;let r=this.config.stateSanitizer?Wp(this.config.stateSanitizer,o,n.currentStateIndex):o,a=this.config.actionSanitizer?Gp(this.config.actionSanitizer,t,n.nextActionId):t;this.sendToReduxDevtools(()=>this.extensionConnection.send(a,r))}else{let o=W(O({},n),{stagedActionIds:n.stagedActionIds,actionsById:this.config.actionSanitizer?E0(this.config.actionSanitizer,n.actionsById):n.actionsById,computedStates:this.config.stateSanitizer?w0(this.config.stateSanitizer,n.computedStates):n.computedStates});this.sendToReduxDevtools(()=>this.devtoolsExtension.send(null,o,this.getExtensionConfig(this.config)))}}createChangesObservable(){return this.devtoolsExtension?new Be(t=>{let n=this.zoneConfig.connectInZone?this.zoneConfig.ngZone.runOutsideAngular(()=>this.devtoolsExtension.connect(this.getExtensionConfig(this.config))):this.devtoolsExtension.connect(this.getExtensionConfig(this.config));return this.extensionConnection=n,n.init(),n.subscribe(o=>t.next(o)),n.unsubscribe}):Fs}createActionStreams(){let t=this.createChangesObservable().pipe(Ws()),n=t.pipe(_e(g=>g.type===Ar.START)),o=t.pipe(_e(g=>g.type===Ar.STOP)),r=t.pipe(_e(g=>g.type===Ar.DISPATCH),se(g=>this.unwrapAction(g.payload)),na(g=>g.type===Ms?this.dispatcher.pipe(_e(h=>h.type===ha),Bs(1e3),wn(1e3),se(()=>g),we(()=>fe(g)),xn(1)):fe(g))),c=t.pipe(_e(g=>g.type===Ar.ACTION),se(g=>this.unwrapAction(g.payload))).pipe(R(o)),m=r.pipe(R(o));this.start$=n.pipe(R(o)),this.actions$=this.start$.pipe(ke(()=>c)),this.liftedActions$=this.start$.pipe(ke(()=>m))}unwrapAction(t){return typeof t=="string"?(0,eval)(`(${t})`):t}getExtensionConfig(t){let n={name:t.name,features:t.features,serialize:t.serialize,autoPause:t.autoPause??!1,trace:t.trace??!1,traceLimit:t.traceLimit??75};return t.maxAge!==!1&&(n.maxAge=t.maxAge),n}sendToReduxDevtools(t){try{t()}catch(n){console.warn("@ngrx/store-devtools: something went wrong inside the redux devtools",n)}}static{this.\u0275fac=function(n){return new(n||i)(P(Ss),P(Lr),P(Fr))}}static{this.\u0275prov=k({token:i,factory:i.\u0275fac})}}return i})(),Rr={type:ua},S0="@ngrx/store-devtools/recompute",M0={type:S0};function Zp(i,e,t,n,o){if(n)return{state:t,error:"Interrupted by an error up the chain"};let r=t,a;try{r=i(t,e)}catch(c){a=c.toString(),o.handleError(c)}return{state:r,error:a}}function Nr(i,e,t,n,o,r,a,c,m){if(e>=i.length&&i.length===r.length)return i;let g=i.slice(0,e),h=r.length-(m?1:0);for(let v=e;v<h;v++){let w=r[v],T=o[w].action,x=g[v-1],S=x?x.state:n,z=x?x.error:void 0,ne=a.indexOf(w)>-1?x:Zp(t,T,S,z,c);g.push(ne)}return m&&g.push(i[i.length-1]),g}function T0(i,e){return{monitorState:e(void 0,{}),nextActionId:1,actionsById:{0:Li(Rr)},stagedActionIds:[0],skippedActionIds:[],committedState:i,currentStateIndex:0,computedStates:[],isLocked:!1,isPaused:!1}}function P0(i,e,t,n,o={}){return r=>(a,c)=>{let{monitorState:m,actionsById:g,nextActionId:h,stagedActionIds:v,skippedActionIds:w,committedState:T,currentStateIndex:x,computedStates:S,isLocked:z,isPaused:Q}=a||e;a||(g=Object.create(g));function ne(oe){let J=oe,ve=v.slice(1,J+1);for(let ue=0;ue<ve.length;ue++)if(S[ue+1].error){J=ue,ve=v.slice(1,J+1);break}else delete g[ve[ue]];w=w.filter(ue=>ve.indexOf(ue)===-1),v=[0,...v.slice(J+1)],T=S[J].state,S=S.slice(J),x=x>J?x-J:0}function re(){g={0:Li(Rr)},h=1,v=[0],w=[],T=S[x].state,x=0,S=[]}let H=0;switch(c.type){case $p:{z=c.status,H=1/0;break}case jp:{Q=c.status,Q?(v=[...v,h],g[h]=new li({type:"@ngrx/devtools/pause"},+Date.now()),h++,H=v.length-1,S=S.concat(S[S.length-1]),x===v.length-2&&x++,H=1/0):re();break}case Np:{g={0:Li(Rr)},h=1,v=[0],w=[],T=i,x=0,S=[];break}case Lp:{re();break}case Rp:{g={0:Li(Rr)},h=1,v=[0],w=[],x=0,S=[];break}case zp:{let{id:oe}=c;w.indexOf(oe)===-1?w=[oe,...w]:w=w.filter(ve=>ve!==oe),H=v.indexOf(oe);break}case b0:{let{start:oe,end:J,active:ve}=c,ue=[];for(let ft=oe;ft<J;ft++)ue.push(ft);ve?w=kp(w,ue):w=[...w,...ue],H=v.indexOf(oe);break}case Bp:{x=c.index,H=1/0;break}case Vp:{let oe=v.indexOf(c.actionId);oe!==-1&&(x=oe),H=1/0;break}case Fp:{v=kp(v,w),w=[],x=Math.min(x,v.length-1);break}case Fi:{if(z)return a||e;if(Q||a&&Ts(a.computedStates[x],c,o.predicate,o.actionsSafelist,o.actionsBlocklist)){let J=S[S.length-1];S=[...S.slice(0,-1),Zp(r,c.action,J.state,J.error,t)],H=1/0;break}o.maxAge&&v.length===o.maxAge&&ne(1),x===v.length-1&&x++;let oe=h++;g[oe]=c,v=[...v,oe],H=v.length-1;break}case Ms:{({monitorState:m,actionsById:g,nextActionId:h,stagedActionIds:v,skippedActionIds:w,committedState:T,currentStateIndex:x,computedStates:S,isLocked:z,isPaused:Q}=c.nextLiftedState);break}case ua:{H=0,o.maxAge&&v.length>o.maxAge&&(S=Nr(S,H,r,T,g,v,w,t,Q),ne(v.length-o.maxAge),H=1/0);break}case ha:{if(S.filter(J=>J.error).length>0)H=0,o.maxAge&&v.length>o.maxAge&&(S=Nr(S,H,r,T,g,v,w,t,Q),ne(v.length-o.maxAge),H=1/0);else{if(!Q&&!z){x===v.length-1&&x++;let J=h++;g[J]=new li(c,+Date.now()),v=[...v,J],H=v.length-1,S=Nr(S,H,r,T,g,v,w,t,Q)}S=S.map(J=>W(O({},J),{state:r(J.state,M0)})),x=v.length-1,o.maxAge&&v.length>o.maxAge&&ne(v.length-o.maxAge),H=1/0}break}default:{H=1/0;break}}return S=Nr(S,H,r,T,g,v,w,t,Q),m=n(m,c),{monitorState:m,actionsById:g,nextActionId:h,stagedActionIds:v,skippedActionIds:w,committedState:T,currentStateIndex:x,computedStates:S,isLocked:z,isPaused:Q}}}var Ip=(()=>{class i{constructor(t,n,o,r,a,c,m,g){let h=T0(m,g.monitor),v=P0(m,h,c,g.monitor,g),w=Rt(Rt(n.asObservable().pipe(Ks(1)),r.actions$).pipe(se(Li)),t,r.liftedActions$).pipe(zs(Rs)),T=o.pipe(se(v)),x=qp(g.connectInZone),S=new Ns(1);this.liftedStateSubscription=w.pipe(Qs(T),Ap(x),Gs(({state:ne},[re,H])=>{let oe=H(ne,re);return re.type!==Fi&&Kp(g)&&(oe=x0(oe,g.predicate,g.actionsSafelist,g.actionsBlocklist)),r.notify(re,oe),{state:oe,action:re}},{state:h,action:null})).subscribe(({state:ne,action:re})=>{if(S.next(ne),re.type===Fi){let H=re.action;a.next(H)}}),this.extensionStartSubscription=r.start$.pipe(Ap(x)).subscribe(()=>{this.refresh()});let z=S.asObservable(),Q=z.pipe(se(Hp));Object.defineProperty(Q,"state",{value:Bc(Q,{manualCleanup:!0,requireSync:!0})}),this.dispatcher=t,this.liftedState=z,this.state=Q}ngOnDestroy(){this.liftedStateSubscription.unsubscribe(),this.extensionStartSubscription.unsubscribe()}dispatch(t){this.dispatcher.next(t)}next(t){this.dispatcher.next(t)}error(t){}complete(){}performAction(t){this.dispatch(new li(t,+Date.now()))}refresh(){this.dispatch(new us)}reset(){this.dispatch(new hs(+Date.now()))}rollback(){this.dispatch(new fs(+Date.now()))}commit(){this.dispatch(new vs(+Date.now()))}sweep(){this.dispatch(new _s)}toggleAction(t){this.dispatch(new bs(t))}jumpToAction(t){this.dispatch(new ys(t))}jumpToState(t){this.dispatch(new Cs(t))}importState(t){this.dispatch(new Es(t))}lockChanges(t){this.dispatch(new ws(t))}pauseRecording(t){this.dispatch(new xs(t))}static{this.\u0275fac=function(n){return new(n||i)(P(Fr),P(wo),P(Hc),P(Qp),P(xo),P(ji),P($c),P(Lr))}}static{this.\u0275prov=k({token:i,factory:i.\u0275fac})}}return i})();function Ap({ngZone:i,connectInZone:e}){return t=>e?new Be(n=>t.subscribe({next:o=>i.run(()=>n.next(o)),error:o=>i.run(()=>n.error(o)),complete:()=>i.run(()=>n.complete())})):t}var O0=new De("@ngrx/store-devtools Is Devtools Extension or Monitor Present");function k0(i,e){return!!i||e.monitor!==Up}function D0(){let i="__REDUX_DEVTOOLS_EXTENSION__";return typeof window=="object"&&typeof window[i]<"u"?window[i]:null}function I0(i){return i.state}function Yp(i={}){return $i([Qp,Fr,Ip,{provide:Op,useValue:i},{provide:O0,deps:[Ss,Lr],useFactory:k0},{provide:Ss,useFactory:D0},{provide:Lr,deps:[Op],useFactory:y0},{provide:Wc,deps:[Ip],useFactory:I0},{provide:Gc,useExisting:Fr}])}var A0={dispatch:!0,functional:!1,useEffectsErrorHandler:!0},zr="__@ngrx/effects_create__";function _n(i,e={}){let t=e.functional?i:i(),n=O(O({},A0),e);return Object.defineProperty(t,zr,{value:n}),t}function N0(i){return Object.getOwnPropertyNames(i).filter(n=>i[n]&&i[n].hasOwnProperty(zr)?i[n][zr].hasOwnProperty("dispatch"):!1).map(n=>{let o=i[n][zr];return O({propertyName:n},o)})}function R0(i){return N0(i)}function Xp(i){return Object.getPrototypeOf(i)}function L0(i){return!!i.constructor&&i.constructor.name!=="Object"&&i.constructor.name!=="Function"}function Jp(i){return typeof i=="function"}function F0(i){return i.filter(Jp)}function z0(i,e,t){let n=Xp(i),r=!!n&&n.constructor.name!=="Object"?n.constructor.name:null,a=R0(i).map(({propertyName:c,dispatch:m,useEffectsErrorHandler:g})=>{let h=typeof i[c]=="function"?i[c]():i[c],v=g?t(h,e):h;return m===!1?v.pipe($s()):v.pipe(Hs()).pipe(se(T=>({effect:i[c],notification:T,propertyName:c,sourceName:r,sourceInstance:i})))});return Rt(...a)}var B0=10;function em(i,e,t=B0){return i.pipe(we(n=>(e&&e.handleError(n),t<=1?i:em(i,e,t-1))))}var tm=(()=>{class i extends Be{constructor(t){super(),t&&(this.source=t)}lift(t){let n=new i;return n.source=this,n.operator=t,n}static{this.\u0275fac=function(n){return new(n||i)(P(xo))}}static{this.\u0275prov=k({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function bn(...i){return _e(e=>i.some(t=>typeof t=="string"?t===e.type:t.type===e.type))}var J1=new De("@ngrx/effects Internal Root Guard"),eM=new De("@ngrx/effects User Provided Effects"),tM=new De("@ngrx/effects Internal Root Effects"),nM=new De("@ngrx/effects Internal Root Effects Instances"),iM=new De("@ngrx/effects Internal Feature Effects"),oM=new De("@ngrx/effects Internal Feature Effects Instance Groups"),V0=new De("@ngrx/effects Effects Error Handler",{providedIn:"root",factory:()=>em}),$0="@ngrx/effects/init",j0=Z($0);function U0(i,e){if(i.notification.kind==="N"){let t=i.notification.value;!H0(t)&&e.handleError(new Error(`Effect ${G0(i)} dispatched an invalid action: ${W0(t)}`))}}function H0(i){return typeof i!="function"&&i&&i.type&&typeof i.type=="string"}function G0({propertyName:i,sourceInstance:e,sourceName:t}){let n=typeof e[i]=="function";return!!t?`"${t}.${String(i)}${n?"()":""}"`:`"${String(i)}()"`}function W0(i){try{return JSON.stringify(i)}catch{return i}}var K0="ngrxOnIdentifyEffects";function q0(i){return Ps(i,K0)}var Q0="ngrxOnRunEffects";function Z0(i){return Ps(i,Q0)}var Y0="ngrxOnInitEffects";function X0(i){return Ps(i,Y0)}function Ps(i,e){return i&&e in i&&typeof i[e]=="function"}var nm=(()=>{class i extends N{constructor(t,n){super(),this.errorHandler=t,this.effectsErrorHandler=n}addEffects(t){this.next(t)}toActions(){return this.pipe(ia(t=>L0(t)?Xp(t):t),ta(t=>t.pipe(ia(J0))),ta(t=>{let n=t.pipe(Us(r=>ev(this.errorHandler,this.effectsErrorHandler)(r)),se(r=>(U0(r,this.errorHandler),r.notification)),_e(r=>r.kind==="N"&&r.value!=null),js()),o=t.pipe(xn(1),_e(X0),se(r=>r.ngrxOnInitEffects()));return Rt(n,o)}))}static{this.\u0275fac=function(n){return new(n||i)(P(ji),P(V0))}}static{this.\u0275prov=k({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function J0(i){return q0(i)?i.ngrxOnIdentifyEffects():""}function ev(i,e){return t=>{let n=z0(t,i,e);return Z0(t)?t.ngrxOnRunEffects(n):n}}var tv=(()=>{class i{get isStarted(){return!!this.effectsSubscription}constructor(t,n){this.effectSources=t,this.store=n,this.effectsSubscription=null}start(){this.effectsSubscription||(this.effectsSubscription=this.effectSources.toActions().subscribe(this.store))}ngOnDestroy(){this.effectsSubscription&&(this.effectsSubscription.unsubscribe(),this.effectsSubscription=null)}static{this.\u0275fac=function(n){return new(n||i)(P(nm),P(So))}}static{this.\u0275prov=k({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function im(...i){let e=i.flat(),t=F0(e);return $i([t,Zs(()=>{M(jc),M(Uc,{optional:!0});let n=M(tv),o=M(nm),r=!n.isStarted;r&&n.start();for(let a of e){let c=Jp(a)?M(a):a;o.addEffects(c)}r&&M(So).dispatch(j0())})])}var om={user:null,token:null,refreshToken:null,expiresIn:null,loading:!1,error:null},iv=Mo(om,ge(To,i=>W(O({},i),{loading:!0,error:null})),ge(Ei,(i,{user:e,token:t,refreshToken:n,expiresIn:o})=>W(O({},i),{user:e,token:t,refreshToken:n,expiresIn:o,loading:!1,error:null})),ge(wi,(i,{error:e})=>W(O({},i),{loading:!1,error:e})),ge(Po,i=>W(O({},i),{loading:!0,error:null})),ge(qc,()=>O({},om)),ge(Qc,(i,{error:e})=>W(O({},i),{loading:!1,error:e})),ge(Oo,i=>W(O({},i),{loading:!0,error:null})),ge(xi,(i,{token:e,refreshToken:t,expiresIn:n})=>W(O({},i),{token:e,refreshToken:t,expiresIn:n,loading:!1,error:null})),ge(ko,(i,{error:e})=>W(O({},i),{loading:!1,error:e}))),rm=iv;var am=Z("[Network] Load FDPs"),sm=Z("[Network] Load FDPs Success",me()),lm=Z("[Network] Load FDPs Failure",me()),cm=Z("[Network] Load OLTs"),dm=Z("[Network] Load OLTs Success",me()),pm=Z("[Network] Load OLTs Failure",me()),dM=Z("[Network] Load ONTs"),pM=Z("[Network] Load ONTs Success",me()),mM=Z("[Network] Load ONTs Failure",me()),gM=Z("[Network] Load EDFAs"),uM=Z("[Network] Load EDFAs Success",me()),hM=Z("[Network] Load EDFAs Failure",me()),fM=Z("[Network] Load Splitters"),vM=Z("[Network] Load Splitters Success",me()),_M=Z("[Network] Load Splitters Failure",me()),bM=Z("[Network] Load Mangas"),CM=Z("[Network] Load Mangas Success",me()),yM=Z("[Network] Load Mangas Failure",me()),mm=Z("[Network] Load Fiber Connections"),gm=Z("[Network] Load Fiber Connections Success",me()),um=Z("[Network] Load Fiber Connections Failure",me()),hm=Z("[Network] Select Network Element",me()),fm=Z("[Network] Simulate Failure",me()),vm=Z("[Network] Simulate Failure Success"),_m=Z("[Network] Simulate Failure Failure",me()),bm=Z("[Network] Load Alerts",me()),Cm=Z("[Network] Load Alerts Success",me()),ym=Z("[Network] Load Alerts Failure",me()),EM=Z("[Network] Acknowledge Alert",me()),wM=Z("[Network] Acknowledge Alert Success",me()),xM=Z("[Network] Acknowledge Alert Failure",me()),SM=Z("[Network] Resolve Alert",me()),MM=Z("[Network] Resolve Alert Success",me()),TM=Z("[Network] Resolve Alert Failure",me());var av={fdps:[],olts:[],onts:[],edfas:[],splitters:[],mangas:[],fiberConnections:[],alerts:[],selectedElementType:null,selectedElementId:null,loading:!1,error:null},Em=Mo(av,ge(am,i=>W(O({},i),{loading:!0,error:null})),ge(sm,(i,{fdps:e})=>W(O({},i),{fdps:e,loading:!1,error:null})),ge(lm,(i,{error:e})=>W(O({},i),{loading:!1,error:e})),ge(cm,i=>W(O({},i),{loading:!0,error:null})),ge(dm,(i,{olts:e})=>W(O({},i),{olts:e,loading:!1,error:null})),ge(pm,(i,{error:e})=>W(O({},i),{loading:!1,error:e})),ge(mm,i=>W(O({},i),{loading:!0,error:null})),ge(gm,(i,{fiberConnections:e})=>W(O({},i),{fiberConnections:e,loading:!1,error:null})),ge(um,(i,{error:e})=>W(O({},i),{loading:!1,error:e})),ge(hm,(i,{elementType:e,elementId:t})=>W(O({},i),{selectedElementType:e,selectedElementId:t})),ge(fm,i=>W(O({},i),{loading:!0,error:null})),ge(vm,i=>W(O({},i),{loading:!1,error:null})),ge(_m,(i,{error:e})=>W(O({},i),{loading:!1,error:e})),ge(bm,i=>W(O({},i),{loading:!0,error:null})),ge(Cm,(i,{alerts:e})=>W(O({},i),{alerts:e,loading:!1,error:null})),ge(ym,(i,{error:e})=>W(O({},i),{loading:!1,error:e})));var Br=class i{actions$=M(tm);authService=M(Ze);router=M(Se);TOKEN_KEY="auth_token";REFRESH_TOKEN_KEY="refresh_token";USER_KEY="auth_user";EXPIRES_IN_KEY="expires_in";login$=_n(()=>this.actions$.pipe(bn(To),ke(e=>this.authService.login(e.email,e.password).pipe(se(t=>{if(console.log("Login response in effect:",t),!t||!t.user||!t.token||!t.refreshToken||!t.expiresIn)throw new Error("Respuesta de login inv\xE1lida");return Ei({user:t.user,token:t.token,refreshToken:t.refreshToken,expiresIn:t.expiresIn})}),we(t=>(console.error("Login error:",t),fe(wi({error:t.message||"Error al iniciar sesi\xF3n"})))),pi(()=>{console.log("Login effect completed")})))));loginSuccess$=_n(()=>this.actions$.pipe(bn(Ei),di(100),xe(e=>{try{if(console.log("Login success action:",e),!e.expiresIn)throw new Error("expiresIn es undefined");localStorage.setItem(this.TOKEN_KEY,e.token),localStorage.setItem(this.REFRESH_TOKEN_KEY,e.refreshToken),localStorage.setItem(this.USER_KEY,JSON.stringify(e.user)),localStorage.setItem(this.EXPIRES_IN_KEY,e.expiresIn.toString()),console.log("Navegando al dashboard..."),this.router.navigate(["/dashboard"])}catch(t){console.error("Error storing auth data:",t)}})),{dispatch:!1});loginFailure$=_n(()=>this.actions$.pipe(bn(wi),xe(e=>{console.error("Login failed:",e.error)})),{dispatch:!1});logout$=_n(()=>this.actions$.pipe(bn(Po),xe(()=>{try{this.authService.logout(),this.router.navigate(["/auth/login"])}catch(e){console.error("Error during logout:",e)}})),{dispatch:!1});refreshToken$=_n(()=>this.actions$.pipe(bn(Oo),ke(()=>this.authService.refreshToken().pipe(se(e=>xi({token:e.token,refreshToken:e.refreshToken,expiresIn:e.expiresIn})),we(e=>(console.error("Token refresh error:",e),fe(ko({error:e.message||"Error al actualizar el token"}))))))));refreshTokenSuccess$=_n(()=>this.actions$.pipe(bn(xi),xe(e=>{try{localStorage.setItem(this.TOKEN_KEY,e.token),localStorage.setItem(this.REFRESH_TOKEN_KEY,e.refreshToken),localStorage.setItem(this.EXPIRES_IN_KEY,e.expiresIn.toString())}catch(t){console.error("Error storing refreshed token:",t)}})),{dispatch:!1});static \u0275fac=function(t){return new(t||i)};static \u0275prov=k({token:i,factory:i.\u0275fac})};var wm={auth:rm,network:Em},VM=ye.production?[]:[],xm=[Br];var Cn=!1;function Sm(i,e){return i.clone({setHeaders:{Authorization:`Bearer ${e}`}})}function lv(i,e,t,n){return!localStorage.getItem("refreshToken")||Cn?(Cn||(Cn=!0,t.logout(),n.navigate(["/auth/login"]),Cn=!1),it(()=>new Error("Sesi\xF3n expirada o refresh en curso"))):(Cn=!0,t.refreshToken().pipe(ke(r=>(Cn=!1,localStorage.setItem("token",r.token),localStorage.setItem("refreshToken",r.refreshToken),e(Sm(i,r.token)))),we(r=>(Cn=!1,t.logout(),n.navigate(["/auth/login"]),it(()=>r)))))}function Mm(i,e){let t=M(Ze),n=M(Se),o=localStorage.getItem("token"),r=i;return o&&(r=Sm(i,o)),e(r).pipe(we(a=>a instanceof _l&&a.status===401?lv(r,e,t,n):it(()=>a)))}function Tm(i,e){let t=M(He);return e(i).pipe(we(n=>{let o="Ocurri\xF3 un error inesperado";if(n.error instanceof ErrorEvent)o=`Error: ${n.error.message}`;else switch(n.status){case 400:o="Solicitud incorrecta";break;case 401:return it(()=>n);case 403:o="No tiene permisos para realizar esta acci\xF3n";break;case 404:o="Recurso no encontrado";break;case 409:o="Conflicto con el estado actual del recurso";break;case 422:o="Datos de entrada inv\xE1lidos";break;case 500:o="Error interno del servidor";break;default:o=`Error ${n.status}: ${n.message}`}return t.open(o,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]}),it(()=>n)}))}var Vr=class i{constructor(e){this.http=e}getCurrentUser(){return this.http.get(`${ye.apiUrl}/users/me`)}updateUser(e,t){return this.http.patch(`${ye.apiUrl}/users/${e}`,t)}changePassword(e,t){return this.http.post(`${ye.apiUrl}/users/change-password`,{oldPassword:e,newPassword:t})}updatePreferences(e,t){return this.http.patch(`${ye.apiUrl}/users/${e}/preferences`,t)}static \u0275fac=function(t){return new(t||i)(P(Tt))};static \u0275prov=k({token:i,factory:i.\u0275fac,providedIn:"root"})};var $r=class i{constructor(e){this.http=e;En(15e3).pipe(ke(()=>this.getActiveAlerts())).subscribe()}alertsSubject=new ce([]);alerts$=this.alertsSubject.asObservable();getActiveAlerts(){return this.http.get(`${ye.apiUrl}/alerts/active`).pipe(xe(e=>this.alertsSubject.next(e)))}getAlertHistory(e,t){let n={startDate:e.toISOString(),endDate:t.toISOString()};return this.http.get(`${ye.apiUrl}/alerts/history`,{params:n})}acknowledgeAlert(e){return this.http.patch(`${ye.apiUrl}/alerts/${e}/acknowledge`,{})}resolveAlert(e){return this.http.patch(`${ye.apiUrl}/alerts/${e}/resolve`,{})}getAlertStats(){return this.http.get(`${ye.apiUrl}/alerts/stats`)}static \u0275fac=function(t){return new(t||i)(P(Tt))};static \u0275prov=k({token:i,factory:i.\u0275fac,providedIn:"root"})};var jr=class i{constructor(e){this.http=e;En(3e4).pipe(ke(()=>this.getNetworkMetrics())).subscribe()}metricsSubject=new ce([]);metrics$=this.metricsSubject.asObservable();getNetworkMetrics(){return this.http.get(`${ye.apiUrl}/monitoring/metrics`).pipe(xe(e=>this.metricsSubject.next(e)))}getElementMetrics(e){return this.http.get(`${ye.apiUrl}/monitoring/elements/${e}/metrics`)}getHistoricalMetrics(e,t,n){let o={startDate:t.toISOString(),endDate:n.toISOString()};return this.http.get(`${ye.apiUrl}/monitoring/elements/${e}/history`,{params:o})}static \u0275fac=function(t){return new(t||i)(P(Tt))};static \u0275prov=k({token:i,factory:i.\u0275fac,providedIn:"root"})};var Ur=class i{constructor(e){this.http=e}getReports(){return this.http.get(`${ye.apiUrl}/reports`)}getReport(e){return this.http.get(`${ye.apiUrl}/reports/${e}`)}generateReport(e){return this.http.post(`${ye.apiUrl}/reports/generate`,e)}downloadReport(e){return this.http.get(`${ye.apiUrl}/reports/${e}/download`,{responseType:"blob"})}deleteReport(e){return this.http.delete(`${ye.apiUrl}/reports/${e}`)}static \u0275fac=function(t){return new(t||i)(P(Tt))};static \u0275prov=k({token:i,factory:i.\u0275fac,providedIn:"root"})};var Hr=class i{constructor(e,t,n,o,r,a){this.networkStateService=e;this.eventBus=t;this.layerManager=n;this.elementService=o;this.dialog=r;this.logger=a;let c=this.networkStateService.getCurrentState();this.zoomLevel$=this.networkStateService.state$.pipe(se(m=>m.zoomLevel),st()),this.isDarkMode$=this.networkStateService.state$.pipe(se(m=>m.isDarkMode),st()),this.currentTool$=this.networkStateService.state$.pipe(se(m=>m.currentTool),st()),this.selectedElement$=this.networkStateService.state$.pipe(se(m=>m.selectedElement),st()),this.selectedConnection$=this.networkStateService.state$.pipe(se(m=>m.selectedConnection),st()),this.showSearchWidget$=this.networkStateService.showSearchWidget,this.showElementsPanel$=this.networkStateService.showElementsPanel,this.activeLayers$=new ce(Array.from(c.activeLayers)),this.layerManager.getActiveLayers().pipe(R(this.destroy$)).subscribe(m=>{this.activeLayers$.next(m)}),this.subscribeToEvents()}zoomLevel$;isDarkMode$;currentTool$;activeLayers$;selectedElement$;selectedConnection$;showSearchWidget$;showElementsPanel$;destroy$=new N;subscribeToEvents(){this.eventBus.on("ELEMENT_SELECTED").pipe(R(this.destroy$)).subscribe(e=>{this.networkStateService.updateSelectedElement(e.payload?.element)}),this.eventBus.on("CONNECTION_SELECTED").pipe(R(this.destroy$)).subscribe(e=>{this.networkStateService.setSelectedConnection(e.payload?.connection)}),this.eventBus.on("ZOOM_CHANGED").pipe(R(this.destroy$)).subscribe(e=>{this.networkStateService.setZoomLevel(e.payload?.level)})}setZoomLevel(e){this.networkStateService.setZoomLevel(e),this.eventBus.emit({type:"ZOOM_CHANGED",timestamp:new Date,payload:{level:e}})}selectElement(e){e?this.eventBus.emitElementSelected(e):this.networkStateService.updateSelectedElement(null)}selectConnection(e){e?this.eventBus.emitConnectionSelected(e):this.networkStateService.setSelectedConnection(null)}toggleLayer(e){this.layerManager.toggleLayer(e)}toggleCustomLayer(e){this.networkStateService.toggleCustomLayer(e)}setCurrentTool(e){let t=this.networkStateService.getCurrentState().currentTool;this.networkStateService.setCurrentTool(e),this.eventBus.emit({type:"VIEW_MODE_CHANGED",timestamp:new Date,payload:{tool:e,previousTool:t}})}completeMeasurement(e){this.eventBus.emit({type:"WIDGET_ACTION",timestamp:new Date,payload:{action:"measurement_completed",sourceElement:e.sourceElement,targetElement:e.targetElement,distance:e.distance}}),this.networkStateService.addToHistory({action:`Medici\xF3n: ${e.sourceElement.name} \u2192 ${e.targetElement.name}: ${e.distance.toFixed(2)}m`,timestamp:new Date})}createConnection(e){this.networkStateService.setIsDirty(!0),this.eventBus.emit({type:"CONNECTION_CREATED",timestamp:new Date,payload:{connection:e}}),this.networkStateService.addToHistory({action:`Conexi\xF3n creada: ${e.sourceElementId} \u2192 ${e.targetElementId}`,timestamp:new Date})}toggleSearchWidget(e){this.networkStateService.showSearchWidget.pipe(R(this.destroy$)).subscribe(t=>{let n=e!==void 0?e:!t;this.networkStateService.setShowSearchWidget(n),this.eventBus.emit({type:"WIDGET_ACTION",timestamp:new Date,payload:{component:"searchWidget",visible:n}})})}toggleElementsPanel(e){this.networkStateService.showElementsPanel.pipe(R(this.destroy$)).subscribe(t=>{let n=e!==void 0?e:!t;this.networkStateService.setShowElementsPanel(n),this.eventBus.emit({type:"WIDGET_ACTION",timestamp:new Date,payload:{component:"elementsPanel",visible:n}})})}destroy(){this.destroy$.next(),this.destroy$.complete(),this.logger.debug("MapFacadeService destruido")}static \u0275fac=function(t){return new(t||i)(P(Te),P(Co),P(At),P(kt),P(Ye),P(G))};static \u0275prov=k({token:i,factory:i.\u0275fac,providedIn:"root"})};var Gr=class i{constructor(e){this.logger=e}layerManagerVisible=new ce(!1);elementCreatorVisible=new ce(!1);connectionCreatorVisible=new ce(!1);elementDetailsVisible=new ce(!1);settingsVisible=new ce(!1);layerManager$=this.layerManagerVisible.asObservable();elementCreator$=this.elementCreatorVisible.asObservable();connectionCreator$=this.connectionCreatorVisible.asObservable();elementDetails$=this.elementDetailsVisible.asObservable();settings$=this.settingsVisible.asObservable();togglePanel(e,t,n=!0){let o=t!==void 0?t:!this.getPanelState(e);n&&o&&this.closeAllPanels(),this.setPanelState(e,o),this.logger.debug(`Panel ${e} ${o?"mostrado":"ocultado"}`)}closeAllPanels(){this.layerManagerVisible.next(!1),this.elementCreatorVisible.next(!1),this.connectionCreatorVisible.next(!1),this.elementDetailsVisible.next(!1),this.settingsVisible.next(!1),this.logger.debug("Todos los paneles cerrados")}isPanelVisible(e){return this.getPanelState(e)}getPanelState(e){switch(e){case"layerManager":return this.layerManagerVisible.value;case"elementCreator":return this.elementCreatorVisible.value;case"connectionCreator":return this.connectionCreatorVisible.value;case"elementDetails":return this.elementDetailsVisible.value;case"settings":return this.settingsVisible.value;default:return!1}}setPanelState(e,t){switch(e){case"layerManager":this.layerManagerVisible.next(t);break;case"elementCreator":this.elementCreatorVisible.next(t);break;case"connectionCreator":this.connectionCreatorVisible.next(t);break;case"elementDetails":this.elementDetailsVisible.next(t);break;case"settings":this.settingsVisible.next(t);break}}static \u0275fac=function(t){return new(t||i)(P(G))};static \u0275prov=k({token:i,factory:i.\u0275fac,providedIn:"root"})};var Wr=class i{constructor(e){this.keyboardShortcutsService=e;this.setupShortcutListeners()}zoomIn$=new N;zoomOut$=new N;zoomReset$=new N;fitScreen$=new N;panMode$=new N;selectMode$=new N;delete$=new N;ngOnDestroy(){this.zoomIn$.complete(),this.zoomOut$.complete(),this.zoomReset$.complete(),this.fitScreen$.complete(),this.panMode$.complete(),this.selectMode$.complete(),this.delete$.complete()}setupShortcutListeners(){document.addEventListener("app-shortcut",e=>{switch(e.detail?.id){case"zoom-in":this.zoomIn$.next();break;case"zoom-out":this.zoomOut$.next();break;case"zoom-reset":this.zoomReset$.next();break;case"fit-screen":this.fitScreen$.next();break;case"pan-mode":this.panMode$.next();break;case"select-mode":this.selectMode$.next();break;case"delete":this.delete$.next();break}})}get onZoomIn(){return this.zoomIn$.asObservable()}get onZoomOut(){return this.zoomOut$.asObservable()}get onZoomReset(){return this.zoomReset$.asObservable()}get onFitScreen(){return this.fitScreen$.asObservable()}get onPanMode(){return this.panMode$.asObservable()}get onSelectMode(){return this.selectMode$.asObservable()}get onDelete(){return this.delete$.asObservable()}static \u0275fac=function(t){return new(t||i)(P(Yt))};static \u0275prov=k({token:i,factory:i.\u0275fac,providedIn:"root"})};var ci=class i{constructor(e,t,n,o){this.networkStateService=e;this.elementService=t;this.connectionService=n;this.logger=o;this.initializeState(),Pn(()=>{this.networkStateService.updateDarkMode(this._isDarkMode())}),Pn(()=>{this.networkStateService.updateCurrentTool(this._currentTool())}),Pn(()=>{let r=Array.from(this._visibleElementTypes());this.networkStateService.updateActiveLayers(new Set(r))}),Pn(()=>{let r=this.filteredElements().length;this.elementsCountSubject.next(r)})}_elements=Ve([]);_connections=Ve([]);_selectedElement=Ve(null);_selectedConnection=Ve(null);_visibleElementTypes=Ve(new Set(Object.values(We)));_visibleCustomLayers=Ve(new Set);_zoomLevel=Ve(100);_viewportBounds=Ve(null);_isDarkMode=Ve(!1);_currentTool=Ve("pan");_loading=Ve(!1);_searchQuery=Ve("");selectedElementSubject=new ce(null);selectedElement$=this.selectedElementSubject.asObservable();selectedConnectionSubject=new ce(null);selectedConnection$=this.selectedConnectionSubject.asObservable();elementsCountSubject=new ce(0);elementsCount$=this.elementsCountSubject.asObservable();filteredElements=Gi(()=>{let e=this._elements(),t=this._visibleElementTypes(),n=this._searchQuery().toLowerCase();return e.filter(o=>!(!t.has(o.type)||n&&!(o.name?.toLowerCase().includes(n)||o.id?.toLowerCase().includes(n)||o.description?.toLowerCase().includes(n))))});filteredConnections=Gi(()=>{let e=this._connections(),t=new Set(this.filteredElements().map(n=>n.id));return e.filter(n=>t.has(n.sourceElementId)&&t.has(n.targetElementId))});statistics=Gi(()=>({totalElements:this._elements().length,visibleElements:this.filteredElements().length,totalConnections:this._connections().length,visibleConnections:this.filteredConnections().length}));get elements(){return this._elements.asReadonly()}get connections(){return this._connections.asReadonly()}get selectedElement(){return this._selectedElement.asReadonly()}get selectedConnection(){return this._selectedConnection.asReadonly()}get visibleElementTypes(){return this._visibleElementTypes.asReadonly()}get visibleCustomLayers(){return this._visibleCustomLayers.asReadonly()}get zoomLevel(){return this._zoomLevel.asReadonly()}get viewportBounds(){return this._viewportBounds.asReadonly()}get isDarkMode(){return this._isDarkMode.asReadonly()}get currentTool(){return this._currentTool.asReadonly()}get loading(){return this._loading.asReadonly()}get searchQuery(){return this._searchQuery.asReadonly()}state$=new ce({loading:!1,isDarkMode:!1,currentTool:"pan",visibleElementTypes:new Set});initializeState(){this._loading.set(!0),this.updateState(),this.elementService.getAllElements().subscribe({next:e=>{this._elements.set(e),this.logger.debug(`Cargados ${e.length} elementos`)},error:e=>{this.logger.error("Error al cargar elementos:",e),this._elements.set([])}}),this.connectionService.getConnections().subscribe({next:e=>{this._connections.set(e),this.logger.debug(`Cargadas ${e.length} conexiones`)},error:e=>{this.logger.error("Error al cargar conexiones:",e),this._connections.set([])},complete:()=>{this._loading.set(!1),this.updateState()}}),this.networkStateService.state$.subscribe(e=>{if(this._isDarkMode.set(e.isDarkMode),this._currentTool.set(e.currentTool),e.activeLayers instanceof Set)this._visibleElementTypes.set(e.activeLayers);else{let t=new Set(e.activeLayers);this._visibleElementTypes.set(t)}this.updateState()}),Pn(()=>{this.updateState()})}updateState(){this.state$.next({loading:this._loading(),isDarkMode:this._isDarkMode(),currentTool:this._currentTool(),visibleElementTypes:this._visibleElementTypes()})}selectElement(e){this._selectedElement.set(e),this.selectedElementSubject.next(e),e&&(this._selectedConnection.set(null),this.selectedConnectionSubject.next(null))}selectConnection(e){this._selectedConnection.set(e),this.selectedConnectionSubject.next(e),e&&(this._selectedElement.set(null),this.selectedElementSubject.next(null))}updateZoomLevel(e){this._zoomLevel.set(e)}updateViewportBounds(e){this._viewportBounds.set(e)}setCurrentTool(e){this._currentTool.set(e)}toggleElementType(e){this._visibleElementTypes.update(t=>{let n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})}toggleCustomLayer(e){this._visibleCustomLayers.update(t=>{let n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})}updateSearchQuery(e){this._searchQuery.set(e)}toggleDarkMode(){this._isDarkMode.update(e=>!e)}addElement(e){this._elements.update(t=>[...t,e])}updateElement(e){this._elements.update(t=>t.map(n=>n.id===e.id?e:n)),this._selectedElement()?.id===e.id&&this._selectedElement.set(e)}removeElement(e){this._elements.update(t=>t.filter(n=>n.id!==e)),this._selectedElement()?.id===e&&this._selectedElement.set(null),this._connections.update(t=>t.filter(n=>n.sourceElementId!==e&&n.targetElementId!==e))}addConnection(e){this._connections.update(t=>[...t,e])}updateConnection(e){this._connections.update(t=>t.map(n=>n.id===e.id?e:n)),this._selectedConnection()?.id===e.id&&this._selectedConnection.set(e)}removeConnection(e){this._connections.update(t=>t.filter(n=>n.id!==e)),this._selectedConnection()?.id===e&&this._selectedConnection.set(null)}updateVisibleElementTypes(e){this._visibleElementTypes.set(new Set(e)),this.updateState()}refreshMapData(){return this._loading.set(!0),this.updateState(),new Be(e=>{Vs([this.elementService.getAllElements(),this.connectionService.getConnections()]).subscribe({next:([t,n])=>{this._elements.set(t),this._connections.set(n),this._loading.set(!1),this.updateState(),e.next(!0),e.complete()},error:t=>{this.logger.error("Error al cargar datos del mapa",t),this._loading.set(!1),this.updateState(),e.error(t)}})})}getVisibleElements(e){let t=this.filteredElements();return e&&e>0&&e<t.length?t.slice(0,e):t}getVisibleConnections(e){let t=this.filteredConnections();return e&&e>0&&e<t.length?t.slice(0,e):t}static \u0275fac=function(t){return new(t||i)(P(Te),P(kt),P(ho),P(G))};static \u0275prov=k({token:i,factory:i.\u0275fac,providedIn:"root"})};var Kr=class i{constructor(e,t,n,o){this.mapRenderer=e;this.mapStateService=t;this.mapService=n;this.logger=o}setVisibleLayers(e){this.logger.debug("Actualizando capas visibles:",e),this.mapStateService.updateVisibleElementTypes(e)}setDarkMode(e){this.logger.debug(`Estableciendo modo oscuro: ${e}`),this.mapService.setDarkMode(e),this.mapRenderer.updateOptions({darkMode:e})}setActiveTool(e){this.logger.debug(`Estableciendo herramienta activa: ${e}`),this.mapStateService.setCurrentTool(e),this.mapService.setTool(e)}setZoomLevel(e){this.logger.debug(`Estableciendo nivel de zoom: ${e}`),this.mapService.setZoom(e),this.mapStateService.updateZoomLevel(e)}fitToScreen(){this.logger.debug("Ajustando vista para mostrar todos los elementos"),this.mapService.fitToScreen()}optimizeForHardware(e){this.logger.debug(`Optimizando para nivel de hardware: ${e}`);let t=this.mapService.getMap();t&&this.mapRenderer.optimizeForHardware(t,e)}toggleWebGL(e){let t=e!==void 0?e:!this.mapRenderer.getUseWebGL();this.logger.debug(`Configurando WebGL: ${t}`),this.mapRenderer.updateOptions({useWebGL:t}),this.mapRenderer.renderElements(this.mapStateService.filteredElements())}toggleProgressiveLoading(e){let t=e!==void 0?e:!this.mapRenderer.getProgressiveLoading();this.logger.debug(`Configurando carga progresiva: ${t}`),this.mapRenderer.updateOptions({progressiveLoading:t}),this.mapRenderer.renderElements(this.mapStateService.filteredElements())}toggleClustering(e){let t=e!==void 0?e:!this.mapRenderer.getClusteringEnabled();this.logger.debug(`Configurando clustering: ${t}`),this.mapRenderer.updateOptions({clusteringEnabled:t}),this.mapRenderer.renderElements(this.mapStateService.filteredElements())}static \u0275fac=function(t){return new(t||i)(P(Qn),P(ci),P(Dt),P(G))};static \u0275prov=k({token:i,factory:i.\u0275fac,providedIn:"root"})};var qr=class i{constructor(e,t,n){this.logger=e;this.mapRenderer=t;this.mapService=n}_capabilities=null;detectCapabilities(){if(this._capabilities)return this._capabilities;let e={level:"medium",gpuAcceleration:this.hasGPUAcceleration(),memoryConstraints:this.hasMemoryConstraints(),isMobile:this.isMobileDevice(),webGLAvailable:this.isWebGLAvailable(),details:{cores:this.detectCPUCores(),ram:"Desconocido",gpu:this.detectGPU(),userAgent:navigator.userAgent}};return e.webGLAvailable&&(e.maxTextureSize=this.detectMaxTextureSize()),e.level=this.determineHardwareLevel(e),this._capabilities=e,e}getRecommendedPerformanceConfig(){let e=this.detectCapabilities();switch(e.level){case"low":return{maxVisibleElements:200,enableClustering:!0,clusterRadius:100,enableWebGL:!1,animationsEnabled:!1,useProgressiveLoading:!0,batchSize:25,processingDelay:100,useSimplifiedRendering:!0,preloadDistance:50,connectionsVisible:"limited",enableMiniMap:!1};case"medium":return{maxVisibleElements:1e3,enableClustering:!0,clusterRadius:80,enableWebGL:e.webGLAvailable,animationsEnabled:!0,useProgressiveLoading:!0,batchSize:50,processingDelay:50,useSimplifiedRendering:!1,preloadDistance:100,connectionsVisible:"visible",enableMiniMap:!0};case"high":return{maxVisibleElements:5e3,enableClustering:e.isMobile,clusterRadius:50,enableWebGL:e.webGLAvailable,animationsEnabled:!0,useProgressiveLoading:!1,batchSize:100,processingDelay:10,useSimplifiedRendering:!1,preloadDistance:200,connectionsVisible:"all",enableMiniMap:!0};default:return{maxVisibleElements:500,enableClustering:!0,enableWebGL:e.webGLAvailable&&!e.isMobile,useProgressiveLoading:!0}}}determineHardwareLevel(e){return e.isMobile?e.webGLAvailable&&e.gpuAcceleration?"medium":"low":e.memoryConstraints?"low":e.gpuAcceleration&&e.webGLAvailable&&e.details.cores>=4?"high":"medium"}hasMemoryConstraints(){return"deviceMemory"in navigator?navigator.deviceMemory<4:this.isMobileDevice()}hasGPUAcceleration(){let e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");if(!t)return!1;let n=t.getSupportedExtensions();return!!n&&n.length>20}isWebGLAvailable(){try{let e=document.createElement("canvas");return!!(window.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl")))}catch{return!1}}isMobileDevice(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}detectCPUCores(){return typeof navigator.hardwareConcurrency<"u"?navigator.hardwareConcurrency:2}detectGPU(){try{let e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");if(!t)return null;let n=t.getExtension("WEBGL_debug_renderer_info");if(n)return t.getParameter(n.UNMASKED_RENDERER_WEBGL)}catch{}return null}detectMaxTextureSize(){try{let e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");return t?t.getParameter(t.MAX_TEXTURE_SIZE):2048}catch{return 2048}}optimizeForHardware(){let e=this.determineHardwareLevel(this.detectCapabilities());this.logger.debug(`Nivel de hardware detectado: ${e}`);let t=this.mapService.getMap();t&&this.mapRenderer.optimizeForHardware(t,e),e==="low"&&this.reduceVisualEffects()}reduceVisualEffects(){document.body.classList.add("reduce-animations");let e=this.mapService.getMap();e&&(e.options.fadeAnimation=!1,e.options.markerZoomAnimation=!1,e.options.zoomAnimation=!1),this.mapRenderer.updateOptions({useWebGL:!1,progressiveLoading:!0,clusteringEnabled:!0})}static \u0275fac=function(t){return new(t||i)(P(G),P(Qn),P(Dt))};static \u0275prov=k({token:i,factory:i.\u0275fac,providedIn:"root"})};var Qr=class i{constructor(e){this.logger=e;this.isWorkerSupported=typeof Worker<"u",this.isWorkerSupported?this.initWorker():this.logger.warn("Web Workers no est\xE1n soportados en este navegador. Los c\xE1lculos se realizar\xE1n en el hilo principal.")}worker=null;isWorkerSupported=!1;initWorker(){try{let e=`
        self.addEventListener('message', function(e) {
          const { action, data } = e.data;
          
          switch (action) {
            case 'calculateNetworkMetrics':
              const result = calculateNetworkMetrics(data.elements, data.connections);
              self.postMessage({ action: 'networkMetrics', data: result });
              break;
            case 'findOptimalPath':
              const path = findOptimalPath(data.source, data.target, data.connections);
              self.postMessage({ action: 'optimalPath', data: path });
              break;
            case 'analyzeNetworkClusters':
              const clusters = analyzeNetworkClusters(data.elements, data.connections);
              self.postMessage({ action: 'networkClusters', data: clusters });
              break;
            default:
              self.postMessage({ action: 'error', data: 'Acci\xF3n desconocida' });
          }
        });
        
        // Implementaci\xF3n de algoritmos de c\xE1lculo
        
        function calculateNetworkMetrics(elements, connections) {
          const startTime = performance.now();
          
          // Calcular distancia total
          let totalDistance = 0;
          for (const conn of connections) {
            if (conn.distance) {
              totalDistance += conn.distance;
            }
          }
          
          // Calcular conexiones promedio por elemento
          const averageConnections = connections.length / (elements.length || 1);
          
          // Calcular densidad de red (conexiones / conexiones posibles)
          const maxPossibleConnections = (elements.length * (elements.length - 1)) / 2;
          const networkDensity = connections.length / (maxPossibleConnections || 1);
          
          // Encontrar elementos centrales (con m\xE1s conexiones)
          const elementConnections = {};
          for (const conn of connections) {
            elementConnections[conn.sourceId] = (elementConnections[conn.sourceId] || 0) + 1;
            elementConnections[conn.targetId] = (elementConnections[conn.targetId] || 0) + 1;
          }
          
          // Ordenar elementos por n\xFAmero de conexiones
          const sortedElements = Object.entries(elementConnections)
            .sort((a, b) => b[1] - a[1])
            .slice(0, 5)
            .map(entry => entry[0]);
          
          // Calcular clusters b\xE1sicos
          const clusters = calculateBasicClusters(elements, connections);
          
          const endTime = performance.now();
          const calculationTime = endTime - startTime;
          
          // Determinar complejidad
          let complexity = 'low';
          if (elements.length > 500 || connections.length > 1000) {
            complexity = 'high';
          } else if (elements.length > 100 || connections.length > 200) {
            complexity = 'medium';
          }
          
          return {
            totalDistance,
            averageConnections,
            networkDensity,
            centralElements: sortedElements,
            clusters,
            performanceIndicators: {
              calculationTime,
              complexity
            }
          };
        }
        
        function findOptimalPath(sourceId, targetId, connections) {
          // Implementaci\xF3n simplificada de Dijkstra
          // Para una implementaci\xF3n completa se necesitar\xEDa m\xE1s c\xF3digo
          
          // Este es un algoritmo indicativo
          return { path: [], distance: 0 };
        }
        
        function analyzeNetworkClusters(elements, connections) {
          return calculateBasicClusters(elements, connections);
        }
        
        function calculateBasicClusters(elements, connections) {
          // Implementaci\xF3n b\xE1sica de clustering basado en proximidad
          // Este es un algoritmo indicativo
          return [];
        }
      `,t=new Blob([e],{type:"application/javascript"});this.worker=new Worker(URL.createObjectURL(t)),this.logger.debug("Web Worker inicializado para c\xE1lculos de red")}catch(e){this.isWorkerSupported=!1,this.logger.error("Error al inicializar Web Worker:",e)}}calculateNetworkMetrics(e,t){return!this.isWorkerSupported||!this.worker?this.calculateMetricsInMainThread(e,t):new Be(n=>{let o=r=>{let{action:a,data:c}=r.data;a==="networkMetrics"?(n.next(c),n.complete()):a==="error"&&n.error(new Error(c))};return this.worker.addEventListener("message",o),this.worker.postMessage({action:"calculateNetworkMetrics",data:{elements:e||[],connections:t||[]}}),()=>{this.worker.removeEventListener("message",o)}}).pipe(xe(n=>this.logger.debug("M\xE9tricas de red calculadas:",n)),we(n=>(this.logger.error("Error en c\xE1lculo de m\xE9tricas:",n),fe(this.getDefaultMetrics()))))}findOptimalPath(e,t,n){return!this.isWorkerSupported||!this.worker?fe({path:[],distance:0}):new Be(o=>{let r=a=>{let{action:c,data:m}=a.data;c==="optimalPath"?(o.next(m),o.complete()):c==="error"&&o.error(new Error(m))};return this.worker.addEventListener("message",r),this.worker.postMessage({action:"findOptimalPath",data:{source:e,target:t,connections:n||[]}}),()=>{this.worker.removeEventListener("message",r)}})}analyzeNetworkClusters(e,t){return!this.isWorkerSupported||!this.worker?fe([]):new Be(n=>{let o=r=>{let{action:a,data:c}=r.data;a==="networkClusters"?(n.next(c),n.complete()):a==="error"&&n.error(new Error(c))};return this.worker.addEventListener("message",o),this.worker.postMessage({action:"analyzeNetworkClusters",data:{elements:e||[],connections:t||[]}}),()=>{this.worker.removeEventListener("message",o)}})}calculateMetricsInMainThread(e,t){return fe(this.getDefaultMetrics()).pipe(xe(()=>this.logger.warn("C\xE1lculo realizado en hilo principal")))}getDefaultMetrics(){return{totalDistance:0,averageConnections:0,networkDensity:0,centralElements:[],clusters:[],performanceIndicators:{calculationTime:0,complexity:"low"}}}ngOnDestroy(){this.worker&&(this.worker.terminate(),this.worker=null)}static \u0275fac=function(t){return new(t||i)(P(G))};static \u0275prov=k({token:i,factory:i.\u0275fac,providedIn:"root"})};var Zr=class i{constructor(e,t,n){this.mapService=e;this.logger=t;this.networkStateService=n}svg=null;currentMeasurements=null;loadJsPDF(){return ae(this,null,function*(){let{jsPDF:e}=yield import("./chunk-R3VGRIET.js");return e})}loadHtml2Canvas(){return ae(this,null,function*(){return(yield import("./chunk-5MGQ7NMG.js")).default})}initialize(e){this.svg=e,this.logger.debug("Servicio de exportaci\xF3n inicializado")}setMeasurements(e){this.currentMeasurements=e}exportMap(e){this.logger.debug(`Exportando mapa en formato ${e}`);try{switch(e.toLowerCase()){case"png":this.exportToPNG();break;case"pdf":this.exportToPDF();break;case"json":this.exportToJSON();break;case"svg":this.exportToSVG();break;case"measurements":this.exportMeasurements();break;default:this.logger.error(`Formato de exportaci\xF3n no soportado: ${e}`);break}}catch(t){this.logger.error("Error al exportar mapa:",t)}}exportToPNG(e){let t=e||`network-map-${new Date().toISOString().slice(0,10)}.png`;try{this.mapService.exportMap("png"),this.logger.info(`Mapa exportado como PNG: ${t}`)}catch(n){this.logger.error("Error al exportar como PNG:",n)}}exportToPDF(e){let t=e||`network-map-${new Date().toISOString().slice(0,10)}.pdf`;try{return Bi(new Promise(n=>ae(this,null,function*(){try{let o=yield this.loadJsPDF(),r=document.querySelector(".map-content svg");if(!r){this.logger.error("No se encontr\xF3 el elemento SVG del mapa"),n(!1);return}let a=document.createElement("canvas"),c=r.getBoundingClientRect();a.width=c.width,a.height=c.height;let m=new XMLSerializer().serializeToString(r),h="data:image/svg+xml;base64,"+btoa(m),v=new Image;v.onload=()=>{let w=a.getContext("2d");if(!w){this.logger.error("No se pudo obtener el contexto 2D del canvas"),n(!1);return}w.drawImage(v,0,0);let T=new o({orientation:"landscape",unit:"px",format:[a.width,a.height]}),x=this.networkStateService.getCurrentState();T.setProperties({title:"Network Map",subject:"Network Map Export",author:"Network Map Tool",keywords:"network, map, export",creator:"Network Map Tool"});let S=a.toDataURL("image/png");T.addImage(S,"PNG",0,0,a.width,a.height),T.setFontSize(10),T.setTextColor(128,128,128),T.text(`Exportado: ${new Date().toLocaleString()}`,10,a.height-10),T.save(t),this.logger.info(`Mapa exportado como PDF: ${t}`),n(!0)},v.onerror=()=>{this.logger.error("Error al cargar la imagen SVG"),n(!1)},v.src=h}catch(o){this.logger.error("Error al exportar como PDF:",o),n(!1)}}))).pipe(we(n=>(this.logger.error("Error al exportar como PDF:",n),fe(!1))))}catch(n){return this.logger.error("Error al exportar como PDF:",n),fe(!1)}}exportToJSON(e){let t=e||`network-map-${new Date().toISOString().slice(0,10)}.json`;try{let n=this.networkStateService.getCurrentState(),o=n.connections?n.connections:[],r=n.connections?n.connections:[],a={version:"1.0",timestamp:new Date().toISOString(),elements:o,connections:r,metadata:{totalElements:o.length,totalConnections:r.length,exportedBy:"NetworkMapTool"}},c=JSON.stringify(a,null,2),m=new Blob([c],{type:"application/json;charset=utf-8"});this.downloadBlob(m,t),this.logger.info(`Mapa exportado como JSON: ${t}`)}catch(n){this.logger.error("Error al exportar como JSON:",n)}}exportToSVG(e){let t=e||`network-map-${new Date().toISOString().slice(0,10)}.svg`;try{if(!this.svg||!this.svg.node()){this.logger.error("No se pudo exportar el SVG: elemento svg no inicializado");return}let n=this.svg.node().cloneNode(!0);this.applyInlineStyles(n);let r=new XMLSerializer().serializeToString(n),a=new Blob([r],{type:"image/svg+xml;charset=utf-8"});this.downloadBlob(a,t),this.logger.info(`Mapa exportado como SVG: ${t}`)}catch(n){this.logger.error("Error al exportar como SVG:",n)}}exportMeasurements(){if(!this.currentMeasurements){this.logger.warn("No hay mediciones para exportar"),this.networkStateService.showSnackbar("No hay mediciones para exportar","warning");return}try{let e={timestamp:new Date().toISOString(),measurements:this.currentMeasurements,metadata:{type:"distance-measurement",unit:"meters",exportedBy:"NetworkMapTool"}},t=JSON.stringify(e,null,2),n=new Blob([t],{type:"application/json;charset=utf-8"});this.downloadBlob(n,`network-measurements-${this.getDateTimeString()}.json`),this.networkStateService.showSnackbar("Mediciones exportadas","success")}catch(e){this.logger.error("Error al exportar mediciones:",e),this.networkStateService.showSnackbar("Error al exportar mediciones","error")}}saveMapState(e,t,n="json",o){this.logger.debug(`Guardando estado del mapa en formato ${n}`),n.toLowerCase()!=="json"&&this.logger.warn(`Formato no soportado para guardar estado: ${n}. Usando JSON.`);let r=o||`network-map-state-${new Date().toISOString().slice(0,10)}.json`;try{let a={elements:e,connections:t,metadata:{version:"1.0",exportDate:new Date().toISOString(),elementCount:e.length,connectionCount:t.length}},c=JSON.stringify(a,null,2),m=new Blob([c],{type:"application/json"}),g=URL.createObjectURL(m),h=document.createElement("a");h.href=g,h.download=r,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(g),this.logger.info(`Estado del mapa guardado como JSON: ${r}`)}catch(a){throw this.logger.error("Error al guardar estado del mapa:",a),a}}generateMapReport(e,t,n){let o=n||`network-map-report-${new Date().toISOString().slice(0,10)}.pdf`;this.logger.debug("Generando informe del mapa en PDF"),this.loadJsPDF().then(r=>{try{let a=new r({orientation:"landscape",unit:"mm",format:"a4"});a.setProperties({title:"Network Map Report",subject:"Network Map Detailed Report",author:"Network Map Tool",keywords:"network, map, report",creator:"Network Map Tool"}),a.setFontSize(22),a.setTextColor(0,0,0),a.text("Network Map Report",15,15),a.setFontSize(12),a.setTextColor(100,100,100),a.text(`Generated: ${new Date().toLocaleString()}`,15,22),a.setDrawColor(200,200,200),a.line(15,25,280,25),a.setFontSize(16),a.setTextColor(0,0,0),a.text("Summary",15,35),a.setFontSize(12),a.text(`Total Elements: ${e.length}`,15,45),a.text(`Total Connections: ${t.length}`,15,52);let c=this.calculateElementsByType(e);a.setFontSize(14),a.text("Elements by Type",15,65);let m=70;a.setFontSize(10),a.setTextColor(0,0,0),a.setFillColor(240,240,240),a.rect(15,m,100,7,"F"),a.setFont("helvetica","bold"),a.text("Element Type",17,m+5),a.text("Count",80,m+5),a.setFont("helvetica","normal"),m+=10,Object.entries(c).forEach(([h,v],w)=>{w%2===0&&(a.setFillColor(250,250,250),a.rect(15,m-5,100,7,"F")),a.text(this.getElementTypeName(h),17,m),a.text(v.toString(),80,m),m+=7}),e.length>10&&(a.addPage(),a.setFontSize(16),a.setTextColor(0,0,0),a.text("Elements Detail",15,15),m=25,a.setFontSize(10),a.setFillColor(240,240,240),a.rect(15,m,260,7,"F"),a.setFont("helvetica","bold"),a.text("ID",17,m+5),a.text("Name",50,m+5),a.text("Type",120,m+5),a.text("Status",160,m+5),a.text("Connections",200,m+5),a.setFont("helvetica","normal"),m+=10,e.slice(0,30).forEach((h,v)=>{v%2===0&&(a.setFillColor(250,250,250),a.rect(15,m-5,260,7,"F"));let w=t.filter(T=>T.sourceElementId===h.id||T.targetElementId===h.id).length;a.text(h.id?.slice(0,12)||"N/A",17,m),a.text(h.name?.slice(0,25)||"Sin nombre",50,m),a.text(this.getElementTypeName(h.type),120,m),a.text(h.status||"Desconocido",160,m),a.text(w.toString(),200,m),m+=7,m>190&&v<e.length-1&&(a.addPage(),m=15,a.setFontSize(16),a.text("Elements Detail (continued)",15,m),m=25,a.setFontSize(10),a.setFillColor(240,240,240),a.rect(15,m,260,7,"F"),a.setFont("helvetica","bold"),a.text("ID",17,m+5),a.text("Name",50,m+5),a.text("Type",120,m+5),a.text("Status",160,m+5),a.text("Connections",200,m+5),a.setFont("helvetica","normal"),m+=10)}));let g=a.getNumberOfPages();for(let h=1;h<=g;h++)a.setPage(h),a.setFontSize(8),a.setTextColor(150,150,150),a.text(`Network Map Report - Page ${h} of ${g}`,a.internal.pageSize.getWidth()/2,a.internal.pageSize.getHeight()-10,{align:"center"});a.save(o),this.logger.info(`Informe del mapa generado como PDF: ${o}`)}catch(a){throw this.logger.error("Error al generar informe del mapa:",a),a}}).catch(r=>{this.logger.error("Error al cargar jsPDF:",r)})}calculateElementsByType(e){let t={};return e.forEach(n=>{t[n.type]||(t[n.type]=0),t[n.type]++}),t}getElementTypeName(e){return{FDP:"Fiber Distribution Point",OLT:"Optical Line Terminal",ONT:"Optical Network Terminal",SPLITTER:"Splitter",EDFA:"Erbium Doped Fiber Amplifier",MANGA:"Fiber Splice Enclosure",TERMINAL_BOX:"Terminal Box",MSAN:"Multi-Service Access Node"}[e]||e}downloadBlob(e,t){let n=URL.createObjectURL(e),o=document.createElement("a");o.href=n,o.download=t,document.body.appendChild(o),o.click(),setTimeout(()=>{document.body.removeChild(o),URL.revokeObjectURL(n)},100)}applyInlineStyles(e){let t=e.querySelectorAll("*");for(let n=0;n<t.length;n++){let o=t[n],r=window.getComputedStyle(o);for(let a=0;a<r.length;a++){let c=r[a],m=r.getPropertyValue(c);m&&(o.style[c]=m)}}}getDateTimeString(){return new Date().toISOString().replace(/:/g,"-").replace(/\..+/,"").replace("T","_")}static \u0275fac=function(t){return new(t||i)(P(Dt),P(G),P(Te))};static \u0275prov=k({token:i,factory:i.\u0275fac,providedIn:"root"})};var Yr=class i{preload(e,t){return e.data?.preload===!0?t():fe(null)}static \u0275fac=function(t){return new(t||i)};static \u0275prov=k({token:i,factory:i.\u0275fac,providedIn:"root"})};var Om={providers:[yl(Dd,El(Yr)),bl(Cl([Mm,Tm])),Pp(),Kc(wm),im(xm),Yp({maxAge:25,logOnly:!1,autoPause:!0,trace:!1,traceLimit:75}),{provide:Pl,useValue:!0},Ze,Kl,Xt,G,uc,Pc,Vr,$r,jr,Ur,Oc,Co,ei,Te,Dt,pc,kt,Hr,Gr,Wr,ci,Qn,Dc,It,At,Vc,Kr,qr,Qr,vo,Zr]};var Xr=class i{constructor(e,t,n){this.keyboardService=e;this.helpService=t;this.router=n}title="Network Map";routerSubscription;ngOnInit(){this.routerSubscription=this.router.events.pipe(_e(e=>e instanceof On)).subscribe(e=>{this.updateKeyboardContexts(e.url)}),this.setupShortcutListeners()}ngOnDestroy(){this.routerSubscription&&this.routerSubscription.unsubscribe()}updateKeyboardContexts(e){e.includes("/network-design/map")?this.keyboardService.setActiveContext("map"):e.includes("/network-design/element/")&&e.includes("/edit/")?this.keyboardService.setActiveContext("editor"):e.includes("/network-design/element/")&&e.includes("/batch")?this.keyboardService.setActiveContext("batch-editor"):e.includes("/network-design/element/history/")?this.keyboardService.setActiveContext("detail-view"):this.keyboardService.setActiveContext("global")}setupShortcutListeners(){document.addEventListener("app-shortcut",e=>{switch(e.detail?.id){case"help":this.helpService.showKeyboardShortcutsHelp();break;case"refresh":window.location.reload();break}})}static \u0275fac=function(t){return new(t||i)(I(Yt),I(Xt),I(Se))};static \u0275cmp=q({type:i,selectors:[["app-root"]],decls:1,vars:0,template:function(t,n){t&1&&D(0,"router-outlet")},dependencies:[Pt],encapsulation:2})};vl(Xr,Om).catch(i=>console.error(i));
