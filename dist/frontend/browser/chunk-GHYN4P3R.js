import{a as Le}from"./chunk-LDPLFFFJ.js";import{a as de}from"./chunk-MHWJR3EV.js";import"./chunk-E7SS3VLG.js";import{c as _,d as u,g as d,h as F,j as f,k as le,l as ce}from"./chunk-N7T535CU.js";import{e as ze}from"./chunk-PQUQY4V4.js";import"./chunk-SFSNZG2F.js";import{h as Re}from"./chunk-GQNYZBS2.js";import{d as Pe}from"./chunk-NI7QRJ7Q.js";import{a as Ae,b as Oe}from"./chunk-F5P253LU.js";import{a as H}from"./chunk-PYE7UGMK.js";import"./chunk-VMUGXP3O.js";import{a as Me,b as Te}from"./chunk-D3FDFS7S.js";import"./chunk-RWQWO3EM.js";import{a as se}from"./chunk-ULFK375Q.js";import"./chunk-JO2MD4NL.js";import{a as Z,b as q,i as ke,j as De,n as K}from"./chunk-XJSBNB6N.js";import{v as We,w as Ne}from"./chunk-VH7SA6GK.js";import"./chunk-4PHUDKEH.js";import{$a as s,$b as w,$c as X,Aa as T,F as V,Gb as o,Ha as ve,Hb as a,Ib as B,Ja as S,Ka as we,Lc as G,Mb as k,Mc as Se,Na as xe,Nc as Y,Ob as D,Pb as p,Tc as Ee,_b as c,ac as A,bc as oe,cb as be,f as fe,g as P,id as Ie,ja as z,kb as $,mb as _e,mc as L,n as ae,nc as U,oa as N,ob as ye,pa as C,qb as v,s as R,xb as m,ya as he,yb as Ce,za as M}from"./chunk-FG6FKNI4.js";import{a as x,b}from"./chunk-OXVY4BEJ.js";var J=class r{constructor(e,t){this.logger=e;this.zone=t}initializeWidget(e,t,i={}){try{let n=e.nativeElement;t.addClass(n,"widget-container"),i.minWidth&&t.setStyle(n,"min-width",`${i.minWidth}px`),i.minHeight&&t.setStyle(n,"min-height",`${i.minHeight}px`),i.maxWidth&&t.setStyle(n,"max-width",`${i.maxWidth}px`),i.maxHeight&&t.setStyle(n,"max-height",`${i.maxHeight}px`),i.position&&t.addClass(n,`widget-position-${i.position}`),i.zIndex!==void 0&&t.setStyle(n,"z-index",i.zIndex),i.customClass&&i.customClass.length>0&&i.customClass.forEach(g=>{t.addClass(n,g)});let l=n.getBoundingClientRect();return l.width===0||l.height===0?{success:!1,elementRef:e,errorMessage:"Dimensiones del widget inv\xE1lidas (0x0)"}:{success:!0,elementRef:e,dimensions:{width:l.width,height:l.height}}}catch(n){return this.logger.error("Error al inicializar widget:",n),{success:!1,elementRef:e,errorMessage:n instanceof Error?n.message:"Error desconocido"}}}setupDraggableWidget(e,t,i,n){try{let l=e.nativeElement,g=l.querySelector(i);if(!g){this.logger.warn(`No se encontr\xF3 el selector de arrastre "${i}" en el widget`);return}t.setStyle(g,"cursor","move"),t.setAttribute(l,"draggable","false");let h=!1,O=0,y=0,I=n?document.getElementById(n):document.body;if(!I){this.logger.warn(`No se encontr\xF3 el contenedor "${n}" para el widget arrastrable`);return}t.addClass(l,"widget-draggable");let me=E=>{if(E.button!==0)return;E.preventDefault();let W=l.getBoundingClientRect();O=E.clientX-W.left,y=E.clientY-W.top,h=!0,t.addClass(l,"widget-dragging"),t.setStyle(l,"position","absolute")},ge=E=>{h&&(E.preventDefault(),this.zone.run(()=>{let W=I.getBoundingClientRect(),ne=E.clientX-W.left-O,re=E.clientY-W.top-y,ue=l.getBoundingClientRect();ne=Math.max(0,Math.min(ne,W.width-ue.width)),re=Math.max(0,Math.min(re,W.height-ue.height)),t.setStyle(l,"left",`${ne}px`),t.setStyle(l,"top",`${re}px`)}))},pe=E=>{h&&(E.preventDefault(),h=!1,t.removeClass(l,"widget-dragging"))};g.addEventListener("mousedown",me),document.addEventListener("mousemove",ge),document.addEventListener("mouseup",pe);let Fe=()=>{g.removeEventListener("mousedown",me),document.removeEventListener("mousemove",ge),document.removeEventListener("mouseup",pe)};l._draggableCleanup=Fe}catch(l){this.logger.error("Error al configurar widget arrastrable:",l)}}showWidgetError(e,t,i,n){try{let l=i.nativeElement,g=n.createElement("div");n.addClass(g,"widget-error");let h=n.createElement("span");n.addClass(h,"error-icon"),n.appendChild(h,n.createText("\u26A0\uFE0F"));let O=n.createElement("span");n.appendChild(O,n.createText(`Error en ${t}: ${e}`)),n.appendChild(g,h),n.appendChild(g,O),n.setProperty(l,"innerHTML",""),n.appendChild(l,g),n.setStyle(g,"background-color","#ffebee"),n.setStyle(g,"color","#c62828"),n.setStyle(g,"padding","8px 12px"),n.setStyle(g,"border-radius","4px"),n.setStyle(g,"margin","8px"),n.setStyle(g,"font-size","12px"),n.setStyle(g,"display","flex"),n.setStyle(g,"align-items","center"),n.setStyle(g,"gap","8px")}catch(l){this.logger.error("Error al mostrar error de widget:",l)}}static \u0275fac=function(t){return new(t||r)(N(H),N(we))};static \u0275prov=z({token:r,factory:r.\u0275fac,providedIn:"root"})};var Q=class r{constructor(e){this.logger=e;this.logger.info("Servicio de monitoreo de rendimiento inicializado")}performanceMetrics=new fe;performanceMetrics$=this.performanceMetrics.asObservable();dashboardStats=new P({totalWidgets:0,averageWidgetRenderTime:0,averageWidgetUpdateTime:0,totalUpdates:0,lastCalculated:new Date});dashboardStats$=this.dashboardStats.asObservable();metricsByWidget=new Map;widgetSummaries=new Map;monitoringEnabled=!0;setMonitoringEnabled(e){this.monitoringEnabled=e,this.logger.debug(`Monitoreo de rendimiento ${e?"activado":"desactivado"}`)}recordMetric(e){if(!this.monitoringEnabled)return;let t=b(x({},e),{timestamp:e.timestamp||new Date});if(this.performanceMetrics.next(t),t.widgetId){this.metricsByWidget.has(t.widgetId)||this.metricsByWidget.set(t.widgetId,[]),this.metricsByWidget.get(t.widgetId)?.push(t);let i=this.metricsByWidget.get(t.widgetId);i&&i.length>100&&i.shift(),this.updateWidgetSummary(t)}this.calculateDashboardStats()}startMeasurement(e,t,i,n){if(!this.monitoringEnabled)return()=>{};let l=performance.now();return()=>{let h=performance.now()-l;this.recordMetric({widgetId:i,componentType:e,metricType:t,value:h,timestamp:new Date,context:n})}}getWidgetSummary(e){return this.widgetSummaries.get(e)}getAllWidgetSummaries(){return Array.from(this.widgetSummaries.values())}getWidgetMetricHistory(e){return this.metricsByWidget.get(e)||[]}clearAllMetrics(){this.metricsByWidget.clear(),this.widgetSummaries.clear(),this.calculateDashboardStats()}updateWidgetSummary(e){if(!e.widgetId)return;let t=e.widgetId,i=this.widgetSummaries.get(t);switch(i||(i={widgetId:t,componentType:e.componentType,averageRenderTime:0,averageUpdateTime:0,updateCount:0,lastUpdated:new Date}),e.metricType){case"render":i.averageRenderTime=this.calculateRunningAverage(i.averageRenderTime,e.value,i.updateCount+1);break;case"update":i.averageUpdateTime=this.calculateRunningAverage(i.averageUpdateTime,e.value,i.updateCount+1);break;case"load":i.loadTime=e.value;break}i.updateCount+=1,i.lastUpdated=new Date,this.widgetSummaries.set(t,i)}calculateRunningAverage(e,t,i){return(e*(i-1)+t)/i}calculateDashboardStats(){let e=this.getAllWidgetSummaries();if(e.length===0){this.dashboardStats.next({totalWidgets:0,averageWidgetRenderTime:0,averageWidgetUpdateTime:0,totalUpdates:0,lastCalculated:new Date});return}let t=0,i=0,n=0,l,g,h=-1,O=Number.MAX_VALUE;for(let y of e){t+=y.averageRenderTime,i+=y.averageUpdateTime,n+=y.updateCount;let I=y.averageUpdateTime;I>h&&(h=I,l={widgetId:y.widgetId,componentType:y.componentType,averageTime:I}),I<O&&(O=I,g={widgetId:y.widgetId,componentType:y.componentType,averageTime:I})}this.dashboardStats.next({totalWidgets:e.length,averageWidgetRenderTime:t/e.length,averageWidgetUpdateTime:i/e.length,totalUpdates:n,slowestWidget:l,fastestWidget:g,lastCalculated:new Date})}static \u0275fac=function(t){return new(t||r)(N(H))};static \u0275prov=z({token:r,factory:r.\u0275fac,providedIn:"root"})};var ee=class r{widgetId;title="Widget";position="top-right";draggable=!0;collapsible=!0;closable=!0;resizable=!1;minWidth=250;maxWidth;minHeight=100;maxHeight;zIndex;customClass=[];widgetAction=new S;widgetError=new S;widgetUpdate=new S;enablePerformanceMonitoring=!0;widgetStateService=C(Le);widgetRenderService=C(J);performanceMonitoringService=C(Q);renderer=C(be);el=C(xe);destroyRef=C(ve);widgetState$=this.widgetStateService.getWidgetState(this.widgetId||"unknown-widget");get isVisible(){return this.widgetStateService.getCurrentWidgetState(this.widgetId).isVisible}get isCollapsed(){return this.widgetStateService.getCurrentWidgetState(this.widgetId).isCollapsed}ngOnInit(){let e=this.startPerformanceMeasurement("init");this.widgetId||(console.error("Widget debe tener un ID \xFAnico"),this.widgetId=`widget-${Date.now()}`),this.widgetState$=this.widgetStateService.getWidgetState(this.widgetId),this.initializeWidget(),this.emitUpdateEvent("initialized",{widgetId:this.widgetId,isVisible:this.isVisible,isCollapsed:this.isCollapsed,position:this.position}),e()}initializeWidget(){let e={minWidth:this.minWidth,minHeight:this.minHeight,maxWidth:this.maxWidth,maxHeight:this.maxHeight,position:this.position,draggable:this.draggable,resizable:this.resizable,customClass:this.customClass,zIndex:this.zIndex},t=this.widgetRenderService.initializeWidget(this.el,this.renderer,e);t.success||(console.warn(`Error al inicializar widget ${this.widgetId}:`,t.errorMessage),this.widgetRenderService.showWidgetError(t.errorMessage||"Error desconocido",this.constructor.name,this.el,this.renderer),this.emitErrorEvent("initialization",{code:"WIDGET_INIT_ERROR",message:t.errorMessage||"Error al inicializar widget",details:{options:e,widgetType:this.constructor.name}})),this.draggable&&this.widgetRenderService.setupDraggableWidget(this.el,this.renderer,".widget-header","map-container")}toggleCollapse(){if(!this.collapsible)return;let e=this.startPerformanceMeasurement("interaction"),t=this.isCollapsed;this.widgetStateService.toggleWidgetCollapse(this.widgetId),this.emitUpdateEvent("state",{widgetId:this.widgetId,previousState:{isCollapsed:t},currentState:{isCollapsed:!t}}),e()}closeWidget(){if(!this.closable)return;let e=this.startPerformanceMeasurement("interaction");this.widgetStateService.setWidgetVisibility(this.widgetId,!1),this.emitUpdateEvent("visibility",{widgetId:this.widgetId,previousState:{isVisible:!0},currentState:{isVisible:!1}}),e()}showWidget(){let e=this.startPerformanceMeasurement("interaction");this.widgetStateService.setWidgetVisibility(this.widgetId,!0),this.emitUpdateEvent("visibility",{widgetId:this.widgetId,previousState:{isVisible:!1},currentState:{isVisible:!0}}),e()}refreshData(){console.log(`Widget ${this.widgetId}: m\xE9todo refreshData() no implementado`)}startPerformanceMeasurement(e,t){return this.enablePerformanceMonitoring?this.performanceMonitoringService.startMeasurement(this.constructor.name,e,this.widgetId,t):()=>{}}emitUpdateEvent(e,t){let i=this.startPerformanceMeasurement("update",{updateType:e});this.widgetUpdate.emit({source:this.widgetId,type:"update",timestamp:new Date,updateType:e,currentState:t}),i()}emitActionEvent(e,t,i){let n=this.startPerformanceMeasurement("interaction",{action:e});this.widgetAction.emit({source:this.widgetId,type:"action",timestamp:new Date,action:e,elementId:t,actionData:i}),n()}emitErrorEvent(e,t){this.widgetError.emit({source:this.widgetId,type:"error",timestamp:new Date,error:b(x({},t),{details:b(x({},t.details),{context:e})})})}handleError(e,t){let i=t?.message||"Error desconocido";console.error(`Error en widget ${this.widgetId} durante ${e}:`,t),this.emitErrorEvent(e,{code:"WIDGET_OPERATION_ERROR",message:`Error al realizar la operaci\xF3n ${e}: ${i}`,details:{error:t,operation:e,widgetId:this.widgetId}})}ngOnDestroy(){this.emitUpdateEvent("state",{widgetId:this.widgetId,currentState:{isDestroying:!0}});let e=this.el.nativeElement;e&&e._draggableCleanup&&e._draggableCleanup()}static \u0275fac=function(t){return new(t||r)};static \u0275dir=_e({type:r,inputs:{widgetId:"widgetId",title:"title",position:"position",draggable:"draggable",collapsible:"collapsible",closable:"closable",resizable:"resizable",minWidth:"minWidth",maxWidth:"maxWidth",minHeight:"minHeight",maxHeight:"maxHeight",zIndex:"zIndex",customClass:"customClass",enablePerformanceMonitoring:"enablePerformanceMonitoring"},outputs:{widgetAction:"widgetAction",widgetError:"widgetError",widgetUpdate:"widgetUpdate"}})};var te=class r{constructor(e){this.http=e;this.initializeMonitoring(),this.loadSampleAlerts()}monitoringDataSubject=new P({});alerts=new P([]);networkHealthSubject=new P(0);initializeMonitoring(){this.startMonitoring()}startMonitoring(){setInterval(()=>{this.updateMonitoringData(),this.checkNetworkHealth(),this.processAlerts()},5e3)}updateMonitoringData(){}checkNetworkHealth(){}processAlerts(){}getMonitoringData(e){return this.monitoringDataSubject.pipe(R(t=>t[e]||null))}getAllMonitoringData(){return this.monitoringDataSubject.asObservable()}getAlerts(e){return this.alerts.asObservable().pipe(R(t=>e&&e>0?t.slice(0,e):t))}getNetworkHealth(){return this.networkHealthSubject.asObservable()}getMetrics(){return se.useMocks?this.monitoringDataSubject.pipe(R(e=>({elementCount:Object.keys(e).length||10,connectionCount:15,utilization:this.calculateNetworkUtilization(e)||65,health:this.networkHealthSubject.getValue()||85}))):this.http.get(`${se.apiUrl}/monitoring/metrics`).pipe(R(e=>{let t={elementCount:e?.elementCount||0,connectionCount:e?.connectionCount||0,utilization:e?.utilization||0,health:e?.health||0};return e?.health&&this.networkHealthSubject.next(e.health),t}),V(e=>(console.error("Error al obtener m\xE9tricas de la API:",e),this.monitoringDataSubject.pipe(R(t=>({elementCount:Object.keys(t).length||10,connectionCount:15,utilization:this.calculateNetworkUtilization(t)||65,health:this.networkHealthSubject.getValue()||85}))))))}calculateNetworkUtilization(e){if(Object.keys(e).length===0)return 0;let t=0,i=0;return Object.values(e).forEach(n=>{if(n&&typeof n=="object"){let l=n.utilizationPercentage||n.utilization||n.usagePercentage||0;l!==void 0&&(t+=l,i++)}}),i>0?t/i:0}addAlert(e){e.title||(console.warn("Se intent\xF3 crear una alerta sin t\xEDtulo. Se usar\xE1 el mensaje como t\xEDtulo."),e=b(x({},e),{title:e.message||"Alerta sin t\xEDtulo"}));let t=b(x({},e),{id:Date.now().toString(),timestamp:new Date,resolved:!1,acknowledged:!1}),i=this.alerts.getValue();this.alerts.next([...i,t])}resolveAlert(e){let i=this.alerts.getValue().map(n=>n.id===e?b(x({},n),{resolved:!0}):n);this.alerts.next(i)}reopenAlert(e){let i=this.alerts.getValue().map(n=>n.id===e?b(x({},n),{resolved:!1}):n);this.alerts.next(i)}removeAlert(e){let i=this.alerts.getValue().filter(n=>n.id!==e);this.alerts.next(i)}clearAllAlerts(){this.alerts.next([])}setMonitoringInterval(e){}setAlertThresholds(e){}exportMonitoringData(){}exportAlerts(){}clearMonitoringData(){this.monitoringDataSubject.next({})}loadSampleAlerts(){let e=[{id:"1",elementId:"OLT-001",elementType:"OLT",type:"CRITICAL",deviceType:"olt",severity:"CRITICAL",title:"Fallo de conectividad en OLT",message:"OLT-001 ha reportado fallo de conectividad",timestamp:new Date(Date.now()-12e4),resolved:!1,acknowledged:!1},{id:"2",elementId:"FDP-003",elementType:"FDP",type:"WARNING",deviceType:"general",severity:"MEDIUM",title:"Se\xF1al degradada en FDP",message:"Se\xF1al de fibra degradada en conexi\xF3n FDP-003 a ONT-005",timestamp:new Date(Date.now()-36e5),resolved:!1,acknowledged:!1},{id:"3",elementId:"SECTOR-NORTE",elementType:"TERMINAL_BOX",type:"INFO",deviceType:"general",severity:"LOW",title:"Mantenimiento programado",message:"Mantenimiento programado para el sector norte el 15/06/2023",timestamp:new Date(Date.now()-864e5),resolved:!0,acknowledged:!0},{id:"4",elementId:"SPL-002",elementType:"SPLITTER",type:"WARNING",deviceType:"splitter",severity:"MEDIUM",title:"Capacidad l\xEDmite en Splitter",message:"Splitter SPL-002 alcanzando l\xEDmite de capacidad (85%)",timestamp:new Date(Date.now()-72e5),resolved:!1,acknowledged:!1}];this.alerts.next(e)}getTestAlerts(){let e=new Date;return[{id:"alert-001",elementId:"olt-001",elementType:"OLT",type:"CRITICAL",title:"P\xE9rdida de conexi\xF3n OLT",severity:"CRITICAL",message:"P\xE9rdida de conexi\xF3n con OLT principal",timestamp:new Date(e.getTime()-30*6e4),acknowledged:!1,details:{reason:"No responde a ICMP",affectedCustomers:120}},{id:"alert-002",elementId:"edfa-001",elementType:"EDFA",type:"ERROR",title:"Temperatura elevada EDFA",severity:"HIGH",message:"Temperatura elevada en amplificador EDFA",timestamp:new Date(e.getTime()-120*6e4),acknowledged:!0,acknowledgedBy:"admin",acknowledgedAt:new Date(e.getTime()-90*6e4),details:{temperature:75,threshold:70}},{id:"alert-003",elementId:"splitter-002",elementType:"SPLITTER",type:"WARNING",title:"Degradaci\xF3n de se\xF1al",severity:"MEDIUM",message:"Degradaci\xF3n de se\xF1al en divisor \xF3ptico",timestamp:new Date(e.getTime()-180*6e4),acknowledged:!1,details:{signalLoss:"7.2dB",expectedLoss:"3.5dB"}},{id:"alert-004",elementId:"conn-001",elementType:"FIBER_CONNECTION",type:"INFO",title:"Fluctuaci\xF3n de potencia",severity:"LOW",message:"Fluctuaci\xF3n de potencia \xF3ptica detectada",timestamp:new Date(e.getTime()-240*6e4),acknowledged:!1}]}static \u0275fac=function(t){return new(t||r)(N(Ie))};static \u0275prov=z({token:r,factory:r.\u0275fac,providedIn:"root"})};var Ue=_("fadeIn",[f(":enter",[d({opacity:0}),u("300ms ease-out",d({opacity:1}))]),f(":leave",[u("300ms ease-in",d({opacity:0}))])]),$t=_("scale",[f(":enter",[d({transform:"scale(0.95)",opacity:0}),u("200ms ease-out",d({transform:"scale(1)",opacity:1}))]),f(":leave",[u("200ms ease-in",d({transform:"scale(0.95)",opacity:0}))])]),Bt=_("slideInRight",[f(":enter",[d({transform:"translateX(100%)"}),u("200ms ease-out",d({transform:"translateX(0)"}))]),f(":leave",[u("200ms ease-in",d({transform:"translateX(100%)"}))])]),Gt=_("slideInLeft",[f(":enter",[d({transform:"translateX(-100%)"}),u("200ms ease-out",d({transform:"translateX(0)"}))]),f(":leave",[u("200ms ease-in",d({transform:"translateX(-100%)"}))])]),He=_("slideInUp",[f(":enter",[d({transform:"translateY(30px)",opacity:0}),u("200ms ease-out",d({transform:"translateY(0)",opacity:1}))]),f(":leave",[u("200ms ease-in",d({transform:"translateY(30px)",opacity:0}))])]),Yt=_("listAnimation",[f("* => *",[le(":enter",[d({opacity:0,transform:"translateY(10px)"}),ce(80,[u("300ms ease-out",d({opacity:1,transform:"translateY(0)"}))])],{optional:!0})])]),Xt=_("notification",[f(":enter",[d({opacity:0,transform:"translateY(-20px)"}),u("300ms ease-out",d({opacity:1,transform:"translateY(0)"}))]),f(":leave",[u("300ms ease-in",d({opacity:0,transform:"translateY(-20px)"}))])]),Zt=_("expandCard",[F("collapsed",d({height:"60px",overflow:"hidden"})),F("expanded",d({height:"*",overflow:"hidden"})),f("collapsed <=> expanded",[u("200ms cubic-bezier(0.4, 0.0, 0.2, 1)")])]),qt=_("rotate",[F("default",d({transform:"rotate(0)"})),F("rotated",d({transform:"rotate(180deg)"})),f("default <=> rotated",[u("200ms ease-out")])]),Kt={pageEnter:_("pageEnter",[f(":enter",[le(".page-element",[d({opacity:0,transform:"translateY(20px)"}),ce(60,[u("400ms ease-out",d({opacity:1,transform:"translateY(0)"}))])],{optional:!0})])]),pageLeave:_("pageLeave",[f(":leave",[d({opacity:1}),u("300ms ease-in",d({opacity:0}))])])};function Ze(r,e){if(r&1&&(o(0,"div",8),c(1),a()),r&2){let t=p();s(),w(t.title)}}function qe(r,e){if(r&1&&(o(0,"div",9),c(1),a()),r&2){let t=p();s(),w(t.details)}}function Ke(r,e){if(r&1){let t=k();o(0,"button",10),D("click",function(){M(t);let n=p();return T(n.onRetry())}),o(1,"mat-icon"),c(2,"refresh"),a(),c(3),a()}if(r&2){let t=p();s(3),A(" ",t.retryLabel," ")}}function Je(r,e){if(r&1){let t=k();o(0,"button",11),D("click",function(){M(t);let n=p();return T(n.onClose())}),o(1,"mat-icon"),c(2,"close"),a(),c(3),a()}if(r&2){let t=p();s(3),A(" ",t.closeLabel," ")}}function Qe(r,e){if(r&1){let t=k();o(0,"button",11),D("click",function(){M(t);let n=p();return T(n.toggleDetails())}),o(1,"mat-icon"),c(2),a(),c(3),a()}if(r&2){let t=p();s(2),w(t.showDetails?"keyboard_arrow_up":"keyboard_arrow_down"),s(),A(" ",t.showDetails?"Ocultar detalles":"Mostrar detalles"," ")}}var ie=class r{severity="critical";title="";message="Ha ocurrido un error";details="";code="";retryVisible=!0;closeVisible=!0;retryLabel="Reintentar";closeLabel="Cerrar";retry=new S;close=new S;showDetails=!1;getIcon(){switch(this.severity){case"critical":return"error_outline";case"warning":return"warning_amber";case"info":return"info";default:return"error_outline"}}onRetry(){this.retry.emit()}onClose(){this.close.emit()}toggleDetails(){this.showDetails=!this.showDetails}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=$({type:r,selectors:[["app-error-display"]],inputs:{severity:"severity",title:"title",message:"message",details:"details",code:"code",retryVisible:"retryVisible",closeVisible:"closeVisible",retryLabel:"retryLabel",closeLabel:"closeLabel"},outputs:{retry:"retry",close:"close"},decls:12,vars:8,consts:[[1,"error-container",3,"ngClass"],[1,"error-content"],["class","error-title",4,"ngIf"],[1,"error-message"],["class","error-details",4,"ngIf"],[1,"error-actions"],["mat-button","","color","primary",3,"click",4,"ngIf"],["mat-button","",3,"click",4,"ngIf"],[1,"error-title"],[1,"error-details"],["mat-button","","color","primary",3,"click"],["mat-button","",3,"click"]],template:function(t,i){t&1&&(o(0,"div",0)(1,"mat-icon"),c(2),a(),o(3,"div",1),v(4,Ze,2,1,"div",2),o(5,"div",3),c(6),a(),v(7,qe,2,1,"div",4),o(8,"div",5),v(9,Ke,4,1,"button",6)(10,Je,4,1,"button",7)(11,Qe,4,2,"button",7),a()()()),t&2&&(m("ngClass",i.severity),s(2),w(i.getIcon()),s(2),m("ngIf",i.title),s(2),w(i.message),s(),m("ngIf",i.details&&i.showDetails),s(2),m("ngIf",i.retryVisible),s(),m("ngIf",i.closeVisible),s(),m("ngIf",i.details))},dependencies:[X,G,Y,q,Z,K,De,Re],styles:[".error-container[_ngcontent-%COMP%]{display:flex;padding:16px;margin:8px 0;border-radius:4px;align-items:flex-start}.error-container.critical[_ngcontent-%COMP%]{background-color:#ffebee;border-left:4px solid #f44336}.error-container.warning[_ngcontent-%COMP%]{background-color:#fff8e1;border-left:4px solid #ffc107}.error-container.info[_ngcontent-%COMP%]{background-color:#e3f2fd;border-left:4px solid #2196f3}.error-container[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:16px}.error-container.critical[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#f44336}.error-container.warning[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#ffc107}.error-container.info[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#2196f3}.error-content[_ngcontent-%COMP%]{flex-grow:1}.error-title[_ngcontent-%COMP%]{font-weight:500;font-size:16px;margin-bottom:4px}.error-message[_ngcontent-%COMP%]{margin-bottom:8px}.error-details[_ngcontent-%COMP%]{background-color:#00000008;padding:8px;border-radius:4px;margin-bottom:8px;font-family:monospace;white-space:pre-wrap;font-size:12px;max-height:200px;overflow-y:auto}.error-actions[_ngcontent-%COMP%]{display:flex;gap:8px;margin-top:8px}"]})};function et(r,e){if(r&1){let t=k();o(0,"button",8),D("click",function(){M(t);let n=p(2);return T(n.toggleCollapse())}),o(1,"mat-icon"),c(2),L(3,"async"),a()()}if(r&2){let t,i=p(2);s(2),w((t=U(3,1,i.widgetState$))!=null&&t.isCollapsed?"expand_more":"expand_less")}}function tt(r,e){if(r&1){let t=k();o(0,"button",9),D("click",function(){M(t);let n=p(2);return T(n.closeWidget())}),o(1,"mat-icon"),c(2,"close"),a()()}}function it(r,e){r&1&&(o(0,"div",13),B(1,"mat-spinner",14),a())}function nt(r,e){if(r&1){let t=k();o(0,"app-error-display",29),L(1,"async"),D("retry",function(){M(t);let n=p(4);return T(n.refreshData())}),a()}if(r&2){let t,i=p(4);m("message",((t=U(1,2,i.widgetState$))==null||t.errorInfo==null?null:t.errorInfo.message)||"Error desconocido")("title","Error en Salud de Red")}}function rt(r,e){if(r&1&&B(0,"div",30),r&2){let t=e.$implicit,i=p(4);Ce("background-color",t.color)("width",i.calculateStatusCircleSize(t.count),"px")("height",i.calculateStatusCircleSize(t.count),"px"),m("matTooltip",t.label+": "+t.count)}}function at(r,e){if(r&1&&(o(0,"span",35),c(1),a()),r&2){let t=p(5);s(),oe(" ",t.elementStats.warning," alerta",t.elementStats.warning!==1?"s":""," ")}}function ot(r,e){if(r&1&&(o(0,"span",36),c(1),a()),r&2){let t=p(5);s(),oe(" ",t.elementStats.error," error",t.elementStats.error!==1?"es":""," ")}}function st(r,e){if(r&1&&(o(0,"div",31)(1,"span",32),c(2),a(),v(3,at,2,2,"span",33)(4,ot,2,2,"span",34),a()),r&2){let t=p(4);s(2),A("",t.elementStats.active," activos"),s(),m("ngIf",t.elementStats.warning>0),s(),m("ngIf",t.elementStats.error>0)}}function lt(r,e){if(r&1&&(o(0,"div",40)(1,"mat-icon",41),c(2),a(),o(3,"div",42)(4,"div",43),c(5),a(),o(6,"div",44),c(7),a()(),o(8,"mat-icon",45),c(9),a()()),r&2){let t=e.$implicit,i=p(5);m("ngClass",i.getStatusClass(t.status)),s(2),w(i.getElementTypeIcon(t.type)),s(3),w(t.name),s(2),w(i.getStatusLabel(t.status)),s(2),w(i.getStatusIcon(t.status))}}function ct(r,e){if(r&1&&(o(0,"div",37)(1,"h4"),c(2,"Elementos cr\xEDticos"),a(),o(3,"div",38),v(4,lt,10,5,"div",39),a()()),r&2){let t=p(4);s(4),m("ngForOf",t.criticalElements)}}function dt(r,e){if(r&1&&(o(0,"div",46)(1,"mat-icon"),c(2,"update"),a(),c(3),a()),r&2){let t=p(4);s(3),A(" Actualizado: ",t.formatTime(t.networkMetrics==null?null:t.networkMetrics.lastUpdated)," ")}}function mt(r,e){if(r&1&&(o(0,"div",15),v(1,nt,2,4,"app-error-display",16),L(2,"async"),o(3,"div",17)(4,"div",18),c(5),a(),o(6,"div",19),c(7,"Salud General"),a()(),o(8,"div",20),v(9,rt,1,7,"div",21),a(),o(10,"div",22)(11,"div",23)(12,"div",24),c(13),a(),o(14,"div",25),c(15,"Elementos"),a(),v(16,st,5,3,"div",26),a(),o(17,"div",23)(18,"div",24),c(19),a(),o(20,"div",25),c(21,"Conexiones"),a()(),o(22,"div",23)(23,"div",24),c(24),a(),o(25,"div",25),c(26,"Utilizaci\xF3n"),a()()(),B(27,"mat-divider"),v(28,ct,5,1,"div",27)(29,dt,4,1,"div",28),a()),r&2){let t,i=p(3);s(),m("ngIf",(t=U(2,10,i.widgetState$))==null?null:t.hasError),s(3),m("ngClass",i.getHealthColor((i.networkMetrics==null?null:i.networkMetrics.health)||0)),s(),A(" ",(i.networkMetrics==null?null:i.networkMetrics.health)||0,"% "),s(4),m("ngForOf",i.statusDistribution),s(4),w(i.elementStats.total||0),s(3),m("ngIf",i.elementStats),s(3),w((i.networkMetrics==null?null:i.networkMetrics.connectionCount)||0),s(5),A("",(i.networkMetrics==null?null:i.networkMetrics.utilization)||0,"%"),s(4),m("ngIf",i.criticalElements.length>0),s(),m("ngIf",i.networkMetrics==null?null:i.networkMetrics.lastUpdated)}}function gt(r,e){if(r&1&&(o(0,"div",10),v(1,it,2,0,"div",11)(2,mt,30,12,"div",12),a()),r&2){let t=p(2);m("@slideInUp",void 0),s(),m("ngIf",t.isLoading),s(),m("ngIf",!t.isLoading)}}function pt(r,e){if(r&1){let t=k();o(0,"div",1)(1,"div",2)(2,"h3")(3,"mat-icon"),c(4,"health_and_safety"),a(),o(5,"span"),c(6),a()(),o(7,"div",3)(8,"button",4),D("click",function(){M(t);let n=p();return T(n.refreshData())}),o(9,"mat-icon"),c(10,"refresh"),a()(),v(11,et,4,3,"button",5)(12,tt,3,0,"button",6),a()(),v(13,gt,3,3,"div",7),L(14,"async"),a()}if(r&2){let t,i=p();s(6),w(i.title),s(5),m("ngIf",i.collapsible),s(),m("ngIf",i.closable),s(),m("ngIf",!((t=U(14,4,i.widgetState$))!=null&&t.isCollapsed))}}var Ve=class r extends ee{elementStats={total:0,active:0,warning:0,error:0,maintenance:0,inactive:0};widgetAction=new S;widgetError=new S;widgetUpdate=new S;networkMetrics=null;statusDistribution=[];criticalElements=[];isLoading=!1;monitoringService=C(te);elementService=C(ze);logger=C(H);constructor(){super(),this.widgetId="network-health-widget",this.title="Salud de la Red",this.position="top-left"}ngOnInit(){super.ngOnInit(),this.loadData()}ngOnChanges(e){e.elementStats&&this.elementStats&&this.updateStatusDistribution()}loadData(){this.isLoading=!0,this.monitoringService.getMetrics().pipe(de(this.destroyRef),V(e=>(this.handleError("loadMetrics",e),ae({elementCount:0,connectionCount:0,utilization:0,health:0,lastUpdated:new Date})))).subscribe({next:e=>{this.networkMetrics=b(x({},e),{lastUpdated:new Date}),this.loadElements()},error:e=>{this.handleError("loadMetrics",e),this.isLoading=!1}})}loadElements(){this.elementService.getAllElements().pipe(de(this.destroyRef),V(e=>(this.handleError("loadElements",e),ae([])))).subscribe({next:e=>{this.calculateElementStats(e),this.updateStatusDistribution(),this.findCriticalElements(e),this.isLoading=!1},error:e=>{this.handleError("loadElements",e),this.isLoading=!1}})}calculateElementStats(e){let t={total:e.length,active:0,warning:0,error:0,maintenance:0,inactive:0};e.forEach(i=>{switch(i.status){case"ACTIVE":t.active++;break;case"WARNING":t.warning++;break;case"FAULT":t.error++;break;case"MAINTENANCE":t.maintenance++;break;case"INACTIVE":case"PLANNED":case"UNKNOWN":t.inactive++;break}}),this.elementStats=t}updateStatusDistribution(){this.statusDistribution=[{status:"ACTIVE",label:"Activos",count:this.elementStats.active,color:"#4caf50"},{status:"WARNING",label:"Advertencia",count:this.elementStats.warning,color:"#ff9800"},{status:"FAULT",label:"Fallo",count:this.elementStats.error,color:"#f44336"},{status:"MAINTENANCE",label:"Mantenimiento",count:this.elementStats.maintenance,color:"#9c27b0"},{status:"INACTIVE",label:"Inactivos",count:this.elementStats.inactive,color:"#9e9e9e"}].filter(e=>e.count>0)}findCriticalElements(e){let t=["FAULT","WARNING"];this.criticalElements=e.filter(i=>{let n=i.status;return t.includes(n)}).sort((i,n)=>{let l={FAULT:0,WARNING:1},g=i.status,h=n.status;return l[g]-l[h]}).slice(0,5)}calculateStatusCircleSize(e){let n=this.elementStats.total||1,l=Math.min(1,e/n);return Math.max(12,Math.round(12+24*l))}getHealthColor(e){return e>=90?"excellent":e>=75?"good":e>=60?"fair":e>=40?"warning":"critical"}getStatusClass(e){switch(e){case"WARNING":return"status-warning";case"FAULT":return"status-fault";case"MAINTENANCE":return"status-maintenance";default:return""}}getElementTypeIcon(e){switch(e){case"OLT":return"router";case"ONT":return"devices";case"FDP":return"hub";case"SPLITTER":return"call_split";default:let t=e;return t==="EDFA"?"power":t==="MANGA"?"cable":"device_hub"}}getStatusIcon(e){switch(e){case"WARNING":return"warning";case"FAULT":return"error";case"MAINTENANCE":return"build";case"ACTIVE":return"check_circle";default:return"help"}}getStatusLabel(e){switch(e){case"ACTIVE":return"Activo";case"INACTIVE":return"Inactivo";case"WARNING":return"Advertencia";case"FAULT":return"Fallo";case"MAINTENANCE":return"Mantenimiento";case"PLANNED":return"Planificado";case"UNKNOWN":return"Desconocido";default:return e}}formatTime(e){return e?e.toLocaleTimeString():""}refreshData(){this.loadData()}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=$({type:r,selectors:[["app-network-health-widget"]],inputs:{elementStats:"elementStats"},outputs:{widgetAction:"widgetAction",widgetError:"widgetError",widgetUpdate:"widgetUpdate"},features:[ye,he],decls:2,vars:3,consts:[["class","widget-container network-health-widget",4,"ngIf"],[1,"widget-container","network-health-widget"],[1,"widget-header"],[1,"widget-controls"],["mat-icon-button","","matTooltip","Actualizar datos",3,"click"],["mat-icon-button","","matTooltip","Colapsar",3,"click",4,"ngIf"],["mat-icon-button","","matTooltip","Cerrar",3,"click",4,"ngIf"],["class","widget-content",4,"ngIf"],["mat-icon-button","","matTooltip","Colapsar",3,"click"],["mat-icon-button","","matTooltip","Cerrar",3,"click"],[1,"widget-content"],["class","loading-container",4,"ngIf"],["class","health-stats-container",4,"ngIf"],[1,"loading-container"],["diameter","30"],[1,"health-stats-container"],[3,"message","title","retry",4,"ngIf"],[1,"health-primary"],[1,"health-indicator",3,"ngClass"],[1,"health-label"],[1,"status-summary"],["class","status-circle",3,"background-color","width","height","matTooltip",4,"ngFor","ngForOf"],[1,"secondary-stats"],[1,"stat-item"],[1,"stat-value"],[1,"stat-label"],["class","stat-breakdown",4,"ngIf"],["class","critical-elements",4,"ngIf"],["class","last-updated",4,"ngIf"],[3,"retry","message","title"],[1,"status-circle",3,"matTooltip"],[1,"stat-breakdown"],[1,"active-count"],["class","warning-count",4,"ngIf"],["class","error-count",4,"ngIf"],[1,"warning-count"],[1,"error-count"],[1,"critical-elements"],[1,"critical-list"],["class","critical-item",3,"ngClass",4,"ngFor","ngForOf"],[1,"critical-item",3,"ngClass"],[1,"element-type-icon"],[1,"element-details"],[1,"element-name"],[1,"element-status"],[1,"status-icon"],[1,"last-updated"]],template:function(t,i){if(t&1&&(v(0,pt,15,6,"div",0),L(1,"async")),t&2){let n;m("ngIf",(n=U(1,1,i.widgetState$))==null?null:n.isVisible)}},dependencies:[X,G,Se,Y,Ee,q,Z,K,ke,Oe,Ae,Te,Me,Ne,We,Pe,ie],styles:[".network-health-widget[_ngcontent-%COMP%]{min-width:280px;max-width:350px}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:200px}.health-stats-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.health-primary[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;text-align:center;padding:16px 0}.health-indicator[_ngcontent-%COMP%]{font-size:32px;font-weight:700;border-radius:50%;width:90px;height:90px;display:flex;justify-content:center;align-items:center;margin-bottom:12px;color:#fff}.health-indicator.excellent[_ngcontent-%COMP%]{background-color:#4caf50}.health-indicator.good[_ngcontent-%COMP%]{background-color:#8bc34a}.health-indicator.fair[_ngcontent-%COMP%]{background-color:#ffc107}.health-indicator.warning[_ngcontent-%COMP%]{background-color:#ff9800}.health-indicator.critical[_ngcontent-%COMP%]{background-color:#f44336}.health-label[_ngcontent-%COMP%]{font-size:14px;font-weight:500;color:#0009}.status-summary[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:8px;flex-wrap:wrap;padding:8px}.status-circle[_ngcontent-%COMP%]{border-radius:50%;min-width:12px;min-height:12px}.secondary-stats[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}.stat-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;text-align:center;padding:12px 4px;border-radius:4px;background-color:#00000008}.stat-value[_ngcontent-%COMP%]{font-size:20px;font-weight:700;color:#2196f3}.stat-label[_ngcontent-%COMP%]{font-size:12px;color:#0009;margin-top:4px}.stat-breakdown[_ngcontent-%COMP%]{font-size:10px;display:flex;flex-wrap:wrap;justify-content:center;gap:4px;margin-top:4px}.active-count[_ngcontent-%COMP%]{color:#4caf50}.warning-count[_ngcontent-%COMP%]{color:#ff9800}.error-count[_ngcontent-%COMP%]{color:#f44336}.critical-elements[_ngcontent-%COMP%]{margin-top:12px}.critical-elements[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:14px;font-weight:500;margin:0 0 8px;color:#000000b3}.critical-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;max-height:180px;overflow-y:auto}.critical-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:8px;border-radius:4px;background-color:#00000008}.critical-item.status-fault[_ngcontent-%COMP%]{border-left:3px solid #f44336;background-color:#f443360d}.critical-item.status-warning[_ngcontent-%COMP%]{border-left:3px solid #ff9800;background-color:#ff98000d}.critical-item.status-critical[_ngcontent-%COMP%]{border-left:3px solid #f44336;background-color:#f443360d}.element-type-icon[_ngcontent-%COMP%]{margin-right:8px;font-size:20px}.element-details[_ngcontent-%COMP%]{flex:1}.element-name[_ngcontent-%COMP%]{font-size:12px;font-weight:500}.element-status[_ngcontent-%COMP%]{font-size:11px;color:#0009}.status-icon[_ngcontent-%COMP%]{font-size:18px}.status-fault[_ngcontent-%COMP%]   .status-icon[_ngcontent-%COMP%]{color:#f44336}.status-warning[_ngcontent-%COMP%]   .status-icon[_ngcontent-%COMP%]{color:#ff9800}.status-critical[_ngcontent-%COMP%]   .status-icon[_ngcontent-%COMP%]{color:#f44336}.last-updated[_ngcontent-%COMP%]{display:flex;align-items:center;font-size:11px;color:#00000080;margin-top:12px}.last-updated[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:14px;height:14px;width:14px;margin-right:4px}"],data:{animation:[Ue,He]}})};export{Ve as NetworkHealthWidgetComponent};
