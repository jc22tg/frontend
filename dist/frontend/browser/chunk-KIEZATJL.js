import{a as i,b as h,h as P,i as R}from"./chunk-VONGITAP.js";import{a as M}from"./chunk-QQ6SKILC.js";import{a as b}from"./chunk-4RASZFGW.js";import{$ as D,F as S,M as L,fa as f,g as A,id as N,ja as C,n as m,o as I,oa as y,s as v}from"./chunk-FG6FKNI4.js";import{a as u,b as p}from"./chunk-OXVY4BEJ.js";function l(s,T,e){return{type:"Point",coordinates:[T,s],altitude:e,lat:s,lng:T}}function H(s,T={}){let[e,t]=s;if(isNaN(e)||isNaN(t))throw new Error("Las coordenadas deben ser valores num\xE9ricos");if(e<-180||e>180)throw new Error("La longitud debe estar entre -180 y 180");if(t<-90||t>90)throw new Error("La latitud debe estar entre -90 y 90");return l(t,e,T.altitude)}var E={api:{baseUrl:"/api/v1",timeout:3e4,retryAttempts:3,backendUrl:"http://localhost:3000/api",maxPageSize:100,defaultPageSize:20},map:{initialZoom:6,maxZoom:18,minZoom:4,defaultCenter:[0,0],tileLayers:{default:{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'},satellite:{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"},dark:{url:"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'}},gridSize:100,clusteringThreshold:20,elementIcons:{size:{default:32,small:24,large:48},scaleFactor:1.2},debug:!1,loadTimeout:1e4,renderLimitPerFrame:50},cache:{defaultExpiryTime:3e5,storagePrefix:"network-app-",maxLocalStorageSize:5242880,localStorageKeys:{user:"user",theme:"theme",elements:"elements",elementTypes:"element-types",mapState:"map-state",mapPosition:"map-position",lastProject:"last-project"}},ui:{snackbarDuration:3e3,confirmDialogWidth:"400px",tooltipDelay:500,animations:{enabled:!0,duration:{short:200,medium:300,long:500}},debounceTime:300,themeModes:{light:"light-theme",dark:"dark-theme"},defaultLanguage:"es",dateFormat:"dd/MM/yyyy",dateTimeFormat:"dd/MM/yyyy HH:mm"},features:{offlineMode:!0,mapLayerSettings:!0,elementHistory:!0,connections:!0,connectionTypes:!0,projects:!0,reports:!0,monitoring:!0,userManagement:!0,networkGraph:!0,batchOperations:!0,importExport:!0,diagnostics:!0},debugging:{logLevel:"info",enableDevTools:!0,componentBoundaries:!1,measurePerformance:!0,trackMemory:!1}};var x=(()=>{class s{constructor(e){this.logger=e,this.memoryCache=new Map}set(e,t,a){let r=Date.now(),o={data:t,timestamp:r};if(this.memoryCache.set(e,o),this.logger.debug(`[Cache] Guardado en memoria: ${e}`),a?.useLocalStorage)try{let n=a.storageKey||e,c=this.getPrefixedKey(n);localStorage.setItem(c,JSON.stringify(o)),this.logger.debug(`[Cache] Guardado en localStorage: ${c}`)}catch(n){this.logger.error("[Cache] Error al guardar en localStorage",n)}}get(e,t){let a=t?.expiryTime||E.cache.defaultExpiryTime,r=Date.now(),o=this.memoryCache.get(e);if(o){if(r-o.timestamp<a)return this.logger.debug(`[Cache] Obtenido de memoria: ${e}`),o.data;this.logger.debug(`[Cache] Expirado en memoria: ${e}`),this.memoryCache.delete(e)}if(t?.useLocalStorage)try{let n=t.storageKey||e,c=this.getPrefixedKey(n),d=localStorage.getItem(c);if(d){let g=JSON.parse(d);if(r-g.timestamp<a)return this.memoryCache.set(e,g),this.logger.debug(`[Cache] Obtenido de localStorage: ${c}`),g.data;this.logger.debug(`[Cache] Expirado en localStorage: ${c}`),localStorage.removeItem(c)}}catch(n){this.logger.error("[Cache] Error al leer de localStorage",n)}return null}has(e,t){let a=t?.expiryTime||E.cache.defaultExpiryTime,r=Date.now(),o=this.memoryCache.get(e);if(o&&r-o.timestamp<a)return!0;if(t?.useLocalStorage)try{let n=t.storageKey||e,c=this.getPrefixedKey(n),d=localStorage.getItem(c);if(d){let g=JSON.parse(d);return r-g.timestamp<a}}catch(n){this.logger.error("[Cache] Error al verificar existencia en localStorage",n)}return!1}remove(e,t){if(this.memoryCache.delete(e),this.logger.debug(`[Cache] Eliminado de memoria: ${e}`),t?.useLocalStorage)try{let a=t.storageKey||e,r=this.getPrefixedKey(a);localStorage.removeItem(r),this.logger.debug(`[Cache] Eliminado de localStorage: ${r}`)}catch(a){this.logger.error("[Cache] Error al eliminar de localStorage",a)}}clear(e){if(this.memoryCache.clear(),this.logger.debug("[Cache] Memoria limpiada"),!e?.preserveLocalStorage)try{let t=[],a=E.cache.storagePrefix;for(let r=0;r<localStorage.length;r++){let o=localStorage.key(r);o&&o.startsWith(a)&&t.push(o)}t.forEach(r=>localStorage.removeItem(r)),this.logger.debug(`[Cache] LocalStorage limpiado: ${t.length} elementos`)}catch(t){this.logger.error("[Cache] Error al limpiar localStorage",t)}}cleanExpired(e){let t=e||E.cache.defaultExpiryTime,a=Date.now();for(let[r,o]of this.memoryCache.entries())a-o.timestamp>=t&&(this.memoryCache.delete(r),this.logger.debug(`[Cache] Eliminada entrada expirada: ${r}`));try{let r=E.cache.storagePrefix,o=[];for(let n=0;n<localStorage.length;n++){let c=localStorage.key(n);if(c&&c.startsWith(r))try{let d=localStorage.getItem(c);if(d){let g=JSON.parse(d);a-g.timestamp>=t&&o.push(c)}}catch{o.push(c)}}o.forEach(n=>localStorage.removeItem(n)),this.logger.debug(`[Cache] Limpiadas entradas expiradas de localStorage: ${o.length}`)}catch(r){this.logger.error("[Cache] Error al limpiar entradas expiradas",r)}}getPrefixedKey(e){return`${E.cache.storagePrefix}${e}`}static{this.\u0275fac=function(t){return new(t||s)(y(M))}}static{this.\u0275prov=C({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();var O=(()=>{class s{formatFileSize(e){if(e===0)return"0 Bytes";let t=1024,a=["Bytes","KB","MB","GB","TB"],r=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,r)).toFixed(2))+" "+a[r]}calculateDistance(e,t,a,r){let n=this.deg2rad(a-e),c=this.deg2rad(r-t),d=Math.sin(n/2)*Math.sin(n/2)+Math.cos(this.deg2rad(e))*Math.cos(this.deg2rad(a))*Math.sin(c/2)*Math.sin(c/2);return 6371*(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)))}deg2rad(e){return e*(Math.PI/180)}validateCoordinates(e,t){return e>=-90&&e<=90&&t>=-180&&t<=180}generateUniqueId(e="id"){return`${e}-${Date.now()}-${Math.floor(Math.random()*1e4)}`}truncateText(e,t=100){return e?e.length>t?`${e.substring(0,t)}...`:e:""}formatDate(e){return e?(typeof e=="object"?e:new Date(e)).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}):""}formatDateTime(e){return e?(typeof e=="object"?e:new Date(e)).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):""}getRandomColor(){return`#${Math.floor(Math.random()*16777215).toString(16).padStart(6,"0")}`}isEmptyObject(e){return e&&Object.keys(e).length===0&&e.constructor===Object}deepCopy(e){return JSON.parse(JSON.stringify(e))}objectToQueryParams(e){return Object.keys(e).filter(t=>e[t]!==void 0&&e[t]!==null).map(t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`).join("&")}pickProperties(e,t){return t.reduce((a,r)=>(r in e&&(a[r]=e[r]),a),{})}formatWithUnit(e,t,a=2){return`${e.toFixed(a)} ${t}`}static{this.\u0275fac=function(t){return new(t||s)}}static{this.\u0275prov=C({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();var te=(()=>{class s{constructor(e,t,a,r){this.http=e,this.loggerService=t,this.cacheService=a,this.utilsService=r,this.apiUrl=`${b.apiUrl}/elements`,this.ELEMENTS_CACHE_KEY="network-elements",this.elementsChangedSubject=new A(!1),this.elementsChanged$=this.elementsChangedSubject.asObservable(),this.handleError=o=>{let n="Error desconocido";return o.error instanceof ErrorEvent?n=`Error: ${o.error.message}`:n=`C\xF3digo: ${o.status}, Mensaje: ${o.message}`,this.loggerService.error(n,o),I(()=>new Error(n))}}getAllElements(){try{return b.featureFlags.enableMockData?(this.loggerService.info("Usando datos mock para elementos de red"),m(this.getMockElements()).pipe(L(500),f(e=>{this.loggerService.debug("Elementos mock cargados:",e.length),this.cacheService.set(this.ELEMENTS_CACHE_KEY,e,{useLocalStorage:!0}),this.notifyElementsChanged()}))):this.http.get(this.apiUrl).pipe(f(e=>{this.loggerService.debug("Elementos obtenidos:",e?.length),this.cacheService.set(this.ELEMENTS_CACHE_KEY,e,{useLocalStorage:!0})}),S(e=>{this.loggerService.error("Error al obtener elementos:",e);let t=this.cacheService.get(this.ELEMENTS_CACHE_KEY,{useLocalStorage:!0});return t&&t.length>0?(this.loggerService.info("Usando elementos en cach\xE9:",t.length),m(t)):(this.loggerService.info("Sin cach\xE9 disponible, usando elementos mock"),m(this.getMockElements()).pipe(L(500)))}),D(1))}catch(e){return this.loggerService.error("Error inesperado en getAllElements:",e),m(this.getMockElements())}}getElementById(e){let t=`element-${e}`,a=this.cacheService.get(t);return a?m(a):this.http.get(`${this.apiUrl}/${e}`).pipe(f(r=>{this.cacheService.set(t,r,{useLocalStorage:!0})}),S(this.handleError))}createElement(e){if(b.featureFlags.enableMockData||b.useMocks){this.loggerService.info("Usando datos mock para crear elemento");let t=p(u({},e),{id:e.id||this.generateTemporaryId(),createdAt:new Date,updatedAt:new Date}),a=`element-${t.id}`;this.cacheService.set(a,t,{useLocalStorage:!0});let r=this.cacheService.get(this.ELEMENTS_CACHE_KEY,{useLocalStorage:!0})||[];return r.push(t),this.cacheService.set(this.ELEMENTS_CACHE_KEY,r,{useLocalStorage:!0}),this.notifyElementsChanged(),m(t).pipe(L(500))}return this.http.post(this.apiUrl,e).pipe(f(t=>{if(t.id){let a=`element-${t.id}`;this.cacheService.set(a,t,{useLocalStorage:!0}),this.invalidateElementsCache(),this.notifyElementsChanged()}}),S(this.handleError))}updateElement(e,t){return this.http.put(`${this.apiUrl}/${e}`,t).pipe(f(a=>{let r=`element-${e}`;this.cacheService.set(r,a,{useLocalStorage:!0}),this.invalidateElementsCache(),this.notifyElementsChanged()}),S(this.handleError))}deleteElement(e){return this.http.delete(`${this.apiUrl}/${e}`).pipe(f(()=>{let t=`element-${e}`;this.cacheService.remove(t,{useLocalStorage:!0}),this.invalidateElementsCache(),this.notifyElementsChanged()}),S(this.handleError))}getElementTypeName(e){return i[e]||"Desconocido"}getElementStatusClass(e){return h[e]||""}getElementProperty(e,t){return e[t]}isOLT(e){if(e.type!==i.OLT)return!1;let t=e;return typeof t.manufacturer=="string"&&typeof t.model=="string"&&typeof t.portCount=="number"&&typeof t.ponPorts=="number"}isONT(e){if(e.type!==i.ONT)return!1;let t=e;return typeof t.manufacturer=="string"&&typeof t.model=="string"&&typeof t.serialNumber=="string"}isODF(e){if(e.type!==i.ODF)return!1;let t=e;return typeof t.manufacturer=="string"&&typeof t.model=="string"&&typeof t.totalPortCapacity=="number"&&typeof t.usedPorts=="number"}isEDFA(e){return e.type===i.EDFA}isSplitter(e){return e.type!==i.SPLITTER?!1:typeof e.splitRatio=="string"}isManga(e){if(e.type!==i.MANGA)return!1;let t=e;return typeof t.capacity=="number"&&typeof t.usedCapacity=="number"}isTerminalBox(e){if(e.type!==i.TERMINAL_BOX)return!1;let t=e;return typeof t.portCapacity=="number"&&typeof t.usedPorts=="number"}isFiberThread(e){return e.type!==i.FIBER_THREAD?!1:typeof e.length=="number"}isSlackFiber(e){return e.type===i.SLACK_FIBER}isRack(e){return e.type===i.RACK}formatFileSize(e){return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(2)} KB`:e<1024*1024*1024?`${(e/(1024*1024)).toFixed(2)} MB`:`${(e/(1024*1024*1024)).toFixed(2)} GB`}createDefaultElement(e){let t={id:this.generateTemporaryId(),name:`Nuevo ${this.getElementTypeName(e)}`,type:e,status:h.INACTIVE,position:l(0,0),description:"",createdAt:new Date,updatedAt:new Date};switch(e){case i.OLT:return p(u({},t),{type:i.OLT,manufacturer:"Proveedor Gen\xE9rico",model:"Modelo OLT Gen\xE9rico",portCount:16,ponPorts:4,serialNumber:`OLT-${Date.now().toString(36)}`,ipAddress:"192.168.1.100",macAddress:"00:11:22:33:44:55",firmwareVersion:"1.0.0"});case i.ONT:return p(u({},t),{type:i.ONT,manufacturer:"Proveedor Gen\xE9rico",model:"Modelo ONT Gen\xE9rico",serialNumber:`ONT-${Date.now().toString(36)}`,ipAddress:"192.168.1.200",macAddress:"00:11:22:33:44:66",installationDate:new Date,clientId:void 0});case i.ODF:return p(u({},t),{type:i.ODF,manufacturer:"Proveedor Gen\xE9rico",model:"Modelo ODF Gen\xE9rico",totalPortCapacity:48,usedPorts:0,installationDate:new Date});case i.SPLITTER:return p(u({},t),{type:i.SPLITTER,manufacturer:"Proveedor Gen\xE9rico",model:"Modelo Splitter Gen\xE9rico",splitRatio:"1:8",insertionLoss:10.5,serialNumber:`SPL-${Date.now().toString(36)}`,installationDate:new Date});case i.MANGA:return p(u({},t),{type:i.MANGA,manufacturer:"Proveedor Gen\xE9rico",model:"Modelo Manga Gen\xE9rico",serialNumber:`MNG-${Date.now().toString(36)}`,closureType:P.UNDERGROUND,maxCableEntries:24,maxSpliceCapacity:48,isAerial:!1,ipRating:"IP65",sealingType:R.MECHANICAL,hasSplitter:!1,usedSplices:0,usedCableEntries:0,installationDate:new Date});case i.TERMINAL_BOX:return p(u({},t),{type:i.TERMINAL_BOX,manufacturer:"Proveedor Gen\xE9rico",model:"Modelo Terminal Box Gen\xE9rico",portCapacity:12,usedPorts:0,mountingType:"wall",serialNumber:`TB-${Date.now().toString(36)}`,installationDate:new Date});case i.SLACK_FIBER:return p(u({},t),{type:i.SLACK_FIBER,length:30,fiberType:void 0});case i.FIBER_THREAD:return p(u({},t),{type:i.FIBER_THREAD,length:100,color:"Azul",coreNumber:1,cableId:`CBL-${Date.now().toString(36)}`,fiberType:void 0});case i.RACK:return p(u({},t),{type:i.RACK,manufacturer:"Fabricante Gen\xE9rico",model:"Modelo Rack Gen\xE9rico",serialNumber:`RACK-${Date.now().toString(36)}`,installationDate:new Date,heightUnits:42,width:600,depth:1e3,totalU:42,usedU:0,roomName:"Sala Principal"});default:return t}}generateTemporaryId(){return this.utilsService.generateUniqueId("temp-element")}validateElement(e){if(!e.name||e.name.trim()==="")return"El nombre del elemento es obligatorio";if(!e.type)return"El tipo de elemento es obligatorio";if(!e.position||typeof e.position.lat!="number"||typeof e.position.lng!="number")return"La posici\xF3n del elemento es obligatoria y debe tener coordenadas v\xE1lidas";switch(e.type){case i.OLT:if(!("portCount"in e)||e.portCount===void 0)return"El n\xFAmero de puertos es obligatorio para OLT";break;case i.ODF:if(!("totalPortCapacity"in e)||e.totalPortCapacity===void 0)return"La capacidad total de puertos es obligatoria para ODF";break;case i.SPLITTER:if(!("splitRatio"in e)||!e.splitRatio)return"La relaci\xF3n de divisi\xF3n es obligatoria para Splitter";break;case i.SLACK_FIBER:if(!("length"in e)||e.length===void 0)return"La longitud es obligatoria para Flojo de Fibra";break;case i.FIBER_THREAD:if(!("length"in e)||e.length===void 0)return"La longitud es obligatoria para Hilo de Fibra";break;case i.RACK:if(!("heightUnits"in e)||e.heightUnits===void 0)return"La altura (U) es obligatoria para Rack";if(!("width"in e)||e.width===void 0)return"El ancho es obligatorio para Rack";if(!("depth"in e)||e.depth===void 0)return"La profundidad es obligatoria para Rack";if(!("totalU"in e)||e.totalU===void 0)return"El total de unidades U es obligatorio para Rack";if(!("usedU"in e)||e.usedU===void 0)return"Las unidades U utilizadas son obligatorias para Rack";if(!("roomName"in e)||!e.roomName)return"El nombre de la sala es obligatorio para Rack";break}return!0}notifyElementsChanged(){this.elementsChangedSubject.next(!0)}invalidateElementsCache(){this.cacheService.remove(this.ELEMENTS_CACHE_KEY,{useLocalStorage:!0})}clearCache(){this.cacheService.remove(this.ELEMENTS_CACHE_KEY,{useLocalStorage:!0}),this.cacheService.cleanExpired(0),this.notifyElementsChanged()}invalidateCacheEntry(e){let t=`element-${e}`;this.cacheService.remove(t,{useLocalStorage:!0})}getMockElements(){return[{id:"olt-001",name:"OLT Central Norte",type:i.OLT,status:h.ACTIVE,position:l(18.4821,-69.9312),description:"OLT principal del sector norte"},{id:"odf-001",name:"ODF Zona Norte 1",type:i.ODF,status:h.ACTIVE,position:l(18.4835,-69.9287),description:"Distribuidor de fibra \xF3ptica para la zona norte"},{id:"splitter-001",name:"Splitter 1:8 Zona Norte",type:i.SPLITTER,status:h.ACTIVE,position:l(18.4845,-69.9276),description:"Splitter principal para distribuci\xF3n residencial"},{id:"ont-001",name:"ONT Cliente Residencial",type:i.ONT,status:h.ACTIVE,position:l(18.4842,-69.9265),description:"ONT instalada en cliente residencial"},{id:"edfa-001",name:"Amplificador Troncal",type:i.EDFA,status:h.ACTIVE,position:l(18.4815,-69.934),description:"Amplificador para enlace de larga distancia"},{id:"manga-001",name:"Manga Av. Principal",type:i.MANGA,status:h.ACTIVE,position:l(18.4827,-69.9299),description:"Manga para empalmes de fibra en avenida principal"},{id:"slack-001",name:"Flojo de Fibra Principal",type:i.SLACK_FIBER,status:h.ACTIVE,position:l(18.485,-69.93),description:"Reserva de cable de fibra \xF3ptica",properties:{length:30}},{id:"fiber-001",name:"Hilo de Fibra Azul",type:i.FIBER_THREAD,status:h.ACTIVE,position:l(18.486,-69.931),description:"Hilo de fibra individual para pruebas",properties:{length:100,color:"Azul"}}]}getElementsByType(e){return this.getAllElements().pipe(v(t=>t.filter(a=>a.type===e)))}searchByTerm(e){return this.getAllElements().pipe(v(t=>{if(!e||e.trim()==="")return t;let a=e.toLowerCase().trim();return t.filter(r=>r.name?.toLowerCase().includes(a)||r.description?.toLowerCase().includes(a)||r.id&&r.id.toLowerCase().includes(a))}))}static{this.\u0275fac=function(t){return new(t||s)(y(N),y(M),y(x),y(O))}}static{this.\u0275prov=C({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();export{l as a,H as b,E as c,O as d,te as e};
