import{a as rt,b as Re}from"./chunk-6PYCTC3W.js";import{b as ti,c as zi,d as Vi,e as ji}from"./chunk-3DOLLXBG.js";import{a as ni,b as ri,c as oi,d as ai}from"./chunk-HOQN2RTO.js";import{a as li,b as ci}from"./chunk-YFTEGT7S.js";import{a as Si,b as Ei,c as Ti,d as ki,e as Ii,f as Oi,g as Ai,h as Di,i as Pi,j as Ni,k as Ri}from"./chunk-DIVOCDBU.js";import{a as nt,b as Bi}from"./chunk-ELOSELUF.js";import{m as Hi}from"./chunk-7JRIPI7N.js";import{B as $i,b as be,f as un,g as yt,h as Mt,i as wt,j as bt,k as Li,l as Fi}from"./chunk-CPM6WUWS.js";import{a as yi,b as Mi,c as wi,d as bi}from"./chunk-YKHY2KRM.js";import{a as xt}from"./chunk-PS45K6N5.js";import{a as Ct,b as hi,d as vi,f as Ci,g as xi}from"./chunk-JGNBERAY.js";import{a as _i}from"./chunk-Q2I2H6RZ.js";import{a as $,b as Z,f as de,g as W}from"./chunk-VONGITAP.js";import{a as ne,b as re,c as oe,e as gi,f as ae,h as L}from"./chunk-GQNYZBS2.js";import{a as di,b as _e}from"./chunk-F5P253LU.js";import{a as fi}from"./chunk-QQ6SKILC.js";import{a as fe,b as te}from"./chunk-D3FDFS7S.js";import{d as pi,j as ui}from"./chunk-RWQWO3EM.js";import{a as we}from"./chunk-4RASZFGW.js";import{A as mi}from"./chunk-JO2MD4NL.js";import{a as S,b as E,c as ii,i as ie,j as B,k as si,n as R}from"./chunk-XJSBNB6N.js";import{v as H,w as j}from"./chunk-VH7SA6GK.js";import{D as ei,H as qe,k as Kt,m as Xt,p as Jt}from"./chunk-4PHUDKEH.js";import{d as Zt,e as Ne,i as he}from"./chunk-D4QL4JVC.js";import{$ as Rt,$a as s,$b as g,$c as w,A as je,Aa as v,B as Ot,Ba as Bt,C as At,Cb as Ut,F as Be,Gb as n,Hb as o,Ib as C,Ja as z,Jb as We,K as Dt,Ka as Ht,Kb as Ge,Lc as U,M as K,Mb as V,Mc as Y,Na as Xe,Nc as N,O as Pt,Ob as u,Pa as Wt,Pb as p,Q as Nt,Qb as ut,Rb as gt,Ta as Gt,Tc as tt,Ub as Ue,Vb as Oe,Vc as Pe,Wb as Ae,Y as He,Yc as Qt,Zb as J,_b as a,a as Te,ac as b,ba as Lt,bc as ht,ca as Ft,cc as ft,db as k,dc as _t,ec as vt,f as mt,fa as Ie,g as G,h as It,hc as De,ic as Me,id as it,ja as X,ka as Ke,kb as M,kc as Yt,lb as Je,ma as $t,mb as pt,mc as O,n as x,nc as ce,o as ke,oa as ue,oc as ee,pa as Q,qb as f,ra as zt,s as le,sa as Vt,vc as qt,wb as et,xb as c,xc as Ye,ya as jt,yb as ge,za as _,zb as I}from"./chunk-FG6FKNI4.js";import{a as xe,b as ye,f as pn}from"./chunk-OXVY4BEJ.js";var Wi=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=Je({type:t});static \u0275inj=Ke({imports:[xt,qe,xt,qe]})}return t})();var ot=(()=>{class t{constructor(e){this.http=e,this.apiUrl=`${we.apiUrl}/monitoring`,this.retryConfig={maxRetries:2,delayMs:1e3,excludeStatusCodes:[400,401,403,404]}}getNetworkHealth(){return this.http.get(`${this.apiUrl}/health`).pipe(He({count:this.retryConfig.maxRetries,delay:(e,i)=>{if(e?.status&&this.retryConfig.excludeStatusCodes.includes(e.status))return ke(()=>e);console.log(`Reintentando petici\xF3n getNetworkHealth... (intento ${i} de ${this.retryConfig.maxRetries})`);let r=this.retryConfig.delayMs*Math.pow(2,i);return je(r)}}),Be(e=>(console.error("Error obteniendo salud de la red",e),x({healthPercentage:85,activeElementsCount:42,warningElementsCount:5,criticalElementsCount:2,timestamp:new Date().toISOString()}))))}getElementMetrics(e,i,r=10){let l={metricType:i,limit:r.toString()};return this.http.get(`${this.apiUrl}/elements/${e}/metrics`,{params:l}).pipe(He({count:this.retryConfig.maxRetries,delay:(d,h)=>{if(d?.status&&this.retryConfig.excludeStatusCodes.includes(d.status))return ke(()=>d);console.log(`Reintentando petici\xF3n getElementMetrics for ${e}... (intento ${h} de ${this.retryConfig.maxRetries})`);let P=this.retryConfig.delayMs*Math.pow(2,h);return je(P)}}),Be(d=>(console.error(`Error obteniendo m\xE9tricas para el elemento ${e}`,d),x([]))))}getNetworkMetrics(e,i="day"){if(we.useMocks)return console.info(`[NetworkMonitoringService] Usando datos simulados para ${e}`),x(this.generateMockNetworkMetrics(e));let r={metricType:e,period:i};return this.http.get(`${this.apiUrl}/metrics`,{params:r}).pipe(He({count:this.retryConfig.maxRetries,delay:(l,d)=>{if(l?.status&&this.retryConfig.excludeStatusCodes.includes(l.status))return ke(()=>l);console.log(`Reintentando petici\xF3n getNetworkMetrics for ${e}... (intento ${d} de ${this.retryConfig.maxRetries})`);let h=this.retryConfig.delayMs*Math.pow(2,d);return je(h)}}),le(l=>!l||!l.metrics&&!Array.isArray(l.bandwidth)?(console.warn("Formato de respuesta inesperado:",l),{metrics:[],lastUpdated:new Date}):l.metrics?l:{metrics:l[e]||[],lastUpdated:l.lastUpdated||new Date}),Be(l=>(console.error("Error obteniendo m\xE9tricas de red",l),l.error instanceof SyntaxError&&l.error.message.includes("Unexpected token")&&console.warn("La API est\xE1 retornando HTML en lugar de JSON. Verificar el estado del servidor."),we.useMocks?(console.info("[NetworkMonitoringService] Usando datos simulados despu\xE9s de error en API"),x(this.generateMockNetworkMetrics(e))):x({metrics:[],lastUpdated:new Date}))))}generateMockNetworkMetrics(e){let i=new Date,r=[];for(let l=0;l<24;l++){let d=new Date(i);d.setHours(i.getHours()-(24-l));let h,P=l<12?"down":"up",Ce=Math.random()>.7?P==="up"?"down":"up":P;switch(e){case"bandwidth":let pe=d.getHours(),Ee=pe>=9&&pe<=18,ze=Ee?350:150,ct=Ee?150:50;h=Math.floor(ze+Math.random()*ct);break;case"latency":let dt=10,Ze=40,Ve=Math.abs(12-d.getHours()%24)/12;h=dt+Ze*Ve*(.5+Math.random()*.5),h=parseFloat(h.toFixed(1));break;case"packetLoss":h=Math.random()>.9?parseFloat((.5+Math.random()*1.5).toFixed(2)):parseFloat((Math.random()*.5).toFixed(2));break;case"errors":h=Math.random()>.85?Math.floor(Math.random()*10)+1:0;break;case"temperature":h=25+Math.random()*15,h=parseFloat(h.toFixed(1));break;default:h=Math.floor(Math.random()*100)}r.push({id:`mock-${e}-${l}`,timestamp:d.toISOString(),value:h,trend:Ce,elementId:"network"})}return{metrics:r,lastUpdated:i}}getConnectionsStatus(){return this.http.get(`${this.apiUrl}/connections`).pipe(He({count:this.retryConfig.maxRetries,delay:(e,i)=>{if(e?.status&&this.retryConfig.excludeStatusCodes.includes(e.status))return ke(()=>e);console.log(`Reintentando petici\xF3n getConnectionsStatus... (intento ${i} de ${this.retryConfig.maxRetries})`);let r=this.retryConfig.delayMs*Math.pow(2,i);return je(r)}}),Be(e=>(console.error("Error obteniendo estado de conexiones",e),we.useMocks?x(this.generateMockConnectionStatus()):ke(()=>e))))}generateMockConnectionStatus(){return{connections:Array(15).fill(0).map((i,r)=>{let l=["active","warning","error","inactive"],d=l[Math.floor(Math.random()*l.length)];return{id:`mock-connection-${r}`,sourceId:`source-${r}`,targetId:`target-${r}`,status:d,lastUpdated:new Date().toISOString(),metrics:{bandwidth:Math.floor(Math.random()*1e3),latency:Math.floor(Math.random()*50),packetLoss:parseFloat((Math.random()*2).toFixed(2))}}}),lastUpdated:new Date().toISOString()}}static{this.\u0275fac=function(i){return new(i||t)(ue(it))}}static{this.\u0275prov=X({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var Ui=(()=>{class t{constructor(e){this.networkMonitoringService=e,this.refreshInterval=6e4,this.networkHealth=0,this.networkHealthLabel="",this.networkHealthClass="",this.networkHealthColor="primary",this.activeCount=0,this.warningCount=0,this.criticalCount=0}ngOnInit(){this.refreshData()}refreshData(){this.networkMonitoringService.getNetworkHealth().subscribe(e=>{this.networkHealth=e.healthPercentage,this.activeCount=e.activeElementsCount,this.warningCount=e.warningElementsCount,this.criticalCount=e.criticalElementsCount,this.updateHealthStatus()})}updateHealthStatus(){this.networkHealth>=90?(this.networkHealthLabel="Buena",this.networkHealthClass="good",this.networkHealthColor="primary"):this.networkHealth>=70?(this.networkHealthLabel="Regular",this.networkHealthClass="warning",this.networkHealthColor="accent"):(this.networkHealthLabel="Cr\xEDtica",this.networkHealthClass="critical",this.networkHealthColor="warn")}static{this.\u0275fac=function(i){return new(i||t)(k(ot))}}static{this.\u0275cmp=M({type:t,selectors:[["app-network-health-widget"]],inputs:{refreshInterval:"refreshInterval"},decls:43,vars:8,consts:[[1,"health-widget"],["mat-icon-button","",3,"click"],[1,"health-summary"],[1,"health-indicator",3,"ngClass"],[1,"health-score"],[1,"health-label"],["mode","determinate",3,"color","value"],[1,"status-summary"],[1,"status-item"],[1,"status-icon","active"],[1,"status-details"],[1,"status-value"],[1,"status-label"],[1,"status-icon","warning"],[1,"status-icon","critical"]],template:function(i,r){i&1&&(n(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title"),a(3,"Salud de la Red"),o(),n(4,"button",1),u("click",function(){return r.refreshData()}),n(5,"mat-icon"),a(6,"refresh"),o()()(),n(7,"mat-card-content")(8,"div",2)(9,"div",3)(10,"span",4),a(11),o(),n(12,"span",5),a(13),o()(),C(14,"mat-progress-bar",6),o(),n(15,"div",7)(16,"div",8)(17,"div",9)(18,"mat-icon"),a(19,"check_circle"),o()(),n(20,"div",10)(21,"span",11),a(22),o(),n(23,"span",12),a(24,"Activos"),o()()(),n(25,"div",8)(26,"div",13)(27,"mat-icon"),a(28,"warning"),o()(),n(29,"div",10)(30,"span",11),a(31),o(),n(32,"span",12),a(33,"Advertencias"),o()()(),n(34,"div",8)(35,"div",14)(36,"mat-icon"),a(37,"error"),o()(),n(38,"div",10)(39,"span",11),a(40),o(),n(41,"span",12),a(42,"Cr\xEDticos"),o()()()()()()),i&2&&(s(9),c("ngClass",r.networkHealthClass),s(2),b("",r.networkHealth,"%"),s(2),g(r.networkHealthLabel),s(),c("color",r.networkHealthColor)("value",r.networkHealth),s(8),g(r.activeCount),s(9),g(r.warningCount),s(9),g(r.criticalCount))},dependencies:[w,U,L,ne,oe,ae,re,E,S,R,ie,Re,rt],styles:[".health-widget[_ngcontent-%COMP%]{height:100%}.health-summary[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin-bottom:20px}.health-indicator[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin-bottom:10px}.health-score[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:700}.health-label[_ngcontent-%COMP%]{font-size:1rem}.health-indicator.good[_ngcontent-%COMP%]{color:#4caf50}.health-indicator.warning[_ngcontent-%COMP%]{color:#ff9800}.health-indicator.critical[_ngcontent-%COMP%]{color:#f44336}.status-summary[_ngcontent-%COMP%]{display:flex;justify-content:space-around;margin-top:20px}.status-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.status-icon[_ngcontent-%COMP%]{margin-bottom:5px}.status-icon.active[_ngcontent-%COMP%]{color:#4caf50}.status-icon.warning[_ngcontent-%COMP%]{color:#ff9800}.status-icon.critical[_ngcontent-%COMP%]{color:#f44336}.status-value[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700}.status-label[_ngcontent-%COMP%]{font-size:.8rem}"]})}}return t})();var fn=["mat-sort-header",""],_n=["*"];function vn(t,m){t&1&&(n(0,"div",2),Bt(),n(1,"svg",3),C(2,"path",4),o()())}var Yi=new $t("MAT_SORT_DEFAULT_OPTIONS"),Qe=(()=>{class t{_defaultOptions;_initializedStream=new It(1);sortables=new Map;_stateChanges=new mt;active;start="asc";get direction(){return this._direction}set direction(e){this._direction=e}_direction="";disableClear;disabled=!1;sortChange=new z;initialized=this._initializedStream;constructor(e){this._defaultOptions=e}register(e){this.sortables.set(e.id,e)}deregister(e){this.sortables.delete(e.id)}sort(e){this.active!=e.id?(this.active=e.id,this.direction=e.start?e.start:this.start):this.direction=this.getNextSortDirection(e),this.sortChange.emit({active:this.active,direction:this.direction})}getNextSortDirection(e){if(!e)return"";let i=e?.disableClear??this.disableClear??!!this._defaultOptions?.disableClear,r=Cn(e.start||this.start,i),l=r.indexOf(this.direction)+1;return l>=r.length&&(l=0),r[l]}ngOnInit(){this._initializedStream.next()}ngOnChanges(){this._stateChanges.next()}ngOnDestroy(){this._stateChanges.complete(),this._initializedStream.complete()}static \u0275fac=function(i){return new(i||t)(k(Yi,8))};static \u0275dir=pt({type:t,selectors:[["","matSort",""]],hostAttrs:[1,"mat-sort"],inputs:{active:[0,"matSortActive","active"],start:[0,"matSortStart","start"],direction:[0,"matSortDirection","direction"],disableClear:[2,"matSortDisableClear","disableClear",Ye],disabled:[2,"matSortDisabled","disabled",Ye]},outputs:{sortChange:"matSortChange"},exportAs:["matSort"],features:[jt]})}return t})();function Cn(t,m){let e=["asc","desc"];return t=="desc"&&e.reverse(),m||e.push(""),e}var st=(()=>{class t{changes=new mt;static \u0275fac=function(i){return new(i||t)};static \u0275prov=X({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function xn(t){return t||new st}var yn={provide:st,deps:[[new zt,new Vt,st]],useFactory:xn},qi=(()=>{class t{_intl=Q(st);_sort=Q(Qe,{optional:!0});_columnDef=Q("MAT_SORT_HEADER_COLUMN_DEF",{optional:!0});_changeDetectorRef=Q(qt);_focusMonitor=Q(Kt);_elementRef=Q(Xe);_ariaDescriber=Q(ei,{optional:!0});_renderChanges;_animationModule=Q(Gt,{optional:!0});_recentlyCleared=Wt(null);_sortButton;id;arrowPosition="after";start;disabled=!1;get sortActionDescription(){return this._sortActionDescription}set sortActionDescription(e){this._updateSortActionDescription(e)}_sortActionDescription="Sort";disableClear;constructor(){Q(Xt).load(ii);let e=Q(Yi,{optional:!0});this._sort,e?.arrowPosition&&(this.arrowPosition=e?.arrowPosition)}ngOnInit(){!this.id&&this._columnDef&&(this.id=this._columnDef.name),this._sort.register(this),this._renderChanges=At(this._sort._stateChanges,this._sort.sortChange).subscribe(()=>this._changeDetectorRef.markForCheck()),this._sortButton=this._elementRef.nativeElement.querySelector(".mat-sort-header-container"),this._updateSortActionDescription(this._sortActionDescription)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(()=>this._recentlyCleared.set(null))}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._sort.deregister(this),this._renderChanges?.unsubscribe(),this._sortButton&&this._ariaDescriber?.removeDescription(this._sortButton,this._sortActionDescription)}_toggleOnInteraction(){if(!this._isDisabled()){let e=this._isSorted(),i=this._sort.direction;this._sort.sort(this),this._recentlyCleared.set(e&&!this._isSorted()?i:null)}}_handleKeydown(e){(e.keyCode===32||e.keyCode===13)&&(e.preventDefault(),this._toggleOnInteraction())}_isSorted(){return this._sort.active==this.id&&(this._sort.direction==="asc"||this._sort.direction==="desc")}_isDisabled(){return this._sort.disabled||this.disabled}_getAriaSortAttribute(){return this._isSorted()?this._sort.direction=="asc"?"ascending":"descending":"none"}_renderArrow(){return!this._isDisabled()||this._isSorted()}_updateSortActionDescription(e){this._sortButton&&(this._ariaDescriber?.removeDescription(this._sortButton,this._sortActionDescription),this._ariaDescriber?.describe(this._sortButton,e)),this._sortActionDescription=e}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=M({type:t,selectors:[["","mat-sort-header",""]],hostAttrs:[1,"mat-sort-header"],hostVars:3,hostBindings:function(i,r){i&1&&u("click",function(){return r._toggleOnInteraction()})("keydown",function(d){return r._handleKeydown(d)})("mouseleave",function(){return r._recentlyCleared.set(null)}),i&2&&(et("aria-sort",r._getAriaSortAttribute()),I("mat-sort-header-disabled",r._isDisabled()))},inputs:{id:[0,"mat-sort-header","id"],arrowPosition:"arrowPosition",start:"start",disabled:[2,"disabled","disabled",Ye],sortActionDescription:"sortActionDescription",disableClear:[2,"disableClear","disableClear",Ye]},exportAs:["matSortHeader"],attrs:fn,ngContentSelectors:_n,decls:4,vars:17,consts:[[1,"mat-sort-header-container","mat-focus-indicator"],[1,"mat-sort-header-content"],[1,"mat-sort-header-arrow"],["viewBox","0 -960 960 960","focusable","false","aria-hidden","true"],["d","M440-240v-368L296-464l-56-56 240-240 240 240-56 56-144-144v368h-80Z"]],template:function(i,r){i&1&&(ut(),n(0,"div",0)(1,"div",1),gt(2),o(),f(3,vn,3,0,"div",2),o()),i&2&&(I("mat-sort-header-sorted",r._isSorted())("mat-sort-header-position-before",r.arrowPosition==="before")("mat-sort-header-descending",r._sort.direction==="desc")("mat-sort-header-ascending",r._sort.direction==="asc")("mat-sort-header-recently-cleared-ascending",r._recentlyCleared()==="asc")("mat-sort-header-recently-cleared-descending",r._recentlyCleared()==="desc")("mat-sort-header-animations-disabled",r._animationModule==="NoopAnimations"),et("tabindex",r._isDisabled()?null:0)("role",r._isDisabled()?null:"button"),s(3),Ut(r._renderArrow()?3:-1))},styles:[`.mat-sort-header{cursor:pointer}.mat-sort-header-disabled{cursor:default}.mat-sort-header-container{display:flex;align-items:center;letter-spacing:normal;outline:0}[mat-sort-header].cdk-keyboard-focused .mat-sort-header-container,[mat-sort-header].cdk-program-focused .mat-sort-header-container{border-bottom:solid 1px currentColor}.mat-sort-header-container::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 2px)*-1)}.mat-sort-header-content{display:flex;align-items:center}.mat-sort-header-position-before{flex-direction:row-reverse}@keyframes _mat-sort-header-recently-cleared-ascending{from{transform:translateY(0);opacity:1}to{transform:translateY(-25%);opacity:0}}@keyframes _mat-sort-header-recently-cleared-descending{from{transform:translateY(0) rotate(180deg);opacity:1}to{transform:translateY(25%) rotate(180deg);opacity:0}}.mat-sort-header-arrow{height:12px;width:12px;position:relative;transition:transform 225ms cubic-bezier(0.4, 0, 0.2, 1),opacity 225ms cubic-bezier(0.4, 0, 0.2, 1);opacity:0;overflow:visible;color:var(--mat-sort-arrow-color, var(--mat-sys-on-surface))}.mat-sort-header.cdk-keyboard-focused .mat-sort-header-arrow,.mat-sort-header.cdk-program-focused .mat-sort-header-arrow,.mat-sort-header:hover .mat-sort-header-arrow{opacity:.54}.mat-sort-header .mat-sort-header-sorted .mat-sort-header-arrow{opacity:1}.mat-sort-header-descending .mat-sort-header-arrow{transform:rotate(180deg)}.mat-sort-header-recently-cleared-ascending .mat-sort-header-arrow{transform:translateY(-25%)}.mat-sort-header-recently-cleared-ascending .mat-sort-header-arrow{transition:none;animation:_mat-sort-header-recently-cleared-ascending 225ms cubic-bezier(0.4, 0, 0.2, 1) forwards}.mat-sort-header-recently-cleared-descending .mat-sort-header-arrow{transition:none;animation:_mat-sort-header-recently-cleared-descending 225ms cubic-bezier(0.4, 0, 0.2, 1) forwards}.mat-sort-header-animations-disabled .mat-sort-header-arrow{transition-duration:0ms;animation-duration:0ms}.mat-sort-header-arrow svg{width:24px;height:24px;fill:currentColor;position:absolute;top:50%;left:50%;margin:-12px 0 0 -12px;transform:translateZ(0)}.mat-sort-header-arrow,[dir=rtl] .mat-sort-header-position-before .mat-sort-header-arrow{margin:0 0 0 6px}.mat-sort-header-position-before .mat-sort-header-arrow,[dir=rtl] .mat-sort-header-arrow{margin:0 6px 0 0}
`],encapsulation:2,changeDetection:0})}return t})(),Qi=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=Je({type:t});static \u0275inj=Ke({providers:[yn],imports:[qe]})}return t})();var wn=()=>[5,10,20];function bn(t,m){if(t&1&&(n(0,"mat-option",17),a(1),o()),t&2){let e=m.$implicit;c("value",e.id),s(),b(" ",e.name," ")}}function Sn(t,m){if(t&1){let e=V();n(0,"mat-form-field",3)(1,"mat-label"),a(2,"Elemento"),o(),n(3,"mat-select",4),vt("valueChange",function(r){_(e);let l=p();return _t(l.selectedElementId,r)||(l.selectedElementId=r),v(r)}),u("selectionChange",function(){_(e);let r=p();return v(r.loadElementMetrics())}),n(4,"mat-option",15),a(5,"Todos los elementos"),o(),f(6,bn,2,2,"mat-option",16),o()()}if(t&2){let e=p();s(3),ft("value",e.selectedElementId),s(3),c("ngForOf",e.elements)}}function En(t,m){t&1&&(n(0,"th",29),a(1,"Elemento"),o())}function Tn(t,m){if(t&1&&(n(0,"td",30),a(1),o()),t&2){let e=m.$implicit,i=p(3);s(),g(i.getElementName(e.elementId))}}function kn(t,m){t&1&&(We(0,28),f(1,En,2,0,"th",21)(2,Tn,2,1,"td",22),Ge())}function In(t,m){t&1&&(n(0,"th",29),a(1,"Fecha/Hora"),o())}function On(t,m){if(t&1&&(n(0,"td",30),a(1),O(2,"date"),o()),t&2){let e=m.$implicit;s(),g(ee(2,1,e.timestamp,"short"))}}function An(t,m){t&1&&(n(0,"th",29),a(1,"Valor"),o())}function Dn(t,m){if(t&1&&(n(0,"td",30),a(1),o()),t&2){let e=m.$implicit,i=p(2);s(),g(i.formatMetricValue(e.value))}}function Pn(t,m){t&1&&(n(0,"th",31),a(1,"Tendencia"),o())}function Nn(t,m){if(t&1&&(n(0,"td",30)(1,"mat-icon",32),a(2),o()()),t&2){let e=m.$implicit,i=p(2);s(),c("ngClass",i.getTrendClass(e.trend)),s(),g(i.getTrendIcon(e.trend))}}function Rn(t,m){t&1&&C(0,"tr",33)}function Ln(t,m){t&1&&C(0,"tr",34)}function Fn(t,m){if(t&1&&(n(0,"table",18),f(1,kn,3,0,"ng-container",19),We(2,20),f(3,In,2,0,"th",21)(4,On,3,4,"td",22),Ge(),We(5,23),f(6,An,2,0,"th",21)(7,Dn,2,1,"td",22),Ge(),We(8,24),f(9,Pn,2,0,"th",25)(10,Nn,3,2,"td",22),Ge(),f(11,Rn,1,0,"tr",26)(12,Ln,1,0,"tr",27),o()),t&2){let e=p();c("dataSource",e.metrics),s(),c("ngIf",e.showElementColumn),s(10),c("matHeaderRowDef",e.getDisplayedColumns()),s(),c("matRowDefColumns",e.getDisplayedColumns())}}function $n(t,m){t&1&&(n(0,"div",35)(1,"mat-icon"),a(2,"info"),o(),n(3,"span"),a(4,"No hay datos disponibles para los filtros seleccionados"),o()())}function zn(t,m){t&1&&C(0,"mat-paginator",36),t&2&&c("pageSizeOptions",De(1,wn))}var Zi=(()=>{class t{constructor(e){this.networkMonitoringService=e,this.showElementSelector=!0,this.selectedElementId="",this.maxRows=10,this.metrics=[],this.elements=[],this.selectedMetricType="bandwidth",this.showElementColumn=!0}ngOnInit(){this.loadElements(),this.refreshData()}refreshData(){this.selectedElementId?this.loadElementMetrics():this.loadNetworkMetrics()}onMetricTypeChange(e){this.selectedMetricType=e,this.refreshData()}loadElementMetrics(){this.selectedElementId&&(this.showElementColumn=!1,this.networkMonitoringService.getElementMetrics(this.selectedElementId,this.selectedMetricType,this.maxRows).subscribe(e=>{this.metrics=e}))}loadNetworkMetrics(){this.showElementColumn=!0,this.networkMonitoringService.getNetworkMetrics(this.selectedMetricType,"day").subscribe({next:e=>{e&&Array.isArray(e.metrics)?this.metrics=e.metrics.map((i,r,l)=>ye(xe({},i),{trend:this.calculateTrend(i,r>0?l[r-1]:null)})):(console.warn("Formato de datos inesperado:",e),this.metrics=[])},error:e=>{console.error("Error al cargar m\xE9tricas de red:",e),this.metrics=[]}})}calculateTrend(e,i){if(!i||i.value===void 0)return"stable";let r=e.value-i.value;return Math.abs(r)<.001?"stable":r>0?"up":"down"}loadElements(){this.elements=[{id:"olt1",name:"OLT Principal"},{id:"ont1",name:"ONT Cliente 1"},{id:"splitter1",name:"Splitter Zona Norte"}]}getElementName(e){let i=this.elements.find(r=>r.id===e);return i?i.name:e}getDisplayedColumns(){return this.showElementColumn?["element","timestamp","value","trend"]:["timestamp","value","trend"]}formatMetricValue(e){switch(this.selectedMetricType){case"bandwidth":return`${e} Mbps`;case"latency":return`${e} ms`;case"packetLoss":return`${e}%`;case"temperature":return`${e}\xB0C`;case"power":return`${e} dBm`;case"signal":return`${e} dB`;default:return`${e}`}}getTrendIcon(e){switch(e){case"up":return"trending_up";case"down":return"trending_down";case"stable":return"trending_flat";default:return"trending_flat"}}getTrendClass(e){switch(e){case"up":return"trend-up";case"down":return"trend-down";case"stable":return"trend-stable";default:return""}}static{this.\u0275fac=function(i){return new(i||t)(k(ot))}}static{this.\u0275cmp=M({type:t,selectors:[["app-metrics-widget"]],viewQuery:function(i,r){if(i&1&&(Ue(nt,5),Ue(Qe,5)),i&2){let l;Oe(l=Ae())&&(r.paginator=l.first),Oe(l=Ae())&&(r.sort=l.first)}},inputs:{showElementSelector:"showElementSelector",selectedElementId:"selectedElementId",maxRows:"maxRows"},decls:29,vars:5,consts:[[1,"metrics-widget"],["mat-icon-button","",3,"click"],[1,"filter-bar"],["appearance","outline"],[3,"valueChange","selectionChange","value"],["value","bandwidth"],["value","latency"],["value","packetLoss"],["value","temperature"],["value","power"],["value","signal"],["appearance","outline",4,"ngIf"],["mat-table","","matSort","","class","metrics-table",3,"dataSource",4,"ngIf"],["class","no-data-message",4,"ngIf"],["showFirstLastButtons","",3,"pageSizeOptions",4,"ngIf"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["mat-table","","matSort","",1,"metrics-table",3,"dataSource"],["matColumnDef","element",4,"ngIf"],["matColumnDef","timestamp"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","value"],["matColumnDef","trend"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["matColumnDef","element"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],[3,"ngClass"],["mat-header-row",""],["mat-row",""],[1,"no-data-message"],["showFirstLastButtons","",3,"pageSizeOptions"]],template:function(i,r){i&1&&(n(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title"),a(3,"M\xE9tricas de Red"),o(),n(4,"button",1),u("click",function(){return r.refreshData()}),n(5,"mat-icon"),a(6,"refresh"),o()()(),n(7,"mat-card-content")(8,"div",2)(9,"mat-form-field",3)(10,"mat-label"),a(11,"Tipo de M\xE9trica"),o(),n(12,"mat-select",4),vt("valueChange",function(d){return _t(r.selectedMetricType,d)||(r.selectedMetricType=d),d}),u("selectionChange",function(d){return r.onMetricTypeChange(d.value)}),n(13,"mat-option",5),a(14,"Ancho de Banda"),o(),n(15,"mat-option",6),a(16,"Latencia"),o(),n(17,"mat-option",7),a(18,"P\xE9rdida de Paquetes"),o(),n(19,"mat-option",8),a(20,"Temperatura"),o(),n(21,"mat-option",9),a(22,"Potencia"),o(),n(23,"mat-option",10),a(24,"Se\xF1al"),o()()(),f(25,Sn,7,2,"mat-form-field",11),o(),f(26,Fn,13,4,"table",12)(27,$n,5,0,"div",13)(28,zn,1,2,"mat-paginator",14),o()()),i&2&&(s(12),ft("value",r.selectedMetricType),s(13),c("ngIf",r.showElementSelector),s(),c("ngIf",r.metrics.length>0),s(),c("ngIf",r.metrics.length===0),s(),c("ngIf",r.metrics.length>0))},dependencies:[w,U,Y,N,Pe,L,ne,oe,ae,re,E,S,R,ie,xi,ui,pi,Ci,vi,_i,mi,Ri,Si,Ti,Ai,ki,Ei,Di,Ii,Oi,Pi,Ni,Bi,nt,Qi,Qe,qi],styles:[".metrics-widget[_ngcontent-%COMP%]{height:100%}.filter-bar[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:16px}.metrics-table[_ngcontent-%COMP%]{width:100%}.no-data-message[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:20px;color:#666}.no-data-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}mat-icon.trend-up[_ngcontent-%COMP%]{color:#4caf50}mat-icon.trend-down[_ngcontent-%COMP%]{color:#f44336}mat-icon.trend-stable[_ngcontent-%COMP%]{color:#ff9800}"]})}}return t})();var Tt=t=>["/monitoring",t];function Vn(t,m){if(t&1&&C(0,"span",7),t&2){let e=p();c("matBadge",e.criticalCount)}}function jn(t,m){t&1&&(n(0,"div",8),C(1,"mat-spinner",9),o())}function Bn(t,m){if(t&1){let e=V();n(0,"div",10)(1,"mat-icon",11),a(2,"error"),o(),n(3,"span"),a(4),o(),n(5,"button",12),u("click",function(){_(e);let r=p();return v(r.refreshAlerts())}),a(6,"Reintentar"),o()()}if(t&2){let e=p();s(4),g(e.errorMessage)}}function Hn(t,m){if(t&1&&(n(0,"mat-icon",19),a(1,"error"),o(),a(2)),t&2){let e=p(2);s(2),b(" Cr\xEDticas (",e.criticalAlerts.length,") ")}}function Wn(t,m){if(t&1&&(n(0,"div",29),a(1),o()),t&2){let e=p().$implicit;s(),b(" Elemento: ",e.elementName," ")}}function Gn(t,m){if(t&1){let e=V();n(0,"div",20)(1,"div",21)(2,"div",22)(3,"mat-icon"),a(4,"error"),o(),n(5,"span",23),a(6),O(7,"date"),o()(),n(8,"div",24),a(9),o(),f(10,Wn,2,1,"div",25),o(),n(11,"div",26)(12,"button",27),u("click",function(){let r=_(e).$implicit,l=p(2);return v(l.toggleAcknowledge(r))}),n(13,"mat-icon"),a(14),o()(),n(15,"button",28)(16,"mat-icon"),a(17,"visibility"),o()()()()}if(t&2){let e=m.$implicit;s(6),g(ee(7,6,e.timestamp,"short")),s(3),g(e.message),s(),c("ngIf",e.elementName),s(2),c("matTooltip",e.acknowledged?"Reabrir":"Reconocer"),s(2),g(e.acknowledged?"check_circle":"check_circle_outline"),s(),c("routerLink",Me(9,Tt,e.id))}}function Un(t,m){t&1&&(n(0,"div",30),a(1," No hay alertas cr\xEDticas "),o())}function Yn(t,m){if(t&1&&(n(0,"mat-icon",31),a(1,"warning"),o(),a(2)),t&2){let e=p(2);s(2),b(" Advertencias (",e.warningAlerts.length,") ")}}function qn(t,m){if(t&1&&(n(0,"div",29),a(1),o()),t&2){let e=p().$implicit;s(),b(" Elemento: ",e.elementName," ")}}function Qn(t,m){if(t&1){let e=V();n(0,"div",32)(1,"div",21)(2,"div",22)(3,"mat-icon"),a(4,"warning"),o(),n(5,"span",23),a(6),O(7,"date"),o()(),n(8,"div",24),a(9),o(),f(10,qn,2,1,"div",25),o(),n(11,"div",26)(12,"button",27),u("click",function(){let r=_(e).$implicit,l=p(2);return v(l.toggleAcknowledge(r))}),n(13,"mat-icon"),a(14),o()(),n(15,"button",28)(16,"mat-icon"),a(17,"visibility"),o()()()()}if(t&2){let e=m.$implicit;s(6),g(ee(7,6,e.timestamp,"short")),s(3),g(e.message),s(),c("ngIf",e.elementName),s(2),c("matTooltip",e.acknowledged?"Reabrir":"Reconocer"),s(2),g(e.acknowledged?"check_circle":"check_circle_outline"),s(),c("routerLink",Me(9,Tt,e.id))}}function Zn(t,m){t&1&&(n(0,"div",30),a(1," No hay alertas de advertencia "),o())}function Kn(t,m){if(t&1&&(n(0,"mat-icon",33),a(1,"info"),o(),a(2)),t&2){let e=p(2);s(2),b(" Informativas (",e.infoAlerts.length,") ")}}function Xn(t,m){if(t&1&&(n(0,"div",29),a(1),o()),t&2){let e=p().$implicit;s(),b(" Elemento: ",e.elementName," ")}}function Jn(t,m){if(t&1){let e=V();n(0,"div",34)(1,"div",21)(2,"div",22)(3,"mat-icon"),a(4,"info"),o(),n(5,"span",23),a(6),O(7,"date"),o()(),n(8,"div",24),a(9),o(),f(10,Xn,2,1,"div",25),o(),n(11,"div",26)(12,"button",27),u("click",function(){let r=_(e).$implicit,l=p(2);return v(l.toggleAcknowledge(r))}),n(13,"mat-icon"),a(14),o()(),n(15,"button",28)(16,"mat-icon"),a(17,"visibility"),o()()()()}if(t&2){let e=m.$implicit;s(6),g(ee(7,6,e.timestamp,"short")),s(3),g(e.message),s(),c("ngIf",e.elementName),s(2),c("matTooltip",e.acknowledged?"Reabrir":"Reconocer"),s(2),g(e.acknowledged?"check_circle":"check_circle_outline"),s(),c("routerLink",Me(9,Tt,e.id))}}function er(t,m){t&1&&(n(0,"div",30),a(1," No hay alertas informativas "),o())}function tr(t,m){if(t&1&&(n(0,"mat-tab-group")(1,"mat-tab"),f(2,Hn,3,1,"ng-template",13),n(3,"div",14),f(4,Gn,18,11,"div",15)(5,Un,2,0,"div",16),o()(),n(6,"mat-tab"),f(7,Yn,3,1,"ng-template",13),n(8,"div",14),f(9,Qn,18,11,"div",17)(10,Zn,2,0,"div",16),o()(),n(11,"mat-tab"),f(12,Kn,3,1,"ng-template",13),n(13,"div",14),f(14,Jn,18,11,"div",18)(15,er,2,0,"div",16),o()()()),t&2){let e=p();s(4),c("ngForOf",e.criticalAlerts),s(),c("ngIf",e.criticalAlerts.length===0),s(4),c("ngForOf",e.warningAlerts),s(),c("ngIf",e.warningAlerts.length===0),s(4),c("ngForOf",e.infoAlerts),s(),c("ngIf",e.infoAlerts.length===0)}}function ir(t,m){t&1&&(n(0,"div",35)(1,"a",36),a(2," Ver todas las alertas "),o()())}var Ki=(()=>{class t{get criticalAlerts(){return this.alerts.filter(e=>e.type==="critical").slice(0,this.maxAlerts)}get warningAlerts(){return this.alerts.filter(e=>e.type==="warning").slice(0,this.maxAlerts)}get infoAlerts(){return this.alerts.filter(e=>e.type==="info").slice(0,this.maxAlerts)}get criticalCount(){return this.alerts.filter(e=>e.type==="critical"&&!e.acknowledged).length}constructor(){this.maxAlerts=5,this.showViewAllButton=!0,this.dataLoaded=new z,this.errorOccurred=new z,this.alertAcknowledged=new z,this.criticalAlertsCountChanged=new z,this.alerts=[],this.loading=!1,this.error=!1,this.errorMessage="Error al cargar las alertas."}ngOnInit(){this.refreshAlerts()}refreshAlerts(){this.loading=!0,this.error=!1,setTimeout(()=>{try{this.alerts=[{id:"a1",type:"critical",message:"OLT-01 fuera de l\xEDnea",timestamp:new Date(Date.now()-30*6e4).toISOString(),elementId:"olt-01",elementName:"OLT Principal",acknowledged:!1},{id:"a2",type:"warning",message:"Alta temperatura en ONT-24",timestamp:new Date(Date.now()-120*6e4).toISOString(),elementId:"ont-24",elementName:"ONT Cliente Residencial",acknowledged:!0},{id:"a3",type:"warning",message:"Se\xF1al baja en fibra troncal norte",timestamp:new Date(Date.now()-240*6e4).toISOString(),elementId:"fiber-101",elementName:"Fibra Troncal Norte",acknowledged:!1},{id:"a4",type:"info",message:"Mantenimiento programado en 2 horas",timestamp:new Date(Date.now()-360*6e4).toISOString(),acknowledged:!1},{id:"a5",type:"critical",message:"P\xE9rdida de potencia en Splitter-03",timestamp:new Date(Date.now()-45*6e4).toISOString(),elementId:"splitter-03",elementName:"Splitter Zona Este",acknowledged:!1}],this.elementId&&(this.alerts=this.alerts.filter(e=>e.elementId===this.elementId)),this.loading=!1,this.dataLoaded.emit(!0),this.criticalAlertsCountChanged.emit(this.criticalCount)}catch(e){this.handleError(e)}},1e3)}toggleAcknowledge(e){e.acknowledged=!e.acknowledged,this.alertAcknowledged.emit(e.id),this.criticalAlertsCountChanged.emit(this.criticalCount)}handleError(e){this.loading=!1,this.error=!0,this.errorMessage=e.message||"Error al cargar las alertas.",this.errorOccurred.emit(e)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=M({type:t,selectors:[["app-system-alerts-widget"]],inputs:{maxAlerts:"maxAlerts",showViewAllButton:"showViewAllButton",elementId:"elementId"},outputs:{dataLoaded:"dataLoaded",errorOccurred:"errorOccurred",alertAcknowledged:"alertAcknowledged",criticalAlertsCountChanged:"criticalAlertsCountChanged"},decls:13,vars:5,consts:[[1,"alerts-widget"],["class","alert-badge","matBadgeColor","warn",3,"matBadge",4,"ngIf"],["mat-icon-button","",3,"click"],["class","loading-indicator",4,"ngIf"],["class","error-message",4,"ngIf"],[4,"ngIf"],["class","view-all-alerts",4,"ngIf"],["matBadgeColor","warn",1,"alert-badge",3,"matBadge"],[1,"loading-indicator"],["diameter","30"],[1,"error-message"],["color","warn"],["mat-button","","color","primary",3,"click"],["mat-tab-label",""],[1,"alerts-list"],["class","alert-item critical",4,"ngFor","ngForOf"],["class","no-alerts",4,"ngIf"],["class","alert-item warning",4,"ngFor","ngForOf"],["class","alert-item info",4,"ngFor","ngForOf"],[1,"critical-icon"],[1,"alert-item","critical"],[1,"alert-content"],[1,"alert-header"],[1,"alert-timestamp"],[1,"alert-message"],["class","alert-element",4,"ngIf"],[1,"alert-actions"],["mat-icon-button","",3,"click","matTooltip"],["mat-icon-button","","matTooltip","Ver detalles",3,"routerLink"],[1,"alert-element"],[1,"no-alerts"],[1,"warning-icon"],[1,"alert-item","warning"],[1,"info-icon"],[1,"alert-item","info"],[1,"view-all-alerts"],["mat-button","","color","primary","routerLink","/monitoring/alerts"]],template:function(i,r){i&1&&(n(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title"),a(3," Alertas del Sistema "),f(4,Vn,1,1,"span",1),o(),n(5,"button",2),u("click",function(){return r.refreshAlerts()}),n(6,"mat-icon"),a(7,"refresh"),o()()(),n(8,"mat-card-content"),f(9,jn,2,0,"div",3)(10,Bn,7,1,"div",4)(11,tr,16,6,"mat-tab-group",5)(12,ir,3,0,"div",6),o()()),i&2&&(s(4),c("ngIf",r.criticalCount>0),s(5),c("ngIf",r.loading),s(),c("ngIf",r.error),s(),c("ngIf",!r.error),s(),c("ngIf",r.alerts.length>0&&!r.error))},dependencies:[w,Y,N,Pe,L,ne,oe,ae,re,E,S,R,si,B,ie,ci,li,bi,yi,Mi,wi,_e,j,H,te,fe,he,Ne],styles:[".alerts-widget[_ngcontent-%COMP%]{height:100%}.alert-badge[_ngcontent-%COMP%]{margin-left:8px}.critical-icon[_ngcontent-%COMP%]{color:#f44336}.warning-icon[_ngcontent-%COMP%]{color:#ff9800}.info-icon[_ngcontent-%COMP%]{color:#2196f3}.alerts-list[_ngcontent-%COMP%]{max-height:300px;overflow-y:auto;padding:8px 0}.alert-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:12px;border-radius:4px;margin-bottom:8px}.alert-item.critical[_ngcontent-%COMP%]{background-color:#f4433614;border-left:4px solid #f44336}.alert-item.warning[_ngcontent-%COMP%]{background-color:#ff980014;border-left:4px solid #ff9800}.alert-item.info[_ngcontent-%COMP%]{background-color:#2196f314;border-left:4px solid #2196f3}.alert-header[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:4px}.alert-header[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}.alert-timestamp[_ngcontent-%COMP%]{color:#0000008a;font-size:12px}.alert-message[_ngcontent-%COMP%]{font-weight:500;margin-bottom:4px}.alert-element[_ngcontent-%COMP%]{font-size:12px;color:#0009}.alert-actions[_ngcontent-%COMP%]{display:flex;align-items:center}.no-alerts[_ngcontent-%COMP%]{text-align:center;color:#0000008a;padding:16px}.view-all-alerts[_ngcontent-%COMP%]{text-align:center;margin-top:16px}.loading-indicator[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:20px}.error-message[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:16px;color:#f44336;gap:8px}"]})}}return t})();var Fe=pn(un());var nr=["mapContainer"];function rr(t,m){t&1&&(n(0,"div",7),C(1,"mat-spinner",8),o())}function or(t,m){if(t&1){let e=V();n(0,"div",9)(1,"mat-icon",10),a(2,"error"),o(),n(3,"span"),a(4),o(),n(5,"button",11),u("click",function(){_(e);let r=p();return v(r.refreshMap())}),a(6,"Reintentar"),o()()}if(t&2){let e=p();s(4),g(e.errorMessage)}}function ar(t,m){if(t&1){let e=V();n(0,"mat-card-actions",12)(1,"button",11),u("click",function(){_(e);let r=p();return v(r.openFullMap())}),n(2,"mat-icon"),a(3,"open_in_new"),o(),a(4),o()()}if(t&2){let e=p();s(4),b(" ",e.openMapButtonText," ")}}var Xi=(()=>{class t{constructor(e,i,r){this.mapService=e,this.zone=i,this.el=r,this.height=200,this.showActions=!0,this.title="Vista Miniatura",this.openMapButtonText="Ver mapa completo",this.zoomLevel=12,this.mapReady=new z,this.errorOccurred=new z,this.mapClicked=new z,this.fullMapRequested=new z,this.mapLoaded=!1,this.loading=!1,this.error=!1,this.errorMessage="Error al cargar el mapa.",this.map=null,this.mapReadySubscription=null,this.defaultCoordinates={lat:19.78374989863946,lng:-70.67666561349361}}ngOnInit(){this.loadMap()}ngOnDestroy(){this.mapReadySubscription&&this.mapReadySubscription.unsubscribe(),this.map&&(this.map.remove(),this.map=null)}refreshMap(){this.mapLoaded=!1,this.error=!1,this.map&&(this.map.remove(),this.map=null),this.loadMap()}openFullMap(){let e=this.map?{center:this.map.getCenter(),zoom:this.map.getZoom()}:null;this.fullMapRequested.emit(e),this.loading=!0,console.log("[MiniMapWidget] Evento fullMapRequested emitido para abrir mapa completo"),console.log("[MiniMapWidget] Estado actual del mapa:",e),setTimeout(()=>{this.loading=!1},300)}loadMap(){if(this.loading=!0,!this.mapContainer||!this.mapContainer.nativeElement){this.handleError(new Error("Contenedor del mapa no encontrado"));return}this.zone.runOutsideAngular(()=>{try{let e=this.mapContainer.nativeElement,i=this.centerCoordinates||this.defaultCoordinates;this.map=Fe.map(e,{center:[i.lat,i.lng],zoom:this.zoomLevel,zoomControl:!1,attributionControl:!1,dragging:!0,scrollWheelZoom:!1,doubleClickZoom:!1}),Fe.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{minZoom:3,maxZoom:18}).addTo(this.map),Fe.marker([i.lat,i.lng],{title:"Ubicaci\xF3n actual",alt:"Marcador de ubicaci\xF3n"}).addTo(this.map).bindPopup(`
          <strong>Coordenadas</strong><br>
          Lat: ${i.lat.toFixed(6)}<br>
          Lng: ${i.lng.toFixed(6)}
        `).openPopup(),this.setupMapEvents(),this.zone.run(()=>{this.mapLoaded=!0,this.loading=!1,this.error=!1,this.mapReady.emit(!0)})}catch(e){this.zone.run(()=>{this.handleError(e)})}})}setupMapEvents(){this.map&&(this.map.on("click",e=>{this.zone.run(()=>{this.mapClicked.emit({lat:e.latlng.lat,lng:e.latlng.lng})})}),setTimeout(()=>{this.map&&this.map.invalidateSize()},100))}handleError(e){console.error("[MiniMapWidget] Error al cargar el mapa:",e),this.loading=!1,this.error=!0,this.mapLoaded=!1,this.errorMessage=e?.message||"Error al cargar el mapa.",this.errorOccurred.emit(e)}static{this.\u0275fac=function(i){return new(i||t)(k($i),k(Ht),k(Xe))}}static{this.\u0275cmp=M({type:t,selectors:[["app-mini-map-widget"]],viewQuery:function(i,r){if(i&1&&Ue(nr,7),i&2){let l;Oe(l=Ae())&&(r.mapContainer=l.first)}},inputs:{height:"height",showActions:"showActions",title:"title",openMapButtonText:"openMapButtonText",centerCoordinates:"centerCoordinates",zoomLevel:"zoomLevel"},outputs:{mapReady:"mapReady",errorOccurred:"errorOccurred",mapClicked:"mapClicked",fullMapRequested:"fullMapRequested"},decls:13,vars:6,consts:[["mapContainer",""],[1,"mini-map-widget"],["mat-icon-button","",3,"click"],[1,"map-container"],["class","loading-indicator",4,"ngIf"],["class","error-message",4,"ngIf"],["align","end",4,"ngIf"],[1,"loading-indicator"],["diameter","30"],[1,"error-message"],["color","warn"],["mat-button","","color","primary",3,"click"],["align","end"]],template:function(i,r){if(i&1){let l=V();n(0,"mat-card",1)(1,"mat-card-header")(2,"mat-card-title"),a(3),o(),n(4,"button",2),u("click",function(){return _(l),v(r.refreshMap())}),n(5,"mat-icon"),a(6,"refresh"),o()()(),n(7,"mat-card-content")(8,"div",3,0),f(10,rr,2,0,"div",4)(11,or,7,1,"div",5),o()(),f(12,ar,5,1,"mat-card-actions",6),o()}i&2&&(s(3),g(r.title),s(5),ge("height",r.height,"px"),s(2),c("ngIf",r.loading),s(),c("ngIf",r.error),s(),c("ngIf",r.showActions))},dependencies:[w,N,L,ne,gi,oe,ae,re,E,S,R,B,ie,te,fe],styles:[".mini-map-widget[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.map-container[_ngcontent-%COMP%]{flex:1;background-color:#f5f5f5;border-radius:4px;position:relative;overflow:hidden}.loading-indicator[_ngcontent-%COMP%]{position:absolute;inset:0;display:flex;justify-content:center;align-items:center;background-color:#ffffffb3;z-index:999}.error-message[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;color:#f44336;gap:8px;text-align:center;padding:0 16px}"]})}}return t})();var Ji=(()=>{class t{constructor(){this.elementsCount=0,this.connectionsCount=0,this.warningCount=0}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=M({type:t,selectors:[["app-network-stats"]],inputs:{elementsCount:"elementsCount",connectionsCount:"connectionsCount",warningCount:"warningCount"},decls:16,vars:3,consts:[[1,"header-stats"],["matTooltip","Total de elementos",1,"elements-count"],[1,"count"],["matTooltip","Conexiones activas",1,"connections-count"],["matTooltip","Elementos con problemas",1,"status-count"]],template:function(i,r){i&1&&(n(0,"div",0)(1,"span",1)(2,"mat-icon"),a(3,"device_hub"),o(),n(4,"span",2),a(5),o()(),n(6,"span",3)(7,"mat-icon"),a(8,"link"),o(),n(9,"span",2),a(10),o()(),n(11,"span",4)(12,"mat-icon"),a(13,"warning"),o(),n(14,"span",2),a(15),o()()()),i&2&&(s(5),g(r.elementsCount),s(5),g(r.connectionsCount),s(5),g(r.warningCount))},dependencies:[w,E,S,j,H],styles:[".header-stats[_ngcontent-%COMP%]{display:flex;gap:var(--spacing-md)}.elements-count[_ngcontent-%COMP%], .connections-count[_ngcontent-%COMP%], .status-count[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-xs);font-size:14px;color:var(--text-color)}.elements-count[_ngcontent-%COMP%]   .count[_ngcontent-%COMP%], .connections-count[_ngcontent-%COMP%]   .count[_ngcontent-%COMP%], .status-count[_ngcontent-%COMP%]   .count[_ngcontent-%COMP%]{font-weight:500}"]})}}return t})();var en=(()=>{class t{constructor(){this.onClick=new z,this.ElementStatus=Z}getNodeIcon(e){return{[$.FDP]:"device_hub",[$.OLT]:"router",[$.ONT]:"devices",[$.EDFA]:"settings_input_component",[$.SPLITTER]:"call_split",[$.MANGA]:"fiber_manual_record"}[e]||"help"}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=M({type:t,selectors:[["app-network-node"]],inputs:{node:"node"},outputs:{onClick:"onClick"},decls:3,vars:10,consts:[[1,"network-node",3,"click","matTooltip"],[1,"node-icon"]],template:function(i,r){i&1&&(n(0,"div",0),u("click",function(){return r.onClick.emit(r.node)}),n(1,"mat-icon",1),a(2),o()()),i&2&&(ge("left",r.node.x,"%")("top",r.node.y,"%")("background-color",r.node.color),I("node-warning",r.node.status===r.ElementStatus.FAULT),c("matTooltip",r.node.tooltip),s(2),g(r.getNodeIcon(r.node.type)))},dependencies:[w,E,S,j,H],styles:[".network-node[_ngcontent-%COMP%]{position:absolute;width:24px;height:24px;border-radius:50%;transform:translate(-50%,-50%);box-shadow:var(--shadow-sm);transition:all .3s ease;cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:2}.network-node[_ngcontent-%COMP%]:hover{transform:translate(-50%,-50%) scale(1.2);box-shadow:var(--shadow-md)}.network-node.node-warning[_ngcontent-%COMP%]{background-color:var(--warn-color);animation:_ngcontent-%COMP%_pulse 2s infinite}.network-node[_ngcontent-%COMP%]   .node-icon[_ngcontent-%COMP%]{color:#fff;font-size:14px;width:14px;height:14px}@keyframes _ngcontent-%COMP%_pulse{0%{box-shadow:0 0 #f4433666}70%{box-shadow:0 0 0 10px #f4433600}to{box-shadow:0 0 #f4433600}}"]})}}return t})();var tn=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=M({type:t,selectors:[["app-network-connection"]],inputs:{connection:"connection"},decls:1,vars:10,consts:[[1,"network-connection"]],template:function(i,r){i&1&&C(0,"div",0),i&2&&(ge("left",r.connection.x,"%")("top",r.connection.y,"%")("width",r.connection.width,"px")("transform",r.connection.rotation),I("connection-inactive",r.connection.status==="inactive"))},dependencies:[w],styles:[".network-connection[_ngcontent-%COMP%]{position:absolute;height:2px;background-color:var(--primary-color);transform-origin:left center;opacity:.6;transition:all .3s ease}.network-connection.connection-inactive[_ngcontent-%COMP%]{background-color:var(--text-color);opacity:.3}"]})}}return t})();function sr(t,m){t&1&&C(0,"mat-spinner",4)}function lr(t,m){if(t&1&&(n(0,"div",5)(1,"mat-icon"),a(2,"error_outline"),o(),a(3),o()),t&2){let e=p();s(3),b(" ",e.error," ")}}function cr(t,m){if(t&1){let e=V();n(0,"app-network-node",10),u("onClick",function(r){_(e);let l=p(2);return v(l.onNodeClick.emit(r))}),o()}if(t&2){let e=m.$implicit;c("node",e)}}function dr(t,m){if(t&1&&C(0,"app-network-connection",11),t&2){let e=m.$implicit;c("connection",e)}}function mr(t,m){if(t&1&&(n(0,"div",6),C(1,"div",7),f(2,cr,1,1,"app-network-node",8)(3,dr,1,1,"app-network-connection",9),o()),t&2){let e=p();s(2),c("ngForOf",e.nodes),s(),c("ngForOf",e.connections)}}var nn=(()=>{class t{constructor(){this.loading=!1,this.error=null,this.nodes=[],this.connections=[],this.onNodeClick=new z}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=M({type:t,selectors:[["app-network-preview"]],inputs:{loading:"loading",error:"error",nodes:"nodes",connections:"connections"},outputs:{onNodeClick:"onNodeClick"},decls:4,vars:3,consts:[[1,"network-preview"],["diameter","40",4,"ngIf"],["class","error-message",4,"ngIf"],["class","preview-placeholder",4,"ngIf"],["diameter","40"],[1,"error-message"],[1,"preview-placeholder"],[1,"network-grid"],[3,"node","onClick",4,"ngFor","ngForOf"],[3,"connection",4,"ngFor","ngForOf"],[3,"onClick","node"],[3,"connection"]],template:function(i,r){i&1&&(n(0,"div",0),f(1,sr,1,0,"mat-spinner",1)(2,lr,4,1,"div",2)(3,mr,4,2,"div",3),o()),i&2&&(s(),c("ngIf",r.loading),s(),c("ngIf",r.error),s(),c("ngIf",!r.loading&&!r.error))},dependencies:[w,Y,N,te,fe,E,S,en,tn],styles:[".network-preview[_ngcontent-%COMP%]{flex:1;overflow:hidden;position:relative;background:var(--background-color);border-radius:var(--border-radius-md);margin-bottom:var(--spacing-md);display:flex;justify-content:center;align-items:center;transition:all .3s ease}.preview-placeholder[_ngcontent-%COMP%]{width:100%;height:100%;position:relative}.network-grid[_ngcontent-%COMP%]{position:absolute;inset:0;background-image:linear-gradient(to right,var(--grid-color) 1px,transparent 1px),linear-gradient(to bottom,var(--grid-color) 1px,transparent 1px);background-size:20px 20px;opacity:.3}.error-message[_ngcontent-%COMP%]{color:var(--warn-color);text-align:center;padding:var(--spacing-md);display:flex;align-items:center;gap:var(--spacing-sm)}"]})}}return t})();var rn=(()=>{class t{constructor(e){this.logger=e,this.svg=null,this.mainGroup=null,this.nodesGroup=null,this.linksGroup=null,this.simulation=null,this.width=0,this.height=0,this.selectedElementId=null,this.isDarkMode=!1}initializeRender(e,i,r,l){this.svg=e,this.mainGroup=i,this.width=r,this.height=l,this.linksGroup=i.append("g").attr("class","links"),this.nodesGroup=i.append("g").attr("class","nodes"),this.initializeSimulation(),this.logger.debug("Componentes de renderizado inicializados")}updateNodes(e){if(!this.nodesGroup||!this.simulation)return;this.simulation.nodes(e);let i=this.nodesGroup.selectAll(".node").data(e,l=>l.id);i.exit().remove();let r=i.enter().append("g").attr("class","node").attr("id",l=>`node-${l.id}`).call(this.configureDrag());r.append("circle").attr("r",l=>l.isPreview?8:15).attr("fill",l=>this.getElementColor(l.type||"",l.status||"")).attr("stroke",l=>l.isPreview?"#FF4081":"#ffffff").attr("stroke-width",l=>l.isPreview?2:1).attr("class",l=>l.isPreview?"preview-node":""),r.append("text").attr("dy",".35em").attr("y",30).style("text-anchor","middle").style("fill",this.isDarkMode?"#e0e0e0":"#333333").style("font-size","12px").style("pointer-events","none").text(l=>l.name||""),this.nodesGroup.selectAll(".node").each(function(l){let d=yt(this);d.select("circle").attr("fill",l.isPreview?"#FF4081":l.color||"#4CAF50").attr("stroke",l.isPreview?"#FF4081":"#ffffff"),d.select("text").text(l.name||"")})}updateLinks(e){if(!this.linksGroup||!this.simulation)return;this.simulation.force("link",bt(e).id(l=>l.id).distance(l=>l.distance||100).strength(l=>l.strength||.1));let i=this.linksGroup.selectAll(".link").data(e,l=>`${l.source.id||l.source}-${l.target.id||l.target}`);i.exit().remove();let r=i.enter().append("line").attr("class","link").attr("stroke",l=>l.color||"#999").attr("stroke-width",l=>l.width||1).attr("stroke-dasharray",l=>l.dashed?"5, 5":"none");this.linksGroup.selectAll(".link").each(function(l){yt(this).attr("stroke",l.color||"#999").attr("stroke-width",l.width||1).attr("stroke-dasharray",l.dashed?"5, 5":"none")})}updatePositions(){!this.nodesGroup||!this.linksGroup||(this.nodesGroup.selectAll(".node").attr("transform",e=>`translate(${e.x||0},${e.y||0})`),this.linksGroup.selectAll(".link").attr("x1",e=>e.source.x||0).attr("y1",e=>e.source.y||0).attr("x2",e=>e.target.x||0).attr("y2",e=>e.target.y||0))}convertToD3Nodes(e){return e.map(i=>{let r=i.position?.coordinates?.[0]||0,l=i.position?.coordinates?.[1]||0,d=this.width/2+r*(this.width/360),h=this.height/2-l*(this.height/180);return ye(xe({},i),{x:d,y:h,fx:i.metadata?.fixed?d:null,fy:i.metadata?.fixed?h:null})})}convertToD3Links(e,i){let r=new Map(i.map(l=>[l.id,l]));return e.reduce((l,d)=>{let h=r.get(d.sourceElementId),P=r.get(d.targetElementId);if(!h||!P)return this.logger.warn(`Elemento fuente o destino no encontrado para la conexi\xF3n: ${d.id??"N/A"}. Saltando conexi\xF3n.`),l;let Se=ye(xe({},d),{source:h.id,target:P.id,sourceId:d.sourceElementId,targetId:d.targetElementId,value:d.properties?.weight||this.getLinkStrength(d)||1});return l.push(Se),l},[])}getLinkStrength(e){switch(e.type){case de.FIBER:return .2;case de.COPPER:return .3;case de.WIRELESS:return .1;case de.LOGICAL:return .05;default:return .15}}highlightSelectedElement(e){this.nodesGroup&&(this.selectedElementId=e,this.nodesGroup.selectAll(".node circle").classed("selected",!1).attr("stroke-width",1).attr("r",i=>i.isPreview?8:15),e&&this.nodesGroup.selectAll(".node").filter(i=>i.id===e).select("circle").classed("selected",!0).attr("stroke-width",3).attr("r",18))}getElementColor(e,i){if(i)switch(i){case W.ACTIVE:return"#4CAF50";case W.INACTIVE:return"#9E9E9E";case W.FAILED:return"#F44336";case W.DEGRADED:return"#FF9800";case W.PLANNED:return"#2196F3"}switch(e){case $.OLT:return"#4CAF50";case $.ONT:return"#FF9800";case $.FDP:return"#2196F3";case $.SPLITTER:return"#9C27B0";case $.EDFA:return"#F44336";case $.MANGA:return"#795548";case $.MSAN:return"#009688";case $.TERMINAL_BOX:return"#607D8B";case $.SLACK_FIBER:return"#80DEEA";default:return"#673AB7"}}clearRender(){this.nodesGroup&&this.nodesGroup.selectAll("*").remove(),this.linksGroup&&this.linksGroup.selectAll("*").remove(),this.simulation&&this.simulation.stop()}refreshRenderSize(e,i){!this.svg||!this.simulation||(this.width=e,this.height=i,this.svg.attr("width",e).attr("height",i).attr("viewBox",`0 0 ${e} ${i}`),this.simulation.force("center",wt(e/2,i/2)),this.simulation.alpha(.3).restart())}setDarkMode(e){this.isDarkMode=e,this.nodesGroup&&this.nodesGroup.selectAll(".node text").style("fill",e?"#e0e0e0":"#333333")}initializeSimulation(){try{this.simulation=Li().force("link",bt().id(e=>e.id).distance(100)).force("charge",Fi().strength(-300)).force("center",wt(this.width/2,this.height/2)).on("tick",()=>this.updatePositions()),this.logger.debug("Simulaci\xF3n D3 inicializada con \xE9xito")}catch(e){this.logger.error("Error al inicializar la simulaci\xF3n D3:",e)}}configureDrag(){return this.simulation?Mt().on("start",(e,i)=>{e.active||this.simulation?.alphaTarget(.3).restart(),i.fx=i.x,i.fy=i.y}).on("drag",(e,i)=>{i.fx=e.x,i.fy=e.y}).on("end",(e,i)=>{e.active||this.simulation?.alphaTarget(0),i.fixed||(i.fx=null,i.fy=null)}):Mt()}getConnectionStyleByStatus(e){let i="#2196f3",r=1,l="",d=.8;switch(e.status){case W.ACTIVE:i="#4caf50",r=2;break;case W.INACTIVE:i="#9e9e9e",r=1,l="3,3",d=.5;break;case W.DEGRADED:i="#ff9800",r=2,l="5,2";break;case W.FAILED:i="#f44336",r=2;break;case W.PLANNED:i="#9c27b0",r=1.5,l="5,5",d=.6;break;default:i="#2196f3",r=1}return{stroke:i,strokeWidth:r,strokeOpacity:d,strokeDasharray:l}}getConnectionColorByType(e){switch(e.type){case de.FIBER:return"#03a9f4";case de.COPPER:return"#ff5722";case de.WIRELESS:return"#8bc34a";case de.LOGICAL:return"#9c27b0";default:return"#2196f3"}}static{this.\u0275fac=function(i){return new(i||t)(ue(fi))}}static{this.\u0275prov=X({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var on=()=>[],ur=()=>["/network-design"],an=(()=>{class t{constructor(e,i){this.store=e,this.renderService=i,this.subscriptions=[],this.elementsCount$=x(0),this.connectionsCount$=x(0),this.warningCount$=x(0),this.previewNodes$=x([]),this.previewConnections$=x([]),this.loading=!0,this.error=null}ngOnInit(){this.loadNetworkData(),this.setupAutoRefresh()}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}loadNetworkData(){this.loading=!0,this.error=null,this.store.select(e=>e.network).pipe(Dt(1),le(e=>{if(e.error)return this.error="Error al cargar los datos de la red",this.loading=!1,{elements:[],connectionsCount:0,connectionsForPreview:[],warnings:0};let i=[...e.fdps||[],...e.olts||[],...e.onts||[],...e.edfas||[],...e.splitters||[],...e.mangas||[]],r=e.fiberConnections||[],l=[];return{elements:i,connectionsCount:r.length,connectionsForPreview:l,warnings:i.filter(d=>d.status===Z.FAULT||d.status===Z.ERROR||d.status===Z.WARNING||d.status===Z.CRITICAL).length||0}})).subscribe({next:e=>{this.elementsCount$=x(e.elements.length),this.connectionsCount$=x(e.connectionsCount||0),this.warningCount$=x(e.warnings||0),this.previewNodes$=x(e.elements.map(i=>this.createNodeData(i))),this.previewConnections$=x((e.connectionsForPreview||[]).map(i=>this.createConnectionDataForPreview(i,e.elements)).filter(i=>i!==null)),this.loading=!1},error:e=>{this.error="Error al procesar datos de la red",this.loading=!1,this.elementsCount$=x(0),this.connectionsCount$=x(0),this.warningCount$=x(0),this.previewNodes$=x([]),this.previewConnections$=x([])}})}setupAutoRefresh(){let e=this.store.select(i=>i.network).pipe(le(i=>(i.fiberConnections||[]).length),Pt()).subscribe(()=>this.loadNetworkData());this.subscriptions.push(e)}onNodeClick(e){}refreshPreview(){this.loadNetworkData()}createConnectionDataForPreview(e,i){let r=i.find(Ve=>Ve.id===e.sourceElementId),l=i.find(Ve=>Ve.id===e.targetElementId);if(!r||!l||!r.position?.coordinates||!l.position?.coordinates)return null;let d=r.position.coordinates[0],h=r.position.coordinates[1],P=l.position.coordinates[0],Se=l.position.coordinates[1],Ce=P-d,pe=Se-h,Ee=Math.sqrt(Ce*Ce+pe*pe)*.5,ze=Math.atan2(pe,Ce)*(180/Math.PI),ct=d,dt=h,Ze="inactive";return e.status===W.ACTIVE&&(Ze="active"),{x:ct,y:dt,width:Ee,rotation:`rotate(${ze}deg)`,status:Ze}}createNodeData(e){let i=e.position?.coordinates?.[0]||Math.random()*90+5,r=e.position?.coordinates?.[1]||Math.random()*90+5;return{id:e.id,x:i%100,y:r%100,color:this.getElementColor(e),tooltip:`${e.name} (${e.type}) - ${e.status}`,type:e.type,status:e.status}}getElementColor(e){return e.status===Z.ERROR||e.status===Z.FAULT?"var(--error-color)":e.status===Z.WARNING?"var(--warn-color)":e.status===Z.ACTIVE?"var(--success-color)":"var(--neutral-color)"}static{this.\u0275fac=function(i){return new(i||t)(k(Hi),k(rn))}}static{this.\u0275cmp=M({type:t,selectors:[["app-network-widget"]],decls:23,vars:21,consts:[[1,"network-widget"],[1,"widget-header"],[1,"header-content"],[1,"header-icon"],[3,"elementsCount","connectionsCount","warningCount"],[3,"onNodeClick","loading","error","nodes","connections"],[1,"widget-footer"],["mat-button","","color","primary",3,"routerLink"],["mat-button","","color","accent",3,"click"]],template:function(i,r){i&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"mat-icon",3),a(4,"network_check"),o(),n(5,"h3"),a(6,"Vista Previa de Red"),o()(),C(7,"app-network-stats",4),O(8,"async"),O(9,"async"),O(10,"async"),o(),n(11,"app-network-preview",5),O(12,"async"),O(13,"async"),u("onNodeClick",function(d){return r.onNodeClick(d)}),o(),n(14,"div",6)(15,"button",7)(16,"mat-icon"),a(17,"map"),o(),a(18," Ver Mapa Completo "),o(),n(19,"button",8),u("click",function(){return r.refreshPreview()}),n(20,"mat-icon"),a(21,"refresh"),o(),a(22," Actualizar "),o()()()),i&2&&(s(7),c("elementsCount",ce(8,8,r.elementsCount$)||0)("connectionsCount",ce(9,10,r.connectionsCount$)||0)("warningCount",ce(10,12,r.warningCount$)||0),s(4),c("loading",r.loading)("error",r.error)("nodes",ce(12,14,r.previewNodes$)||De(18,on))("connections",ce(13,16,r.previewConnections$)||De(19,on)),s(4),c("routerLink",De(20,ur)))},dependencies:[w,tt,he,Ne,L,R,B,E,S,_e,te,Ji,nn],styles:[".network-widget[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;padding:var(--spacing-md);background:var(--background-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-md);transition:all .3s ease}.widget-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--spacing-md);padding-bottom:var(--spacing-sm);border-bottom:1px solid var(--border-color)}.header-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-sm)}.header-icon[_ngcontent-%COMP%]{color:var(--primary-color);font-size:24px;width:24px;height:24px}.widget-footer[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding-top:var(--spacing-sm);border-top:1px solid var(--border-color)}"]})}}return t})();function gr(t,m){t&1&&(n(0,"span"),a(1,"Dise\xF1o de Red"),o())}function hr(t,m){t&1&&(n(0,"span"),a(1,"Monitoreo"),o())}function fr(t,m){t&1&&(n(0,"span"),a(1,"Reportes"),o())}function _r(t,m){t&1&&(n(0,"span"),a(1,"Configuraci\xF3n"),o())}var sn=(()=>{class t{constructor(){this.isCompact=!1}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=M({type:t,selectors:[["app-quick-nav-menu"]],inputs:{isCompact:"isCompact"},decls:17,vars:6,consts:[[1,"quick-nav-panel"],["mat-button","","color","primary","routerLink","/network-design","matTooltip","Dise\xF1o de Red"],[4,"ngIf"],["mat-button","","color","primary","routerLink","/network-monitoring","matTooltip","Monitoreo"],["mat-button","","color","primary","routerLink","/reports","matTooltip","Reportes"],["mat-button","","color","primary","routerLink","/settings","matTooltip","Configuraci\xF3n"]],template:function(i,r){i&1&&(n(0,"div",0)(1,"button",1)(2,"mat-icon"),a(3,"device_hub"),o(),f(4,gr,2,0,"span",2),o(),n(5,"button",3)(6,"mat-icon"),a(7,"monitor_heart"),o(),f(8,hr,2,0,"span",2),o(),n(9,"button",4)(10,"mat-icon"),a(11,"assessment"),o(),f(12,fr,2,0,"span",2),o(),n(13,"button",5)(14,"mat-icon"),a(15,"settings"),o(),f(16,_r,2,0,"span",2),o()()),i&2&&(I("compact",r.isCompact),s(4),c("ngIf",!r.isCompact),s(4),c("ngIf",!r.isCompact),s(4),c("ngIf",!r.isCompact),s(4),c("ngIf",!r.isCompact))},dependencies:[w,N,R,B,E,S,j,H,he,Ne],styles:[".quick-nav-panel[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:20px;padding:10px;background-color:#f5f5f5;border-radius:4px}.quick-nav-panel.compact[_ngcontent-%COMP%]{flex-direction:column;width:fit-content}.quick-nav-panel[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:5px}.quick-nav-panel.compact[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:auto;padding:8px;border-radius:50%;aspect-ratio:1/1;justify-content:center}@media (max-width: 600px){.quick-nav-panel[_ngcontent-%COMP%]:not(.compact){flex-direction:column}}"]})}}return t})();var T=function(t){return t.CONFIG="config",t.MONITOR="monitor",t.ALERT="alert",t.SYSTEM="system",t.MAINTENANCE="maintenance",t}(T||{}),F=function(t){return t.NORMAL="ACTIVE",t.WARNING="WARNING",t.CRITICAL="FAULT",t.MAINTENANCE="MAINTENANCE",t.INACTIVE="INACTIVE",t.PLANNED="PLANNED",t.UNKNOWN="UNKNOWN",t}(F||{}),me=function(t){return t.INFO="info",t.WARNING="warning",t.ERROR="error",t.CRITICAL="critical",t}(me||{}),D=function(t){return t.OLT="OLT",t.ONT="ONT",t.FDP="FDP",t.SPLITTER="SPLITTER",t.SWITCH="SWITCH",t.ROUTER="ROUTER",t.SERVER="SERVER",t.ANTENNA="ANTENNA",t.OTHER="OTHER",t}(D||{}),y=function(t){return t.SIGNAL_STRENGTH="signal_strength",t.BANDWIDTH="bandwidth",t.LATENCY="latency",t.PACKET_LOSS="packet_loss",t.ERROR_RATE="error_rate",t.OPTICAL_POWER="optical_power",t.ATTENUATION="attenuation",t.SIGNAL_QUALITY="signal_quality",t}(y||{});var $e=(()=>{class t{constructor(e){this.http=e,this.apiUrl=`${we.apiUrl}/dashboard`,this.loadingSubject=new G(!1),this.loading$=this.loadingSubject.asObservable(),this.metricsSubject=new G([{id:"metric1",name:"Uso de CPU",value:65,unit:"%",trend:2.5,timestamp:new Date,status:F.NORMAL,type:y.SIGNAL_QUALITY,history:[{value:62,timestamp:new Date(Date.now()-36e5)},{value:58,timestamp:new Date(Date.now()-72e5)}]},{id:"metric2",name:"Memoria Disponible",value:28,unit:"%",trend:-3.5,timestamp:new Date,status:F.WARNING,type:y.SIGNAL_QUALITY,history:[{value:35,timestamp:new Date(Date.now()-36e5)},{value:32,timestamp:new Date(Date.now()-72e5)}]},{id:"metric3",name:"Tr\xE1fico de Red",value:85,unit:"Mbps",trend:5.2,timestamp:new Date,status:F.NORMAL,type:y.BANDWIDTH,history:[{value:78,timestamp:new Date(Date.now()-36e5)},{value:82,timestamp:new Date(Date.now()-72e5)}]},{id:"metric4",name:"Latencia",value:120,unit:"ms",trend:15.5,timestamp:new Date,status:F.CRITICAL,type:y.LATENCY,history:[{value:85,timestamp:new Date(Date.now()-36e5)},{value:90,timestamp:new Date(Date.now()-72e5)}]}]),this.alertsSubject=new G([{id:be(),type:me.ERROR,message:"Alta atenuaci\xF3n detectada en segmento FIBER-001",timestamp:new Date,source:"Sistema",status:"active",deviceId:"OLT-001",elementType:D.OLT,elementId:"OLT-001",fiberSegment:"FIBER-001",distance:2.5,opticalPower:-18.5,affectedElements:["ONT-001","ONT-002","ONT-003"],priority:"high",resolution:"Requiere revisi\xF3n del empalme en punto A",maintenanceSchedule:new Date(Date.now()+864e5),acknowledged:!1},{id:be(),type:me.WARNING,message:"Potencia \xF3ptica baja en ONT-003",timestamp:new Date(Date.now()-36e5),source:"Sistema",status:"active",deviceId:"ONT-003",elementType:D.ONT,elementId:"ONT-003",opticalPower:-25.5,priority:"medium",acknowledged:!1},{id:be(),type:me.INFO,message:"Mantenimiento programado en splitter SPL-002",timestamp:new Date(Date.now()-72e5),source:"Sistema",status:"active",deviceId:"SPL-002",elementType:D.SPLITTER,elementId:"SPL-002",priority:"low",maintenanceSchedule:new Date(Date.now()+1728e5),acknowledged:!0}]),this.activitiesSubject=new G([{id:be(),type:T.MAINTENANCE,action:"Mantenimiento preventivo en OLT-001",user:"admin",timestamp:new Date,details:"Limpieza de conectores y verificaci\xF3n de potencia",deviceId:"OLT-001",deviceType:D.OLT,location:"Nodo Central",maintenanceType:"preventive",elementType:D.OLT,elementId:"OLT-001",workOrderId:"WO-2024-001",technician:"Juan P\xE9rez",estimatedDuration:120,completionStatus:"in-progress"},{id:be(),type:T.MONITOR,action:"Nuevo ONT detectado",user:"sistema",timestamp:new Date(Date.now()-36e5),details:"ONT-004 conectado en puerto 1/1/1:1",deviceId:"ONT-004",deviceType:D.ONT,location:"Cliente ABC",elementType:D.ONT,elementId:"ONT-004",completionStatus:"completed"},{id:be(),type:T.ALERT,action:"Alerta de degradaci\xF3n de se\xF1al",user:"sistema",timestamp:new Date(Date.now()-72e5),details:"Degradaci\xF3n detectada en empalme SPL-001",deviceId:"SPL-001",deviceType:D.SPLITTER,location:"Nodo Secundario",fiberSegment:"FIBER-002",splicePoint:"SPL-001",affectedUsers:8,elementType:D.SPLITTER,elementId:"SPL-001",workOrderId:"WO-2024-002",completionStatus:"pending"}])}getDashboardSummary(e="day"){return this.loadingSubject.next(!0),x(this.getMockDashboardData(e)).pipe(Ie(i=>{this.metricsSubject.next(i.performanceMetrics),this.alertsSubject.next(i.alerts),this.activitiesSubject.next(i.recentActivities)}),K(500),Nt(()=>this.loadingSubject.next(!1)))}getStatCards(){return x(this.getMockDashboardData().stats).pipe(K(300))}getRecentActivities(e=10){return x(this.getMockDashboardData().recentActivities.slice(0,e)).pipe(K(400))}getPerformanceMetrics(){return x(this.getMockDashboardData().performanceMetrics).pipe(K(450))}getSystemAlerts(e=!1){let i=this.getMockDashboardData().alerts,r=e?i:i.filter(l=>!l.acknowledged);return x(r).pipe(K(350))}acknowledgeAlert(e){return this.http.patch(`${this.apiUrl}/alerts/${e}/acknowledge`,{}).pipe(le(i=>{let r=this.alertsSubject.value,l=r.findIndex(d=>d.id===e);return l!==-1&&(r[l]=i,this.alertsSubject.next(r)),!0}))}getMockDashboardData(e="day"){let i=new Date,r=d=>{let h=new Date(i);return h.setMinutes(h.getMinutes()-d),h},l=[];switch(e){case"week":l=[{id:"1",title:"Total de Clientes",value:"1,345",icon:"people",color:"#1976d2",trend:8},{id:"2",title:"Redes Activas",value:"52",icon:"wifi",color:"#4caf50",trend:15},{id:"3",title:"Ancho de Banda Total",value:"12 Gbps",icon:"speed",color:"#ff9800",trend:20},{id:"4",title:"Uptime",value:"99.5%",icon:"schedule",color:"#9c27b0",trend:-.4}];break;case"month":l=[{id:"1",title:"Total de Clientes",value:"1,502",icon:"people",color:"#1976d2",trend:22},{id:"2",title:"Redes Activas",value:"58",icon:"wifi",color:"#4caf50",trend:29},{id:"3",title:"Ancho de Banda Total",value:"15 Gbps",icon:"speed",color:"#ff9800",trend:50},{id:"4",title:"Uptime",value:"99.3%",icon:"schedule",color:"#9c27b0",trend:-.6}];break;default:l=[{id:"1",title:"Total de Clientes",value:"1,234",icon:"people",color:"#1976d2",trend:5},{id:"2",title:"Redes Activas",value:"45",icon:"wifi",color:"#4caf50",trend:0},{id:"3",title:"Ancho de Banda Total",value:"10 Gbps",icon:"speed",color:"#ff9800",trend:12},{id:"4",title:"Uptime",value:"99.9%",icon:"schedule",color:"#9c27b0",trend:.2}]}return{stats:l,recentActivities:[{id:"act1",type:T.MAINTENANCE,action:"Nueva red creada en Zona Norte",user:"admin",timestamp:r(5),deviceId:"net123",deviceType:D.OTHER},{id:"act2",type:T.MAINTENANCE,action:"Actualizaci\xF3n de firmware en OLT-001",user:"admin",timestamp:r(60),deviceId:"olt001",deviceType:D.OLT},{id:"act3",type:T.MAINTENANCE,action:"Nuevo cliente agregado: Empresa XYZ",user:"admin",timestamp:r(120),deviceId:"client456",deviceType:D.OTHER},{id:"act4",type:T.MAINTENANCE,action:"Mantenimiento programado para ma\xF1ana",user:"admin",timestamp:r(1440),deviceId:"maintenance001",deviceType:D.OTHER},{id:"act5",type:T.ALERT,action:"Alerta: Alto consumo de ancho de banda en Sector B",user:"sistema",timestamp:r(30),deviceId:"sector-b",deviceType:D.OTHER}],alerts:[{id:"alert1",type:me.WARNING,message:"Alto consumo de ancho de banda en el sector B que podr\xEDa afectar el servicio.",timestamp:r(30),source:"Sistema",status:"active",deviceId:"sector-b",elementType:D.OTHER,acknowledged:!1},{id:"alert2",type:me.ERROR,message:"El dispositivo OLT-003 est\xE1 offline y no responde a ping.",timestamp:r(45),source:"Sistema",status:"active",deviceId:"olt003",elementType:D.OLT,acknowledged:!1},{id:"alert3",type:me.INFO,message:"Hay una actualizaci\xF3n de firmware disponible para los dispositivos ONT.",timestamp:r(120),source:"Sistema",status:"active",deviceId:"system",acknowledged:!0},{id:"alert4",type:me.CRITICAL,message:"El nodo principal del centro de datos presenta fallos cr\xEDticos que requieren atenci\xF3n inmediata.",timestamp:r(15),source:"Sistema",status:"active",deviceId:"main-node",elementType:D.OTHER,acknowledged:!1}],performanceMetrics:[{id:"metric1",name:"Uso de CPU",value:65,unit:"%",trend:2.5,timestamp:i,status:F.NORMAL,type:y.SIGNAL_QUALITY,history:[{value:62,timestamp:r(60)},{value:58,timestamp:r(120)},{value:61,timestamp:r(180)},{value:65,timestamp:r(240)}]},{id:"metric2",name:"Memoria Disponible",value:28,unit:"%",trend:-3.5,timestamp:i,status:F.WARNING,type:y.SIGNAL_QUALITY,history:[{value:35,timestamp:r(60)},{value:32,timestamp:r(120)},{value:30,timestamp:r(180)},{value:28,timestamp:r(240)}]},{id:"metric3",name:"Tr\xE1fico de Red",value:85,unit:"Mbps",trend:5.2,timestamp:i,status:F.NORMAL,type:y.BANDWIDTH,history:[{value:78,timestamp:r(60)},{value:82,timestamp:r(120)},{value:80,timestamp:r(180)},{value:85,timestamp:r(240)}]},{id:"metric4",name:"Latencia",value:120,unit:"ms",trend:15.5,timestamp:i,status:F.CRITICAL,type:y.LATENCY,history:[{value:85,timestamp:r(60)},{value:90,timestamp:r(120)},{value:105,timestamp:r(180)},{value:120,timestamp:r(240)}]}]}}getMetrics(){return this.metricsSubject.asObservable()}refreshMetrics(){return this.loadingSubject.next(!0),x(this.metricsSubject.value).pipe(K(1e3))}getAlerts(){return this.alertsSubject.asObservable()}getActiveAlerts(){return this.getAlerts().pipe(le(e=>e.filter(i=>!i.acknowledged)))}refreshAlerts(){return this.loadingSubject.next(!0),x(this.alertsSubject.value).pipe(K(1e3),Ie(()=>this.loadingSubject.next(!1)))}toggleAlertStatus(e){return this.http.patch(`${this.apiUrl}/alerts/${e}/toggle`,{})}getActivities(){return this.activitiesSubject.asObservable()}refreshActivities(){return this.loadingSubject.next(!0),x(this.activitiesSubject.value).pipe(K(1e3))}exportDashboard(e){return this.loadingSubject.next(!0),x(!0).pipe(K(2e3))}getDevices(){return this.http.get(`${this.apiUrl}/devices`)}getDeviceById(e){return this.http.get(`${this.apiUrl}/devices/${e}`)}getDevicesByType(e){return this.getDevices().pipe(le(i=>i.filter(r=>r.type===e)))}createDevice(e){return this.http.post(`${this.apiUrl}/devices`,e)}updateDevice(e,i){return this.http.patch(`${this.apiUrl}/devices/${e}`,i)}deleteDevice(e){return this.http.delete(`${this.apiUrl}/devices/${e}`)}getSegments(){return this.http.get(`${this.apiUrl}/segments`)}getSegmentById(e){return this.http.get(`${this.apiUrl}/segments/${e}`)}createSegment(e){return this.http.post(`${this.apiUrl}/segments`,e)}updateSegment(e,i){return this.http.patch(`${this.apiUrl}/segments/${e}`,i)}deleteSegment(e){return this.http.delete(`${this.apiUrl}/segments/${e}`)}getConnections(){return this.http.get(`${this.apiUrl}/connections`)}getConnectionById(e){return this.http.get(`${this.apiUrl}/connections/${e}`)}createConnection(e){return this.http.post(`${this.apiUrl}/connections`,e)}updateConnection(e,i){return this.http.patch(`${this.apiUrl}/connections/${e}`,i)}deleteConnection(e){return this.http.delete(`${this.apiUrl}/connections/${e}`)}getNetwork(){return this.http.get(`${this.apiUrl}/network`)}updateNetwork(e){return this.http.patch(`${this.apiUrl}/network`,e)}getNetworkMetrics(){return this.http.get(`${this.apiUrl}/metrics`)}getDeviceMetrics(e){return this.http.get(`${this.apiUrl}/devices/${e}/metrics`)}getSegmentMetrics(e){return this.http.get(`${this.apiUrl}/segments/${e}/metrics`)}static{this.\u0275fac=function(i){return new(i||t)(ue(it))}}static{this.\u0275prov=X({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var lt=(()=>{class t{constructor(e){this.dashboardService=e,this.refreshInterval=3e4,this.loadingSubject=new G(!1),this.loading$=this.loadingSubject.asObservable(),this.statsSubject=new G([]),this.stats$=this.statsSubject.asObservable(),this.activitiesSubject=new G([]),this.activities$=this.activitiesSubject.asObservable(),this.metricsSubject=new G([]),this.metrics$=this.metricsSubject.asObservable(),this.alertsSubject=new G([]),this.alerts$=this.alertsSubject.asObservable(),this.periodSubject=new G("day"),this.period$=this.periodSubject.asObservable(),this.dashboardSummary$=Ot(this.refreshInterval).pipe(Lt(0),Ie(()=>this.loadingSubject.next(!0)),Ft(()=>this.dashboardService.getDashboardSummary(this.periodSubject.getValue())),Ie(i=>{this.statsSubject.next(i.stats),this.activitiesSubject.next(i.recentActivities),this.metricsSubject.next(i.performanceMetrics),this.alertsSubject.next(i.alerts),this.loadingSubject.next(!1)}),Rt(1))}loadDashboardData(){this.dashboardSummary$.subscribe()}getRecentActivities(e=10){return this.dashboardService.getRecentActivities(e)}getSystemAlerts(e=!1){return this.dashboardService.getSystemAlerts(e)}acknowledgeAlert(e){return this.dashboardService.acknowledgeAlert(e)}refreshAll(){this.loadingSubject.next(!0),this.dashboardService.getDashboardSummary(this.periodSubject.getValue()).subscribe(e=>{this.statsSubject.next(e.stats),this.activitiesSubject.next(e.recentActivities),this.metricsSubject.next(e.performanceMetrics),this.alertsSubject.next(e.alerts),this.loadingSubject.next(!1)})}refreshSection(e){switch(this.loadingSubject.next(!0),e){case"health":case"network":console.log("Actualizando datos de red/salud"),setTimeout(()=>this.loadingSubject.next(!1),1e3);break;case"metrics":this.dashboardService.getPerformanceMetrics().subscribe(i=>{this.metricsSubject.next(i),this.loadingSubject.next(!1)});break;case"alerts":this.dashboardService.getSystemAlerts().subscribe(i=>{this.alertsSubject.next(i),this.loadingSubject.next(!1)});break;case"activities":this.dashboardService.getRecentActivities().subscribe(i=>{this.activitiesSubject.next(i),this.loadingSubject.next(!1)});break;default:this.refreshAll()}}setPeriod(e){this.periodSubject.getValue()!==e&&(this.periodSubject.next(e),this.loadingSubject.next(!0),this.dashboardService.getDashboardSummary(e).subscribe(i=>{this.statsSubject.next(i.stats),this.activitiesSubject.next(i.recentActivities),this.metricsSubject.next(i.performanceMetrics),this.alertsSubject.next(i.alerts),this.loadingSubject.next(!1)}))}exportDashboard(e){this.loadingSubject.next(!0),console.log(`Exportando dashboard en formato ${e}`),setTimeout(()=>{alert(`Dashboard exportado en formato ${e}`),this.loadingSubject.next(!1)},1500)}static{this.\u0275fac=function(i){return new(i||t)(ue($e))}}static{this.\u0275prov=X({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var vr=(t,m,e)=>({positive:t,neutral:m,negative:e});function Cr(t,m){if(t&1&&(n(0,"div",8)(1,"mat-icon",9),a(2),o(),n(3,"span"),a(4),o()()),t&2){let e=p().$implicit,i=p();c("ngClass",Yt(4,vr,e.trend>0,e.trend===0,e.trend<0))("matTooltip",i.getTrendTooltip(e)),s(2),b(" ",e.trend>0?"trending_up":e.trend<0?"trending_down":"trending_flat"," "),s(2),g(i.getFormattedTrend(e.trend))}}function xr(t,m){if(t&1&&(n(0,"div",3)(1,"div",4)(2,"mat-icon"),a(3),o()(),n(4,"div",5)(5,"h3"),a(6),o(),n(7,"p",6),a(8),o(),f(9,Cr,5,8,"div",7),o()()),t&2){let e=m.$implicit;s(),ge("color",e.color||"#1976d2"),s(2),g(e.icon||"trending_up"),s(3),g(e.title),s(2),g(e.value),s(),c("ngIf",e.trend!==void 0)}}var cn=(()=>{class t{constructor(e){this.dashboardFacade=e,this.stats=[]}ngOnInit(){(!this.stats||this.stats.length===0)&&this.dashboardFacade.stats$.subscribe(e=>{e&&e.length>0&&(this.stats=e)})}getFormattedTrend(e){return e===0?"0%":`${e>0?"+":""}${e}%`}getTrendTooltip(e){if(e.trend===void 0)return"";if(e.trend===0)return"Sin cambios";let i=e.trend>0?"aument\xF3":"disminuy\xF3";return`${e.title} ${i} un ${Math.abs(e.trend)}% en el \xFAltimo per\xEDodo`}static{this.\u0275fac=function(i){return new(i||t)(k(lt))}}static{this.\u0275cmp=M({type:t,selectors:[["app-stat-cards"]],inputs:{stats:"stats"},decls:3,vars:1,consts:[[1,"stat-cards-wrapper"],[1,"stats-grid"],["class","stat-card",4,"ngFor","ngForOf"],[1,"stat-card"],[1,"stat-icon"],[1,"stat-content"],[1,"stat-value"],["class","stat-trend",3,"ngClass","matTooltip",4,"ngIf"],[1,"stat-trend",3,"ngClass","matTooltip"],[1,"trend-icon"]],template:function(i,r){i&1&&(n(0,"div",0)(1,"div",1),f(2,xr,10,6,"div",2),o()()),i&2&&(s(2),c("ngForOf",r.stats))},dependencies:[w,U,Y,N,L,E,S,Re,j,H],styles:[".stat-cards-wrapper[_ngcontent-%COMP%]{width:100%;padding:0}.stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px;margin-bottom:24px}.stat-card[_ngcontent-%COMP%]{display:flex;padding:16px;background-color:#fff;border-radius:8px;box-shadow:0 2px 4px #0000001a;transition:all .3s ease}.stat-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 8px #00000026}.stat-icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;font-size:2rem;margin-right:16px;width:48px;height:48px;border-radius:50%;background-color:#1976d21a}.stat-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:24px;width:24px;height:24px}.stat-content[_ngcontent-%COMP%]{flex:1}.stat-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:14px;color:#666;font-weight:500}.stat-value[_ngcontent-%COMP%]{font-size:24px;font-weight:600;margin:4px 0}.stat-trend[_ngcontent-%COMP%]{display:flex;align-items:center;font-size:12px;line-height:12px}.trend-icon[_ngcontent-%COMP%]{font-size:14px;width:14px;height:14px;margin-right:4px}.positive[_ngcontent-%COMP%]{color:#4caf50}.negative[_ngcontent-%COMP%]{color:#f44336}.neutral[_ngcontent-%COMP%]{color:#757575}@media (max-width: 768px){.stats-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}@media (max-width: 480px){.stats-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})}}return t})();function yr(t,m){if(t&1&&(n(0,"p",17),a(1),o()),t&2){let e=p().$implicit;s(),b(" ",e.details," ")}}function Mr(t,m){if(t&1&&(n(0,"span",24),a(1),o()),t&2){let e=p(3).$implicit;s(),b("(",e.deviceType,")")}}function wr(t,m){if(t&1&&(n(0,"div",20)(1,"span",21),a(2,"Dispositivo:"),o(),n(3,"span",22),a(4),o(),f(5,Mr,2,1,"span",23),o()),t&2){let e=p(2).$implicit;s(4),g(e.deviceId),s(),c("ngIf",e.deviceType)}}function br(t,m){if(t&1&&(n(0,"div",20)(1,"span",21),a(2,"Ubicaci\xF3n:"),o(),n(3,"span",22),a(4),o()()),t&2){let e=p(2).$implicit;s(4),g(e.location)}}function Sr(t,m){if(t&1&&(n(0,"div",20)(1,"span",21),a(2,"Segmento:"),o(),n(3,"span",22),a(4),o()()),t&2){let e=p(2).$implicit;s(4),g(e.fiberSegment)}}function Er(t,m){if(t&1&&(n(0,"div",20)(1,"span",21),a(2,"Tipo de mantenimiento:"),o(),n(3,"span",22),a(4),o()()),t&2){let e=p(2).$implicit;s(4),g(e.maintenanceType==="preventive"?"Preventivo":"Correctivo")}}function Tr(t,m){if(t&1&&(n(0,"div",20)(1,"span",21),a(2,"Usuarios afectados:"),o(),n(3,"span",22),a(4),o()()),t&2){let e=p(2).$implicit;s(4),g(e.affectedUsers)}}function kr(t,m){if(t&1&&(n(0,"div",20)(1,"span",21),a(2,"Orden de trabajo:"),o(),n(3,"span",22),a(4),o()()),t&2){let e=p(2).$implicit;s(4),g(e.workOrderId)}}function Ir(t,m){if(t&1&&(n(0,"div",20)(1,"span",21),a(2,"T\xE9cnico:"),o(),n(3,"span",22),a(4),o()()),t&2){let e=p(2).$implicit;s(4),g(e.technician)}}function Or(t,m){if(t&1&&(n(0,"div",20)(1,"span",21),a(2,"Duraci\xF3n estimada:"),o(),n(3,"span",22),a(4),o()()),t&2){let e=p(2).$implicit;s(4),b("",e.estimatedDuration," minutos")}}function Ar(t,m){if(t&1&&(n(0,"div",20)(1,"span",21),a(2,"Estado:"),o(),n(3,"span",22),a(4),o()()),t&2){let e=p(2).$implicit,i=p();s(4),g(i.getCompletionStatusLabel(e.completionStatus))}}function Dr(t,m){if(t&1&&(n(0,"div",18),f(1,wr,6,2,"div",19)(2,br,5,1,"div",19)(3,Sr,5,1,"div",19)(4,Er,5,1,"div",19)(5,Tr,5,1,"div",19)(6,kr,5,1,"div",19)(7,Ir,5,1,"div",19)(8,Or,5,1,"div",19)(9,Ar,5,1,"div",19),o()),t&2){let e=p().$implicit;s(),c("ngIf",e.deviceId),s(),c("ngIf",e.location),s(),c("ngIf",e.fiberSegment),s(),c("ngIf",e.maintenanceType),s(),c("ngIf",e.affectedUsers),s(),c("ngIf",e.workOrderId),s(),c("ngIf",e.technician),s(),c("ngIf",e.estimatedDuration),s(),c("ngIf",e.completionStatus)}}function Pr(t,m){if(t&1&&(n(0,"div",6)(1,"div",7)(2,"mat-icon"),a(3),o()(),n(4,"div",8)(5,"div",9)(6,"span",10),a(7),o(),n(8,"span",11),a(9),O(10,"date"),o()(),n(11,"div",12)(12,"span",13),a(13),o(),n(14,"span",14),a(15),o()(),f(16,yr,2,1,"p",15)(17,Dr,10,9,"div",16),o()()),t&2){let e=m.$implicit,i=p();s(),c("ngClass",e.type),s(2),g(i.getActivityIcon(e.type)),s(4),g(e.action),s(2),g(ee(10,9,e.timestamp,"short")),s(4),g(e.user),s(),c("matTooltip",i.getActivityTypeTooltip(e.type)),s(),b(" ",i.getActivityTypeLabel(e.type)," "),s(),c("ngIf",e.details),s(),c("ngIf",e.deviceId||e.location||e.fiberSegment)}}function Nr(t,m){t&1&&(n(0,"div",25)(1,"mat-icon"),a(2,"history"),o(),n(3,"p"),a(4,"No hay actividades recientes"),o()())}var dn=(()=>{class t{constructor(e){this.dashboardService=e,this.activities=[],this.subscription=new Te}ngOnInit(){this.subscription.add(this.dashboardService.getActivities().subscribe(e=>{this.activities=e}))}ngOnDestroy(){this.subscription.unsubscribe()}getActivityIcon(e){switch(e){case T.CONFIG:return"settings";case T.MONITOR:return"monitor";case T.ALERT:return"warning";case T.SYSTEM:return"computer";case T.MAINTENANCE:return"build";default:return"info"}}getActivityTypeLabel(e){switch(e){case T.CONFIG:return"Configuraci\xF3n";case T.MONITOR:return"Monitoreo";case T.ALERT:return"Alerta";case T.SYSTEM:return"Sistema";case T.MAINTENANCE:return"Mantenimiento";default:return e}}getActivityTypeTooltip(e){switch(e){case T.CONFIG:return"Cambios en la configuraci\xF3n del sistema";case T.MONITOR:return"Eventos de monitoreo de red";case T.ALERT:return"Alertas y notificaciones";case T.SYSTEM:return"Eventos del sistema";case T.MAINTENANCE:return"Actividades de mantenimiento";default:return""}}getCompletionStatusLabel(e){switch(e){case"pending":return"Pendiente";case"in-progress":return"En progreso";case"completed":return"Completado";case"cancelled":return"Cancelado";default:return e}}refreshActivities(){this.dashboardService.refreshActivities().subscribe(e=>{this.activities=e})}static{this.\u0275fac=function(i){return new(i||t)(k($e))}}static{this.\u0275cmp=M({type:t,selectors:[["app-recent-activities"]],decls:11,vars:2,consts:[[1,"activities-container"],[1,"activities-header"],["mat-button","","color","primary",3,"click"],[1,"activities-list"],["class","activity-item",4,"ngFor","ngForOf"],["class","no-activities",4,"ngIf"],[1,"activity-item"],[1,"activity-icon",3,"ngClass"],[1,"activity-content"],[1,"activity-header"],[1,"activity-action"],[1,"activity-time"],[1,"activity-details"],[1,"activity-user"],[1,"activity-type",3,"matTooltip"],["class","activity-description",4,"ngIf"],["class","activity-info",4,"ngIf"],[1,"activity-description"],[1,"activity-info"],["class","info-item",4,"ngIf"],[1,"info-item"],[1,"info-label"],[1,"info-value"],["class","info-type",4,"ngIf"],[1,"info-type"],[1,"no-activities"]],template:function(i,r){i&1&&(n(0,"div",0)(1,"div",1)(2,"h3"),a(3,"Actividades Recientes"),o(),n(4,"button",2),u("click",function(){return r.refreshActivities()}),n(5,"mat-icon"),a(6,"refresh"),o(),a(7," Actualizar "),o()(),n(8,"div",3),f(9,Pr,18,12,"div",4),o(),f(10,Nr,5,0,"div",5),o()),i&2&&(s(9),c("ngForOf",r.activities),s(),c("ngIf",r.activities.length===0))},dependencies:[w,U,Y,N,Pe,L,E,S,R,B,_e,j,H],styles:[".activities-container[_ngcontent-%COMP%]{padding:16px}.activities-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.activities-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:18px;font-weight:500}.activities-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.activity-item[_ngcontent-%COMP%]{display:flex;gap:12px;padding:12px;background-color:#f5f5f5;border-radius:8px}.activity-icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:40px;height:40px;border-radius:50%}.activity-icon.config[_ngcontent-%COMP%]{background-color:#e3f2fd;color:#1976d2}.activity-icon.monitor[_ngcontent-%COMP%]{background-color:#e8f5e9;color:#2e7d32}.activity-icon.alert[_ngcontent-%COMP%]{background-color:#fff3e0;color:#f57c00}.activity-icon.system[_ngcontent-%COMP%]{background-color:#f3e5f5;color:#7b1fa2}.activity-icon.maintenance[_ngcontent-%COMP%]{background-color:#fce4ec;color:#c2185b}.activity-content[_ngcontent-%COMP%]{flex:1}.activity-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px}.activity-action[_ngcontent-%COMP%]{font-weight:500}.activity-time[_ngcontent-%COMP%]{font-size:12px;color:#757575}.activity-details[_ngcontent-%COMP%]{display:flex;gap:16px;font-size:12px;color:#757575;margin-bottom:4px}.activity-description[_ngcontent-%COMP%]{margin:0 0 8px;font-size:14px;color:#424242}.activity-info[_ngcontent-%COMP%]{margin-top:8px;padding-top:8px;border-top:1px solid #e0e0e0}.info-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:4px;font-size:12px}.info-label[_ngcontent-%COMP%]{color:#757575}.info-value[_ngcontent-%COMP%]{font-weight:500}.info-type[_ngcontent-%COMP%]{color:#757575;font-size:11px}.no-activities[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:32px;color:#757575;text-align:center}.no-activities[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;margin-bottom:16px;opacity:.5}@media (max-width: 600px){.activity-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:4px}.activity-details[_ngcontent-%COMP%]{flex-direction:column;gap:4px}}"]})}}return t})();function Rr(t,m){if(t&1&&(n(0,"div",18)(1,"span",19),a(2,"Longitud de onda:"),o(),n(3,"span",20),a(4),o()()),t&2){let e=p(2).$implicit;s(4),b("",e.wavelength," nm")}}function Lr(t,m){if(t&1&&(n(0,"div",18)(1,"span",19),a(2,"Nivel de potencia:"),o(),n(3,"span",20),a(4),o()()),t&2){let e=p(2).$implicit;s(4),b("",e.powerLevel," dBm")}}function Fr(t,m){if(t&1&&(n(0,"div",18)(1,"span",19),a(2,"Atenuaci\xF3n:"),o(),n(3,"span",20),a(4),o()()),t&2){let e=p(2).$implicit;s(4),b("",e.attenuation," dB/km")}}function $r(t,m){if(t&1&&(n(0,"div",18)(1,"span",19),a(2,"Calidad de se\xF1al:"),o(),n(3,"span",20),a(4),o()()),t&2){let e=p(2).$implicit;s(4),b("",e.signalQuality,"%")}}function zr(t,m){if(t&1&&(n(0,"div",18)(1,"span",19),a(2,"BER:"),o(),n(3,"span",20),a(4),O(5,"number"),o()()),t&2){let e=p(2).$implicit;s(4),g(ee(5,1,e.bitErrorRate,"1.0-9"))}}function Vr(t,m){if(t&1&&(n(0,"div",16),f(1,Rr,5,1,"div",17)(2,Lr,5,1,"div",17)(3,Fr,5,1,"div",17)(4,$r,5,1,"div",17)(5,zr,6,4,"div",17),o()),t&2){let e=p().$implicit;s(),c("ngIf",e.wavelength),s(),c("ngIf",e.powerLevel),s(),c("ngIf",e.attenuation),s(),c("ngIf",e.signalQuality),s(),c("ngIf",e.bitErrorRate)}}function jr(t,m){if(t&1&&(n(0,"div",21)(1,"mat-icon"),a(2,"location_on"),o(),n(3,"span"),a(4),o()()),t&2){let e=p().$implicit;s(4),g(e.location)}}function Br(t,m){if(t&1&&(n(0,"div",6)(1,"div",7)(2,"mat-icon",8),a(3),o(),n(4,"span"),a(5),o()(),n(6,"div",9),a(7),o(),C(8,"mat-progress-bar",10),n(9,"div",11)(10,"span",12)(11,"mat-icon"),a(12),o(),a(13),o(),n(14,"span",13),a(15,"vs. hora anterior"),o()(),f(16,Vr,6,5,"div",14)(17,jr,5,1,"div",15),o()),t&2){let e=m.$implicit,i=p();s(2),c("color",i.getMetricColor(e.status)),s(),g(i.getMetricIcon(e.type)),s(2),g(e.name),s(2),ht("",e.value,"",i.getMetricUnit(e.type),""),s(),c("mode","determinate")("value",i.getProgressValue(e))("color",i.getMetricColor(e.status)),s(2),c("ngClass",i.getTrendClass(e.trend)),s(2),g(i.getTrendIcon(e.trend)),s(),ht(" ",e.trend,"",i.getMetricUnit(e.type)," "),s(3),c("ngIf",e.wavelength||e.powerLevel||e.attenuation),s(),c("ngIf",e.location)}}function Hr(t,m){t&1&&(n(0,"div",22)(1,"mat-icon"),a(2,"assessment"),o(),n(3,"p"),a(4,"No hay m\xE9tricas disponibles"),o()())}var mn=(()=>{class t{constructor(e){this.dashboardService=e,this.metrics=[],this.subscription=new Te}ngOnInit(){this.subscription.add(this.dashboardService.getMetrics().subscribe(e=>{this.metrics=e}))}ngOnDestroy(){this.subscription.unsubscribe()}refreshMetrics(){this.dashboardService.refreshMetrics().subscribe(e=>{this.metrics=e})}getMetricIcon(e){switch(e){case y.OPTICAL_POWER:return"power";case y.ATTENUATION:return"trending_down";case y.SIGNAL_STRENGTH:return"signal_cellular_alt";case y.BANDWIDTH:return"speed";case y.LATENCY:return"timer";case y.PACKET_LOSS:return"error_outline";case y.ERROR_RATE:return"warning";case y.SIGNAL_QUALITY:return"network_check";default:return"assessment"}}getMetricUnit(e){switch(e){case y.OPTICAL_POWER:return"dBm";case y.ATTENUATION:return"dB/km";case y.SIGNAL_STRENGTH:return"dBm";case y.BANDWIDTH:return"Mbps";case y.LATENCY:return"ms";case y.PACKET_LOSS:return"%";case y.ERROR_RATE:return"%";case y.SIGNAL_QUALITY:return"%";default:return""}}getMetricColor(e){switch(e){case F.NORMAL:return"primary";case F.WARNING:return"accent";case F.CRITICAL:return"warn";case F.MAINTENANCE:return"accent";case F.INACTIVE:case F.PLANNED:case F.UNKNOWN:default:return"primary"}}getProgressValue(e){switch(e.type){case y.OPTICAL_POWER:return Math.min(100,Math.max(0,(e.value+30)/20*100));case y.ATTENUATION:return Math.min(100,Math.max(0,(1-e.value)*100));case y.BANDWIDTH:return Math.min(100,e.value/1e3*100);case y.LATENCY:return Math.min(100,Math.max(0,(1-e.value/100)*100));case y.PACKET_LOSS:return Math.min(100,Math.max(0,(1-e.value/5)*100));case y.SIGNAL_QUALITY:return e.value;default:return 50}}getTrendIcon(e){return e>0?"trending_up":e<0?"trending_down":"trending_flat"}getTrendClass(e){return e>0?"positive":e<0?"negative":"neutral"}static{this.\u0275fac=function(i){return new(i||t)(k($e))}}static{this.\u0275cmp=M({type:t,selectors:[["app-performance-metrics"]],decls:11,vars:2,consts:[[1,"metrics-container"],[1,"metrics-header"],["mat-button","","color","primary",3,"click"],[1,"metrics-grid"],["class","metric-item",4,"ngFor","ngForOf"],["class","no-metrics",4,"ngIf"],[1,"metric-item"],[1,"metric-header"],[3,"color"],[1,"metric-value"],[3,"mode","value","color"],[1,"metric-footer"],[1,"trend",3,"ngClass"],[1,"period"],["class","metric-details",4,"ngIf"],["class","metric-location",4,"ngIf"],[1,"metric-details"],["class","detail-item",4,"ngIf"],[1,"detail-item"],[1,"detail-label"],[1,"detail-value"],[1,"metric-location"],[1,"no-metrics"]],template:function(i,r){i&1&&(n(0,"div",0)(1,"div",1)(2,"h3"),a(3,"M\xE9tricas de Rendimiento"),o(),n(4,"button",2),u("click",function(){return r.refreshMetrics()}),n(5,"mat-icon"),a(6,"refresh"),o(),a(7," Actualizar "),o()(),n(8,"div",3),f(9,Br,18,14,"div",4),o(),f(10,Hr,5,0,"div",5),o()),i&2&&(s(9),c("ngForOf",r.metrics),s(),c("ngIf",r.metrics.length===0))},dependencies:[w,U,Y,N,Qt,L,E,S,Re,rt,j,R,B],styles:[".metrics-container[_ngcontent-%COMP%]{padding:16px}.metrics-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.metrics-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:18px;font-weight:500}.metrics-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px}.metric-item[_ngcontent-%COMP%]{background-color:#f5f5f5;border-radius:8px;padding:16px}.metric-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:12px}.metric-value[_ngcontent-%COMP%]{font-size:24px;font-weight:500;margin-bottom:8px}.metric-footer[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-top:8px;font-size:14px}.trend[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px}.trend.positive[_ngcontent-%COMP%]{color:#4caf50}.trend.negative[_ngcontent-%COMP%]{color:#f44336}.trend.neutral[_ngcontent-%COMP%]{color:#9e9e9e}.period[_ngcontent-%COMP%]{color:#757575}.metric-details[_ngcontent-%COMP%]{margin-top:12px;padding-top:12px;border-top:1px solid #e0e0e0}.detail-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:4px;font-size:12px}.detail-label[_ngcontent-%COMP%]{color:#757575}.detail-value[_ngcontent-%COMP%]{font-weight:500}.metric-location[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;margin-top:8px;font-size:12px;color:#757575}.metric-location[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px}.no-metrics[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:32px;color:#757575;text-align:center}.no-metrics[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;margin-bottom:16px;opacity:.5}@media (max-width: 600px){.metrics-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})}}return t})();var Wr=t=>({compact:t}),Gr=t=>({lat:19.78375,lng:t});function Ur(t,m){if(t&1){let e=V();n(0,"div",29)(1,"mat-card")(2,"mat-card-header")(3,"mat-card-title"),a(4,"Personalizar Dashboard"),o(),n(5,"button",30),u("click",function(){_(e);let r=p();return v(r.toggleCustomization())}),n(6,"mat-icon"),a(7,"close"),o()()(),n(8,"mat-card-content")(9,"h4"),a(10,"Mostrar/Ocultar Secciones"),o(),n(11,"div",31)(12,"mat-button-toggle",32),u("change",function(){_(e);let r=p();return v(r.toggleSection("statCards"))}),a(13," Estad\xEDsticas "),o(),n(14,"mat-button-toggle",32),u("change",function(){_(e);let r=p();return v(r.toggleSection("activities"))}),a(15," Actividades "),o(),n(16,"mat-button-toggle",32),u("change",function(){_(e);let r=p();return v(r.toggleSection("perfMetrics"))}),a(17," M\xE9tricas Detalladas "),o(),n(18,"mat-button-toggle",32),u("change",function(){_(e);let r=p();return v(r.toggleSection("health"))}),a(19," Salud de Red "),o(),n(20,"mat-button-toggle",32),u("change",function(){_(e);let r=p();return v(r.toggleSection("map"))}),a(21," Mapa "),o(),n(22,"mat-button-toggle",32),u("change",function(){_(e);let r=p();return v(r.toggleSection("metrics"))}),a(23," M\xE9tricas "),o(),n(24,"mat-button-toggle",32),u("change",function(){_(e);let r=p();return v(r.toggleSection("alerts"))}),a(25," Alertas "),o(),n(26,"mat-button-toggle",32),u("change",function(){_(e);let r=p();return v(r.toggleSection("network"))}),a(27," Vista Previa de Red "),o()()()()()}if(t&2){let e=p();s(12),c("checked",!e.hiddenSections.includes("statCards")),s(2),c("checked",!e.hiddenSections.includes("activities")),s(2),c("checked",!e.hiddenSections.includes("perfMetrics")),s(2),c("checked",!e.hiddenSections.includes("health")),s(2),c("checked",!e.hiddenSections.includes("map")),s(2),c("checked",!e.hiddenSections.includes("metrics")),s(2),c("checked",!e.hiddenSections.includes("alerts")),s(2),c("checked",!e.hiddenSections.includes("network"))}}function Yr(t,m){t&1&&(n(0,"div",33),C(1,"mat-spinner",34),n(2,"p"),a(3,"Cargando datos..."),o()())}var Ml=(()=>{class t{constructor(e,i,r,l){this.breakpointObserver=e,this.dashboardFacade=i,this.router=r,this.snackBar=l,this.subscriptions=new Te,this.isCompactView=!1,this.isCustomizationEnabled=!1,this.selectedPeriod="day",this.hiddenSections=[],this.isNavigating=!1}get loading$(){return this.dashboardFacade.loading$}ngOnInit(){this.subscriptions.add(this.breakpointObserver.observe([Ct.Handset,Ct.Small]).subscribe(e=>{this.isCompactView=e.matches})),this.dashboardFacade.loadDashboardData(),this.preconfigureNetworkDesignRoute()}preconfigureNetworkDesignRoute(){let e;this.router.config.forEach(i=>{if(i.path===""&&i.component&&i.children){let r=i.children.find(l=>l.path===""&&l.component);r&&r.children&&(e=r.children.find(l=>l.path==="network-design"),e&&(console.log("Encontrada ruta network-design para precarga"),e.data||(e.data={}),e.data=ye(xe({},e.data),{preload:!0,priority:"high"}),!e.component&&!e.loadChildren&&console.warn("La ruta network-design no tiene loadChildren o component configurado correctamente")))}}),e||console.warn("No se encontr\xF3 la ruta network-design para precargar")}ngOnDestroy(){this.subscriptions.unsubscribe()}refreshDashboard(){this.dashboardFacade.refreshAll()}refreshSection(e){this.dashboardFacade.refreshSection(e)}toggleSection(e){let i=this.hiddenSections.indexOf(e);i===-1?this.hiddenSections.push(e):this.hiddenSections.splice(i,1)}changePeriod(e){this.selectedPeriod=e,this.dashboardFacade.setPeriod(e)}toggleCustomization(){this.isCustomizationEnabled=!this.isCustomizationEnabled}exportDashboard(e){this.dashboardFacade.exportDashboard(e)}navegarAMapaCompleto(e){if(this.isNavigating)return;this.isNavigating=!0;let i=document.createElement("iframe");i.style.position="absolute",i.style.width="10px",i.style.height="10px",i.style.opacity="0.01",i.style.zIndex="-1000",i.style.pointerEvents="none";let r=this.snackBar.open("Preparando mapa de red...","",{duration:0,panelClass:["info-snackbar"]});document.body.appendChild(i);let l=setTimeout(()=>{console.log("Timer de seguridad activado, usando navegaci\xF3n directa");try{document.body.removeChild(i)}catch{}let h={};e&&(e.center&&(h.lat=e.center.lat.toFixed(6),h.lng=e.center.lng.toFixed(6)),e.zoom&&(h.zoom=e.zoom)),this.router.navigate(["/network-design/map"],{queryParams:h}).then(()=>this.completarNavegacion(r),()=>{r.dismiss(),this.snackBar.open("No se pudo cargar el mapa, intentando nuevamente en modo b\xE1sico...","",{duration:3e3,panelClass:["warning-snackbar"]}),this.router.navigate(["/network-design"],{queryParams:{mode:"minimal"}}).catch(()=>this.isNavigating=!1)})},6e3),d=h=>{h.data==="map-assets-loaded"&&(clearTimeout(l),window.removeEventListener("message",d),this.procederAMapaReal(i,r,e))};window.addEventListener("message",d);try{i.contentWindow&&(i.contentWindow.location.href="/assets/loading-map.html",setTimeout(()=>{try{i.contentWindow&&(i.contentWindow.location.href="/network-design?preload=true")}catch(h){console.error("Error en precarga iframe:",h)}setTimeout(()=>{this.procederAMapaReal(i,r,e)},1500)},1e3))}catch(h){console.error("Error configurando iframe:",h),clearTimeout(l),document.body.removeChild(i);let P={};e&&e.center&&(P.lat=e.center.lat.toFixed(6),P.lng=e.center.lng.toFixed(6),e.zoom&&(P.zoom=e.zoom)),this.router.navigate(["/network-design/map"],{queryParams:P}).catch(()=>this.isNavigating=!1)}}procederAMapaReal(e,i,r){i.dismiss();let l=this.snackBar.open("Cargando mapa...","",{duration:0,panelClass:["info-snackbar"]});try{document.body.removeChild(e)}catch{}let d={preloaded:"true"};r&&(r.center&&(d.lat=r.center.lat.toFixed(6),d.lng=r.center.lng.toFixed(6)),r.zoom&&(d.zoom=r.zoom)),this.router.navigate(["/network-design/map"],{queryParams:d}).then(()=>{l.dismiss(),this.isNavigating=!1,this.snackBar.open("Mapa cargado correctamente","",{duration:1500,panelClass:["success-snackbar"]})},h=>{console.error("Error en navegaci\xF3n final:",h),l.dismiss(),this.isNavigating=!1,this.snackBar.open("Error al cargar el mapa completo. Cargando versi\xF3n b\xE1sica...","",{duration:3e3,panelClass:["warning-snackbar"]}),this.router.navigate(["/network-design"],{queryParams:{mode:"minimal"}})})}completarNavegacion(e){console.log("Navegaci\xF3n completada"),e&&e.dismiss(),setTimeout(()=>{this.isNavigating=!1},1e3)}onFullMapRequested(e){console.log("[MiniMapWidget] Solicitud de mapa completo:",e)}onMiniMapClicked(e){console.log("[MiniMapWidget] Clic en mini-mapa:",e)}onMiniMapError(e){console.error("[MiniMapWidget] Error:",e)}static{this.\u0275fac=function(i){return new(i||t)(k(Jt),k(lt),k(Zt),k(hi))}}static{this.\u0275cmp=M({type:t,selectors:[["app-dashboard-layout"]],decls:213,vars:46,consts:[["dashMenu","matMenu"],["statCardsMenu","matMenu"],["activitiesMenu","matMenu"],["perfMetricsMenu","matMenu"],["healthMenu","matMenu"],["mapMenu","matMenu"],["metricsMenu","matMenu"],["alertsMenu","matMenu"],["networkMenu","matMenu"],[1,"dashboard-container"],[1,"dashboard-header"],[1,"header-left"],[1,"dashboard-period-selector"],[3,"change","value"],["value","day","matTooltip","Mostrar datos del d\xEDa"],["value","week","matTooltip","Mostrar datos de la semana"],["value","month","matTooltip","Mostrar datos del mes"],[1,"header-actions"],["mat-button","","color","primary","matTooltip","Actualizar todos los datos",3,"click"],["mat-button","","matTooltip","M\xE1s opciones",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],[3,"isCompact"],[1,"dashboard-section","wide-section"],["mat-icon-button","",1,"section-menu-button",3,"matMenuTriggerFor"],[1,"dashboard-grid",3,"ngClass"],[1,"dashboard-section"],[3,"fullMapRequested","mapClicked","errorOccurred","title","height","zoomLevel","centerCoordinates","showActions","openMapButtonText"],["class","customization-panel",4,"ngIf"],["class","loading-overlay",4,"ngIf"],[1,"customization-panel"],["mat-icon-button","",3,"click"],[1,"section-toggles"],[3,"change","checked"],[1,"loading-overlay"],["diameter","50"]],template:function(i,r){if(i&1){let l=V();n(0,"div",9),O(1,"async"),n(2,"div",10)(3,"div",11)(4,"h1"),a(5,"Dashboard"),o(),n(6,"div",12)(7,"mat-button-toggle-group",13),u("change",function(h){return _(l),v(r.changePeriod(h.value))}),n(8,"mat-button-toggle",14),a(9,"Hoy"),o(),n(10,"mat-button-toggle",15),a(11,"Semana"),o(),n(12,"mat-button-toggle",16),a(13,"Mes"),o()()()(),n(14,"div",17)(15,"button",18),u("click",function(){return _(l),v(r.refreshDashboard())}),n(16,"mat-icon"),a(17,"refresh"),o(),a(18," Actualizar "),o(),n(19,"button",19)(20,"mat-icon"),a(21,"more_vert"),o()(),n(22,"mat-menu",null,0)(24,"button",20),u("click",function(){return _(l),v(r.exportDashboard("pdf"))}),n(25,"mat-icon"),a(26,"picture_as_pdf"),o(),n(27,"span"),a(28,"Exportar como PDF"),o()(),n(29,"button",20),u("click",function(){return _(l),v(r.exportDashboard("excel"))}),n(30,"mat-icon"),a(31,"table_chart"),o(),n(32,"span"),a(33,"Exportar como Excel"),o()(),C(34,"mat-divider"),n(35,"button",20),u("click",function(){return _(l),v(r.toggleCustomization())}),n(36,"mat-icon"),a(37,"dashboard_customize"),o(),n(38,"span"),a(39,"Personalizar dashboard"),o()()()()(),C(40,"app-quick-nav-menu",21),n(41,"mat-card",22)(42,"mat-card-header")(43,"mat-card-title"),a(44,"Estad\xEDsticas Principales"),o(),n(45,"button",23)(46,"mat-icon"),a(47,"more_vert"),o()(),n(48,"mat-menu",null,1)(50,"button",20),u("click",function(){return _(l),v(r.refreshSection("statCards"))}),n(51,"mat-icon"),a(52,"refresh"),o(),n(53,"span"),a(54,"Actualizar"),o()(),n(55,"button",20),u("click",function(){return _(l),v(r.toggleSection("statCards"))}),n(56,"mat-icon"),a(57,"visibility_off"),o(),n(58,"span"),a(59,"Ocultar"),o()()()(),n(60,"mat-card-content"),C(61,"app-stat-cards"),o()(),n(62,"mat-card",22)(63,"mat-card-header")(64,"mat-card-title"),a(65,"Actividades Recientes"),o(),n(66,"button",23)(67,"mat-icon"),a(68,"more_vert"),o()(),n(69,"mat-menu",null,2)(71,"button",20),u("click",function(){return _(l),v(r.refreshSection("activities"))}),n(72,"mat-icon"),a(73,"refresh"),o(),n(74,"span"),a(75,"Actualizar"),o()(),n(76,"button",20),u("click",function(){return _(l),v(r.toggleSection("activities"))}),n(77,"mat-icon"),a(78,"visibility_off"),o(),n(79,"span"),a(80,"Ocultar"),o()()()(),n(81,"mat-card-content"),C(82,"app-recent-activities"),o()(),n(83,"mat-card",22)(84,"mat-card-header")(85,"mat-card-title"),a(86,"M\xE9tricas de Rendimiento Detalladas"),o(),n(87,"button",23)(88,"mat-icon"),a(89,"more_vert"),o()(),n(90,"mat-menu",null,3)(92,"button",20),u("click",function(){return _(l),v(r.refreshSection("perfMetrics"))}),n(93,"mat-icon"),a(94,"refresh"),o(),n(95,"span"),a(96,"Actualizar"),o()(),n(97,"button",20),u("click",function(){return _(l),v(r.toggleSection("perfMetrics"))}),n(98,"mat-icon"),a(99,"visibility_off"),o(),n(100,"span"),a(101,"Ocultar"),o()()()(),n(102,"mat-card-content"),C(103,"app-performance-metrics"),o()(),n(104,"div",24)(105,"mat-card",25)(106,"mat-card-header")(107,"mat-card-title"),a(108,"Salud de la Red"),o(),n(109,"button",23)(110,"mat-icon"),a(111,"more_vert"),o()(),n(112,"mat-menu",null,4)(114,"button",20),u("click",function(){return _(l),v(r.refreshSection("health"))}),n(115,"mat-icon"),a(116,"refresh"),o(),n(117,"span"),a(118,"Actualizar"),o()(),n(119,"button",20),u("click",function(){return _(l),v(r.toggleSection("health"))}),n(120,"mat-icon"),a(121,"visibility_off"),o(),n(122,"span"),a(123,"Ocultar"),o()()()(),n(124,"mat-card-content"),C(125,"app-network-health-widget"),o()(),n(126,"mat-card",25)(127,"mat-card-header")(128,"mat-card-title"),a(129,"Mapa de Red"),o(),n(130,"button",23)(131,"mat-icon"),a(132,"more_vert"),o()(),n(133,"mat-menu",null,5)(135,"button",20),u("click",function(){return _(l),v(r.refreshSection("map"))}),n(136,"mat-icon"),a(137,"refresh"),o(),n(138,"span"),a(139,"Actualizar"),o()(),n(140,"button",20),u("click",function(){return _(l),v(r.toggleSection("map"))}),n(141,"mat-icon"),a(142,"visibility_off"),o(),n(143,"span"),a(144,"Ocultar"),o()()()(),n(145,"mat-card-content")(146,"app-mini-map-widget",26),u("fullMapRequested",function(h){return _(l),v(r.onFullMapRequested(h))})("mapClicked",function(h){return _(l),v(r.onMiniMapClicked(h))})("errorOccurred",function(h){return _(l),v(r.onMiniMapError(h))}),o()()(),n(147,"mat-card",25)(148,"mat-card-header")(149,"mat-card-title"),a(150,"M\xE9tricas de Rendimiento"),o(),n(151,"button",23)(152,"mat-icon"),a(153,"more_vert"),o()(),n(154,"mat-menu",null,6)(156,"button",20),u("click",function(){return _(l),v(r.refreshSection("metrics"))}),n(157,"mat-icon"),a(158,"refresh"),o(),n(159,"span"),a(160,"Actualizar"),o()(),n(161,"button",20),u("click",function(){return _(l),v(r.toggleSection("metrics"))}),n(162,"mat-icon"),a(163,"visibility_off"),o(),n(164,"span"),a(165,"Ocultar"),o()()()(),n(166,"mat-card-content"),C(167,"app-metrics-widget"),o()(),n(168,"mat-card",22)(169,"mat-card-header")(170,"mat-card-title"),a(171,"Alertas del Sistema"),o(),n(172,"button",23)(173,"mat-icon"),a(174,"more_vert"),o()(),n(175,"mat-menu",null,7)(177,"button",20),u("click",function(){return _(l),v(r.refreshSection("alerts"))}),n(178,"mat-icon"),a(179,"refresh"),o(),n(180,"span"),a(181,"Actualizar"),o()(),n(182,"button",20),u("click",function(){return _(l),v(r.toggleSection("alerts"))}),n(183,"mat-icon"),a(184,"visibility_off"),o(),n(185,"span"),a(186,"Ocultar"),o()()()(),n(187,"mat-card-content"),C(188,"app-system-alerts-widget"),o()(),n(189,"mat-card",25)(190,"mat-card-header")(191,"mat-card-title"),a(192,"Vista Previa de Red"),o(),n(193,"button",23)(194,"mat-icon"),a(195,"more_vert"),o()(),n(196,"mat-menu",null,8)(198,"button",20),u("click",function(){return _(l),v(r.refreshSection("network"))}),n(199,"mat-icon"),a(200,"refresh"),o(),n(201,"span"),a(202,"Actualizar"),o()(),n(203,"button",20),u("click",function(){return _(l),v(r.toggleSection("network"))}),n(204,"mat-icon"),a(205,"visibility_off"),o(),n(206,"span"),a(207,"Ocultar"),o()()()(),n(208,"mat-card-content"),C(209,"app-network-widget"),o()()(),f(210,Ur,28,8,"div",27)(211,Yr,4,0,"div",28),O(212,"async"),o()}if(i&2){let l=J(23),d=J(49),h=J(70),P=J(91),Se=J(113),Ce=J(134),pe=J(155),Ee=J(176),ze=J(197);I("loading",ce(1,38,r.loading$)),s(7),c("value",r.selectedPeriod),s(12),c("matMenuTriggerFor",l),s(21),c("isCompact",r.isCompactView),s(),I("hidden",r.hiddenSections.includes("statCards")),s(4),c("matMenuTriggerFor",d),s(17),I("hidden",r.hiddenSections.includes("activities")),s(4),c("matMenuTriggerFor",h),s(17),I("hidden",r.hiddenSections.includes("perfMetrics")),s(4),c("matMenuTriggerFor",P),s(17),c("ngClass",Me(42,Wr,r.isCompactView)),s(),I("hidden",r.hiddenSections.includes("health")),s(4),c("matMenuTriggerFor",Se),s(17),I("hidden",r.hiddenSections.includes("map")),s(4),c("matMenuTriggerFor",Ce),s(16),c("title","Mini Mapa de Red")("height",200)("zoomLevel",12)("centerCoordinates",Me(44,Gr,-70.67667))("showActions",!0)("openMapButtonText","Ver mapa completo"),s(),I("hidden",r.hiddenSections.includes("metrics")),s(4),c("matMenuTriggerFor",pe),s(17),I("hidden",r.hiddenSections.includes("alerts")),s(4),c("matMenuTriggerFor",Ee),s(17),I("hidden",r.hiddenSections.includes("network")),s(4),c("matMenuTriggerFor",ze),s(17),c("ngIf",r.isCustomizationEnabled),s(),c("ngIf",ce(212,40,r.loading$))}},dependencies:[w,U,N,tt,L,ne,oe,ae,re,Wi,E,S,R,B,ie,ai,ri,ni,oi,te,fe,ti,_e,di,ji,zi,Vi,j,H,he,Ui,Zi,Ki,Xi,an,sn,cn,dn,mn],styles:[".dashboard-container[_ngcontent-%COMP%]{padding:20px;position:relative;min-height:100vh}.dashboard-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.dashboard-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:28px;font-weight:500;color:#333}.header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:20px}.dashboard-period-selector[_ngcontent-%COMP%]{margin-left:10px}.dashboard-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:20px}@media (max-width: 960px){.dashboard-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.dashboard-grid[_ngcontent-%COMP%]{margin-bottom:20px}.dashboard-grid.compact[_ngcontent-%COMP%]{grid-template-columns:1fr}.dashboard-section[_ngcontent-%COMP%]{border-radius:8px;box-shadow:0 2px 4px #0000001a;background-color:#fff;overflow:hidden;margin-bottom:16px}.dashboard-section.wide-section[_ngcontent-%COMP%]{grid-column:span 2}@media (max-width: 960px){.dashboard-section.wide-section[_ngcontent-%COMP%]{grid-column:span 1}}.hidden[_ngcontent-%COMP%]{display:none}.section-menu-button[_ngcontent-%COMP%]{position:absolute;right:8px;top:8px}.customization-panel[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:1000;width:100%;max-width:500px}.customization-panel[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]{border-radius:8px;box-shadow:0 2px 4px #0000001a;background-color:#fff;overflow:hidden}.section-toggles[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}.loading-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background-color:#ffffffb3;display:flex;align-items:center;justify-content:center;flex-direction:column;z-index:1000}.loading-overlay[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:16px;color:#666}app-quick-nav-menu[_ngcontent-%COMP%]{display:block;margin:0 0 20px}"]})}}return t})();export{Ml as a};
