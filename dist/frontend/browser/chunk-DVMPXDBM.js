import{a as zt}from"./chunk-H554YTGL.js";import{a as lt}from"./chunk-MHWJR3EV.js";import"./chunk-E7SS3VLG.js";import{c as S,d as f,g as m,h as $,j as w,k as ot,l as st}from"./chunk-N7T535CU.js";import{e as Pt}from"./chunk-KIEZATJL.js";import{a as C,b as d}from"./chunk-VONGITAP.js";import{h as Nt}from"./chunk-GQNYZBS2.js";import{d as Wt}from"./chunk-NI7QRJ7Q.js";import{a as kt,b as At}from"./chunk-F5P253LU.js";import{a as j}from"./chunk-QQ6SKILC.js";import"./chunk-VMUGXP3O.js";import{a as It,b as Et}from"./chunk-D3FDFS7S.js";import"./chunk-RWQWO3EM.js";import{a as rt}from"./chunk-4RASZFGW.js";import"./chunk-JO2MD4NL.js";import{a as J,b as Q,i as Mt,j as Tt,n as tt}from"./chunk-XJSBNB6N.js";import{v as Dt,w as Ot}from"./chunk-VH7SA6GK.js";import"./chunk-4PHUDKEH.js";import{$a as s,$b as _,$c as Z,Aa as D,F as B,Gb as o,Ha as ht,Hb as r,Ib as X,Ja as M,Ka as ft,Lc as q,Mb as O,Mc as yt,Na as wt,Nc as K,Ob as W,Pb as u,Tc as bt,_b as c,ac as N,bc as at,cb as vt,f as gt,g as R,id as St,ja as V,kb as Y,mb as xt,mc as H,n as nt,nc as F,oa as L,ob as _t,pa as E,qb as x,s as U,xb as p,ya as ut,yb as Ct,za as A}from"./chunk-FG6FKNI4.js";import{a as y,b}from"./chunk-OXVY4BEJ.js";var Lt=(()=>{class n{constructor(t,e){this.logger=t,this.zone=e}initializeWidget(t,e,i={}){try{let a=t.nativeElement;e.addClass(a,"widget-container"),i.minWidth&&e.setStyle(a,"min-width",`${i.minWidth}px`),i.minHeight&&e.setStyle(a,"min-height",`${i.minHeight}px`),i.maxWidth&&e.setStyle(a,"max-width",`${i.maxWidth}px`),i.maxHeight&&e.setStyle(a,"max-height",`${i.maxHeight}px`),i.position&&e.addClass(a,`widget-position-${i.position}`),i.zIndex!==void 0&&e.setStyle(a,"z-index",i.zIndex),i.customClass&&i.customClass.length>0&&i.customClass.forEach(g=>{e.addClass(a,g)});let l=a.getBoundingClientRect();return l.width===0||l.height===0?{success:!1,elementRef:t,errorMessage:"Dimensiones del widget inv\xE1lidas (0x0)"}:{success:!0,elementRef:t,dimensions:{width:l.width,height:l.height}}}catch(a){return this.logger.error("Error al inicializar widget:",a),{success:!1,elementRef:t,errorMessage:a instanceof Error?a.message:"Error desconocido"}}}setupDraggableWidget(t,e,i,a){try{let l=t.nativeElement,g=l.querySelector(i);if(!g){this.logger.warn(`No se encontr\xF3 el selector de arrastre "${i}" en el widget`);return}e.setStyle(g,"cursor","move"),e.setAttribute(l,"draggable","false");let v=!1,P=0,I=0,k=a?document.getElementById(a):document.body;if(!k){this.logger.warn(`No se encontr\xF3 el contenedor "${a}" para el widget arrastrable`);return}e.addClass(l,"widget-draggable");let ct=T=>{if(T.button!==0)return;T.preventDefault();let z=l.getBoundingClientRect();P=T.clientX-z.left,I=T.clientY-z.top,v=!0,e.addClass(l,"widget-dragging"),e.setStyle(l,"position","absolute")},dt=T=>{v&&(T.preventDefault(),this.zone.run(()=>{let z=k.getBoundingClientRect(),et=T.clientX-z.left-P,it=T.clientY-z.top-I,pt=l.getBoundingClientRect();et=Math.max(0,Math.min(et,z.width-pt.width)),it=Math.max(0,Math.min(it,z.height-pt.height)),e.setStyle(l,"left",`${et}px`),e.setStyle(l,"top",`${it}px`)}))},mt=T=>{v&&(T.preventDefault(),v=!1,e.removeClass(l,"widget-dragging"))};g.addEventListener("mousedown",ct),document.addEventListener("mousemove",dt),document.addEventListener("mouseup",mt);let Bt=()=>{g.removeEventListener("mousedown",ct),document.removeEventListener("mousemove",dt),document.removeEventListener("mouseup",mt)};l._draggableCleanup=Bt}catch(l){this.logger.error("Error al configurar widget arrastrable:",l)}}showWidgetError(t,e,i,a){try{let l=i.nativeElement,g=a.createElement("div");a.addClass(g,"widget-error");let v=a.createElement("span");a.addClass(v,"error-icon"),a.appendChild(v,a.createText("\u26A0\uFE0F"));let P=a.createElement("span");a.appendChild(P,a.createText(`Error en ${e}: ${t}`)),a.appendChild(g,v),a.appendChild(g,P),a.setProperty(l,"innerHTML",""),a.appendChild(l,g),a.setStyle(g,"background-color","#ffebee"),a.setStyle(g,"color","#c62828"),a.setStyle(g,"padding","8px 12px"),a.setStyle(g,"border-radius","4px"),a.setStyle(g,"margin","8px"),a.setStyle(g,"font-size","12px"),a.setStyle(g,"display","flex"),a.setStyle(g,"align-items","center"),a.setStyle(g,"gap","8px")}catch(l){this.logger.error("Error al mostrar error de widget:",l)}}static{this.\u0275fac=function(e){return new(e||n)(L(j),L(ft))}}static{this.\u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var Rt=(()=>{class n{constructor(t){this.logger=t,this.performanceMetrics=new gt,this.performanceMetrics$=this.performanceMetrics.asObservable(),this.dashboardStats=new R({totalWidgets:0,averageWidgetRenderTime:0,averageWidgetUpdateTime:0,totalUpdates:0,lastCalculated:new Date}),this.dashboardStats$=this.dashboardStats.asObservable(),this.metricsByWidget=new Map,this.widgetSummaries=new Map,this.monitoringEnabled=!0,this.logger.info("Servicio de monitoreo de rendimiento inicializado")}setMonitoringEnabled(t){this.monitoringEnabled=t,this.logger.debug(`Monitoreo de rendimiento ${t?"activado":"desactivado"}`)}recordMetric(t){if(!this.monitoringEnabled)return;let e=b(y({},t),{timestamp:t.timestamp||new Date});if(this.performanceMetrics.next(e),e.widgetId){this.metricsByWidget.has(e.widgetId)||this.metricsByWidget.set(e.widgetId,[]),this.metricsByWidget.get(e.widgetId)?.push(e);let i=this.metricsByWidget.get(e.widgetId);i&&i.length>100&&i.shift(),this.updateWidgetSummary(e)}this.calculateDashboardStats()}startMeasurement(t,e,i,a){if(!this.monitoringEnabled)return()=>{};let l=performance.now();return()=>{let v=performance.now()-l;this.recordMetric({widgetId:i,componentType:t,metricType:e,value:v,timestamp:new Date,context:a})}}getWidgetSummary(t){return this.widgetSummaries.get(t)}getAllWidgetSummaries(){return Array.from(this.widgetSummaries.values())}getWidgetMetricHistory(t){return this.metricsByWidget.get(t)||[]}clearAllMetrics(){this.metricsByWidget.clear(),this.widgetSummaries.clear(),this.calculateDashboardStats()}updateWidgetSummary(t){if(!t.widgetId)return;let e=t.widgetId,i=this.widgetSummaries.get(e);switch(i||(i={widgetId:e,componentType:t.componentType,averageRenderTime:0,averageUpdateTime:0,updateCount:0,lastUpdated:new Date}),t.metricType){case"render":i.averageRenderTime=this.calculateRunningAverage(i.averageRenderTime,t.value,i.updateCount+1);break;case"update":i.averageUpdateTime=this.calculateRunningAverage(i.averageUpdateTime,t.value,i.updateCount+1);break;case"load":i.loadTime=t.value;break}i.updateCount+=1,i.lastUpdated=new Date,this.widgetSummaries.set(e,i)}calculateRunningAverage(t,e,i){return(t*(i-1)+e)/i}calculateDashboardStats(){let t=this.getAllWidgetSummaries();if(t.length===0){this.dashboardStats.next({totalWidgets:0,averageWidgetRenderTime:0,averageWidgetUpdateTime:0,totalUpdates:0,lastCalculated:new Date});return}let e=0,i=0,a=0,l,g,v=-1,P=Number.MAX_VALUE;for(let I of t){e+=I.averageRenderTime,i+=I.averageUpdateTime,a+=I.updateCount;let k=I.averageUpdateTime;k>v&&(v=k,l={widgetId:I.widgetId,componentType:I.componentType,averageTime:k}),k<P&&(P=k,g={widgetId:I.widgetId,componentType:I.componentType,averageTime:k})}this.dashboardStats.next({totalWidgets:t.length,averageWidgetRenderTime:e/t.length,averageWidgetUpdateTime:i/t.length,totalUpdates:a,slowestWidget:l,fastestWidget:g,lastCalculated:new Date})}static{this.\u0275fac=function(e){return new(e||n)(L(j))}}static{this.\u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var Ut=(()=>{class n{constructor(){this.title="Widget",this.position="top-right",this.draggable=!0,this.collapsible=!0,this.closable=!0,this.resizable=!1,this.minWidth=250,this.minHeight=100,this.customClass=[],this.widgetAction=new M,this.widgetError=new M,this.widgetUpdate=new M,this.enablePerformanceMonitoring=!0,this.widgetStateService=E(zt),this.widgetRenderService=E(Lt),this.performanceMonitoringService=E(Rt),this.renderer=E(vt),this.el=E(wt),this.destroyRef=E(ht),this.widgetState$=this.widgetStateService.getWidgetState(this.widgetId||"unknown-widget")}get isVisible(){return this.widgetStateService.getCurrentWidgetState(this.widgetId).isVisible}get isCollapsed(){return this.widgetStateService.getCurrentWidgetState(this.widgetId).isCollapsed}ngOnInit(){let t=this.startPerformanceMeasurement("init");this.widgetId||(console.error("Widget debe tener un ID \xFAnico"),this.widgetId=`widget-${Date.now()}`),this.widgetState$=this.widgetStateService.getWidgetState(this.widgetId),this.initializeWidget(),this.emitUpdateEvent("initialized",{widgetId:this.widgetId,isVisible:this.isVisible,isCollapsed:this.isCollapsed,position:this.position}),t()}initializeWidget(){let t={minWidth:this.minWidth,minHeight:this.minHeight,maxWidth:this.maxWidth,maxHeight:this.maxHeight,position:this.position,draggable:this.draggable,resizable:this.resizable,customClass:this.customClass,zIndex:this.zIndex},e=this.widgetRenderService.initializeWidget(this.el,this.renderer,t);e.success||(console.warn(`Error al inicializar widget ${this.widgetId}:`,e.errorMessage),this.widgetRenderService.showWidgetError(e.errorMessage||"Error desconocido",this.constructor.name,this.el,this.renderer),this.emitErrorEvent("initialization",{code:"WIDGET_INIT_ERROR",message:e.errorMessage||"Error al inicializar widget",details:{options:t,widgetType:this.constructor.name}})),this.draggable&&this.widgetRenderService.setupDraggableWidget(this.el,this.renderer,".widget-header","map-container")}toggleCollapse(){if(!this.collapsible)return;let t=this.startPerformanceMeasurement("interaction"),e=this.isCollapsed;this.widgetStateService.toggleWidgetCollapse(this.widgetId),this.emitUpdateEvent("state",{widgetId:this.widgetId,previousState:{isCollapsed:e},currentState:{isCollapsed:!e}}),t()}closeWidget(){if(!this.closable)return;let t=this.startPerformanceMeasurement("interaction");this.widgetStateService.setWidgetVisibility(this.widgetId,!1),this.emitUpdateEvent("visibility",{widgetId:this.widgetId,previousState:{isVisible:!0},currentState:{isVisible:!1}}),t()}showWidget(){let t=this.startPerformanceMeasurement("interaction");this.widgetStateService.setWidgetVisibility(this.widgetId,!0),this.emitUpdateEvent("visibility",{widgetId:this.widgetId,previousState:{isVisible:!1},currentState:{isVisible:!0}}),t()}refreshData(){console.log(`Widget ${this.widgetId}: m\xE9todo refreshData() no implementado`)}startPerformanceMeasurement(t,e){return this.enablePerformanceMonitoring?this.performanceMonitoringService.startMeasurement(this.constructor.name,t,this.widgetId,e):()=>{}}emitUpdateEvent(t,e){let i=this.startPerformanceMeasurement("update",{updateType:t});this.widgetUpdate.emit({source:this.widgetId,type:"update",timestamp:new Date,updateType:t,currentState:e}),i()}emitActionEvent(t,e,i){let a=this.startPerformanceMeasurement("interaction",{action:t});this.widgetAction.emit({source:this.widgetId,type:"action",timestamp:new Date,action:t,elementId:e,actionData:i}),a()}emitErrorEvent(t,e){this.widgetError.emit({source:this.widgetId,type:"error",timestamp:new Date,error:b(y({},e),{details:b(y({},e.details),{context:t})})})}handleError(t,e){let i=e?.message||"Error desconocido";console.error(`Error en widget ${this.widgetId} durante ${t}:`,e),this.emitErrorEvent(t,{code:"WIDGET_OPERATION_ERROR",message:`Error al realizar la operaci\xF3n ${t}: ${i}`,details:{error:e,operation:t,widgetId:this.widgetId}})}ngOnDestroy(){this.emitUpdateEvent("state",{widgetId:this.widgetId,currentState:{isDestroying:!0}});let t=this.el.nativeElement;t&&t._draggableCleanup&&t._draggableCleanup()}static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275dir=xt({type:n,inputs:{widgetId:"widgetId",title:"title",position:"position",draggable:"draggable",collapsible:"collapsible",closable:"closable",resizable:"resizable",minWidth:"minWidth",maxWidth:"maxWidth",minHeight:"minHeight",maxHeight:"maxHeight",zIndex:"zIndex",customClass:"customClass",enablePerformanceMonitoring:"enablePerformanceMonitoring"},outputs:{widgetAction:"widgetAction",widgetError:"widgetError",widgetUpdate:"widgetUpdate"}})}}return n})();var Vt=(()=>{class n{constructor(t){this.http=t,this.monitoringDataSubject=new R({}),this.alerts=new R([]),this.networkHealthSubject=new R(0),this.initializeMonitoring(),this.loadSampleAlerts()}initializeMonitoring(){this.startMonitoring()}startMonitoring(){setInterval(()=>{this.updateMonitoringData(),this.checkNetworkHealth(),this.processAlerts()},5e3)}updateMonitoringData(){}checkNetworkHealth(){}processAlerts(){}getMonitoringData(t){return this.monitoringDataSubject.pipe(U(e=>e[t]||null))}getAllMonitoringData(){return this.monitoringDataSubject.asObservable()}getAlerts(t){return this.alerts.asObservable().pipe(U(e=>t&&t>0?e.slice(0,t):e))}getNetworkHealth(){return this.networkHealthSubject.asObservable()}getMetrics(){return rt.useMocks?this.monitoringDataSubject.pipe(U(t=>({elementCount:Object.keys(t).length||10,connectionCount:15,utilization:this.calculateNetworkUtilization(t)||65,health:this.networkHealthSubject.getValue()||85}))):this.http.get(`${rt.apiUrl}/monitoring/metrics`).pipe(U(t=>{let e={elementCount:t?.elementCount||0,connectionCount:t?.connectionCount||0,utilization:t?.utilization||0,health:t?.health||0};return t?.health&&this.networkHealthSubject.next(t.health),e}),B(t=>(console.error("Error al obtener m\xE9tricas de la API:",t),this.monitoringDataSubject.pipe(U(e=>({elementCount:Object.keys(e).length||10,connectionCount:15,utilization:this.calculateNetworkUtilization(e)||65,health:this.networkHealthSubject.getValue()||85}))))))}calculateNetworkUtilization(t){if(Object.keys(t).length===0)return 0;let e=0,i=0;return Object.values(t).forEach(a=>{if(a&&typeof a=="object"){let l=a.utilizationPercentage||a.utilization||a.usagePercentage||0;l!==void 0&&(e+=l,i++)}}),i>0?e/i:0}addAlert(t){t.title||(console.warn("Se intent\xF3 crear una alerta sin t\xEDtulo. Se usar\xE1 el mensaje como t\xEDtulo."),t=b(y({},t),{title:t.message||"Alerta sin t\xEDtulo"}));let e=b(y({},t),{id:Date.now().toString(),timestamp:new Date,resolved:!1,acknowledged:!1}),i=this.alerts.getValue();this.alerts.next([...i,e])}resolveAlert(t){let i=this.alerts.getValue().map(a=>a.id===t?b(y({},a),{resolved:!0}):a);this.alerts.next(i)}reopenAlert(t){let i=this.alerts.getValue().map(a=>a.id===t?b(y({},a),{resolved:!1}):a);this.alerts.next(i)}removeAlert(t){let i=this.alerts.getValue().filter(a=>a.id!==t);this.alerts.next(i)}clearAllAlerts(){this.alerts.next([])}setMonitoringInterval(t){}setAlertThresholds(t){}exportMonitoringData(){}exportAlerts(){}clearMonitoringData(){this.monitoringDataSubject.next({})}loadSampleAlerts(){let t=[{id:"1",elementId:"OLT-001",elementType:C.OLT,type:"CRITICAL",deviceType:"olt",severity:"CRITICAL",title:"Fallo de conectividad en OLT",message:"OLT-001 ha reportado fallo de conectividad",timestamp:new Date(Date.now()-12e4),resolved:!1,acknowledged:!1},{id:"2",elementId:"FDP-003",elementType:C.FDP,type:"WARNING",deviceType:"general",severity:"MEDIUM",title:"Se\xF1al degradada en FDP",message:"Se\xF1al de fibra degradada en conexi\xF3n FDP-003 a ONT-005",timestamp:new Date(Date.now()-36e5),resolved:!1,acknowledged:!1},{id:"3",elementId:"SECTOR-NORTE",elementType:C.TERMINAL_BOX,type:"INFO",deviceType:"general",severity:"LOW",title:"Mantenimiento programado",message:"Mantenimiento programado para el sector norte el 15/06/2023",timestamp:new Date(Date.now()-864e5),resolved:!0,acknowledged:!0},{id:"4",elementId:"SPL-002",elementType:C.SPLITTER,type:"WARNING",deviceType:"splitter",severity:"MEDIUM",title:"Capacidad l\xEDmite en Splitter",message:"Splitter SPL-002 alcanzando l\xEDmite de capacidad (85%)",timestamp:new Date(Date.now()-72e5),resolved:!1,acknowledged:!1}];this.alerts.next(t)}getTestAlerts(){let t=new Date;return[{id:"alert-001",elementId:"olt-001",elementType:C.OLT,type:"CRITICAL",title:"P\xE9rdida de conexi\xF3n OLT",severity:"CRITICAL",message:"P\xE9rdida de conexi\xF3n con OLT principal",timestamp:new Date(t.getTime()-30*6e4),acknowledged:!1,details:{reason:"No responde a ICMP",affectedCustomers:120}},{id:"alert-002",elementId:"edfa-001",elementType:C.EDFA,type:"ERROR",title:"Temperatura elevada EDFA",severity:"HIGH",message:"Temperatura elevada en amplificador EDFA",timestamp:new Date(t.getTime()-120*6e4),acknowledged:!0,acknowledgedBy:"admin",acknowledgedAt:new Date(t.getTime()-90*6e4),details:{temperature:75,threshold:70}},{id:"alert-003",elementId:"splitter-002",elementType:C.SPLITTER,type:"WARNING",title:"Degradaci\xF3n de se\xF1al",severity:"MEDIUM",message:"Degradaci\xF3n de se\xF1al en divisor \xF3ptico",timestamp:new Date(t.getTime()-180*6e4),acknowledged:!1,details:{signalLoss:"7.2dB",expectedLoss:"3.5dB"}},{id:"alert-004",elementId:"conn-001",elementType:C.FIBER_CONNECTION,type:"INFO",title:"Fluctuaci\xF3n de potencia",severity:"LOW",message:"Fluctuaci\xF3n de potencia \xF3ptica detectada",timestamp:new Date(t.getTime()-240*6e4),acknowledged:!1}]}static{this.\u0275fac=function(e){return new(e||n)(L(St))}}static{this.\u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var Ht=S("fadeIn",[w(":enter",[m({opacity:0}),f("300ms ease-out",m({opacity:1}))]),w(":leave",[f("300ms ease-in",m({opacity:0}))])]),Pe=S("scale",[w(":enter",[m({transform:"scale(0.95)",opacity:0}),f("200ms ease-out",m({transform:"scale(1)",opacity:1}))]),w(":leave",[f("200ms ease-in",m({transform:"scale(0.95)",opacity:0}))])]),ze=S("slideInRight",[w(":enter",[m({transform:"translateX(100%)"}),f("200ms ease-out",m({transform:"translateX(0)"}))]),w(":leave",[f("200ms ease-in",m({transform:"translateX(100%)"}))])]),Le=S("slideInLeft",[w(":enter",[m({transform:"translateX(-100%)"}),f("200ms ease-out",m({transform:"translateX(0)"}))]),w(":leave",[f("200ms ease-in",m({transform:"translateX(-100%)"}))])]),Ft=S("slideInUp",[w(":enter",[m({transform:"translateY(30px)",opacity:0}),f("200ms ease-out",m({transform:"translateY(0)",opacity:1}))]),w(":leave",[f("200ms ease-in",m({transform:"translateY(30px)",opacity:0}))])]),Re=S("listAnimation",[w("* => *",[ot(":enter",[m({opacity:0,transform:"translateY(10px)"}),st(80,[f("300ms ease-out",m({opacity:1,transform:"translateY(0)"}))])],{optional:!0})])]),Ue=S("notification",[w(":enter",[m({opacity:0,transform:"translateY(-20px)"}),f("300ms ease-out",m({opacity:1,transform:"translateY(0)"}))]),w(":leave",[f("300ms ease-in",m({opacity:0,transform:"translateY(-20px)"}))])]),Ve=S("expandCard",[$("collapsed",m({height:"60px",overflow:"hidden"})),$("expanded",m({height:"*",overflow:"hidden"})),w("collapsed <=> expanded",[f("200ms cubic-bezier(0.4, 0.0, 0.2, 1)")])]),He=S("rotate",[$("default",m({transform:"rotate(0)"})),$("rotated",m({transform:"rotate(180deg)"})),w("default <=> rotated",[f("200ms ease-out")])]),Fe={pageEnter:S("pageEnter",[w(":enter",[ot(".page-element",[m({opacity:0,transform:"translateY(20px)"}),st(60,[f("400ms ease-out",m({opacity:1,transform:"translateY(0)"}))])],{optional:!0})])]),pageLeave:S("pageLeave",[w(":leave",[m({opacity:1}),f("300ms ease-in",m({opacity:0}))])])};function qt(n,h){if(n&1&&(o(0,"div",8),c(1),r()),n&2){let t=u();s(),_(t.title)}}function Kt(n,h){if(n&1&&(o(0,"div",9),c(1),r()),n&2){let t=u();s(),_(t.details)}}function Zt(n,h){if(n&1){let t=O();o(0,"button",10),W("click",function(){A(t);let i=u();return D(i.onRetry())}),o(1,"mat-icon"),c(2,"refresh"),r(),c(3),r()}if(n&2){let t=u();s(3),N(" ",t.retryLabel," ")}}function Jt(n,h){if(n&1){let t=O();o(0,"button",11),W("click",function(){A(t);let i=u();return D(i.onClose())}),o(1,"mat-icon"),c(2,"close"),r(),c(3),r()}if(n&2){let t=u();s(3),N(" ",t.closeLabel," ")}}function Qt(n,h){if(n&1){let t=O();o(0,"button",11),W("click",function(){A(t);let i=u();return D(i.toggleDetails())}),o(1,"mat-icon"),c(2),r(),c(3),r()}if(n&2){let t=u();s(2),_(t.showDetails?"keyboard_arrow_up":"keyboard_arrow_down"),s(),N(" ",t.showDetails?"Ocultar detalles":"Mostrar detalles"," ")}}var jt=(()=>{class n{constructor(){this.severity="critical",this.title="",this.message="Ha ocurrido un error",this.details="",this.code="",this.retryVisible=!0,this.closeVisible=!0,this.retryLabel="Reintentar",this.closeLabel="Cerrar",this.retry=new M,this.close=new M,this.showDetails=!1}getIcon(){switch(this.severity){case"critical":return"error_outline";case"warning":return"warning_amber";case"info":return"info";default:return"error_outline"}}onRetry(){this.retry.emit()}onClose(){this.close.emit()}toggleDetails(){this.showDetails=!this.showDetails}static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275cmp=Y({type:n,selectors:[["app-error-display"]],inputs:{severity:"severity",title:"title",message:"message",details:"details",code:"code",retryVisible:"retryVisible",closeVisible:"closeVisible",retryLabel:"retryLabel",closeLabel:"closeLabel"},outputs:{retry:"retry",close:"close"},decls:12,vars:8,consts:[[1,"error-container",3,"ngClass"],[1,"error-content"],["class","error-title",4,"ngIf"],[1,"error-message"],["class","error-details",4,"ngIf"],[1,"error-actions"],["mat-button","","color","primary",3,"click",4,"ngIf"],["mat-button","",3,"click",4,"ngIf"],[1,"error-title"],[1,"error-details"],["mat-button","","color","primary",3,"click"],["mat-button","",3,"click"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"mat-icon"),c(2),r(),o(3,"div",1),x(4,qt,2,1,"div",2),o(5,"div",3),c(6),r(),x(7,Kt,2,1,"div",4),o(8,"div",5),x(9,Zt,4,1,"button",6)(10,Jt,4,1,"button",7)(11,Qt,4,2,"button",7),r()()()),e&2&&(p("ngClass",i.severity),s(2),_(i.getIcon()),s(2),p("ngIf",i.title),s(2),_(i.message),s(),p("ngIf",i.details&&i.showDetails),s(2),p("ngIf",i.retryVisible),s(),p("ngIf",i.closeVisible),s(),p("ngIf",i.details))},dependencies:[Z,q,K,Q,J,tt,Tt,Nt],styles:[".error-container[_ngcontent-%COMP%]{display:flex;padding:16px;margin:8px 0;border-radius:4px;align-items:flex-start}.error-container.critical[_ngcontent-%COMP%]{background-color:#ffebee;border-left:4px solid #f44336}.error-container.warning[_ngcontent-%COMP%]{background-color:#fff8e1;border-left:4px solid #ffc107}.error-container.info[_ngcontent-%COMP%]{background-color:#e3f2fd;border-left:4px solid #2196f3}.error-container[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:16px}.error-container.critical[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#f44336}.error-container.warning[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#ffc107}.error-container.info[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#2196f3}.error-content[_ngcontent-%COMP%]{flex-grow:1}.error-title[_ngcontent-%COMP%]{font-weight:500;font-size:16px;margin-bottom:4px}.error-message[_ngcontent-%COMP%]{margin-bottom:8px}.error-details[_ngcontent-%COMP%]{background-color:#00000008;padding:8px;border-radius:4px;margin-bottom:8px;font-family:monospace;white-space:pre-wrap;font-size:12px;max-height:200px;overflow-y:auto}.error-actions[_ngcontent-%COMP%]{display:flex;gap:8px;margin-top:8px}"]})}}return n})();function te(n,h){if(n&1){let t=O();o(0,"button",8),W("click",function(){A(t);let i=u(2);return D(i.toggleCollapse())}),o(1,"mat-icon"),c(2),H(3,"async"),r()()}if(n&2){let t,e=u(2);s(2),_((t=F(3,1,e.widgetState$))!=null&&t.isCollapsed?"expand_more":"expand_less")}}function ee(n,h){if(n&1){let t=O();o(0,"button",9),W("click",function(){A(t);let i=u(2);return D(i.closeWidget())}),o(1,"mat-icon"),c(2,"close"),r()()}}function ie(n,h){n&1&&(o(0,"div",13),X(1,"mat-spinner",14),r())}function ne(n,h){if(n&1){let t=O();o(0,"app-error-display",29),H(1,"async"),W("retry",function(){A(t);let i=u(4);return D(i.refreshData())}),r()}if(n&2){let t,e=u(4);p("message",((t=F(1,2,e.widgetState$))==null||t.errorInfo==null?null:t.errorInfo.message)||"Error desconocido")("title","Error en Salud de Red")}}function ae(n,h){if(n&1&&X(0,"div",30),n&2){let t=h.$implicit,e=u(4);Ct("background-color",t.color)("width",e.calculateStatusCircleSize(t.count),"px")("height",e.calculateStatusCircleSize(t.count),"px"),p("matTooltip",t.label+": "+t.count)}}function re(n,h){if(n&1&&(o(0,"span",35),c(1),r()),n&2){let t=u(5);s(),at(" ",t.elementStats.warning," alerta",t.elementStats.warning!==1?"s":""," ")}}function oe(n,h){if(n&1&&(o(0,"span",36),c(1),r()),n&2){let t=u(5);s(),at(" ",t.elementStats.error," error",t.elementStats.error!==1?"es":""," ")}}function se(n,h){if(n&1&&(o(0,"div",31)(1,"span",32),c(2),r(),x(3,re,2,2,"span",33)(4,oe,2,2,"span",34),r()),n&2){let t=u(4);s(2),N("",t.elementStats.active," activos"),s(),p("ngIf",t.elementStats.warning>0),s(),p("ngIf",t.elementStats.error>0)}}function le(n,h){if(n&1&&(o(0,"div",40)(1,"mat-icon",41),c(2),r(),o(3,"div",42)(4,"div",43),c(5),r(),o(6,"div",44),c(7),r()(),o(8,"mat-icon",45),c(9),r()()),n&2){let t=h.$implicit,e=u(5);p("ngClass",e.getStatusClass(t.status)),s(2),_(e.getElementTypeIcon(t.type)),s(3),_(t.name),s(2),_(e.getStatusLabel(t.status)),s(2),_(e.getStatusIcon(t.status))}}function ce(n,h){if(n&1&&(o(0,"div",37)(1,"h4"),c(2,"Elementos cr\xEDticos"),r(),o(3,"div",38),x(4,le,10,5,"div",39),r()()),n&2){let t=u(4);s(4),p("ngForOf",t.criticalElements)}}function de(n,h){if(n&1&&(o(0,"div",46)(1,"mat-icon"),c(2,"update"),r(),c(3),r()),n&2){let t=u(4);s(3),N(" Actualizado: ",t.formatTime(t.networkMetrics==null?null:t.networkMetrics.lastUpdated)," ")}}function me(n,h){if(n&1&&(o(0,"div",15),x(1,ne,2,4,"app-error-display",16),H(2,"async"),o(3,"div",17)(4,"div",18),c(5),r(),o(6,"div",19),c(7,"Salud General"),r()(),o(8,"div",20),x(9,ae,1,7,"div",21),r(),o(10,"div",22)(11,"div",23)(12,"div",24),c(13),r(),o(14,"div",25),c(15,"Elementos"),r(),x(16,se,5,3,"div",26),r(),o(17,"div",23)(18,"div",24),c(19),r(),o(20,"div",25),c(21,"Conexiones"),r()(),o(22,"div",23)(23,"div",24),c(24),r(),o(25,"div",25),c(26,"Utilizaci\xF3n"),r()()(),X(27,"mat-divider"),x(28,ce,5,1,"div",27)(29,de,4,1,"div",28),r()),n&2){let t,e=u(3);s(),p("ngIf",(t=F(2,10,e.widgetState$))==null?null:t.hasError),s(3),p("ngClass",e.getHealthColor((e.networkMetrics==null?null:e.networkMetrics.health)||0)),s(),N(" ",(e.networkMetrics==null?null:e.networkMetrics.health)||0,"% "),s(4),p("ngForOf",e.statusDistribution),s(4),_(e.elementStats.total||0),s(3),p("ngIf",e.elementStats),s(3),_((e.networkMetrics==null?null:e.networkMetrics.connectionCount)||0),s(5),N("",(e.networkMetrics==null?null:e.networkMetrics.utilization)||0,"%"),s(4),p("ngIf",e.criticalElements.length>0),s(),p("ngIf",e.networkMetrics==null?null:e.networkMetrics.lastUpdated)}}function pe(n,h){if(n&1&&(o(0,"div",10),x(1,ie,2,0,"div",11)(2,me,30,12,"div",12),r()),n&2){let t=u(2);p("@slideInUp",void 0),s(),p("ngIf",t.isLoading),s(),p("ngIf",!t.isLoading)}}function ge(n,h){if(n&1){let t=O();o(0,"div",1)(1,"div",2)(2,"h3")(3,"mat-icon"),c(4,"health_and_safety"),r(),o(5,"span"),c(6),r()(),o(7,"div",3)(8,"button",4),W("click",function(){A(t);let i=u();return D(i.refreshData())}),o(9,"mat-icon"),c(10,"refresh"),r()(),x(11,te,4,3,"button",5)(12,ee,3,0,"button",6),r()(),x(13,pe,3,3,"div",7),H(14,"async"),r()}if(n&2){let t,e=u();s(6),_(e.title),s(5),p("ngIf",e.collapsible),s(),p("ngIf",e.closable),s(),p("ngIf",!((t=F(14,4,e.widgetState$))!=null&&t.isCollapsed))}}var Si=(()=>{class n extends Ut{constructor(){super(),this.elementStats={total:0,active:0,warning:0,error:0,maintenance:0,inactive:0},this.widgetAction=new M,this.widgetError=new M,this.widgetUpdate=new M,this.networkMetrics=null,this.statusDistribution=[],this.criticalElements=[],this.isLoading=!1,this.monitoringService=E(Vt),this.elementService=E(Pt),this.logger=E(j),this.widgetId="network-health-widget",this.title="Salud de la Red",this.position="top-left"}ngOnInit(){super.ngOnInit(),this.loadData()}ngOnChanges(t){t.elementStats&&this.elementStats&&this.updateStatusDistribution()}loadData(){this.isLoading=!0,this.monitoringService.getMetrics().pipe(lt(this.destroyRef),B(t=>(this.handleError("loadMetrics",t),nt({elementCount:0,connectionCount:0,utilization:0,health:0,lastUpdated:new Date})))).subscribe({next:t=>{this.networkMetrics=b(y({},t),{lastUpdated:new Date}),this.loadElements()},error:t=>{this.handleError("loadMetrics",t),this.isLoading=!1}})}loadElements(){this.elementService.getAllElements().pipe(lt(this.destroyRef),B(t=>(this.handleError("loadElements",t),nt([])))).subscribe({next:t=>{this.calculateElementStats(t),this.updateStatusDistribution(),this.findCriticalElements(t),this.isLoading=!1},error:t=>{this.handleError("loadElements",t),this.isLoading=!1}})}calculateElementStats(t){let e={total:t.length,active:0,warning:0,error:0,maintenance:0,inactive:0};t.forEach(i=>{switch(i.status){case d.ACTIVE:e.active++;break;case d.WARNING:e.warning++;break;case d.FAULT:e.error++;break;case d.MAINTENANCE:e.maintenance++;break;case d.INACTIVE:case d.PLANNED:case d.UNKNOWN:e.inactive++;break}}),this.elementStats=e}updateStatusDistribution(){this.statusDistribution=[{status:d.ACTIVE,label:"Activos",count:this.elementStats.active,color:"#4caf50"},{status:d.WARNING,label:"Advertencia",count:this.elementStats.warning,color:"#ff9800"},{status:d.FAULT,label:"Fallo",count:this.elementStats.error,color:"#f44336"},{status:d.MAINTENANCE,label:"Mantenimiento",count:this.elementStats.maintenance,color:"#9c27b0"},{status:d.INACTIVE,label:"Inactivos",count:this.elementStats.inactive,color:"#9e9e9e"}].filter(t=>t.count>0)}findCriticalElements(t){let e=[d.FAULT,d.WARNING];this.criticalElements=t.filter(i=>{let a=i.status;return e.includes(a)}).sort((i,a)=>{let l={[d.FAULT]:0,[d.WARNING]:1},g=i.status,v=a.status;return l[g]-l[v]}).slice(0,5)}calculateStatusCircleSize(t){let a=this.elementStats.total||1,l=Math.min(1,t/a);return Math.max(12,Math.round(12+24*l))}getHealthColor(t){return t>=90?"excellent":t>=75?"good":t>=60?"fair":t>=40?"warning":"critical"}getStatusClass(t){switch(t){case d.WARNING:return"status-warning";case d.FAULT:return"status-fault";case d.MAINTENANCE:return"status-maintenance";default:return""}}getElementTypeIcon(t){switch(t){case C.OLT:return"router";case C.ONT:return"devices";case C.FDP:return"hub";case C.SPLITTER:return"call_split";default:let e=t;return e==="EDFA"?"power":e==="MANGA"?"cable":"device_hub"}}getStatusIcon(t){switch(t){case d.WARNING:return"warning";case d.FAULT:return"error";case d.MAINTENANCE:return"build";case d.ACTIVE:return"check_circle";default:return"help"}}getStatusLabel(t){switch(t){case d.ACTIVE:return"Activo";case d.INACTIVE:return"Inactivo";case d.WARNING:return"Advertencia";case d.FAULT:return"Fallo";case d.MAINTENANCE:return"Mantenimiento";case d.PLANNED:return"Planificado";case d.UNKNOWN:return"Desconocido";default:return t}}formatTime(t){return t?t.toLocaleTimeString():""}refreshData(){this.loadData()}static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275cmp=Y({type:n,selectors:[["app-network-health-widget"]],inputs:{elementStats:"elementStats"},outputs:{widgetAction:"widgetAction",widgetError:"widgetError",widgetUpdate:"widgetUpdate"},features:[_t,ut],decls:2,vars:3,consts:[["class","widget-container network-health-widget",4,"ngIf"],[1,"widget-container","network-health-widget"],[1,"widget-header"],[1,"widget-controls"],["mat-icon-button","","matTooltip","Actualizar datos",3,"click"],["mat-icon-button","","matTooltip","Colapsar",3,"click",4,"ngIf"],["mat-icon-button","","matTooltip","Cerrar",3,"click",4,"ngIf"],["class","widget-content",4,"ngIf"],["mat-icon-button","","matTooltip","Colapsar",3,"click"],["mat-icon-button","","matTooltip","Cerrar",3,"click"],[1,"widget-content"],["class","loading-container",4,"ngIf"],["class","health-stats-container",4,"ngIf"],[1,"loading-container"],["diameter","30"],[1,"health-stats-container"],[3,"message","title","retry",4,"ngIf"],[1,"health-primary"],[1,"health-indicator",3,"ngClass"],[1,"health-label"],[1,"status-summary"],["class","status-circle",3,"background-color","width","height","matTooltip",4,"ngFor","ngForOf"],[1,"secondary-stats"],[1,"stat-item"],[1,"stat-value"],[1,"stat-label"],["class","stat-breakdown",4,"ngIf"],["class","critical-elements",4,"ngIf"],["class","last-updated",4,"ngIf"],[3,"retry","message","title"],[1,"status-circle",3,"matTooltip"],[1,"stat-breakdown"],[1,"active-count"],["class","warning-count",4,"ngIf"],["class","error-count",4,"ngIf"],[1,"warning-count"],[1,"error-count"],[1,"critical-elements"],[1,"critical-list"],["class","critical-item",3,"ngClass",4,"ngFor","ngForOf"],[1,"critical-item",3,"ngClass"],[1,"element-type-icon"],[1,"element-details"],[1,"element-name"],[1,"element-status"],[1,"status-icon"],[1,"last-updated"]],template:function(e,i){if(e&1&&(x(0,ge,15,6,"div",0),H(1,"async")),e&2){let a;p("ngIf",(a=F(1,1,i.widgetState$))==null?null:a.isVisible)}},dependencies:[Z,q,yt,K,bt,Q,J,tt,Mt,At,kt,Et,It,Ot,Dt,Wt,jt],styles:[".network-health-widget[_ngcontent-%COMP%]{min-width:280px;max-width:350px}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:200px}.health-stats-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.health-primary[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;text-align:center;padding:16px 0}.health-indicator[_ngcontent-%COMP%]{font-size:32px;font-weight:700;border-radius:50%;width:90px;height:90px;display:flex;justify-content:center;align-items:center;margin-bottom:12px;color:#fff}.health-indicator.excellent[_ngcontent-%COMP%]{background-color:#4caf50}.health-indicator.good[_ngcontent-%COMP%]{background-color:#8bc34a}.health-indicator.fair[_ngcontent-%COMP%]{background-color:#ffc107}.health-indicator.warning[_ngcontent-%COMP%]{background-color:#ff9800}.health-indicator.critical[_ngcontent-%COMP%]{background-color:#f44336}.health-label[_ngcontent-%COMP%]{font-size:14px;font-weight:500;color:#0009}.status-summary[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:8px;flex-wrap:wrap;padding:8px}.status-circle[_ngcontent-%COMP%]{border-radius:50%;min-width:12px;min-height:12px}.secondary-stats[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}.stat-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;text-align:center;padding:12px 4px;border-radius:4px;background-color:#00000008}.stat-value[_ngcontent-%COMP%]{font-size:20px;font-weight:700;color:#2196f3}.stat-label[_ngcontent-%COMP%]{font-size:12px;color:#0009;margin-top:4px}.stat-breakdown[_ngcontent-%COMP%]{font-size:10px;display:flex;flex-wrap:wrap;justify-content:center;gap:4px;margin-top:4px}.active-count[_ngcontent-%COMP%]{color:#4caf50}.warning-count[_ngcontent-%COMP%]{color:#ff9800}.error-count[_ngcontent-%COMP%]{color:#f44336}.critical-elements[_ngcontent-%COMP%]{margin-top:12px}.critical-elements[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:14px;font-weight:500;margin:0 0 8px;color:#000000b3}.critical-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;max-height:180px;overflow-y:auto}.critical-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:8px;border-radius:4px;background-color:#00000008}.critical-item.status-fault[_ngcontent-%COMP%]{border-left:3px solid #f44336;background-color:#f443360d}.critical-item.status-warning[_ngcontent-%COMP%]{border-left:3px solid #ff9800;background-color:#ff98000d}.critical-item.status-critical[_ngcontent-%COMP%]{border-left:3px solid #f44336;background-color:#f443360d}.element-type-icon[_ngcontent-%COMP%]{margin-right:8px;font-size:20px}.element-details[_ngcontent-%COMP%]{flex:1}.element-name[_ngcontent-%COMP%]{font-size:12px;font-weight:500}.element-status[_ngcontent-%COMP%]{font-size:11px;color:#0009}.status-icon[_ngcontent-%COMP%]{font-size:18px}.status-fault[_ngcontent-%COMP%]   .status-icon[_ngcontent-%COMP%]{color:#f44336}.status-warning[_ngcontent-%COMP%]   .status-icon[_ngcontent-%COMP%]{color:#ff9800}.status-critical[_ngcontent-%COMP%]   .status-icon[_ngcontent-%COMP%]{color:#f44336}.last-updated[_ngcontent-%COMP%]{display:flex;align-items:center;font-size:11px;color:#00000080;margin-top:12px}.last-updated[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:14px;height:14px;width:14px;margin-right:4px}"],data:{animation:[Ht,Ft]}})}}return n})();export{Si as NetworkHealthWidgetComponent};
