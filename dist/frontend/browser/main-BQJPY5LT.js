import{a as Xs,b as Fn,e as oc}from"./chunk-3DOLLXBG.js";import{a as bo}from"./chunk-LZGKE2HR.js";import{b as Eo,c as nc,d as ti,e as ic,f as Po}from"./chunk-6GRGHSIW.js";import{a as zn,b as Bn,c as Vn,d as $n}from"./chunk-HOQN2RTO.js";import{a as nl,b as en}from"./chunk-YFTEGT7S.js";import{a as Yl,b as wo}from"./chunk-EQ6CIY4U.js";import{a as Vl,b as $l,c as jl,d as Ul,e as Gl,f as Hl,g as Wl,h as Kl,i as ql,j as Ql,k as Zl}from"./chunk-DIVOCDBU.js";import{a as Xl}from"./chunk-AO2ZIN2L.js";import{b as ac}from"./chunk-ELOSELUF.js";import{a as Do,b as Ti,c as Oi,d as Ao,e as _c,f as vc,g as Ro,h as ki,i as No}from"./chunk-NKIK3UKT.js";import{a as X,b as fe,c as zr,d as To,e as dc,f as pc,g as mc,h as gc,i as uc,j as Br,k as Oo,l as hc,m as ko,n as fc,o as _e,p as Io}from"./chunk-7JRIPI7N.js";import{a as wi,b as fl,c as tt}from"./chunk-HQFFMNXZ.js";import{a as kl,b as Bl}from"./chunk-AUR2Q36V.js";import"./chunk-EQX7UBG4.js";import{a as sc,c as Fr}from"./chunk-DS644UZT.js";import{h as rc}from"./chunk-BRMDKIJD.js";import{A as ei,B as Bt,a as Al,c as Rl,d as Ie,e as bt,m as it,n as xo,o as ot,p as De,q as Mi,r as Pi,s as bn,t as Jl,u as zt,v as So,w as Mo,x as ec,y as Jn,z as tc}from"./chunk-CPM6WUWS.js";import{b as Dl}from"./chunk-E3NR5YS4.js";import{d as Nl}from"./chunk-YKHY2KRM.js";import{a as ao,b as so,d as lo,f as qn}from"./chunk-7CRRIESH.js";import{a as Fl,b as Co}from"./chunk-Y6VATWWK.js";import{d as Ll}from"./chunk-CEJFVTAL.js";import"./chunk-PS45K6N5.js";import"./chunk-YFYY4JIQ.js";import{b as qe,c as Qn,g as Xn}from"./chunk-JGNBERAY.js";import{a as Zn,c as vo,d as Yn}from"./chunk-Q2I2H6RZ.js";import{a as Gn,b as _l,c as nt,d as vl,e as Hn,f as Wn,g as Kn,h as nn}from"./chunk-RMHD7ZOV.js";import{a as cc}from"./chunk-H554YTGL.js";import{b as lc}from"./chunk-MHWJR3EV.js";import{a as hl,b as ro,c as tn}from"./chunk-E7SS3VLG.js";import{a as J,b as St,c as Ut,d as ct,e as Lr,f as wl,g as he,h as xi,j as Mt,k as Pt,l as xl,m as vn,n as go,o as Si}from"./chunk-N7T535CU.js";import{a as _o,b as Il,c as yo,d as zl,e as Ft}from"./chunk-KIEZATJL.js";import{a as s,b as B,f as vt,g as Ze}from"./chunk-VONGITAP.js";import{a as uo,b as Sl,c as ho,d as Ml,e as Pl,f as Tl,g as Ol,h as fo}from"./chunk-GQNYZBS2.js";import{a as mo,b as yl,c as El,d as on}from"./chunk-NI7QRJ7Q.js";import{a as Lt,b as Ke}from"./chunk-F5P253LU.js";import{a as K}from"./chunk-QQ6SKILC.js";import"./chunk-VMUGXP3O.js";import{a as Jt,b as _t}from"./chunk-D3FDFS7S.js";import{d as co,f as bl,g as Cl,j as po}from"./chunk-RWQWO3EM.js";import{a as Se}from"./chunk-4RASZFGW.js";import{A as io,B as oo,b as jn,g as Un,h as il,j as ol,k as to,l as rl,m as al,n as sl,o as ll,r as cl,s as dl,t as pl,u as ml,v as gl,w as ul,z as no}from"./chunk-JO2MD4NL.js";import{a as ue,b as pe,i as Be,j as Ve,k as Js,l as el,m as tl,n as be}from"./chunk-XJSBNB6N.js";import{k as Nr,l as Ei,v as ke,w as Me}from"./chunk-VH7SA6GK.js";import{E as Zs,G as Ys,H as Rr,a as Ws,b as Ks,c as eo,e as yi,f as Yt,i as qs,j as Xt,m as Qs}from"./chunk-4PHUDKEH.js";import{a as Nn,b as Xi,c as Nt,d as Oe,e as Ln,f as Ji,g as Gs,h as Hs,i as Zt}from"./chunk-D4QL4JVC.js";import{$a as m,$b as x,$c as ee,Aa as C,Ab as In,Ac as Zi,B as Tn,Ba as ys,Bc as Rn,C as $t,D as Ee,Da as Or,Ec as Ci,F as Pe,Fa as Qt,Gb as c,H as Pr,Hb as d,I as On,Ib as D,Ja as H,Jb as Fe,K as kn,Ka as et,Kb as ze,L as ds,La as Ki,Lc as ft,M as hi,Mb as V,Mc as We,N as ps,Na as kr,Nc as re,O as mt,Ob as y,Oc as Is,P as ms,Pa as Ge,Pb as v,Pc as Ds,Q as fi,Qb as vi,Qc as As,Rb as bi,Rc as Rs,S as Tr,Ta as Ir,Tc as Ns,Ub as gt,V as gs,Va as Es,Vb as ut,Vc as Ls,Wb as ht,Wc as Fs,Xa as ws,Yc as Yi,Z as us,Za as xs,Zb as wt,_ as hs,_b as p,_c as zs,a as qt,aa as fs,ac as j,ba as _s,bb as _i,bc as Dn,c as Ue,ca as Ne,cc as hn,cd as Bs,da as L,db as A,dc as fn,dd as Vs,ec as _n,f as N,fa as Te,fb as Ss,g as ge,ga as vs,gc as qi,h as is,ha as ie,hc as jt,hd as $s,i as os,ic as xt,id as Rt,j as rs,ja as I,jc as Qi,jd as js,k as as,ka as pn,kb as Y,kc as Ms,kd as Us,l as ss,lb as mn,lc as Ps,m as Gi,ma as Le,mb as gn,mc as $e,n as Ce,nc as An,o as lt,oa as O,ob as un,oc as At,pa as P,pc as Ts,qb as E,qc as Os,r as ls,s as de,t as cs,ta as Wi,u as Mr,ua as bs,vc as He,wb as xe,xb as h,xc as Ar,ya as Cs,yb as Dr,yc as ks,z as Hi,za as b,zb as Z}from"./chunk-FG6FKNI4.js";import{a as k,b as Q,d as ns,g as ce}from"./chunk-OXVY4BEJ.js";function Nm(o,i){o&1&&(Fe(0),D(1,"router-outlet"),ze())}function Lm(o,i){o&1&&(c(0,"div",2),D(1,"mat-spinner",3),d())}var bc=(()=>{class o{constructor(){this.initialized=!1}ngOnInit(){this.initialized=!0}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=Y({type:o,selectors:[["app-initializer"]],decls:3,vars:2,consts:[["loading",""],[4,"ngIf","ngIfElse"],[1,"loading-screen"],["diameter","48"]],template:function(t,n){if(t&1&&E(0,Nm,2,0,"ng-container",1)(1,Lm,2,0,"ng-template",null,0,Os),t&2){let r=wt(2);h("ngIf",n.initialized)("ngIfElse",r)}},dependencies:[ee,re,Nt,Jt],styles:[".loading-screen[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100vh;width:100vw;background-color:#fafafa;position:fixed;top:0;left:0;z-index:9999}"]})}}return o})();var ni=(()=>{class o{static \u0275fac=function(t){return new(t||o)};static \u0275mod=mn({type:o});static \u0275inj=pn({imports:[Rr,Ei,Ei,Rr]})}return o})();var zm=(o,i)=>[o,i];function Bm(o,i){o&1&&(c(0,"span",15),p(1,"Network Map"),d())}function Vm(o,i){o&1&&(c(0,"span"),p(1,"Dashboard"),d())}function $m(o,i){o&1&&(c(0,"span"),p(1,"Dise\xF1o de Red"),d())}function jm(o,i){o&1&&(c(0,"span"),p(1,"Proyectos"),d())}function Um(o,i){if(o&1&&(c(0,"a",16)(1,"mat-icon"),p(2,"work"),d(),E(3,jm,2,0,"span",8),d()),o&2){let e=v();h("matTooltip",e.collapsed?"Proyectos":"")("matTooltipPosition","right"),m(3),h("ngIf",!e.collapsed)}}function Gm(o,i){o&1&&(c(0,"span"),p(1,"Modo Offline"),d())}function Hm(o,i){o&1&&(c(0,"span"),p(1,"Configuraci\xF3n"),d())}function Wm(o,i){o&1&&(c(0,"span"),p(1,"Ayuda"),d())}var Cc=(()=>{class o{constructor(){this.collapsed=!1,this.userRoles=[],this.UserRole=wi}toggleCollapse(){this.collapsed=!this.collapsed}hasRole(e){return e.some(t=>this.userRoles.includes(t))}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=Y({type:o,selectors:[["app-navigation-sidebar"]],inputs:{collapsed:"collapsed",userRoles:"userRoles"},decls:33,vars:25,consts:[[1,"navigation-container"],[1,"nav-header"],[1,"logo"],["src","assets/logo.svg","alt","Logo"],["class","logo-text",4,"ngIf"],["mat-icon-button","",1,"collapse-toggle",3,"click"],[1,"nav-links"],["mat-list-item","","routerLink","/dashboard","routerLinkActive","active-link",3,"matTooltip","matTooltipPosition"],[4,"ngIf"],["mat-list-item","","routerLink","/network-design","routerLinkActive","active-link",3,"matTooltip","matTooltipPosition"],["mat-list-item","","routerLink","/projects","routerLinkActive","active-link",3,"matTooltip","matTooltipPosition",4,"ngIf"],["mat-list-item","","routerLink","/offline","routerLinkActive","active-link",3,"matTooltip","matTooltipPosition"],[1,"nav-footer"],["mat-list-item","","routerLink","/settings","routerLinkActive","active-link",3,"matTooltip","matTooltipPosition"],["mat-list-item","","routerLink","/help","routerLinkActive","active-link",3,"matTooltip","matTooltipPosition"],[1,"logo-text"],["mat-list-item","","routerLink","/projects","routerLinkActive","active-link",3,"matTooltip","matTooltipPosition"]],template:function(t,n){t&1&&(c(0,"div",0)(1,"div",1)(2,"div",2),D(3,"img",3),E(4,Bm,2,0,"span",4),d(),c(5,"button",5),y("click",function(){return n.toggleCollapse()}),c(6,"mat-icon"),p(7),d()()(),D(8,"mat-divider"),c(9,"div",6)(10,"a",7)(11,"mat-icon"),p(12,"dashboard"),d(),E(13,Vm,2,0,"span",8),d(),c(14,"a",9)(15,"mat-icon"),p(16,"share"),d(),E(17,$m,2,0,"span",8),d(),E(18,Um,4,3,"a",10),c(19,"a",11)(20,"mat-icon"),p(21,"offline_bolt"),d(),E(22,Gm,2,0,"span",8),d()(),c(23,"div",12),D(24,"mat-divider"),c(25,"a",13)(26,"mat-icon"),p(27,"settings"),d(),E(28,Hm,2,0,"span",8),d(),c(29,"a",14)(30,"mat-icon"),p(31,"help"),d(),E(32,Wm,2,0,"span",8),d()()()),t&2&&(Z("collapsed",n.collapsed),m(2),Z("collapsed",n.collapsed),m(2),h("ngIf",!n.collapsed),m(3),x(n.collapsed?"chevron_right":"chevron_left"),m(3),h("matTooltip",n.collapsed?"Dashboard":"")("matTooltipPosition","right"),m(3),h("ngIf",!n.collapsed),m(),h("matTooltip",n.collapsed?"Dise\xF1o de Red":"")("matTooltipPosition","right"),m(3),h("ngIf",!n.collapsed),m(),h("ngIf",n.hasRole(Qi(22,zm,n.UserRole.ADMIN,n.UserRole.OPERATOR))),m(),h("matTooltip",n.collapsed?"Modo Offline":"")("matTooltipPosition","right"),m(3),h("ngIf",!n.collapsed),m(3),h("matTooltip",n.collapsed?"Configuraci\xF3n":"")("matTooltipPosition","right"),m(3),h("ngIf",!n.collapsed),m(),h("matTooltip",n.collapsed?"Ayuda":"")("matTooltipPosition","right"),m(3),h("ngIf",!n.collapsed))},dependencies:[ee,re,Zt,Ln,Ji,ni,tn,ro,Lt,pe,ue,Ke,Me,ke],styles:[".navigation-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:240px;transition:width .3s ease;background-color:#fff;box-shadow:0 2px 8px #0000001a}.navigation-container.collapsed[_ngcontent-%COMP%]{width:64px}.nav-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:16px;height:64px}.logo[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:32px;width:32px;object-fit:contain;background-color:transparent;border-radius:4px}.logo-text[_ngcontent-%COMP%]{font-size:18px;font-weight:500}.nav-links[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding-top:8px}.nav-links[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], .nav-footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;height:48px;padding:0 16px;color:#000000de;text-decoration:none;transition:background-color .2s ease}.nav-links[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, .nav-footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#0000000a}.active-link[_ngcontent-%COMP%]{background-color:#2196f31a!important;color:#2196f3!important}.active-link[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#2196f3}.nav-footer[_ngcontent-%COMP%]{padding-bottom:8px}"]})}}return o})();var ii=(()=>{class o{constructor(){this.shortcuts=[],this.destroy$=new N,this.activeContexts=new Set(["global"]),this.shortcutsChanged$=new N,this.keydownSubscription=Hi(document,"keydown").pipe(L(this.destroy$),Ee(e=>!this.isInputElement(e.target))).subscribe(e=>this.handleKeyDown(e)),this.registerDefaultShortcuts()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.keydownSubscription&&this.keydownSubscription.unsubscribe()}registerShortcut(e){let t=this.shortcuts.findIndex(n=>n.id===e.id);t>=0?this.shortcuts[t]=k({},e):this.shortcuts.push(k({},e)),this.shortcutsChanged$.next(this.shortcuts)}registerShortcuts(e){e.forEach(t=>this.registerShortcut(t))}unregisterShortcut(e){this.shortcuts=this.shortcuts.filter(t=>t.id!==e),this.shortcutsChanged$.next(this.shortcuts)}setShortcutEnabled(e,t){let n=this.shortcuts.find(r=>r.id===e);n&&(n.disabled=!t,this.shortcutsChanged$.next(this.shortcuts))}getAllShortcuts(){return[...this.shortcuts]}getActiveShortcuts(){return this.shortcuts.filter(e=>!e.disabled&&this.isShortcutInActiveContext(e))}setActiveContext(e){this.activeContexts.clear(),this.activeContexts.add("global"),Array.isArray(e)?e.forEach(t=>this.activeContexts.add(t)):this.activeContexts.add(e),this.shortcutsChanged$.next(this.shortcuts)}addActiveContext(e){this.activeContexts.add(e),this.shortcutsChanged$.next(this.shortcuts)}removeActiveContext(e){e!=="global"&&(this.activeContexts.delete(e),this.shortcutsChanged$.next(this.shortcuts))}getActiveContexts(){return Array.from(this.activeContexts)}getShortcutsChanges(){return this.shortcutsChanged$.asObservable()}handleKeyDown(e){let t=this.findMatchingShortcut(e);t&&(e.preventDefault(),e.stopPropagation(),this.triggerShortcutEvent(t.id))}findMatchingShortcut(e){let t=e.key.toLowerCase();return this.shortcuts.filter(r=>!r.disabled&&this.isShortcutInActiveContext(r)).find(r=>{if(r.key.toLowerCase()!==t)return!1;let a=r.modifiers||{};return!(a.ctrl!==void 0&&a.ctrl!==e.ctrlKey||a.alt!==void 0&&a.alt!==e.altKey||a.shift!==void 0&&a.shift!==e.shiftKey||a.meta!==void 0&&a.meta!==e.metaKey)})||null}isShortcutInActiveContext(e){return!e.contexts||e.contexts.length===0?!0:e.contexts.some(t=>this.activeContexts.has(t))}triggerShortcutEvent(e){let t=new CustomEvent("app-shortcut",{detail:{id:e},bubbles:!0});document.dispatchEvent(t)}isInputElement(e){if(!e)return!1;let t=e.tagName.toLowerCase(),n=t==="input"||t==="textarea",r=e.isContentEditable;if(n){let a=e.type?.toLowerCase();return!["button","checkbox","radio","submit","reset"].includes(a)}return r}registerDefaultShortcuts(){let e=[{id:"help",key:"h",modifiers:{ctrl:!0,shift:!0},description:"Mostrar esta ayuda",group:"General",contexts:["global"]},{id:"zoom-in",key:"=",modifiers:{ctrl:!0},description:"Acercar",group:"Visualizaci\xF3n",contexts:["map"]},{id:"zoom-out",key:"-",modifiers:{ctrl:!0},description:"Alejar",group:"Visualizaci\xF3n",contexts:["map"]},{id:"zoom-reset",key:"0",modifiers:{ctrl:!0},description:"Restablecer zoom",group:"Visualizaci\xF3n",contexts:["map"]},{id:"fit-screen",key:"f",description:"Ajustar a la pantalla",group:"Visualizaci\xF3n",contexts:["map"]},{id:"pan-mode",key:"p",description:"Modo panor\xE1mico",group:"Herramientas",contexts:["map"]},{id:"select-mode",key:"s",description:"Modo selecci\xF3n",group:"Herramientas",contexts:["map"]},{id:"save",key:"s",modifiers:{ctrl:!0},description:"Guardar cambios",group:"Edici\xF3n",contexts:["editor","batch-editor"]},{id:"cancel",key:"Escape",description:"Cancelar operaci\xF3n actual",group:"General",contexts:["global"]},{id:"delete",key:"Delete",description:"Eliminar elemento seleccionado",group:"Edici\xF3n",contexts:["editor","map"]},{id:"undo",key:"z",modifiers:{ctrl:!0},description:"Deshacer",group:"Edici\xF3n",contexts:["editor","map","batch-editor"]},{id:"redo",key:"y",modifiers:{ctrl:!0},description:"Rehacer",group:"Edici\xF3n",contexts:["editor","map","batch-editor"]},{id:"refresh",key:"r",modifiers:{ctrl:!0},description:"Actualizar datos",group:"Datos",contexts:["global"]}];this.registerShortcuts(e)}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();function Qm(o,i){if(o&1&&(c(0,"mat-chip"),p(1),d()),o&2){let e=i.$implicit;m(),x(e)}}function Zm(o,i){if(o&1&&(c(0,"div",10)(1,"span",11),p(2,"Contextos activos:"),d(),c(3,"mat-chip-set"),E(4,Qm,2,1,"mat-chip",12),d()()),o&2){let e=v();m(4),h("ngForOf",e.activeContexts)}}function Ym(o,i){if(o&1&&(c(0,"div",13)(1,"mat-icon"),p(2,"keyboard"),d(),c(3,"p"),p(4),d()()),o&2){let e=v();m(4),j("No hay atajos de teclado ",e.showAllShortcuts?"registrados":"activos","")}}function Xm(o,i){o&1&&(c(0,"th",22),p(1,"Contexto"),d())}function Jm(o,i){if(o&1&&(c(0,"span"),p(1),d()),o&2){let e=v(2).$implicit;m(),j("+",e.contexts.length-1,"")}}function eg(o,i){if(o&1&&(c(0,"td",26)(1,"span",27),p(2),E(3,Jm,2,1,"span",28),d()()),o&2){let e=v().$implicit,t=v(3);m(),h("matTooltip",t.getContextsLabel(e)),m(),j(" ",e.contexts&&e.contexts.length?e.contexts[0]:"Global"," "),m(),h("ngIf",e.contexts&&e.contexts.length>1)}}function tg(o,i){if(o&1&&(c(0,"tr")(1,"td",23)(2,"kbd"),p(3),d()(),c(4,"td",24),p(5),d(),E(6,eg,4,3,"td",25),d()),o&2){let e=i.$implicit,t=v(3);Z("inactive",t.showAllShortcuts&&!t.isShortcutActive(e)),m(3),x(t.formatKeyCombo(e)),m(2),j(" ",e.description," "),m(),h("ngIf",t.showAllShortcuts)}}function ng(o,i){if(o&1&&(c(0,"mat-expansion-panel",16)(1,"mat-expansion-panel-header")(2,"mat-panel-title"),p(3),d()(),c(4,"div",17)(5,"table")(6,"thead")(7,"tr")(8,"th",18),p(9,"Atajo"),d(),c(10,"th",19),p(11,"Descripci\xF3n"),d(),E(12,Xm,2,0,"th",20),d()(),c(13,"tbody"),E(14,tg,7,5,"tr",21),d()()()()),o&2){let e=i.$implicit,t=v(2);h("expanded",!0),m(3),j(" ",e.name," "),m(9),h("ngIf",t.showAllShortcuts),m(2),h("ngForOf",e.shortcuts)}}function ig(o,i){if(o&1&&(c(0,"div",14),E(1,ng,15,4,"mat-expansion-panel",15),d()),o&2){let e=v();m(),h("ngForOf",e.shortcutGroups)}}var yc=(()=>{class o{constructor(e,t){this.dialogRef=e,this.keyboardShortcutsService=t,this.shortcutGroups=[],this.activeContexts=[],this.showAllShortcuts=!1}ngOnInit(){this.activeContexts=this.keyboardShortcutsService.getActiveContexts(),this.loadShortcuts()}loadShortcuts(){let e=this.showAllShortcuts?this.keyboardShortcutsService.getAllShortcuts():this.keyboardShortcutsService.getActiveShortcuts(),t=new Map;e.forEach(n=>{t.has(n.group)||t.set(n.group,[]),t.get(n.group)?.push(n)}),this.shortcutGroups=Array.from(t.entries()).map(([n,r])=>({name:n,shortcuts:r})).sort((n,r)=>n.name.localeCompare(r.name))}formatKeyCombo(e){let t=e.modifiers||{},n=[];t.ctrl&&n.push("Ctrl"),t.alt&&n.push("Alt"),t.shift&&n.push("Shift"),t.meta&&n.push("Meta");let r=this.formatKey(e.key);return n.push(r),n.join(" + ")}formatKey(e){let t={arrowup:"\u2191",arrowdown:"\u2193",arrowleft:"\u2190",arrowright:"\u2192",enter:"Enter",escape:"Esc",space:"Espacio",delete:"Delete",backspace:"Backspace",tab:"Tab"},n=e.toLowerCase();return t[n]||e.toUpperCase()}toggleShowAllShortcuts(){this.showAllShortcuts=!this.showAllShortcuts,this.loadShortcuts()}isShortcutActive(e){return!e.contexts||e.contexts.length===0?!0:e.contexts.some(t=>this.activeContexts.includes(t))}getContextsLabel(e){return!e.contexts||e.contexts.length===0?"General":e.contexts.join(", ")}close(){this.dialogRef.close()}static{this.\u0275fac=function(t){return new(t||o)(A(Gn),A(ii))}}static{this.\u0275cmp=Y({type:o,selectors:[["app-shortcuts-help-dialog"]],decls:17,vars:4,consts:[[1,"shortcuts-dialog"],["mat-dialog-title",""],[1,"dialog-actions"],["mat-button","",1,"toggle-button",3,"click"],["mat-icon-button","","aria-label","Cerrar",3,"click"],["class","contexts-info",4,"ngIf"],["class","empty-state",4,"ngIf"],["class","shortcut-groups",4,"ngIf"],["align","end"],["mat-button","",3,"click"],[1,"contexts-info"],[1,"contexts-label"],[4,"ngFor","ngForOf"],[1,"empty-state"],[1,"shortcut-groups"],[3,"expanded",4,"ngFor","ngForOf"],[3,"expanded"],[1,"shortcuts-table"],[1,"shortcut-header"],[1,"description-header"],["class","context-header",4,"ngIf"],[3,"inactive",4,"ngFor","ngForOf"],[1,"context-header"],[1,"shortcut-key"],[1,"shortcut-description"],["class","shortcut-context",4,"ngIf"],[1,"shortcut-context"],[3,"matTooltip"],[4,"ngIf"]],template:function(t,n){t&1&&(c(0,"div",0)(1,"h2",1)(2,"span"),p(3,"Atajos de teclado"),d(),c(4,"div",2)(5,"button",3),y("click",function(){return n.toggleShowAllShortcuts()}),p(6),d(),c(7,"button",4),y("click",function(){return n.close()}),c(8,"mat-icon"),p(9,"close"),d()()()(),E(10,Zm,5,1,"div",5),c(11,"mat-dialog-content"),E(12,Ym,5,1,"div",6)(13,ig,2,1,"div",7),d(),c(14,"mat-dialog-actions",8)(15,"button",9),y("click",function(){return n.close()}),p(16,"Cerrar"),d()()()),t&2&&(m(6),j(" ",n.showAllShortcuts?"Mostrar solo activos":"Mostrar todos"," "),m(4),h("ngIf",n.activeContexts.length>0),m(2),h("ngIf",n.shortcutGroups.length===0),m(),h("ngIf",n.shortcutGroups.length>0))},dependencies:[ee,We,re,pe,ue,be,Ve,Be,nn,Hn,Kn,Wn,qn,ao,so,lo,on,mo,yl,Me,ke],styles:[".shortcuts-dialog[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;padding-right:0}.shortcuts-dialog[_ngcontent-%COMP%]   .dialog-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.shortcuts-dialog[_ngcontent-%COMP%]   .toggle-button[_ngcontent-%COMP%]{font-size:12px;height:32px;line-height:32px}.shortcuts-dialog[_ngcontent-%COMP%]   mat-dialog-content[_ngcontent-%COMP%]{max-height:70vh;min-height:300px}.shortcuts-dialog[_ngcontent-%COMP%]   .contexts-info[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:16px;padding:0 16px}.shortcuts-dialog[_ngcontent-%COMP%]   .contexts-info[_ngcontent-%COMP%]   .contexts-label[_ngcontent-%COMP%]{margin-right:8px;font-weight:500;color:#0009}.shortcuts-dialog[_ngcontent-%COMP%]   .contexts-info[_ngcontent-%COMP%]   mat-chip-set[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:4px}.shortcuts-dialog[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]{height:200px;display:flex;flex-direction:column;justify-content:center;align-items:center;color:#0000008a}.shortcuts-dialog[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;height:48px;width:48px;margin-bottom:16px}.shortcuts-dialog[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px}.shortcuts-dialog[_ngcontent-%COMP%]   .shortcut-groups[_ngcontent-%COMP%]   mat-expansion-panel[_ngcontent-%COMP%]{margin-bottom:16px}.shortcuts-dialog[_ngcontent-%COMP%]   .shortcut-groups[_ngcontent-%COMP%]   mat-expansion-panel[_ngcontent-%COMP%]:last-child{margin-bottom:0}.shortcuts-dialog[_ngcontent-%COMP%]   .shortcuts-table[_ngcontent-%COMP%]{width:100%}.shortcuts-dialog[_ngcontent-%COMP%]   .shortcuts-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.shortcuts-dialog[_ngcontent-%COMP%]   .shortcuts-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:left;padding:8px;font-weight:500;color:#0009;border-bottom:1px solid rgba(0,0,0,.12)}.shortcuts-dialog[_ngcontent-%COMP%]   .shortcuts-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border-bottom:1px solid rgba(0,0,0,.12)}.shortcuts-dialog[_ngcontent-%COMP%]   .shortcuts-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:last-child{border-bottom:none}.shortcuts-dialog[_ngcontent-%COMP%]   .shortcuts-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr.inactive[_ngcontent-%COMP%]{opacity:.5}.shortcuts-dialog[_ngcontent-%COMP%]   .shortcuts-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px 8px}.shortcuts-dialog[_ngcontent-%COMP%]   .shortcuts-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td.shortcut-key[_ngcontent-%COMP%]{width:20%;min-width:120px}.shortcuts-dialog[_ngcontent-%COMP%]   .shortcuts-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td.shortcut-description[_ngcontent-%COMP%]{width:60%}.shortcuts-dialog[_ngcontent-%COMP%]   .shortcuts-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td.shortcut-context[_ngcontent-%COMP%]{width:20%;color:#0009;font-size:12px}.shortcuts-dialog[_ngcontent-%COMP%]   kbd[_ngcontent-%COMP%]{display:inline-block;padding:4px 8px;font-family:monospace;font-size:14px;line-height:1;color:#444;background-color:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px #0003;white-space:nowrap;margin:0 2px}.dark-theme[_nghost-%COMP%]   .shortcuts-dialog[_ngcontent-%COMP%]   .contexts-info[_ngcontent-%COMP%]   .contexts-label[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   .shortcuts-dialog[_ngcontent-%COMP%]   .contexts-info[_ngcontent-%COMP%]   .contexts-label[_ngcontent-%COMP%]{color:#ffffffb3}.dark-theme[_nghost-%COMP%]   .shortcuts-dialog[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   .shortcuts-dialog[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]{color:#ffffffb3}.dark-theme[_nghost-%COMP%]   .shortcuts-dialog[_ngcontent-%COMP%]   .shortcuts-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   .shortcuts-dialog[_ngcontent-%COMP%]   .shortcuts-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{color:#ffffffb3;border-bottom:1px solid rgba(255,255,255,.12)}.dark-theme[_nghost-%COMP%]   .shortcuts-dialog[_ngcontent-%COMP%]   .shortcuts-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   .shortcuts-dialog[_ngcontent-%COMP%]   .shortcuts-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border-bottom:1px solid rgba(255,255,255,.12)}.dark-theme[_nghost-%COMP%]   .shortcuts-dialog[_ngcontent-%COMP%]   .shortcuts-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td.shortcut-context[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   .shortcuts-dialog[_ngcontent-%COMP%]   .shortcuts-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td.shortcut-context[_ngcontent-%COMP%]{color:#ffffffb3}.dark-theme[_nghost-%COMP%]   .shortcuts-dialog[_ngcontent-%COMP%]   kbd[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   .shortcuts-dialog[_ngcontent-%COMP%]   kbd[_ngcontent-%COMP%]{color:#e0e0e0;background-color:#424242;border-color:#666;box-shadow:0 1px #ffffff1a}.shortcuts-dialog-container[_ngcontent-%COMP%]   .mat-mdc-dialog-container[_ngcontent-%COMP%]{padding:16px}.shortcuts-dialog-content[_ngcontent-%COMP%]{max-height:80vh;padding:0}.shortcuts-list[_ngcontent-%COMP%]{padding:16px}.shortcut-item[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:12px;padding:8px;border-radius:4px}.shortcut-item[_ngcontent-%COMP%]:hover{background-color:#0000000a}.shortcut-combo[_ngcontent-%COMP%]{min-width:120px;background-color:#f5f5f5;padding:4px 8px;border-radius:4px;font-family:monospace;font-weight:700;text-align:center;white-space:nowrap;margin-right:16px;font-size:14px;box-shadow:0 1px 2px #0000001a}.shortcut-description[_ngcontent-%COMP%]{flex:1;font-size:14px}.shortcut-context[_ngcontent-%COMP%]{font-size:12px;color:#0000008a;margin-left:8px;display:flex;align-items:center}.shortcut-context[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;height:16px;width:16px;margin-right:4px}  .mat-tab-body-content{padding:8px 0}  .mat-dialog-container{padding:0}  .mat-dialog-title{margin:0;padding:16px 16px 0}  .mat-dialog-actions{margin:0;padding:8px 16px 16px}"]})}}return o})();var ri=(()=>{class o{constructor(e){this.dialog=e,document.addEventListener("app-shortcut",t=>{t.detail&&t.detail.id==="help"&&this.showKeyboardShortcutsHelp()})}showKeyboardShortcutsHelp(){this.dialog.open(yc,{width:"600px",maxWidth:"90vw",maxHeight:"80vh",panelClass:"shortcuts-dialog-container"})}static{this.\u0275fac=function(t){return new(t||o)(O(nt))}}static{this.\u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();function og(o,i){o&1&&(c(0,"div",26)(1,"mat-icon"),p(2,"notifications_none"),d(),c(3,"p"),p(4,"No hay notificaciones nuevas"),d()())}function rg(o,i){o&1&&(c(0,"mat-icon"),p(1,"account_circle"),d())}function ag(o,i){if(o&1&&D(0,"img",27),o&2){let e=v();h("src",e.userAvatar,xs)}}var sg={"/dashboard":"Dashboard","/network-design":"Dise\xF1o de Red","/projects":"Proyectos","/offline":"Modo Offline","/settings":"Configuraci\xF3n","/profile":"Mi Perfil","/help":"Ayuda"},xc=(()=>{class o{constructor(e,t,n){this.authService=e,this.router=t,this.helpService=n,this.navCollapsed=!1,this.pageTitle="Dashboard",this.notificationCount=0,this.userName="Usuario",this.userAvatar=null,this.userRoles=[],this.subscriptions=new qt}ngOnInit(){this.loadUserData(),this.subscriptions.add(this.router.events.pipe(Ee(e=>e instanceof Nn),de(e=>{let t="/"+e.urlAfterRedirects.split("/")[1];return sg[t]||"Network Map"})).subscribe(e=>{this.pageTitle=e}))}ngOnDestroy(){this.subscriptions.unsubscribe()}toggleSidebar(){this.navCollapsed=!this.navCollapsed}logout(){this.authService.logout()}markAllAsRead(){this.notificationCount=0}loadUserData(){let e=this.authService.getCurrentUser();e&&(this.userName=`${e.firstName} ${e.lastName}`,this.userAvatar=null,this.userRoles=[e.role])}showKeyboardShortcuts(){this.helpService.showKeyboardShortcutsHelp()}static{this.\u0275fac=function(t){return new(t||o)(A(tt),A(Oe),A(ri))}}static{this.\u0275cmp=Y({type:o,selectors:[["app-main-layout"]],decls:54,vars:13,consts:[["notificationsMenu","matMenu"],["userMenu","matMenu"],[1,"layout-container"],[3,"collapsed","userRoles"],[1,"content-container"],[1,"top-toolbar"],[1,"toolbar-left"],["mat-icon-button","",3,"click"],[1,"page-title"],[1,"toolbar-actions"],["mat-icon-button","","matTooltip","Atajos de teclado",3,"click"],["mat-icon-button","",3,"matMenuTriggerFor"],["matBadgeColor","warn","aria-hidden","false",3,"matBadge","matBadgeHidden"],[1,"notifications-menu"],[1,"notification-header"],["mat-button","","color","primary",3,"click"],["class","empty-notifications",4,"ngIf"],["mat-button","",1,"user-menu-button",3,"matMenuTriggerFor"],[1,"user-avatar"],[4,"ngIf"],["alt","Avatar",3,"src",4,"ngIf"],[1,"username"],["mat-menu-item","","routerLink","/profile"],["mat-menu-item","","routerLink","/settings"],["mat-menu-item","",3,"click"],[1,"main-content"],[1,"empty-notifications"],["alt","Avatar",3,"src"]],template:function(t,n){if(t&1){let r=V();c(0,"div",2),D(1,"app-navigation-sidebar",3),c(2,"div",4)(3,"mat-toolbar",5)(4,"div",6)(5,"button",7),y("click",function(){return b(r),C(n.toggleSidebar())}),c(6,"mat-icon"),p(7,"menu"),d()(),c(8,"h1",8),p(9),d()(),c(10,"div",9)(11,"button",10),y("click",function(){return b(r),C(n.showKeyboardShortcuts())}),c(12,"mat-icon"),p(13,"keyboard"),d()(),c(14,"button",11)(15,"mat-icon",12),p(16," notifications "),d()(),c(17,"mat-menu",13,0)(19,"div",14)(20,"h3"),p(21,"Notificaciones"),d(),c(22,"button",15),y("click",function(){return b(r),C(n.markAllAsRead())}),p(23,"Marcar todas como le\xEDdas"),d()(),D(24,"mat-divider"),E(25,og,5,0,"div",16),d(),c(26,"button",17)(27,"div",18),E(28,rg,2,0,"mat-icon",19)(29,ag,1,1,"img",20),d(),c(30,"span",21),p(31),d(),c(32,"mat-icon"),p(33,"arrow_drop_down"),d()(),c(34,"mat-menu",null,1)(36,"button",22)(37,"mat-icon"),p(38,"person"),d(),c(39,"span"),p(40,"Mi Perfil"),d()(),c(41,"button",23)(42,"mat-icon"),p(43,"settings"),d(),c(44,"span"),p(45,"Configuraci\xF3n"),d()(),D(46,"mat-divider"),c(47,"button",24),y("click",function(){return b(r),C(n.logout())}),c(48,"mat-icon"),p(49,"exit_to_app"),d(),c(50,"span"),p(51,"Cerrar Sesi\xF3n"),d()()()()(),c(52,"div",25),D(53,"router-outlet"),d()()()}if(t&2){let r=wt(18),a=wt(35);m(),h("collapsed",n.navCollapsed)("userRoles",n.userRoles),m(),Z("nav-collapsed",n.navCollapsed),m(7),x(n.pageTitle),m(5),h("matMenuTriggerFor",r),m(),h("matBadge",n.notificationCount)("matBadgeHidden",n.notificationCount===0),m(10),h("ngIf",n.notificationCount===0),m(),h("matMenuTriggerFor",a),m(2),h("ngIf",!n.userAvatar),m(),h("ngIf",n.userAvatar),m(2),x(n.userName)}},dependencies:[ee,re,Zt,Nt,Ln,Fn,Xs,pe,ue,$n,Bn,zn,Vn,be,Ve,Be,ni,en,nl,Ke,Lt,Me,ke,Cc],styles:[".layout-container[_ngcontent-%COMP%]{display:flex;height:100vh;width:100vw;overflow:hidden}.content-container[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;width:calc(100% - 240px);transition:width .3s ease}.content-container.nav-collapsed[_ngcontent-%COMP%]{width:calc(100% - 64px)}.top-toolbar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;background-color:#fff;color:#000000de;border-bottom:1px solid #e0e0e0;padding:0 16px}.toolbar-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.page-title[_ngcontent-%COMP%]{font-size:20px;font-weight:500;margin:0}.toolbar-actions[_ngcontent-%COMP%], .user-menu-button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.user-avatar[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:32px;height:32px;border-radius:50%;background-color:#f0f0f0;overflow:hidden}.user-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.username[_ngcontent-%COMP%]{max-width:150px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.main-content[_ngcontent-%COMP%]{flex:1;overflow:auto;padding:16px;background-color:#f5f5f5}.notifications-menu[_ngcontent-%COMP%]{min-width:320px}.notification-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px}.notification-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-weight:500}.empty-notifications[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:24px;color:#757575}.empty-notifications[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;height:48px;width:48px;margin-bottom:8px}"]})}}return o})();var Sc=(o,i)=>{let e=P(tt),t=P(Oe);return e.isAuthenticated()?!0:(t.navigate(["/auth/login"],{queryParams:{returnUrl:i.url}}),!1)};var Mc=(o,i)=>{let e=P(tt),t=P(Oe);return e.isAuthenticated()?(t.navigate(["/dashboard"]),!1):!0};var Pc=o=>{let i=P(tt),e=P(Oe);return i.isAuthenticated()&&i.hasAnyRole(o)?!0:e.createUrlTree(["/dashboard"])};var lg=[[["",8,"widget-header"]]],cg=[".widget-header"];function dg(o,i){if(o&1&&(c(0,"div",4)(1,"span",5),p(2,"Descripci\xF3n:"),d(),c(3,"span",6),p(4),d()()),o&2){let e=v(2);m(4),x(e.selectedElement.description)}}function pg(o,i){if(o&1&&(c(0,"div",4)(1,"span",5),p(2,"Posici\xF3n:"),d(),c(3,"span",6),p(4),$e(5,"number"),$e(6,"number"),d()()),o&2){let e=v(2);m(4),Dn(" ",At(5,2,e.selectedElement.position.lat,"1.6-6"),", ",At(6,5,e.selectedElement.position.lng,"1.6-6")," ")}}function mg(o,i){if(o&1){let e=V();c(0,"div",1),bi(1),c(2,"div",2)(3,"h3"),p(4),d(),D(5,"mat-divider"),c(6,"div",3)(7,"div",4)(8,"span",5),p(9,"ID:"),d(),c(10,"span",6),p(11),d()(),c(12,"div",4)(13,"span",5),p(14,"Tipo:"),d(),c(15,"span",6),p(16),d()(),E(17,dg,5,1,"div",7)(18,pg,7,8,"div",7),d(),c(19,"div",8)(20,"button",9),y("click",function(){b(e);let n=v();return C(n.onEditElement())}),c(21,"mat-icon"),p(22,"edit"),d(),p(23," Editar "),d(),c(24,"button",10),y("click",function(){b(e);let n=v();return C(n.onDeleteElement())}),c(25,"mat-icon"),p(26,"delete"),d(),p(27," Eliminar "),d(),c(28,"button",11),y("click",function(){b(e);let n=v();return C(n.onLocateElement())}),c(29,"mat-icon"),p(30,"my_location"),d(),p(31," Localizar "),d(),c(32,"button",11),y("click",function(){b(e);let n=v();return C(n.onViewConnections())}),c(33,"mat-icon"),p(34,"link"),d(),p(35," Ver conexiones "),d()()()()}if(o&2){let e=v();m(4),x(e.selectedElement.name||"Elemento sin nombre"),m(7),x(e.selectedElement.id),m(5),x(e.selectedElement.type),m(),h("ngIf",e.selectedElement.description),m(),h("ngIf",e.selectedElement.position)}}var Tc=(()=>{class o{constructor(){this.selectedElement=null,this.widgetAction=new H,this.widgetError=new H,this.widgetUpdate=new H,this.viewConnections=new H}onEditElement(){this.selectedElement&&this.widgetAction.emit({source:"element-properties-widget",type:"action",timestamp:new Date,action:"edit",elementId:this.selectedElement.id,actionData:{element:this.selectedElement}})}onDeleteElement(){this.selectedElement&&this.widgetAction.emit({source:"element-properties-widget",type:"action",timestamp:new Date,action:"delete",elementId:this.selectedElement.id,actionData:{element:this.selectedElement}})}onLocateElement(){this.selectedElement&&this.widgetAction.emit({source:"element-properties-widget",type:"action",timestamp:new Date,action:"locate",elementId:this.selectedElement.id,actionData:{element:this.selectedElement}})}onViewConnections(){this.selectedElement?.id&&this.viewConnections.emit(this.selectedElement.id)}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=Y({type:o,selectors:[["app-element-properties-widget"]],inputs:{selectedElement:"selectedElement"},outputs:{widgetAction:"widgetAction",widgetError:"widgetError",widgetUpdate:"widgetUpdate",viewConnections:"viewConnections"},ngContentSelectors:cg,decls:1,vars:1,consts:[["class","widget-container",4,"ngIf"],[1,"widget-container"],[1,"widget-content"],[1,"element-properties"],[1,"property-row"],[1,"property-label"],[1,"property-value"],["class","property-row",4,"ngIf"],[1,"actions"],["mat-button","","color","primary",3,"click"],["mat-button","","color","warn",3,"click"],["mat-button","",3,"click"]],template:function(t,n){t&1&&(vi(lg),E(0,mg,36,5,"div",0)),t&2&&h("ngIf",n.selectedElement)},dependencies:[ee,re,Yi,be,Ve,pe,ue,Ke,Lt,qn],styles:[".widget-container[_ngcontent-%COMP%]{width:300px;max-height:400px;overflow-y:auto}.widget-content[_ngcontent-%COMP%]{padding:16px}h3[_ngcontent-%COMP%]{margin-top:0;margin-bottom:12px;font-size:16px;font-weight:500;color:#333}.element-properties[_ngcontent-%COMP%]{margin:12px 0}.property-row[_ngcontent-%COMP%]{display:flex;margin-bottom:8px}.property-label[_ngcontent-%COMP%]{font-weight:500;min-width:100px;color:#555}.property-value[_ngcontent-%COMP%]{flex:1;word-break:break-word}.actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-top:16px}"],changeDetection:0})}}return o})();var Oc=(()=>{class o{constructor(){}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var kc=o=>({width:o}),hg=()=>[];function fg(o,i){o&1&&(c(0,"div",23),D(1,"div",24)(2,"div",24)(3,"div",25),c(4,"div",26),D(5,"div",27)(6,"div",24)(7,"div",24),d()())}function _g(o,i){if(o&1&&(c(0,"div",29)(1,"span",30),p(2,"Descripci\xF3n:"),d(),c(3,"span",38),p(4),d()()),o&2){let e=v(3);m(4),x(e.element.description)}}function vg(o,i){if(o&1&&(c(0,"span"),p(1),d()),o&2){let e=v(4);m(),j("Alt: ",e.element.position.altitude,"m")}}function bg(o,i){if(o&1&&(c(0,"div",39)(1,"div",40)(2,"mat-icon"),p(3,"location_on"),d(),c(4,"span"),p(5,"Ubicaci\xF3n"),d()(),c(6,"div",41)(7,"span"),p(8),$e(9,"number"),d(),c(10,"span"),p(11),$e(12,"number"),d(),E(13,vg,2,1,"span",42),c(14,"button",43)(15,"mat-icon"),p(16,"map"),d()()()()),o&2){let e=v(3);m(8),j("Lat: ",At(9,3,e.element.position.coordinates[1],"1.6-6"),""),m(3),j("Lon: ",At(12,6,e.element.position.coordinates[0],"1.6-6"),""),m(2),h("ngIf",e.element.position.altitude)}}function Cg(o,i){if(o&1&&(c(0,"div",29)(1,"span",30),p(2,"Fabricante:"),d(),c(3,"span",31),p(4),d()()),o&2){let e=v(4);m(4),x(e.element.manufacturer)}}function yg(o,i){if(o&1&&(c(0,"div",29)(1,"span",30),p(2,"Modelo:"),d(),c(3,"span",31),p(4),d()()),o&2){let e=v(4);m(4),x(e.element.model)}}function Eg(o,i){if(o&1&&(c(0,"div",29)(1,"span",30),p(2,"Total puertos:"),d(),c(3,"span",31),p(4),d()()),o&2){let e=v(4);m(4),x(e.element.portCount)}}function wg(o,i){if(o&1&&(c(0,"div",46)(1,"div",47)(2,"span",48),p(3,"PON"),d(),c(4,"span",49),p(5),d()(),c(6,"div",47)(7,"span",48),p(8,"Distribuci\xF3n"),d(),c(9,"span",49),p(10),d()(),c(11,"div",47)(12,"span",48),p(13,"Uplink"),d(),c(14,"span",49),p(15),d()()()),o&2){let e=v(4);m(),Z("active",e.isPonPortActive(e.element)),m(4),x(e.element.ponPorts||0),m(),Z("active",e.isDistributionPortActive(e.element)),m(4),x(e.element.distributionPorts||0),m(),Z("active",e.isUplinkPortActive(e.element)),m(4),x(e.element.uplinkPorts||0)}}function xg(o,i){if(o&1&&(c(0,"div",44)(1,"div",40)(2,"mat-icon"),p(3,"memory"),d(),c(4,"span"),p(5,"Informaci\xF3n OLT"),d()(),E(6,Cg,5,1,"div",32)(7,yg,5,1,"div",32)(8,Eg,5,1,"div",32)(9,wg,16,9,"div",45),d()),o&2){let e=v(3);m(6),h("ngIf",e.element.manufacturer),m(),h("ngIf",e.element.model),m(),h("ngIf",e.element.portCount),m(),h("ngIf",e.element.ponPorts||e.element.distributionPorts||e.element.uplinkPorts)}}function Sg(o,i){if(o&1&&(c(0,"div",29)(1,"span",30),p(2,"Fabricante:"),d(),c(3,"span",31),p(4),d()()),o&2){let e=v(4);m(4),x(e.element.manufacturer)}}function Mg(o,i){if(o&1&&(c(0,"div",29)(1,"span",30),p(2,"Modelo:"),d(),c(3,"span",31),p(4),d()()),o&2){let e=v(4);m(4),x(e.element.model)}}function Pg(o,i){if(o&1&&(c(0,"div",29)(1,"span",30),p(2,"N\xB0 Serie:"),d(),c(3,"span",31),p(4),d()()),o&2){let e=v(4);m(4),x(e.element.serialNumber)}}function Tg(o,i){if(o&1&&(c(0,"div",29)(1,"span",30),p(2,"Est\xE1ndar PON:"),d(),c(3,"span",31),p(4),d()()),o&2){let e=v(4);m(4),x(e.element.ponStandard)}}function Og(o,i){if(o&1&&(c(0,"div",51)(1,"span",30),p(2,"Se\xF1al:"),d(),c(3,"div",52),D(4,"div",53),d(),c(5,"span",54),p(6),d()()),o&2){let e=v(4);m(4),h("ngStyle",xt(3,kc,e.element.signalStrength>=-25?"100%":e.element.signalStrength>=-28?"80%":e.element.signalStrength>=-32?"60%":e.element.signalStrength>=-35?"40%":"20%"))("ngClass",e.element.signalStrength>=-28?"excellent":e.element.signalStrength>=-32?"good":e.element.signalStrength>=-35?"fair":"poor"),m(2),j("",e.element.signalStrength," dBm")}}function kg(o,i){if(o&1&&(c(0,"div",44)(1,"div",40)(2,"mat-icon"),p(3,"router"),d(),c(4,"span"),p(5,"Informaci\xF3n ONT"),d()(),E(6,Sg,5,1,"div",32)(7,Mg,5,1,"div",32)(8,Pg,5,1,"div",32)(9,Tg,5,1,"div",32)(10,Og,7,5,"div",50),d()),o&2){let e=v(3);m(6),h("ngIf",e.element.manufacturer),m(),h("ngIf",e.element.model),m(),h("ngIf",e.element.serialNumber),m(),h("ngIf",e.element.ponStandard),m(),h("ngIf",e.element.signalStrength!==void 0)}}function Ig(o,i){if(o&1&&(c(0,"div",29)(1,"span",30),p(2,"Relaci\xF3n:"),d(),c(3,"span",31),p(4),d()()),o&2){let e=v(4);m(4),x(e.element.splitRatio)}}function Dg(o,i){if(o&1&&(c(0,"div",29)(1,"span",30),p(2,"Puertos de salida:"),d(),c(3,"span",31),p(4),d()()),o&2){let e=v(4);m(4),x(e.element.outputPorts)}}function Ag(o,i){o&1&&D(0,"div",60)}function Rg(o,i){if(o&1&&(c(0,"div",56),D(1,"div",57),c(2,"div",58),E(3,Ag,1,0,"div",59),d()()),o&2){let e=v(4);m(3),h("ngForOf",jt(1,hg).constructor(e.getOutputPortCount(e.element.splitRatio)))}}function Ng(o,i){if(o&1&&(c(0,"div",29)(1,"span",30),p(2,"Instalaci\xF3n:"),d(),c(3,"span",31),p(4),$e(5,"date"),d()()),o&2){let e=v(4);m(4),x(At(5,1,e.element.installationDate,"dd/MM/yyyy"))}}function Lg(o,i){if(o&1&&(c(0,"div",44)(1,"div",40)(2,"mat-icon"),p(3,"device_hub"),d(),c(4,"span"),p(5,"Informaci\xF3n Splitter"),d()(),E(6,Ig,5,1,"div",32)(7,Dg,5,1,"div",32)(8,Rg,4,2,"div",55)(9,Ng,6,4,"div",32),d()),o&2){let e=v(3);m(6),h("ngIf",e.element.splitRatio),m(),h("ngIf",e.element.outputPorts),m(),h("ngIf",e.element.splitRatio),m(),h("ngIf",e.element.installationDate)}}function Fg(o,i){if(o&1&&(c(0,"div",29)(1,"span",30),p(2,"Fabricante:"),d(),c(3,"span",31),p(4),d()()),o&2){let e=v(4);m(4),x(e.element.manufacturer)}}function zg(o,i){if(o&1&&(c(0,"div",29)(1,"span",30),p(2,"Modelo:"),d(),c(3,"span",31),p(4),d()()),o&2){let e=v(4);m(4),x(e.element.model)}}function Bg(o,i){if(o&1&&(c(0,"div",62)(1,"span",30),p(2,"Capacidad de puertos:"),d(),c(3,"div",63),D(4,"div",64),d(),c(5,"span",65),p(6),d()()),o&2){let e=v(4);m(4),h("ngStyle",xt(4,kc,e.getPortUsagePercentage(e.element)+"%"))("ngClass",e.isPortUsageCritical(e.element)?"critical":e.isPortUsageWarning(e.element)?"warning":"normal"),m(2),Dn("",e.element.usedPorts||0," de ",e.element.totalPortCapacity,"")}}function Vg(o,i){if(o&1&&(c(0,"div",44)(1,"div",40)(2,"mat-icon"),p(3,"grid_on"),d(),c(4,"span"),p(5,"Informaci\xF3n ODF"),d()(),E(6,Fg,5,1,"div",32)(7,zg,5,1,"div",32)(8,Bg,7,6,"div",61),d()),o&2){let e=v(3);m(6),h("ngIf",e.element.manufacturer),m(),h("ngIf",e.element.model),m(),h("ngIf",e.element.totalPortCapacity)}}function $g(o,i){if(o&1&&(c(0,"div",29)(1,"span",30),p(2,"\xDAltimo mantenimiento:"),d(),c(3,"span",31),p(4),$e(5,"date"),d()()),o&2){let e=v(4);m(4),x(At(5,1,e.element.lastMaintenance,"dd/MM/yyyy"))}}function jg(o,i){if(o&1&&(c(0,"div",29)(1,"span",30),p(2,"Pr\xF3ximo mantenimiento:"),d(),c(3,"span",31),p(4),$e(5,"date"),d()()),o&2){let e=v(4);m(4),x(At(5,1,e.element.nextMaintenance,"dd/MM/yyyy"))}}function Ug(o,i){if(o&1&&(c(0,"div",29)(1,"span",30),p(2,"Creado:"),d(),c(3,"span",31),p(4),$e(5,"date"),d()()),o&2){let e=v(4);m(4),x(At(5,1,e.element.createdAt,"dd/MM/yyyy"))}}function Gg(o,i){if(o&1&&(c(0,"div",44)(1,"div",40)(2,"mat-icon"),p(3,"info"),d(),c(4,"span"),p(5,"Informaci\xF3n adicional"),d()(),E(6,$g,6,4,"div",32)(7,jg,6,4,"div",32)(8,Ug,6,4,"div",32),d()),o&2){let e=v(3);m(6),h("ngIf",e.element.lastMaintenance),m(),h("ngIf",e.element.nextMaintenance),m(),h("ngIf",e.element.createdAt)}}function Hg(o,i){if(o&1&&(c(0,"div",77),D(1,"span",78),c(2,"span",79),p(3),d()()),o&2){let e=v().$implicit,t=v(5);m(),h("ngClass",t.getConnectionStatus(e)),m(2),x(t.getConnectionStatus(e))}}function Wg(o,i){if(o&1){let e=V();c(0,"div",69)(1,"button",70),y("click",function(){let n=b(e).$implicit,r=v(5);return C(r.navigateToElement(n.targetElementId))}),c(2,"mat-icon",71),p(3),d(),c(4,"div",72)(5,"span",73),p(6),d(),c(7,"span",74),p(8),d()(),E(9,Hg,4,2,"div",75),c(10,"mat-icon",76),p(11,"chevron_right"),d()()()}if(o&2){let e=i.$implicit,t=v(5);m(2),h("ngClass",t.getElementStatusClass(t.getConnectionTargetStatus(e))),m(),j(" ",t.getElementTypeIcon(t.getConnectionTargetType(e))," "),m(3),x(t.getConnectionTargetName(e)),m(2),x(t.getElementTypeName(t.getConnectionTargetType(e))),m(),h("ngIf",t.hasConnectionStatus(e))}}function Kg(o,i){if(o&1&&(Fe(0),E(1,Wg,12,5,"div",68),ze()),o&2){let e=v(4);m(),h("ngForOf",e.extendedConnections)}}function qg(o,i){if(o&1){let e=V();c(0,"div",69)(1,"button",70),y("click",function(){let n=b(e).$implicit,r=v(5);return C(r.navigateToElement(n))}),c(2,"mat-icon",80),p(3,"grid_view"),d(),c(4,"div",72)(5,"span",73),p(6,"ODF conectado"),d(),c(7,"span",74),p(8,"Marco de Distribuci\xF3n \xD3ptica"),d()(),c(9,"mat-icon",76),p(10,"chevron_right"),d()()()}}function Qg(o,i){if(o&1&&(Fe(0),E(1,qg,11,0,"div",68),ze()),o&2){let e=v(4);m(),h("ngForOf",e.element.odfIds)}}function Zg(o,i){if(o&1){let e=V();Fe(0),c(1,"div",69)(2,"button",70),y("click",function(){b(e);let n=v(4);return C(n.navigateToElement(n.element.oltId))}),c(3,"mat-icon",80),p(4,"router"),d(),c(5,"div",72)(6,"span",73),p(7,"OLT conectado"),d(),c(8,"span",74),p(9,"Terminal de L\xEDnea \xD3ptica"),d()(),c(10,"mat-icon",76),p(11,"chevron_right"),d()()(),ze()}}function Yg(o,i){if(o&1&&(c(0,"div",66)(1,"div",40)(2,"mat-icon"),p(3,"link"),d(),c(4,"span"),p(5,"Elementos relacionados"),d()(),c(6,"div",67),E(7,Kg,2,1,"ng-container",42)(8,Qg,2,1,"ng-container",42)(9,Zg,12,0,"ng-container",42),d()()),o&2){let e=v(3);m(7),h("ngIf",e.extendedConnections==null?null:e.extendedConnections.length),m(),h("ngIf",e.element.type==="OLT"&&(e.element.odfIds==null?null:e.element.odfIds.length)),m(),h("ngIf",e.element.type==="ONT"&&e.element.oltId)}}function Xg(o,i){if(o&1&&(c(0,"div",28)(1,"div",29)(2,"span",30),p(3,"C\xF3digo:"),d(),c(4,"span",31),p(5),d()(),E(6,_g,5,1,"div",32)(7,bg,17,9,"div",33),Fe(8,34),E(9,xg,10,4,"div",35)(10,kg,11,5,"div",35)(11,Lg,10,4,"div",35)(12,Vg,9,3,"div",35)(13,Gg,9,3,"div",36),ze(),E(14,Yg,10,3,"div",37),d()),o&2){let e=v(2);m(5),x(e.element.id||"No disponible"),m(),h("ngIf",e.element.description),m(),h("ngIf",e.element.position==null?null:e.element.position.coordinates),m(),h("ngSwitch",e.element.type),m(),h("ngSwitchCase","OLT"),m(),h("ngSwitchCase","ONT"),m(),h("ngSwitchCase","SPLITTER"),m(),h("ngSwitchCase","ODF"),m(2),h("ngIf",e.hasRelatedElements)}}function Jg(o,i){if(o&1){let e=V();c(0,"div",2)(1,"mat-card",3)(2,"div",4)(3,"div",5)(4,"div",6)(5,"mat-icon",7),p(6),d()(),c(7,"div",8)(8,"h2",9),p(9),d(),c(10,"div",10)(11,"span",11),p(12),d(),c(13,"span",12),p(14),$e(15,"slice"),d()(),c(16,"div",13),D(17,"span",14),p(18),d()()(),c(19,"div",15)(20,"button",16),y("click",function(){b(e);let n=v();return C(n.onEdit())}),c(21,"mat-icon"),p(22,"edit"),d()(),c(23,"button",17),y("click",function(){b(e);let n=v();return C(n.onViewHistory())}),c(24,"mat-icon"),p(25,"history"),d()(),c(26,"button",18),y("click",function(){b(e);let n=v();return C(n.onClose())}),c(27,"mat-icon"),p(28,"close"),d()()()(),c(29,"mat-card-content"),E(30,fg,8,0,"div",19)(31,Xg,15,9,"div",20),d()(),c(32,"div",21)(33,"button",22),y("click",function(){b(e);let n=v();return C(n.onDelete())}),c(34,"mat-icon"),p(35,"delete"),d(),c(36,"span"),p(37,"Eliminar"),d()()()()}if(o&2){let e=v();h("@slideInOut",void 0),m(4),h("ngClass",e.getElementStatusClass(e.element.status)),m(2),x(e.element.type==="OLT"?"router":e.element.type==="ONT"?"device_hub":e.element.type==="SPLITTER"?"call_split":e.element.type==="ODF"?"grid_view":e.element.type==="TERMINAL_BOX"?"inbox":e.element.type==="FIBER_THREAD"?"timeline":e.element.type==="MANGA"?"category":"settings_input_component"),m(3),x(e.element.name||"Sin nombre"),m(3),x(e.getElementTypeName(e.element.type)),m(2),j("ID: ",Ts(15,10,e.element.id,0,8),"..."),m(2),h("ngClass",e.getElementStatusClass(e.element.status)),m(2),j(" ",e.element.status," "),m(12),h("ngIf",e.loading),m(),h("ngIf",!e.loading)}}function eu(o,i){if(o&1){let e=V();c(0,"app-element-properties-widget",81),y("viewConnections",function(n){b(e);let r=v();return C(r.onViewConnections(n))}),d()}if(o&2){let e=v();h("selectedElement",e.element)}}var Ic=(()=>{class o{constructor(e){this.elementHistoryService=e,this.destroy$=new N,this.element=null,this.loading=!1,this.loadingRelated=!1,this.elementManagementService=P(kl),this.networkStateService=P(Ie),this.dialog=P(nt),this.router=P(Oe),this.snackBar=P(qe),this.cdr=P(He),this.viewConnections=new H}get hasRelatedElements(){return this.element?this.element.connections?.length?!0:!!(this.element.type===s.OLT&&this.element.odfIds?.length||this.element.type===s.ONT&&this.element.oltId):!1}get extendedConnections(){return this.element?.connections?this.element.connections.map((e,t)=>({id:e,name:`Conexi\xF3n ${t+1}`,type:vt.FIBER,status:Ze.ACTIVE,sourceElementId:this.element.id,targetElementId:e,targetName:`Elemento ${e.substring(0,8)}`,targetType:s.NODE,targetStatus:B.ACTIVE,connectionStatus:"connected"})):[]}ngOnInit(){this.subscribeToSelectedElement(),this.subscribeToNetworkState()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}subscribeToSelectedElement(){this.elementManagementService.getSelectedElement().pipe(L(this.destroy$)).subscribe({next:e=>{this.startLoadingElement(e)},error:e=>{this.handleElementLoadError(e)}})}startLoadingElement(e){this.loading=!0,this.cdr.markForCheck(),setTimeout(()=>{this.element=e,this.loading=!1,this.cdr.markForCheck()},300)}handleElementLoadError(e){console.error("Error obteniendo elemento seleccionado:",e),this.loading=!1,this.snackBar.open("Error al cargar datos del elemento","Cerrar",{duration:5e3,panelClass:["error-snackbar"]}),this.cdr.markForCheck()}subscribeToNetworkState(){this.networkStateService.getSelectedElementAsObservable().pipe(L(this.destroy$)).subscribe(e=>{e&&(this.elementManagementService.selectElement(e),this.cdr.markForCheck())})}getElementTypeName(e){return{[s.OLT]:"Terminal de L\xEDnea \xD3ptica",[s.ONT]:"Terminal de Red \xD3ptica",[s.ODF]:"Marco de Distribuci\xF3n \xD3ptica",[s.EDFA]:"Amplificador de Fibra",[s.SPLITTER]:"Divisor \xD3ptico",[s.MANGA]:"Manga",[s.TERMINAL_BOX]:"Caja Terminal",[s.FIBER_THREAD]:"Hilo de Fibra",[s.FIBER_CONNECTION]:"Conexi\xF3n de Fibra",[s.RACK]:"Rack",[s.SLACK_FIBER]:"Flojo de Fibra",[s.CUSTOM]:"Personalizado"}[e]||e.toString()}getElementStatusClass(e){return`status-${e.toLowerCase()}`}getStatusIconName(e){return{[B.ACTIVE]:"check_circle",[B.INACTIVE]:"cancel",[B.MAINTENANCE]:"build",[B.ERROR]:"error",[B.PLANNING]:"schedule"}[e]||"help"}getElementTypeIcon(e){return{[s.OLT]:"router",[s.ONT]:"device_hub",[s.ODF]:"grid_view",[s.EDFA]:"amp_stories",[s.SPLITTER]:"call_split",[s.MANGA]:"category",[s.TERMINAL_BOX]:"inbox",[s.FIBER_THREAD]:"timeline",[s.FIBER_CONNECTION]:"compare_arrows",[s.RACK]:"layers",[s.SLACK_FIBER]:"waves",[s.CUSTOM]:"settings_input_component"}[e]||"settings_input_component"}getOutputPortCount(e){if(!e)return 0;let t=e.match(/\d+:(\d+)/);return t&&t[1]?parseInt(t[1],10):0}navigateToElement(e){e&&this.router.navigate(["network","elements",e])}onEdit(){this.element?.id&&this.router.navigate(["network","elements",this.element.id,"edit"])}onDelete(){if(!this.element?.id)return;this.dialog.open(bo,{width:"400px",data:{title:"Eliminar elemento",message:`\xBFEst\xE1 seguro que desea eliminar el elemento "${this.element.name}"?`,confirmText:"Eliminar",cancelText:"Cancelar"}}).afterClosed().subscribe(t=>{if(t&&this.element?.id)try{let n=this.element.id;this.elementManagementService.deleteElement(n),this.handleDeleteSuccess()}catch(n){this.handleDeleteError(n)}finally{this.cdr.markForCheck()}})}handleDeleteSuccess(){this.snackBar.open("Elemento eliminado con \xE9xito","Cerrar",{duration:3e3}),this.onClose()}handleDeleteError(e){let t=e.message||"Error al eliminar el elemento";this.snackBar.open(t,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]})}onClose(){if(this.element=null,this.elementManagementService)try{this.elementManagementService.selectElement(null)}catch(e){console.error("Error al limpiar selecci\xF3n:",e)}this.cdr.markForCheck()}onViewHistory(){if(!this.element?.id)return;let e=this.snackBar.open("Cargando historial...","",{duration:0,panelClass:"info-snackbar"});import("./chunk-3RBF7E37.js").then(({ElementHistoryDialogComponent:t})=>{let n=this.dialog.open(t,{width:"600px",maxWidth:"90vw",maxHeight:"90vh",data:{element:this.element},panelClass:"history-dialog"});e.dismiss()}).catch(t=>{console.error("Error al cargar el componente de historial:",t),e.dismiss(),this.snackBar.open("Error al cargar la interfaz de historial","Cerrar",{duration:5e3,panelClass:["error-snackbar"]})})}getConnectionTargetName(e){return e.targetName||"Elemento desconocido"}getConnectionTargetType(e){return e.targetType||s.CUSTOM}getConnectionTargetStatus(e){return e.targetStatus||B.INACTIVE}hasConnectionStatus(e){return!!e.connectionStatus}getConnectionStatus(e){return e.connectionStatus||"unknown"}isPonPortActive(e){return!!e?.ponPorts&&e.ponPorts>0}isDistributionPortActive(e){return!!e?.distributionPorts&&e.distributionPorts>0}isUplinkPortActive(e){return!!e?.uplinkPorts&&e.uplinkPorts>0}getPortUsagePercentage(e){let t=this.getPortUsageRatio(e);return t<0?0:Math.min(Math.round(t*100),100)}isPortUsageCritical(e){return this.getPortUsageRatio(e)>.9}isPortUsageWarning(e){let t=this.getPortUsageRatio(e);return t>.75&&t<=.9}getPortUsageRatio(e){return!e||!e.totalPortCapacity||e.totalPortCapacity<=0?-1:(e.usedPorts||0)/e.totalPortCapacity}onViewConnections(e){this.viewConnections.emit(e)}static{this.\u0275fac=function(t){return new(t||o)(A(Oc))}}static{this.\u0275cmp=Y({type:o,selectors:[["app-element-quick-view"]],outputs:{viewConnections:"viewConnections"},decls:2,vars:2,consts:[["class","element-quick-view-container",4,"ngIf"],[3,"selectedElement","viewConnections",4,"ngIf"],[1,"element-quick-view-container"],[1,"element-card"],[1,"card-header"],[1,"header-content"],[1,"element-icon-container",3,"ngClass"],[1,"element-icon"],[1,"element-info"],[1,"element-name"],[1,"element-meta"],[1,"element-type"],[1,"element-id"],[1,"element-status",3,"ngClass"],[1,"status-indicator"],[1,"action-buttons"],["mat-icon-button","","matTooltip","Editar elemento","aria-label","Editar",1,"action-button","edit-button",3,"click"],["mat-icon-button","","matTooltip","Ver historial","aria-label","Ver historial",1,"action-button","history-button",3,"click"],["mat-icon-button","","matTooltip","Cerrar","aria-label","Cerrar",1,"close-button",3,"click"],["class","skeleton-loader",4,"ngIf"],["class","content-section",4,"ngIf"],[1,"floating-action-menu"],["mat-fab","","extended","","color","warn","matTooltip","Eliminar elemento",1,"delete-fab",3,"click"],[1,"skeleton-loader"],[1,"skeleton-line"],[1,"skeleton-line",2,"width","70%"],[1,"skeleton-section"],[1,"skeleton-title"],[1,"content-section"],[1,"info-row"],[1,"info-label"],[1,"info-value"],["class","info-row",4,"ngIf"],["class","location-info",4,"ngIf"],[3,"ngSwitch"],["class","specific-info",4,"ngSwitchCase"],["class","specific-info",4,"ngSwitchDefault"],["class","related-elements",4,"ngIf"],[1,"info-value","description"],[1,"location-info"],[1,"section-title"],[1,"coordinates"],[4,"ngIf"],["mat-icon-button","","matTooltip","Ver en mapa","aria-label","Ver en mapa",1,"map-button"],[1,"specific-info"],["class","port-summary",4,"ngIf"],[1,"port-summary"],[1,"port-item"],[1,"port-label"],[1,"port-value"],["class","signal-strength animated",4,"ngIf"],[1,"signal-strength","animated"],[1,"signal-meter"],[1,"signal-bar",3,"ngStyle","ngClass"],[1,"signal-value"],["class","split-ratio-visual",4,"ngIf"],[1,"split-ratio-visual"],[1,"split-input"],[1,"split-outputs"],["class","split-output",4,"ngFor","ngForOf"],[1,"split-output"],["class","capacity-meter",4,"ngIf"],[1,"capacity-meter"],[1,"progress-container"],[1,"progress-bar",3,"ngStyle","ngClass"],[1,"capacity-text"],[1,"related-elements"],[1,"related-elements-list"],["class","related-element-item",4,"ngFor","ngForOf"],[1,"related-element-item"],["mat-stroked-button","",1,"related-element-button",3,"click"],[1,"element-type-icon",3,"ngClass"],[1,"related-element-info"],[1,"related-element-name"],[1,"related-element-type"],["class","connection-status",4,"ngIf"],[1,"navigate-icon"],[1,"connection-status"],[1,"connection-indicator",3,"ngClass"],[1,"connection-label"],[1,"element-type-icon"],[3,"viewConnections","selectedElement"]],template:function(t,n){t&1&&E(0,Jg,38,14,"div",0)(1,eu,1,1,"app-element-properties-widget",1),t&2&&(h("ngIf",n.element),m(),h("ngIf",n.element))},dependencies:[ee,ft,We,re,Rs,Is,Ds,As,zs,Yi,Ls,fo,uo,ho,pe,ue,be,Ve,Be,el,nn,Qn,_t,Me,ke,Tc],encapsulation:2,data:{animation:[Ut("slideInOut",[xi("void",he({transform:"translateX(30px)",opacity:0})),Mt("void => *",[ct("300ms cubic-bezier(0.25, 0.8, 0.25, 1)",he({transform:"translateX(0)",opacity:1}))]),Mt("* => void",[ct("250ms cubic-bezier(0.25, 0.8, 0.25, 1)",he({transform:"translateX(30px)",opacity:0}))])]),Ut("fadeIn",[Mt(":enter",[he({opacity:0}),ct("400ms ease-out",he({opacity:1}))])]),Ut("staggerItems",[Mt(":enter",[Pt(".info-row, .specific-info, .related-elements",[he({opacity:0,transform:"translateY(10px)"}),xl(80,[ct("300ms cubic-bezier(0.25, 0.8, 0.25, 1)",he({opacity:1,transform:"translateY(0)"}))])],{optional:!0})])])]},changeDetection:0})}}return o})();function nu(o,i){o&1&&(c(0,"div",12),D(1,"mat-spinner",13),c(2,"p"),p(3,"Cargando conexiones..."),d()())}function iu(o,i){if(o&1){let e=V();c(0,"div",14)(1,"mat-icon"),p(2,"link_off"),d(),c(3,"p"),p(4,"Este elemento no tiene conexiones establecidas."),d(),c(5,"button",15),y("click",function(){b(e);let n=v();return C(n.onAddConnection())}),c(6,"mat-icon"),p(7,"add_link"),d(),p(8," A\xF1adir conexi\xF3n "),d()()}}function ou(o,i){o&1&&(c(0,"mat-header-cell"),p(1,"Origen"),d())}function ru(o,i){if(o&1&&(c(0,"mat-cell")(1,"div",29)(2,"mat-icon",7),p(3),d(),p(4),d()()),o&2){let e=i.$implicit,t=v(3);m(2),h("matTooltip",t.getConnectionElementTypeLabel(e.sourceType||"")),m(),j(" ",t.getConnectionElementIcon(e.sourceType||"")," "),m(),j(" ",e.sourceName||"Desconocido"," ")}}function au(o,i){o&1&&(c(0,"mat-header-cell"),p(1,"Tipo"),d())}function su(o,i){if(o&1&&(c(0,"mat-cell"),p(1),d()),o&2){let e=i.$implicit,t=v(3);m(),j(" ",t.getConnectionTypeLabel(e.type)," ")}}function lu(o,i){o&1&&(c(0,"mat-header-cell"),p(1,"Estado"),d())}function cu(o,i){if(o&1&&(c(0,"mat-cell")(1,"span"),p(2),d()()),o&2){let e=i.$implicit;m(),In("status-badge "+(e.status==null?null:e.status.toLowerCase())),m(),j(" ",e.status||"Desconocido"," ")}}function du(o,i){o&1&&(c(0,"mat-header-cell"),p(1,"Acciones"),d())}function pu(o,i){if(o&1){let e=V();c(0,"mat-cell")(1,"button",30),y("click",function(){let n=b(e).$implicit,r=v(3);return C(r.onEditConnection(n))}),c(2,"mat-icon"),p(3,"edit"),d()(),c(4,"button",31),y("click",function(){let n=b(e).$implicit,r=v(3);return C(r.onViewElement(n.sourceElementId))}),c(5,"mat-icon"),p(6,"visibility"),d()(),c(7,"button",32),y("click",function(){let n=b(e).$implicit,r=v(3);return C(r.onDeleteConnection(n))}),c(8,"mat-icon"),p(9,"link_off"),d()()()}}function mu(o,i){o&1&&D(0,"mat-header-row")}function gu(o,i){o&1&&D(0,"mat-row")}function uu(o,i){if(o&1&&(c(0,"mat-expansion-panel",18)(1,"mat-expansion-panel-header")(2,"mat-panel-title")(3,"mat-icon",19),p(4,"arrow_downward"),d(),p(5),d()(),c(6,"mat-table",20),Fe(7,21),E(8,ou,2,0,"mat-header-cell",22)(9,ru,5,3,"mat-cell",23),ze(),Fe(10,24),E(11,au,2,0,"mat-header-cell",22)(12,su,2,1,"mat-cell",23),ze(),Fe(13,25),E(14,lu,2,0,"mat-header-cell",22)(15,cu,3,3,"mat-cell",23),ze(),Fe(16,26),E(17,du,2,0,"mat-header-cell",22)(18,pu,10,0,"mat-cell",23),ze(),E(19,mu,1,0,"mat-header-row",27)(20,gu,1,0,"mat-row",28),d()()),o&2){let e=v(2);m(5),j(" Conexiones entrantes (",e.incomingConnections.length,") "),m(),h("dataSource",e.incomingConnections),m(13),h("matHeaderRowDef",e.displayedColumns),m(),h("matRowDefColumns",e.displayedColumns)}}function hu(o,i){o&1&&(c(0,"mat-header-cell"),p(1,"Destino"),d())}function fu(o,i){if(o&1&&(c(0,"mat-cell")(1,"div",29)(2,"mat-icon",7),p(3),d(),p(4),d()()),o&2){let e=i.$implicit,t=v(3);m(2),h("matTooltip",t.getConnectionElementTypeLabel(e.targetType||"")),m(),j(" ",t.getConnectionElementIcon(e.targetType||"")," "),m(),j(" ",e.targetName||"Desconocido"," ")}}function _u(o,i){o&1&&(c(0,"mat-header-cell"),p(1,"Tipo"),d())}function vu(o,i){if(o&1&&(c(0,"mat-cell"),p(1),d()),o&2){let e=i.$implicit,t=v(3);m(),j(" ",t.getConnectionTypeLabel(e.type)," ")}}function bu(o,i){o&1&&(c(0,"mat-header-cell"),p(1,"Estado"),d())}function Cu(o,i){if(o&1&&(c(0,"mat-cell")(1,"span"),p(2),d()()),o&2){let e=i.$implicit;m(),In("status-badge "+(e.status==null?null:e.status.toLowerCase())),m(),j(" ",e.status||"Desconocido"," ")}}function yu(o,i){o&1&&(c(0,"mat-header-cell"),p(1,"Acciones"),d())}function Eu(o,i){if(o&1){let e=V();c(0,"mat-cell")(1,"button",30),y("click",function(){let n=b(e).$implicit,r=v(3);return C(r.onEditConnection(n))}),c(2,"mat-icon"),p(3,"edit"),d()(),c(4,"button",33),y("click",function(){let n=b(e).$implicit,r=v(3);return C(r.onViewElement(n.targetElementId))}),c(5,"mat-icon"),p(6,"visibility"),d()(),c(7,"button",32),y("click",function(){let n=b(e).$implicit,r=v(3);return C(r.onDeleteConnection(n))}),c(8,"mat-icon"),p(9,"link_off"),d()()()}}function wu(o,i){o&1&&D(0,"mat-header-row")}function xu(o,i){o&1&&D(0,"mat-row")}function Su(o,i){if(o&1&&(c(0,"mat-expansion-panel",18)(1,"mat-expansion-panel-header")(2,"mat-panel-title")(3,"mat-icon",19),p(4,"arrow_upward"),d(),p(5),d()(),c(6,"mat-table",20),Fe(7,21),E(8,hu,2,0,"mat-header-cell",22)(9,fu,5,3,"mat-cell",23),ze(),Fe(10,24),E(11,_u,2,0,"mat-header-cell",22)(12,vu,2,1,"mat-cell",23),ze(),Fe(13,25),E(14,bu,2,0,"mat-header-cell",22)(15,Cu,3,3,"mat-cell",23),ze(),Fe(16,26),E(17,yu,2,0,"mat-header-cell",22)(18,Eu,10,0,"mat-cell",23),ze(),E(19,wu,1,0,"mat-header-row",27)(20,xu,1,0,"mat-row",28),d()()),o&2){let e=v(2);m(5),j(" Conexiones salientes (",e.outgoingConnections.length,") "),m(),h("dataSource",e.outgoingConnections),m(13),h("matHeaderRowDef",e.displayedColumns),m(),h("matRowDefColumns",e.displayedColumns)}}function Mu(o,i){if(o&1&&(c(0,"div",16),E(1,uu,21,4,"mat-expansion-panel",17)(2,Su,21,4,"mat-expansion-panel",17),d()),o&2){let e=v();m(),h("ngIf",e.incomingConnections.length),m(),h("ngIf",e.outgoingConnections.length)}}function Pu(o,i){if(o&1){let e=V();c(0,"mat-card-actions")(1,"button",15),y("click",function(){b(e);let n=v();return C(n.onAddConnection())}),c(2,"mat-icon"),p(3,"add_link"),d(),p(4," A\xF1adir conexi\xF3n "),d(),c(5,"button",34),y("click",function(){b(e);let n=v();return C(n.refreshConnections())}),c(6,"mat-icon"),p(7,"refresh"),d(),p(8," Actualizar "),d()()}}var Rc=(()=>{class o{constructor(e,t){this.connectionService=e,this.elementService=t,this.elementId="",this.close=new H,this.editConnection=new H,this.addConnection=new H,this.deleteConnection=new H,this.viewElement=new H,this.elementData=null,this.incomingConnections=[],this.outgoingConnections=[],this.loading=!1,this.displayedColumns=["source","type","status","actions"],this.destroy$=new N}ngOnInit(){this.loadElement(),this.loadConnections()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadElement(){this.elementId&&(this.loading=!0,this.elementService.getElementById(this.elementId).pipe(L(this.destroy$)).subscribe(e=>{this.elementData=e,this.loading=!1},e=>{console.error("Error al cargar el elemento:",e),this.loading=!1}))}loadConnections(){this.elementId&&(this.loading=!0,this.connectionService.getConnectionsByElementId(this.elementId).pipe(L(this.destroy$)).subscribe(e=>{this.processConnections(e),this.loading=!1},e=>{console.error("Error al cargar conexiones:",e),this.loading=!1}))}refreshConnections(){this.loadConnections()}processConnections(e){return ce(this,null,function*(){if(this.incomingConnections=[],this.outgoingConnections=[],!e||!e.length)return;let t=e.map(n=>ce(this,null,function*(){let r=k({},n);if(n.sourceElementId===this.elementId)try{let a=yield this.elementService.getElementById(n.targetElementId).toPromise();a&&(r.targetName=a.name,r.targetType=a.type),this.outgoingConnections.push(r)}catch(a){console.error(`Error al obtener elemento destino ${n.targetElementId}:`,a),r.targetName="Elemento no encontrado",r.targetType="UNKNOWN",this.outgoingConnections.push(r)}else try{let a=yield this.elementService.getElementById(n.sourceElementId).toPromise();a&&(r.sourceName=a.name,r.sourceType=a.type),this.incomingConnections.push(r)}catch(a){console.error(`Error al obtener elemento origen ${n.sourceElementId}:`,a),r.sourceName="Elemento no encontrado",r.sourceType="UNKNOWN",this.incomingConnections.push(r)}}));try{yield Promise.all(t),this.incomingConnections.sort((n,r)=>(n.sourceName||"").localeCompare(r.sourceName||"")),this.outgoingConnections.sort((n,r)=>(n.targetName||"").localeCompare(r.targetName||""))}catch(n){console.error("Error al procesar conexiones:",n)}})}getElementTypeLabel(){if(!this.elementData)return"Elemento";switch(this.elementData.type){case s.DROP_CABLE:return"Cable de Acometida";case s.OLT:return"Terminal de L\xEDnea \xD3ptica";case s.ONT:return"Terminal de Red \xD3ptica";case s.DISTRIBUTION_CABLE:return"Cable de Distribuci\xF3n";case s.FEEDER_CABLE:return"Cable de Alimentaci\xF3n";case s.FDP:return"Punto de Distribuci\xF3n de Fibra";case s.SPLITTER:return"Divisor \xD3ptico";default:return this.elementData.type||"Elemento"}}getElementDescription(){return this.elementData?this.elementData.description||`Elemento de red de tipo ${this.getElementTypeLabel()}`:""}getElementIcon(){if(!this.elementData)return"device_unknown";switch(this.elementData.type){case s.DROP_CABLE:return"cable";case s.OLT:return"router";case s.ONT:return"devices";case s.DISTRIBUTION_CABLE:case s.FEEDER_CABLE:return"lan";case s.FDP:return"hub";case s.SPLITTER:return"call_split";default:return"device_hub"}}getConnectionElementTypeLabel(e){switch(e){case s.DROP_CABLE:return"Cable de Acometida";case s.OLT:return"Terminal de L\xEDnea \xD3ptica";case s.ONT:return"Terminal de Red \xD3ptica";case s.DISTRIBUTION_CABLE:return"Cable de Distribuci\xF3n";case s.FEEDER_CABLE:return"Cable de Alimentaci\xF3n";case s.FDP:return"Punto de Distribuci\xF3n de Fibra";case s.SPLITTER:return"Divisor \xD3ptico";default:return e||"Elemento"}}getConnectionElementIcon(e){switch(e){case s.DROP_CABLE:return"cable";case s.OLT:return"router";case s.ONT:return"devices";case s.DISTRIBUTION_CABLE:case s.FEEDER_CABLE:return"lan";case s.FDP:return"hub";case s.SPLITTER:return"call_split";default:return"device_hub"}}getConnectionTypeLabel(e){switch(e){case"FIBER":return"Fibra \xD3ptica";case"COPPER":return"Cobre";case"WIRELESS":return"Inal\xE1mbrica";case"LOGICAL":return"L\xF3gica";default:return e||"Desconocido"}}onClose(){this.close.emit()}onAddConnection(){this.addConnection.emit(this.elementId)}onEditConnection(e){this.editConnection.emit(e)}onDeleteConnection(e){this.deleteConnection.emit(e)}onViewElement(e){this.viewElement.emit(e)}static{this.\u0275fac=function(t){return new(t||o)(A(Co),A(Ft))}}static{this.\u0275cmp=Y({type:o,selectors:[["app-element-connections-view"]],inputs:{elementId:"elementId"},outputs:{close:"close",editConnection:"editConnection",addConnection:"addConnection",deleteConnection:"deleteConnection",viewElement:"viewElement"},decls:25,vars:12,consts:[[1,"connections-container"],[1,"connections-header"],[1,"title"],[1,"controls"],["mat-icon-button","","matTooltip","Cerrar",3,"click"],[1,"connections-content"],["mat-card-avatar","",1,"element-avatar"],[3,"matTooltip"],["class","loading-container",4,"ngIf"],["class","no-connections",4,"ngIf"],["class","connections-list",4,"ngIf"],[4,"ngIf"],[1,"loading-container"],["diameter","40"],[1,"no-connections"],["mat-flat-button","","color","primary",3,"click"],[1,"connections-list"],["expanded","",4,"ngIf"],["expanded",""],[1,"panel-icon"],[1,"connections-table",3,"dataSource"],["matColumnDef","source"],[4,"matHeaderCellDef"],[4,"matCellDef"],["matColumnDef","type"],["matColumnDef","status"],["matColumnDef","actions"],[4,"matHeaderRowDef"],[4,"matRowDef","matRowDefColumns"],[1,"element-chip"],["mat-icon-button","","matTooltip","Editar conexi\xF3n",3,"click"],["mat-icon-button","","matTooltip","Ver elemento origen",3,"click"],["mat-icon-button","","color","warn","matTooltip","Eliminar conexi\xF3n",3,"click"],["mat-icon-button","","matTooltip","Ver elemento destino",3,"click"],["mat-button","",3,"click"]],template:function(t,n){t&1&&(c(0,"div",0)(1,"div",1)(2,"div",2),p(3),d(),c(4,"div",3)(5,"button",4),y("click",function(){return n.onClose()}),c(6,"mat-icon"),p(7,"close"),d()()()(),c(8,"div",5)(9,"mat-card")(10,"mat-card-header")(11,"div",6)(12,"mat-icon",7),p(13),d()(),c(14,"mat-card-title"),p(15),d(),c(16,"mat-card-subtitle")(17,"span"),p(18),d(),p(19),d()(),c(20,"mat-card-content"),E(21,nu,4,0,"div",8)(22,iu,9,0,"div",9)(23,Mu,3,2,"div",10),d(),E(24,Pu,9,0,"mat-card-actions",11),d()()()),t&2&&(m(3),j("Conexiones de ",n.getElementTypeLabel(),""),m(9),h("matTooltip",n.getElementDescription()),m(),x(n.getElementIcon()),m(2),x((n.elementData==null?null:n.elementData.name)||"Elemento sin nombre"),m(2),In("status-badge "+(n.elementData==null||n.elementData.status==null?null:n.elementData.status.toLowerCase())),m(),x((n.elementData==null?null:n.elementData.status)||"Desconocido"),m(),j(" ID: ",n.elementData==null?null:n.elementData.id," "),m(2),h("ngIf",n.loading),m(),h("ngIf",!n.loading&&!n.incomingConnections.length&&!n.outgoingConnections.length),m(),h("ngIf",!n.loading&&(n.incomingConnections.length||n.outgoingConnections.length)),m(),h("ngIf",!n.loading&&(n.incomingConnections.length||n.outgoingConnections.length)))},dependencies:[ee,re,fo,uo,Pl,Ol,ho,Tl,Ml,Sl,be,Ve,Be,pe,ue,Ke,qn,ao,so,lo,en,on,Me,ke,_t,Jt,Zl,Vl,jl,Wl,Ul,$l,Kl,Gl,Hl,ql,Ql],styles:[".connections-container[_ngcontent-%COMP%]{width:580px;box-shadow:0 2px 8px #00000026;border-radius:4px;overflow:hidden;background-color:#fff;max-height:calc(100vh - 100px);display:flex;flex-direction:column}.connections-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background-color:#f5f5f5;border-bottom:1px solid #ddd;z-index:2}.title[_ngcontent-%COMP%]{font-weight:700}.connections-content[_ngcontent-%COMP%]{padding:0;overflow-y:auto;flex:1}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 0}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:16px;color:#666}.no-connections[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 0;color:#666}.no-connections[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;margin-bottom:16px;color:#aaa}.no-connections[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:24px}.connections-list[_ngcontent-%COMP%]{margin-top:16px}.connections-table[_ngcontent-%COMP%]{width:100%}.element-avatar[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;background-color:#f0f0f0;border-radius:50%}.element-chip[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}mat-expansion-panel[_ngcontent-%COMP%]{margin-bottom:12px}.panel-icon[_ngcontent-%COMP%]{margin-right:8px;color:#666}mat-panel-title[_ngcontent-%COMP%]{display:flex;align-items:center}.status-badge[_ngcontent-%COMP%]{display:inline-block;padding:2px 6px;border-radius:4px;font-size:12px}.status-badge.active[_ngcontent-%COMP%]{background-color:#e6f4ea;color:#137333}.status-badge.inactive[_ngcontent-%COMP%]{background-color:#f8f9fa;color:#5f6368}.status-badge.faulty[_ngcontent-%COMP%]{background-color:#fce8e6;color:#c5221f}.status-badge.inservice[_ngcontent-%COMP%]{background-color:#e8f0fe;color:#1967d2}.status-badge.planned[_ngcontent-%COMP%]{background-color:#fff0b3;color:#b06000}mat-card-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:8px 16px 16px}"]})}}return o})();var Tu=["createMenu"],Ou=()=>["/network-design/map"],ku=()=>["/network-design/elements"],Iu=()=>["/network-design/connections"],Du=()=>["/network-design/monitoring"],Au=o=>({"map-hidden":o});function Ru(o,i){if(o&1){let e=V();Fe(0),c(1,"button",16),y("click",function(){let n=b(e).$implicit,r=v();return C(r.createNewElement(n.id))}),c(2,"mat-icon"),p(3),d(),c(4,"span"),p(5),d()(),ze()}if(o&2){let e=i.$implicit;m(3),x(e.id==="fdp"?"dns":e.id==="olt"?"router":e.id==="ont"?"device_hub":e.id==="edfa"?"wifi_tethering":e.id==="splitter"?"call_split":e.id==="manga"?"view_comfy":e.id==="fiber_connection"?"timeline":"category"),m(2),x(e.name)}}function Nu(o,i){if(o&1){let e=V();c(0,"app-element-quick-view",17),y("viewConnections",function(n){b(e);let r=v();return C(r.openConnectionsView(n))}),d()}}function Lu(o,i){if(o&1){let e=V();c(0,"app-element-connections-view",18),y("close",function(){b(e);let n=v();return C(n.closeConnectionsView())}),d()}if(o&2){let e=v();h("elementId",e.connectionsElementId)}}var Lc=(()=>{class o{constructor(e,t,n,r,a,l,u,g,_){this.router=e,this.route=t,this.networkStateService=n,this.logger=r,this.dialog=a,this.snackBar=l,this.mapStateManager=u,this.cdr=g,this.ngZone=_,this.elementTypes=[{id:"fdp",name:"Punto de Distribuci\xF3n (FDP)"},{id:"olt",name:"Terminal de L\xEDnea \xD3ptica (OLT)"},{id:"ont",name:"Terminal de Red \xD3ptica (ONT)"},{id:"edfa",name:"Amplificador \xD3ptico (EDFA)"},{id:"splitter",name:"Divisor \xD3ptico (Splitter)"},{id:"manga",name:"Caja de Empalme (Manga)"},{id:"fiber_connection",name:"Conexi\xF3n de Fibra"}],this.animationState="map",this.isLoading=!1,this.mapVisible=!0,this.selectedElement=null,this.showElementsPanel=!0,this.showConnectionsView=!1,this.connectionsElementId=null,this.destroy$=new N}ngOnInit(){this.setupRouteListener(),this.subscribeToStateChanges(),this.setupConnectionEditorSubscription()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setupRouteListener(){this.router.events.pipe(Ee(e=>e instanceof Nn),L(this.destroy$)).subscribe(()=>{let e=this.route.firstChild;if(e){let t=e.snapshot.data.animation||"map";this.animationState!==t&&(t==="error"?this.ngZone.runOutsideAngular(()=>{setTimeout(()=>{this.animationState=t,this.logger.debug(`Estado de animaci\xF3n actualizado: ${this.animationState}`),this.cdr.detectChanges()})}):(this.animationState=t,this.logger.debug(`Estado de animaci\xF3n actualizado: ${this.animationState}`)))}})}subscribeToStateChanges(){this.networkStateService.getEditingElement().pipe(L(this.destroy$)).subscribe(e=>{this.selectedElement=e,e&&this.logger.debug(`Elemento seleccionado: ${e.name} (${e.id})`)}),this.networkStateService.getMapVisibility().pipe(L(this.destroy$)).subscribe(e=>{this.mapVisible=e,this.logger.debug(`Visibilidad del mapa: ${e?"visible":"oculto"}`)}),this.networkStateService.getShowElementsPanel().pipe(L(this.destroy$)).subscribe(e=>{this.showElementsPanel=e}),this.networkStateService.setShowElementsPanel(!0)}setupConnectionEditorSubscription(){this.mapStateManager.connectionToEdit$.pipe(L(this.destroy$)).subscribe(e=>{this.logger.debug(`Recibido evento connectionToEdit$: ${e?e.id:"null"}`),e&&(this.logger.debug(`Abriendo di\xE1logo para editar conexi\xF3n: ${e.id}`),this.openConnectionPropertiesDialog(e),this.mapStateManager.clearConnectionToEdit())})}openConnectionPropertiesDialog(e){this.logger.debug(`Intentando abrir di\xE1logo de conexi\xF3n para: ${e.id}`,e);try{let t={connection:e||null,mode:"edit"};this.logger.debug("Datos para el di\xE1logo:",t);let n=this.dialog.open(Bl,{width:"600px",maxWidth:"95vw",maxHeight:"90vh",panelClass:"connection-editor-dialog",disableClose:!1,autoFocus:!0,data:t});this.logger.debug("Di\xE1logo de conexi\xF3n abierto correctamente"),n.afterClosed().pipe(L(this.destroy$)).subscribe(r=>{this.logger.debug("Di\xE1logo de conexi\xF3n cerrado",r),r&&(this.logger.debug("Conexi\xF3n actualizada:",r),this.snackBar.open("Propiedades de conexi\xF3n actualizadas","OK",{duration:3e3,panelClass:"success-snackbar"}))})}catch(t){this.logger.error("Error al abrir el di\xE1logo de conexi\xF3n:",t)}}prepareRoute(e){if(!e||!e.activatedRouteData)return"map";let t=e.activatedRouteData.animation||"map";return t==="error"&&this.animationState!=="error"&&this.ngZone.runOutsideAngular(()=>{setTimeout(()=>{this.animationState=t,this.cdr.detectChanges()})}),t}createNewElement(e){this.router.navigate(["/network-design/element",e,"new"]),this.logger.debug(`Navegando a creaci\xF3n de nuevo elemento: ${e}`)}openConnectionsView(e){this.connectionsElementId=e,this.showConnectionsView=!0}closeConnectionsView(){this.showConnectionsView=!1,this.connectionsElementId=null}static{this.\u0275fac=function(t){return new(t||o)(A(Oe),A(Xi),A(Ie),A(K),A(nt),A(qe),A(bt),A(He),A(et))}}static{this.\u0275cmp=Y({type:o,selectors:[["app-network-design-layout"]],viewQuery:function(t,n){if(t&1&&(gt(Nt,5),gt(Tu,5)),t&2){let r;ut(r=ht())&&(n.routerOutlet=r.first),ut(r=ht())&&(n.createMenu=r.first)}},decls:44,vars:16,consts:[["elementMenu","matMenu"],["outlet","outlet"],[1,"network-design-layout"],[1,"design-header"],[1,"design-nav"],["mat-button","","routerLinkActive","active",3,"routerLink"],[1,"menu-container"],["mat-button","",1,"create-button",3,"matMenuTriggerFor"],[1,"element-type-menu"],[4,"ngFor","ngForOf"],[1,"design-content"],[1,"network-design-content"],[1,"network-design-container",3,"ngClass"],[1,"router-container"],["class","element-details-panel",3,"viewConnections",4,"ngIf"],["class","connections-view-overlay",3,"elementId","close",4,"ngIf"],["mat-menu-item","",3,"click"],[1,"element-details-panel",3,"viewConnections"],[1,"connections-view-overlay",3,"close","elementId"]],template:function(t,n){if(t&1&&(c(0,"div",2)(1,"header",3)(2,"h1"),p(3,"Dise\xF1o de Red"),d(),c(4,"nav",4)(5,"a",5)(6,"mat-icon"),p(7,"map"),d(),c(8,"span"),p(9,"Mapa de Red"),d()(),c(10,"a",5)(11,"mat-icon"),p(12,"category"),d(),c(13,"span"),p(14,"Elementos"),d()(),c(15,"a",5)(16,"mat-icon"),p(17,"device_hub"),d(),c(18,"span"),p(19,"Conexiones"),d()(),c(20,"a",5)(21,"mat-icon"),p(22,"monitoring"),d(),c(23,"span"),p(24,"Monitoreo"),d()(),c(25,"div",6)(26,"button",7)(27,"mat-icon"),p(28,"add_circle"),d(),c(29,"span"),p(30,"Crear Nuevo Elemento"),d(),c(31,"mat-icon"),p(32,"arrow_drop_down"),d()(),c(33,"mat-menu",8,0),E(35,Ru,6,2,"ng-container",9),d()()()(),c(36,"main",10)(37,"div",11)(38,"div",12)(39,"div",13),D(40,"router-outlet",null,1),d()(),E(42,Nu,1,0,"app-element-quick-view",14)(43,Lu,1,1,"app-element-connections-view",15),d()()()),t&2){let r=wt(34),a=wt(41);m(5),h("routerLink",jt(10,Ou)),m(5),h("routerLink",jt(11,ku)),m(5),h("routerLink",jt(12,Iu)),m(5),h("routerLink",jt(13,Du)),m(6),h("matMenuTriggerFor",r),m(9),h("ngForOf",n.elementTypes),m(3),h("ngClass",xt(14,Au,!n.mapVisible)),m(),h("@routeAnimations",n.prepareRoute(a)),m(3),h("ngIf",n.selectedElement&&n.showElementsPanel),m(),h("ngIf",n.showConnectionsView&&n.connectionsElementId)}},dependencies:[ee,ft,We,re,Zt,Nt,Ln,Ji,be,Js,Ve,pe,ue,Me,$n,Bn,zn,Vn,Ke,Ic,Rc],styles:['@charset "UTF-8";[_ngcontent-%COMP%]:root{--primary-color: #3F51B5;--primary-rgb: 63, 81, 181;--primary-color-hover: rgb(52.4655737705, 67.4557377049, 150.7344262295);--accent-color: #FF4081;--warn-color: #F44336;--background-color: #F5F5F5;--surface-color: #ffffff;--surface-lighter: #f9f9f9;--surface-darker: #eeeeee;--text-color: #212121;--text-secondary-color: hsl(0, 0%, -12.0588235294%);--text-hint-color: hsl(0, 0%, -32.0588235294%);--text-disabled-color: hsl(0, 0%, -52.0588235294%);--primary-contrast-color: white;--accent-contrast-color: white;--warn-contrast-color: white;--olt-color: #4CAF50;--ont-color: #2196F3;--odf-color: #FFC107;--edfa-color: #9C27B0;--splitter-color: #FF5722;--manga-color: #607D8B;--terminal-box-color: #FF9800;--slack-fiber-color: #80DEEA;--spacing-unit: 4px;--spacing-xxs: .125rem;--spacing-xs: .25rem;--spacing-sm: .5rem;--spacing-md: .75rem;--spacing-lg: 1rem;--spacing-xl: 1.5rem;--spacing-xxl: 2rem;--shadow-xs: 0 1px 2px rgba(0,0,0,.05);--shadow-sm: 0 1px 3px rgba(0, 0, 0, .1);--shadow-md: 0 2px 4px rgba(0, 0, 0, .1);--shadow-lg: 0 4px 6px rgba(0, 0, 0, .1);--border-radius-sm: 2px;--border-radius-md: 4px;--border-radius-lg: 8px;--border-radius-round: 50%;--border-color: #e0e0e0;--border-width-normal: 1px;--border-width-strong: 4px;--border-radius-pill: 20px;--border-color-light: rgb(249.5, 249.5, 249.5);--border-color-dark: rgb(198.5, 198.5, 198.5);--color-success: #4caf50;--color-warning: #ff8f00;--color-danger: #c62828;--color-info: #2196F3;--color-neutral: #9e9e9e;--color-success-bg: #e8f5e9;--color-warning-bg: #fff8e1;--color-danger-bg: #ffebee;--color-info-bg: rgb(226.5384615385, 241.5384615385, 253.4615384615);--color-maintenance-bg: #e3f2fd;--status-inactive-fg: #757575;--status-inactive-bg: #f5f5f5;--color-success-contrast: white;--color-warning-contrast: white;--color-danger-contrast: white;--color-info-contrast: #212121;--color-maintenance-contrast: white;--font-family: "Roboto, Segoe UI, sans-serif";--font-size-xxs: .625rem;--font-size-xs: .75rem;--font-size-sm: .875rem;--font-size-md: 1rem;--font-size-lg: 1.125rem;--font-size-xl: 1.25rem;--font-size-xxl: 1.5rem;--font-size-display: 2.5rem;--transition-fast: .15s ease-in-out;--transition-normal: .3s ease-in-out;--transition-slow: .5s ease-in-out;--status-active: #4caf50;--status-inactive: #757575;--status-maintenance: #1565c0;--status-planning: #2196F3;--status-unknown: var(--color-neutral);--status-fault: #c62828;--surface-overlay-light: rgba(255, 255, 255, .85);--surface-overlay-light-strong: rgba(255, 255, 255, .95);--border-color-semitransparent: rgba(0, 0, 0, .1);--primary-bg-subtle: rgba(63, 81, 181, .15);--surface-action-hover: rgb(242.8571428571, 242.8571428571, 242.8571428571);--surface-button: var(--surface-color);--surface-button-hover: var(--surface-action-hover);--text-color-button: var(--text-color);--scrollbar-track-color: #f1f1f1;--scrollbar-thumb-color: #c1c1c1;--scrollbar-thumb-hover-color: #a8a8a8;--z-index-map-base: 1;--z-index-map-elements: 5;--z-index-map-widgets-overlay: 50;--z-index-map-overlay: 100;--z-index-network-design-panels: 900;--z-index-debug-info: 999;--z-index-floating-panel-base: 1000;--z-index-performance-widget: 1000;--z-index-elements-panel: 1001;--z-index-layer-control: 1001;--z-index-sidebar: 1005;--z-index-map-legend: 1005;--z-index-sidebar-mobile: 1010;--z-index-loading-overlay: 1050;--z-index-dialog: 1075;--z-index-toolbar: 1100;--z-index-tooltip: 1150;--z-index-map-controls: 1201;--toolbar-height: 46px;--toolbar-button-height: 30px;--toolbar-button-height-mobile: 32px;--action-button-height: 40px;--menu-item-height: 42px;--icon-size-sm: 18px;--icon-size-md: 20px;--tooltip-bg-color: rgba(33, 33, 33, .95);--primary-ripple-color: rgba(var(--primary-rgb), .1)}[_ngcontent-%COMP%]:root.dark-theme, body.dark-theme[_ngcontent-%COMP%]{--background-color: #121212;--surface-color: #1e1e1e;--surface-lighter: rgb(42.75, 42.75, 42.75);--surface-darker: #121212;--text-color: #e0e0e0;--text-secondary-color: rgb(185.75, 185.75, 185.75);--text-hint-color: rgb(147.5, 147.5, 147.5);--text-disabled-color: rgb(109.25, 109.25, 109.25);--border-color: #444444;--border-color-light: rgb(93.5, 93.5, 93.5);--border-color-dark: rgb(42.5, 42.5, 42.5);--color-success-bg: rgb(51.8181818182, 119.1818181818, 57);--color-warning-bg: rgb(174, 133.4, 0);--color-danger-bg: rgb(184, 0, 27.6);--color-info-bg: rgb(8.9230769231, 95.9230769231, 165.0769230769);--color-maintenance-bg: rgb(11.6, 98.6, 162.4);--shadow-xs: 0 1px 2px rgba(0,0,0,.3);--shadow-sm: 0 1px 3px rgba(0,0,0,.4);--shadow-md: 0 2px 4px rgba(0,0,0,.5);--shadow-lg: 0 4px 6px rgba(0,0,0,.5);--surface-overlay-light: rgba(40, 40, 40, .85);--surface-overlay-light-strong: rgba(30, 30, 30, .95);--border-color-semitransparent: rgba(255, 255, 255, .1);--status-inactive-fg: hsl(0, 0%, 100.8823529412%);--status-inactive-bg: #383838;--primary-bg-subtle: rgba(63, 81, 181, .25);--surface-action-hover: rgb(55.5, 55.5, 55.5);--surface-button: var(--surface-color);--surface-button-hover: var(--surface-action-hover);--text-color-button: var(--text-color);--scrollbar-track-color: #333333;--scrollbar-thumb-color: #666666;--scrollbar-thumb-hover-color: #888888}.standard-panel-ui[_ngcontent-%COMP%]{background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-lg);overflow:hidden;display:flex;flex-direction:column}.standard-panel-ui[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-md);background-color:var(--surface-lighter);border-bottom:1px solid var(--border-color)}.standard-panel-ui[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:var(--font-size-md);font-weight:500;color:var(--text-color)}.standard-panel-ui[_ngcontent-%COMP%]   .panel-content[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-content[_ngcontent-%COMP%]{padding:var(--spacing-md);flex-grow:1;overflow-y:auto;color:var(--text-color)}.standard-panel-ui[_ngcontent-%COMP%]   .panel-actions[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:var(--spacing-sm);padding:var(--spacing-sm) var(--spacing-md);border-top:1px solid var(--border-color)}.standard-panel-ui[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]{display:flex;margin-bottom:var(--spacing-sm)}.standard-panel-ui[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]   .info-label[_ngcontent-%COMP%]{width:100px;font-weight:500;color:var(--text-secondary-color)}.standard-panel-ui[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]   .info-value[_ngcontent-%COMP%]{flex:1;color:var(--text-color)}.simple-panel-ui[_ngcontent-%COMP%]{background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-lg);padding:var(--spacing-md);color:var(--text-color)}.side-panel[_ngcontent-%COMP%]{background-color:var(--surface-color);border-radius:var(--border-radius-sm, 4px);box-shadow:var(--shadow-sm, 0 2px 10px rgba(0, 0, 0, .08));height:100%;width:var(--side-panel-width, 320px);display:flex;flex-direction:column;overflow:hidden}@media (max-width: 768px){.side-panel[_ngcontent-%COMP%]{width:var(--side-panel-width-tablet, 280px)}}@media (max-width: 600px){.side-panel[_ngcontent-%COMP%]{width:var(--side-panel-width-mobile, 100%);max-width:100vw}}.side-panel[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%]{height:var(--panel-header-height, 44px);min-height:var(--panel-header-height, 44px);display:flex;align-items:center;justify-content:space-between;padding:0 var(--spacing-sm);border-bottom:1px solid var(--border-color, rgba(0, 0, 0, .1))}.side-panel[_ngcontent-%COMP%]   .panel-content[_ngcontent-%COMP%]{flex:1;overflow:auto}.map-base-container[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;overflow:hidden;background-color:var(--background-color);transition:background-color var(--transition-normal)}.network-design[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}.network-design__toolbar[_ngcontent-%COMP%]{padding:0 var(--spacing-md);background-color:var(--primary-color);color:var(--primary-contrast-color);box-shadow:var(--shadow-md)}.network-design__header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-md);background-color:var(--primary-color);color:var(--primary-contrast-color);box-shadow:var(--shadow-md)}.network-design__header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:var(--font-size-xl);font-weight:500}.network-design__main[_ngcontent-%COMP%]{flex:1;display:flex;overflow:hidden;position:relative;padding:var(--spacing-md);background-color:var(--surface-color)}@media (max-width: 768px){.network-design__main[_ngcontent-%COMP%]{margin-left:0;padding:var(--spacing-sm)}}.network-design__main[_ngcontent-%COMP%]   .network-design__map[_ngcontent-%COMP%]{flex:1;position:relative;border-radius:var(--border-radius-md);overflow:hidden;box-shadow:var(--shadow-md);background-color:var(--surface-darker)}.network-design__main[_ngcontent-%COMP%]   .network-design__sidebar[_ngcontent-%COMP%]{width:300px;padding:var(--spacing-md);background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-md);margin-left:var(--spacing-md);overflow-y:auto;border-right:1px solid var(--border-color)}@media (max-width: 768px){.network-design__main[_ngcontent-%COMP%]   .network-design__sidebar[_ngcontent-%COMP%]{width:100%;position:fixed;top:0;left:0;height:100%;z-index:1000;transform:translate(-100%);transition:transform var(--transition-normal);margin-left:0;border-right:none}.network-design__main[_ngcontent-%COMP%]   .network-design__sidebar--open[_ngcontent-%COMP%]{transform:translate(0)}}.network-design__footer[_ngcontent-%COMP%]{padding:var(--spacing-md);background-color:var(--surface-lighter);border-top:1px solid var(--border-color);font-size:var(--font-size-sm);color:var(--text-color)}.network-design__element[_ngcontent-%COMP%]{padding:var(--spacing-md);margin-bottom:var(--spacing-md);background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-sm);transition:box-shadow var(--transition-fast)}.network-design__element[_ngcontent-%COMP%]:hover{box-shadow:var(--shadow-md)}.network-design__element--selected[_ngcontent-%COMP%]{border-left:4px solid var(--primary-color)}.status-badge-base[_ngcontent-%COMP%], .status-maintenance[_ngcontent-%COMP%], .status-warning[_ngcontent-%COMP%], .status-fault[_ngcontent-%COMP%], .status-inactive[_ngcontent-%COMP%], .status-active[_ngcontent-%COMP%]{display:inline-block;padding:var(--spacing-xs) var(--spacing-sm);border-radius:var(--border-radius-sm);font-size:var(--font-size-sm);font-weight:500}.status-active[_ngcontent-%COMP%]{background-color:var(--color-success-bg);color:var(--color-success-contrast)}.status-inactive[_ngcontent-%COMP%]{background-color:var(--status-inactive-bg);color:var(--status-inactive-fg)}.status-fault[_ngcontent-%COMP%]{background-color:var(--color-danger-bg);color:var(--color-danger-contrast)}.status-warning[_ngcontent-%COMP%]{background-color:var(--color-warning-bg);color:var(--color-warning-contrast)}.status-maintenance[_ngcontent-%COMP%]{background-color:var(--color-maintenance-bg);color:var(--color-maintenance-contrast)}.network-utils__status-badge[_ngcontent-%COMP%]{display:inline-block;padding:var(--spacing-xs) var(--spacing-sm);border-radius:var(--border-radius-sm);font-size:var(--font-size-xs);font-weight:500;text-transform:uppercase}.network-utils__status-badge--active[_ngcontent-%COMP%]{background-color:var(--color-success-bg);color:var(--color-success-contrast)}.network-utils__status-badge--inactive[_ngcontent-%COMP%]{background-color:var(--status-inactive-bg);color:var(--status-inactive-fg)}.network-utils__status-badge--maintenance[_ngcontent-%COMP%]{background-color:var(--color-maintenance-bg);color:var(--color-maintenance-contrast)}.network-utils__loading[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:var(--spacing-lg);color:var(--text-color)}.network-utils__error[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-md);background-color:#ffebee;color:var(--color-danger);border-radius:var(--border-radius-md)}.network-design-layout[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;overflow:hidden;position:relative;background-color:var(--background-color);color:var(--text-color)}.network-design-layout[_ngcontent-%COMP%]   .design-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:0 var(--spacing-md, 16px);height:64px;background-color:var(--surface-color, white);box-shadow:var(--shadow-sm, 0 2px 4px rgba(0, 0, 0, .1));z-index:10}.network-design-layout[_ngcontent-%COMP%]   .design-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:var(--font-size-xl, 20px);font-weight:500;color:var(--text-color-strong, rgba(0, 0, 0, .87))}.network-design-layout[_ngcontent-%COMP%]   .design-nav[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-sm, 8px)}.network-design-layout[_ngcontent-%COMP%]   .design-nav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{height:36px;min-width:80px}.network-design-layout[_ngcontent-%COMP%]   .design-nav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:var(--spacing-sm, 8px)}.network-design-layout[_ngcontent-%COMP%]   .design-nav[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]{background-color:rgba(var(--primary-color-rgb, 63, 81, 181),.1);color:var(--primary-color)}.network-design-layout[_ngcontent-%COMP%]   .design-nav[_ngcontent-%COMP%]   .menu-container[_ngcontent-%COMP%]{position:relative;display:inline-block}.network-design-layout[_ngcontent-%COMP%]   .design-nav[_ngcontent-%COMP%]   .create-button[_ngcontent-%COMP%]{margin-left:var(--spacing-sm, 8px);background-color:rgba(var(--primary-color-rgb, 63, 81, 181),.05)}.network-design-layout[_ngcontent-%COMP%]   .design-nav[_ngcontent-%COMP%]   .create-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]:first-child{margin-right:var(--spacing-sm, 8px)}.network-design-layout[_ngcontent-%COMP%]   .design-nav[_ngcontent-%COMP%]   .create-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]:last-child{margin-left:var(--spacing-xs, 4px);font-size:var(--font-size-xl, 18px)}.network-design-layout[_ngcontent-%COMP%]   .design-content[_ngcontent-%COMP%]{flex:1;min-height:0;display:flex;overflow:hidden;width:100%}.network-design-layout[_ngcontent-%COMP%]   .design-content[_ngcontent-%COMP%]   .network-design-content[_ngcontent-%COMP%]{position:relative;flex:1;width:100%;height:100%;display:flex}.network-design-layout[_ngcontent-%COMP%]   .design-content[_ngcontent-%COMP%]   .network-design-content[_ngcontent-%COMP%]   .network-design-container[_ngcontent-%COMP%]{flex:1;position:relative;overflow:hidden;transition:width .3s ease;width:100%;height:100%}.network-design-layout[_ngcontent-%COMP%]   .design-content[_ngcontent-%COMP%]   .network-design-content[_ngcontent-%COMP%]   .network-design-container.map-hidden[_ngcontent-%COMP%]{display:none}.network-design-layout[_ngcontent-%COMP%]   .design-content[_ngcontent-%COMP%]   .network-design-content[_ngcontent-%COMP%]   .network-design-container[_ngcontent-%COMP%]   .router-container[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;overflow:hidden}.network-design-layout[_ngcontent-%COMP%]   .design-content[_ngcontent-%COMP%]   .network-design-content[_ngcontent-%COMP%]   .element-details-panel[_ngcontent-%COMP%]{width:380px;height:100%;box-shadow:var(--shadow-left-md, -2px 0 8px rgba(0, 0, 0, .1));z-index:5;position:absolute;right:0;top:0;background-color:rgba(var(--surface-color-rgb, 255, 255, 255),.95)}  .element-type-menu{margin-top:4px}  .element-type-menu .mat-mdc-menu-content{padding:8px 0}  .element-type-menu .mat-mdc-menu-item{height:48px;line-height:48px}  .element-type-menu .mat-mdc-menu-item mat-icon{margin-right:12px}@media (max-width: 768px){.design-nav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:none}.design-nav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:0}.design-nav[_ngcontent-%COMP%]   .create-button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:none}.design-content[_ngcontent-%COMP%]   .network-design-content[_ngcontent-%COMP%]{flex-direction:column}.design-content[_ngcontent-%COMP%]   .network-design-content[_ngcontent-%COMP%]   .network-design-container.map-hidden[_ngcontent-%COMP%]{margin-right:0;margin-bottom:var(--element-details-panel-height-mobile, 300px)}.design-content[_ngcontent-%COMP%]   .network-design-content[_ngcontent-%COMP%]   .element-details-panel[_ngcontent-%COMP%]{width:100%;height:var(--element-details-panel-height-mobile, 300px);min-height:var(--element-details-panel-height-mobile, 300px);border-left:none;border-top:1px solid var(--border-color)}}@media (max-width: 600px){.element-details-panel[_ngcontent-%COMP%]{width:100%;position:absolute;top:0;right:0;z-index:var(--z-index-details-panel, 130)}}'],data:{animation:[Ut("routeAnimations",[Mt("map <=> editor",[he({position:"relative"}),Pt(":enter, :leave",[he({position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",flexDirection:"column"})],{optional:!0}),Pt(":enter",[he({opacity:0})],{optional:!0}),Lr([Pt(":leave",[ct("200ms ease-out",he({opacity:0}))],{optional:!0}),Pt(":enter",[ct("200ms ease-in",he({opacity:1}))],{optional:!0})])]),Mt("* <=> *",[he({position:"relative"}),Pt(":enter, :leave",[he({position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",flexDirection:"column"})],{optional:!0}),Pt(":enter",[he({opacity:0})],{optional:!0}),Lr([Pt(":leave",[ct("200ms ease-out",he({opacity:0}))],{optional:!0}),Pt(":enter",[ct("300ms ease-in",he({opacity:1}))],{optional:!0})])])])]}})}}return o})();var Fc=(()=>{class o{goBack(){window.history.back()}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=Y({type:o,selectors:[["app-error"]],decls:9,vars:0,consts:[[1,"error-container"],[1,"error-icon"],["mat-raised-button","","color","primary",3,"click"]],template:function(t,n){t&1&&(c(0,"div",0)(1,"mat-icon",1),p(2,"error_outline"),d(),c(3,"h1"),p(4,"Error"),d(),c(5,"p"),p(6,"Ha ocurrido un error inesperado."),d(),c(7,"button",2),y("click",function(){return n.goBack()}),p(8," Volver "),d()())},dependencies:[ee,be,Ve,pe,ue],styles:[".error-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;text-align:center}.error-icon[_ngcontent-%COMP%]{font-size:64px;height:64px;width:64px;color:#f44336;margin-bottom:16px}h1[_ngcontent-%COMP%]{margin-bottom:16px}p[_ngcontent-%COMP%]{margin-bottom:24px}"]})}}return o})();var si=(()=>{class o{constructor(e,t){this.dialog=e,this.networkStateService=t}canDeactivate(e){return e.elementForm?.dirty?this.dialog.open(bo,{width:"400px",data:{title:"Cambios sin guardar",message:"\xBFEst\xE1s seguro de que deseas salir? Los cambios no guardados se perder\xE1n.",confirmText:"Salir sin guardar",cancelText:"Continuar editando",confirmButtonColor:"warn"}}).afterClosed().pipe(Ne(t=>(this.networkStateService.setIsDirty(!t),Ce(!!t)))):(this.networkStateService.setIsDirty(!1),Ce(!0))}static{this.\u0275fac=function(t){return new(t||o)(O(nt),O(Ie))}}static{this.\u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var Bu=["mapContainer"];function Vu(o,i){if(o&1&&(c(0,"p",34),p(1),d()),o&2){let e=v();xe("aria-label",e.data.description),m(),x(e.data.description)}}function $u(o,i){o&1&&(c(0,"div",35),D(1,"mat-spinner",36),c(2,"span"),p(3,"Buscando ubicaci\xF3n..."),d()())}function ju(o,i){if(o&1&&(c(0,"div",37)(1,"mat-icon",38),p(2,"error"),d(),c(3,"span"),p(4),d()()),o&2){let e=v();m(4),x(e.error)}}function Uu(o,i){o&1&&(c(0,"div",39),D(1,"mat-spinner",40),c(2,"span"),p(3,"Cargando mapa..."),d()())}function Gu(o,i){if(o&1&&(c(0,"div",41)(1,"mat-icon"),p(2,"place"),d(),c(3,"span"),p(4),d()()),o&2){let e=v();m(4),x(e.isWithinDominicanRepublic()?"Ubicaci\xF3n v\xE1lida":"Fuera de Rep\xFAblica Dominicana")}}function Hu(o,i){if(o&1&&(c(0,"div",42)(1,"div",43)(2,"mat-icon"),p(3,"location_on"),d(),c(4,"span"),p(5),d()(),c(6,"div",43)(7,"mat-icon"),p(8,"check_circle"),d(),c(9,"span"),p(10,"Dentro de Rep\xFAblica Dominicana"),d()()()),o&2){let e=v();m(5),j("Coordenadas: ",e.getCoordinatesString(),"")}}var Ur=-90,Gr=90,Hr=-180,Wr=180,Fo={north:19.9302,south:17.4701,west:-72.0035,east:-68.32},zc=(()=>{class o{constructor(e,t,n,r,a,l,u){this.mapService=e,this.networkDesignService=t,this.networkStateService=n,this.snackBar=r,this.cdr=a,this.dialogRef=l,this.data=u,this.searchQuery="",this.loading=!1,this.error=null,this.isValidPosition=!1,this.mapInitialized=!1,this.destroy$=new N,this.defaultPosition={coordinates:[-70.6946,19.8006],lng:-70.6946,lat:19.8006,type:"Point"},this.position=this.convertToExtendedPosition(this.validateInitialPosition(u.position))}ngOnInit(){(!this.position.coordinates||this.position.coordinates.length!==2)&&(this.position=k({},this.defaultPosition)),this.validatePosition(),this.networkStateService.setPositionSelectionActive(!0),this.cdr.markForCheck()}ngAfterViewInit(){setTimeout(()=>this.initializeMap(),0),this.setupKeyboardNavigation()}ngOnDestroy(){this.networkStateService.setPositionSelectionActive(!1),this.destroy$.next(),this.destroy$.complete(),this.mapService.destroyMap()}validateInitialPosition(e){if(!e||!e.coordinates||e.coordinates.length!==2)return k({},this.defaultPosition);let[t,n]=e.coordinates;return isNaN(t)||isNaN(n)||t<Hr||t>Wr||n<Ur||n>Gr?(console.warn("Coordenadas iniciales inv\xE1lidas, usando posici\xF3n por defecto"),k({},this.defaultPosition)):k({},e)}convertToExtendedPosition(e){let t=e.coordinates??[this.defaultPosition.lng,this.defaultPosition.lat];return Q(k({},e),{lng:t[0],lat:t[1]})}updateCoordinates(){if(isNaN(this.position.lat)||isNaN(this.position.lng)){this.error="Las coordenadas deben ser valores num\xE9ricos",this.isValidPosition=!1,this.cdr.markForCheck();return}if(this.position.lat<Ur||this.position.lat>Gr||this.position.lng<Hr||this.position.lng>Wr){this.error=`Coordenadas fuera de rango. Latitud debe estar entre ${Ur} y ${Gr}, Longitud entre ${Hr} y ${Wr}`,this.isValidPosition=!1,this.cdr.markForCheck();return}this.position.lat=parseFloat(this.position.lat.toFixed(6)),this.position.lng=parseFloat(this.position.lng.toFixed(6)),this.position.coordinates=[this.position.lng,this.position.lat],this.validatePosition(),this.mapService.updateMarkerPosition(this.position),this.isValidPosition&&this.showSuccessToast("Coordenadas actualizadas"),this.cdr.markForCheck()}setupKeyboardNavigation(){this.mapContainer&&this.mapContainer.nativeElement&&Hi(this.mapContainer.nativeElement,"keydown").pipe(L(this.destroy$),Ee(e=>["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key))).subscribe(e=>{e.preventDefault();let t=1e-4,n=this.position.lat,r=this.position.lng;switch(e.key){case"ArrowUp":n+=t;break;case"ArrowDown":n-=t;break;case"ArrowLeft":r-=t;break;case"ArrowRight":r+=t;break}this.position.lat=n,this.position.lng=r,this.updateCoordinates()})}initializeMap(){try{if(!this.mapContainer||!this.mapContainer.nativeElement)throw new Error("Contenedor del mapa no disponible");if(typeof this.mapService.initializeMap=="function")this.mapService.initializeMap(this.mapContainer.nativeElement,this.position),this.setupMapEvents(),this.showSuccessToast("Mapa cargado correctamente"),this.mapInitialized=!0,this.cdr.markForCheck();else throw new Error("M\xE9todo initializeMap no disponible en el servicio de mapa")}catch(e){console.error("Error al inicializar el mapa:",e),this.error=e instanceof Error?e.message:"Error al inicializar el mapa",this.snackBar.open("Error al cargar el mapa. Por favor, intente nuevamente.","Cerrar",{duration:5e3,panelClass:["error-snackbar"]}),this.cdr.markForCheck()}}setupMapEvents(){try{typeof this.mapService.onMapClick=="function"&&this.mapService.onMapClick(e=>{this.updatePosition(e),this.pulseMarker(),this.cdr.markForCheck()}),typeof this.mapService.onMarkerDragEnd=="function"&&this.mapService.onMarkerDragEnd(e=>{this.updatePosition(e),this.showSuccessToast("Posici\xF3n actualizada"),this.cdr.markForCheck()}),typeof this.mapService.onZoomChange=="function"&&this.mapService.onZoomChange().pipe(L(this.destroy$)).subscribe(e=>{this.mapInitialized=!0,this.cdr.markForCheck()})}catch(e){console.error("Error al configurar eventos del mapa:",e)}}updatePosition(e){this.position=this.convertToExtendedPosition(e),this.position.lat=parseFloat(this.position.lat.toFixed(6)),this.position.lng=parseFloat(this.position.lng.toFixed(6)),this.position.coordinates=[this.position.lng,this.position.lat],this.validatePosition(),this.cdr.markForCheck()}validatePosition(){let e=this.networkDesignService.validatePosition(this.position),t=this.isWithinDominicanRepublic();this.isValidPosition=e&&t,e?t?this.error=null:this.error="La posici\xF3n debe estar dentro del territorio de Rep\xFAblica Dominicana":this.error="La posici\xF3n seleccionada est\xE1 fuera de los l\xEDmites permitidos",this.cdr.markForCheck()}searchLocation(){return ce(this,null,function*(){if(this.searchQuery.trim()){this.loading=!0,this.error=null,this.cdr.markForCheck();try{let e=yield this.mapService.searchLocation(this.searchQuery);if(e){if(this.updatePosition(e),!this.isValidPosition)throw this.isWithinDominicanRepublic()?new Error("La ubicaci\xF3n est\xE1 fuera de los l\xEDmites permitidos"):new Error("La ubicaci\xF3n est\xE1 fuera de Rep\xFAblica Dominicana");this.showSuccessToast("Ubicaci\xF3n encontrada")}else throw new Error("No se encontr\xF3 la ubicaci\xF3n")}catch(e){this.error=e instanceof Error?e.message:"Error al buscar la ubicaci\xF3n",this.snackBar.open(this.error,"Cerrar",{duration:4e3,panelClass:["error-snackbar"]})}finally{this.loading=!1,this.cdr.markForCheck()}}})}centerMap(){this.mapService.centerMap(),this.showSuccessToast("Mapa centrado")}zoomIn(){this.mapService.zoomIn()}zoomOut(){this.mapService.zoomOut()}onConfirm(){if(!this.isValidPosition){this.error="La posici\xF3n seleccionada no es v\xE1lida",this.snackBar.open(this.error,"Cerrar",{duration:3e3,panelClass:["error-snackbar"]});return}try{let e=Il([this.position.lng,this.position.lat],{altitude:this.position.altitude});this.networkStateService.setSelectedPosition(e),this.pulseMarker(),setTimeout(()=>{this.dialogRef.close(e)},300)}catch(e){console.error("Error al confirmar posici\xF3n:",e),this.snackBar.open("Error al procesar coordenadas","Cerrar",{duration:3e3,panelClass:["error-snackbar"]})}}onCancel(){this.dialogRef.close()}getCoordinatesString(){return`${this.position.lat.toFixed(6)}, ${this.position.lng.toFixed(6)}`}isWithinDominicanRepublic(){return this.position.lat>=Fo.south&&this.position.lat<=Fo.north&&this.position.lng>=Fo.west&&this.position.lng<=Fo.east}getMapAriaLabel(){return`Mapa interactivo. Haga clic para seleccionar ubicaci\xF3n. Posici\xF3n actual: ${this.getCoordinatesString()}`}getStatusText(){return this.isWithinDominicanRepublic()?"Posici\xF3n v\xE1lida dentro de Rep\xFAblica Dominicana":"Posici\xF3n inv\xE1lida, fuera de Rep\xFAblica Dominicana"}showSuccessToast(e){this.snackBar.open(e,"",{duration:2e3,panelClass:["success-snackbar"],horizontalPosition:"center",verticalPosition:"bottom"})}pulseMarker(){try{typeof this.mapService.pulseMarker=="function"?this.mapService.pulseMarker():typeof this.mapService.centerMap=="function"&&this.mapService.centerMap()}catch(e){console.warn("La animaci\xF3n del marcador no est\xE1 disponible:",e)}}static{this.\u0275fac=function(t){return new(t||o)(A(Eo),A(wo),A(Ie),A(qe),A(He),A(Gn),A(_l))}}static{this.\u0275cmp=Y({type:o,selectors:[["app-map-position-dialog"]],viewQuery:function(t,n){if(t&1&&gt(Bu,5),t&2){let r;ut(r=ht())&&(n.mapContainer=r.first)}},decls:73,vars:26,consts:[["mapContainer",""],["charset","utf-8"],["role","dialog","aria-labelledby","dialog-title",1,"map-position-dialog"],["mat-dialog-title","","id","dialog-title"],[1,"title-icon"],["class","dialog-description",4,"ngIf"],[1,"search-container"],["appearance","outline",1,"search-field"],["matInput","","placeholder","Ej: Ciudad, Direcci\xF3n, etc.","aria-label","Buscar ubicaci\xF3n",3,"ngModelChange","keyup.enter","ngModel","disabled"],["mat-icon-button","","matSuffix","","matTooltip","Buscar","aria-label","Buscar ubicaci\xF3n",1,"search-button",3,"click","disabled"],["class","loading-indicator","aria-live","polite",4,"ngIf"],["class","error-message","aria-live","assertive",4,"ngIf"],[1,"map-container"],["aria-label","Controles del mapa",1,"map-controls"],["mat-mini-fab","","color","primary","matTooltip","Centrar mapa","aria-label","Centrar mapa en la posici\xF3n actual",1,"map-control-button",3,"click"],["mat-mini-fab","","color","primary","matTooltip","Acercar","aria-label","Acercar el mapa",1,"map-control-button",3,"click"],["mat-mini-fab","","color","primary","matTooltip","Alejar","aria-label","Alejar el mapa",1,"map-control-button",3,"click"],["role","application","tabindex","0",1,"map"],["class","map-status-overlay",4,"ngIf"],["class","map-indicator",4,"ngIf"],["aria-labelledby","coordinates-heading",1,"coordinates-container"],["id","coordinates-heading"],[1,"coordinates-fields"],["appearance","outline"],["matInput","","type","number","step","0.000001","aria-label","Latitud","min","-90","max","90",3,"ngModelChange","change","ngModel"],["align","start"],["matInput","","type","number","step","0.000001","aria-label","Longitud","min","-180","max","180",3,"ngModelChange","change","ngModel"],["aria-live","polite",1,"coordinates-display"],[1,"coordinates-text"],["class","position-info","aria-live","polite",4,"ngIf"],["role","note","aria-label","Instrucciones de uso",1,"instructions"],["align","end"],["mat-button","","aria-label","Cancelar y cerrar di\xE1logo",1,"cancel-button",3,"click"],["mat-raised-button","","color","primary","aria-label","Confirmar selecci\xF3n de posici\xF3n",1,"confirm-button",3,"click","disabled"],[1,"dialog-description"],["aria-live","polite",1,"loading-indicator"],["diameter","30"],["aria-live","assertive",1,"error-message"],["color","warn"],[1,"map-status-overlay"],["diameter","40"],[1,"map-indicator"],["aria-live","polite",1,"position-info"],[1,"info-item"]],template:function(t,n){if(t&1){let r=V();D(0,"meta",1),c(1,"div",2)(2,"h2",3)(3,"mat-icon",4),p(4,"place"),d(),p(5),d(),c(6,"mat-dialog-content"),E(7,Vu,2,2,"p",5),c(8,"div",6)(9,"mat-form-field",7)(10,"mat-label"),p(11,"Buscar ubicaci\xF3n"),d(),c(12,"input",8),_n("ngModelChange",function(l){return b(r),fn(n.searchQuery,l)||(n.searchQuery=l),C(l)}),y("keyup.enter",function(){return b(r),C(n.searchLocation())}),d(),c(13,"button",9),y("click",function(){return b(r),C(n.searchLocation())}),c(14,"mat-icon"),p(15),d()()()(),E(16,$u,4,0,"div",10)(17,ju,5,1,"div",11),c(18,"div",12)(19,"div",13)(20,"button",14),y("click",function(){return b(r),C(n.centerMap())}),c(21,"mat-icon"),p(22,"my_location"),d()(),c(23,"button",15),y("click",function(){return b(r),C(n.zoomIn())}),c(24,"mat-icon"),p(25,"add"),d()(),c(26,"button",16),y("click",function(){return b(r),C(n.zoomOut())}),c(27,"mat-icon"),p(28,"remove"),d()()(),D(29,"div",17,0),E(31,Uu,4,0,"div",18)(32,Gu,5,1,"div",19),d(),c(33,"div",20)(34,"h3",21)(35,"mat-icon"),p(36,"explore"),d(),p(37," Coordenadas "),d(),c(38,"div",22)(39,"mat-form-field",23)(40,"mat-label"),p(41,"Latitud"),d(),c(42,"input",24),_n("ngModelChange",function(l){return b(r),fn(n.position.lat,l)||(n.position.lat=l),C(l)}),y("change",function(){return b(r),C(n.updateCoordinates())}),d(),c(43,"mat-hint",25),p(44,"Entre -90 y 90"),d()(),c(45,"mat-form-field",23)(46,"mat-label"),p(47,"Longitud"),d(),c(48,"input",26),_n("ngModelChange",function(l){return b(r),fn(n.position.lng,l)||(n.position.lng=l),C(l)}),y("change",function(){return b(r),C(n.updateCoordinates())}),d(),c(49,"mat-hint",25),p(50,"Entre -180 y 180"),d()()(),c(51,"div",27)(52,"span",28),p(53),d(),c(54,"span")(55,"mat-icon"),p(56),d(),p(57),d()()(),E(58,Hu,11,1,"div",29),c(59,"div",30)(60,"mat-icon"),p(61,"info"),d(),c(62,"span"),p(63,"Haga clic en el mapa o arrastre el marcador para seleccionar una ubicaci\xF3n"),d()()(),c(64,"mat-dialog-actions",31)(65,"button",32),y("click",function(){return b(r),C(n.onCancel())}),c(66,"mat-icon"),p(67,"close"),d(),p(68," Cancelar "),d(),c(69,"button",33),y("click",function(){return b(r),C(n.onConfirm())}),c(70,"mat-icon"),p(71,"check"),d(),p(72," Confirmar "),d()()()}t&2&&(m(5),j(" ",n.data.title||"Seleccionar Posici\xF3n"," "),m(2),h("ngIf",n.data.description),m(5),hn("ngModel",n.searchQuery),h("disabled",n.loading),xe("aria-invalid",!!n.error),m(),h("disabled",n.loading||!n.searchQuery.trim()),m(2),x(n.loading?"hourglass_empty":"search"),m(),h("ngIf",n.loading),m(),h("ngIf",n.error),m(12),xe("aria-label",n.getMapAriaLabel()),m(2),h("ngIf",!n.mapInitialized),m(),h("ngIf",n.mapInitialized),m(10),hn("ngModel",n.position.lat),xe("aria-invalid",!n.isValidPosition),m(6),hn("ngModel",n.position.lng),xe("aria-invalid",!n.isValidPosition),m(5),x(n.getCoordinatesString()),m(),Z("valid-position",n.isWithinDominicanRepublic())("invalid-position",!n.isWithinDominicanRepublic()),xe("aria-label",n.getStatusText()),m(2),x(n.isWithinDominicanRepublic()?"check_circle":"error"),m(),j(" ",n.isWithinDominicanRepublic()?"Posici\xF3n v\xE1lida":"Fuera de l\xEDmites"," "),m(),h("ngIf",n.isValidPosition),m(11),h("disabled",!n.isValidPosition))},dependencies:[ee,re,io,jn,al,Un,ul,gl,to,nn,Hn,Kn,Wn,be,Ve,Be,tl,Yn,vo,po,co,bl,Cl,Zn,pe,ue,Xn,tn,Me,ke,_t,Jt,Qn],encapsulation:2,changeDetection:0})}}return o})();var rn={origin:()=>_o(0,0),domincanRepublic:()=>_o(18.735693,-70.162651),santo_domingo:()=>_o(18.4821,-69.9312)};var Wu={useMocks:!0,apiUrl:"http://localhost:3000/api",featureFlags:{enableMockData:!0}},Ht=function(o){return o.IDLE="IDLE",o.SOURCE_SELECTED="SOURCE_SELECTED",o.TARGET_SELECTED="TARGET_SELECTED",o.FAILED="FAILED",o}(Ht||{}),Bc=(()=>{class o{constructor(){this.logger=P(K),this.connectionsSubject=new ge([]),this.connectionInProgressSubject=new ge({state:Ht.IDLE}),this.connections$=this.connectionsSubject.asObservable(),this.connectionInProgress$=this.connectionInProgressSubject.asObservable(),this.connections=[],this.logger.debug("MapConnectionService inicializado")}setConnections(e){this.connections=[...e],this.connectionsSubject.next(this.connections),this.logger.debug(`Cargadas ${e.length} conexiones`)}getConnections(){return[...this.connections]}getConnectionById(e){return this.connections.find(t=>t.id===e)}getConnectionsForElement(e){return this.connections.filter(t=>t.sourceElementId===e||t.targetElementId===e)}getConnectionBetweenElements(e,t){return this.connections.find(n=>n.sourceElementId===e&&n.targetElementId===t||n.sourceElementId===t&&n.targetElementId===e)}startConnectionCreation(){this.connectionInProgressSubject.next({state:Ht.IDLE}),this.logger.debug("Iniciando creaci\xF3n de conexi\xF3n")}selectSourceElement(e){if(!this.isValidConnectionEndpoint(e)){this.setConnectionError("El elemento seleccionado no puede ser usado como origen de conexi\xF3n");return}this.connectionInProgressSubject.next({sourceElement:e,state:Ht.SOURCE_SELECTED}),this.logger.debug(`Elemento origen seleccionado: ${e.id}`)}selectTargetElement(e){let t=this.connectionInProgressSubject.value;if(t.state!==Ht.SOURCE_SELECTED||!t.sourceElement){this.setConnectionError("Debe seleccionar primero un elemento origen");return}if(t.sourceElement.id===e.id){this.setConnectionError("El origen y destino no pueden ser el mismo elemento");return}if(!this.isValidConnectionEndpoint(e)){this.setConnectionError("El elemento seleccionado no puede ser usado como destino de conexi\xF3n");return}if(!this.areElementsCompatible(t.sourceElement,e)){this.setConnectionError("Los elementos seleccionados no son compatibles para conexi\xF3n");return}this.connectionInProgressSubject.next(Q(k({},t),{targetElement:e,state:Ht.TARGET_SELECTED})),this.logger.debug(`Elemento destino seleccionado: ${e.id}`)}finishConnection(){return ce(this,null,function*(){let e=this.connectionInProgressSubject.value;if(e.state!==Ht.TARGET_SELECTED||!e.sourceElement||!e.targetElement){this.setConnectionError("No hay una conexi\xF3n v\xE1lida en progreso");return}try{let t=e.sourceElement.id,n=e.targetElement.id;if(!t||!n){this.setConnectionError("Los elementos de origen o destino no tienen IDs");return}let r={id:`conn-${Date.now()}`,name:`Conexi\xF3n ${t}-${n}`,sourceElementId:t,targetElementId:n,status:Ze.ACTIVE,type:this.determineConnectionType(e.sourceElement,e.targetElement)};return e.sourceElement.type===s.OLT&&e.targetElement.type===s.ONT&&(r.name=`OLT-ONT-${Date.now()}`,r.description=`Conexi\xF3n entre ${e.sourceElement.name} y ${e.targetElement.name}`),this.connections=[...this.connections,r],this.connectionsSubject.next(this.connections),this.resetConnectionCreation(),this.logger.debug(`Conexi\xF3n creada: ${r.id}`),r}catch(t){this.logger.error("Error al crear la conexi\xF3n",t),this.setConnectionError("Error al crear la conexi\xF3n");return}})}cancelConnectionCreation(){this.resetConnectionCreation(),this.logger.debug("Creaci\xF3n de conexi\xF3n cancelada")}updateConnection(e,t){let n=this.connections.findIndex(r=>r.id===e);if(n===-1){this.logger.warn(`Conexi\xF3n no encontrada: ${e}`);return}this.connections=[...this.connections.slice(0,n),k(k({},this.connections[n]),t),...this.connections.slice(n+1)],this.connectionsSubject.next(this.connections),this.logger.debug(`Conexi\xF3n actualizada: ${e}`)}deleteConnection(e){let t=this.connections.findIndex(n=>n.id===e);if(t===-1){this.logger.warn(`Conexi\xF3n no encontrada: ${e}`);return}this.connections=[...this.connections.slice(0,t),...this.connections.slice(t+1)],this.connectionsSubject.next(this.connections),this.logger.debug(`Conexi\xF3n eliminada: ${e}`)}isValidConnectionEndpoint(e){return[s.OLT,s.ONT,s.ODF,s.SPLITTER,s.MANGA,s.FDP,s.TERMINAL_BOX].includes(e.type)}areElementsCompatible(e,t){let n={[s.OLT]:[s.ODF,s.SPLITTER],[s.ODF]:[s.OLT,s.SPLITTER,s.MANGA,s.FDP],[s.SPLITTER]:[s.OLT,s.ODF,s.FDP,s.TERMINAL_BOX,s.SPLITTER],[s.MANGA]:[s.ODF,s.FDP,s.TERMINAL_BOX],[s.FDP]:[s.ODF,s.SPLITTER,s.MANGA,s.TERMINAL_BOX],[s.TERMINAL_BOX]:[s.SPLITTER,s.MANGA,s.FDP,s.ONT],[s.ONT]:[s.TERMINAL_BOX]};return n[e.type]?.includes(t.type)||n[t.type]?.includes(e.type)||!1}determineConnectionType(e,t){return e.type===s.OLT&&t.type===s.ODF||t.type===s.OLT&&e.type===s.ODF?"OLT-ODF":e.type===s.ODF&&t.type===s.SPLITTER||t.type===s.ODF&&e.type===s.SPLITTER?"ODF-SPLITTER":e.type===s.SPLITTER&&t.type===s.TERMINAL_BOX||t.type===s.SPLITTER&&e.type===s.TERMINAL_BOX?"SPLITTER-TERMINAL":e.type===s.TERMINAL_BOX&&t.type===s.ONT||t.type===s.TERMINAL_BOX&&e.type===s.ONT?"TERMINAL-ONT":"FIBER"}setConnectionError(e){this.connectionInProgressSubject.next({state:Ht.FAILED,error:e}),this.logger.warn(`Error en creaci\xF3n de conexi\xF3n: ${e}`),setTimeout(()=>this.resetConnectionCreation(),3e3)}resetConnectionCreation(){this.connectionInProgressSubject.next({state:Ht.IDLE})}createConnection(e){if(!e.sourceElement||!e.targetElement)return lt(()=>new Error("Elementos de origen o destino no definidos"));if(!e.sourceElement.id||!e.targetElement.id)return lt(()=>new Error("Los elementos de origen o destino no tienen IDs"));let t={id:`conn-${Date.now()}`,name:e.name||`Conexi\xF3n ${e.sourceElement.name} a ${e.targetElement.name}`,sourceElementId:e.sourceElement.id,targetElementId:e.targetElement.id,status:Ze.ACTIVE,type:this.determineConnectionType(e.sourceElement,e.targetElement),properties:{}};return e.waypoints&&e.waypoints.length>0&&(t.points=e.waypoints),this.logger.debug("Creando nueva conexi\xF3n:",t),Wu.useMocks?(t.id=`conn-${Date.now()}-${Math.floor(Math.random()*1e3)}`,t.createdAt=new Date,this.addConnectionToLocalList(t),Ce(t).pipe(hi(300),Te(()=>this.logger.debug("Conexi\xF3n creada localmente:",t)))):Ce(t).pipe(hi(300),Te(()=>this.logger.debug("Conexi\xF3n simulada:",t)))}addConnectionToLocalList(e){this.connections=[...this.connections,e],this.connectionsSubject.next(this.connections)}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var Ae=function(o){return o.ELEMENT_SELECTED="element_selected",o.CONNECTION_SELECTED="connection_selected",o.CONNECTION_CREATED="connection_created",o.ELEMENT_CREATED="element_created",o.ELEMENT_DELETED="element_deleted",o.MEASUREMENT_COMPLETED="measurement_completed",o.LAYER_TOGGLED="layer_toggled",o.ACTION_CANCELLED="action_cancelled",o.ZOOM_CHANGED="zoom_changed",o.TOOL_CHANGED="tool_changed",o.MAP_CLICKED="map_clicked",o.DRAG_STARTED="drag_started",o.DRAG_ENDED="drag_ended",o.ELEMENT_UPDATED="element_updated",o.CONNECTION_UPDATED="connection_updated",o.MAP_CENTER_CHANGED="map_center_changed",o.MAP_BOUNDS_CHANGED="map_bounds_changed",o.MAP_READY="map_ready",o.MAP_ERROR="map_error",o}(Ae||{}),an=(()=>{class o{constructor(e){this.logger=e,this.eventSubject=new ge(null),this.cancelActionsSubject=new N,this.logger.debug("MapEventsService inicializado")}dispatch(e){this.logger.debug(`Evento del mapa emitido: ${e.type}`),this.eventSubject.next(e)}getEvents(){return this.eventSubject.asObservable().pipe(Ee(e=>e!==null))}getEventsByType(e){return this.getEvents().pipe(Ee(t=>t.type===e))}on(e){return this.getEventsByType(e)}cancelAction(e,t="Cancelled by user"){this.logger.debug(`Solicitud de cancelaci\xF3n para acci\xF3n: ${e}`),this.cancelActionsSubject.next(e),this.dispatch({type:Ae.ACTION_CANCELLED,timestamp:new Date,action:e,reason:t})}onActionCancelled(e){return this.cancelActionsSubject.asObservable().pipe(Ee(t=>t===e),de(()=>{}))}withCancellation(e,t){let n=this.onActionCancelled(e);return t(n)}selectElement(e){this.dispatch({type:Ae.ELEMENT_SELECTED,timestamp:new Date,element:e})}selectConnection(e){this.dispatch({type:Ae.CONNECTION_SELECTED,timestamp:new Date,connection:e})}createConnection(e){this.dispatch({type:Ae.CONNECTION_CREATED,timestamp:new Date,connection:e})}createElement(e){this.dispatch({type:Ae.ELEMENT_CREATED,timestamp:new Date,element:e})}deleteElement(e,t){this.dispatch({type:Ae.ELEMENT_DELETED,timestamp:new Date,elementId:e,elementName:t})}completeMeasurement(e,t,n){this.dispatch({type:Ae.MEASUREMENT_COMPLETED,timestamp:new Date,sourceElement:e,targetElement:t,distance:n})}toggleLayer(e,t){this.dispatch({type:Ae.LAYER_TOGGLED,timestamp:new Date,layerType:e,active:t})}changeZoom(e){this.dispatch({type:Ae.ZOOM_CHANGED,timestamp:new Date,level:e})}changeTool(e,t){this.dispatch({type:Ae.TOOL_CHANGED,timestamp:new Date,tool:e,previousTool:t})}mapClicked(e){this.dispatch({type:Ae.MAP_CLICKED,timestamp:new Date,position:e})}dragStarted(e,t){this.dispatch({type:Ae.DRAG_STARTED,timestamp:new Date,elementId:e,startPosition:t})}dragEnded(e,t){this.dispatch({type:Ae.DRAG_ENDED,timestamp:new Date,elementId:e,endPosition:t})}updateElement(e,t){this.dispatch({type:Ae.ELEMENT_UPDATED,timestamp:new Date,element:e,previousState:t})}updateConnection(e,t){this.dispatch({type:Ae.CONNECTION_UPDATED,timestamp:new Date,connection:e,previousState:t})}mapCenterChanged(e,t){this.dispatch({type:Ae.MAP_CENTER_CHANGED,timestamp:new Date,center:e,zoom:t})}mapBoundsChanged(e){this.dispatch({type:Ae.MAP_BOUNDS_CHANGED,timestamp:new Date,bounds:e})}mapReady(e){this.dispatch({type:Ae.MAP_READY,timestamp:new Date,mapInstance:e})}mapError(e,t){this.dispatch({type:Ae.MAP_ERROR,timestamp:new Date,error:e,context:t})}static{this.\u0275fac=function(t){return new(t||o)(O(K))}}static{this.\u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var zo=(()=>{class o{constructor(e){this.logger=e}initialize(e,t={}){return new Promise((n,r)=>{try{let a=this.initializeMapContainer(e,t);if(!a.success){r(new Error(a.errorMessage));return}t.darkMode?e.classList.add("dark-theme"):e.classList.remove("dark-theme"),t.enableOfflineMode&&e.setAttribute("data-offline-mode","true"),t.async?setTimeout(()=>n(a),100):n(a)}catch(a){this.logger.error("Error en initialize:",a),r(a)}})}initializeMapContainer(e,t={}){if(!e){let a="Contenedor de mapa no disponible";return this.logger.error(a),{success:!1,errorMessage:a}}let n=t.minSize||10,r=e.getBoundingClientRect();if(r.width<n||r.height<n){let a=`Dimensiones del contenedor incorrectas: ${r.width}x${r.height}`;return this.logger.error(a),{success:!1,errorMessage:a}}return t.width&&(e.style.width=`${t.width}px`),t.height&&(e.style.height=`${t.height}px`),t.cssClass&&e.classList.add(t.cssClass),this.logger.debug(`Contenedor de mapa inicializado: ${r.width}x${r.height}`),{success:!0,dimensions:{width:r.width,height:r.height}}}showInitializationError(e,t,n,r){this.logger.error(`Error de inicializaci\xF3n en ${t}: ${e}`),n&&r&&r.run(()=>{n.open(`Error: ${e}`,"Cerrar",{duration:yo.ui.snackbarDuration,panelClass:"error-snackbar"})})}refreshContainer(e,t){e&&setTimeout(()=>{let n=e.getBoundingClientRect();this.logger.debug(`Contenedor actualizado: ${n.width}x${n.height}`),t.markForCheck()},0)}hasValidDimensions(e,t=10,n=10){if(!e)return!1;let r=e.getBoundingClientRect();return r.width>=t&&r.height>=n}setupAutoFill(e){e&&(e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.right="0",e.style.bottom="0",e.style.width="100%",e.style.height="100%")}addDebugVisualization(e,t){if(!yo.debugging.componentBoundaries||!yo.debugging.componentBoundaries)return;e.style.border="1px dashed rgba(255, 0, 0, 0.5)";let n=document.createElement("div");n.textContent=t,n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.fontSize="10px",n.style.background="rgba(255, 0, 0, 0.7)",n.style.color="white",n.style.padding="2px 5px",n.style.zIndex="9999",e.appendChild(n)}static{this.\u0275fac=function(t){return new(t||o)(O(K))}}static{this.\u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var Vc={[s.OLT]:"Terminal de L\xEDnea \xD3ptica",[s.ONT]:"Terminal de Red \xD3ptica",[s.FDP]:"Punto de Distribuci\xF3n de Fibra",[s.ODF]:"Marco de Distribuci\xF3n \xD3ptica",[s.EDFA]:"Amplificador de Fibra",[s.SPLITTER]:"Divisor \xD3ptico",[s.MANGA]:"Manga de Empalme",[s.TERMINAL_BOX]:"Caja Terminal",[s.FIBER_THREAD]:"Hilo de Fibra",[s.FIBER_CONNECTION]:"Conexi\xF3n de Fibra",[s.FIBER_SPLICE]:"Empalme de Fibra",[s.FIBER_CABLE]:"Cable de Fibra",[s.FIBER_STRAND]:"Hilo de Fibra",[s.DROP_CABLE]:"Cable de Acometida",[s.DISTRIBUTION_CABLE]:"Cable de Distribuci\xF3n",[s.FEEDER_CABLE]:"Cable Alimentador",[s.BACKBONE_CABLE]:"Cable Troncal",[s.ROUTER]:"Router",[s.RACK]:"Rack",[s.MSAN]:"Nodo de Acceso Multi-Servicio",[s.NETWORK_GRAPH]:"Grafo de Red",[s.WDM_FILTER]:"Filtro WDM",[s.COHERENT_TRANSPONDER]:"Transpondedor Coherente",[s.WAVELENGTH_ROUTER]:"Enrutador de Longitudes de Onda",[s.OPTICAL_SWITCH]:"Conmutador \xD3ptico",[s.ROADM]:"Multiplexor \xD3ptico Reconfigurable",[s.OPTICAL_AMPLIFIER]:"Amplificador \xD3ptico",[s.SLACK_FIBER]:"Flojo de Fibra",[s.CUSTOM]:"Elemento Personalizado",[s.CABINET]:"Gabinete",[s.CHAMBER]:"C\xE1mara/Pozo",[s.POLE]:"Poste",[s.BUILDING]:"Edificio",[s.SITE]:"Sitio/Local",[s.NODE]:"Nodo",[s.PATCH_PANEL]:"Panel de Parcheo",[s.FIBER_CLOSURE]:"Cierre de Fibra",[s.SWITCH]:"Switch",[s.MULTIPLEXER]:"Multiplexor",[s.DEMULTIPLEXER]:"Demultiplexor",[s.REPEATER]:"Repetidor",[s.ATTENUATOR]:"Atenuador",[s.CONNECTOR]:"Conector",[s.CROSS_CONNECT]:"Cruzada",[s.SUBSCRIBER]:"Abonado/Cliente",[s.SERVICE_POINT]:"Punto de Servicio",[s.AGGREGATION_POINT]:"Punto de Agregaci\xF3n",[s.SPLICE_BOX]:"Caja de Empalme",[s.NAP]:"Punto de Acceso a la Red",[s.FAT]:"Terminal de Acceso de Fibra",[s.DISTRIBUTION_BOX]:"Caja de Distribuci\xF3n",[s.ACCESS_POINT]:"Punto de Acceso",[s.HUB]:"Concentrador",[s.GATEWAY]:"Pasarela",[s.DUCT]:"Ducto/Canalizaci\xF3n",[s.WSS]:"Switch Selectivo de Longitud de Onda",[s.RF_OVERLAY_SYSTEM]:"Sistema RF Overlay",[s.MONITORING_SYSTEM]:"Sistema de Monitorizaci\xF3n",[s.ROUTE]:"Ruta",[s.SERVICE_AREA]:"\xC1rea de Servicio",[s.MDU_BUILDING]:"Edificio MDU"},SC={[s.OLT]:"router",[s.ONT]:"device_hub",[s.FDP]:"cable",[s.ODF]:"settings_input_hdmi",[s.EDFA]:"electrical_services",[s.SPLITTER]:"call_split",[s.MANGA]:"manga",[s.TERMINAL_BOX]:"inbox",[s.FIBER_THREAD]:"timeline",[s.FIBER_CONNECTION]:"timeline",[s.FIBER_SPLICE]:"settings_input_component",[s.FIBER_CABLE]:"settings_ethernet",[s.FIBER_STRAND]:"settings_ethernet",[s.DROP_CABLE]:"settings_ethernet",[s.DISTRIBUTION_CABLE]:"settings_ethernet",[s.FEEDER_CABLE]:"settings_ethernet",[s.BACKBONE_CABLE]:"settings_ethernet",[s.ROUTER]:"wifi_tethering",[s.RACK]:"dns",[s.MSAN]:"device_hub",[s.NETWORK_GRAPH]:"share",[s.WDM_FILTER]:"filter_alt",[s.COHERENT_TRANSPONDER]:"dvr",[s.WAVELENGTH_ROUTER]:"router",[s.OPTICAL_SWITCH]:"swap_horiz",[s.ROADM]:"swap_calls",[s.OPTICAL_AMPLIFIER]:"trending_up",[s.SLACK_FIBER]:"waves",[s.CUSTOM]:"extension",[s.CABINET]:"inventory_2",[s.CHAMBER]:"architecture",[s.POLE]:"candlestick_chart",[s.BUILDING]:"apartment",[s.SITE]:"location_on",[s.NODE]:"hub",[s.PATCH_PANEL]:"dashboard",[s.FIBER_CLOSURE]:"all_inbox",[s.SWITCH]:"swap_horiz",[s.MULTIPLEXER]:"call_merge",[s.DEMULTIPLEXER]:"call_split",[s.REPEATER]:"repeat",[s.ATTENUATOR]:"tune",[s.CONNECTOR]:"link",[s.CROSS_CONNECT]:"compare_arrows",[s.SUBSCRIBER]:"person",[s.SERVICE_POINT]:"room_service",[s.AGGREGATION_POINT]:"merge_type",[s.SPLICE_BOX]:"inbox",[s.NAP]:"network_cell",[s.FAT]:"router",[s.DISTRIBUTION_BOX]:"inventory",[s.ACCESS_POINT]:"wifi",[s.HUB]:"hub",[s.GATEWAY]:"vpn_lock",[s.DUCT]:"alt_route",[s.WSS]:"settings_ethernet",[s.RF_OVERLAY_SYSTEM]:"settings_input_antenna",[s.MONITORING_SYSTEM]:"monitor_heart",[s.ROUTE]:"alt_route",[s.SERVICE_AREA]:"map",[s.MDU_BUILDING]:"apartment"},$c={[B.ACTIVE]:"status-active",[B.INACTIVE]:"status-inactive",[B.MAINTENANCE]:"status-maintenance",[B.ERROR]:"status-error",[B.PLANNING]:"status-planning",[B.FAULT]:"status-fault",[B.PLANNED]:"status-planned",[B.BUILDING]:"status-building",[B.RESERVE]:"status-reserved",[B.DECOMMISSIONED]:"status-decommissioned",[B.WARNING]:"status-warning",[B.CRITICAL]:"status-critical",[B.UNKNOWN]:"status-unknown"},MC={[B.ACTIVE]:"Activo",[B.INACTIVE]:"Inactivo",[B.MAINTENANCE]:"En mantenimiento",[B.ERROR]:"Error",[B.PLANNING]:"Planificaci\xF3n",[B.FAULT]:"Con fallo",[B.PLANNED]:"Planificado",[B.BUILDING]:"En construcci\xF3n",[B.RESERVE]:"Reservado",[B.DECOMMISSIONED]:"Fuera de servicio",[B.WARNING]:"Con advertencias",[B.CRITICAL]:"Estado cr\xEDtico",[B.UNKNOWN]:"Desconocido"},PC={ACTIVE_EQUIPMENT:[s.OLT,s.ONT,s.EDFA,s.ROUTER,s.MSAN,s.ROADM,s.COHERENT_TRANSPONDER,s.OPTICAL_SWITCH,s.OPTICAL_AMPLIFIER,s.SWITCH,s.MULTIPLEXER,s.DEMULTIPLEXER,s.REPEATER,s.HUB,s.GATEWAY,s.ACCESS_POINT],PASSIVE_EQUIPMENT:[s.ODF,s.FDP,s.SPLITTER,s.MANGA,s.TERMINAL_BOX,s.RACK,s.WDM_FILTER,s.PATCH_PANEL,s.FIBER_CLOSURE,s.ATTENUATOR,s.CONNECTOR,s.CROSS_CONNECT,s.SPLICE_BOX,s.NAP,s.FAT,s.DISTRIBUTION_BOX],INFRASTRUCTURE:[s.CABINET,s.CHAMBER,s.POLE,s.BUILDING,s.SITE,s.NODE],CABLES:[s.FIBER_CABLE,s.DROP_CABLE,s.DISTRIBUTION_CABLE,s.FEEDER_CABLE,s.BACKBONE_CABLE,s.FIBER_THREAD,s.FIBER_STRAND,s.SLACK_FIBER],CONNECTIONS:[s.FIBER_CONNECTION,s.FIBER_SPLICE],VIRTUAL:[s.NETWORK_GRAPH,s.WAVELENGTH_ROUTER],CLIENTS:[s.SUBSCRIBER,s.SERVICE_POINT,s.AGGREGATION_POINT],CUSTOM:[s.CUSTOM]};var me=function(o){return o.DEBUG="debug",o.INFO="info",o.WARN="warn",o.ERROR="error",o.PERFORMANCE="performance",o}(me||{}),Bo=(()=>{class o{constructor(e){this.injector=e,this.destroy$=new N,this.isLoading=!0,this.error=null,this.mapInitialized=!1,this.memoizationCache=new Map,this.debugMode=!1,this.enabledLogLevels=new Set([me.ERROR,me.WARN]),this.memoStats={hits:0,misses:0,expired:0,totalEntries:0},this.logger=this.injector.get(K),this.cdr=this.injector.get(He),this.zone=this.injector.get(et),this.snackBar=this.injector.get(qe),this.elementService=this.injector.get(Ft),this.networkStateService=this.injector.get(Ie),this.mapEventsService=this.injector.get(an),this.mapInitializer=this.injector.get(zo),this.utils=this.injector.get(zl),this.checkDebugMode()}checkDebugMode(){if(localStorage.getItem("networkmap_debug_mode")==="true"){this.debugMode=!0,this.enableAllLogLevels(),this.logDebug("Modo debug activado desde localStorage");return}if(typeof window<"u"){let t=new URLSearchParams(window.location.search);t.get("debug")==="true"&&(this.debugMode=!0,this.enableAllLogLevels(),this.logDebug("Modo debug activado desde URL"));let r=t.get("logLevels");r&&this.configureLogLevels(r.split(","))}}enableAllLogLevels(){this.enabledLogLevels=new Set(Object.values(me))}configureLogLevels(e){!e||e.length===0||(this.enabledLogLevels.clear(),e.forEach(t=>{let n=t.toLowerCase();Object.values(me).includes(n)&&this.enabledLogLevels.add(n)}),this.enabledLogLevels.add(me.ERROR))}logDebug(e,t,n=me.DEBUG){if(!this.debugMode&&!this.enabledLogLevels.has(n))return;let r=this.constructor.name,l=`[${new Date().toISOString()}] [${r}] ${e}`;switch(n){case me.INFO:t?this.logger.info(l,t):this.logger.info(l);break;case me.WARN:t?this.logger.warn(l,t):this.logger.warn(l);break;case me.ERROR:t?this.logger.error(l,t):this.logger.error(l);break;case me.PERFORMANCE:t?this.logger.debug(`[PERFORMANCE] ${l}`,t):this.logger.debug(`[PERFORMANCE] ${l}`);break;case me.DEBUG:default:t?this.logger.debug(l,t):this.logger.debug(l)}}memoize(e,t,n=5e3){let r=`${this.constructor.name}_${e}`,a=Date.now(),l=this.memoizationCache.get(r);if(l){if(a-l.timestamp<l.ttl)return l.hitCount++,this.memoStats.hits++,this.logDebug(`Cache hit para: ${r} (hit count: ${l.hitCount})`,{ttl:l.ttl,age:a-l.timestamp},me.PERFORMANCE),l.value;this.memoStats.expired++,this.logDebug(`Cache expired para: ${r}`,{age:a-l.timestamp,ttl:l.ttl},me.PERFORMANCE)}else this.memoStats.misses++;let u=performance.now(),g=t(),_=performance.now()-u;return this.memoizationCache.set(r,{value:g,timestamp:a,ttl:n,hitCount:1}),this.memoStats.totalEntries=this.memoizationCache.size,this.logDebug(`Cache miss para: ${r}, calculado en ${_.toFixed(2)}ms`,{executionTime:_,cacheSize:this.memoizationCache.size},me.PERFORMANCE),g}clearMemoization(e){if(e){let t=`${this.constructor.name}_${e}`;this.memoizationCache.delete(t),this.logDebug(`Cach\xE9 limpiada para: ${t}`,null,me.PERFORMANCE)}else{let t=this.memoizationCache.size;this.memoizationCache.clear(),this.logDebug(`Toda la cach\xE9 de memoizaci\xF3n ha sido limpiada (${t} entradas)`,null,me.PERFORMANCE)}this.memoStats.totalEntries=this.memoizationCache.size}getMemoizationStats(){let e=this.memoStats.hits/(this.memoStats.hits+this.memoStats.misses);return this.logDebug("Estad\xEDsticas de memoizaci\xF3n:",Q(k({},this.memoStats),{hitRatio:isNaN(e)?0:e.toFixed(2),cacheSize:this.memoizationCache.size}),me.PERFORMANCE),k({},this.memoStats)}handleError(e,t="Error en el componente de mapa",n=!0){this.error=t,this.isLoading=!1;let r=this.constructor.name,a=e?e.message||JSON.stringify(e):"Error desconocido";this.logger.error(`[${r}] ${t}`,{component:r,message:t,error:a,timestamp:new Date().toISOString(),stack:e?.stack}),n&&this.zone.run(()=>{this.snackBar.open(`Error: ${t}`,"Cerrar",{duration:5e3,panelClass:"error-snackbar"}),this.cdr.markForCheck()}),e&&(e.name==="NetworkError"||e.name==="DataCorruptionError")&&this.clearMemoization()}validateContainerDimensions(e,t=100,n=100){if(!e)return this.logDebug("Contenedor no disponible",null,me.WARN),!1;let r=e.clientWidth,a=e.clientHeight;return r<t||a<n?(this.logDebug(`Dimensiones de contenedor inv\xE1lidas: ${r}x${a}`,{width:r,height:a,minWidth:t,minHeight:n},me.WARN),!1):(this.logDebug(`Dimensiones de contenedor v\xE1lidas: ${r}x${a}`,{width:r,height:a,minWidth:t,minHeight:n},me.DEBUG),!0)}initializeMapContainer(e){this.logDebug("Inicializando contenedor de mapa",{container:e.id||"sin-id",dimensions:`${e.clientWidth}x${e.clientHeight}`},me.INFO);let t=this.mapInitializer.initializeMapContainer(e);return t.success?!0:(this.handleError(null,t.errorMessage||"Error al inicializar contenedor"),!1)}completeLoading(){let e=performance.now();this.isLoading=!1,this.mapInitialized=!0,this.logDebug("Carga completada",{loadingTime:e},me.INFO),this.cdr.markForCheck()}getElementTypeName(e){return this.memoize(`elementTypeName_${e}`,()=>Vc[e]||`Tipo ${e}`,6e4)}getElementStatusClass(e){return this.memoize(`elementStatusClass_${e}`,()=>$c[e]||"status-unknown",6e4)}calculateDistance(e,t,n,r){return this.memoize(`distance_${e}_${t}_${n}_${r}`,()=>this.utils.calculateDistance(e,t,n,r),3e4)}formatDate(e){return this.utils.formatDate(e)}cleanup(){this.logDebug("Limpiando recursos",this.getMemoizationStats(),me.INFO),this.clearMemoization(),this.destroy$.next(),this.destroy$.complete()}handleElementSelected(e){this.mapEventsService.selectElement(e),this.logDebug("Elemento seleccionado",e?{id:e.id,name:e.name,type:e.type}:null,me.INFO)}handleConnectionSelected(e){this.mapEventsService.selectConnection(e),this.logDebug("Conexi\xF3n seleccionada",e?{id:e.id,type:e.type}:null,me.INFO)}ngOnInit(){try{let e=performance.now();this.logDebug("Inicializando componente",null,me.INFO),this.initializeComponent();let t=performance.now()-e;this.logDebug(`Componente inicializado en ${t.toFixed(2)}ms`,{initTime:t},me.PERFORMANCE)}catch(e){this.handleError(e,"Error al inicializar componente")}}ngOnDestroy(){this.logDebug("Destruyendo componente",null,me.INFO),this.cleanup()}static{this.\u0275fac=function(t){return new(t||o)(A(Qt))}}static{this.\u0275dir=gn({type:o})}}return o})();var Ku=["mapContainer"],qu=["mapSvg"];function Qu(o,i){o&1&&(c(0,"div",11),D(1,"mat-spinner",12),c(2,"span"),p(3,"Cargando mapa..."),d()()),o&2&&(m(),h("diameter",48))}function Zu(o,i){if(o&1){let e=V();c(0,"div",13)(1,"p"),p(2),d(),c(3,"button",14),y("click",function(){b(e);let n=v();return C(n.retryLoading())}),p(4,"Reintentar"),d()()}if(o&2){let e=v();m(2),x(e.errorMessage)}}var ae=function(o){return o.DEBUG="debug",o.INFO="info",o.WARN="warn",o.ERROR="error",o.PERFORMANCE="performance",o}(ae||{}),qr=(()=>{class o extends Bo{set activeLayers(e){this._activeLayers=e,this.refreshMap()}get activeLayers(){return this._activeLayers}set tool(e){this._tool=e,this.updateCursor()}get tool(){return this._tool}set darkMode(e){this.isDarkMode=e,this.applyTheme()}set loading(e){this.isLoading=e,this.cdr.markForCheck()}constructor(e){super(e),this.elementSelected=new H,this.connectionSelected=new H,this.zoomChanged=new H,this.mapError=new H,this.mapLoaded=new H,this.cursorPositionChanged=new H,this.measurementComplete=new H,this.width=800,this.height=600,this.isDarkMode=!1,this.errorMessage=null,this.zoomScale=1,this.panOffset={x:0,y:0},this.isDragging=!1,this.dragStart={x:0,y:0},this.lastPanOffset={x:0,y:0},this._tool="pan",this._activeLayers=[],this.elements=[],this.connections=[],this.selectedElement=null,this.selectedConnection=null,this.connectionService=null,this.stateManager=e.get(bt),this.elementManager=e.get(Jn),this.performanceService=e.get(ti),this.interactionService=e.get(Po),this.zone=e.get(et);try{this.connectionService=e.get(Bc),this.logDebug("MapConnectionService inicializado correctamente")}catch{this.logDebug("MapConnectionService no disponible, algunas funciones de conexi\xC3\xB3n podr\xC3\xADan estar limitadas",null,ae.WARN)}this.logDebug("MapViewComponent inicializado")}initializeComponent(){this.setupSubscriptions()}ngAfterViewInit(){this.updateDimensions(),this.generateGrid(),this.loadElements(),setTimeout(()=>{this.finishLoading()},1500)}setupSubscriptions(){if(this.stateManager.activeLayers.pipe(L(this.destroy$)).subscribe(e=>{this._activeLayers=e,this.refreshMap()}),this.stateManager.currentTool.pipe(L(this.destroy$)).subscribe(e=>{this._tool=e,this.updateCursor()}),this.interactionService)try{let e=this.injector.get(Mo,null);e?(this.logDebug("Usando observables de selecci\xC3\xB3n de MapStateService"),e.selectedElementIds$.pipe(L(this.destroy$)).subscribe(t=>{if(t&&t.length>0){let n=t[0],r=this.elements.find(a=>a.id===n)||null;this.selectedElement?.id!==r?.id&&(this.selectedElement=r,this.updateSelectionIndicators(),this.elementSelected.emit(r),this.cdr.markForCheck())}else this.selectedElement&&(this.selectedElement=null,this.updateSelectionIndicators(),this.elementSelected.emit(null),this.cdr.markForCheck())}),e.selectedConnectionIds$.pipe(L(this.destroy$)).subscribe(t=>{if(t&&t.length>0){let n=t[0],r=this.connections.find(a=>a.id===n)||null;this.selectedConnection?.id!==r?.id&&(this.selectedConnection=r,this.updateSelectionIndicators(),this.connectionSelected.emit(r),this.cdr.markForCheck())}else this.selectedConnection&&(this.selectedConnection=null,this.updateSelectionIndicators(),this.connectionSelected.emit(null),this.cdr.markForCheck())})):this.elementManager&&this.elementManager.elementSelected?(this.logDebug("Usando observable elementSelected de ElementManager"),this.elementManager.elementSelected.pipe(L(this.destroy$)).subscribe(t=>{this.selectedElement?.id!==t?.id&&(this.selectedElement=t,this.updateSelectionIndicators(),this.elementSelected.emit(t),this.cdr.markForCheck())})):this.logDebug("No se encontraron observables de selecci\xC3\xB3n, usando selecci\xC3\xB3n manual",null,ae.WARN)}catch(e){this.logDebug("Error al configurar suscripciones de selecci\xC3\xB3n",e,ae.ERROR)}else this.logDebug("InteractionService no disponible, la selecci\xC3\xB3n funcionar\xC3\xA1 solo manualmente",null,ae.WARN)}updateDimensions(){if(this.mapContainerEl&&this.mapContainerEl.nativeElement){let e=this.mapContainerEl.nativeElement.getBoundingClientRect();this.width=e.width,this.height=e.height,this.cdr.markForCheck()}}generateGrid(){if(!this.mapSvgEl||!this.mapSvgEl.nativeElement){this.logDebug("No se puede generar el grid: elemento SVG no disponible",null,ae.WARN);return}try{let t=this.mapSvgEl.nativeElement.querySelector(".grid-container");if(!t){this.logDebug("No se encuentra el contenedor de la cuadr\xC3\xADcula",null,ae.WARN);return}for(;t.firstChild;)t.removeChild(t.firstChild);let n=50,r=5e3,a=document.createElementNS("http://www.w3.org/2000/svg","rect");a.setAttribute("x",(-r).toString()),a.setAttribute("y",(-r).toString()),a.setAttribute("width",(r*2).toString()),a.setAttribute("height",(r*2).toString()),a.setAttribute("fill",this.isDarkMode?"#2D3748":"#E8EEF2"),t.appendChild(a);for(let g=-r;g<=r;g+=n){let _=document.createElementNS("http://www.w3.org/2000/svg","line");_.setAttribute("x1",g.toString()),_.setAttribute("y1",(-r).toString()),_.setAttribute("x2",g.toString()),_.setAttribute("y2",r.toString()),_.setAttribute("class","grid-line"),_.setAttribute("stroke",this.isDarkMode?"#777777":"#aaaaaa"),_.setAttribute("stroke-width","1"),t.appendChild(_)}for(let g=-r;g<=r;g+=n){let _=document.createElementNS("http://www.w3.org/2000/svg","line");_.setAttribute("x1",(-r).toString()),_.setAttribute("y1",g.toString()),_.setAttribute("x2",r.toString()),_.setAttribute("y2",g.toString()),_.setAttribute("class","grid-line"),_.setAttribute("stroke",this.isDarkMode?"#777777":"#aaaaaa"),_.setAttribute("stroke-width","1"),t.appendChild(_)}let l=document.createElementNS("http://www.w3.org/2000/svg","line");l.setAttribute("x1",(-r).toString()),l.setAttribute("y1","0"),l.setAttribute("x2",r.toString()),l.setAttribute("y2","0"),l.setAttribute("class","grid-axis"),l.setAttribute("stroke",this.isDarkMode?"#999999":"#666666"),l.setAttribute("stroke-width","2"),t.appendChild(l);let u=document.createElementNS("http://www.w3.org/2000/svg","line");u.setAttribute("x1","0"),u.setAttribute("y1",(-r).toString()),u.setAttribute("x2","0"),u.setAttribute("y2",r.toString()),u.setAttribute("class","grid-axis"),u.setAttribute("stroke",this.isDarkMode?"#999999":"#666666"),u.setAttribute("stroke-width","2"),t.appendChild(u),this.panOffset={x:this.width/2,y:this.height/2},this.lastPanOffset=k({},this.panOffset),this.logDebug("Grid generado correctamente")}catch(e){this.logDebug("Error al generar el grid",e,ae.ERROR)}}loadElements(){if(this.isLoading=!0,this.errorMessage=null,this.cdr.markForCheck(),!this.elementManager){this.logDebug("ElementManager no disponible, finalizando carga",null,ae.WARN),setTimeout(()=>{this.finishLoading()},500);return}this.logDebug("Iniciando carga de elementos del mapa",null,ae.INFO),setTimeout(()=>{try{let e=performance.now();this.elementManager.loadElementsProgressively({batchSize:50,maxElements:1e3,progressCallback:t=>{t%10===0&&this.zone.run(()=>{this.logDebug(`Progreso de carga: ${t}%`,null,ae.INFO),this.cdr.detectChanges()})},elementsCallback:t=>{if(!t||!Array.isArray(t)){this.logDebug("Elementos recibidos con formato incorrecto",t,ae.WARN);return}let n=t.filter(r=>{if(!r)return!1;let a=r.position;return Array.isArray(a)&&a.length>=2||a&&typeof a=="object"&&(typeof a.lat=="number"&&typeof a.lng=="number"||Array.isArray(a.coordinates)&&a.coordinates.length>=2)?!0:(this.logDebug(`Elemento con posici\xC3\xB3n inv\xC3\xA1lida: ${r.id||"(sin ID)"} - Tipo: ${r.type}`,{positionType:a?typeof a:"undefined"},ae.DEBUG),!1)});n.length!==t.length&&this.logDebug(`Filtrados ${t.length-n.length} elementos con posiciones inv\xC3\xA1lidas`,null,ae.WARN),this.zone.run(()=>{this.renderElements(n),this.cdr.detectChanges()})}}).subscribe({next:t=>{let n=Math.round(performance.now()-e);this.zone.run(()=>{if(t&&t.success){let r=this.elementManager.getAllElements&&typeof this.elementManager.getAllElements=="function"?this.elementManager.getAllElements():[];this.elements=r,this.performanceService&&typeof this.performanceService.startMonitoring=="function"&&this.performanceService.startMonitoring(),this.refreshMap(),this.logDebug(`Carga de elementos completada con \xC3\xA9xito en ${n}ms`,{elementsCount:this.elements.length,loadTimeMs:n},ae.INFO),setTimeout(()=>this.finishLoading(),100)}else this.errorMessage="Error al cargar elementos",this.mapError.emit(this.errorMessage),this.logDebug("Error en la carga de elementos",t,ae.ERROR),this.finishLoading()})},error:t=>{let n=Math.round(performance.now()-e);this.zone.run(()=>{this.handleError(t,"Error al cargar el mapa");let r=t?.message||"Error desconocido";this.errorMessage=`Error al cargar el mapa: ${r}`,this.mapError.emit(this.errorMessage),this.logDebug(`Error de carga despu\xC3\xA9s de ${n}ms`,t,ae.ERROR),this.finishLoading()})}})}catch(e){this.zone.run(()=>{this.handleError(e,"Error al iniciar la carga del mapa");let t=e?.message||"Inicializaci\xC3\xB3n fallida";this.errorMessage=`Error al iniciar la carga: ${t}`,this.mapError.emit(this.errorMessage),this.logDebug("Error cr\xC3\xADtico al iniciar la carga del mapa",e,ae.ERROR),this.finishLoading()})}},100)}finishLoading(){this.zone.run(()=>{this.isLoading=!1,this.elements.length===0&&this.addSampleElements(),this.cdr.markForCheck(),this.mapLoaded.emit(),setTimeout(()=>this.cdr.detectChanges(),0)})}addSampleElements(){this.logDebug("Agregando elementos de muestra al mapa");try{let e=[{id:"sample-olt-1",type:s.OLT,name:"OLT Muestra 1",position:rn.origin(),status:B.ACTIVE},{id:"sample-splitter-1",type:s.SPLITTER,name:"Splitter Muestra 1",position:rn.santo_domingo(),status:B.ACTIVE},{id:"sample-splitter-2",type:s.SPLITTER,name:"Splitter Muestra 2",position:rn.domincanRepublic(),status:B.ACTIVE},{id:"sample-fdp-1",type:s.FDP,name:"FDP Muestra 1",position:rn.santo_domingo(),status:B.ACTIVE},{id:"sample-fdp-2",type:s.FDP,name:"FDP Muestra 2",position:rn.domincanRepublic(),status:B.ACTIVE},{id:"sample-ont-1",type:s.ONT,name:"ONT Muestra 1",position:rn.santo_domingo(),status:B.ACTIVE},{id:"sample-ont-2",type:s.ONT,name:"ONT Muestra 2",position:rn.domincanRepublic(),status:B.ACTIVE}],t=[{id:"sample-conn-1",name:"Conexi\xC3\xB3n 1",sourceElementId:"sample-olt-1",targetElementId:"sample-splitter-1",type:vt.FIBER,status:Ze.ACTIVE},{id:"sample-conn-2",name:"Conexi\xC3\xB3n 2",sourceElementId:"sample-olt-1",targetElementId:"sample-splitter-2",type:vt.FIBER,status:Ze.ACTIVE},{id:"sample-conn-3",name:"Conexi\xC3\xB3n 3",sourceElementId:"sample-splitter-1",targetElementId:"sample-fdp-1",type:vt.FIBER,status:Ze.ACTIVE},{id:"sample-conn-4",name:"Conexi\xC3\xB3n 4",sourceElementId:"sample-splitter-2",targetElementId:"sample-fdp-2",type:vt.FIBER,status:Ze.ACTIVE},{id:"sample-conn-5",name:"Conexi\xC3\xB3n 5",sourceElementId:"sample-fdp-1",targetElementId:"sample-ont-1",type:vt.FIBER,status:Ze.ACTIVE},{id:"sample-conn-6",name:"Conexi\xC3\xB3n 6",sourceElementId:"sample-fdp-2",targetElementId:"sample-ont-2",type:vt.FIBER,status:Ze.ACTIVE}];if(this.elements=e,this.connections=t,this._activeLayers=[s.OLT,s.SPLITTER,s.FDP,s.ONT],this.renderElements(this.elements),this.renderConnections(),this.elements.length>0){let n=this.elements[0].position;n&&typeof n=="object"&&n.lat!==void 0&&n.lng!==void 0&&this.centerMap([n.lng,n.lat])}}catch(e){this.logDebug("Error al agregar elementos de muestra",e,ae.ERROR)}}refreshMap(){if(!this.mapSvgEl){this.logDebug("No se puede refrescar el mapa: elemento SVG no disponible",null,ae.WARN);return}let e=this.elements.filter(t=>this.activeLayers.includes(t.type));this.renderElements(e),this.updateSelectionIndicators(),this.performanceService&&typeof this.performanceService.registerMapUpdate=="function"&&this.performanceService.registerMapUpdate({elementsCount:e.length,timestamp:Date.now(),visibleLayers:this.activeLayers}),this.cdr.markForCheck()}renderElements(e){if(!this.mapSvgEl||!this.mapSvgEl.nativeElement){this.logDebug("No se pueden renderizar elementos: elemento SVG no disponible",null,ae.WARN);return}try{let n=this.mapSvgEl.nativeElement.querySelector(".elements-layer");if(!n){this.logDebug("No se encuentra la capa para elementos",null,ae.WARN);return}for(;n.firstChild;)n.removeChild(n.firstChild);this.elementManager&&this.renderConnections(),this.logDebug(`Renderizando ${e.length} elementos en el mapa`,null,ae.INFO);let r=0;e.forEach(a=>{let l=0,u=0;if(Array.isArray(a.position)&&a.position.length>=2)[l,u]=a.position;else if(a.position&&typeof a.position=="object")if(typeof a.position.lat=="number"&&typeof a.position.lng=="number")l=a.position.lng*100,u=a.position.lat*100;else if(Array.isArray(a.position.coordinates)&&a.position.coordinates.length>=2)l=a.position.coordinates[0]*100,u=a.position.coordinates[1]*100;else{this.logDebug(`Elemento con formato de posici\xC3\xB3n no soportado: ${a.id||"(sin ID)"}`);return}else{this.logDebug(`Elemento sin posici\xC3\xB3n v\xC3\xA1lida: ${a.id||"(sin ID)"}`);return}let g=document.createElementNS("http://www.w3.org/2000/svg","g");g.setAttribute("class",`network-element element-type-${a.type}`),g.setAttribute("data-element-id",a.id||""),g.setAttribute("data-element-type",a.type),g.setAttribute("transform",`translate(${l}, ${u})`);let _=this.createElementShape(a);if(g.appendChild(_),a.name){let f=document.createElementNS("http://www.w3.org/2000/svg","text");f.setAttribute("x","0"),f.setAttribute("y","20"),f.setAttribute("text-anchor","middle"),f.setAttribute("fill",this.isDarkMode?"#ffffff":"#333333"),f.setAttribute("font-size","10"),f.setAttribute("class","element-label"),f.textContent=a.name||"",g.appendChild(f)}g.addEventListener("mousedown",f=>{f.stopPropagation(),this.tool==="select"&&this.selectElement(a)}),n.appendChild(g),r++}),this.logDebug(`Elementos renderizados con \xC3\xA9xito: ${r} de ${e.length}`),r===0&&e.length>0&&this.logDebug("No se pudo renderizar ning\xC3\xBAn elemento aunque la lista no est\xC3\xA1 vac\xC3\xADa",{elementsSample:e.slice(0,3)},ae.WARN),r>0&&this.panOffset.x===0&&this.panOffset.y===0&&this.centerMap([0,0])}catch(t){this.logDebug("Error al renderizar elementos",t,ae.ERROR)}}createElementShape(e){let t;switch(e.type){case s.OLT:t=document.createElementNS("http://www.w3.org/2000/svg","rect"),t.setAttribute("x","-10"),t.setAttribute("y","-10"),t.setAttribute("width","20"),t.setAttribute("height","20"),t.setAttribute("rx","3"),t.setAttribute("fill","#4CAF50");break;case s.ONT:t=document.createElementNS("http://www.w3.org/2000/svg","circle"),t.setAttribute("cx","0"),t.setAttribute("cy","0"),t.setAttribute("r","8"),t.setAttribute("fill","#F44336");break;case s.SPLITTER:t=document.createElementNS("http://www.w3.org/2000/svg","polygon"),t.setAttribute("points","0,-8 8,0 0,8 -8,0"),t.setAttribute("fill","#FF9800");break;default:t=document.createElementNS("http://www.w3.org/2000/svg","circle"),t.setAttribute("cx","0"),t.setAttribute("cy","0"),t.setAttribute("r","6"),t.setAttribute("fill","#9E9E9E")}return t.setAttribute("stroke","#333"),t.setAttribute("stroke-width","1"),t}renderConnections(){if(!this.mapSvgEl||!this.mapSvgEl.nativeElement){this.logDebug("No se pueden renderizar conexiones: elemento SVG no disponible",null,ae.WARN);return}try{let t=this.mapSvgEl.nativeElement.querySelector(".connections-layer");if(!t){this.logDebug("No se encuentra la capa de conexiones",null,ae.WARN);return}for(;t.firstChild;)t.removeChild(t.firstChild);let n=[];this.connectionService&&typeof this.connectionService.getConnections=="function"?(n=this.connectionService.getConnections(),this.logDebug(`Obtenidas ${n.length} conexiones del servicio MapConnectionService`)):(this.logDebug("MapConnectionService no disponible, buscando en ElementManager",null,ae.INFO),this.elementManager&&typeof this.elementManager.getConnections=="function"?(n=this.elementManager.getConnections()||[],this.logDebug(`Obtenidas ${n.length} conexiones de ElementManager`)):(this.logDebug("M\xC3\xA9todo getConnections no disponible, usando alternativa",null,ae.WARN),n=this.connections));let r=n.filter(a=>{if(!a.sourceElementId||!a.targetElementId)return!1;let l=this.elements.find(g=>g.id===a.sourceElementId),u=this.elements.find(g=>g.id===a.targetElementId);return!l||!u?!1:this.activeLayers.includes(l.type)&&this.activeLayers.includes(u.type)});this.connections=n,this.logDebug(`Renderizando ${r.length} conexiones visibles de ${n.length} totales`),r.forEach(a=>{let l=this.elements.find(q=>q.id===a.sourceElementId),u=this.elements.find(q=>q.id===a.targetElementId);if(!l?.position||!u?.position)return;let g=0,_=0;if(Array.isArray(l.position)&&l.position.length>=2)[g,_]=l.position;else if(l.position&&typeof l.position=="object")if(typeof l.position.lat=="number"&&typeof l.position.lng=="number")g=l.position.lng*100,_=l.position.lat*100;else if(Array.isArray(l.position.coordinates)&&l.position.coordinates.length>=2)g=l.position.coordinates[0]*100,_=l.position.coordinates[1]*100;else return;else return;let f=0,S=0;if(Array.isArray(u.position)&&u.position.length>=2)[f,S]=u.position;else if(u.position&&typeof u.position=="object")if(typeof u.position.lat=="number"&&typeof u.position.lng=="number")f=u.position.lng*100,S=u.position.lat*100;else if(Array.isArray(u.position.coordinates)&&u.position.coordinates.length>=2)f=u.position.coordinates[0]*100,S=u.position.coordinates[1]*100;else return;else return;let T=document.createElementNS("http://www.w3.org/2000/svg","line");T.setAttribute("x1",g.toString()),T.setAttribute("y1",_.toString()),T.setAttribute("x2",f.toString()),T.setAttribute("y2",S.toString());let w=a.status||"unknown",M,z=String(w);z==="active"||z==="ACTIVE"?M="#4CAF50":z==="inactive"||z==="INACTIVE"?M="#F44336":z==="warning"||z==="WARNING"||z==="degraded"||z==="DEGRADED"?M="#FF9800":M="#9E9E9E",T.setAttribute("stroke",M),T.setAttribute("stroke-width","2"),T.setAttribute("class",`connection-line connection-status-${w}`),T.setAttribute("data-connection-id",a.id||""),T.setAttribute("data-source-id",a.sourceElementId),T.setAttribute("data-target-id",a.targetElementId),T.addEventListener("mousedown",q=>{q.stopPropagation(),this.tool==="select"&&this.selectConnection(a)}),t.appendChild(T)})}catch(e){this.logDebug("Error al renderizar conexiones",e,ae.ERROR)}}selectElement(e){this.selectedElement=e,this.selectedConnection=null,this.updateSelectionIndicators(),this.elementSelected.emit(e),this.cdr.markForCheck()}selectConnection(e){this.selectedConnection=e,this.selectedElement=null,this.updateSelectionIndicators(),this.connectionSelected.emit(e),this.cdr.markForCheck()}updateSelectionIndicators(){if(!(!this.mapSvgEl||!this.mapSvgEl.nativeElement))try{let t=this.mapSvgEl.nativeElement.querySelector(".selection-layer");if(!t){this.logDebug("No se encuentra la capa de selecci\xC3\xB3n",null,ae.WARN);return}for(;t.firstChild;)t.removeChild(t.firstChild);this.selectedElement?this.createElementSelectionIndicator(t,this.selectedElement):this.selectedConnection&&this.createConnectionSelectionIndicator(t,this.selectedConnection)}catch(e){this.logDebug("Error al actualizar indicadores de selecci\xC3\xB3n",e,ae.ERROR)}}createElementSelectionIndicator(e,t){if(!t.position||!Array.isArray(t.position)||t.position.length<2)return;let n=t.position[0],r=t.position[1],a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttribute("cx",n.toString()),a.setAttribute("cy",r.toString()),a.setAttribute("r","16"),a.setAttribute("fill","none"),a.setAttribute("stroke","#1976d2"),a.setAttribute("stroke-width","2"),a.setAttribute("stroke-dasharray","4,2"),a.setAttribute("class","selection-indicator pulse-effect");let l=document.createElementNS("http://www.w3.org/2000/svg","animate");l.setAttribute("attributeName","r"),l.setAttribute("from","16"),l.setAttribute("to","18"),l.setAttribute("dur","1s"),l.setAttribute("repeatCount","indefinite"),l.setAttribute("values","16;18;16"),l.setAttribute("keyTimes","0;0.5;1"),a.appendChild(l),e.appendChild(a)}createConnectionSelectionIndicator(e,t){let n=this.elements.find(S=>S.id===t.sourceElementId),r=this.elements.find(S=>S.id===t.targetElementId);if(!n?.position||!r?.position||!Array.isArray(n.position)||n.position.length<2||!Array.isArray(r.position)||r.position.length<2)return;let a=n.position[0],l=n.position[1],u=r.position[0],g=r.position[1],_=document.createElementNS("http://www.w3.org/2000/svg","line");_.setAttribute("x1",a.toString()),_.setAttribute("y1",l.toString()),_.setAttribute("x2",u.toString()),_.setAttribute("y2",g.toString()),_.setAttribute("stroke","#1976d2"),_.setAttribute("stroke-width","4"),_.setAttribute("stroke-dasharray","6,3"),_.setAttribute("class","selection-indicator");let f=document.createElementNS("http://www.w3.org/2000/svg","animate");f.setAttribute("attributeName","stroke-dashoffset"),f.setAttribute("from","0"),f.setAttribute("to","12"),f.setAttribute("dur","1s"),f.setAttribute("repeatCount","indefinite"),_.appendChild(f),e.appendChild(_)}updateCursor(){if(!this.mapContainerEl)return;let e=this.mapContainerEl.nativeElement;switch(this.tool){case"pan":e.style.cursor=this.isDragging?"grabbing":"grab";break;case"select":e.style.cursor="pointer";break;case"measure":e.style.cursor="crosshair";break;case"connect":e.style.cursor="cell";break;default:e.style.cursor="default"}}applyTheme(){this.cdr.markForCheck()}onMouseDown(e){e.button===0&&(this.isDragging=this.tool==="pan",this.dragStart={x:e.clientX,y:e.clientY},this.lastPanOffset=k({},this.panOffset),this.updateCursor(),e.preventDefault())}onMouseMove(e){let t=this.mapSvgEl.nativeElement.getBoundingClientRect(),n={x:e.clientX-t.left,y:e.clientY-t.top};this.cursorPositionChanged.emit(n),this.isDragging&&(this.panOffset={x:this.lastPanOffset.x+(e.clientX-this.dragStart.x),y:this.lastPanOffset.y+(e.clientY-this.dragStart.y)},this.cdr.markForCheck())}onMouseUp(e){this.isDragging=!1,this.updateCursor()}onWheel(e){e.preventDefault();let t=e.deltaY<0?1:-1,r=Math.max(.1,Math.min(3,this.zoomScale+t*.1));this.zoomScale=r;let a=Math.round(r*100);this.zoomChanged.emit(a),this.cdr.markForCheck()}retryLoading(){this.errorMessage=null,this.loadElements()}setZoomLevel(e){this.zoomScale=e/100,this.cdr.markForCheck()}zoomIn(){let e=Math.min(3,this.zoomScale+.1);this.zoomScale=e,this.zoomChanged.emit(Math.round(e*100)),this.cdr.markForCheck()}zoomOut(){let e=Math.max(.1,this.zoomScale-.1);this.zoomScale=e,this.zoomChanged.emit(Math.round(e*100)),this.cdr.markForCheck()}fitToScreen(){this.zoomScale=1,this.panOffset={x:0,y:0},this.zoomChanged.emit(100),this.cdr.markForCheck()}centerMap(e){if(!this.mapContainerEl||!this.mapContainerEl.nativeElement){this.logger.warn("Contenedor del mapa no disponible para centrar.");return}let t=this.width/2,n=this.height/2;this.panOffset={x:t-e[0]*this.zoomScale,y:n-e[1]*this.zoomScale},this.lastPanOffset=k({},this.panOffset),this.refreshMap(),this.logger.debug(`Mapa centrado en [${e[0]}, ${e[1]}] con panOffset:`,this.panOffset),this.cdr.markForCheck()}static{this.\u0275fac=function(t){return new(t||o)(A(Qt))}}static{this.\u0275cmp=Y({type:o,selectors:[["app-map-view"]],viewQuery:function(t,n){if(t&1&&(gt(Ku,7),gt(qu,7)),t&2){let r;ut(r=ht())&&(n.mapContainerEl=r.first),ut(r=ht())&&(n.mapSvgEl=r.first)}},inputs:{activeLayers:"activeLayers",tool:"tool",darkMode:"darkMode",loading:"loading"},outputs:{elementSelected:"elementSelected",connectionSelected:"connectionSelected",zoomChanged:"zoomChanged",mapError:"mapError",mapLoaded:"mapLoaded",cursorPositionChanged:"cursorPositionChanged",measurementComplete:"measurementComplete"},features:[un],decls:11,vars:19,consts:[["mapContainer",""],["mapSvg",""],["tabindex","0",1,"map-view-container",3,"mousedown","mousemove","mouseup","wheel"],["class","loading-overlay fade-in",4,"ngIf"],["class","error-message fade-in",4,"ngIf"],[1,"svg-wrapper"],[1,"map-svg","fade-in"],[1,"grid-container"],[1,"connections-layer"],[1,"elements-layer"],[1,"selection-layer"],[1,"loading-overlay","fade-in"],[3,"diameter"],[1,"error-message","fade-in"],[1,"retry-btn",3,"click"]],template:function(t,n){if(t&1){let r=V();c(0,"div",2,0),y("mousedown",function(l){return b(r),C(n.onMouseDown(l))})("mousemove",function(l){return b(r),C(n.onMouseMove(l))})("mouseup",function(l){return b(r),C(n.onMouseUp(l))})("wheel",function(l){return b(r),C(n.onWheel(l))}),E(2,Qu,4,1,"div",3)(3,Zu,5,1,"div",4),c(4,"div",5),ys(),c(5,"svg",6,1),D(7,"g",7)(8,"g",8)(9,"g",9)(10,"g",10),d()()()}t&2&&(Z("dark-mode",n.isDarkMode)("loading",n.isLoading)("dragging",n.isDragging)("has-error",!!n.errorMessage),m(2),h("ngIf",n.isLoading),m(),h("ngIf",n.errorMessage),m(2),Z("interactive",!n.isLoading&&!n.errorMessage)("has-selection",!!n.selectedElement||!!n.selectedConnection),xe("width",n.width)("height",n.height),m(2),xe("transform","translate("+n.panOffset.x+","+n.panOffset.y+") scale("+n.zoomScale+")"),m(),xe("transform","translate("+n.panOffset.x+","+n.panOffset.y+") scale("+n.zoomScale+")"),m(),xe("transform","translate("+n.panOffset.x+","+n.panOffset.y+") scale("+n.zoomScale+")"))},dependencies:[ee,re,_t,Jt],styles:['@charset "UTF-8";[_ngcontent-%COMP%]:root{--primary-color: #3F51B5;--primary-rgb: 63, 81, 181;--primary-color-hover: rgb(52.4655737705, 67.4557377049, 150.7344262295);--accent-color: #FF4081;--warn-color: #F44336;--background-color: #F5F5F5;--surface-color: #ffffff;--surface-lighter: #f9f9f9;--surface-darker: #eeeeee;--text-color: #212121;--text-secondary-color: hsl(0, 0%, -12.0588235294%);--text-hint-color: hsl(0, 0%, -32.0588235294%);--text-disabled-color: hsl(0, 0%, -52.0588235294%);--primary-contrast-color: white;--accent-contrast-color: white;--warn-contrast-color: white;--olt-color: #4CAF50;--ont-color: #2196F3;--odf-color: #FFC107;--edfa-color: #9C27B0;--splitter-color: #FF5722;--manga-color: #607D8B;--terminal-box-color: #FF9800;--slack-fiber-color: #80DEEA;--spacing-unit: 4px;--spacing-xxs: .125rem;--spacing-xs: .25rem;--spacing-sm: .5rem;--spacing-md: .75rem;--spacing-lg: 1rem;--spacing-xl: 1.5rem;--spacing-xxl: 2rem;--shadow-xs: 0 1px 2px rgba(0,0,0,.05);--shadow-sm: 0 1px 3px rgba(0, 0, 0, .1);--shadow-md: 0 2px 4px rgba(0, 0, 0, .1);--shadow-lg: 0 4px 6px rgba(0, 0, 0, .1);--border-radius-sm: 2px;--border-radius-md: 4px;--border-radius-lg: 8px;--border-radius-round: 50%;--border-color: #e0e0e0;--border-width-normal: 1px;--border-width-strong: 4px;--border-radius-pill: 20px;--border-color-light: rgb(249.5, 249.5, 249.5);--border-color-dark: rgb(198.5, 198.5, 198.5);--color-success: #4caf50;--color-warning: #ff8f00;--color-danger: #c62828;--color-info: #2196F3;--color-neutral: #9e9e9e;--color-success-bg: #e8f5e9;--color-warning-bg: #fff8e1;--color-danger-bg: #ffebee;--color-info-bg: rgb(226.5384615385, 241.5384615385, 253.4615384615);--color-maintenance-bg: #e3f2fd;--status-inactive-fg: #757575;--status-inactive-bg: #f5f5f5;--color-success-contrast: white;--color-warning-contrast: white;--color-danger-contrast: white;--color-info-contrast: #212121;--color-maintenance-contrast: white;--font-family: "Roboto, Segoe UI, sans-serif";--font-size-xxs: .625rem;--font-size-xs: .75rem;--font-size-sm: .875rem;--font-size-md: 1rem;--font-size-lg: 1.125rem;--font-size-xl: 1.25rem;--font-size-xxl: 1.5rem;--font-size-display: 2.5rem;--transition-fast: .15s ease-in-out;--transition-normal: .3s ease-in-out;--transition-slow: .5s ease-in-out;--status-active: #4caf50;--status-inactive: #757575;--status-maintenance: #1565c0;--status-planning: #2196F3;--status-unknown: var(--color-neutral);--status-fault: #c62828;--surface-overlay-light: rgba(255, 255, 255, .85);--surface-overlay-light-strong: rgba(255, 255, 255, .95);--border-color-semitransparent: rgba(0, 0, 0, .1);--primary-bg-subtle: rgba(63, 81, 181, .15);--surface-action-hover: rgb(242.8571428571, 242.8571428571, 242.8571428571);--surface-button: var(--surface-color);--surface-button-hover: var(--surface-action-hover);--text-color-button: var(--text-color);--scrollbar-track-color: #f1f1f1;--scrollbar-thumb-color: #c1c1c1;--scrollbar-thumb-hover-color: #a8a8a8;--z-index-map-base: 1;--z-index-map-elements: 5;--z-index-map-widgets-overlay: 50;--z-index-map-overlay: 100;--z-index-network-design-panels: 900;--z-index-debug-info: 999;--z-index-floating-panel-base: 1000;--z-index-performance-widget: 1000;--z-index-elements-panel: 1001;--z-index-layer-control: 1001;--z-index-sidebar: 1005;--z-index-map-legend: 1005;--z-index-sidebar-mobile: 1010;--z-index-loading-overlay: 1050;--z-index-dialog: 1075;--z-index-toolbar: 1100;--z-index-tooltip: 1150;--z-index-map-controls: 1201;--toolbar-height: 46px;--toolbar-button-height: 30px;--toolbar-button-height-mobile: 32px;--action-button-height: 40px;--menu-item-height: 42px;--icon-size-sm: 18px;--icon-size-md: 20px;--tooltip-bg-color: rgba(33, 33, 33, .95);--primary-ripple-color: rgba(var(--primary-rgb), .1)}[_ngcontent-%COMP%]:root.dark-theme, body.dark-theme[_ngcontent-%COMP%]{--background-color: #121212;--surface-color: #1e1e1e;--surface-lighter: rgb(42.75, 42.75, 42.75);--surface-darker: #121212;--text-color: #e0e0e0;--text-secondary-color: rgb(185.75, 185.75, 185.75);--text-hint-color: rgb(147.5, 147.5, 147.5);--text-disabled-color: rgb(109.25, 109.25, 109.25);--border-color: #444444;--border-color-light: rgb(93.5, 93.5, 93.5);--border-color-dark: rgb(42.5, 42.5, 42.5);--color-success-bg: rgb(51.8181818182, 119.1818181818, 57);--color-warning-bg: rgb(174, 133.4, 0);--color-danger-bg: rgb(184, 0, 27.6);--color-info-bg: rgb(8.9230769231, 95.9230769231, 165.0769230769);--color-maintenance-bg: rgb(11.6, 98.6, 162.4);--shadow-xs: 0 1px 2px rgba(0,0,0,.3);--shadow-sm: 0 1px 3px rgba(0,0,0,.4);--shadow-md: 0 2px 4px rgba(0,0,0,.5);--shadow-lg: 0 4px 6px rgba(0,0,0,.5);--surface-overlay-light: rgba(40, 40, 40, .85);--surface-overlay-light-strong: rgba(30, 30, 30, .95);--border-color-semitransparent: rgba(255, 255, 255, .1);--status-inactive-fg: hsl(0, 0%, 100.8823529412%);--status-inactive-bg: #383838;--primary-bg-subtle: rgba(63, 81, 181, .25);--surface-action-hover: rgb(55.5, 55.5, 55.5);--surface-button: var(--surface-color);--surface-button-hover: var(--surface-action-hover);--text-color-button: var(--text-color);--scrollbar-track-color: #333333;--scrollbar-thumb-color: #666666;--scrollbar-thumb-hover-color: #888888}.standard-panel-ui[_ngcontent-%COMP%]{background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-lg);overflow:hidden;display:flex;flex-direction:column}.standard-panel-ui[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-md);background-color:var(--surface-lighter);border-bottom:1px solid var(--border-color)}.standard-panel-ui[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:var(--font-size-md);font-weight:500;color:var(--text-color)}.standard-panel-ui[_ngcontent-%COMP%]   .panel-content[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-content[_ngcontent-%COMP%]{padding:var(--spacing-md);flex-grow:1;overflow-y:auto;color:var(--text-color)}.standard-panel-ui[_ngcontent-%COMP%]   .panel-actions[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:var(--spacing-sm);padding:var(--spacing-sm) var(--spacing-md);border-top:1px solid var(--border-color)}.standard-panel-ui[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]{display:flex;margin-bottom:var(--spacing-sm)}.standard-panel-ui[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]   .info-label[_ngcontent-%COMP%]{width:100px;font-weight:500;color:var(--text-secondary-color)}.standard-panel-ui[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]   .info-value[_ngcontent-%COMP%]{flex:1;color:var(--text-color)}.simple-panel-ui[_ngcontent-%COMP%]{background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-lg);padding:var(--spacing-md);color:var(--text-color)}.side-panel[_ngcontent-%COMP%]{background-color:var(--surface-color);border-radius:var(--border-radius-sm, 4px);box-shadow:var(--shadow-sm, 0 2px 10px rgba(0, 0, 0, .08));height:100%;width:var(--side-panel-width, 320px);display:flex;flex-direction:column;overflow:hidden}@media (max-width: 768px){.side-panel[_ngcontent-%COMP%]{width:var(--side-panel-width-tablet, 280px)}}@media (max-width: 600px){.side-panel[_ngcontent-%COMP%]{width:var(--side-panel-width-mobile, 100%);max-width:100vw}}.side-panel[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%]{height:var(--panel-header-height, 44px);min-height:var(--panel-header-height, 44px);display:flex;align-items:center;justify-content:space-between;padding:0 var(--spacing-sm);border-bottom:1px solid var(--border-color, rgba(0, 0, 0, .1))}.side-panel[_ngcontent-%COMP%]   .panel-content[_ngcontent-%COMP%]{flex:1;overflow:auto}.map-base-container[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;overflow:hidden;background-color:var(--background-color);transition:background-color var(--transition-normal)}.network-design[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}.network-design__toolbar[_ngcontent-%COMP%]{padding:0 var(--spacing-md);background-color:var(--primary-color);color:var(--primary-contrast-color);box-shadow:var(--shadow-md)}.network-design__header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-md);background-color:var(--primary-color);color:var(--primary-contrast-color);box-shadow:var(--shadow-md)}.network-design__header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:var(--font-size-xl);font-weight:500}.network-design__main[_ngcontent-%COMP%]{flex:1;display:flex;overflow:hidden;position:relative;padding:var(--spacing-md);background-color:var(--surface-color)}@media (max-width: 768px){.network-design__main[_ngcontent-%COMP%]{margin-left:0;padding:var(--spacing-sm)}}.network-design__main[_ngcontent-%COMP%]   .network-design__map[_ngcontent-%COMP%]{flex:1;position:relative;border-radius:var(--border-radius-md);overflow:hidden;box-shadow:var(--shadow-md);background-color:var(--surface-darker)}.network-design__main[_ngcontent-%COMP%]   .network-design__sidebar[_ngcontent-%COMP%]{width:300px;padding:var(--spacing-md);background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-md);margin-left:var(--spacing-md);overflow-y:auto;border-right:1px solid var(--border-color)}@media (max-width: 768px){.network-design__main[_ngcontent-%COMP%]   .network-design__sidebar[_ngcontent-%COMP%]{width:100%;position:fixed;top:0;left:0;height:100%;z-index:1000;transform:translate(-100%);transition:transform var(--transition-normal);margin-left:0;border-right:none}.network-design__main[_ngcontent-%COMP%]   .network-design__sidebar--open[_ngcontent-%COMP%]{transform:translate(0)}}.network-design__footer[_ngcontent-%COMP%]{padding:var(--spacing-md);background-color:var(--surface-lighter);border-top:1px solid var(--border-color);font-size:var(--font-size-sm);color:var(--text-color)}.network-design__element[_ngcontent-%COMP%]{padding:var(--spacing-md);margin-bottom:var(--spacing-md);background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-sm);transition:box-shadow var(--transition-fast)}.network-design__element[_ngcontent-%COMP%]:hover{box-shadow:var(--shadow-md)}.network-design__element--selected[_ngcontent-%COMP%]{border-left:4px solid var(--primary-color)}.status-badge-base[_ngcontent-%COMP%], .status-maintenance[_ngcontent-%COMP%], .status-warning[_ngcontent-%COMP%], .status-fault[_ngcontent-%COMP%], .status-inactive[_ngcontent-%COMP%], .status-active[_ngcontent-%COMP%]{display:inline-block;padding:var(--spacing-xs) var(--spacing-sm);border-radius:var(--border-radius-sm);font-size:var(--font-size-sm);font-weight:500}.status-active[_ngcontent-%COMP%]{background-color:var(--color-success-bg);color:var(--color-success-contrast)}.status-inactive[_ngcontent-%COMP%]{background-color:var(--status-inactive-bg);color:var(--status-inactive-fg)}.status-fault[_ngcontent-%COMP%]{background-color:var(--color-danger-bg);color:var(--color-danger-contrast)}.status-warning[_ngcontent-%COMP%]{background-color:var(--color-warning-bg);color:var(--color-warning-contrast)}.status-maintenance[_ngcontent-%COMP%]{background-color:var(--color-maintenance-bg);color:var(--color-maintenance-contrast)}.network-utils__status-badge[_ngcontent-%COMP%]{display:inline-block;padding:var(--spacing-xs) var(--spacing-sm);border-radius:var(--border-radius-sm);font-size:var(--font-size-xs);font-weight:500;text-transform:uppercase}.network-utils__status-badge--active[_ngcontent-%COMP%]{background-color:var(--color-success-bg);color:var(--color-success-contrast)}.network-utils__status-badge--inactive[_ngcontent-%COMP%]{background-color:var(--status-inactive-bg);color:var(--status-inactive-fg)}.network-utils__status-badge--maintenance[_ngcontent-%COMP%]{background-color:var(--color-maintenance-bg);color:var(--color-maintenance-contrast)}.network-utils__loading[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:var(--spacing-lg);color:var(--text-color)}.network-utils__error[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-md);background-color:#ffebee;color:var(--color-danger);border-radius:var(--border-radius-md)}.map-view-container[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;overflow:hidden;background-color:var(--surface-level-1, #f5f5f5);cursor:grab;display:block!important}.map-view-container.loading[_ngcontent-%COMP%]{cursor:wait}.map-view-container.dragging[_ngcontent-%COMP%]{cursor:grabbing}.svg-wrapper[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;top:0;left:0;overflow:hidden;display:block!important}.map-svg[_ngcontent-%COMP%]{width:100%;height:100%;display:block!important;position:absolute;top:0;left:0;touch-action:none;z-index:1;background-color:#fff}.loading-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;background-color:var(--surface-overlay-light, rgba(255, 255, 255, .7));z-index:10;opacity:0;transition:opacity var(--transition-normal, .3s) ease-out,z-index 0s var(--transition-normal, .3s);pointer-events:none}.map-view-container.loading[_ngcontent-%COMP%]   .loading-overlay[_ngcontent-%COMP%]{opacity:1;z-index:10;transition:opacity var(--transition-normal, .3s) ease-in;pointer-events:all}.error-message[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);padding:var(--spacing-lg, 20px);background-color:var(--color-danger-bg-strong, rgba(244, 67, 54, .9));color:var(--color-danger-contrast, white);border-radius:var(--border-radius-md, 4px);text-align:center;z-index:11}.error-message[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:var(--spacing-sm, 10px);padding:var(--spacing-xs, 8px) var(--spacing-md, 16px);background-color:var(--surface-color, white);color:var(--color-danger, #f44336);border:none;border-radius:var(--border-radius-md, 4px);cursor:pointer}.grid-container[_ngcontent-%COMP%]   line[_ngcontent-%COMP%]{stroke:var(--grid-line-color, #aaa);stroke-width:1;opacity:.7}.grid-container[_ngcontent-%COMP%]   .grid-axis[_ngcontent-%COMP%]{stroke:var(--grid-axis-color, #666);stroke-width:2;opacity:.9}.connections-layer[_ngcontent-%COMP%]   path[_ngcontent-%COMP%], .connections-layer[_ngcontent-%COMP%]   line[_ngcontent-%COMP%]{stroke-width:var(--connection-stroke-width, 3);fill:none;opacity:.8}.elements-layer[_ngcontent-%COMP%]   circle[_ngcontent-%COMP%], .elements-layer[_ngcontent-%COMP%]   rect[_ngcontent-%COMP%], .elements-layer[_ngcontent-%COMP%]   polygon[_ngcontent-%COMP%]{stroke:var(--element-stroke-color, #333);stroke-width:var(--element-stroke-width, 1.5);fill-opacity:.9}.selection-layer[_ngcontent-%COMP%]   .selection-indicator[_ngcontent-%COMP%]{stroke:var(--selection-highlight-color, #2196F3);stroke-width:var(--selection-stroke-width, 3);stroke-dasharray:5;fill:none;opacity:1}.fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-in-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.pulse-effect[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse 1.5s infinite}@keyframes _ngcontent-%COMP%_pulse{0%{transform:scale(1);opacity:1}50%{transform:scale(1.05);opacity:.8}to{transform:scale(1);opacity:1}}[_nghost-%COMP%]{display:block!important;width:100%;height:100%;position:relative}[_nghost-%COMP%]   .elements-layer[_ngcontent-%COMP%]   .network-element[_ngcontent-%COMP%]{cursor:pointer;transition:transform .2s ease-in-out}[_nghost-%COMP%]   .elements-layer[_ngcontent-%COMP%]   .network-element[_ngcontent-%COMP%]:hover{transform:scale(1.1)}[_nghost-%COMP%]   .connections-layer[_ngcontent-%COMP%]   .connection-line[_ngcontent-%COMP%]{stroke-width:3;transition:stroke-width .2s ease-in-out}[_nghost-%COMP%]   .connections-layer[_ngcontent-%COMP%]   .connection-line[_ngcontent-%COMP%]:hover{stroke-width:4}'],changeDetection:0})}}return o})();function td(o){let i=o.cloneNode(!0),e=i.querySelectorAll("[id]"),t=o.nodeName.toLowerCase();i.removeAttribute("id");for(let n=0;n<e.length;n++)e[n].removeAttribute("id");return t==="canvas"?Gc(o,i):(t==="input"||t==="select"||t==="textarea")&&Uc(o,i),jc("canvas",o,i,Gc),jc("input, textarea, select",o,i,Uc),i}function jc(o,i,e,t){let n=i.querySelectorAll(o);if(n.length){let r=e.querySelectorAll(o);for(let a=0;a<n.length;a++)t(n[a],r[a])}}var Yu=0;function Uc(o,i){i.type!=="file"&&(i.value=o.value),i.type==="radio"&&i.name&&(i.name=`mat-clone-${i.name}-${Yu++}`)}function Gc(o,i){let e=i.getContext("2d");if(e)try{e.drawImage(o,0,0)}catch{}}function ia(o){let i=o.getBoundingClientRect();return{top:i.top,right:i.right,bottom:i.bottom,left:i.left,width:i.width,height:i.height,x:i.x,y:i.y}}function Yr(o,i,e){let{top:t,bottom:n,left:r,right:a}=o;return e>=t&&e<=n&&i>=r&&i<=a}function Ai(o,i,e){o.top+=i,o.bottom=o.top+o.height,o.left+=e,o.right=o.left+o.width}function Hc(o,i,e,t){let{top:n,right:r,bottom:a,left:l,width:u,height:g}=o,_=u*i,f=g*i;return t>n-f&&t<a+f&&e>l-_&&e<r+_}var Vo=class{_document;positions=new Map;constructor(i){this._document=i}clear(){this.positions.clear()}cache(i){this.clear(),this.positions.set(this._document,{scrollPosition:this.getViewportScrollPosition()}),i.forEach(e=>{this.positions.set(e,{scrollPosition:{top:e.scrollTop,left:e.scrollLeft},clientRect:ia(e)})})}handleScroll(i){let e=yi(i),t=this.positions.get(e);if(!t)return null;let n=t.scrollPosition,r,a;if(e===this._document){let g=this.getViewportScrollPosition();r=g.top,a=g.left}else r=e.scrollTop,a=e.scrollLeft;let l=n.top-r,u=n.left-a;return this.positions.forEach((g,_)=>{g.clientRect&&e!==_&&e.contains(_)&&Ai(g.clientRect,l,u)}),n.top=r,n.left=a,{top:l,left:u}}getViewportScrollPosition(){return{top:window.scrollY,left:window.scrollX}}};function nd(o,i){let e=o.rootNodes;if(e.length===1&&e[0].nodeType===i.ELEMENT_NODE)return e[0];let t=i.createElement("div");return e.forEach(n=>t.appendChild(n)),t}function oa(o,i,e){for(let t in i)if(i.hasOwnProperty(t)){let n=i[t];n?o.setProperty(t,n,e?.has(t)?"important":""):o.removeProperty(t)}return o}function li(o,i){let e=i?"":"none";oa(o.style,{"touch-action":i?"":"none","-webkit-user-drag":i?"":"none","-webkit-tap-highlight-color":i?"":"transparent","user-select":e,"-ms-user-select":e,"-webkit-user-select":e,"-moz-user-select":e})}function Wc(o,i,e){oa(o.style,{position:i?"":"fixed",top:i?"":"0",opacity:i?"":"0",left:i?"":"-999em"},e)}function $o(o,i){return i&&i!="none"?o+" "+i:o}function Kc(o,i){o.style.width=`${i.width}px`,o.style.height=`${i.height}px`,o.style.transform=jo(i.left,i.top)}function jo(o,i){return`translate3d(${Math.round(o)}px, ${Math.round(i)}px, 0)`}function qc(o){let i=o.toLowerCase().indexOf("ms")>-1?1:1e3;return parseFloat(o)*i}function Xu(o){let i=getComputedStyle(o),e=Qr(i,"transition-property"),t=e.find(l=>l==="transform"||l==="all");if(!t)return 0;let n=e.indexOf(t),r=Qr(i,"transition-duration"),a=Qr(i,"transition-delay");return qc(r[n])+qc(a[n])}function Qr(o,i){return o.getPropertyValue(i).split(",").map(t=>t.trim())}var Ju=new Set(["position"]),Xr=class{_document;_rootElement;_direction;_initialDomRect;_previewTemplate;_previewClass;_pickupPositionOnPage;_initialTransform;_zIndex;_renderer;_previewEmbeddedView;_preview;get element(){return this._preview}constructor(i,e,t,n,r,a,l,u,g,_){this._document=i,this._rootElement=e,this._direction=t,this._initialDomRect=n,this._previewTemplate=r,this._previewClass=a,this._pickupPositionOnPage=l,this._initialTransform=u,this._zIndex=g,this._renderer=_}attach(i){this._preview=this._createPreview(),i.appendChild(this._preview),Qc(this._preview)&&this._preview.showPopover()}destroy(){this._preview.remove(),this._previewEmbeddedView?.destroy(),this._preview=this._previewEmbeddedView=null}setTransform(i){this._preview.style.transform=i}getBoundingClientRect(){return this._preview.getBoundingClientRect()}addClass(i){this._preview.classList.add(i)}getTransitionDuration(){return Xu(this._preview)}addEventListener(i,e){return this._renderer.listen(this._preview,i,e)}_createPreview(){let i=this._previewTemplate,e=this._previewClass,t=i?i.template:null,n;if(t&&i){let r=i.matchSize?this._initialDomRect:null,a=i.viewContainer.createEmbeddedView(t,i.context);a.detectChanges(),n=nd(a,this._document),this._previewEmbeddedView=a,i.matchSize?Kc(n,r):n.style.transform=jo(this._pickupPositionOnPage.x,this._pickupPositionOnPage.y)}else n=td(this._rootElement),Kc(n,this._initialDomRect),this._initialTransform&&(n.style.transform=this._initialTransform);return oa(n.style,{"pointer-events":"none",margin:Qc(n)?"0 auto 0 0":"0",position:"fixed",top:"0",left:"0","z-index":this._zIndex+""},Ju),li(n,!1),n.classList.add("cdk-drag-preview"),n.setAttribute("popover","manual"),n.setAttribute("dir",this._direction),e&&(Array.isArray(e)?e.forEach(r=>n.classList.add(r)):n.classList.add(e)),n}};function Qc(o){return"showPopover"in o}var eh={passive:!0},Zc={passive:!1},th={passive:!1,capture:!0},nh=800,Yc=new Set(["position"]),Jr=class{_config;_document;_ngZone;_viewportRuler;_dragDropRegistry;_renderer;_rootElementCleanups;_cleanupShadowRootSelectStart;_preview;_previewContainer;_placeholderRef;_placeholder;_pickupPositionInElement;_pickupPositionOnPage;_anchor;_passiveTransform={x:0,y:0};_activeTransform={x:0,y:0};_initialTransform;_hasStartedDragging=Ge(!1);_hasMoved;_initialContainer;_initialIndex;_parentPositions;_moveEvents=new N;_pointerDirectionDelta;_pointerPositionAtLastDirectionChange;_lastKnownPointerPosition;_rootElement;_ownerSVGElement;_rootElementTapHighlight;_pointerMoveSubscription=qt.EMPTY;_pointerUpSubscription=qt.EMPTY;_scrollSubscription=qt.EMPTY;_resizeSubscription=qt.EMPTY;_lastTouchEventTime;_dragStartTime;_boundaryElement=null;_nativeInteractionsEnabled=!0;_initialDomRect;_previewRect;_boundaryRect;_previewTemplate;_placeholderTemplate;_handles=[];_disabledHandles=new Set;_dropContainer;_direction="ltr";_parentDragRef;_cachedShadowRoot;lockAxis;dragStartDelay=0;previewClass;scale=1;get disabled(){return this._disabled||!!(this._dropContainer&&this._dropContainer.disabled)}set disabled(i){i!==this._disabled&&(this._disabled=i,this._toggleNativeDragInteractions(),this._handles.forEach(e=>li(e,i)))}_disabled=!1;beforeStarted=new N;started=new N;released=new N;ended=new N;entered=new N;exited=new N;dropped=new N;moved=this._moveEvents;data;constrainPosition;constructor(i,e,t,n,r,a,l){this._config=e,this._document=t,this._ngZone=n,this._viewportRuler=r,this._dragDropRegistry=a,this._renderer=l,this.withRootElement(i).withParent(e.parentDragRef||null),this._parentPositions=new Vo(t),a.registerDragItem(this)}getPlaceholderElement(){return this._placeholder}getRootElement(){return this._rootElement}getVisibleElement(){return this.isDragging()?this.getPlaceholderElement():this.getRootElement()}withHandles(i){this._handles=i.map(t=>Xt(t)),this._handles.forEach(t=>li(t,this.disabled)),this._toggleNativeDragInteractions();let e=new Set;return this._disabledHandles.forEach(t=>{this._handles.indexOf(t)>-1&&e.add(t)}),this._disabledHandles=e,this}withPreviewTemplate(i){return this._previewTemplate=i,this}withPlaceholderTemplate(i){return this._placeholderTemplate=i,this}withRootElement(i){let e=Xt(i);return e!==this._rootElement&&(this._removeRootElementListeners(),this._rootElementCleanups=this._ngZone.runOutsideAngular(()=>[Yt(this._renderer,e,"mousedown",this._pointerDown,Zc),Yt(this._renderer,e,"touchstart",this._pointerDown,eh),Yt(this._renderer,e,"dragstart",this._nativeDragStart,Zc)]),this._initialTransform=void 0,this._rootElement=e),typeof SVGElement<"u"&&this._rootElement instanceof SVGElement&&(this._ownerSVGElement=this._rootElement.ownerSVGElement),this}withBoundaryElement(i){return this._boundaryElement=i?Xt(i):null,this._resizeSubscription.unsubscribe(),i&&(this._resizeSubscription=this._viewportRuler.change(10).subscribe(()=>this._containInsideBoundaryOnResize())),this}withParent(i){return this._parentDragRef=i,this}dispose(){this._removeRootElementListeners(),this.isDragging()&&this._rootElement?.remove(),this._anchor?.remove(),this._destroyPreview(),this._destroyPlaceholder(),this._dragDropRegistry.removeDragItem(this),this._removeListeners(),this.beforeStarted.complete(),this.started.complete(),this.released.complete(),this.ended.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this._moveEvents.complete(),this._handles=[],this._disabledHandles.clear(),this._dropContainer=void 0,this._resizeSubscription.unsubscribe(),this._parentPositions.clear(),this._boundaryElement=this._rootElement=this._ownerSVGElement=this._placeholderTemplate=this._previewTemplate=this._anchor=this._parentDragRef=null}isDragging(){return this._hasStartedDragging()&&this._dragDropRegistry.isDragging(this)}reset(){this._rootElement.style.transform=this._initialTransform||"",this._activeTransform={x:0,y:0},this._passiveTransform={x:0,y:0}}disableHandle(i){!this._disabledHandles.has(i)&&this._handles.indexOf(i)>-1&&(this._disabledHandles.add(i),li(i,!0))}enableHandle(i){this._disabledHandles.has(i)&&(this._disabledHandles.delete(i),li(i,this.disabled))}withDirection(i){return this._direction=i,this}_withDropContainer(i){this._dropContainer=i}getFreeDragPosition(){let i=this.isDragging()?this._activeTransform:this._passiveTransform;return{x:i.x,y:i.y}}setFreeDragPosition(i){return this._activeTransform={x:0,y:0},this._passiveTransform.x=i.x,this._passiveTransform.y=i.y,this._dropContainer||this._applyRootElementTransform(i.x,i.y),this}withPreviewContainer(i){return this._previewContainer=i,this}_sortFromLastPointerPosition(){let i=this._lastKnownPointerPosition;i&&this._dropContainer&&this._updateActiveDropContainer(this._getConstrainedPointerPosition(i),i)}_removeListeners(){this._pointerMoveSubscription.unsubscribe(),this._pointerUpSubscription.unsubscribe(),this._scrollSubscription.unsubscribe(),this._cleanupShadowRootSelectStart?.(),this._cleanupShadowRootSelectStart=void 0}_destroyPreview(){this._preview?.destroy(),this._preview=null}_destroyPlaceholder(){this._placeholder?.remove(),this._placeholderRef?.destroy(),this._placeholder=this._placeholderRef=null}_pointerDown=i=>{if(this.beforeStarted.next(),this._handles.length){let e=this._getTargetHandle(i);e&&!this._disabledHandles.has(e)&&!this.disabled&&this._initializeDragSequence(e,i)}else this.disabled||this._initializeDragSequence(this._rootElement,i)};_pointerMove=i=>{let e=this._getPointerPositionOnPage(i);if(!this._hasStartedDragging()){let n=Math.abs(e.x-this._pickupPositionOnPage.x),r=Math.abs(e.y-this._pickupPositionOnPage.y);if(n+r>=this._config.dragStartThreshold){let l=Date.now()>=this._dragStartTime+this._getDragStartDelay(i),u=this._dropContainer;if(!l){this._endDragSequence(i);return}(!u||!u.isDragging()&&!u.isReceiving())&&(i.cancelable&&i.preventDefault(),this._hasStartedDragging.set(!0),this._ngZone.run(()=>this._startDragSequence(i)))}return}i.cancelable&&i.preventDefault();let t=this._getConstrainedPointerPosition(e);if(this._hasMoved=!0,this._lastKnownPointerPosition=e,this._updatePointerDirectionDelta(t),this._dropContainer)this._updateActiveDropContainer(t,e);else{let n=this.constrainPosition?this._initialDomRect:this._pickupPositionOnPage,r=this._activeTransform;r.x=t.x-n.x+this._passiveTransform.x,r.y=t.y-n.y+this._passiveTransform.y,this._applyRootElementTransform(r.x,r.y)}this._moveEvents.observers.length&&this._ngZone.run(()=>{this._moveEvents.next({source:this,pointerPosition:t,event:i,distance:this._getDragDistance(t),delta:this._pointerDirectionDelta})})};_pointerUp=i=>{this._endDragSequence(i)};_endDragSequence(i){if(this._dragDropRegistry.isDragging(this)&&(this._removeListeners(),this._dragDropRegistry.stopDragging(this),this._toggleNativeDragInteractions(),this._handles&&(this._rootElement.style.webkitTapHighlightColor=this._rootElementTapHighlight),!!this._hasStartedDragging()))if(this.released.next({source:this,event:i}),this._dropContainer)this._dropContainer._stopScrolling(),this._animatePreviewToPlaceholder().then(()=>{this._cleanupDragArtifacts(i),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)});else{this._passiveTransform.x=this._activeTransform.x;let e=this._getPointerPositionOnPage(i);this._passiveTransform.y=this._activeTransform.y,this._ngZone.run(()=>{this.ended.next({source:this,distance:this._getDragDistance(e),dropPoint:e,event:i})}),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)}}_startDragSequence(i){Ii(i)&&(this._lastTouchEventTime=Date.now()),this._toggleNativeDragInteractions();let e=this._getShadowRoot(),t=this._dropContainer;if(e&&this._ngZone.runOutsideAngular(()=>{this._cleanupShadowRootSelectStart=Yt(this._renderer,e,"selectstart",ih,th)}),t){let n=this._rootElement,r=n.parentNode,a=this._placeholder=this._createPlaceholderElement(),l=this._anchor=this._anchor||this._document.createComment("");r.insertBefore(l,n),this._initialTransform=n.style.transform||"",this._preview=new Xr(this._document,this._rootElement,this._direction,this._initialDomRect,this._previewTemplate||null,this.previewClass||null,this._pickupPositionOnPage,this._initialTransform,this._config.zIndex||1e3,this._renderer),this._preview.attach(this._getPreviewInsertionPoint(r,e)),Wc(n,!1,Yc),this._document.body.appendChild(r.replaceChild(a,n)),this.started.next({source:this,event:i}),t.start(),this._initialContainer=t,this._initialIndex=t.getItemIndex(this)}else this.started.next({source:this,event:i}),this._initialContainer=this._initialIndex=void 0;this._parentPositions.cache(t?t.getScrollableParents():[])}_initializeDragSequence(i,e){this._parentDragRef&&e.stopPropagation();let t=this.isDragging(),n=Ii(e),r=!n&&e.button!==0,a=this._rootElement,l=yi(e),u=!n&&this._lastTouchEventTime&&this._lastTouchEventTime+nh>Date.now(),g=n?Ks(e):Ws(e);if(l&&l.draggable&&e.type==="mousedown"&&e.preventDefault(),t||r||u||g)return;if(this._handles.length){let S=a.style;this._rootElementTapHighlight=S.webkitTapHighlightColor||"",S.webkitTapHighlightColor="transparent"}this._hasMoved=!1,this._hasStartedDragging.set(this._hasMoved),this._removeListeners(),this._initialDomRect=this._rootElement.getBoundingClientRect(),this._pointerMoveSubscription=this._dragDropRegistry.pointerMove.subscribe(this._pointerMove),this._pointerUpSubscription=this._dragDropRegistry.pointerUp.subscribe(this._pointerUp),this._scrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(S=>this._updateOnScroll(S)),this._boundaryElement&&(this._boundaryRect=ia(this._boundaryElement));let _=this._previewTemplate;this._pickupPositionInElement=_&&_.template&&!_.matchSize?{x:0,y:0}:this._getPointerPositionInElement(this._initialDomRect,i,e);let f=this._pickupPositionOnPage=this._lastKnownPointerPosition=this._getPointerPositionOnPage(e);this._pointerDirectionDelta={x:0,y:0},this._pointerPositionAtLastDirectionChange={x:f.x,y:f.y},this._dragStartTime=Date.now(),this._dragDropRegistry.startDragging(this,e)}_cleanupDragArtifacts(i){Wc(this._rootElement,!0,Yc),this._anchor.parentNode.replaceChild(this._rootElement,this._anchor),this._destroyPreview(),this._destroyPlaceholder(),this._initialDomRect=this._boundaryRect=this._previewRect=this._initialTransform=void 0,this._ngZone.run(()=>{let e=this._dropContainer,t=e.getItemIndex(this),n=this._getPointerPositionOnPage(i),r=this._getDragDistance(n),a=e._isOverContainer(n.x,n.y);this.ended.next({source:this,distance:r,dropPoint:n,event:i}),this.dropped.next({item:this,currentIndex:t,previousIndex:this._initialIndex,container:e,previousContainer:this._initialContainer,isPointerOverContainer:a,distance:r,dropPoint:n,event:i}),e.drop(this,t,this._initialIndex,this._initialContainer,a,r,n,i),this._dropContainer=this._initialContainer})}_updateActiveDropContainer({x:i,y:e},{x:t,y:n}){let r=this._initialContainer._getSiblingContainerFromPosition(this,i,e);!r&&this._dropContainer!==this._initialContainer&&this._initialContainer._isOverContainer(i,e)&&(r=this._initialContainer),r&&r!==this._dropContainer&&this._ngZone.run(()=>{this.exited.next({item:this,container:this._dropContainer}),this._dropContainer.exit(this),this._dropContainer=r,this._dropContainer.enter(this,i,e,r===this._initialContainer&&r.sortingDisabled?this._initialIndex:void 0),this.entered.next({item:this,container:r,currentIndex:r.getItemIndex(this)})}),this.isDragging()&&(this._dropContainer._startScrollingIfNecessary(t,n),this._dropContainer._sortItem(this,i,e,this._pointerDirectionDelta),this.constrainPosition?this._applyPreviewTransform(i,e):this._applyPreviewTransform(i-this._pickupPositionInElement.x,e-this._pickupPositionInElement.y))}_animatePreviewToPlaceholder(){if(!this._hasMoved)return Promise.resolve();let i=this._placeholder.getBoundingClientRect();this._preview.addClass("cdk-drag-animating"),this._applyPreviewTransform(i.left,i.top);let e=this._preview.getTransitionDuration();return e===0?Promise.resolve():this._ngZone.runOutsideAngular(()=>new Promise(t=>{let n=l=>{(!l||this._preview&&yi(l)===this._preview.element&&l.propertyName==="transform")&&(a(),t(),clearTimeout(r))},r=setTimeout(n,e*1.5),a=this._preview.addEventListener("transitionend",n)}))}_createPlaceholderElement(){let i=this._placeholderTemplate,e=i?i.template:null,t;return e?(this._placeholderRef=i.viewContainer.createEmbeddedView(e,i.context),this._placeholderRef.detectChanges(),t=nd(this._placeholderRef,this._document)):t=td(this._rootElement),t.style.pointerEvents="none",t.classList.add("cdk-drag-placeholder"),t}_getPointerPositionInElement(i,e,t){let n=e===this._rootElement?null:e,r=n?n.getBoundingClientRect():i,a=Ii(t)?t.targetTouches[0]:t,l=this._getViewportScrollPosition(),u=a.pageX-r.left-l.left,g=a.pageY-r.top-l.top;return{x:r.left-i.left+u,y:r.top-i.top+g}}_getPointerPositionOnPage(i){let e=this._getViewportScrollPosition(),t=Ii(i)?i.touches[0]||i.changedTouches[0]||{pageX:0,pageY:0}:i,n=t.pageX-e.left,r=t.pageY-e.top;if(this._ownerSVGElement){let a=this._ownerSVGElement.getScreenCTM();if(a){let l=this._ownerSVGElement.createSVGPoint();return l.x=n,l.y=r,l.matrixTransform(a.inverse())}}return{x:n,y:r}}_getConstrainedPointerPosition(i){let e=this._dropContainer?this._dropContainer.lockAxis:null,{x:t,y:n}=this.constrainPosition?this.constrainPosition(i,this,this._initialDomRect,this._pickupPositionInElement):i;if(this.lockAxis==="x"||e==="x"?n=this._pickupPositionOnPage.y-(this.constrainPosition?this._pickupPositionInElement.y:0):(this.lockAxis==="y"||e==="y")&&(t=this._pickupPositionOnPage.x-(this.constrainPosition?this._pickupPositionInElement.x:0)),this._boundaryRect){let{x:r,y:a}=this.constrainPosition?{x:0,y:0}:this._pickupPositionInElement,l=this._boundaryRect,{width:u,height:g}=this._getPreviewRect(),_=l.top+a,f=l.bottom-(g-a),S=l.left+r,T=l.right-(u-r);t=Xc(t,S,T),n=Xc(n,_,f)}return{x:t,y:n}}_updatePointerDirectionDelta(i){let{x:e,y:t}=i,n=this._pointerDirectionDelta,r=this._pointerPositionAtLastDirectionChange,a=Math.abs(e-r.x),l=Math.abs(t-r.y);return a>this._config.pointerDirectionChangeThreshold&&(n.x=e>r.x?1:-1,r.x=e),l>this._config.pointerDirectionChangeThreshold&&(n.y=t>r.y?1:-1,r.y=t),n}_toggleNativeDragInteractions(){if(!this._rootElement||!this._handles)return;let i=this._handles.length>0||!this.isDragging();i!==this._nativeInteractionsEnabled&&(this._nativeInteractionsEnabled=i,li(this._rootElement,i))}_removeRootElementListeners(){this._rootElementCleanups?.forEach(i=>i()),this._rootElementCleanups=void 0}_applyRootElementTransform(i,e){let t=1/this.scale,n=jo(i*t,e*t),r=this._rootElement.style;this._initialTransform==null&&(this._initialTransform=r.transform&&r.transform!="none"?r.transform:""),r.transform=$o(n,this._initialTransform)}_applyPreviewTransform(i,e){let t=this._previewTemplate?.template?void 0:this._initialTransform,n=jo(i,e);this._preview.setTransform($o(n,t))}_getDragDistance(i){let e=this._pickupPositionOnPage;return e?{x:i.x-e.x,y:i.y-e.y}:{x:0,y:0}}_cleanupCachedDimensions(){this._boundaryRect=this._previewRect=void 0,this._parentPositions.clear()}_containInsideBoundaryOnResize(){let{x:i,y:e}=this._passiveTransform;if(i===0&&e===0||this.isDragging()||!this._boundaryElement)return;let t=this._rootElement.getBoundingClientRect(),n=this._boundaryElement.getBoundingClientRect();if(n.width===0&&n.height===0||t.width===0&&t.height===0)return;let r=n.left-t.left,a=t.right-n.right,l=n.top-t.top,u=t.bottom-n.bottom;n.width>t.width?(r>0&&(i+=r),a>0&&(i-=a)):i=0,n.height>t.height?(l>0&&(e+=l),u>0&&(e-=u)):e=0,(i!==this._passiveTransform.x||e!==this._passiveTransform.y)&&this.setFreeDragPosition({y:e,x:i})}_getDragStartDelay(i){let e=this.dragStartDelay;return typeof e=="number"?e:Ii(i)?e.touch:e?e.mouse:0}_updateOnScroll(i){let e=this._parentPositions.handleScroll(i);if(e){let t=yi(i);this._boundaryRect&&t!==this._boundaryElement&&t.contains(this._boundaryElement)&&Ai(this._boundaryRect,e.top,e.left),this._pickupPositionOnPage.x+=e.left,this._pickupPositionOnPage.y+=e.top,this._dropContainer||(this._activeTransform.x-=e.left,this._activeTransform.y-=e.top,this._applyRootElementTransform(this._activeTransform.x,this._activeTransform.y))}}_getViewportScrollPosition(){return this._parentPositions.positions.get(this._document)?.scrollPosition||this._parentPositions.getViewportScrollPosition()}_getShadowRoot(){return this._cachedShadowRoot===void 0&&(this._cachedShadowRoot=eo(this._rootElement)),this._cachedShadowRoot}_getPreviewInsertionPoint(i,e){let t=this._previewContainer||"global";if(t==="parent")return i;if(t==="global"){let n=this._document;return e||n.fullscreenElement||n.webkitFullscreenElement||n.mozFullScreenElement||n.msFullscreenElement||n.body}return Xt(t)}_getPreviewRect(){return(!this._previewRect||!this._previewRect.width&&!this._previewRect.height)&&(this._previewRect=this._preview?this._preview.getBoundingClientRect():this._initialDomRect),this._previewRect}_nativeDragStart=i=>{if(this._handles.length){let e=this._getTargetHandle(i);e&&!this._disabledHandles.has(e)&&!this.disabled&&i.preventDefault()}else this.disabled||i.preventDefault()};_getTargetHandle(i){return this._handles.find(e=>i.target&&(i.target===e||e.contains(i.target)))}};function Xc(o,i,e){return Math.max(i,Math.min(e,o))}function Ii(o){return o.type[0]==="t"}function ih(o){o.preventDefault()}function Go(o,i,e){let t=Jc(i,o.length-1),n=Jc(e,o.length-1);if(t===n)return;let r=o[t],a=n<t?-1:1;for(let l=t;l!==n;l+=a)o[l]=o[l+a];o[n]=r}function Jc(o,i){return Math.max(0,Math.min(i,o))}var Uo=class{_dragDropRegistry;_element;_sortPredicate;_itemPositions=[];_activeDraggables;orientation="vertical";direction;constructor(i){this._dragDropRegistry=i}_previousSwap={drag:null,delta:0,overlaps:!1};start(i){this.withItems(i)}sort(i,e,t,n){let r=this._itemPositions,a=this._getItemIndexFromPointerPosition(i,e,t,n);if(a===-1&&r.length>0)return null;let l=this.orientation==="horizontal",u=r.findIndex(z=>z.drag===i),g=r[a],_=r[u].clientRect,f=g.clientRect,S=u>a?1:-1,T=this._getItemOffsetPx(_,f,S),w=this._getSiblingOffsetPx(u,r,S),M=r.slice();return Go(r,u,a),r.forEach((z,q)=>{if(M[q]===z)return;let oe=z.drag===i,le=oe?T:w,W=oe?i.getPlaceholderElement():z.drag.getRootElement();z.offset+=le;let se=Math.round(z.offset*(1/z.drag.scale));l?(W.style.transform=$o(`translate3d(${se}px, 0, 0)`,z.initialTransform),Ai(z.clientRect,0,le)):(W.style.transform=$o(`translate3d(0, ${se}px, 0)`,z.initialTransform),Ai(z.clientRect,le,0))}),this._previousSwap.overlaps=Yr(f,e,t),this._previousSwap.drag=g.drag,this._previousSwap.delta=l?n.x:n.y,{previousIndex:u,currentIndex:a}}enter(i,e,t,n){let r=n==null||n<0?this._getItemIndexFromPointerPosition(i,e,t):n,a=this._activeDraggables,l=a.indexOf(i),u=i.getPlaceholderElement(),g=a[r];if(g===i&&(g=a[r+1]),!g&&(r==null||r===-1||r<a.length-1)&&this._shouldEnterAsFirstChild(e,t)&&(g=a[0]),l>-1&&a.splice(l,1),g&&!this._dragDropRegistry.isDragging(g)){let _=g.getRootElement();_.parentElement.insertBefore(u,_),a.splice(r,0,i)}else this._element.appendChild(u),a.push(i);u.style.transform="",this._cacheItemPositions()}withItems(i){this._activeDraggables=i.slice(),this._cacheItemPositions()}withSortPredicate(i){this._sortPredicate=i}reset(){this._activeDraggables?.forEach(i=>{let e=i.getRootElement();if(e){let t=this._itemPositions.find(n=>n.drag===i)?.initialTransform;e.style.transform=t||""}}),this._itemPositions=[],this._activeDraggables=[],this._previousSwap.drag=null,this._previousSwap.delta=0,this._previousSwap.overlaps=!1}getActiveItemsSnapshot(){return this._activeDraggables}getItemIndex(i){return(this.orientation==="horizontal"&&this.direction==="rtl"?this._itemPositions.slice().reverse():this._itemPositions).findIndex(t=>t.drag===i)}updateOnScroll(i,e){this._itemPositions.forEach(({clientRect:t})=>{Ai(t,i,e)}),this._itemPositions.forEach(({drag:t})=>{this._dragDropRegistry.isDragging(t)&&t._sortFromLastPointerPosition()})}withElementContainer(i){this._element=i}_cacheItemPositions(){let i=this.orientation==="horizontal";this._itemPositions=this._activeDraggables.map(e=>{let t=e.getVisibleElement();return{drag:e,offset:0,initialTransform:t.style.transform||"",clientRect:ia(t)}}).sort((e,t)=>i?e.clientRect.left-t.clientRect.left:e.clientRect.top-t.clientRect.top)}_getItemOffsetPx(i,e,t){let n=this.orientation==="horizontal",r=n?e.left-i.left:e.top-i.top;return t===-1&&(r+=n?e.width-i.width:e.height-i.height),r}_getSiblingOffsetPx(i,e,t){let n=this.orientation==="horizontal",r=e[i].clientRect,a=e[i+t*-1],l=r[n?"width":"height"]*t;if(a){let u=n?"left":"top",g=n?"right":"bottom";t===-1?l-=a.clientRect[u]-r[g]:l+=r[u]-a.clientRect[g]}return l}_shouldEnterAsFirstChild(i,e){if(!this._activeDraggables.length)return!1;let t=this._itemPositions,n=this.orientation==="horizontal";if(t[0].drag!==this._activeDraggables[0]){let a=t[t.length-1].clientRect;return n?i>=a.right:e>=a.bottom}else{let a=t[0].clientRect;return n?i<=a.left:e<=a.top}}_getItemIndexFromPointerPosition(i,e,t,n){let r=this.orientation==="horizontal",a=this._itemPositions.findIndex(({drag:l,clientRect:u})=>{if(l===i)return!1;if(n){let g=r?n.x:n.y;if(l===this._previousSwap.drag&&this._previousSwap.overlaps&&g===this._previousSwap.delta)return!1}return r?e>=Math.floor(u.left)&&e<Math.floor(u.right):t>=Math.floor(u.top)&&t<Math.floor(u.bottom)});return a===-1||!this._sortPredicate(a,i)?-1:a}},ea=class{_document;_dragDropRegistry;_element;_sortPredicate;_rootNode;_activeItems;_previousSwap={drag:null,deltaX:0,deltaY:0,overlaps:!1};_relatedNodes=[];constructor(i,e){this._document=i,this._dragDropRegistry=e}start(i){let e=this._element.childNodes;this._relatedNodes=[];for(let t=0;t<e.length;t++){let n=e[t];this._relatedNodes.push([n,n.nextSibling])}this.withItems(i)}sort(i,e,t,n){let r=this._getItemIndexFromPointerPosition(i,e,t),a=this._previousSwap;if(r===-1||this._activeItems[r]===i)return null;let l=this._activeItems[r];if(a.drag===l&&a.overlaps&&a.deltaX===n.x&&a.deltaY===n.y)return null;let u=this.getItemIndex(i),g=i.getPlaceholderElement(),_=l.getRootElement();r>u?_.after(g):_.before(g),Go(this._activeItems,u,r);let f=this._getRootNode().elementFromPoint(e,t);return a.deltaX=n.x,a.deltaY=n.y,a.drag=l,a.overlaps=_===f||_.contains(f),{previousIndex:u,currentIndex:r}}enter(i,e,t,n){let r=n==null||n<0?this._getItemIndexFromPointerPosition(i,e,t):n;r===-1&&(r=this._getClosestItemIndexToPointer(i,e,t));let a=this._activeItems[r],l=this._activeItems.indexOf(i);l>-1&&this._activeItems.splice(l,1),a&&!this._dragDropRegistry.isDragging(a)?(this._activeItems.splice(r,0,i),a.getRootElement().before(i.getPlaceholderElement())):(this._activeItems.push(i),this._element.appendChild(i.getPlaceholderElement()))}withItems(i){this._activeItems=i.slice()}withSortPredicate(i){this._sortPredicate=i}reset(){let i=this._element,e=this._previousSwap;for(let t=this._relatedNodes.length-1;t>-1;t--){let[n,r]=this._relatedNodes[t];n.parentNode===i&&n.nextSibling!==r&&(r===null?i.appendChild(n):r.parentNode===i&&i.insertBefore(n,r))}this._relatedNodes=[],this._activeItems=[],e.drag=null,e.deltaX=e.deltaY=0,e.overlaps=!1}getActiveItemsSnapshot(){return this._activeItems}getItemIndex(i){return this._activeItems.indexOf(i)}updateOnScroll(){this._activeItems.forEach(i=>{this._dragDropRegistry.isDragging(i)&&i._sortFromLastPointerPosition()})}withElementContainer(i){i!==this._element&&(this._element=i,this._rootNode=void 0)}_getItemIndexFromPointerPosition(i,e,t){let n=this._getRootNode().elementFromPoint(Math.floor(e),Math.floor(t)),r=n?this._activeItems.findIndex(a=>{let l=a.getRootElement();return n===l||l.contains(n)}):-1;return r===-1||!this._sortPredicate(r,i)?-1:r}_getRootNode(){return this._rootNode||(this._rootNode=eo(this._element)||this._document),this._rootNode}_getClosestItemIndexToPointer(i,e,t){if(this._activeItems.length===0)return-1;if(this._activeItems.length===1)return 0;let n=1/0,r=-1;for(let a=0;a<this._activeItems.length;a++){let l=this._activeItems[a];if(l!==i){let{x:u,y:g}=l.getRootElement().getBoundingClientRect(),_=Math.hypot(e-u,t-g);_<n&&(n=_,r=a)}}return r}},ed=.05,id=.05,Ct=function(o){return o[o.NONE=0]="NONE",o[o.UP=1]="UP",o[o.DOWN=2]="DOWN",o}(Ct||{}),Xe=function(o){return o[o.NONE=0]="NONE",o[o.LEFT=1]="LEFT",o[o.RIGHT=2]="RIGHT",o}(Xe||{}),ta=class{_dragDropRegistry;_ngZone;_viewportRuler;element;disabled=!1;sortingDisabled=!1;lockAxis;autoScrollDisabled=!1;autoScrollStep=2;enterPredicate=()=>!0;sortPredicate=()=>!0;beforeStarted=new N;entered=new N;exited=new N;dropped=new N;sorted=new N;receivingStarted=new N;receivingStopped=new N;data;_container;_isDragging=!1;_parentPositions;_sortStrategy;_domRect;_draggables=[];_siblings=[];_activeSiblings=new Set;_viewportScrollSubscription=qt.EMPTY;_verticalScrollDirection=Ct.NONE;_horizontalScrollDirection=Xe.NONE;_scrollNode;_stopScrollTimers=new N;_cachedShadowRoot=null;_document;_scrollableElements=[];_initialScrollSnap;_direction="ltr";constructor(i,e,t,n,r){this._dragDropRegistry=e,this._ngZone=n,this._viewportRuler=r;let a=this.element=Xt(i);this._document=t,this.withOrientation("vertical").withElementContainer(a),e.registerDropContainer(this),this._parentPositions=new Vo(t)}dispose(){this._stopScrolling(),this._stopScrollTimers.complete(),this._viewportScrollSubscription.unsubscribe(),this.beforeStarted.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this.sorted.complete(),this.receivingStarted.complete(),this.receivingStopped.complete(),this._activeSiblings.clear(),this._scrollNode=null,this._parentPositions.clear(),this._dragDropRegistry.removeDropContainer(this)}isDragging(){return this._isDragging}start(){this._draggingStarted(),this._notifyReceivingSiblings()}enter(i,e,t,n){this._draggingStarted(),n==null&&this.sortingDisabled&&(n=this._draggables.indexOf(i)),this._sortStrategy.enter(i,e,t,n),this._cacheParentPositions(),this._notifyReceivingSiblings(),this.entered.next({item:i,container:this,currentIndex:this.getItemIndex(i)})}exit(i){this._reset(),this.exited.next({item:i,container:this})}drop(i,e,t,n,r,a,l,u={}){this._reset(),this.dropped.next({item:i,currentIndex:e,previousIndex:t,container:this,previousContainer:n,isPointerOverContainer:r,distance:a,dropPoint:l,event:u})}withItems(i){let e=this._draggables;return this._draggables=i,i.forEach(t=>t._withDropContainer(this)),this.isDragging()&&(e.filter(n=>n.isDragging()).every(n=>i.indexOf(n)===-1)?this._reset():this._sortStrategy.withItems(this._draggables)),this}withDirection(i){return this._direction=i,this._sortStrategy instanceof Uo&&(this._sortStrategy.direction=i),this}connectedTo(i){return this._siblings=i.slice(),this}withOrientation(i){if(i==="mixed")this._sortStrategy=new ea(this._document,this._dragDropRegistry);else{let e=new Uo(this._dragDropRegistry);e.direction=this._direction,e.orientation=i,this._sortStrategy=e}return this._sortStrategy.withElementContainer(this._container),this._sortStrategy.withSortPredicate((e,t)=>this.sortPredicate(e,t,this)),this}withScrollableParents(i){let e=this._container;return this._scrollableElements=i.indexOf(e)===-1?[e,...i]:i.slice(),this}withElementContainer(i){if(i===this._container)return this;let e=Xt(this.element),t=this._scrollableElements.indexOf(this._container),n=this._scrollableElements.indexOf(i);return t>-1&&this._scrollableElements.splice(t,1),n>-1&&this._scrollableElements.splice(n,1),this._sortStrategy&&this._sortStrategy.withElementContainer(i),this._cachedShadowRoot=null,this._scrollableElements.unshift(i),this._container=i,this}getScrollableParents(){return this._scrollableElements}getItemIndex(i){return this._isDragging?this._sortStrategy.getItemIndex(i):this._draggables.indexOf(i)}isReceiving(){return this._activeSiblings.size>0}_sortItem(i,e,t,n){if(this.sortingDisabled||!this._domRect||!Hc(this._domRect,ed,e,t))return;let r=this._sortStrategy.sort(i,e,t,n);r&&this.sorted.next({previousIndex:r.previousIndex,currentIndex:r.currentIndex,container:this,item:i})}_startScrollingIfNecessary(i,e){if(this.autoScrollDisabled)return;let t,n=Ct.NONE,r=Xe.NONE;if(this._parentPositions.positions.forEach((a,l)=>{l===this._document||!a.clientRect||t||Hc(a.clientRect,ed,i,e)&&([n,r]=oh(l,a.clientRect,this._direction,i,e),(n||r)&&(t=l))}),!n&&!r){let{width:a,height:l}=this._viewportRuler.getViewportSize(),u={width:a,height:l,top:0,right:a,bottom:l,left:0};n=od(u,e),r=rd(u,i),t=window}t&&(n!==this._verticalScrollDirection||r!==this._horizontalScrollDirection||t!==this._scrollNode)&&(this._verticalScrollDirection=n,this._horizontalScrollDirection=r,this._scrollNode=t,(n||r)&&t?this._ngZone.runOutsideAngular(this._startScrollInterval):this._stopScrolling())}_stopScrolling(){this._stopScrollTimers.next()}_draggingStarted(){let i=this._container.style;this.beforeStarted.next(),this._isDragging=!0,this._initialScrollSnap=i.msScrollSnapType||i.scrollSnapType||"",i.scrollSnapType=i.msScrollSnapType="none",this._sortStrategy.start(this._draggables),this._cacheParentPositions(),this._viewportScrollSubscription.unsubscribe(),this._listenToScrollEvents()}_cacheParentPositions(){this._parentPositions.cache(this._scrollableElements),this._domRect=this._parentPositions.positions.get(this._container).clientRect}_reset(){this._isDragging=!1;let i=this._container.style;i.scrollSnapType=i.msScrollSnapType=this._initialScrollSnap,this._siblings.forEach(e=>e._stopReceiving(this)),this._sortStrategy.reset(),this._stopScrolling(),this._viewportScrollSubscription.unsubscribe(),this._parentPositions.clear()}_startScrollInterval=()=>{this._stopScrolling(),Tn(0,rs).pipe(L(this._stopScrollTimers)).subscribe(()=>{let i=this._scrollNode,e=this.autoScrollStep;this._verticalScrollDirection===Ct.UP?i.scrollBy(0,-e):this._verticalScrollDirection===Ct.DOWN&&i.scrollBy(0,e),this._horizontalScrollDirection===Xe.LEFT?i.scrollBy(-e,0):this._horizontalScrollDirection===Xe.RIGHT&&i.scrollBy(e,0)})};_isOverContainer(i,e){return this._domRect!=null&&Yr(this._domRect,i,e)}_getSiblingContainerFromPosition(i,e,t){return this._siblings.find(n=>n._canReceive(i,e,t))}_canReceive(i,e,t){if(!this._domRect||!Yr(this._domRect,e,t)||!this.enterPredicate(i,this))return!1;let n=this._getShadowRoot().elementFromPoint(e,t);return n?n===this._container||this._container.contains(n):!1}_startReceiving(i,e){let t=this._activeSiblings;!t.has(i)&&e.every(n=>this.enterPredicate(n,this)||this._draggables.indexOf(n)>-1)&&(t.add(i),this._cacheParentPositions(),this._listenToScrollEvents(),this.receivingStarted.next({initiator:i,receiver:this,items:e}))}_stopReceiving(i){this._activeSiblings.delete(i),this._viewportScrollSubscription.unsubscribe(),this.receivingStopped.next({initiator:i,receiver:this})}_listenToScrollEvents(){this._viewportScrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(i=>{if(this.isDragging()){let e=this._parentPositions.handleScroll(i);e&&this._sortStrategy.updateOnScroll(e.top,e.left)}else this.isReceiving()&&this._cacheParentPositions()})}_getShadowRoot(){if(!this._cachedShadowRoot){let i=eo(this._container);this._cachedShadowRoot=i||this._document}return this._cachedShadowRoot}_notifyReceivingSiblings(){let i=this._sortStrategy.getActiveItemsSnapshot().filter(e=>e.isDragging());this._siblings.forEach(e=>e._startReceiving(this,i))}};function od(o,i){let{top:e,bottom:t,height:n}=o,r=n*id;return i>=e-r&&i<=e+r?Ct.UP:i>=t-r&&i<=t+r?Ct.DOWN:Ct.NONE}function rd(o,i){let{left:e,right:t,width:n}=o,r=n*id;return i>=e-r&&i<=e+r?Xe.LEFT:i>=t-r&&i<=t+r?Xe.RIGHT:Xe.NONE}function oh(o,i,e,t,n){let r=od(i,n),a=rd(i,t),l=Ct.NONE,u=Xe.NONE;if(r){let g=o.scrollTop;r===Ct.UP?g>0&&(l=Ct.UP):o.scrollHeight-g>o.clientHeight&&(l=Ct.DOWN)}if(a){let g=o.scrollLeft;e==="rtl"?a===Xe.RIGHT?g<0&&(u=Xe.RIGHT):o.scrollWidth+g>o.clientWidth&&(u=Xe.LEFT):a===Xe.LEFT?g>0&&(u=Xe.LEFT):o.scrollWidth-g>o.clientWidth&&(u=Xe.RIGHT)}return[l,u]}var Di={capture:!0},Zr={passive:!1,capture:!0},rh=(()=>{class o{static \u0275fac=function(t){return new(t||o)};static \u0275cmp=Y({type:o,selectors:[["ng-component"]],hostAttrs:["cdk-drag-resets-container",""],decls:0,vars:0,template:function(t,n){},styles:[`@layer cdk-resets{.cdk-drag-preview{background:none;border:none;padding:0;color:inherit;inset:auto}}.cdk-drag-placeholder *,.cdk-drag-preview *{pointer-events:none !important}
`],encapsulation:2,changeDetection:0})}return o})(),ra=(()=>{class o{_ngZone=P(et);_document=P(Ci);_styleLoader=P(Qs);_renderer=P(_i).createRenderer(null,null);_cleanupDocumentTouchmove;_dropInstances=new Set;_dragInstances=new Set;_activeDragInstances=Ge([]);_globalListeners;_draggingPredicate=e=>e.isDragging();_domNodesToDirectives=null;pointerMove=new N;pointerUp=new N;scroll=new N;constructor(){}registerDropContainer(e){this._dropInstances.has(e)||this._dropInstances.add(e)}registerDragItem(e){this._dragInstances.add(e),this._dragInstances.size===1&&this._ngZone.runOutsideAngular(()=>{this._cleanupDocumentTouchmove?.(),this._cleanupDocumentTouchmove=Yt(this._renderer,this._document,"touchmove",this._persistentTouchmoveListener,Zr)})}removeDropContainer(e){this._dropInstances.delete(e)}removeDragItem(e){this._dragInstances.delete(e),this.stopDragging(e),this._dragInstances.size===0&&this._cleanupDocumentTouchmove?.()}startDragging(e,t){if(!(this._activeDragInstances().indexOf(e)>-1)&&(this._styleLoader.load(rh),this._activeDragInstances.update(n=>[...n,e]),this._activeDragInstances().length===1)){let n=t.type.startsWith("touch"),r=l=>this.pointerUp.next(l),a=[["scroll",l=>this.scroll.next(l),Di],["selectstart",this._preventDefaultWhileDragging,Zr]];n?a.push(["touchend",r,Di],["touchcancel",r,Di]):a.push(["mouseup",r,Di]),n||a.push(["mousemove",l=>this.pointerMove.next(l),Zr]),this._ngZone.runOutsideAngular(()=>{this._globalListeners=a.map(([l,u,g])=>Yt(this._renderer,this._document,l,u,g))})}}stopDragging(e){this._activeDragInstances.update(t=>{let n=t.indexOf(e);return n>-1?(t.splice(n,1),[...t]):t}),this._activeDragInstances().length===0&&this._clearGlobalListeners()}isDragging(e){return this._activeDragInstances().indexOf(e)>-1}scrolled(e){let t=[this.scroll];return e&&e!==this._document&&t.push(new Ue(n=>this._ngZone.runOutsideAngular(()=>{let r=Yt(this._renderer,e,"scroll",a=>{this._activeDragInstances().length&&n.next(a)},Di);return()=>{r()}}))),$t(...t)}registerDirectiveNode(e,t){this._domNodesToDirectives??=new WeakMap,this._domNodesToDirectives.set(e,t)}removeDirectiveNode(e){this._domNodesToDirectives?.delete(e)}getDragDirectiveForNode(e){return this._domNodesToDirectives?.get(e)||null}ngOnDestroy(){this._dragInstances.forEach(e=>this.removeDragItem(e)),this._dropInstances.forEach(e=>this.removeDropContainer(e)),this._domNodesToDirectives=null,this._clearGlobalListeners(),this.pointerMove.complete(),this.pointerUp.complete()}_preventDefaultWhileDragging=e=>{this._activeDragInstances().length>0&&e.preventDefault()};_persistentTouchmoveListener=e=>{this._activeDragInstances().length>0&&(this._activeDragInstances().some(this._draggingPredicate)&&e.preventDefault(),this.pointerMove.next(e))};_clearGlobalListeners(){this._globalListeners?.forEach(e=>e()),this._globalListeners=void 0}static \u0275fac=function(t){return new(t||o)};static \u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})(),ah={dragStartThreshold:5,pointerDirectionChangeThreshold:5},ad=(()=>{class o{_document=P(Ci);_ngZone=P(et);_viewportRuler=P(Nr);_dragDropRegistry=P(ra);_renderer=P(_i).createRenderer(null,null);constructor(){}createDrag(e,t=ah){return new Jr(e,t,this._document,this._ngZone,this._viewportRuler,this._dragDropRegistry,this._renderer)}createDropList(e){return new ta(e,this._dragDropRegistry,this._document,this._ngZone,this._viewportRuler)}static \u0275fac=function(t){return new(t||o)};static \u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})(),na=new Le("CDK_DRAG_PARENT");var sd=new Le("CdkDragHandle"),Ho=(()=>{class o{element=P(kr);_parentDrag=P(na,{optional:!0,skipSelf:!0});_dragDropRegistry=P(ra);_stateChanges=new N;get disabled(){return this._disabled}set disabled(e){this._disabled=e,this._stateChanges.next(this)}_disabled=!1;constructor(){this._parentDrag?._addHandle(this)}ngAfterViewInit(){if(!this._parentDrag){let e=this.element.nativeElement.parentElement;for(;e;){let t=this._dragDropRegistry.getDragDirectiveForNode(e);if(t){this._parentDrag=t,t._addHandle(this);break}e=e.parentElement}}}ngOnDestroy(){this._parentDrag?._removeHandle(this),this._stateChanges.complete()}static \u0275fac=function(t){return new(t||o)};static \u0275dir=gn({type:o,selectors:[["","cdkDragHandle",""]],hostAttrs:[1,"cdk-drag-handle"],inputs:{disabled:[2,"cdkDragHandleDisabled","disabled",Ar]},features:[qi([{provide:sd,useExisting:o}])]})}return o})(),sh=new Le("CDK_DRAG_CONFIG"),lh=new Le("CdkDropList"),Wo=(()=>{class o{element=P(kr);dropContainer=P(lh,{optional:!0,skipSelf:!0});_ngZone=P(et);_viewContainerRef=P(Ss);_dir=P(Zs,{optional:!0});_changeDetectorRef=P(He);_selfHandle=P(sd,{optional:!0,self:!0});_parentDrag=P(na,{optional:!0,skipSelf:!0});_dragDropRegistry=P(ra);_destroyed=new N;_handles=new ge([]);_previewTemplate;_placeholderTemplate;_dragRef;data;lockAxis;rootElementSelector;boundaryElement;dragStartDelay;freeDragPosition;get disabled(){return this._disabled||!!(this.dropContainer&&this.dropContainer.disabled)}set disabled(e){this._disabled=e,this._dragRef.disabled=this._disabled}_disabled;constrainPosition;previewClass;previewContainer;scale=1;started=new H;released=new H;ended=new H;entered=new H;exited=new H;dropped=new H;moved=new Ue(e=>{let t=this._dragRef.moved.pipe(de(n=>({source:this,pointerPosition:n.pointerPosition,event:n.event,delta:n.delta,distance:n.distance}))).subscribe(e);return()=>{t.unsubscribe()}});_injector=P(Qt);constructor(){let e=this.dropContainer,t=P(sh,{optional:!0}),n=P(ad);this._dragRef=n.createDrag(this.element,{dragStartThreshold:t&&t.dragStartThreshold!=null?t.dragStartThreshold:5,pointerDirectionChangeThreshold:t&&t.pointerDirectionChangeThreshold!=null?t.pointerDirectionChangeThreshold:5,zIndex:t?.zIndex}),this._dragRef.data=this,this._dragDropRegistry.registerDirectiveNode(this.element.nativeElement,this),t&&this._assignDefaults(t),e&&(this._dragRef._withDropContainer(e._dropListRef),e.addItem(this),e._dropListRef.beforeStarted.pipe(L(this._destroyed)).subscribe(()=>{this._dragRef.scale=this.scale})),this._syncInputs(this._dragRef),this._handleEvents(this._dragRef)}getPlaceholderElement(){return this._dragRef.getPlaceholderElement()}getRootElement(){return this._dragRef.getRootElement()}reset(){this._dragRef.reset()}getFreeDragPosition(){return this._dragRef.getFreeDragPosition()}setFreeDragPosition(e){this._dragRef.setFreeDragPosition(e)}ngAfterViewInit(){ws(()=>{this._updateRootElement(),this._setupHandlesListener(),this._dragRef.scale=this.scale,this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)},{injector:this._injector})}ngOnChanges(e){let t=e.rootElementSelector,n=e.freeDragPosition;t&&!t.firstChange&&this._updateRootElement(),this._dragRef.scale=this.scale,n&&!n.firstChange&&this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)}ngOnDestroy(){this.dropContainer&&this.dropContainer.removeItem(this),this._dragDropRegistry.removeDirectiveNode(this.element.nativeElement),this._ngZone.runOutsideAngular(()=>{this._handles.complete(),this._destroyed.next(),this._destroyed.complete(),this._dragRef.dispose()})}_addHandle(e){let t=this._handles.getValue();t.push(e),this._handles.next(t)}_removeHandle(e){let t=this._handles.getValue(),n=t.indexOf(e);n>-1&&(t.splice(n,1),this._handles.next(t))}_setPreviewTemplate(e){this._previewTemplate=e}_resetPreviewTemplate(e){e===this._previewTemplate&&(this._previewTemplate=null)}_setPlaceholderTemplate(e){this._placeholderTemplate=e}_resetPlaceholderTemplate(e){e===this._placeholderTemplate&&(this._placeholderTemplate=null)}_updateRootElement(){let e=this.element.nativeElement,t=e;this.rootElementSelector&&(t=e.closest!==void 0?e.closest(this.rootElementSelector):e.parentElement?.closest(this.rootElementSelector)),this._dragRef.withRootElement(t||e)}_getBoundaryElement(){let e=this.boundaryElement;return e?typeof e=="string"?this.element.nativeElement.closest(e):Xt(e):null}_syncInputs(e){e.beforeStarted.subscribe(()=>{if(!e.isDragging()){let t=this._dir,n=this.dragStartDelay,r=this._placeholderTemplate?{template:this._placeholderTemplate.templateRef,context:this._placeholderTemplate.data,viewContainer:this._viewContainerRef}:null,a=this._previewTemplate?{template:this._previewTemplate.templateRef,context:this._previewTemplate.data,matchSize:this._previewTemplate.matchSize,viewContainer:this._viewContainerRef}:null;e.disabled=this.disabled,e.lockAxis=this.lockAxis,e.scale=this.scale,e.dragStartDelay=typeof n=="object"&&n?n:qs(n),e.constrainPosition=this.constrainPosition,e.previewClass=this.previewClass,e.withBoundaryElement(this._getBoundaryElement()).withPlaceholderTemplate(r).withPreviewTemplate(a).withPreviewContainer(this.previewContainer||"global"),t&&e.withDirection(t.value)}}),e.beforeStarted.pipe(kn(1)).subscribe(()=>{if(this._parentDrag){e.withParent(this._parentDrag._dragRef);return}let t=this.element.nativeElement.parentElement;for(;t;){let n=this._dragDropRegistry.getDragDirectiveForNode(t);if(n){e.withParent(n._dragRef);break}t=t.parentElement}})}_handleEvents(e){e.started.subscribe(t=>{this.started.emit({source:this,event:t.event}),this._changeDetectorRef.markForCheck()}),e.released.subscribe(t=>{this.released.emit({source:this,event:t.event})}),e.ended.subscribe(t=>{this.ended.emit({source:this,distance:t.distance,dropPoint:t.dropPoint,event:t.event}),this._changeDetectorRef.markForCheck()}),e.entered.subscribe(t=>{this.entered.emit({container:t.container.data,item:this,currentIndex:t.currentIndex})}),e.exited.subscribe(t=>{this.exited.emit({container:t.container.data,item:this})}),e.dropped.subscribe(t=>{this.dropped.emit({previousIndex:t.previousIndex,currentIndex:t.currentIndex,previousContainer:t.previousContainer.data,container:t.container.data,isPointerOverContainer:t.isPointerOverContainer,item:this,distance:t.distance,dropPoint:t.dropPoint,event:t.event})})}_assignDefaults(e){let{lockAxis:t,dragStartDelay:n,constrainPosition:r,previewClass:a,boundaryElement:l,draggingDisabled:u,rootElementSelector:g,previewContainer:_}=e;this.disabled=u??!1,this.dragStartDelay=n||0,t&&(this.lockAxis=t),r&&(this.constrainPosition=r),a&&(this.previewClass=a),l&&(this.boundaryElement=l),g&&(this.rootElementSelector=g),_&&(this.previewContainer=_)}_setupHandlesListener(){this._handles.pipe(Te(e=>{let t=e.map(n=>n.element);this._selfHandle&&this.rootElementSelector&&t.push(this.element),this._dragRef.withHandles(t)}),Ne(e=>$t(...e.map(t=>t._stateChanges.pipe(_s(t))))),L(this._destroyed)).subscribe(e=>{let t=this._dragRef,n=e.element.nativeElement;e.disabled?t.disableHandle(n):t.enableHandle(n)})}static \u0275fac=function(t){return new(t||o)};static \u0275dir=gn({type:o,selectors:[["","cdkDrag",""]],hostAttrs:[1,"cdk-drag"],hostVars:4,hostBindings:function(t,n){t&2&&Z("cdk-drag-disabled",n.disabled)("cdk-drag-dragging",n._dragRef.isDragging())},inputs:{data:[0,"cdkDragData","data"],lockAxis:[0,"cdkDragLockAxis","lockAxis"],rootElementSelector:[0,"cdkDragRootElement","rootElementSelector"],boundaryElement:[0,"cdkDragBoundary","boundaryElement"],dragStartDelay:[0,"cdkDragStartDelay","dragStartDelay"],freeDragPosition:[0,"cdkDragFreeDragPosition","freeDragPosition"],disabled:[2,"cdkDragDisabled","disabled",Ar],constrainPosition:[0,"cdkDragConstrainPosition","constrainPosition"],previewClass:[0,"cdkDragPreviewClass","previewClass"],previewContainer:[0,"cdkDragPreviewContainer","previewContainer"],scale:[2,"cdkDragScale","scale",ks]},outputs:{started:"cdkDragStarted",released:"cdkDragReleased",ended:"cdkDragEnded",entered:"cdkDragEntered",exited:"cdkDragExited",dropped:"cdkDragDropped",moved:"cdkDragMoved"},exportAs:["cdkDrag"],features:[qi([{provide:na,useExisting:o}]),Cs]})}return o})();var Ko=(()=>{class o{static \u0275fac=function(t){return new(t||o)};static \u0275mod=mn({type:o});static \u0275inj=pn({providers:[ad],imports:[Ei]})}return o})();var ch=(o,i,e)=>({expanded:o,draggable:i,"cdk-drag-disabled":e});function dh(o,i){o&1&&(c(0,"h3"),p(1,"Capas"),d())}function ph(o,i){if(o&1){let e=V();c(0,"div",15),y("click",function(){let n=b(e).$implicit,r=v(3);return C(r.toggleBaseLayer(n))}),c(1,"mat-icon",16),p(2),d(),c(3,"span",17),p(4),d(),c(5,"mat-icon",18),p(6),d()()}if(o&2){let e=i.$implicit;Z("active",e.visible),h("matTooltip",e.description),m(2),x(e.icon||"map"),m(2),x(e.name),m(2),x(e.visible?"radio_button_checked":"radio_button_unchecked")}}function mh(o,i){o&1&&(c(0,"div",19),p(1," No hay capas base disponibles. "),d())}function gh(o,i){if(o&1&&(c(0,"div",12),E(1,ph,7,6,"div",13)(2,mh,2,0,"div",14),d()),o&2){let e=v(2);m(),h("ngForOf",e.baseLayers),m(),h("ngIf",e.baseLayers.length===0)}}function uh(o,i){if(o&1){let e=V();c(0,"div",21),y("click",function(){let n=b(e).$implicit,r=v(3);return C(r.toggleOverlayLayer(n))}),c(1,"mat-icon",16),p(2),d(),c(3,"span",17),p(4),d(),c(5,"mat-icon",22),p(6),d()()}if(o&2){let e=i.$implicit;Z("active",e.visible),h("matTooltip",e.description),m(2),x(e.icon||"layers_clear"),m(2),x(e.name),m(2),x(e.visible?"check_box":"check_box_outline_blank")}}function hh(o,i){o&1&&(c(0,"div",19),p(1," No hay capas superpuestas disponibles. "),d())}function fh(o,i){if(o&1&&(c(0,"div",12),E(1,uh,7,6,"div",20)(2,hh,2,0,"div",14),d()),o&2){let e=v(2);m(),h("ngForOf",e.overlayLayers),m(),h("ngIf",e.overlayLayers.length===0)}}function _h(o,i){if(o&1){let e=V();c(0,"div",8)(1,"div",9)(2,"div",10),y("click",function(){b(e);let n=v();return C(n.toggleBaseExpand())}),c(3,"span"),p(4,"Capas Base"),d(),c(5,"mat-icon"),p(6),d()(),E(7,gh,3,2,"div",11),d(),c(8,"div",9)(9,"div",10),y("click",function(){b(e);let n=v();return C(n.toggleOverlaysExpand())}),c(10,"span"),p(11,"Capas Superpuestas"),d(),c(12,"mat-icon"),p(13),d()(),E(14,fh,3,2,"div",11),d()()}if(o&2){let e=v();m(6),x(e.expandedBase?"expand_less":"expand_more"),m(),h("ngIf",e.expandedBase),m(6),x(e.expandedOverlays?"expand_less":"expand_more"),m(),h("ngIf",e.expandedOverlays)}}function vh(o,i){o&1&&(c(0,"div",23)(1,"span",24),p(2,"Arrastra desde el encabezado para mover."),d()())}var cd=(()=>{class o{get positionClass(){return`lc-${this.position}`}constructor(e,t){this.mapStateManager=e,this.logger=t,this.position="top-right",this._baseLayers=[],this._overlayLayers=[],this.baseLayers=[],this.overlayLayers=[],this.baseLayerChanged=new H,this.overlayLayerChanged=new H,this.expandedLayers=!1,this.expandedBase=!0,this.expandedOverlays=!0,this.isDraggable=!1,this.panelPosition=null,this.destroy$=new N}ngOnInit(){this.mapStateManager.layerChanges.pipe(L(this.destroy$)).subscribe(()=>{this.loadLayers()}),this.loadLayers(),this.loadSavedPosition(),this.baseLayers.length===0&&this.createDefaultBaseLayers()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadLayers(){try{let e=this.mapStateManager.getAllLayers();this._baseLayers=e.filter(t=>t.type==="base").sort((t,n)=>t.order-n.order),this._overlayLayers=e.filter(t=>t.type==="overlay").sort((t,n)=>t.order-n.order),this._baseLayers.length===0&&this.createDefaultBaseLayers(),this._overlayLayers.length===0&&this.createDefaultOverlayLayers(),this.baseLayers=this._baseLayers.map(t=>({id:t.id,name:t.name,visible:t.visible,description:t.description,icon:t.icon})),this.overlayLayers=this._overlayLayers.map(t=>({id:t.id,name:t.name,visible:t.visible,description:t.description,icon:t.icon}))}catch(e){this.logger.error("Error al cargar capas:",e)}}createDefaultBaseLayers(){this._baseLayers=[{id:"osm",name:"OpenStreetMap",visible:!0,type:"base",icon:"fa-map",description:"Mapa base est\xE1ndar",order:1},{id:"satellite",name:"Sat\xE9lite",visible:!1,type:"base",icon:"fa-satellite-dish",description:"Vista satelital",order:2},{id:"terrain",name:"Terreno",visible:!1,type:"base",icon:"fa-mountain",description:"Mapa topogr\xE1fico y de terreno",order:3}],this.baseLayers=this._baseLayers.map(e=>({id:e.id,name:e.name,visible:e.visible,description:e.description,icon:e.icon}))}createDefaultOverlayLayers(){this._overlayLayers=[{id:"elements",name:"Elementos",visible:!0,type:"overlay",icon:"fa-network-wired",description:"Elementos de la red",order:1},{id:"connections",name:"Conexiones",visible:!0,type:"overlay",icon:"fa-project-diagram",description:"Conexiones entre elementos",order:2},{id:"labels",name:"Etiquetas",visible:!0,type:"overlay",icon:"fa-tag",description:"Nombres de los elementos",order:3},{id:"grid",name:"Cuadr\xEDcula",visible:!1,type:"overlay",icon:"fa-th",description:"Cuadr\xEDcula de coordenadas",order:4}],this.overlayLayers=this._overlayLayers.map(e=>({id:e.id,name:e.name,visible:e.visible,description:e.description,icon:e.icon}))}toggleBaseLayer(e){this.baseLayers.forEach(t=>{t.visible=t.id===e.id}),this._baseLayers.forEach(t=>{let n=t.id===e.id;t.visible!==n&&(t.visible=n,this.mapStateManager.toggleLayerVisibility(t.id))}),this.baseLayerChanged.emit(e)}toggleOverlayLayer(e){e.visible=!e.visible;let t=this._overlayLayers.find(n=>n.id===e.id);t&&(t.visible=e.visible,this.mapStateManager.toggleLayerVisibility(t.id)),this.overlayLayerChanged.emit(e)}toggleExpand(){this.expandedLayers=!this.expandedLayers}toggleBaseExpand(){this.expandedBase=!this.expandedBase}toggleOverlaysExpand(){this.expandedOverlays=!this.expandedOverlays}toggleDraggable(){this.isDraggable=!this.isDraggable,!this.isDraggable&&this.panelPosition||this.isDraggable&&this.panelPosition,this.logger.debug(`LayerControlComponent: Draggable toggled to ${this.isDraggable}`)}onPanelDragEnded(e){if(!this.isDraggable)return;let t={x:(this.panelPosition?.x||0)+e.distance.x,y:(this.panelPosition?.y||0)+e.distance.y};this.panelPosition=t,e.source.element.nativeElement.style.transform=`translate3d(${t.x}px, ${t.y}px, 0)`,this.logger.debug("LayerControlComponent: Panel drag ended",e.distance,"New position:",this.panelPosition),this.saveCurrentPosition()}saveCurrentPosition(){if(this.panelPosition)try{localStorage.setItem("layer-control-position",JSON.stringify(this.panelPosition))}catch(e){console.warn("No se pudo guardar la posici\xF3n del panel de capas",e)}}loadSavedPosition(){try{let e=localStorage.getItem("layer-control-position");e&&(this.panelPosition=JSON.parse(e))}catch(e){console.warn("No se pudo cargar la posici\xF3n guardada del panel de capas",e)}}static{this.\u0275fac=function(t){return new(t||o)(A(bt),A(K))}}static{this.\u0275cmp=Y({type:o,selectors:[["app-layer-control"]],inputs:{position:"position"},outputs:{baseLayerChanged:"baseLayerChanged",overlayLayerChanged:"overlayLayerChanged"},decls:21,vars:27,consts:[["cdkDrag","",1,"layer-control-container","layer-control-panel",3,"cdkDragEnded","ngClass","cdkDragDisabled","cdkDragBoundary"],["cdkDragHandle","",1,"layer-control-header",3,"mousedown"],[1,"header-left"],["mat-icon-button","",1,"drag-handle-button",3,"click","matTooltip"],[4,"ngIf"],["mat-icon-button","",1,"layer-toggle-button",3,"click","matTooltip"],["class","layer-content",4,"ngIf"],["class","layer-control-footer",4,"ngIf"],[1,"layer-content"],[1,"layer-group"],[1,"group-header",3,"click"],["class","group-content",4,"ngIf"],[1,"group-content"],["class","layer-item base-layer",3,"active","matTooltip","click",4,"ngFor","ngForOf"],["class","no-layers-message",4,"ngIf"],[1,"layer-item","base-layer",3,"click","matTooltip"],[1,"layer-icon"],[1,"layer-name"],[1,"layer-status"],[1,"no-layers-message"],["class","layer-item overlay-layer",3,"active","matTooltip","click",4,"ngFor","ngForOf"],[1,"layer-item","overlay-layer",3,"click","matTooltip"],[1,"layer-toggle"],[1,"layer-control-footer"],[1,"drag-hint"]],template:function(t,n){t&1&&(c(0,"pre"),p(1),$e(2,"json"),d(),c(3,"pre"),p(4),$e(5,"json"),d(),c(6,"pre"),p(7),$e(8,"json"),d(),c(9,"div",0),y("cdkDragEnded",function(a){return n.onPanelDragEnded(a)}),c(10,"div",1),y("mousedown",function(a){return a.stopPropagation()}),c(11,"div",2)(12,"button",3),y("click",function(){return n.toggleDraggable()}),c(13,"mat-icon"),p(14),d()(),E(15,dh,2,0,"h3",4),d(),c(16,"button",5),y("click",function(){return n.toggleExpand()}),c(17,"mat-icon"),p(18),d()()(),E(19,_h,15,4,"div",6)(20,vh,3,0,"div",7),d()),t&2&&(m(),j("positionClass: ",An(2,17,n.positionClass),""),m(3),j("expandedLayers: ",An(5,19,n.expandedLayers),""),m(3),j("isDraggable: ",An(8,21,n.isDraggable),""),m(2),In(n.positionClass),Dr("transform",n.panelPosition?"translate3d("+n.panelPosition.x+"px, "+n.panelPosition.y+"px, 0)":null),h("ngClass",Ms(23,ch,n.expandedLayers,n.isDraggable,!n.isDraggable))("cdkDragDisabled",!n.isDraggable)("cdkDragBoundary",".map-container"),m(3),h("matTooltip",n.isDraggable?"Desactivar arrastre":"Activar arrastre"),m(2),x(n.isDraggable?"lock_open":"lock"),m(),h("ngIf",n.expandedLayers),m(),h("matTooltip",n.expandedLayers?"Contraer panel":"Expandir panel"),m(2),x(n.expandedLayers?"keyboard_arrow_down":"layers"),m(),h("ngIf",n.expandedLayers),m(),h("ngIf",n.isDraggable&&n.expandedLayers))},dependencies:[ee,ft,We,re,Fs,be,Be,Me,ke,Ko,Wo,Ho,pe,ue],styles:['@charset "UTF-8";[_ngcontent-%COMP%]:root{--primary-color: #3F51B5;--primary-rgb: 63, 81, 181;--primary-color-hover: rgb(52.4655737705, 67.4557377049, 150.7344262295);--accent-color: #FF4081;--warn-color: #F44336;--background-color: #F5F5F5;--surface-color: #ffffff;--surface-lighter: #f9f9f9;--surface-darker: #eeeeee;--text-color: #212121;--text-secondary-color: hsl(0, 0%, -12.0588235294%);--text-hint-color: hsl(0, 0%, -32.0588235294%);--text-disabled-color: hsl(0, 0%, -52.0588235294%);--primary-contrast-color: white;--accent-contrast-color: white;--warn-contrast-color: white;--olt-color: #4CAF50;--ont-color: #2196F3;--odf-color: #FFC107;--edfa-color: #9C27B0;--splitter-color: #FF5722;--manga-color: #607D8B;--terminal-box-color: #FF9800;--slack-fiber-color: #80DEEA;--spacing-unit: 4px;--spacing-xxs: .125rem;--spacing-xs: .25rem;--spacing-sm: .5rem;--spacing-md: .75rem;--spacing-lg: 1rem;--spacing-xl: 1.5rem;--spacing-xxl: 2rem;--shadow-xs: 0 1px 2px rgba(0,0,0,.05);--shadow-sm: 0 1px 3px rgba(0, 0, 0, .1);--shadow-md: 0 2px 4px rgba(0, 0, 0, .1);--shadow-lg: 0 4px 6px rgba(0, 0, 0, .1);--border-radius-sm: 2px;--border-radius-md: 4px;--border-radius-lg: 8px;--border-radius-round: 50%;--border-color: #e0e0e0;--border-width-normal: 1px;--border-width-strong: 4px;--border-radius-pill: 20px;--border-color-light: rgb(249.5, 249.5, 249.5);--border-color-dark: rgb(198.5, 198.5, 198.5);--color-success: #4caf50;--color-warning: #ff8f00;--color-danger: #c62828;--color-info: #2196F3;--color-neutral: #9e9e9e;--color-success-bg: #e8f5e9;--color-warning-bg: #fff8e1;--color-danger-bg: #ffebee;--color-info-bg: rgb(226.5384615385, 241.5384615385, 253.4615384615);--color-maintenance-bg: #e3f2fd;--status-inactive-fg: #757575;--status-inactive-bg: #f5f5f5;--color-success-contrast: white;--color-warning-contrast: white;--color-danger-contrast: white;--color-info-contrast: #212121;--color-maintenance-contrast: white;--font-family: "Roboto, Segoe UI, sans-serif";--font-size-xxs: .625rem;--font-size-xs: .75rem;--font-size-sm: .875rem;--font-size-md: 1rem;--font-size-lg: 1.125rem;--font-size-xl: 1.25rem;--font-size-xxl: 1.5rem;--font-size-display: 2.5rem;--transition-fast: .15s ease-in-out;--transition-normal: .3s ease-in-out;--transition-slow: .5s ease-in-out;--status-active: #4caf50;--status-inactive: #757575;--status-maintenance: #1565c0;--status-planning: #2196F3;--status-unknown: var(--color-neutral);--status-fault: #c62828;--surface-overlay-light: rgba(255, 255, 255, .85);--surface-overlay-light-strong: rgba(255, 255, 255, .95);--border-color-semitransparent: rgba(0, 0, 0, .1);--primary-bg-subtle: rgba(63, 81, 181, .15);--surface-action-hover: rgb(242.8571428571, 242.8571428571, 242.8571428571);--surface-button: var(--surface-color);--surface-button-hover: var(--surface-action-hover);--text-color-button: var(--text-color);--scrollbar-track-color: #f1f1f1;--scrollbar-thumb-color: #c1c1c1;--scrollbar-thumb-hover-color: #a8a8a8;--z-index-map-base: 1;--z-index-map-elements: 5;--z-index-map-widgets-overlay: 50;--z-index-map-overlay: 100;--z-index-network-design-panels: 900;--z-index-debug-info: 999;--z-index-floating-panel-base: 1000;--z-index-performance-widget: 1000;--z-index-elements-panel: 1001;--z-index-layer-control: 1001;--z-index-sidebar: 1005;--z-index-map-legend: 1005;--z-index-sidebar-mobile: 1010;--z-index-loading-overlay: 1050;--z-index-dialog: 1075;--z-index-toolbar: 1100;--z-index-tooltip: 1150;--z-index-map-controls: 1201;--toolbar-height: 46px;--toolbar-button-height: 30px;--toolbar-button-height-mobile: 32px;--action-button-height: 40px;--menu-item-height: 42px;--icon-size-sm: 18px;--icon-size-md: 20px;--tooltip-bg-color: rgba(33, 33, 33, .95);--primary-ripple-color: rgba(var(--primary-rgb), .1)}[_ngcontent-%COMP%]:root.dark-theme, body.dark-theme[_ngcontent-%COMP%]{--background-color: #121212;--surface-color: #1e1e1e;--surface-lighter: rgb(42.75, 42.75, 42.75);--surface-darker: #121212;--text-color: #e0e0e0;--text-secondary-color: rgb(185.75, 185.75, 185.75);--text-hint-color: rgb(147.5, 147.5, 147.5);--text-disabled-color: rgb(109.25, 109.25, 109.25);--border-color: #444444;--border-color-light: rgb(93.5, 93.5, 93.5);--border-color-dark: rgb(42.5, 42.5, 42.5);--color-success-bg: rgb(51.8181818182, 119.1818181818, 57);--color-warning-bg: rgb(174, 133.4, 0);--color-danger-bg: rgb(184, 0, 27.6);--color-info-bg: rgb(8.9230769231, 95.9230769231, 165.0769230769);--color-maintenance-bg: rgb(11.6, 98.6, 162.4);--shadow-xs: 0 1px 2px rgba(0,0,0,.3);--shadow-sm: 0 1px 3px rgba(0,0,0,.4);--shadow-md: 0 2px 4px rgba(0,0,0,.5);--shadow-lg: 0 4px 6px rgba(0,0,0,.5);--surface-overlay-light: rgba(40, 40, 40, .85);--surface-overlay-light-strong: rgba(30, 30, 30, .95);--border-color-semitransparent: rgba(255, 255, 255, .1);--status-inactive-fg: hsl(0, 0%, 100.8823529412%);--status-inactive-bg: #383838;--primary-bg-subtle: rgba(63, 81, 181, .25);--surface-action-hover: rgb(55.5, 55.5, 55.5);--surface-button: var(--surface-color);--surface-button-hover: var(--surface-action-hover);--text-color-button: var(--text-color);--scrollbar-track-color: #333333;--scrollbar-thumb-color: #666666;--scrollbar-thumb-hover-color: #888888}.standard-panel-ui[_ngcontent-%COMP%]{background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-lg);overflow:hidden;display:flex;flex-direction:column}.standard-panel-ui[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .layer-control-header[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-md);background-color:var(--surface-lighter);border-bottom:1px solid var(--border-color)}.standard-panel-ui[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .layer-control-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:var(--font-size-md);font-weight:500;color:var(--text-color)}.standard-panel-ui[_ngcontent-%COMP%]   .panel-content[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .layer-content[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-content[_ngcontent-%COMP%]{padding:var(--spacing-md);flex-grow:1;overflow-y:auto;color:var(--text-color)}.standard-panel-ui[_ngcontent-%COMP%]   .panel-actions[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:var(--spacing-sm);padding:var(--spacing-sm) var(--spacing-md);border-top:1px solid var(--border-color)}.standard-panel-ui[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]{display:flex;margin-bottom:var(--spacing-sm)}.standard-panel-ui[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]   .info-label[_ngcontent-%COMP%]{width:100px;font-weight:500;color:var(--text-secondary-color)}.standard-panel-ui[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]   .info-value[_ngcontent-%COMP%]{flex:1;color:var(--text-color)}.simple-panel-ui[_ngcontent-%COMP%]{background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-lg);padding:var(--spacing-md);color:var(--text-color)}.side-panel[_ngcontent-%COMP%]{background-color:var(--surface-color);border-radius:var(--border-radius-sm, 4px);box-shadow:var(--shadow-sm, 0 2px 10px rgba(0, 0, 0, .08));height:100%;width:var(--side-panel-width, 320px);display:flex;flex-direction:column;overflow:hidden}@media (max-width: 768px){.side-panel[_ngcontent-%COMP%]{width:var(--side-panel-width-tablet, 280px)}}@media (max-width: 600px){.side-panel[_ngcontent-%COMP%]{width:var(--side-panel-width-mobile, 100%);max-width:100vw}}.side-panel[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%], .side-panel[_ngcontent-%COMP%]   .layer-control-header[_ngcontent-%COMP%]{height:var(--panel-header-height, 44px);min-height:var(--panel-header-height, 44px);display:flex;align-items:center;justify-content:space-between;padding:0 var(--spacing-sm);border-bottom:1px solid var(--border-color, rgba(0, 0, 0, .1))}.side-panel[_ngcontent-%COMP%]   .panel-content[_ngcontent-%COMP%], .side-panel[_ngcontent-%COMP%]   .layer-content[_ngcontent-%COMP%]{flex:1;overflow:auto}.map-base-container[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;overflow:hidden;background-color:var(--background-color);transition:background-color var(--transition-normal)}.network-design[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}.network-design__toolbar[_ngcontent-%COMP%]{padding:0 var(--spacing-md);background-color:var(--primary-color);color:var(--primary-contrast-color);box-shadow:var(--shadow-md)}.network-design__header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-md);background-color:var(--primary-color);color:var(--primary-contrast-color);box-shadow:var(--shadow-md)}.network-design__header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:var(--font-size-xl);font-weight:500}.network-design__main[_ngcontent-%COMP%]{flex:1;display:flex;overflow:hidden;position:relative;padding:var(--spacing-md);background-color:var(--surface-color)}@media (max-width: 768px){.network-design__main[_ngcontent-%COMP%]{margin-left:0;padding:var(--spacing-sm)}}.network-design__main[_ngcontent-%COMP%]   .network-design__map[_ngcontent-%COMP%]{flex:1;position:relative;border-radius:var(--border-radius-md);overflow:hidden;box-shadow:var(--shadow-md);background-color:var(--surface-darker)}.network-design__main[_ngcontent-%COMP%]   .network-design__sidebar[_ngcontent-%COMP%]{width:300px;padding:var(--spacing-md);background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-md);margin-left:var(--spacing-md);overflow-y:auto;border-right:1px solid var(--border-color)}@media (max-width: 768px){.network-design__main[_ngcontent-%COMP%]   .network-design__sidebar[_ngcontent-%COMP%]{width:100%;position:fixed;top:0;left:0;height:100%;z-index:1000;transform:translate(-100%);transition:transform var(--transition-normal);margin-left:0;border-right:none}.network-design__main[_ngcontent-%COMP%]   .network-design__sidebar--open[_ngcontent-%COMP%]{transform:translate(0)}}.network-design__footer[_ngcontent-%COMP%]{padding:var(--spacing-md);background-color:var(--surface-lighter);border-top:1px solid var(--border-color);font-size:var(--font-size-sm);color:var(--text-color)}.network-design__element[_ngcontent-%COMP%]{padding:var(--spacing-md);margin-bottom:var(--spacing-md);background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-sm);transition:box-shadow var(--transition-fast)}.network-design__element[_ngcontent-%COMP%]:hover{box-shadow:var(--shadow-md)}.network-design__element--selected[_ngcontent-%COMP%]{border-left:4px solid var(--primary-color)}.status-badge-base[_ngcontent-%COMP%], .status-maintenance[_ngcontent-%COMP%], .status-warning[_ngcontent-%COMP%], .status-fault[_ngcontent-%COMP%], .status-inactive[_ngcontent-%COMP%], .status-active[_ngcontent-%COMP%]{display:inline-block;padding:var(--spacing-xs) var(--spacing-sm);border-radius:var(--border-radius-sm);font-size:var(--font-size-sm);font-weight:500}.status-active[_ngcontent-%COMP%]{background-color:var(--color-success-bg);color:var(--color-success-contrast)}.status-inactive[_ngcontent-%COMP%]{background-color:var(--status-inactive-bg);color:var(--status-inactive-fg)}.status-fault[_ngcontent-%COMP%]{background-color:var(--color-danger-bg);color:var(--color-danger-contrast)}.status-warning[_ngcontent-%COMP%]{background-color:var(--color-warning-bg);color:var(--color-warning-contrast)}.status-maintenance[_ngcontent-%COMP%]{background-color:var(--color-maintenance-bg);color:var(--color-maintenance-contrast)}.network-utils__status-badge[_ngcontent-%COMP%]{display:inline-block;padding:var(--spacing-xs) var(--spacing-sm);border-radius:var(--border-radius-sm);font-size:var(--font-size-xs);font-weight:500;text-transform:uppercase}.network-utils__status-badge--active[_ngcontent-%COMP%]{background-color:var(--color-success-bg);color:var(--color-success-contrast)}.network-utils__status-badge--inactive[_ngcontent-%COMP%]{background-color:var(--status-inactive-bg);color:var(--status-inactive-fg)}.network-utils__status-badge--maintenance[_ngcontent-%COMP%]{background-color:var(--color-maintenance-bg);color:var(--color-maintenance-contrast)}.network-utils__loading[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:var(--spacing-lg);color:var(--text-color)}.network-utils__error[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-md);background-color:#ffebee;color:var(--color-danger);border-radius:var(--border-radius-md)}.layer-control-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;position:absolute;z-index:var(--z-index-floating-panel, 1000);background-color:var(--floating-panel-bg, var(--surface-ground, #fff));border-radius:var(--border-radius-md, 6px);box-shadow:var(--floating-panel-shadow, 0 2px 10px rgba(0, 0, 0, .1));min-width:var(--floating-panel-min-width, 280px);max-width:var(--floating-panel-max-width, 450px);max-height:var(--floating-panel-max-height, 85vh);overflow:hidden;--floating-panel-bg: var(--surface-color, #fff);--floating-panel-color: var(--text-color, #333);--floating-panel-shadow: var(--floating-panel-shadow, 0 6px 24px rgba(0, 0, 0, .25), 0 1.5px 4px rgba(0, 0, 0, .15));--floating-panel-header-bg: var(--primary-color, #3f51b5);--floating-panel-header-color: var(--primary-contrast-color, white);width:var(--layer-control-width, 300px);max-height:var(--layer-control-max-height, 80vh);z-index:var(--z-index-layer-control, 1001);max-width:320px;margin:0;--floating-panel-content-padding: 0;--floating-panel-header-title-size: var(--font-size-md, 16px)}.layer-control-container[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%], .layer-control-container[_ngcontent-%COMP%]   .layer-control-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:var(--floating-panel-header-padding, 10px) var(--floating-panel-header-padding-x, var(--spacing-md, 16px));border-bottom:var(--floating-panel-header-border, 1px solid var(--border-color-light, rgba(0, 0, 0, .08)));background-color:var(--floating-panel-header-bg, var(--surface-a, #f8f9fa));color:var(--floating-panel-header-color, var(--text-color-secondary, #495057));border-top-left-radius:inherit;border-top-right-radius:inherit;flex-shrink:0}.layer-control-container[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%]   .panel-title[_ngcontent-%COMP%], .layer-control-container[_ngcontent-%COMP%]   .layer-control-header[_ngcontent-%COMP%]   .panel-title[_ngcontent-%COMP%]{font-weight:var(--floating-panel-title-weight, 600);font-size:var(--floating-panel-title-font-size, var(--font-size-md, 1rem));margin:0;flex-grow:1;line-height:1.4}.layer-control-container[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%]   .panel-actions[_ngcontent-%COMP%], .layer-control-container[_ngcontent-%COMP%]   .layer-control-header[_ngcontent-%COMP%]   .panel-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-xs, 8px)}.layer-control-container[_ngcontent-%COMP%]   .panel-content[_ngcontent-%COMP%], .layer-control-container[_ngcontent-%COMP%]   .layer-content[_ngcontent-%COMP%]{padding:var(--floating-panel-content-padding, var(--spacing-md, 16px));max-height:var(--floating-panel-content-max-height, calc(85vh - 100px) );overflow-x:hidden;overflow-y:auto;flex-grow:1;background-color:var(--floating-panel-content-bg, var(--surface-ground, #fff))}.layer-control-container[_ngcontent-%COMP%]   .panel-content.no-padding[_ngcontent-%COMP%], .layer-control-container[_ngcontent-%COMP%]   .no-padding.layer-content[_ngcontent-%COMP%]{padding:0}.layer-control-container[_ngcontent-%COMP%]   .panel-footer[_ngcontent-%COMP%], .layer-control-container[_ngcontent-%COMP%]   .layer-control-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center;padding:var(--floating-panel-footer-padding, var(--spacing-sm, 12px)) var(--floating-panel-footer-padding-x, var(--spacing-md, 16px));border-top:var(--floating-panel-footer-border, 1px solid var(--border-color-light, rgba(0, 0, 0, .08)));background-color:var(--floating-panel-footer-bg, var(--surface-a, #f8f9fa));border-bottom-left-radius:inherit;border-bottom-right-radius:inherit;flex-shrink:0;gap:var(--spacing-sm, 8px)}@media (max-width: 768px){.layer-control-container[_ngcontent-%COMP%]{width:var(--layer-control-width-tablet, 280px);max-height:var(--layer-control-max-height-tablet, 50vh)}}.layer-control-panel[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%;height:100%}.layer-control-header[_ngcontent-%COMP%]{padding:var(--spacing-xs, 8px) var(--spacing-sm, 12px)}.layer-control-header[_ngcontent-%COMP%]   .header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-sm, 8px)}.layer-control-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-weight:var(--floating-panel-title-weight, 500);font-size:var(--floating-panel-header-title-size);color:var(--floating-panel-header-color, inherit)}.layer-control-header[_ngcontent-%COMP%]   .drag-handle-button[_ngcontent-%COMP%], .layer-control-header[_ngcontent-%COMP%]   .layer-toggle-button[_ngcontent-%COMP%]{width:32px;height:32px;line-height:32px;color:var(--floating-panel-header-color, inherit)}.layer-control-header[_ngcontent-%COMP%]   .drag-handle-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .layer-control-header[_ngcontent-%COMP%]   .layer-toggle-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.layer-content[_ngcontent-%COMP%]{padding:var(--spacing-md, 16px);overflow-y:auto;flex-grow:1}.layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]{margin-bottom:var(--spacing-md, 16px)}.layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]:last-child{margin-bottom:0}.layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]   .group-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-sm, 8px) var(--spacing-xs, 4px);background-color:var(--surface-lighter, rgba(0, 0, 0, .03));border-radius:var(--border-radius-sm, 4px);cursor:pointer;margin-bottom:var(--spacing-sm, 8px)}.layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]   .group-header[_ngcontent-%COMP%]:hover{background-color:var(--surface-hover, rgba(0, 0, 0, .06))}.layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]   .group-header[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{flex:1;font-weight:500;font-size:var(--font-size-sm, 14px);color:var(--text-secondary-color)}.layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]   .group-header[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px;color:var(--text-hint-color)}.layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]   .layer-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:var(--spacing-sm, 8px);border-radius:var(--border-radius-sm, 4px);cursor:pointer;gap:var(--spacing-sm, 8px);margin-bottom:var(--spacing-xs, 4px)}.layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]   .layer-item[_ngcontent-%COMP%]:hover{background-color:var(--surface-hover, rgba(0, 0, 0, .04))}.layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]   .layer-item.active[_ngcontent-%COMP%]{background-color:var(--primary-bg-subtle, rgba(var(--primary-color-rgb, 63, 81, 181), .1))}.layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]   .layer-item.active[_ngcontent-%COMP%]   .layer-name[_ngcontent-%COMP%]{font-weight:500;color:var(--primary-color, #3f51b5)}.layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]   .layer-item[_ngcontent-%COMP%]   .layer-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px;color:var(--text-secondary-color)}.layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]   .layer-item[_ngcontent-%COMP%]   .layer-icon.active[_ngcontent-%COMP%]{color:var(--primary-color, #3f51b5)}.layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]   .layer-item[_ngcontent-%COMP%]   .layer-name[_ngcontent-%COMP%]{flex:1;font-size:var(--font-size-sm, 14px);color:var(--text-color);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]   .layer-item[_ngcontent-%COMP%]   .layer-status[_ngcontent-%COMP%], .layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]   .layer-item[_ngcontent-%COMP%]   .layer-toggle[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px;color:var(--primary-color, #3f51b5);opacity:.8}.layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]   .layer-item.active[_ngcontent-%COMP%]   .layer-status[_ngcontent-%COMP%], .layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]   .layer-item.active[_ngcontent-%COMP%]   .layer-toggle[_ngcontent-%COMP%]{opacity:1}.layer-content[_ngcontent-%COMP%]   .layer-group[_ngcontent-%COMP%]   .no-layers-message[_ngcontent-%COMP%]{padding:var(--spacing-sm, 8px);color:var(--text-hint-color);font-size:var(--font-size-sm, 13px);text-align:center}.layer-control-footer[_ngcontent-%COMP%]{padding:var(--spacing-sm, 8px) var(--spacing-md, 16px);text-align:center}.layer-control-footer[_ngcontent-%COMP%]   .drag-hint[_ngcontent-%COMP%]{font-size:var(--font-size-xs, 12px);color:var(--text-hint-color)}@media (max-width: 480px){.layer-control-container[_ngcontent-%COMP%]{width:calc(100% - 32px);max-height:calc(100vh - 80px)}}@media (max-width: 480px) and (max-width: 480px){.layer-control-container[_ngcontent-%COMP%]{width:100%;height:auto;max-height:var(--floating-panel-max-height-mobile, calc(100dvh - 40px) );inset:auto 0 0!important;border-radius:var(--floating-panel-radius-mobile-top, 16px 16px 0 0);margin:0;transform:none!important;box-shadow:var(--floating-panel-shadow-mobile, 0 -4px 15px rgba(0, 0, 0, .12));position:fixed!important;z-index:var(--z-index-fullscreen-mobile-panel, 1050);min-width:100%;min-height:auto}.layer-control-container[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%], .layer-control-container[_ngcontent-%COMP%]   .layer-control-header[_ngcontent-%COMP%]{padding-top:var(--spacing-md, 16px);padding-bottom:var(--spacing-md, 16px)}.layer-control-container[_ngcontent-%COMP%]   .panel-content[_ngcontent-%COMP%], .layer-control-container[_ngcontent-%COMP%]   .layer-content[_ngcontent-%COMP%]{max-height:var(--floating-panel-content-max-height-mobile, calc(100dvh - 120px) )}.layer-control-container[_ngcontent-%COMP%]   .panel-footer[_ngcontent-%COMP%], .layer-control-container[_ngcontent-%COMP%]   .layer-control-footer[_ngcontent-%COMP%]{padding-bottom:var(--spacing-md, 16px)}}']})}}return o})();var dd=(()=>{class o{constructor(e,t,n,r){this.elementManager=e,this.mapStateManager=t,this.logger=n,this.fb=r,this.showFilters=!0,this.position="left",this.elementSelected=new H,this.isExpanded=!0,this.activeTab="elements",this.viewMode="list",this.searchControl=new ol(""),this.searchResults=[],this.isSearching=!1,this.elements=[],this.filteredElements=[],this.selectedElement=null,this.elementTypeFilter=null,this.pageSize=20,this.currentPage=1,this.totalPages=1,this.totalItems=0,this.elementTypes=Object.values(s),this.elementStatuses=Object.values(B),this.savedFilterSets=[],this.activeAdvancedFilters=[],this.customAttributes=[],this.favoriteElements=[],this.showOnlyFavorites=!1,this.destroy$=new N,this.isLoadingFilters=!1,this.isLoadingElements=!1,this.networkDesignService=P(wo)}ngOnInit(){this.advancedFiltersForm=this.fb.group({types:[[]],statuses:[[]],text:[""],createdFrom:[""],createdTo:[""],capacityMin:[""],capacityMax:[""],isWaterproof:[!1]}),this.applyFilters(),this.loadFavorites(),this.searchControl.valueChanges.pipe(On(300),mt(),L(this.destroy$)).subscribe(e=>{this.performSearch(e)})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}toggleExpansion(){this.isExpanded=!this.isExpanded,this.isExpanded&&setTimeout(()=>window.dispatchEvent(new Event("resize")),300)}detectCustomAttributes(){try{let e=new Map;for(let t of this.elements){let n=t.properties;if(n)for(let a of Object.keys(n)){let l=n[a];e.has(a)||e.set(a,{type:typeof l,values:new Set}),e.get(a).values.add(l)}let r=t.metadata;if(r)for(let a of Object.keys(r)){let l=r[a];e.has(a)||e.set(a,{type:typeof l,values:new Set}),e.get(a).values.add(l)}}this.customAttributes=Array.from(e.entries()).map(([t,n])=>({key:t,label:this.formatAttributeLabel(t),type:n.type,values:Array.from(n.values).filter(r=>r!=null)}));for(let t of this.customAttributes)this.advancedFiltersForm.get(t.key)||this.advancedFiltersForm.addControl(t.key,this.fb.control(""))}catch(e){this.handleError("Error al detectar atributos personalizados",e)}}formatAttributeLabel(e){return e.replace(/_/g," ").replace(/([A-Z])/g," $1").replace(/^./,t=>t.toUpperCase())}applyFilters(){let e={page:this.currentPage,pageSize:this.pageSize,filter:{}};this.elementTypeFilter;let t=this.advancedFiltersForm.value;t.text&&(e.filter.name=t.text),t.statuses&&t.statuses.length>0&&(e.filter.status=t.statuses.join(",")),this.loadElementsFromServer(this.elementTypeFilter,e)}loadElementsFromServer(e,t){if(!e){this.logger.info("loadElementsFromServer: No se especific\xF3 ElementType. No se cargar\xE1n elementos."),this.elements=[],this.filteredElements=[],this.totalItems=0,this.updatePagination();return}this.isLoadingElements=!0,this.networkDesignService.getElementsByType(e,t).pipe(L(this.destroy$),fi(()=>this.isLoadingElements=!1)).subscribe({next:n=>{this.elements=n.items,this.totalItems=n.totalItems,this.pageSize=n.pageSize,this.currentPage=n.currentPage,this.detectCustomAttributes();let r=[...this.elements];this.showOnlyFavorites&&(r=r.filter(a=>this.isFavorite(a))),this.filteredElements=r,this.updatePagination()},error:n=>{this.handleError(`Error al cargar elementos de tipo ${e} desde el servidor`,n),this.elements=[],this.filteredElements=[],this.totalItems=0,this.updatePagination()}})}updatePagination(){this.totalPages=Math.max(1,Math.ceil(this.totalItems/this.pageSize))}getCurrentPageElements(){return this.filteredElements}performSearch(e){this.isSearching=!0;try{if(!e){this.searchResults=[],this.isSearching=!1;return}let t=e.toLowerCase();this.searchResults=this.elements.filter(n=>n.id?.toString().toLowerCase().includes(t)||n.name?.toLowerCase().includes(t)||n.description&&n.description.toLowerCase().includes(t)||n.notes&&n.notes.toLowerCase().includes(t))}catch(t){this.handleError("Error al realizar b\xFAsqueda",t)}finally{this.isSearching=!1}}selectElement(e){this.selectedElement=e,this.elementSelected.emit(e);try{typeof this.mapStateManager.highlightElement=="function"?this.mapStateManager.highlightElement(e.id):this.elementManager.selectElement(e.id||"")}catch(t){this.logger.warn("No se pudo resaltar el elemento en el mapa",t)}}filterByType(e){this.elementTypeFilter=e,this.currentPage=1,this.applyFilters()}setActiveTab(e){this.activeTab=e}toggleViewMode(){this.viewMode=this.viewMode==="list"?"grid":"list"}dropElement(e){Go(this.filteredElements,e.previousIndex,e.currentIndex)}loadFavorites(){try{let e=localStorage.getItem("favorite-elements");if(e){let t=JSON.parse(e);this.favoriteElements=this.elements.filter(n=>t.includes(n.id||""))}}catch(e){this.logger.warn("Error al cargar favoritos",e)}}saveFavorites(){try{let e=this.favoriteElements.map(t=>t.id||"");localStorage.setItem("favorite-elements",JSON.stringify(e))}catch(e){this.logger.warn("Error al guardar favoritos",e)}}isFavorite(e){return this.favoriteElements.some(t=>t.id===e.id)}toggleFavorite(e,t){t&&t.stopPropagation(),this.isFavorite(e)?this.favoriteElements=this.favoriteElements.filter(n=>n.id!==e.id):this.favoriteElements.push(e),this.saveFavorites(),this.showOnlyFavorites&&this.applyFilters()}toggleFavoritesFilter(){this.showOnlyFavorites=!this.showOnlyFavorites,this.applyFilters()}getElementTypeIcon(e){return{[s.SPLITTER]:"call_split",[s.OLT]:"router",[s.ONT]:"device_hub",[s.FDP]:"account_tree",[s.FIBER_CABLE]:"timeline",[s.EDFA]:"settings_input_component",[s.FIBER_SPLICE]:"fiber_smart_record",[s.ODF]:"grid_on",[s.ROADM]:"hub",[s.PATCH_PANEL]:"dns"}[e]||"category"}getElementTypeColor(e){return{[s.SPLITTER]:"#4caf50",[s.OLT]:"#2196f3",[s.ONT]:"#9c27b0",[s.FDP]:"#ff9800",[s.FIBER_CABLE]:"#607d8b",[s.EDFA]:"#e91e63",[s.FIBER_SPLICE]:"#00bcd4",[s.ODF]:"#8bc34a",[s.ROADM]:"#673ab7",[s.PATCH_PANEL]:"#795548"}[e]||"#757575"}goToPage(e){e>=1&&e<=this.totalPages&&e!==this.currentPage&&(this.currentPage=e,this.applyFilters())}handleError(e,t){this.logger.error(e,t),console.error(`${e}: ${t?.message||"Error desconocido"}`)}static{this.\u0275fac=function(t){return new(t||o)(A(Jn),A(bt),A(K),A(no))}}static{this.\u0275dir=gn({type:o,inputs:{showFilters:"showFilters",position:"position"},outputs:{elementSelected:"elementSelected"}})}}return o})();var Ch=(o,i)=>({expanded:o,"cdk-drag-disabled":i});function yh(o,i){o&1&&(c(0,"h3",7),p(1,"Elementos"),d())}function Eh(o,i){if(o&1){let e=V();c(0,"button",11),y("click",function(){b(e);let n=v(2);return C(n.setActiveTab("filters"))}),p(1,"Filtros"),d()}if(o&2){let e=v(2);Z("active",e.activeTab==="filters")}}function wh(o,i){if(o&1){let e=V();c(0,"button",11),y("click",function(){let n=b(e).$implicit,r=v(3);return C(r.filterByType(n))}),p(1),d()}if(o&2){let e=i.$implicit,t=v(3);Z("selected",t.elementTypeFilter===e),m(),x(e)}}function xh(o,i){if(o&1){let e=V();c(0,"div",22),y("click",function(){let n=b(e).$implicit,r=v(3);return C(r.selectElement(n))}),c(1,"div",23),p(2),d(),c(3,"div",24),p(4),d(),c(5,"div",25),p(6),d()()}if(o&2){let e=i.$implicit,t=v(3);Z("selected",(t.selectedElement==null?null:t.selectedElement.id)===e.id),m(2),x(e.id),m(2),x(e.type),m(2),x(e.name||"Sin nombre")}}function Sh(o,i){o&1&&(c(0,"div",26),p(1," No hay elementos para mostrar "),d())}function Mh(o,i){if(o&1){let e=V();c(0,"div",27)(1,"button",28),y("click",function(){b(e);let n=v(3);return C(n.goToPage(n.currentPage-1))}),p(2,"Anterior"),d(),c(3,"span"),p(4),d(),c(5,"button",28),y("click",function(){b(e);let n=v(3);return C(n.goToPage(n.currentPage+1))}),p(6,"Siguiente"),d()()}if(o&2){let e=v(3);m(),h("disabled",e.currentPage===1),m(3),Dn("",e.currentPage," / ",e.totalPages,""),m(),h("disabled",e.currentPage===e.totalPages)}}function Ph(o,i){if(o&1){let e=V();c(0,"div",14)(1,"div",15)(2,"span"),p(3,"Filtrar por tipo:"),d(),c(4,"div",16)(5,"button",11),y("click",function(){b(e);let n=v(2);return C(n.filterByType(null))}),p(6,"Todos"),d(),E(7,wh,2,3,"button",17),d()(),c(8,"div",18),E(9,xh,7,5,"div",19)(10,Sh,2,0,"div",20),d(),E(11,Mh,7,4,"div",21),d()}if(o&2){let e=v(2);m(5),Z("selected",e.elementTypeFilter===null),m(2),h("ngForOf",e.elementTypes),m(2),h("ngForOf",e.getCurrentPageElements()),m(),h("ngIf",e.getCurrentPageElements().length===0),m(),h("ngIf",e.totalPages>1)}}function Th(o,i){if(o&1){let e=V();c(0,"button",37),y("click",function(){b(e);let n=v(3);return C(n.searchControl.setValue(""))}),p(1,"\u2715"),d()}}function Oh(o,i){o&1&&(c(0,"span",38),p(1,"\u{1F50D}"),d())}function kh(o,i){o&1&&D(0,"div",39)}function Ih(o,i){if(o&1){let e=V();c(0,"div",22),y("click",function(){let n=b(e).$implicit,r=v(3);return C(r.selectElement(n))}),c(1,"div",23),p(2),d(),c(3,"div",24),p(4),d(),c(5,"div",25),p(6),d()()}if(o&2){let e=i.$implicit,t=v(3);Z("selected",(t.selectedElement==null?null:t.selectedElement.id)===e.id),m(2),x(e.id),m(2),x(e.type),m(2),x(e.name||"Sin nombre")}}function Dh(o,i){o&1&&(c(0,"div",40),p(1," No se encontraron resultados "),d())}function Ah(o,i){o&1&&(c(0,"div",41),p(1," Ingresa un texto para buscar "),d())}function Rh(o,i){if(o&1&&(c(0,"div",14)(1,"div",29)(2,"div",30),D(3,"input",31),E(4,Th,2,0,"button",32)(5,Oh,2,0,"span",33)(6,kh,1,0,"div",34),d(),c(7,"div",18),E(8,Ih,7,5,"div",19)(9,Dh,2,0,"div",35)(10,Ah,2,0,"div",36),d()()()),o&2){let e=v(2);m(3),h("formControl",e.searchControl),m(),h("ngIf",e.searchControl.value),m(),h("ngIf",!e.isSearching),m(),h("ngIf",e.isSearching),m(2),h("ngForOf",e.searchResults),m(),h("ngIf",e.searchResults.length===0&&e.searchControl.value),m(),h("ngIf",!e.searchControl.value)}}function Nh(o,i){if(o&1&&(c(0,"option",50),p(1),d()),o&2){let e=i.$implicit;h("value",e),m(),x(e)}}function Lh(o,i){if(o&1){let e=V();c(0,"div",14)(1,"div",42)(2,"form",43),y("ngSubmit",function(){b(e);let n=v(2);return C(n.applyAdvancedFilters())}),c(3,"div",44)(4,"label"),p(5,"Tipo de elemento"),d(),c(6,"select",45),E(7,Nh,2,2,"option",46),d()(),c(8,"div",47)(9,"button",48),p(10,"Aplicar"),d(),c(11,"button",49),y("click",function(){b(e);let n=v(2);return C(n.resetAdvancedFilters())}),p(12,"Limpiar"),d()()()()()}if(o&2){let e=v(2);m(2),h("formGroup",e.advancedFiltersForm),m(5),h("ngForOf",e.elementTypes)}}function Fh(o,i){if(o&1){let e=V();c(0,"div",8)(1,"div",9)(2,"div",10)(3,"button",11),y("click",function(){b(e);let n=v();return C(n.setActiveTab("elements"))}),p(4,"Elementos"),d(),c(5,"button",11),y("click",function(){b(e);let n=v();return C(n.setActiveTab("search"))}),p(6,"B\xFAsqueda"),d(),E(7,Eh,2,2,"button",12),d(),E(8,Ph,12,6,"div",13)(9,Rh,11,7,"div",13)(10,Lh,13,2,"div",13),d()()}if(o&2){let e=v();m(3),Z("active",e.activeTab==="elements"),m(2),Z("active",e.activeTab==="search"),m(2),h("ngIf",e.showFilters),m(),h("ngIf",e.activeTab==="elements"),m(),h("ngIf",e.activeTab==="search"),m(),h("ngIf",e.activeTab==="filters"&&e.showFilters)}}var pd=(()=>{class o extends dd{constructor(e,t,n,r,a,l){super(e,t,n,r),this.snackBar=a,this.interactionService=l,this.autoUpdateOnMapMove=!0,this.isDraggable=!1,this.panelPosition=null,this.position="right",this.loadSavedPosition()}toggleDraggable(){this.isDraggable=!this.isDraggable,this.showMessage(this.isDraggable?"Panel desbloqueado":"Panel bloqueado")}onPanelDragEnded(e){if(this.isDraggable){let n=e.source.element.nativeElement.getBoundingClientRect();this.panelPosition={x:n.left,y:n.top},this.saveCurrentPosition()}}saveCurrentPosition(){if(this.panelPosition)try{localStorage.setItem("elements-panel-position",JSON.stringify(this.panelPosition))}catch(e){this.logger.warn("No se pudo guardar la posici\xF3n del panel",e)}}loadSavedPosition(){try{let e=localStorage.getItem("elements-panel-position");e&&(this.panelPosition=JSON.parse(e))}catch(e){this.logger.warn("No se pudo cargar la posici\xF3n guardada del panel",e)}}ngOnInit(){super.ngOnInit();let e=this.mapStateManager;this.autoUpdateOnMapMove&&e.mapMoved&&e.mapMoved.pipe(L(this.destroy$)).subscribe(()=>{this.logger.info("Map moved, re-applying filters to load elements from server."),this.applyFilters()})}loadElementsInMapBounds(){this.logger.info("loadElementsInMapBounds called, re-applying filters."),this.applyFilters()}showMessage(e){this.snackBar.open(e,"Cerrar",{duration:5e3,panelClass:["info-snackbar"]})}selectElement(e){super.selectElement(e),this.interactionService.selectElement(e)}toggleAutoUpdate(){this.autoUpdateOnMapMove=!this.autoUpdateOnMapMove,this.autoUpdateOnMapMove&&this.loadElementsInMapBounds()}handleError(e,t){super.handleError(e,t),this.showMessage(`${e}: ${t?.message||"Error desconocido"}`)}refreshElements(){this.logger.info("Refreshing elements by calling applyFilters()."),this.applyFilters(),this.showMessage("Panel de elementos actualizado")}applyAdvancedFilters(){this.applyFilters(),this.activeTab="elements",this.showMessage("Filtros aplicados al panel de mapa")}resetAdvancedFilters(){this.elementTypeFilter=null,this.applyFilters(),this.showMessage("Filtros restablecidos")}saveFilterSet(){this.showMessage("Esta funci\xF3n no est\xE1 disponible en el panel de mapa")}loadFilterSet(e){this.showMessage("Esta funci\xF3n no est\xE1 disponible en el panel de mapa")}removeActiveFilter(e){}static{this.\u0275fac=function(t){return new(t||o)(A(Jn),A(bt),A(K),A(no),A(qe),A(Po))}}static{this.\u0275cmp=Y({type:o,selectors:[["app-elements-panel"]],features:[un],decls:11,vars:11,consts:[["cdkDrag","",1,"elements-panel-container",3,"cdkDragEnded","ngClass","cdkDragDisabled","cdkDragBoundary"],["cdkDragHandle","",1,"panel-header",3,"mousedown"],["mat-icon-button","",3,"click","matTooltip"],["class","panel-title",4,"ngIf"],[1,"spacer"],["mat-icon-button","",3,"click"],["class","panel-content",4,"ngIf"],[1,"panel-title"],[1,"panel-content"],[1,"tab-container"],[1,"tab-header"],[3,"click"],[3,"active","click",4,"ngIf"],["class","tab-content",4,"ngIf"],[1,"tab-content"],[1,"quick-filter"],[1,"type-toggle-group"],[3,"selected","click",4,"ngFor","ngForOf"],[1,"elements-list"],["class","element-item",3,"selected","click",4,"ngFor","ngForOf"],["class","no-elements",4,"ngIf"],["class","pagination",4,"ngIf"],[1,"element-item",3,"click"],[1,"element-id"],[1,"element-type"],[1,"element-name"],[1,"no-elements"],[1,"pagination"],[3,"click","disabled"],[1,"search-container"],[1,"search-input"],["placeholder","Buscar por ID, nombre o descripci\xF3n",3,"formControl"],["class","clear-button",3,"click",4,"ngIf"],["class","search-icon",4,"ngIf"],["class","search-spinner",4,"ngIf"],["class","no-results",4,"ngIf"],["class","search-hint",4,"ngIf"],[1,"clear-button",3,"click"],[1,"search-icon"],[1,"search-spinner"],[1,"no-results"],[1,"search-hint"],[1,"filters-form"],[3,"ngSubmit","formGroup"],[1,"form-group"],["formControlName","types","multiple",""],[3,"value",4,"ngFor","ngForOf"],[1,"form-actions"],["type","submit",1,"primary-button"],["type","button",1,"secondary-button",3,"click"],[3,"value"]],template:function(t,n){t&1&&(c(0,"div",0),y("cdkDragEnded",function(a){return n.onPanelDragEnded(a)}),c(1,"div",1),y("mousedown",function(a){return a.stopPropagation()}),c(2,"button",2),y("click",function(){return n.toggleDraggable()}),c(3,"mat-icon"),p(4),d()(),E(5,yh,2,0,"h3",3),D(6,"span",4),c(7,"button",5),y("click",function(){return n.toggleExpansion()}),c(8,"mat-icon"),p(9),d()()(),E(10,Fh,11,8,"div",6),d()),t&2&&(h("ngClass",Qi(8,Ch,n.isExpanded,!n.isDraggable))("cdkDragDisabled",!n.isDraggable)("cdkDragBoundary",".map-container"),m(2),h("matTooltip",n.isDraggable?"Desactivar arrastre":"Activar arrastre"),m(2),x(n.isDraggable?"lock_open":"lock"),m(),h("ngIf",n.isExpanded),m(4),x(n.isExpanded?"chevron_left":"chevron_right"),m(),h("ngIf",n.isExpanded))},dependencies:[ee,ft,We,re,oo,rl,dl,ml,jn,pl,Un,il,sl,ll,cl,Ko,Wo,Ho,be,Be,pe,ue,Zn,Yn,Xn,Dl,Ke,Me,ke,_t,Nl,Qn,oc,on,en,Al,rc,Ll,ni,Fn,tn,ac],styles:[`:host{display:block;height:100%}.elements-panel-container{height:100%;width:320px;background:#fff;box-shadow:0 2px 10px #0000001a;display:flex;flex-direction:column;transition:width .3s ease;overflow:hidden}.elements-panel-container.expanded{width:320px}.elements-panel-container:not(.expanded){width:50px}.panel-header{height:48px;display:flex;align-items:center;padding:0 16px;background-color:#3f51b5;color:#fff;font-weight:500}.spacer{flex:1}.panel-content{flex:1;display:flex;flex-direction:column;overflow:hidden}.tab-container{display:flex;flex-direction:column;height:100%}.tab-header{display:flex;border-bottom:1px solid #e0e0e0}.tab-header button{flex:1;padding:12px;background:none;border:none;cursor:pointer;font-size:14px;color:#757575;transition:all .2s}.tab-header button.active{color:#3f51b5;border-bottom:2px solid #3f51b5;font-weight:500}.tab-content{flex:1;overflow-y:auto;padding:16px}.quick-filter{margin-bottom:16px}.quick-filter span{display:block;font-size:12px;margin-bottom:8px;color:#757575}.type-toggle-group{display:flex;flex-wrap:wrap;gap:4px}.type-toggle-group button{padding:6px 12px;font-size:12px;border:1px solid #e0e0e0;border-radius:4px;background:#fff;cursor:pointer;transition:all .2s}.type-toggle-group button.selected{background:#e3f2fd;border-color:#2196f3;color:#2196f3}.elements-list{display:flex;flex-direction:column;gap:4px}.element-item{padding:8px 12px;border-left:3px solid transparent;cursor:pointer;transition:all .2s}.element-item:hover{background-color:#f5f5f5}.element-item.selected{border-left-color:#3f51b5;background-color:#3f51b514}.element-id{font-weight:500;font-size:14px}.element-type{font-size:12px;color:#757575;margin-top:2px}.element-name{font-size:13px;margin-top:2px}.pagination{display:flex;justify-content:space-between;align-items:center;padding-top:16px;border-top:1px solid #f0f0f0;margin-top:16px}.pagination button{padding:6px 12px;background:#f5f5f5;border:1px solid #e0e0e0;border-radius:4px;cursor:pointer}.pagination button:disabled{opacity:.5;cursor:default}.search-container{display:flex;flex-direction:column;gap:16px}.search-input{position:relative;display:flex;align-items:center}.search-input input{width:100%;padding:10px 40px 10px 16px;border:1px solid #e0e0e0;border-radius:4px;font-size:14px}.search-icon,.clear-button{position:absolute;right:12px}.clear-button{border:none;background:none;cursor:pointer;color:#757575}.search-spinner{width:20px;height:20px;border:2px solid rgba(63,81,181,.3);border-top-color:#3f51b5;border-radius:50%;position:absolute;right:12px;animation:spin 1s linear infinite}@keyframes spin{to{transform:rotate(360deg)}}.no-elements,.no-results,.search-hint{text-align:center;color:#757575;font-style:italic;padding:20px 0}.filters-form{display:flex;flex-direction:column;gap:16px}.form-group{display:flex;flex-direction:column;gap:8px}.form-group label{font-size:12px;font-weight:500;color:#757575}.form-group select{padding:10px;border:1px solid #e0e0e0;border-radius:4px}.form-actions{display:flex;gap:8px;margin-top:16px}.primary-button{padding:8px 16px;background:#3f51b5;color:#fff;border:none;border-radius:4px;cursor:pointer}.secondary-button{padding:8px 16px;background:#fff;color:#3f51b5;border:1px solid #3f51b5;border-radius:4px;cursor:pointer}
`],encapsulation:2,data:{animation:[Ut("expandCollapse",[xi("expanded",he({width:"350px",opacity:1})),xi("collapsed",he({width:"0px",opacity:.9})),Mt("expanded <=> collapsed",ct("300ms ease-in-out"))]),Ut("fadeIn",[Mt(":enter",[he({opacity:0}),ct("200ms",he({opacity:1}))])])]}})}}return o})();var Je=function(o){return o.LOW="LOW",o.MEDIUM="MEDIUM",o.HIGH="HIGH",o.ULTRA="ULTRA",o.AUTO="AUTO",o}(Je||{}),md=(()=>{class o{constructor(){this.performanceService=P(ti),this.logger=P(K),this.performanceMetricsSubject=new ge({fps:0,renderTime:0,elementCount:0,memoryUsage:0,elapsed:0}),this.mapStatisticsSubject=new ge({totalElements:0,totalConnections:0,visibleConnections:0,totalAlerts:0,performanceLevel:"Desconocido",memoryUsageFormatted:"0 MB",loadTime:0}),this.optimizationConfigSubject=new ge({level:Je.AUTO,autoOptimize:!0,maxVisibleElements:1e3,clusteringEnabled:!0,virtualScrollingEnabled:!0}),this.performanceMetrics=this.performanceMetricsSubject.asObservable(),this.mapStatistics=this.mapStatisticsSubject.asObservable(),this.optimizationConfig=this.optimizationConfigSubject.asObservable(),this.lastPerformanceScore=0,this.initializeSubscriptions(),this.logger.debug("MapRenderingService inicializado - Adaptador para MapPerformanceService")}initializeSubscriptions(){this.performanceService.getMetrics().subscribe(e=>{this.performanceMetricsSubject.next(e),this.calculatePerformanceScore()}),this.performanceService.getMapStatistics().subscribe(e=>{this.mapStatisticsSubject.next(e)}),this.performanceService.config$.subscribe(e=>{this.optimizationConfigSubject.next({level:this.determineOptimizationLevel(e),autoOptimize:e.autoOptimize,maxVisibleElements:e.maxVisibleElements,clusteringEnabled:e.enableClustering,virtualScrollingEnabled:e.enableVirtualization})})}determineOptimizationLevel(e){return e.autoOptimize?Je.AUTO:e.enableClustering&&e.enableVirtualization?Je.HIGH:e.enableClustering||e.enableVirtualization?Je.MEDIUM:Je.LOW}calculatePerformanceScore(){let e=this.performanceMetricsSubject.value,t=Math.min(e.fps/60,1),n=Math.max(0,1-e.renderTime/100),r=1;e.elementCount>1e3&&(r=Math.max(.5,1e3/e.elementCount));let a=(t*.5+n*.3+r*.2)*100;return this.lastPerformanceScore=Math.round(a),this.lastPerformanceScore}setOptimizationLevel(e){let t=this.optimizationConfigSubject.value;this.optimizationConfigSubject.next(Q(k({},t),{level:e})),this.performanceService.updateConfig({autoOptimize:e===Je.AUTO,enableClustering:e!==Je.LOW,enableVirtualization:e===Je.HIGH||e===Je.ULTRA}),this.logger.debug(`Nivel de optimizaci\xF3n actualizado a: ${e}`)}setAutoOptimization(e){let t=this.optimizationConfigSubject.value;this.optimizationConfigSubject.next(Q(k({},t),{autoOptimize:e,level:e?Je.AUTO:t.level})),this.performanceService.updateConfig({autoOptimize:e}),this.logger.debug(`Optimizaci\xF3n autom\xE1tica ${e?"activada":"desactivada"}`)}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var aa=o=>({active:o}),Bh=(o,i,e,t)=>[o,i,e,t];function Vh(o,i){o&1&&(c(0,"span"),p(1,"Rendimiento"),d())}function $h(o,i){if(o&1&&(c(0,"div",23)(1,"div",24)(2,"span",25),p(3,"Elementos:"),d(),c(4,"span",20),p(5),d()(),c(6,"div",24)(7,"span",25),p(8,"Conexiones:"),d(),c(9,"span",20),p(10),d()(),c(11,"div",24)(12,"span",25),p(13,"Conexiones visibles:"),d(),c(14,"span",20),p(15),d()(),c(16,"div",24)(17,"span",25),p(18,"Memoria:"),d(),c(19,"span",20),p(20),d()(),c(21,"div",24)(22,"span",25),p(23,"Nivel:"),d(),c(24,"span",20),p(25),d()()()),o&2){let e=v(3);m(5),x(e.statistics.totalElements),m(5),x(e.statistics.totalConnections),m(5),x(e.statistics.visibleConnections),m(5),x(e.statistics.memoryUsageFormatted),m(5),x(e.statistics.performanceLevel)}}function jh(o,i){if(o&1&&(c(0,"div",13)(1,"div",14)(2,"div",15)(3,"span",16),p(4),d()(),c(5,"div",17),p(6,"Puntuaci\xF3n de rendimiento"),d()(),c(7,"div",18)(8,"div",19)(9,"div",20),p(10),d(),c(11,"div",21),p(12,"FPS"),d()(),c(13,"div",19)(14,"div",20),p(15),d(),c(16,"div",21),p(17,"ms"),d()()(),E(18,$h,26,5,"div",22),d()),o&2){let e=v(2);m(2),h("ngClass",e.getPerformanceClass()),m(2),x(e.performanceScore),m(6),x(e.formatFps(e.metrics.fps)),m(5),x(e.metrics.renderTime.toFixed(1)),m(3),h("ngIf",e.statistics)}}function Uh(o,i){if(o&1){let e=V();c(0,"button",35),y("click",function(){let n=b(e).$implicit,r=v(4);return C(r.setOptimizationLevel(n))}),p(1),d()}if(o&2){let e=i.$implicit,t=v(4);h("ngClass",xt(2,aa,t.currentOptimizationLevel===e)),m(),j(" ",e," ")}}function Gh(o,i){if(o&1&&(c(0,"div",27)(1,"label"),p(2,"Nivel de optimizaci\xF3n"),d(),c(3,"div",33),E(4,Uh,2,4,"button",34),d()()),o&2){let e=v(3);m(4),h("ngForOf",Ps(1,Bh,e.optLevels.LOW,e.optLevels.MEDIUM,e.optLevels.HIGH,e.optLevels.ULTRA))}}function Hh(o,i){o&1&&(c(0,"p"),p(1," La optimizaci\xF3n autom\xE1tica ajusta el rendimiento seg\xFAn las condiciones actuales. "),d())}function Wh(o,i){o&1&&(c(0,"p"),p(1," Has seleccionado optimizaci\xF3n manual. Selecciona el nivel adecuado para tu hardware. "),d())}function Kh(o,i){if(o&1){let e=V();c(0,"div",13)(1,"div",26)(2,"div",27)(3,"label"),p(4,"Optimizaci\xF3n autom\xE1tica"),d(),c(5,"div",28)(6,"input",29),y("change",function(){b(e);let n=v(2);return C(n.toggleAutoOptimization())}),d(),D(7,"span",30),d()(),E(8,Gh,5,6,"div",31),c(9,"div",32),E(10,Hh,2,0,"p",4)(11,Wh,2,0,"p",4),d()()()}if(o&2){let e=v(2);m(6),h("checked",e.autoOptimizationEnabled),m(2),h("ngIf",!e.autoOptimizationEnabled),m(2),h("ngIf",e.autoOptimizationEnabled),m(),h("ngIf",!e.autoOptimizationEnabled)}}function qh(o,i){if(o&1){let e=V();c(0,"div",9)(1,"div",10)(2,"button",11),y("click",function(){b(e);let n=v();return C(n.setActiveTab("performance"))}),p(3," M\xE9tricas "),d(),c(4,"button",11),y("click",function(){b(e);let n=v();return C(n.setActiveTab("optimization"))}),p(5," Optimizaci\xF3n "),d()(),E(6,jh,19,5,"div",12)(7,Kh,12,4,"div",12),d()}if(o&2){let e=v();m(2),h("ngClass",xt(4,aa,e.activeTab==="performance")),m(2),h("ngClass",xt(6,aa,e.activeTab==="optimization")),m(2),h("ngIf",e.activeTab==="performance"&&e.metrics),m(),h("ngIf",e.activeTab==="optimization")}}var gd=(()=>{class o{constructor(e,t){this.renderingService=e,this.cdr=t,this.expanded=!1,this.position="bottom-right",this.metrics=null,this.statistics=null,this.performanceScore=0,this.optLevels=Je,this.currentOptimizationLevel=Je.AUTO,this.autoOptimizationEnabled=!0,this.isExpanded=!1,this.activeTab="performance",this.destroy$=new N,this.updateView$=new N}ngOnInit(){this.isExpanded=this.expanded,this.updateView$.pipe(On(16),L(this.destroy$)).subscribe(()=>this.cdr.detectChanges()),this.renderingService.performanceMetrics.pipe(L(this.destroy$)).subscribe(e=>{this.metrics=e,this.performanceScore=this.renderingService.calculatePerformanceScore(),this.updateView$.next()}),this.renderingService.mapStatistics.pipe(L(this.destroy$)).subscribe(e=>{this.statistics=e,this.updateView$.next()}),this.renderingService.optimizationConfig.pipe(L(this.destroy$)).subscribe(e=>{this.currentOptimizationLevel=e.level,this.updateView$.next()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.updateView$.complete()}toggleExpand(){this.isExpanded=!this.isExpanded,this.cdr.markForCheck()}setActiveTab(e){this.activeTab!==e&&(this.activeTab=e,this.cdr.markForCheck())}setOptimizationLevel(e){e!==this.currentOptimizationLevel&&(Object.values(Je).includes(e)?(this.renderingService.setOptimizationLevel(e),this.currentOptimizationLevel=e,this.cdr.markForCheck()):console.warn(`Nivel de optimizaci\xF3n no v\xE1lido: ${e}`))}toggleAutoOptimization(){this.autoOptimizationEnabled=!this.autoOptimizationEnabled,this.renderingService.setAutoOptimization(this.autoOptimizationEnabled),this.cdr.markForCheck()}getPerformanceClass(){return this.performanceScore?this.performanceScore>=80?"high":this.performanceScore>=50?"medium":"low":"unknown"}formatFps(e){return e===void 0||isNaN(e)?"0":e.toFixed(0)}static{this.\u0275fac=function(t){return new(t||o)(A(md),A(He))}}static{this.\u0275cmp=Y({type:o,selectors:[["app-performance-widget"]],inputs:{expanded:"expanded",position:"position"},decls:11,vars:5,consts:[[1,"performance-widget",3,"ngClass"],[1,"panel-header"],[1,"panel-title"],[1,"fa","fa-tachometer-alt"],[4,"ngIf"],[1,"performance-indicator",3,"ngClass"],[1,"panel-actions"],["mat-icon-button","",3,"click"],["class","panel-content",4,"ngIf"],[1,"panel-content"],[1,"tabs"],[1,"tab-button",3,"click","ngClass"],["class","tab-content",4,"ngIf"],[1,"tab-content"],[1,"performance-score"],[1,"score-gauge",3,"ngClass"],[1,"score-value"],[1,"score-label"],[1,"metrics-grid"],[1,"metric-item"],[1,"metric-value"],[1,"metric-label"],["class","metrics-list",4,"ngIf"],[1,"metrics-list"],[1,"metric-row"],[1,"metric-name"],[1,"optimization-controls"],[1,"control-group"],[1,"toggle-switch"],["type","checkbox",3,"change","checked"],[1,"slider"],["class","control-group",4,"ngIf"],[1,"optimization-info"],[1,"optimization-levels"],["class","level-button",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"level-button",3,"click","ngClass"]],template:function(t,n){t&1&&(c(0,"div",0)(1,"div",1)(2,"h2",2),D(3,"i",3),E(4,Vh,2,0,"span",4),D(5,"div",5),d(),c(6,"div",6)(7,"button",7),y("click",function(){return n.toggleExpand()}),c(8,"mat-icon"),p(9),d()()()(),E(10,qh,8,8,"div",8),d()),t&2&&(h("ngClass",n.position),m(4),h("ngIf",n.isExpanded),m(),h("ngClass",n.getPerformanceClass()),m(4),x(n.isExpanded?"expand_less":"expand_more"),m(),h("ngIf",n.isExpanded))},dependencies:[ee,ft,We,re,pe,ue],styles:['@charset "UTF-8";[_ngcontent-%COMP%]:root{--primary-color: #3F51B5;--primary-rgb: 63, 81, 181;--primary-color-hover: rgb(52.4655737705, 67.4557377049, 150.7344262295);--accent-color: #FF4081;--warn-color: #F44336;--background-color: #F5F5F5;--surface-color: #ffffff;--surface-lighter: #f9f9f9;--surface-darker: #eeeeee;--text-color: #212121;--text-secondary-color: hsl(0, 0%, -12.0588235294%);--text-hint-color: hsl(0, 0%, -32.0588235294%);--text-disabled-color: hsl(0, 0%, -52.0588235294%);--primary-contrast-color: white;--accent-contrast-color: white;--warn-contrast-color: white;--olt-color: #4CAF50;--ont-color: #2196F3;--odf-color: #FFC107;--edfa-color: #9C27B0;--splitter-color: #FF5722;--manga-color: #607D8B;--terminal-box-color: #FF9800;--slack-fiber-color: #80DEEA;--spacing-unit: 4px;--spacing-xxs: .125rem;--spacing-xs: .25rem;--spacing-sm: .5rem;--spacing-md: .75rem;--spacing-lg: 1rem;--spacing-xl: 1.5rem;--spacing-xxl: 2rem;--shadow-xs: 0 1px 2px rgba(0,0,0,.05);--shadow-sm: 0 1px 3px rgba(0, 0, 0, .1);--shadow-md: 0 2px 4px rgba(0, 0, 0, .1);--shadow-lg: 0 4px 6px rgba(0, 0, 0, .1);--border-radius-sm: 2px;--border-radius-md: 4px;--border-radius-lg: 8px;--border-radius-round: 50%;--border-color: #e0e0e0;--border-width-normal: 1px;--border-width-strong: 4px;--border-radius-pill: 20px;--border-color-light: rgb(249.5, 249.5, 249.5);--border-color-dark: rgb(198.5, 198.5, 198.5);--color-success: #4caf50;--color-warning: #ff8f00;--color-danger: #c62828;--color-info: #2196F3;--color-neutral: #9e9e9e;--color-success-bg: #e8f5e9;--color-warning-bg: #fff8e1;--color-danger-bg: #ffebee;--color-info-bg: rgb(226.5384615385, 241.5384615385, 253.4615384615);--color-maintenance-bg: #e3f2fd;--status-inactive-fg: #757575;--status-inactive-bg: #f5f5f5;--color-success-contrast: white;--color-warning-contrast: white;--color-danger-contrast: white;--color-info-contrast: #212121;--color-maintenance-contrast: white;--font-family: "Roboto, Segoe UI, sans-serif";--font-size-xxs: .625rem;--font-size-xs: .75rem;--font-size-sm: .875rem;--font-size-md: 1rem;--font-size-lg: 1.125rem;--font-size-xl: 1.25rem;--font-size-xxl: 1.5rem;--font-size-display: 2.5rem;--transition-fast: .15s ease-in-out;--transition-normal: .3s ease-in-out;--transition-slow: .5s ease-in-out;--status-active: #4caf50;--status-inactive: #757575;--status-maintenance: #1565c0;--status-planning: #2196F3;--status-unknown: var(--color-neutral);--status-fault: #c62828;--surface-overlay-light: rgba(255, 255, 255, .85);--surface-overlay-light-strong: rgba(255, 255, 255, .95);--border-color-semitransparent: rgba(0, 0, 0, .1);--primary-bg-subtle: rgba(63, 81, 181, .15);--surface-action-hover: rgb(242.8571428571, 242.8571428571, 242.8571428571);--surface-button: var(--surface-color);--surface-button-hover: var(--surface-action-hover);--text-color-button: var(--text-color);--scrollbar-track-color: #f1f1f1;--scrollbar-thumb-color: #c1c1c1;--scrollbar-thumb-hover-color: #a8a8a8;--z-index-map-base: 1;--z-index-map-elements: 5;--z-index-map-widgets-overlay: 50;--z-index-map-overlay: 100;--z-index-network-design-panels: 900;--z-index-debug-info: 999;--z-index-floating-panel-base: 1000;--z-index-performance-widget: 1000;--z-index-elements-panel: 1001;--z-index-layer-control: 1001;--z-index-sidebar: 1005;--z-index-map-legend: 1005;--z-index-sidebar-mobile: 1010;--z-index-loading-overlay: 1050;--z-index-dialog: 1075;--z-index-toolbar: 1100;--z-index-tooltip: 1150;--z-index-map-controls: 1201;--toolbar-height: 46px;--toolbar-button-height: 30px;--toolbar-button-height-mobile: 32px;--action-button-height: 40px;--menu-item-height: 42px;--icon-size-sm: 18px;--icon-size-md: 20px;--tooltip-bg-color: rgba(33, 33, 33, .95);--primary-ripple-color: rgba(var(--primary-rgb), .1)}[_ngcontent-%COMP%]:root.dark-theme, body.dark-theme[_ngcontent-%COMP%]{--background-color: #121212;--surface-color: #1e1e1e;--surface-lighter: rgb(42.75, 42.75, 42.75);--surface-darker: #121212;--text-color: #e0e0e0;--text-secondary-color: rgb(185.75, 185.75, 185.75);--text-hint-color: rgb(147.5, 147.5, 147.5);--text-disabled-color: rgb(109.25, 109.25, 109.25);--border-color: #444444;--border-color-light: rgb(93.5, 93.5, 93.5);--border-color-dark: rgb(42.5, 42.5, 42.5);--color-success-bg: rgb(51.8181818182, 119.1818181818, 57);--color-warning-bg: rgb(174, 133.4, 0);--color-danger-bg: rgb(184, 0, 27.6);--color-info-bg: rgb(8.9230769231, 95.9230769231, 165.0769230769);--color-maintenance-bg: rgb(11.6, 98.6, 162.4);--shadow-xs: 0 1px 2px rgba(0,0,0,.3);--shadow-sm: 0 1px 3px rgba(0,0,0,.4);--shadow-md: 0 2px 4px rgba(0,0,0,.5);--shadow-lg: 0 4px 6px rgba(0,0,0,.5);--surface-overlay-light: rgba(40, 40, 40, .85);--surface-overlay-light-strong: rgba(30, 30, 30, .95);--border-color-semitransparent: rgba(255, 255, 255, .1);--status-inactive-fg: hsl(0, 0%, 100.8823529412%);--status-inactive-bg: #383838;--primary-bg-subtle: rgba(63, 81, 181, .25);--surface-action-hover: rgb(55.5, 55.5, 55.5);--surface-button: var(--surface-color);--surface-button-hover: var(--surface-action-hover);--text-color-button: var(--text-color);--scrollbar-track-color: #333333;--scrollbar-thumb-color: #666666;--scrollbar-thumb-hover-color: #888888}.standard-panel-ui[_ngcontent-%COMP%]{background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-lg);overflow:hidden;display:flex;flex-direction:column}.standard-panel-ui[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-md);background-color:var(--surface-lighter);border-bottom:1px solid var(--border-color)}.standard-panel-ui[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:var(--font-size-md);font-weight:500;color:var(--text-color)}.standard-panel-ui[_ngcontent-%COMP%]   .panel-content[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-content[_ngcontent-%COMP%]{padding:var(--spacing-md);flex-grow:1;overflow-y:auto;color:var(--text-color)}.standard-panel-ui[_ngcontent-%COMP%]   .panel-actions[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:var(--spacing-sm);padding:var(--spacing-sm) var(--spacing-md);border-top:1px solid var(--border-color)}.standard-panel-ui[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]{display:flex;margin-bottom:var(--spacing-sm)}.standard-panel-ui[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]   .info-label[_ngcontent-%COMP%]{width:100px;font-weight:500;color:var(--text-secondary-color)}.standard-panel-ui[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]   .info-value[_ngcontent-%COMP%]{flex:1;color:var(--text-color)}.simple-panel-ui[_ngcontent-%COMP%]{background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-lg);padding:var(--spacing-md);color:var(--text-color)}.side-panel[_ngcontent-%COMP%]{background-color:var(--surface-color);border-radius:var(--border-radius-sm, 4px);box-shadow:var(--shadow-sm, 0 2px 10px rgba(0, 0, 0, .08));height:100%;width:var(--side-panel-width, 320px);display:flex;flex-direction:column;overflow:hidden}@media (max-width: 768px){.side-panel[_ngcontent-%COMP%]{width:var(--side-panel-width-tablet, 280px)}}@media (max-width: 600px){.side-panel[_ngcontent-%COMP%]{width:var(--side-panel-width-mobile, 100%);max-width:100vw}}.side-panel[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%]{height:var(--panel-header-height, 44px);min-height:var(--panel-header-height, 44px);display:flex;align-items:center;justify-content:space-between;padding:0 var(--spacing-sm);border-bottom:1px solid var(--border-color, rgba(0, 0, 0, .1))}.side-panel[_ngcontent-%COMP%]   .panel-content[_ngcontent-%COMP%]{flex:1;overflow:auto}.map-base-container[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;overflow:hidden;background-color:var(--background-color);transition:background-color var(--transition-normal)}.network-design[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}.network-design__toolbar[_ngcontent-%COMP%]{padding:0 var(--spacing-md);background-color:var(--primary-color);color:var(--primary-contrast-color);box-shadow:var(--shadow-md)}.network-design__header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-md);background-color:var(--primary-color);color:var(--primary-contrast-color);box-shadow:var(--shadow-md)}.network-design__header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:var(--font-size-xl);font-weight:500}.network-design__main[_ngcontent-%COMP%]{flex:1;display:flex;overflow:hidden;position:relative;padding:var(--spacing-md);background-color:var(--surface-color)}@media (max-width: 768px){.network-design__main[_ngcontent-%COMP%]{margin-left:0;padding:var(--spacing-sm)}}.network-design__main[_ngcontent-%COMP%]   .network-design__map[_ngcontent-%COMP%]{flex:1;position:relative;border-radius:var(--border-radius-md);overflow:hidden;box-shadow:var(--shadow-md);background-color:var(--surface-darker)}.network-design__main[_ngcontent-%COMP%]   .network-design__sidebar[_ngcontent-%COMP%]{width:300px;padding:var(--spacing-md);background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-md);margin-left:var(--spacing-md);overflow-y:auto;border-right:1px solid var(--border-color)}@media (max-width: 768px){.network-design__main[_ngcontent-%COMP%]   .network-design__sidebar[_ngcontent-%COMP%]{width:100%;position:fixed;top:0;left:0;height:100%;z-index:1000;transform:translate(-100%);transition:transform var(--transition-normal);margin-left:0;border-right:none}.network-design__main[_ngcontent-%COMP%]   .network-design__sidebar--open[_ngcontent-%COMP%]{transform:translate(0)}}.network-design__footer[_ngcontent-%COMP%]{padding:var(--spacing-md);background-color:var(--surface-lighter);border-top:1px solid var(--border-color);font-size:var(--font-size-sm);color:var(--text-color)}.network-design__element[_ngcontent-%COMP%]{padding:var(--spacing-md);margin-bottom:var(--spacing-md);background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-sm);transition:box-shadow var(--transition-fast)}.network-design__element[_ngcontent-%COMP%]:hover{box-shadow:var(--shadow-md)}.network-design__element--selected[_ngcontent-%COMP%]{border-left:4px solid var(--primary-color)}.status-badge-base[_ngcontent-%COMP%], .status-maintenance[_ngcontent-%COMP%], .status-warning[_ngcontent-%COMP%], .status-fault[_ngcontent-%COMP%], .status-inactive[_ngcontent-%COMP%], .status-active[_ngcontent-%COMP%]{display:inline-block;padding:var(--spacing-xs) var(--spacing-sm);border-radius:var(--border-radius-sm);font-size:var(--font-size-sm);font-weight:500}.status-active[_ngcontent-%COMP%]{background-color:var(--color-success-bg);color:var(--color-success-contrast)}.status-inactive[_ngcontent-%COMP%]{background-color:var(--status-inactive-bg);color:var(--status-inactive-fg)}.status-fault[_ngcontent-%COMP%]{background-color:var(--color-danger-bg);color:var(--color-danger-contrast)}.status-warning[_ngcontent-%COMP%]{background-color:var(--color-warning-bg);color:var(--color-warning-contrast)}.status-maintenance[_ngcontent-%COMP%]{background-color:var(--color-maintenance-bg);color:var(--color-maintenance-contrast)}.network-utils__status-badge[_ngcontent-%COMP%]{display:inline-block;padding:var(--spacing-xs) var(--spacing-sm);border-radius:var(--border-radius-sm);font-size:var(--font-size-xs);font-weight:500;text-transform:uppercase}.network-utils__status-badge--active[_ngcontent-%COMP%]{background-color:var(--color-success-bg);color:var(--color-success-contrast)}.network-utils__status-badge--inactive[_ngcontent-%COMP%]{background-color:var(--status-inactive-bg);color:var(--status-inactive-fg)}.network-utils__status-badge--maintenance[_ngcontent-%COMP%]{background-color:var(--color-maintenance-bg);color:var(--color-maintenance-contrast)}.network-utils__loading[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:var(--spacing-lg);color:var(--text-color)}.network-utils__error[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-md);background-color:#ffebee;color:var(--color-danger);border-radius:var(--border-radius-md)}.performance-widget[_ngcontent-%COMP%]{display:flex;flex-direction:column;z-index:var(--z-index-floating-panel, 1000);background-color:var(--floating-panel-bg, var(--surface-ground, #fff));border-radius:var(--border-radius-md, 6px);box-shadow:var(--floating-panel-shadow, 0 2px 10px rgba(0, 0, 0, .1));min-width:var(--floating-panel-min-width, 280px);max-width:var(--floating-panel-max-width, 450px);max-height:var(--floating-panel-max-height, 85vh);overflow:hidden;bottom:var(--spacing-md, 16px);right:var(--spacing-md, 16px);min-width:var(--floating-panel-min-width-sm, 200px);max-width:var(--floating-panel-max-width-sm, 350px);--floating-panel-bg: var(--surface-color, #fff);--floating-panel-color: var(--text-color, #333);--floating-panel-shadow: var(--floating-panel-shadow, 0 6px 24px rgba(0, 0, 0, .25), 0 1.5px 4px rgba(0, 0, 0, .15));--floating-panel-header-bg: var(--primary-color, #3f51b5);--floating-panel-width: var(--performance-widget-width, 280px);--floating-panel-max-height: calc(70vh - 100px) ;--floating-panel-content-padding: 0;--floating-panel-header-border: none;--floating-panel-header-bg: var(--primary-color, #1976d2);--floating-panel-header-color: var(--primary-contrast-color, white);position:absolute;bottom:16px;right:16px;z-index:1000;max-width:280px;margin:0}.performance-widget[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:var(--floating-panel-header-padding, 10px) var(--floating-panel-header-padding-x, var(--spacing-md, 16px));border-bottom:var(--floating-panel-header-border, 1px solid var(--border-color-light, rgba(0, 0, 0, .08)));background-color:var(--floating-panel-header-bg, var(--surface-a, #f8f9fa));color:var(--floating-panel-header-color, var(--text-color-secondary, #495057));border-top-left-radius:inherit;border-top-right-radius:inherit;flex-shrink:0}.performance-widget[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%]   .panel-title[_ngcontent-%COMP%]{font-weight:var(--floating-panel-title-weight, 600);font-size:var(--floating-panel-title-font-size, var(--font-size-md, 1rem));margin:0;flex-grow:1;line-height:1.4}.performance-widget[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%]   .panel-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-xs, 8px)}.performance-widget[_ngcontent-%COMP%]   .panel-content[_ngcontent-%COMP%]{padding:var(--floating-panel-content-padding, var(--spacing-md, 16px));max-height:var(--floating-panel-content-max-height, calc(85vh - 100px) );overflow-x:hidden;overflow-y:auto;flex-grow:1;background-color:var(--floating-panel-content-bg, var(--surface-ground, #fff))}.performance-widget[_ngcontent-%COMP%]   .panel-content.no-padding[_ngcontent-%COMP%]{padding:0}.performance-widget[_ngcontent-%COMP%]   .panel-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center;padding:var(--floating-panel-footer-padding, var(--spacing-sm, 12px)) var(--floating-panel-footer-padding-x, var(--spacing-md, 16px));border-top:var(--floating-panel-footer-border, 1px solid var(--border-color-light, rgba(0, 0, 0, .08)));background-color:var(--floating-panel-footer-bg, var(--surface-a, #f8f9fa));border-bottom-left-radius:inherit;border-bottom-right-radius:inherit;flex-shrink:0;gap:var(--spacing-sm, 8px)}@media (max-width: 768px){.performance-widget[_ngcontent-%COMP%]{bottom:60px;right:8px;--floating-panel-width: 240px}}.performance-widget[_ngcontent-%COMP%]   .panel-title[_ngcontent-%COMP%]{display:flex;align-items:center}.performance-widget[_ngcontent-%COMP%]   .panel-title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .performance-widget[_ngcontent-%COMP%]   .panel-title[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:var(--spacing-xs, 8px);font-size:var(--icon-size-md, 16px)}.performance-widget[_ngcontent-%COMP%]   .performance-indicator[_ngcontent-%COMP%]{width:12px;height:12px;border-radius:50%;margin-left:var(--spacing-xs, 4px)}.performance-widget[_ngcontent-%COMP%]   .performance-indicator.high[_ngcontent-%COMP%]{background-color:var(--color-success, #4caf50)}.performance-widget[_ngcontent-%COMP%]   .performance-indicator.medium[_ngcontent-%COMP%]{background-color:var(--color-warning, #ff9800)}.performance-widget[_ngcontent-%COMP%]   .performance-indicator.low[_ngcontent-%COMP%]{background-color:var(--color-danger, #f44336)}.performance-widget[_ngcontent-%COMP%]   .performance-indicator.unknown[_ngcontent-%COMP%]{background-color:var(--color-neutral-light, #bdbdbd)}.tabs[_ngcontent-%COMP%]{display:flex;background-color:var(--surface-lighter, #f5f5f5);border-bottom:1px solid var(--border-color, #e0e0e0)}.tabs[_ngcontent-%COMP%]   .tab-button[_ngcontent-%COMP%]{flex:1;padding:var(--spacing-sm, 10px);background:none;border:none;font-size:var(--font-size-sm, 13px);color:var(--text-color, rgba(0, 0, 0, .87));cursor:pointer;transition:var(--transition-fast, .15s)}.tabs[_ngcontent-%COMP%]   .tab-button[_ngcontent-%COMP%]:hover{background-color:var(--surface-hover, #eeeeee)}.tabs[_ngcontent-%COMP%]   .tab-button.active[_ngcontent-%COMP%]{color:var(--primary-color, #1976d2);font-weight:500;border-bottom:2px solid var(--primary-color, #1976d2)}.tab-content[_ngcontent-%COMP%]{padding:var(--spacing-md, 15px)}.performance-score[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin-bottom:var(--spacing-lg, 20px)}.performance-score[_ngcontent-%COMP%]   .score-gauge[_ngcontent-%COMP%]{width:var(--gauge-size, 80px);height:var(--gauge-size, 80px);border-radius:50%;display:flex;justify-content:center;align-items:center;margin-bottom:var(--spacing-sm, 8px);border-width:2px;border-style:solid}.performance-score[_ngcontent-%COMP%]   .score-gauge.high[_ngcontent-%COMP%]{background-color:var(--color-success-bg, rgba(76, 175, 80, .15));border-color:var(--color-success, #4caf50);color:var(--color-success-dark, #2e7d32)}.performance-score[_ngcontent-%COMP%]   .score-gauge.medium[_ngcontent-%COMP%]{background-color:var(--color-warning-bg, rgba(255, 152, 0, .15));border-color:var(--color-warning, #ff9800);color:var(--color-warning-dark, #ef6c00)}.performance-score[_ngcontent-%COMP%]   .score-gauge.low[_ngcontent-%COMP%]{background-color:var(--color-danger-bg, rgba(244, 67, 54, .15));border-color:var(--color-danger, #f44336);color:var(--color-danger-dark, #c62828)}.performance-score[_ngcontent-%COMP%]   .score-gauge.unknown[_ngcontent-%COMP%]{background-color:var(--color-neutral-bg, rgba(189, 189, 189, .15));border-color:var(--color-neutral-light, #bdbdbd);color:var(--color-neutral-dark, #757575)}.performance-score[_ngcontent-%COMP%]   .score-gauge[_ngcontent-%COMP%]   .score-value[_ngcontent-%COMP%]{font-size:var(--font-size-xxxl, 24px);font-weight:600}.performance-score[_ngcontent-%COMP%]   .score-label[_ngcontent-%COMP%]{font-size:var(--font-size-xs, 12px);color:var(--text-secondary-color, rgba(0, 0, 0, .6))}.metrics-grid[_ngcontent-%COMP%]{display:flex;justify-content:space-around;margin-bottom:var(--spacing-lg, 20px)}.metrics-grid[_ngcontent-%COMP%]   .metric-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.metrics-grid[_ngcontent-%COMP%]   .metric-item[_ngcontent-%COMP%]   .metric-value[_ngcontent-%COMP%]{font-size:var(--font-size-xl, 18px);font-weight:600;color:var(--text-color, rgba(0, 0, 0, .87))}.metrics-grid[_ngcontent-%COMP%]   .metric-item[_ngcontent-%COMP%]   .metric-label[_ngcontent-%COMP%]{font-size:var(--font-size-xs, 12px);color:var(--text-secondary-color, rgba(0, 0, 0, .6))}.metrics-list[_ngcontent-%COMP%]{background-color:var(--surface-lighter, #f9f9f9);border-radius:var(--border-radius-sm, 4px);padding:var(--spacing-sm, 10px)}.metrics-list[_ngcontent-%COMP%]   .metric-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:var(--spacing-xs, 6px) 0;font-size:var(--font-size-sm, 13px);border-bottom:1px solid var(--border-color-light, #eeeeee)}.metrics-list[_ngcontent-%COMP%]   .metric-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.metrics-list[_ngcontent-%COMP%]   .metric-row[_ngcontent-%COMP%]   .metric-name[_ngcontent-%COMP%]{color:var(--text-secondary-color, rgba(0, 0, 0, .6))}.metrics-list[_ngcontent-%COMP%]   .metric-row[_ngcontent-%COMP%]   .metric-value[_ngcontent-%COMP%]{font-weight:500;color:var(--text-color, rgba(0, 0, 0, .87))}.optimization-controls[_ngcontent-%COMP%]   .control-group[_ngcontent-%COMP%]{margin-bottom:var(--spacing-md, 15px)}.optimization-controls[_ngcontent-%COMP%]   .control-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:var(--spacing-sm, 8px);font-size:var(--font-size-sm, 13px);font-weight:500}.optimization-controls[_ngcontent-%COMP%]   .toggle-switch[_ngcontent-%COMP%]{position:relative;display:inline-block;width:var(--toggle-width, 44px);height:var(--toggle-height, 24px)}.optimization-controls[_ngcontent-%COMP%]   .toggle-switch[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{opacity:0;width:0;height:0}.optimization-controls[_ngcontent-%COMP%]   .toggle-switch[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]{background-color:var(--primary-color, #1976d2)}.optimization-controls[_ngcontent-%COMP%]   .toggle-switch[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]:before{transform:translate(var(--toggle-thumb-translate, 20px))}.optimization-controls[_ngcontent-%COMP%]   .toggle-switch[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]{position:absolute;cursor:pointer;inset:0;background-color:var(--color-neutral, #ccc);transition:var(--transition-normal, .4s);border-radius:var(--toggle-height, 24px)}.optimization-controls[_ngcontent-%COMP%]   .toggle-switch[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]:before{position:absolute;content:"";height:var(--toggle-thumb-size, 18px);width:var(--toggle-thumb-size, 18px);left:var(--toggle-thumb-margin, 3px);bottom:var(--toggle-thumb-margin, 3px);background-color:#fff;transition:var(--transition-normal, .4s);border-radius:50%}.optimization-controls[_ngcontent-%COMP%]   .optimization-levels[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:var(--spacing-xs, 6px)}.optimization-controls[_ngcontent-%COMP%]   .optimization-levels[_ngcontent-%COMP%]   .level-button[_ngcontent-%COMP%]{padding:var(--spacing-xs, 6px) var(--spacing-sm, 12px);border-radius:var(--border-radius-pill, 16px);border:1px solid var(--border-color, #e0e0e0);background:none;font-size:var(--font-size-xs, 12px);cursor:pointer;text-transform:capitalize;transition:var(--transition-fast, .15s)}.optimization-controls[_ngcontent-%COMP%]   .optimization-levels[_ngcontent-%COMP%]   .level-button[_ngcontent-%COMP%]:hover{background-color:var(--surface-hover, #f5f5f5)}.optimization-controls[_ngcontent-%COMP%]   .optimization-levels[_ngcontent-%COMP%]   .level-button.active[_ngcontent-%COMP%]{background-color:var(--primary-color, #1976d2);color:var(--primary-contrast-color, white);border-color:var(--primary-color, #1976d2)}.optimization-controls[_ngcontent-%COMP%]   .optimization-info[_ngcontent-%COMP%]{margin-top:var(--spacing-md, 15px);padding:var(--spacing-sm, 10px);background-color:var(--surface-lighter, #f5f5f5);border-radius:var(--border-radius-sm, 4px);font-size:var(--font-size-xs, 12px);line-height:1.4;color:var(--text-secondary-color, rgba(0, 0, 0, .6))}@media (max-width: 768px){.performance-widget[_ngcontent-%COMP%]{--floating-panel-width: var(--performance-widget-width-mobile, 240px)}}'],changeDetection:0})}}return o})();var VE={[s.OLT]:"#E57373",[s.ONT]:"#81C784",[s.FDP]:"#64B5F6",[s.EDFA]:"#FFD54F",[s.SPLITTER]:"#BA68C8",[s.MANGA]:"#4DB6AC",[s.TERMINAL_BOX]:"#F06292",[s.FIBER_CONNECTION]:"#A1887F",[s.FIBER_SPLICE]:"#FF8A65",[s.FIBER_CABLE]:"#7986CB",[s.FIBER_STRAND]:"#4FC3F7",[s.FIBER_THREAD]:"#4FC3F7",[s.SLACK_FIBER]:"#80DEEA",[s.DROP_CABLE]:"#9575CD",[s.DISTRIBUTION_CABLE]:"#7E57C2",[s.FEEDER_CABLE]:"#673AB7",[s.BACKBONE_CABLE]:"#5E35B1",[s.MSAN]:"#FB8C00",[s.ODF]:"#00897B",[s.ROUTER]:"#D32F2F",[s.RACK]:"#757575",[s.NETWORK_GRAPH]:"#0288D1",[s.WDM_FILTER]:"#FFA000",[s.COHERENT_TRANSPONDER]:"#8D6E63",[s.WAVELENGTH_ROUTER]:"#26A69A",[s.OPTICAL_SWITCH]:"#7CB342",[s.ROADM]:"#AB47BC",[s.CUSTOM]:"#607D8B",[s.CABINET]:"#795548",[s.CHAMBER]:"#8D6E63",[s.POLE]:"#BDBDBD",[s.BUILDING]:"#546E7A",[s.SITE]:"#455A64",[s.NODE]:"#37474F",[s.PATCH_PANEL]:"#00BCD4",[s.FIBER_CLOSURE]:"#26A69A",[s.SWITCH]:"#F44336",[s.MULTIPLEXER]:"#9C27B0",[s.DEMULTIPLEXER]:"#8E24AA",[s.REPEATER]:"#3F51B5",[s.ATTENUATOR]:"#EC407A",[s.CONNECTOR]:"#9E9D24",[s.CROSS_CONNECT]:"#AFB42B",[s.SUBSCRIBER]:"#1976D2",[s.SERVICE_POINT]:"#0097A7",[s.AGGREGATION_POINT]:"#00796B",[s.SPLICE_BOX]:"#43A047",[s.NAP]:"#7CB342",[s.FAT]:"#C0CA33",[s.DISTRIBUTION_BOX]:"#FDD835",[s.ACCESS_POINT]:"#FFB300",[s.HUB]:"#FB8C00",[s.GATEWAY]:"#F4511E",[s.ROUTE]:"#78909C",[s.SERVICE_AREA]:"#AED581",[s.MDU_BUILDING]:"#B2DFDB",[s.DUCT]:"#B0BEC5",[s.WSS]:"#90A4AE",[s.RF_OVERLAY_SYSTEM]:"#FFD600",[s.MONITORING_SYSTEM]:"#00B8D4",[s.OPTICAL_AMPLIFIER]:"#EF6C00",default:"#78909C"},$E={[B.ACTIVE]:"#4CAF50",[B.INACTIVE]:"#9E9E9E",[B.UNKNOWN]:"#9E9E9E",[B.WARNING]:"#FFA726",[B.CRITICAL]:"#E53935",[B.FAULT]:"#E53935",[B.MAINTENANCE]:"#42A5F5",[B.PLANNED]:"#8D6E63",[B.BUILDING]:"#FBC02D",[B.RESERVE]:"#7CB342",[B.DECOMMISSIONED]:"#78909C",[B.ERROR]:"#D32F2F",[B.PLANNING]:"#9575CD",default:"#9E9E9E"},ci={[s.OLT]:"router",[s.ONT]:"devices",[s.FDP]:"settings_input_component",[s.EDFA]:"amp_stories",[s.SPLITTER]:"call_split",[s.MANGA]:"track_changes",[s.TERMINAL_BOX]:"inbox",[s.FIBER_CONNECTION]:"timeline",[s.FIBER_SPLICE]:"hub",[s.FIBER_CABLE]:"cable",[s.FIBER_STRAND]:"fiber_manual_record",[s.FIBER_THREAD]:"fiber_manual_record",[s.SLACK_FIBER]:"waves",[s.DROP_CABLE]:"swap_horiz",[s.DISTRIBUTION_CABLE]:"compare_arrows",[s.FEEDER_CABLE]:"sync_alt",[s.BACKBONE_CABLE]:"all_inclusive",[s.MSAN]:"dns",[s.ODF]:"grid_view",[s.ROUTER]:"wifi",[s.RACK]:"inventory_2",[s.NETWORK_GRAPH]:"share",[s.WDM_FILTER]:"filter_alt",[s.COHERENT_TRANSPONDER]:"memory",[s.WAVELENGTH_ROUTER]:"settings_input_hdmi",[s.OPTICAL_SWITCH]:"switch_right",[s.ROADM]:"swap_calls",[s.CUSTOM]:"extension",[s.CABINET]:"inventory_2",[s.CHAMBER]:"architecture",[s.POLE]:"candlestick_chart",[s.BUILDING]:"apartment",[s.SITE]:"location_on",[s.NODE]:"hub",[s.PATCH_PANEL]:"dashboard",[s.FIBER_CLOSURE]:"all_inbox",[s.SWITCH]:"swap_horiz",[s.MULTIPLEXER]:"call_merge",[s.DEMULTIPLEXER]:"call_split",[s.REPEATER]:"repeat",[s.ATTENUATOR]:"tune",[s.CONNECTOR]:"link",[s.CROSS_CONNECT]:"compare_arrows",[s.SUBSCRIBER]:"person",[s.SERVICE_POINT]:"room_service",[s.AGGREGATION_POINT]:"merge_type",[s.SPLICE_BOX]:"inbox",[s.NAP]:"network_cell",[s.FAT]:"router",[s.DISTRIBUTION_BOX]:"inventory",[s.ACCESS_POINT]:"wifi",[s.HUB]:"hub",[s.GATEWAY]:"vpn_lock",[s.ROUTE]:"alt_route",[s.SERVICE_AREA]:"map",[s.MDU_BUILDING]:"apartment",[s.DUCT]:"alt_route",[s.WSS]:"settings_ethernet",[s.RF_OVERLAY_SYSTEM]:"settings_input_antenna",[s.MONITORING_SYSTEM]:"monitor_heart",[s.OPTICAL_AMPLIFIER]:"trending_up",default:"device_unknown"},qo={[s.OLT]:"Terminal de L\xEDnea \xD3ptica",[s.ONT]:"Terminal de Red \xD3ptica",[s.FDP]:"Punto de Distribuci\xF3n",[s.EDFA]:"Amplificador \xD3ptico",[s.SPLITTER]:"Divisor \xD3ptico",[s.MANGA]:"Manga",[s.TERMINAL_BOX]:"Caja Terminal",[s.FIBER_CONNECTION]:"Conexi\xF3n de Fibra",[s.FIBER_SPLICE]:"Empalme",[s.FIBER_CABLE]:"Cable de Fibra",[s.FIBER_STRAND]:"Hilo de Fibra",[s.FIBER_THREAD]:"Hilo de Fibra",[s.SLACK_FIBER]:"Flojo de Fibra",[s.DROP_CABLE]:"Cable de Acometida",[s.DISTRIBUTION_CABLE]:"Cable de Distribuci\xF3n",[s.FEEDER_CABLE]:"Cable Alimentador",[s.BACKBONE_CABLE]:"Cable Troncal",[s.MSAN]:"Nodo de Acceso Multi-Servicio",[s.ODF]:"Distribuidor de Fibra \xD3ptica",[s.ROUTER]:"Router",[s.RACK]:"Rack",[s.NETWORK_GRAPH]:"Grafo de Red",[s.WDM_FILTER]:"Filtro WDM",[s.COHERENT_TRANSPONDER]:"Transpondedor Coherente",[s.WAVELENGTH_ROUTER]:"Router de Longitudes de Onda",[s.OPTICAL_SWITCH]:"Conmutador \xD3ptico",[s.ROADM]:"Multiplexor \xD3ptico Reconfigurable",[s.CUSTOM]:"Elemento Personalizado",[s.CABINET]:"Gabinete",[s.CHAMBER]:"C\xE1mara/Pozo",[s.POLE]:"Poste",[s.BUILDING]:"Edificio",[s.SITE]:"Sitio/Local",[s.NODE]:"Nodo",[s.PATCH_PANEL]:"Panel de Parcheo",[s.FIBER_CLOSURE]:"Cierre de Fibra",[s.SWITCH]:"Switch",[s.MULTIPLEXER]:"Multiplexor",[s.DEMULTIPLEXER]:"Demultiplexor",[s.REPEATER]:"Repetidor",[s.ATTENUATOR]:"Atenuador",[s.CONNECTOR]:"Conector",[s.CROSS_CONNECT]:"Cruzada",[s.SUBSCRIBER]:"Abonado/Cliente",[s.SERVICE_POINT]:"Punto de Servicio",[s.AGGREGATION_POINT]:"Punto de Agregaci\xF3n",[s.SPLICE_BOX]:"Caja de Empalme",[s.NAP]:"Punto de Acceso a la Red",[s.FAT]:"Terminal de Acceso de Fibra",[s.DISTRIBUTION_BOX]:"Caja de Distribuci\xF3n",[s.ACCESS_POINT]:"Punto de Acceso",[s.HUB]:"Concentrador",[s.GATEWAY]:"Pasarela",[s.ROUTE]:"Ruta",[s.SERVICE_AREA]:"\xC1rea de Servicio",[s.MDU_BUILDING]:"Edificio MDU",[s.DUCT]:"Ducto/Canalizaci\xF3n",[s.WSS]:"Switch Selectivo de Longitud de Onda",[s.RF_OVERLAY_SYSTEM]:"Sistema RF Overlay",[s.MONITORING_SYSTEM]:"Sistema de Monitorizaci\xF3n",[s.OPTICAL_AMPLIFIER]:"Amplificador \xD3ptico",default:"Elemento Desconocido"},jE={[s.OLT]:F(De,15*2.5),[s.ONT]:F(it,15),[s.FDP]:F(Pi,15*1.5),[s.EDFA]:F(ot,15*1.5),[s.SPLITTER]:F(xo,15*1.5),[s.MANGA]:F(Mi,15*1.5),[s.FIBER_SPLICE]:F(bn,15*1.2),[s.FIBER_CABLE]:F(De,15*1.8),[s.FIBER_STRAND]:F(it,15*.8),[s.TERMINAL_BOX]:F(ot,15*1.5),[s.FIBER_CONNECTION]:F(Pi,15),[s.FIBER_THREAD]:F(it,15*.8),[s.SLACK_FIBER]:F(bn,15*1.5),[s.DROP_CABLE]:F(De,15*1.4),[s.DISTRIBUTION_CABLE]:F(De,15*1.6),[s.FEEDER_CABLE]:F(De,15*1.8),[s.BACKBONE_CABLE]:F(De,15*2),[s.MSAN]:F(ot,15*2),[s.ODF]:F(De,15*2.2),[s.ROUTER]:F(ot,15*1.8),[s.RACK]:F(De,15*2.4),[s.NETWORK_GRAPH]:F(it,15*2.2),[s.WDM_FILTER]:F(Pi,15*1.8),[s.COHERENT_TRANSPONDER]:F(ot,15*1.7),[s.WAVELENGTH_ROUTER]:F(bn,15*1.8),[s.OPTICAL_SWITCH]:F(xo,15*1.8),[s.ROADM]:F(Mi,15*1.8),[s.CUSTOM]:F(it,15*1.4),[s.CABINET]:F(De,15*2),[s.CHAMBER]:F(De,15*1.8),[s.POLE]:F(bn,15*2),[s.BUILDING]:F(De,15*2.8),[s.SITE]:F(ot,15*2.2),[s.NODE]:F(Pi,15*2),[s.PATCH_PANEL]:F(De,15*2),[s.FIBER_CLOSURE]:F(De,15*1.6),[s.SWITCH]:F(ot,15*1.8),[s.MULTIPLEXER]:F(Mi,15*1.7),[s.DEMULTIPLEXER]:F(Mi,15*1.7),[s.REPEATER]:F(bn,15*1.5),[s.ATTENUATOR]:F(xo,15*1.5),[s.CONNECTOR]:F(it,15*1),[s.CROSS_CONNECT]:F(bn,15*1.5),[s.SUBSCRIBER]:F(ot,15*1.4),[s.SERVICE_POINT]:F(it,15*1.2),[s.AGGREGATION_POINT]:F(ot,15*1.5),[s.SPLICE_BOX]:F(De,15*1.5),[s.NAP]:F(ot,15*1.4),[s.FAT]:F(De,15*1.6),[s.DISTRIBUTION_BOX]:F(De,15*1.5),[s.ACCESS_POINT]:F(it,15*1.2),[s.HUB]:F(it,15*2),[s.GATEWAY]:F(ot,15*1.8),[s.ROUTE]:F(De,15*1.2),[s.SERVICE_AREA]:F(it,15*1.2),[s.MDU_BUILDING]:F(De,15*1.2),[s.DUCT]:F(De,15*1.2),[s.WSS]:F(ot,15*1.2),[s.RF_OVERLAY_SYSTEM]:F(it,15*1.2),[s.MONITORING_SYSTEM]:F(it,15*1.2),[s.OPTICAL_AMPLIFIER]:F(ot,15*1.6),default:F(it,15)};function F(o,i){return Jl().type(o).size(i)()||""}var Qo="network-map:user-layer-settings",sn=(()=>{class o{constructor(e,t){this.logger=e,this.networkStateService=t,this.destroy$=new N,this.layerIcons={[s.OLT]:"router",[s.ONT]:"device_hub",[s.FDP]:"cable",[s.SPLITTER]:"call_split",[s.EDFA]:"electrical_services",[s.MANGA]:"cable",[s.TERMINAL_BOX]:"inbox",[s.MSAN]:"device_hub",[s.ODF]:"settings_input_hdmi",[s.ROUTER]:"wifi_tethering",[s.RACK]:"dns",[s.FIBER_CONNECTION]:"timeline",[s.FIBER_THREAD]:"linear_scale",[s.FIBER_CABLE]:"cable",[s.FIBER_SPLICE]:"settings_input_component",[s.FIBER_STRAND]:"linear_scale",[s.DROP_CABLE]:"settings_ethernet",[s.DISTRIBUTION_CABLE]:"settings_ethernet",[s.FEEDER_CABLE]:"settings_ethernet",[s.BACKBONE_CABLE]:"settings_ethernet",[s.NETWORK_GRAPH]:"bubble_chart",[s.WDM_FILTER]:"filter_alt",[s.OPTICAL_SWITCH]:"swap_horiz",[s.ROADM]:"swap_calls",[s.COHERENT_TRANSPONDER]:"multiline_chart",[s.WAVELENGTH_ROUTER]:"waves",[s.OPTICAL_AMPLIFIER]:"trending_up",[s.SLACK_FIBER]:"waves"},this.initializeLayerPersistence(),this.subscribeToActiveLayerChangesForPersistence()}initializeLayerPersistence(){try{let e=this.loadUserSettings();if(e&&e.activeLayers){let t=new Set(e.activeLayers.filter(n=>this.isValidElementType(n)));this.networkStateService.updateActiveLayers(t),this.logger.debug("LayerManagerService: NetworkStateService.activeLayers inicializado desde localStorage con capas: ",Array.from(t).map(n=>this.getLayerName(n)))}else this.saveUserSettings(this.networkStateService.getCurrentState().activeLayers),this.logger.debug("LayerManagerService: No hay configuraci\xF3n guardada o es inv\xE1lida. Usando estado de NetworkStateService y persistiendo.")}catch(e){this.logger.error("Error al inicializar la persistencia de capas",e),this.saveUserSettings(this.networkStateService.getCurrentState().activeLayers)}}subscribeToActiveLayerChangesForPersistence(){this.networkStateService.state$.pipe(de(e=>e.activeLayers),mt((e,t)=>{if(e.size!==t.size)return!1;for(let n of e)if(!t.has(n))return!1;return!0}),L(this.destroy$)).subscribe(e=>{try{this.saveUserSettings(e)}catch(t){this.logger.error("Error al persistir cambios de activeLayers desde NetworkStateService",t)}})}getActiveLayers(){return this.networkStateService.state$.pipe(de(e=>Array.from(e.activeLayers)),mt((e,t)=>e.length===t.length&&e.every((n,r)=>n===t[r])))}isLayerActive(e){return this.networkStateService.state$.pipe(de(t=>t.activeLayers.has(e)),mt())}isLayerActiveSync(e){try{return this.isValidElementType(e)?this.networkStateService.getCurrentState().activeLayers.has(e):(this.logger.warn(`Verificaci\xF3n de capa activa para tipo no v\xE1lido: ${e}`),!1)}catch(t){return this.logger.error(`Error al verificar si la capa ${this.getLayerName(e)} est\xE1 activa`,t),!1}}toggleLayer(e,t){try{if(!this.isValidElementType(e)){this.logger.warn(`Intento de alternar tipo de elemento no v\xE1lido: ${e}`);return}let n=this.networkStateService.getCurrentState().activeLayers.has(e);if(n===(t!==void 0?t:!n))return;this.networkStateService.toggleLayer(e)}catch(n){this.logger.error(`Error al alternar la capa ${this.getLayerName(e)} en LayerManagerService`,n)}}activateLayers(e){try{let t=e.filter(a=>{let l=this.isValidElementType(a);return l||this.logger.warn(`Tipo de elemento no v\xE1lido al activar: ${a}`),l});if(t.length===0)return;let n=this.networkStateService.getCurrentState().activeLayers,r=t.filter(a=>!n.has(a));if(r.length>0){let a=new Set([...n,...r]);this.networkStateService.updateActiveLayers(a),this.logger.debug("LayerManagerService: M\xFAltiples capas activadas v\xEDa NetworkStateService:",r.map(l=>this.getLayerName(l)))}}catch(t){this.logger.error("Error al activar m\xFAltiples capas en LayerManagerService",t)}}deactivateLayers(e){try{let t=e.filter(a=>{let l=this.isValidElementType(a);return l||this.logger.warn(`Tipo de elemento no v\xE1lido al desactivar: ${a}`),l});if(t.length===0)return;let n=this.networkStateService.getCurrentState().activeLayers,r=t.filter(a=>n.has(a));if(r.length>0){let a=new Set(n);r.forEach(l=>a.delete(l)),this.networkStateService.updateActiveLayers(a),this.logger.debug("LayerManagerService: M\xFAltiples capas desactivadas v\xEDa NetworkStateService:",r.map(l=>this.getLayerName(l)))}}catch(t){this.logger.error("Error al desactivar m\xFAltiples capas en LayerManagerService",t)}}getLayerIcon(e){try{return this.isValidElementType(e)?this.layerIcons[e]||"layers":(this.logger.warn(`Solicitando icono para tipo no v\xE1lido: ${e}`),"warning")}catch(t){return this.logger.error(`Error al obtener icono para la capa ${this.getLayerName(e)}`,t),"error"}}resetToDefaultLayers(){try{let e=new Set([s.OLT,s.ONT,s.FDP,s.SPLITTER,s.ODF]);this.networkStateService.updateActiveLayers(e),this.logger.debug("LayerManagerService: Capas restablecidas a valores predeterminados en NetworkStateService")}catch(e){this.logger.error("Error al restablecer capas predeterminadas en LayerManagerService",e)}}saveUserSettings(e){try{let t={activeLayers:Array.from(e),lastUpdated:Date.now()};localStorage.setItem(Qo,JSON.stringify(t)),this.logger.debug("LayerManagerService: Configuraci\xF3n de capas guardada en localStorage",t.activeLayers)}catch(t){this.logger.error("Error al guardar configuraci\xF3n de capas en localStorage",t)}}loadUserSettings(){try{let e=localStorage.getItem(Qo);if(!e)return this.logger.debug("LayerManagerService: No hay configuraci\xF3n de capas guardada en localStorage."),null;let t=JSON.parse(e);return!t||!Array.isArray(t.activeLayers)?(this.logger.warn("LayerManagerService: Configuraci\xF3n de capas en localStorage es inv\xE1lida o corrupta."),localStorage.removeItem(Qo),null):(t.activeLayers=t.activeLayers.filter(n=>this.isValidElementType(n)),this.logger.debug("LayerManagerService: Configuraci\xF3n de capas cargada desde localStorage:",t.activeLayers),t)}catch(e){return this.logger.error("Error al cargar configuraci\xF3n de capas desde localStorage",e),localStorage.removeItem(Qo),null}}isValidElementType(e){return typeof e=="string"?Object.values(s).includes(e):!1}getLayerName(e){try{let t=s[e];return t!==void 0?t:`Tipo desconocido (${e})`}catch{return`Error (${e})`}}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.logger.debug("LayerManagerService destruido")}static{this.\u0275fac=function(t){return new(t||o)(O(K),O(Ie))}}static{this.\u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();function Qh(o,i){if(o&1&&(c(0,"mat-chip",17)(1,"mat-icon",18),p(2),d(),p(3),d()),o&2){let e=i.$implicit,t=v();h("matTooltip",t.getLayerName(e)),m(2),x(t.getLayerIcon(e)),m(),j(" ",t.getLayerName(e)," ")}}function Zh(o,i){o&1&&(c(0,"p",19),p(1," No hay capas activas. Activa algunas capas en el mapa. "),d())}function Yh(o,i){if(o&1&&(c(0,"p",28),p(1),d()),o&2){let e=v().$implicit;m(),j(" ",e.description," ")}}function Xh(o,i){if(o&1&&(c(0,"mat-chip",17)(1,"mat-icon",18),p(2),d(),p(3),d()),o&2){let e=i.$implicit,t=v(2);h("matTooltip",t.getLayerName(e)),m(2),x(t.getLayerIcon(e)),m(),j(" ",t.getLayerName(e)," ")}}function Jh(o,i){if(o&1&&(c(0,"mat-chip"),p(1),d()),o&2){let e=v().$implicit,t=v();m(),j(" +",e.layers.length-t.CONSTANTS.MAX_VISIBLE_LAYERS_IN_PRESET," m\xE1s ")}}function ef(o,i){if(o&1){let e=V();c(0,"mat-list-item",20)(1,"div",21)(2,"div",22)(3,"h4"),p(4),d(),c(5,"span",23),p(6),d()(),E(7,Yh,2,1,"p",24),c(8,"mat-chip-listbox"),E(9,Xh,4,3,"mat-chip",3)(10,Jh,2,1,"mat-chip",25),d()(),c(11,"div",6)(12,"button",26),y("click",function(){let n=b(e).$implicit,r=v();return C(r.loadPreset(n))}),c(13,"mat-icon"),p(14,"play_arrow"),d()(),c(15,"button",27),y("click",function(){let n=b(e).$implicit,r=v();return C(r.deletePreset(n))}),c(16,"mat-icon"),p(17,"delete"),d()()()()}if(o&2){let e=i.$implicit,t=v();m(4),x(e.name),m(2),j(" ",t.formatDate(e.updatedAt)," "),m(),h("ngIf",e.description),m(2),h("ngForOf",e.layers.slice(0,t.CONSTANTS.MAX_VISIBLE_LAYERS_IN_PRESET)),m(),h("ngIf",e.layers.length>t.CONSTANTS.MAX_VISIBLE_LAYERS_IN_PRESET)}}function tf(o,i){o&1&&(c(0,"p",19),p(1," No hay presets guardados. Guarda tu configuraci\xF3n actual para comenzar. "),d())}var sa={USER_PRESETS_STORAGE_KEY:"network-map:layer-presets",COLORS:{TEXT_SECONDARY:"#666"},MAX_VISIBLE_LAYERS_IN_PRESET:3,SPACING:{DEFAULT:"16px",SMALL:"8px",XSMALL:"4px"}},hd=(()=>{class o{constructor(e,t,n,r){this.layerManager=e,this.logger=t,this.dialogRef=n,this.cdr=r,this.CONSTANTS=sa,this.activeLayers=[],this.presets=[],this.newPresetName="",this.newPresetDescription="",this.destroy$=new N}ngOnInit(){this.layerManager.getActiveLayers().pipe(L(this.destroy$)).subscribe(e=>{this.activeLayers=e,this.cdr.markForCheck()}),this.loadPresets()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}formatDate(e){return new Date(e).toLocaleDateString()}getLayerName(e){return this.layerManager.getLayerName(e)}getLayerIcon(e){return this.layerManager.getLayerIcon(e)}saveCurrentAsPreset(){if(!(!this.newPresetName||this.activeLayers.length===0))try{let e=Date.now(),t={id:`preset_${e}`,name:this.newPresetName,description:this.newPresetDescription||void 0,layers:[...this.activeLayers],createdAt:e,updatedAt:e};this.presets.push(t),this.savePresets(),this.newPresetName="",this.newPresetDescription="",this.logger.debug("Nuevo preset guardado",t),this.cdr.markForCheck()}catch(e){this.logger.error("Error al guardar preset",e)}}loadPreset(e){try{this.layerManager.deactivateLayers(this.activeLayers),this.layerManager.activateLayers(e.layers),this.logger.debug("Preset cargado",e),e.updatedAt=Date.now(),this.savePresets(),this.cdr.markForCheck()}catch(t){this.logger.error("Error al cargar preset",t)}}deletePreset(e){try{let t=this.presets.findIndex(n=>n.id===e.id);t!==-1&&(this.presets.splice(t,1),this.savePresets(),this.logger.debug("Preset eliminado",e),this.cdr.markForCheck())}catch(t){this.logger.error("Error al eliminar preset",t)}}resetToDefault(){try{this.layerManager.resetToDefaultLayers(),this.logger.debug("Capas restablecidas a valores predeterminados")}catch(e){this.logger.error("Error al restablecer capas",e)}}loadPresets(){try{let e=localStorage.getItem(sa.USER_PRESETS_STORAGE_KEY);e&&(this.presets=JSON.parse(e),this.logger.debug("Presets cargados desde localStorage",this.presets),this.cdr.markForCheck())}catch(e){this.logger.error("Error al cargar presets",e),this.presets=[],this.cdr.markForCheck()}}savePresets(){try{localStorage.setItem(sa.USER_PRESETS_STORAGE_KEY,JSON.stringify(this.presets)),this.logger.debug("Presets guardados en localStorage")}catch(e){this.logger.error("Error al guardar presets",e)}}static{this.\u0275fac=function(t){return new(t||o)(A(sn),A(K),A(Gn),A(He))}}static{this.\u0275cmp=Y({type:o,selectors:[["app-layer-settings"]],decls:35,vars:7,consts:[[1,"layer-settings-container"],["mat-dialog-title",""],[1,"current-layers-section"],[3,"matTooltip",4,"ngFor","ngForOf"],["class","empty-state",4,"ngIf"],[1,"presets-section"],[1,"preset-actions"],["appearance","outline",1,"preset-name-field"],["matInput","","placeholder","Mi configuraci\xF3n",3,"ngModelChange","ngModel"],["appearance","outline",1,"preset-description-field"],["matInput","","placeholder","Descripci\xF3n del preset...",3,"ngModelChange","ngModel"],["mat-raised-button","","color","primary",3,"click","disabled"],["role","list"],["role","listitem","class","preset-item",4,"ngFor","ngForOf"],["align","end"],["mat-button","",3,"click"],["mat-button","","mat-dialog-close","","cdkFocusInitial",""],[3,"matTooltip"],[1,"layer-icon"],[1,"empty-state"],["role","listitem",1,"preset-item"],[1,"preset-details"],[1,"preset-header"],[1,"preset-date"],["class","preset-description",4,"ngIf"],[4,"ngIf"],["mat-icon-button","","matTooltip","Cargar preset",3,"click"],["mat-icon-button","","matTooltip","Eliminar preset",3,"click"],[1,"preset-description"]],template:function(t,n){t&1&&(c(0,"div",0)(1,"h2",1),p(2,"Configuraci\xF3n de Capas"),d(),c(3,"mat-dialog-content")(4,"div",2)(5,"h3"),p(6,"Capas Actuales"),d(),c(7,"mat-chip-listbox"),E(8,Qh,4,3,"mat-chip",3),d(),E(9,Zh,2,0,"p",4),d(),D(10,"mat-divider"),c(11,"div",5)(12,"h3"),p(13,"Presets Guardados"),d(),c(14,"div",6)(15,"mat-form-field",7)(16,"mat-label"),p(17,"Nombre del Preset"),d(),c(18,"input",8),_n("ngModelChange",function(a){return fn(n.newPresetName,a)||(n.newPresetName=a),a}),d()(),c(19,"mat-form-field",9)(20,"mat-label"),p(21,"Descripci\xF3n (opcional)"),d(),c(22,"input",10),_n("ngModelChange",function(a){return fn(n.newPresetDescription,a)||(n.newPresetDescription=a),a}),d()(),c(23,"button",11),y("click",function(){return n.saveCurrentAsPreset()}),c(24,"mat-icon"),p(25,"save"),d(),p(26," Guardar Actual "),d()(),c(27,"mat-list",12),E(28,ef,18,5,"mat-list-item",13),d(),E(29,tf,2,0,"p",4),d()(),c(30,"mat-dialog-actions",14)(31,"button",15),y("click",function(){return n.resetToDefault()}),p(32," Restablecer Predeterminado "),d(),c(33,"button",16),p(34," Cerrar "),d()()()),t&2&&(m(8),h("ngForOf",n.activeLayers),m(),h("ngIf",n.activeLayers.length===0),m(9),hn("ngModel",n.newPresetName),m(4),hn("ngModel",n.newPresetDescription),m(),h("disabled",!n.newPresetName||n.activeLayers.length===0),m(5),h("ngForOf",n.presets),m(),h("ngIf",n.presets.length===0))},dependencies:[ee,We,re,io,jn,Un,to,oo,nn,vl,Hn,Kn,Wn,be,Ve,Be,pe,ue,Yn,vo,po,co,Zn,Xn,on,mo,El,tn,hl,ro,Lt,Ke,Me,ke],styles:[".layer-settings-container[_ngcontent-%COMP%]{padding:0;max-width:600px;width:100%}.current-layers-section[_ngcontent-%COMP%], .presets-section[_ngcontent-%COMP%]{margin:16px 0}h3[_ngcontent-%COMP%]{font-size:16px;font-weight:500;margin-bottom:12px}.layer-icon[_ngcontent-%COMP%]{margin-right:4px;font-size:16px;height:16px;width:16px;vertical-align:middle}mat-chip-listbox[_ngcontent-%COMP%]{margin-bottom:12px}.preset-actions[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;margin-bottom:16px;gap:8px}.preset-name-field[_ngcontent-%COMP%]{flex:2;min-width:200px}.preset-description-field[_ngcontent-%COMP%]{flex:3;min-width:250px}.preset-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:8px}.preset-details[_ngcontent-%COMP%]{flex:1}.preset-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.preset-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;font-weight:500}.preset-date[_ngcontent-%COMP%]{font-size:12px;color:var(--text-secondary-color, #666)}.preset-description[_ngcontent-%COMP%]{font-size:14px;color:var(--text-secondary-color, #666);margin:4px 0 8px}.empty-state[_ngcontent-%COMP%]{color:var(--text-secondary-color, #666);font-style:italic;text-align:center;padding:16px}mat-divider[_ngcontent-%COMP%]{margin:16px 0}"],changeDetection:0})}}return o})();var fd=(()=>{class o{constructor(e){this.logger=e,this.DB_NAME="network-map-storage",this.DB_VERSION=1,this.STORE_NAME="cache-store",this.db=null,this.dbReady=new Promise(t=>{this.dbReadyResolver=t}),this.initDatabase()}initDatabase(){return ce(this,null,function*(){try{let e=indexedDB.open(this.DB_NAME,this.DB_VERSION);e.onupgradeneeded=t=>{let n=t.target.result;n.objectStoreNames.contains(this.STORE_NAME)||(n.createObjectStore(this.STORE_NAME,{keyPath:"key"}),this.logger.debug("Almac\xE9n de cach\xE9 creado"))},e.onsuccess=t=>{this.db=t.target.result,this.logger.debug("Base de datos inicializada correctamente"),this.dbReadyResolver(!0)},e.onerror=t=>{this.logger.error("Error al inicializar la base de datos",t.target.error),this.dbReadyResolver(!1)}}catch(e){this.logger.error("Error inesperado al inicializar la base de datos:",e),this.dbReadyResolver(!1)}})}setItem(e,t){return ce(this,null,function*(){if(this.isLargeObject(t))return this.setItemInIndexedDB(e,t);try{localStorage.setItem(e,JSON.stringify({key:e,value:t,timestamp:Date.now()}))}catch(n){return this.logger.error(`Error al guardar ${e} en localStorage:`,n),this.setItemInIndexedDB(e,t)}})}setItemInIndexedDB(e,t){return ce(this,null,function*(){if(!(yield this.dbReady)||!this.db)throw new Error("Base de datos no disponible");return new Promise((r,a)=>{try{let g=this.db.transaction([this.STORE_NAME],"readwrite").objectStore(this.STORE_NAME).put({key:e,value:t,timestamp:Date.now()});g.onsuccess=()=>r(),g.onerror=_=>{this.logger.error(`Error al guardar ${e} en IndexedDB:`,g.error),a(g.error)}}catch(l){this.logger.error(`Error al guardar ${e} en IndexedDB:`,l),a(l)}})})}getItem(e){return ce(this,null,function*(){try{let t=localStorage.getItem(e);if(t)return JSON.parse(t).value}catch(t){this.logger.warn(`No se pudo obtener ${e} de localStorage:`,t)}return this.getItemFromIndexedDB(e)})}getItemFromIndexedDB(e){return ce(this,null,function*(){return!(yield this.dbReady)||!this.db?null:new Promise((n,r)=>{try{let u=this.db.transaction([this.STORE_NAME],"readonly").objectStore(this.STORE_NAME).get(e);u.onsuccess=()=>{u.result?n(u.result.value):n(null)},u.onerror=()=>{this.logger.error(`Error al obtener ${e} de IndexedDB:`,u.error),r(u.error)}}catch(a){this.logger.error(`Error al acceder a IndexedDB para ${e}:`,a),n(null)}})})}removeItem(e){return ce(this,null,function*(){try{localStorage.removeItem(e)}catch(t){this.logger.warn(`Error al eliminar ${e} de localStorage:`,t)}yield this.removeItemFromIndexedDB(e)})}removeItemFromIndexedDB(e){return ce(this,null,function*(){if(!(!(yield this.dbReady)||!this.db))return new Promise(n=>{try{let l=this.db.transaction([this.STORE_NAME],"readwrite").objectStore(this.STORE_NAME).delete(e);l.onsuccess=()=>n(),l.onerror=()=>{this.logger.error(`Error al eliminar ${e} de IndexedDB:`,l.error),n()}}catch(r){this.logger.error(`Error al acceder a IndexedDB para eliminar ${e}:`,r),n()}})})}getKeys(e=""){return ce(this,null,function*(){let t=[];for(let r=0;r<localStorage.length;r++){let a=localStorage.key(r);a&&a.startsWith(e)&&t.push(a)}let n=yield this.getKeysFromIndexedDB(e);return t.push(...n),[...new Set(t)]})}getKeysFromIndexedDB(e){return ce(this,null,function*(){return!(yield this.dbReady)||!this.db?[]:new Promise(n=>{try{let a=this.db.transaction([this.STORE_NAME],"readonly").objectStore(this.STORE_NAME),l=[],u=a.openCursor();u.onsuccess=g=>{let _=g.target.result;if(_){let f=_.value.key;f.startsWith(e)&&l.push(f),_.continue()}else n(l)},u.onerror=()=>{this.logger.error("Error al obtener claves de IndexedDB:",u.error),n([])}}catch(r){this.logger.error("Error al acceder a IndexedDB para obtener claves:",r),n([])}})})}clear(e){return ce(this,null,function*(){if(e){let t=yield this.getKeys(e);for(let n of t)yield this.removeItem(n)}else localStorage.clear(),yield this.clearIndexedDB()})}clearIndexedDB(){return ce(this,null,function*(){if(!(!(yield this.dbReady)||!this.db))return new Promise(t=>{try{let a=this.db.transaction([this.STORE_NAME],"readwrite").objectStore(this.STORE_NAME).clear();a.onsuccess=()=>{this.logger.debug("IndexedDB limpiado correctamente"),t()},a.onerror=()=>{this.logger.error("Error al limpiar IndexedDB:",a.error),t()}}catch(n){this.logger.error("Error al acceder a IndexedDB para limpiarlo:",n),t()}})})}isLargeObject(e){return e instanceof Blob||e instanceof File||e instanceof ArrayBuffer||typeof e=="object"&&JSON.stringify(e).length>100*1024}static{this.\u0275fac=function(t){return new(t||o)(O(K))}}static{this.\u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var _d=(()=>{class o{constructor(e,t,n){this.http=e,this.storage=t,this.logger=n,this.isOnline=navigator.onLine,this.tileCache=new Map,this.offlineMapAssetsPath="assets/leaflet/offline-tiles",this.maxCacheSize=50*1024*1024,this.cacheVersion="1.0.0",window.addEventListener("online",()=>this.handleConnectionChange(!0)),window.addEventListener("offline",()=>this.handleConnectionChange(!1)),this.loadCache()}handleConnectionChange(e){this.isOnline=e,this.logger.debug(`Conexi\xF3n cambiada: ${e?"Online":"Offline"}`),e&&this.syncPendingData()}isNetworkAvailable(){return this.isOnline}getResource(e,t={}){let n={maxAge:t.maxAge||864e5,version:t.version||this.cacheVersion,cacheOnly:t.cacheOnly||!1};return Gi(this.getFromCache(e,n.version,n.maxAge)).pipe(Ne(r=>r?Ce(r):!this.isOnline||n.cacheOnly?lt(()=>new Error("No hay conexi\xF3n y el recurso no est\xE1 en cach\xE9")):this.http.get(e).pipe(Te(a=>this.saveToCache(e,a,n.version)),Pe(a=>(this.logger.error(`Error al obtener ${e}:`,a),lt(()=>a))))))}getTileImage(e,t,n){let r=`${e}/${t}/${n}`,a=`https://tile.openstreetmap.org/${r}.png`,l=this.tileCache.get(r);return l&&Date.now()-l.timestamp<30*24*60*60*1e3?Ce(l.data):this.isOnline?this.http.get(a,{responseType:"blob"}).pipe(Te(u=>{this.tileCache.set(r,{data:u,timestamp:Date.now(),version:this.cacheVersion}),this.storage.setItem(`tile:${r}`,u),this.cleanupCache()}),Pe(u=>this.getOfflineTile(e,t,n))):this.getOfflineTile(e,t,n)}getOfflineTile(e,t,n){let r=`${this.offlineMapAssetsPath}/${e}/${t}/${n}.png`;return this.http.get(r,{responseType:"blob"}).pipe(Pe(a=>this.http.get("assets/leaflet/error-tiles/error-tile.png",{responseType:"blob"})))}loadCache(){return ce(this,null,function*(){try{let e=yield this.storage.getKeys("tile:");for(let t of e){let n=t.replace("tile:",""),r=yield this.storage.getItem(t);r&&this.tileCache.set(n,{data:r,timestamp:Date.now(),version:this.cacheVersion})}this.logger.debug(`Cach\xE9 cargado: ${this.tileCache.size} tiles`)}catch(e){this.logger.error("Error al cargar cach\xE9:",e)}})}cleanupCache(){if(this.tileCache.size<=100)return;let e=Array.from(this.tileCache.entries()).sort((t,n)=>t[1].timestamp-n[1].timestamp);for(;this.tileCache.size>1e3;){let[t]=e.shift()||[];t&&(this.tileCache.delete(t),this.storage.removeItem(`tile:${t}`))}}saveToCache(e,t,n){this.storage.setItem(e,{data:t,timestamp:Date.now(),version:n})}getFromCache(e,t,n){return ce(this,null,function*(){try{let r=yield this.storage.getItem(e);if(r&&r.version===t&&Date.now()-r.timestamp<n)return r.data}catch(r){this.logger.error(`Error al obtener ${e} de cach\xE9:`,r)}return null})}syncPendingData(){this.logger.debug("Sincronizando datos pendientes...")}prepareOfflineResources(e,t=[13,14,15]){let n=[];for(let r of t){let a=this.long2tile(e.west,r),l=this.long2tile(e.east,r),u=this.lat2tile(e.north,r),g=this.lat2tile(e.south,r);for(let _=a;_<=l;_++)for(let f=u;f<=g;f++)n.push({z:r,x:_,y:f})}return new Ue(r=>{let a=n.length,l=0,u=(g,_)=>{let f=Math.min(g+_,a),S=n.slice(g,f);if(S.length===0){r.next({total:a,current:l,status:"Completado"}),r.complete();return}let T=S.map(w=>this.getTileImage(w.z,w.x,w.y).toPromise().then(()=>{l++,r.next({total:a,current:l,status:`Descargando tiles (${l}/${a})`})}).catch(()=>{l++}));Promise.all(T).then(()=>{u(f,_)})};r.next({total:a,current:l,status:"Iniciando descarga..."}),u(0,10)})}long2tile(e,t){return Math.floor((e+180)/360*Math.pow(2,t))}lat2tile(e,t){return Math.floor((1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(e*Math.PI/180))/Math.PI)/2*Math.pow(2,t))}static{this.\u0275fac=function(t){return new(t||o)(O(Rt),O(fd),O(K))}}static{this.\u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();function of(o,i){if(o&1&&(c(0,"mat-icon"),p(1),d()),o&2){let e=v().$implicit;m(),x(e.icon)}}function rf(o,i){if(o&1&&(c(0,"mat-icon"),p(1),d()),o&2){let e=v(2);m(),x(e.ELEMENT_ICONS.default)}}function af(o,i){if(o&1){let e=V();c(0,"button",28),y("click",function(){let n=b(e).$implicit,r=v();return C(r.onSelectElementType(n.key))}),E(1,of,2,1,"mat-icon",29)(2,rf,2,1,"mat-icon",29),c(3,"span"),p(4),d()()}if(o&2){let e=i.$implicit,t=v();m(),h("ngIf",e.icon&&e.icon!==t.ELEMENT_ICONS.default),m(),h("ngIf",!e.icon||e.icon===t.ELEMENT_ICONS.default),m(2),x(e.name)}}function sf(o,i){if(o&1){let e=V();c(0,"button",30),y("click",function(){let n=b(e).$implicit,r=v();return C(r.toggleLayerVisibility(n.type))}),c(1,"mat-icon",5),p(2),d()()}if(o&2){let e=i.$implicit,t=v();Z("active",t.isLayerActive(e.type)),h("matTooltip",e.tooltip),xe("aria-pressed",t.isLayerActive(e.type))("aria-label","Mostrar u ocultar capa de "+e.tooltip),m(2),x(e.icon)}}function lf(o,i){if(o&1){let e=V();c(0,"button",28),y("click",function(){let n=b(e).$implicit,r=v();return C(r.toggleLayerVisibility(n.type))}),c(1,"mat-icon",31),p(2),d(),c(3,"span"),p(4),d()()}if(o&2){let e=i.$implicit,t=v();m(),h("color",t.isLayerActive(e.type)?"primary":""),m(),j(" ",t.isLayerActive(e.type)?"check_box":"check_box_outline_blank"," "),m(2),x(e.tooltip)}}var vd=(()=>{class o{constructor(){this.activeTool="pan",this.exportButtonPulsing=!1,this.settingsButtonPulsing=!1,this.layers=[{type:s.OLT,icon:"router",tooltip:"OLTs"},{type:s.ONT,icon:"device_hub",tooltip:"ONTs"},{type:s.FDP,icon:"cable",tooltip:"FDPs"},{type:s.SPLITTER,icon:"call_split",tooltip:"Splitters"},{type:s.ODF,icon:"settings_input_hdmi",tooltip:"ODFs"}],this.additionalLayers=[{type:s.MSAN,icon:"device_hub",tooltip:"MSANs"},{type:s.EDFA,icon:"electrical_services",tooltip:"EDFAs"},{type:s.MANGA,icon:"cable",tooltip:"Mangas"},{type:s.TERMINAL_BOX,icon:"inbox",tooltip:"Cajas Terminales"},{type:s.FIBER_CONNECTION,icon:"timeline",tooltip:"Conexiones"},{type:s.FIBER_THREAD,icon:"timeline",tooltip:"Hilos de Fibra"},{type:s.ROUTER,icon:"wifi_tethering",tooltip:"Routers"},{type:s.RACK,icon:"dns",tooltip:"Racks"},{type:s.WDM_FILTER,icon:"filter_alt",tooltip:"Filtros WDM"},{type:s.OPTICAL_SWITCH,icon:"swap_horiz",tooltip:"Conmutadores \xD3pticos"},{type:s.ROADM,icon:"swap_calls",tooltip:"ROADMs"},{type:s.FIBER_SPLICE,icon:"settings_input_component",tooltip:"Empalmes"},{type:s.DROP_CABLE,icon:"settings_ethernet",tooltip:"Cables de Acometida"},{type:s.DISTRIBUTION_CABLE,icon:"settings_ethernet",tooltip:"Cables de Distribuci\xF3n"},{type:s.FEEDER_CABLE,icon:"settings_ethernet",tooltip:"Cables Alimentadores"},{type:s.BACKBONE_CABLE,icon:"settings_ethernet",tooltip:"Cables Troncales"}],this.selectedElements=[],this.isCreatingConnection=!1,this.addElement=new H,this.toggleLayer=new H,this.centerMap=new H,this.clearSelection=new H,this.zoomIn=new H,this.zoomOut=new H,this.createConnection=new H,this.exportMap=new H,this.openSettings=new H,this.showSearchWidget=!0,this.showElementsPanel=!0,this.toggleSearchWidget=new H,this.toggleElementsPanel=new H,this.diagnosticClick=new H,this.helpClick=new H,this.prepareOfflineModeRequest=new H,this.toolChanged=new H,this.activeLayers=[],this.destroy$=new N,this.isOfflineMode=!1,this.mapEventsService=P(an),this.layerManager=P(sn),this.dialog=P(nt),this.offlineService=P(_d),this.snackBar=P(qe),this.logger=P(K),this.addableElementTypes=[],this.ELEMENT_ICONS=ci}isLayerActive(e){return!this.activeLayers||!Array.isArray(this.activeLayers)||this.activeLayers.length===0?!0:this.activeLayers.includes(e)}getElementTypeName(e){return sc(e)}setActiveTool(e){if(this.activeTool===e)return;let t=this.activeTool;this.activeTool=e,this.mapEventsService.changeTool(e,t),this.toolChanged.emit(e),this.announceForScreenReader(`Herramienta ${this.getToolName(e)} activada`),console.log("NetworkToolbar: Herramienta cambiada a",e,new Date().toISOString())}getToolName(e){return{pan:"Mover",select:"Seleccionar",measure:"Medir",connect:"Conectar",areaSelect:"Selecci\xF3n por \xE1rea",zoomIn:"Acercar",zoomOut:"Alejar",fitToScreen:"Ajustar a pantalla",resetZoom:"Restablecer zoom"}[e]||e}onAddElement(){this.logger.debug("Men\xFA para a\xF1adir elemento abierto desde NetworkToolbar.")}toggleLayerVisibility(e){console.log("NetworkToolbar: Solicitud para alternar capa",e,new Date().toISOString());let t=this.isLayerActive(e);this.toggleLayer.emit(e);let n=t?"ocultada":"mostrada",r=this.getElementTypeName(e);this.announceForScreenReader(`Capa ${r} ${n}`)}onCenterMap(){console.log("NetworkToolbar: Solicitud para centrar mapa",new Date().toISOString()),this.centerMap.emit(),this.announceForScreenReader("Mapa centrado")}onClearSelection(){console.log("NetworkToolbar: Solicitud para limpiar selecci\xF3n",new Date().toISOString()),this.clearSelection.emit();let e=Array.isArray(this.selectedElements)?this.selectedElements.length:0;this.announceForScreenReader(`Selecci\xF3n de ${e} elementos limpiada`)}onZoomIn(){console.log("NetworkToolbar: Solicitud de zoom in",new Date().toISOString()),this.zoomIn.emit(),this.announceForScreenReader("Zoom aumentado")}onZoomOut(){console.log("NetworkToolbar: Solicitud de zoom out",new Date().toISOString()),this.zoomOut.emit(),this.announceForScreenReader("Zoom disminuido")}onCreateConnection(){console.log("NetworkToolbar: Solicitud para crear conexi\xF3n",new Date().toISOString()),this.isCreatingConnection=!this.isCreatingConnection,this.createConnection.emit();let e=this.isCreatingConnection?"iniciada":"cancelada";this.announceForScreenReader(`Creaci\xF3n de conexi\xF3n ${e}`)}onToggleSearchWidget(){console.log("NetworkToolbar: Solicitud para alternar widget de b\xFAsqueda",new Date().toISOString()),this.toggleSearchWidget.emit();let e=this.showSearchWidget?"ocultado":"mostrado";this.announceForScreenReader(`Buscador ${e}`)}onToggleElementsPanel(){console.log("NetworkToolbar: Solicitud para alternar panel de elementos",new Date().toISOString()),this.toggleElementsPanel.emit();let e=this.showElementsPanel?"ocultado":"mostrado";this.announceForScreenReader(`Panel de elementos ${e}`)}onExportMap(){console.log("NetworkToolbar: Solicitud para exportar mapa",new Date().toISOString()),this.exportMap.emit(),this.announceForScreenReader("Exportando mapa")}onOpenSettings(){console.log("NetworkToolbar: Solicitud para abrir configuraci\xF3n"),this.settingsButtonPulsing=!0,setTimeout(()=>this.settingsButtonPulsing=!1,500),this.openSettings.emit()}onNavigateToDiagnostic(){console.log("NetworkToolbar: Solicitud para navegar a diagn\xF3stico"),this.diagnosticClick.emit()}onOpenHelp(){console.log("NetworkToolbar: Solicitud para abrir ayuda"),this.helpClick.emit()}openLayerSettings(){this.dialog.open(hd,{width:"600px",maxHeight:"80vh",panelClass:"layer-settings-dialog"})}prepareOfflineMode(){if(this.isOfflineMode=!this.isOfflineMode,this.isOfflineMode){if(!this.offlineService.isNetworkAvailable()){this.snackBar.open("Ya est\xE1s en modo offline. No es posible descargar datos adicionales sin conexi\xF3n.","Cerrar",{duration:5e3,panelClass:["warning-snackbar"]});return}this.prepareOfflineModeRequest.emit(!0)}else this.snackBar.open("Modo normal activado","Cerrar",{duration:2e3}),this.prepareOfflineModeRequest.emit(!1)}ngOnInit(){this.prepareAddableElementTypes(),this.additionalLayers.sort((e,t)=>e.tooltip.localeCompare(t.tooltip)),this.layers.forEach(e=>{e.icon=this.layerManager.getLayerIcon(e.type)}),this.additionalLayers.forEach(e=>{e.icon=this.layerManager.getLayerIcon(e.type)}),console.log("NetworkToolbarComponent: ngOnInit")}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),console.error("NetworkToolbarComponent: ngOnDestroy FUE LLAMADO!");debugger}handleKeyboardEvent(e){switch(e.key){case"z":(e.ctrlKey||e.metaKey)&&(this.onZoomIn(),e.preventDefault());break;case"x":(e.ctrlKey||e.metaKey)&&(this.onZoomOut(),e.preventDefault());break;case"c":(e.ctrlKey||e.metaKey)&&(this.onCenterMap(),e.preventDefault());break;case"Escape":(Array.isArray(this.selectedElements)?this.selectedElements.length>0:this.selectedElements>0)&&(this.onClearSelection(),e.preventDefault());break;case"f":(e.ctrlKey||e.metaKey)&&(this.onToggleSearchWidget(),e.preventDefault());break;case"h":(e.ctrlKey||e.metaKey)&&(this.onOpenHelp(),e.preventDefault());break}}announceForScreenReader(e){let t=document.getElementById("network-toolbar-announcer");t||(t=document.createElement("div"),t.id="network-toolbar-announcer",t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.classList.add("sr-only"),document.body.appendChild(t)),t.textContent=e,setTimeout(()=>{t.textContent=""},3e3)}prepareAddableElementTypes(){this.addableElementTypes=Object.entries(qo).filter(([e,t])=>e!=="default"&&e!==s.FIBER_CONNECTION&&e!==s.FIBER_SPLICE&&e!==s.FIBER_STRAND&&e!==s.FIBER_THREAD&&e!==s.NETWORK_GRAPH).map(([e,t])=>({key:e,name:t,icon:ci[e]||ci.default}))}onSelectElementType(e,t){console.log("Clic en elemento detectado:",e),t&&(t.stopPropagation(),t.preventDefault());try{this.addElement.emit(e),this.logger.debug(`Solicitud para a\xF1adir elemento de tipo: ${e} desde NetworkToolbar`)}catch(n){console.error("Error al seleccionar tipo de elemento:",n),this.snackBar.open("Error al seleccionar el tipo de elemento","Cerrar",{duration:3e3})}}getElementIcon(e){return ci[e]||ci.default}onMoveElementClicked(){this.setActiveTool("moveElement")}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=Y({type:o,selectors:[["app-network-toolbar"]],hostBindings:function(t,n){t&1&&y("keydown",function(a){return n.handleKeyboardEvent(a)})},inputs:{activeTool:"activeTool",selectedElements:"selectedElements",isCreatingConnection:"isCreatingConnection",showSearchWidget:"showSearchWidget",showElementsPanel:"showElementsPanel",activeLayers:"activeLayers"},outputs:{addElement:"addElement",toggleLayer:"toggleLayer",centerMap:"centerMap",clearSelection:"clearSelection",zoomIn:"zoomIn",zoomOut:"zoomOut",createConnection:"createConnection",exportMap:"exportMap",openSettings:"openSettings",toggleSearchWidget:"toggleSearchWidget",toggleElementsPanel:"toggleElementsPanel",diagnosticClick:"diagnosticClick",helpClick:"helpClick",prepareOfflineModeRequest:"prepareOfflineModeRequest",toolChanged:"toolChanged"},decls:64,vars:34,consts:[["addElementMenu","matMenu"],["layersMenu","matMenu"],["role","toolbar","aria-label","Herramientas de dise\xF1o de red",1,"network-toolbar"],["role","group","aria-label","Navegaci\xF3n del mapa",1,"toolbar-section"],["mat-icon-button","","matTooltip","Centrar Mapa","aria-label","Centrar mapa",3,"click"],["aria-hidden","true"],["mat-icon-button","","matTooltip","Acercar","aria-label","Acercar mapa",3,"click"],["mat-icon-button","","matTooltip","Alejar","aria-label","Alejar mapa",3,"click"],["vertical","","aria-hidden","true"],["role","group","aria-label","Herramientas de mapa",1,"toolbar-section"],["mat-icon-button","","matTooltip","Mover (Pan)","aria-label","Mover el mapa (modo navegaci\xF3n)",3,"click"],["mat-icon-button","","matTooltip","Seleccionar","aria-label","Seleccionar elementos",3,"click"],["mat-icon-button","","matTooltip","Medir distancia","aria-label","Medir distancia entre puntos",3,"click"],["mat-icon-button","","matTooltip","Selecci\xF3n por \xE1rea","aria-label","Seleccionar elementos por \xE1rea",3,"click"],["role","group","aria-label","Acciones de elementos",1,"toolbar-section"],["mat-icon-button","","matTooltip","A\xF1adir Elemento","aria-label","A\xF1adir nuevo elemento",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["mat-icon-button","","matTooltip","Crear Conexi\xF3n","aria-label","Crear conexi\xF3n entre elementos",3,"click"],["role","group","aria-label","Capas del mapa",1,"toolbar-section"],["mat-icon-button","",3,"matTooltip","active","click",4,"ngFor","ngForOf"],["mat-icon-button","","matTooltip","M\xE1s capas","aria-label","Mostrar m\xE1s capas disponibles",3,"matMenuTriggerFor"],["mat-icon-button","","matTooltip","Configuraci\xF3n de capas","aria-label","Configurar capas",3,"click"],["role","group","aria-label","Herramientas adicionales",1,"toolbar-section"],["mat-icon-button","","matTooltip","Exportar Mapa","aria-label","Exportar mapa actual",3,"click"],["mat-icon-button","","matTooltip","Configuraci\xF3n","aria-label","Abrir configuraci\xF3n",3,"click"],["role","group","aria-label","Visibilidad de paneles",1,"toolbar-section"],["mat-icon-button","","aria-label","Mostrar u ocultar buscador",3,"click","matTooltip"],["mat-icon-button","","aria-label","Mostrar u ocultar panel de elementos",3,"click","matTooltip"],["mat-menu-item","",3,"click"],[4,"ngIf"],["mat-icon-button","",3,"click","matTooltip"],[3,"color"]],template:function(t,n){if(t&1){let r=V();c(0,"div",2)(1,"div",3)(2,"button",4),y("click",function(){return b(r),C(n.onCenterMap())}),c(3,"mat-icon",5),p(4,"center_focus_strong"),d()(),c(5,"button",6),y("click",function(){return b(r),C(n.onZoomIn())}),c(6,"mat-icon",5),p(7,"zoom_in"),d()(),c(8,"button",7),y("click",function(){return b(r),C(n.onZoomOut())}),c(9,"mat-icon",5),p(10,"zoom_out"),d()()(),D(11,"mat-divider",8),c(12,"div",9)(13,"button",10),y("click",function(){return b(r),C(n.setActiveTool("pan"))}),c(14,"mat-icon",5),p(15,"pan_tool"),d()(),c(16,"button",11),y("click",function(){return b(r),C(n.setActiveTool("select"))}),c(17,"mat-icon",5),p(18,"touch_app"),d()(),c(19,"button",12),y("click",function(){return b(r),C(n.setActiveTool("measure"))}),c(20,"mat-icon",5),p(21,"straighten"),d()(),c(22,"button",13),y("click",function(){return b(r),C(n.setActiveTool("areaSelect"))}),c(23,"mat-icon",5),p(24,"select_all"),d()()(),D(25,"mat-divider",8),c(26,"div",14)(27,"button",15)(28,"mat-icon",5),p(29,"add_circle"),d()(),c(30,"mat-menu",null,0),E(32,af,5,3,"button",16),d(),c(33,"button",17),y("click",function(){return b(r),C(n.onCreateConnection())}),c(34,"mat-icon",5),p(35,"timeline"),d()()(),D(36,"mat-divider",8),c(37,"div",18),E(38,sf,3,6,"button",19),c(39,"button",20)(40,"mat-icon",5),p(41,"more_horiz"),d()(),c(42,"button",21),y("click",function(){return b(r),C(n.openLayerSettings())}),c(43,"mat-icon",5),p(44,"settings"),d()(),c(45,"mat-menu",null,1),E(47,lf,5,3,"button",16),d()(),D(48,"mat-divider",8),c(49,"div",22)(50,"button",23),y("click",function(){return b(r),C(n.onExportMap())}),c(51,"mat-icon",5),p(52,"file_download"),d()(),c(53,"button",24),y("click",function(){return b(r),C(n.onOpenSettings())}),c(54,"mat-icon",5),p(55,"settings"),d()()(),D(56,"mat-divider",8),c(57,"div",25)(58,"button",26),y("click",function(){return b(r),C(n.onToggleSearchWidget())}),c(59,"mat-icon",5),p(60),d()(),c(61,"button",27),y("click",function(){return b(r),C(n.onToggleElementsPanel())}),c(62,"mat-icon",5),p(63),d()()()()}if(t&2){let r=wt(31),a=wt(46);m(13),Z("active",n.activeTool==="pan"),xe("aria-pressed",n.activeTool==="pan"),m(3),Z("active",n.activeTool==="select"),xe("aria-pressed",n.activeTool==="select"),m(3),Z("active",n.activeTool==="measure"),xe("aria-pressed",n.activeTool==="measure"),m(3),Z("active",n.activeTool==="areaSelect"),xe("aria-pressed",n.activeTool==="areaSelect"),m(5),h("matMenuTriggerFor",r),m(5),h("ngForOf",n.addableElementTypes),m(),Z("active",n.isCreatingConnection),xe("aria-pressed",n.isCreatingConnection),m(5),h("ngForOf",n.layers),m(),h("matMenuTriggerFor",a),m(8),h("ngForOf",n.additionalLayers),m(3),Z("pulse-effect",n.exportButtonPulsing),m(3),Z("pulse-effect",n.settingsButtonPulsing),m(5),Z("active",n.showSearchWidget),h("matTooltip",n.showSearchWidget?"Ocultar buscador":"Mostrar buscador"),xe("aria-pressed",n.showSearchWidget),m(2),x(n.showSearchWidget?"search_off":"search"),m(),Z("active",n.showElementsPanel),h("matTooltip",n.showElementsPanel?"Ocultar panel de elementos":"Mostrar panel de elementos"),xe("aria-pressed",n.showElementsPanel),m(2),x(n.showElementsPanel?"view_sidebar_off":"view_sidebar")}},dependencies:[ee,We,re,Zt,Fn,be,Be,pe,ue,$n,Bn,zn,Vn,Ke,Lt,Me,ke,en],styles:['@charset "UTF-8";.network-toolbar[_ngcontent-%COMP%]{display:flex;padding:4px 10px;background-color:#fff;border-bottom:1px solid #e0e0e0;box-shadow:0 3px 5px #0000001f;z-index:1100;position:relative;height:52px;align-items:center;gap:2px}.toolbar-section[_ngcontent-%COMP%]{display:flex;padding:0 5px;align-items:center;gap:3px}button.active[_ngcontent-%COMP%]{color:#1976d2;background-color:#1976d21f;font-weight:500;box-shadow:0 1px 3px #0000001a}button[mat-icon-button][_ngcontent-%COMP%]{transition:all .2s ease;border-radius:4px;display:flex;justify-content:center;align-items:center}button[mat-icon-button][_ngcontent-%COMP%]:hover{background-color:#0000000a;transform:translateY(-1px)}button[mat-icon-button][_ngcontent-%COMP%]:active{background-color:#00000014;transform:translateY(0)}mat-divider[_ngcontent-%COMP%]{height:38px;margin:0 5px;opacity:.5}mat-icon-button[_ngcontent-%COMP%], [mat-icon-button][_ngcontent-%COMP%]{width:40px!important;height:40px!important;line-height:40px!important;padding:0!important;margin:0 2px!important}mat-icon[_ngcontent-%COMP%]{font-size:22px;height:22px;width:22px;margin:auto;display:flex;justify-content:center;align-items:center}@media (max-width: 768px) and (min-width: 601px){.network-toolbar[_ngcontent-%COMP%]{height:48px;padding:4px 8px}mat-icon-button[_ngcontent-%COMP%], [mat-icon-button][_ngcontent-%COMP%]{width:36px!important;height:36px!important;line-height:36px!important}mat-icon[_ngcontent-%COMP%]{font-size:20px;height:20px;width:20px}mat-divider[_ngcontent-%COMP%]{height:34px}}@keyframes _ngcontent-%COMP%_pulseEffect{0%{transform:scale(1);box-shadow:0 0 #1976d266}70%{transform:scale(1.05);box-shadow:0 0 5px 10px #1976d200}to{transform:scale(1);box-shadow:0 0 #1976d200}}.pulse-effect[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulseEffect .5s ease-out}@media (max-width: 600px){.network-toolbar[_ngcontent-%COMP%]{flex-wrap:wrap;justify-content:space-between;height:auto;padding:4px}.toolbar-section[_ngcontent-%COMP%]{margin:2px;flex-wrap:wrap;justify-content:center}mat-divider[vertical][_ngcontent-%COMP%]{display:none}mat-icon-button[_ngcontent-%COMP%], [mat-icon-button][_ngcontent-%COMP%]{width:32px!important;height:32px!important;line-height:32px!important}mat-icon[_ngcontent-%COMP%]{font-size:18px;height:18px;width:18px}}'],changeDetection:0})}}return o})();var cf=["mapContainer"],df=["*"],pf=()=>[],mf=o=>({"dark-theme":o});function gf(o,i){if(o&1){let e=V();c(0,"app-map-view",12),y("elementSelected",function(n){b(e);let r=v();return C(r.onElementSelected(n))})("mapLoaded",function(){b(e);let n=v();return C(n.onMapLoaded())}),d()}if(o&2){let e=v();h("darkMode",e.darkMode)("tool",e.activeTool)("loading",!e.isMapReady)}}function uf(o,i){o&1&&D(0,"div",13)}function hf(o,i){o&1&&(c(0,"div",14)(1,"div",15),p(2,"\u26A0\uFE0F"),d(),c(3,"div",16)(4,"strong"),p(5,"No se pudo inicializar el mapa."),d(),D(6,"br"),p(7," Verifica que el contenedor tenga dimensiones v\xE1lidas y que la red est\xE9 disponible."),D(8,"br"),p(9," Si el problema persiste, revisa la consola del navegador. "),d()())}function ff(o,i){if(o&1){let e=V();c(0,"app-elements-panel",17),y("elementSelected",function(n){b(e);let r=v();return C(r.onElementSelected(n))}),d()}}function _f(o,i){if(o&1){let e=V();c(0,"app-layer-control",18),y("baseLayerChanged",function(n){b(e);let r=v();return C(r.onBaseLayerChanged(n))}),d()}}function vf(o,i){if(o&1&&(c(0,"div",19)(1,"span",20),p(2),d(),c(3,"span",20),p(4),d(),c(5,"span",20),p(6),d(),c(7,"span",20),p(8),d()()),o&2){let e=v();m(2),j("FPS: ",e.performanceMetrics.fps,""),m(2),j("Elementos: ",e.performanceMetrics.elementCount,""),m(2),j("Memoria: ",e.performanceMetrics.memoryUsageFormatted,""),m(2),j("Modo: ",e.useStandaloneComponents?"Standalone":"Legacy","")}}function bf(o,i){o&1&&(c(0,"div",21),D(1,"div",22),c(2,"span"),p(3,"Cargando mapa..."),d()())}function Cf(o,i){o&1&&D(0,"app-performance-widget")}var bd=(()=>{class o extends Bo{get isDarkTheme(){return this.darkMode}constructor(e){if(super(e),this.initialZoom=16,this.initialCenter=[19.78375,-70.676666],this.darkMode=!1,this.showControls=!0,this.showMiniMap=!0,this.showLayerControl=!0,this.isMapReady=!1,this.showElementsPanel=!0,this.showWidgets=!0,this.showSearchWidget=!0,this.isDebugMode=!0,this.performanceMetrics={fps:0,elementCount:0,memoryUsage:0,memoryUsageFormatted:"0 MB"},this.activeTool="pan",this.elementTypeToPlace=null,this.firstElementForConnection=null,this.console=console,this.mapService=P(Bt),this.mapToolsService=P(nc),this.mapStateService=P(Mo),this.mapPerformanceService=P(ti),this.standaloneAdapter=P(ic),this.elementManagerAdapter=P(tc),this.route=P(Xi),this.stateManager=P(bt),this.router=P(Oe),this.snackBar=P(qe),this.dialog=P(nt),this.cdr=P(He),this.mapEventsService=P(an),this.useStandaloneComponents=!1,this.logDebug("MapContainerComponent inicializado"),!this.mapService||!this.mapStateService||!this.stateManager){this.logger.error("MapContainerComponent: Fall\xF3 la inyecci\xF3n de servicios cr\xEDticos");return}this.validateComponentConsistency(),this.useStandaloneComponents=!1;try{let t=this.standaloneAdapter.getFeatureFlag("enableStandaloneMode");this.logDebug(`Bandera enableStandaloneMode desde servicio: ${t}`)}catch(t){this.logDebug("Error al obtener la bandera enableStandaloneMode",t)}}loadHtml2Canvas(){return ce(this,null,function*(){return(yield import("./chunk-5MGQ7NMG.js")).default})}initializeComponent(){this.logDebug("Inicializando componente MapContainer"),this.setupSubscriptions()}setupSubscriptions(){this.route.data.subscribe(e=>{if(e&&e.mapConfig){let t=e.mapConfig;t.initialZoom&&(this.initialZoom=t.initialZoom),t.initialCenter&&(this.initialCenter=t.initialCenter),this.logDebug("Configuraci\xF3n de mapa cargada desde ruta:",t)}}),this.mapPerformanceService.initialize({enableFPSMonitoring:!0,autoOptimize:!0}),this.mapStateService.mapState$.pipe(L(this.destroy$)).subscribe(e=>{this.logDebug("Estado del mapa actualizado",e)}),this.stateManager.currentTool.pipe(L(this.destroy$)).subscribe(e=>{this.activeTool=e,this.logDebug(`Herramienta activa: ${e}`)}),this.elementManagerAdapter.elementsChanged.pipe(L(this.destroy$)).subscribe(()=>{this.logDebug("Elementos actualizados a trav\xE9s del adaptador standalone. Forzando detecci\xF3n de cambios y refresco del mapa."),this.cdr.detectChanges(),this.mapService&&this.mapService.refreshElementsDisplay()}),this.standaloneAdapter.featureFlags.pipe(L(this.destroy$)).subscribe(e=>{this.useStandaloneComponents!==!1&&(this.useStandaloneComponents=e.enableStandaloneMode),this.logDebug(`Modo standalone evaluado a: ${this.useStandaloneComponents} (Bandera servicio: ${e.enableStandaloneMode})`)}),this.stateManager.singleSelectedElement$.pipe(L(this.destroy$)).subscribe(e=>{if(!e||!e.id){this.activeTool==="connect"&&this.firstElementForConnection;return}this.activeTool==="select"?(this.logDebug(`Elemento individual seleccionado: ${e.id}, tipo: ${e.type}. Navegando a editor.`),this.router.navigate(["elements/edit",e.id],{relativeTo:this.route.parent})):this.activeTool==="connect"&&this.handleElementSelectionForConnection(e)}),setInterval(()=>{this.performanceMetrics={fps:Math.round(Math.random()*60),elementCount:Math.round(Math.random()*1e3),memoryUsage:Math.random()*100,memoryUsageFormatted:`${Math.round(Math.random()*100)} MB`}},1e3)}ngAfterViewInit(){if(this.logger.debug("MapContainer ngAfterViewInit: Verificando estado de visibilidad de paneles."),this.logger.debug(`Current panel visibility - isMapReady: ${this.isMapReady}, showElementsPanel: ${this.showElementsPanel}, showLayerControl: ${this.showLayerControl}`),!this.mapContainerRef){this.logger.error("MapContainer ngAfterViewInit: mapContainerRef no est\xE1 disponible. No se puede inicializar el mapa."),this.handleError(new Error("Referencia al contenedor del mapa no disponible"),"No se pudo acceder al contenedor del mapa");return}this.initializeMap();let e="ID_ELEMENTO_1_REAL",t="ID_ELEMENTO_2_REAL";setTimeout(()=>{if(e!=="ID_ELEMENTO_1_REAL"&&t!=="ID_ELEMENTO_2_REAL"){let n={id:`conn-${e}-${t}-${Date.now()}`,sourceElementId:e,targetElementId:t,type:vt.FIBER,status:Ze.ACTIVE,name:`Conexi\xF3n ${e} <-> ${t}`};this.elementManagerAdapter.addConnection(n).subscribe({next:r=>this.logger.info("[MapContainerPrueba] Conexi\xF3n de prueba a\xF1adida v\xEDa adaptador:",r),error:r=>this.logger.error("[MapContainerPrueba] Error a\xF1adiendo conexi\xF3n de prueba:",r)})}else this.logger.warn("[MapContainerPrueba] Los IDs de los elementos para la conexi\xF3n de prueba no fueron reemplazados. No se a\xF1adir\xE1 la conexi\xF3n de prueba.")},7e3)}onElementSelected(e){if(this.logDebug("Elemento seleccionado en MapContainer:",e),this.handleElementSelected(e),!e||!e.id){this.elementManagerAdapter.deselectElement();return}this.elementManagerAdapter.selectElement(e.id),this.activeTool==="moveElement"&&this.snackBar.open(`Elemento "${e.name}" seleccionado. ${e.type===s.MANGA?"(MANGA)":""} Arr\xE1stralo en el mapa para moverlo.`,"Entendido",{duration:3e3}),e.type===s.MANGA&&this.logger.debug("Elemento MANGA seleccionado:",e)}onMapLoaded(){this.isMapReady=!0,this.logger.debug("Mapa cargado correctamente en el componente standalone"),this.logger.debug(`Panel visibility after map loaded - isMapReady: ${this.isMapReady}, showElementsPanel: ${this.showElementsPanel}, showLayerControl: ${this.showLayerControl}`),this.useStandaloneComponents&&this.stateManager.setTool("pan"),this.completeLoading()}initializeMap(){if(!this.mapContainerRef){this.logger.error("MapContainer: mapContainerRef no est\xE1 definido. No se puede inicializar el mapa."),this.handleError(new Error("Referencia al contenedor del mapa no disponible"),"No se pudo acceder al contenedor del mapa");return}if(!this.validateContainerDimensions(this.mapContainerRef.nativeElement)){this.handleError(new Error("Contenedor de mapa inv\xE1lido"),"El contenedor del mapa no tiene dimensiones v\xE1lidas");return}if(this.useStandaloneComponents){this.logDebug("Usando implementaci\xF3n de mapa con componentes standalone"),setTimeout(()=>{this.isMapReady=!0,this.cdr.detectChanges(),this.logDebug("Mapa marcado como listo (forzado)")},1e3);return}if(!this.mapContainerRef.nativeElement){this.logger.error("MapContainer: mapContainerRef.nativeElement no est\xE1 disponible"),this.handleError(new Error("Elemento nativo del contenedor no disponible"),"No se pudo acceder al elemento DOM del mapa");return}let e={container:this.mapContainerRef.nativeElement,initialZoom:this.initialZoom,initialCenter:this.initialCenter,isDarkMode:this.darkMode};this.mapService.initialize(e),this.mapService.isReady$.pipe(L(this.destroy$)).subscribe(t=>{this.isMapReady=t,this.logDebug(`Mapa legacy ${t?"listo":"no listo"}`),t&&(this.mapStateService.setZoom(this.initialZoom),this.mapStateService.setCenter(this.initialCenter),this.mapStateService.setActiveTool("pan"))})}setTool(e){console.log("MapContainer: Cambiando herramienta a",e),this.logger.info(`[MapContainer] setTool CALLED WITH: ${e}`),this.stateManager.setTool(e)}onMapMouseDown(e){if(console.log("MapContainer: Evento mousedown en mapa"),this.activeTool==="moveElement"){let t=this.getSelectedElement();if(t){let n=e.target;if(n.closest(".leaflet-marker-icon")||n.closest(".network-element")||n.classList.contains("network-element")||n.classList.contains("leaflet-marker-icon")){this.startDraggingElement(t,e);return}}}}onMapMouseMove(e){}onMapMouseUp(e){console.log("MapContainer: Evento mouseup en mapa")}onMapClick(e){return ce(this,null,function*(){if(this.logger.debug(`MapContainer: Map clicked. Active tool: ${this.activeTool}`,e),this.activeTool==="placeElement"&&this.elementTypeToPlace){e.stopPropagation();let t=this.mapService.getMap(),n;if(t&&(n=t.mouseEventToLatLng(e)),n){let r={lat:n.lat,lng:n.lng};this.logger.info(`Placing element of type ${this.elementTypeToPlace} at`,r),this.dialog.open(Fr,{width:"700px",maxHeight:"90vh",data:{type:this.elementTypeToPlace,position:{lat:r.lat,lng:r.lng,coordinates:[r.lng,r.lat],type:"Point"},isNewElement:!0},panelClass:"element-editor-dialog",disableClose:!0}).afterClosed().subscribe(l=>{if(l){console.log("Resultado del di\xE1logo:",l);let u=l.element||l;this.elementManagerAdapter.addElement(u),this.snackBar.open(`Elemento ${u.name} a\xF1adido.`,"Cerrar",{duration:3e3}),setTimeout(()=>{this.mapService.refreshElementsDisplay()},500)}this.elementTypeToPlace=null,this.setTool("select")})}else this.logger.warn("No se pudieron obtener coordenadas del clic del mapa para colocar elemento (MapService.getMap() o mouseEventToLatLng fall\xF3)."),this.snackBar.open("No se pudo determinar la ubicaci\xF3n. Intente de nuevo.","Cerrar",{duration:3e3}),this.setTool("select"),this.elementTypeToPlace=null}else this.activeTool==="connect"?this.logger.debug("Clic en mapa mientras la herramienta es connect. La selecci\xF3n de elementos la maneja singleSelectedElement$."):this.activeTool})}handleElementSelectionForConnection(e){if(!e||!e.id){this.logger.error("handleElementSelectionForConnection llamado con elemento inv\xE1lido.");return}if(!this.firstElementForConnection)this.firstElementForConnection=e,this.logger.info(`Primer elemento para conexi\xF3n seleccionado: ${e.name} (ID: ${e.id})`),this.snackBar.open(`Elemento origen: ${e.name}. Selecciona el elemento destino.`,"Entendido",{duration:3500});else{if(this.firstElementForConnection.id===e.id){this.logger.warn("Se ha seleccionado el mismo elemento como origen y destino."),this.snackBar.open("No puedes conectar un elemento consigo mismo.","Cerrar",{duration:3e3});return}let t=e;this.logger.info(`Segundo elemento para conexi\xF3n seleccionado: ${t.name} (ID: ${t.id})`);let n={id:`conn-${this.firstElementForConnection.id}-${t.id}-${Date.now()}`,sourceElementId:this.firstElementForConnection.id,targetElementId:t.id,type:vt.FIBER,status:Ze.PLANNED,name:`Conexi\xF3n ${this.firstElementForConnection.name} - ${t.name}`,vertices:[]};this.elementManagerAdapter.addConnection(n).subscribe({next:r=>{this.logger.info("Conexi\xF3n creada exitosamente:",r),this.snackBar.open(`Conexi\xF3n creada: ${r.name}`,"Cerrar",{duration:3e3}),this.mapService.refreshElementsDisplay()},error:r=>{this.logger.error("Error al crear la conexi\xF3n:",r),this.snackBar.open("Error al crear la conexi\xF3n.","Cerrar",{duration:3e3,panelClass:"error-snackbar"})},complete:()=>{this.firstElementForConnection=null,this.setTool("select")}})}}onMapDoubleClick(e){if(console.log("MapContainer: Evento dblclick en mapa"),this.activeTool!=="select")return;let t=e.target;if(t.closest(".network-element")||t.classList.contains("network-element")||t.closest(".leaflet-marker-icon")||t.classList.contains("leaflet-marker-icon")){let r=this.getSelectedElement();r?(this.logger.info(`Elemento seleccionado para edici\xF3n mediante doble clic: ${r.id} (${r.type})`),this.dialog.open(Fr,{width:"700px",maxHeight:"90vh",data:{element:r,isNewElement:!1},panelClass:"element-editor-dialog",disableClose:!1}).afterClosed().subscribe(l=>{if(l){let u=l.element||l;this.elementManagerAdapter.updateElement(u)?(this.snackBar.open(`Elemento ${u.name} actualizado.`,"Cerrar",{duration:3e3}),this.mapService.refreshElementsDisplay()):this.snackBar.open("Error al actualizar el elemento.","Cerrar",{duration:3e3,panelClass:"error-snackbar"})}})):this.logger.warn("Doble clic sobre elemento pero no hay elemento seleccionado actualmente.")}}centerMap(e){console.log("MapContainer: Solicitud para centrar mapa en",e),e&&(this.useStandaloneComponents?this.mapViewComponent?(this.mapViewComponent.centerMap(e),this.logger.debug("Centering map via MapViewComponent",e)):this.logger.warn("MapViewComponent not available to center map."):this.mapStateService.setCenter(e))}setZoom(e){if(console.log("MapContainer: Cambiando zoom en",e),this.useStandaloneComponents)this.mapViewComponent?e>0?this.mapViewComponent.zoomIn():e<0&&this.mapViewComponent.zoomOut():this.logger.warn("MapViewComponent not available to set zoom.");else{let t=this.mapStateService.getState().zoom||this.initialZoom,n=t;e>0?n=t+1:e<0&&(n=Math.max(1,t-1)),this.mapStateService.setZoom(n)}}selectElement(e){this.elementManagerAdapter.selectElement(e)}deselectElement(){this.elementManagerAdapter.deselectElement()}getSelectedElement(){return this.elementManagerAdapter.getSelectedElement()}validateComponentConsistency(){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.logDebug("Verificaci\xF3n de consistencia completada: MapContainerComponent ahora extiende de BaseMapComponent")},0)})}get currentViewport(){let e=this.mapStateService.getState().bounds;return e?{minX:e[0][0],minY:e[0][1],maxX:e[1][0],maxY:e[1][1]}:null}onAddElement(e){this.logger.debug(`MapContainer: Solicitud para iniciar la colocaci\xF3n del elemento tipo: ${e}`),e?(this.elementTypeToPlace=e,this.setTool("placeElement"),this.snackBar.open(`Modo "Colocar ${qo[e]||e}" activado. Haz clic en el mapa.`,"Entendido",{duration:3500})):this.logger.warn("onAddElement llamado sin elementType")}onToggleLayer(e){console.log("MapContainer: Procesando solicitud para alternar capa",e,new Date().toISOString()),this.logDebug("MapContainer: Procesando solicitud para alternar capa",e);try{this.mapEventsService.toggleLayer(e,!0),this.cdr.detectChanges()}catch(t){this.logger.error("Error al alternar capa",t)}}onExportMap(){console.log("MapContainer: Procesando solicitud para exportar mapa",new Date().toISOString()),this.logDebug("MapContainer: Procesando solicitud para exportar mapa");try{this.snackBar.open("Preparando exportaci\xF3n del mapa...","",{duration:2e3});let e=document.querySelector(".map-container")||document.getElementById("map");if(!e)throw new Error("No se pudo encontrar el elemento del mapa para exportar");let t={useCORS:!0,allowTaint:!0,backgroundColor:this.darkMode?"#303030":"#f5f5f5",scale:2,logging:!1};e instanceof HTMLElement&&this.loadHtml2Canvas().then(n=>{n(e,t).then(r=>{this.addMapMetadata(r),this.showExportDialog(r)}).catch(r=>{this.logger.error("Error al generar imagen del mapa",r),this.snackBar.open("Error al exportar el mapa: "+r.message,"Cerrar",{duration:5e3,panelClass:"error-snackbar"})})}).catch(n=>{this.logger.error("Error al cargar html2canvas",n),this.snackBar.open("Error al cargar la librer\xEDa de exportaci\xF3n","Cerrar",{duration:5e3,panelClass:"error-snackbar"})})}catch(e){this.logger.error("Error al iniciar exportaci\xF3n del mapa",e),this.snackBar.open("Error al iniciar exportaci\xF3n del mapa","Cerrar",{duration:5e3,panelClass:"error-snackbar"})}}addMapMetadata(e){try{let t=e.getContext("2d");if(!t)return;t.save(),t.fillStyle=this.darkMode?"rgba(255, 255, 255, 0.8)":"rgba(0, 0, 0, 0.7)",t.font="bold 14px Arial";let n=this.mapStateService.getState().zoom||this.initialZoom,r=this.mapStateService.getState().center||this.initialCenter,a=new Date().toLocaleString();if(t.fillText(`Exportado: ${a}`,10,e.height-60),t.fillText(`Zoom: ${n}`,10,e.height-40),r&&r.length===2){let l=r[0].toFixed(6),u=r[1].toFixed(6);t.fillText(`Centro: ${l}, ${u}`,10,e.height-20)}t.restore()}catch(t){this.logger.error("Error al a\xF1adir metadatos a la exportaci\xF3n",t)}}showExportDialog(e){try{e.toBlob(t=>{if(!t)throw new Error("No se pudo convertir la imagen para exportar");let n=URL.createObjectURL(t),r=[{label:"Descargar PNG",action:()=>this.downloadImage(n,"mapa-de-red.png")},{label:"Copiar al portapapeles",action:()=>this.copyToClipboard(e)},{label:"Compartir...",action:()=>this.shareImage(t)}];this.downloadImage(n,"mapa-de-red.png"),this.snackBar.open("Mapa exportado con \xE9xito","Cerrar",{duration:3e3})},"image/png")}catch(t){this.logger.error("Error al mostrar di\xE1logo de exportaci\xF3n",t),this.snackBar.open("Error al finalizar la exportaci\xF3n del mapa","Cerrar",{duration:5e3,panelClass:"error-snackbar"})}}downloadImage(e,t){try{let n=document.createElement("a");n.href=e,n.download=t,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),setTimeout(()=>URL.revokeObjectURL(e),100)}catch(n){this.logger.error("Error al descargar imagen",n),this.snackBar.open("Error al descargar imagen","Cerrar",{duration:3e3})}}copyToClipboard(e){try{e.toBlob(t=>ce(this,null,function*(){if(!t)throw new Error("No se pudo convertir la imagen para copiar");if(navigator.clipboard&&navigator.clipboard.write){let n=new ClipboardItem({[t.type]:t});yield navigator.clipboard.write([n]),this.snackBar.open("Imagen copiada al portapapeles","Cerrar",{duration:2e3})}else{let n=document.createElement("img");n.src=e.toDataURL(),document.body.appendChild(n);let r=window.getSelection(),a=document.createRange();a.selectNode(n),r?.removeAllRanges(),r?.addRange(a),document.execCommand("copy"),document.body.removeChild(n),this.snackBar.open("Imagen copiada al portapapeles (modo compatible)","Cerrar",{duration:2e3})}}))}catch(t){this.logger.error("Error al copiar al portapapeles",t),this.snackBar.open("No se pudo copiar la imagen al portapapeles","Cerrar",{duration:3e3})}}shareImage(e){try{if(navigator.share){let t=new File([e],"mapa-de-red.png",{type:"image/png"});navigator.share({title:"Mapa de Red",text:"Mapa de Red exportado desde la aplicaci\xF3n",files:[t]}).then(()=>{this.snackBar.open("Mapa compartido con \xE9xito","Cerrar",{duration:2e3})}).catch(n=>{n.name!=="AbortError"&&(this.logger.error("Error al compartir",n),this.snackBar.open("Error al compartir: "+n.message,"Cerrar",{duration:3e3}))})}else this.snackBar.open("Tu navegador no admite compartir im\xE1genes directamente","Cerrar",{duration:3e3})}catch(t){this.logger.error("Error al compartir imagen",t),this.snackBar.open("Error al compartir imagen","Cerrar",{duration:3e3})}}onOpenSettings(){console.log("MapContainer: Procesando solicitud para abrir configuraci\xF3n",new Date().toISOString()),this.logDebug("MapContainer: Procesando solicitud para abrir configuraci\xF3n"),this.router.navigate(["network-design","settings"],{relativeTo:this.route,queryParams:{returnUrl:this.router.url}})}onToggleSearchWidget(){console.log("MapContainer: Procesando solicitud para alternar widget de b\xFAsqueda",new Date().toISOString()),this.logDebug("MapContainer: Procesando solicitud para alternar widget de b\xFAsqueda"),this.showSearchWidget=!this.showSearchWidget,this.cdr.detectChanges()}onToggleElementsPanel(){console.log("MapContainer: Procesando solicitud para alternar panel de elementos",new Date().toISOString()),this.logDebug("MapContainer: Procesando solicitud para alternar panel de elementos"),this.showElementsPanel=!this.showElementsPanel,this.cdr.detectChanges()}onDiagnosticClick(){console.log("MapContainer: Procesando solicitud para diagn\xF3stico",new Date().toISOString()),this.logDebug("MapContainer: Procesando solicitud para diagn\xF3stico"),this.router.navigate(["network-design","diagnostic"],{relativeTo:this.route})}onHelpClick(){console.log("MapContainer: Procesando solicitud para ayuda",new Date().toISOString()),this.logDebug("MapContainer: Procesando solicitud para ayuda");let e={width:"80%",maxWidth:"800px",maxHeight:"80vh",data:{section:"map",context:this.activeTool}};this.router.navigate(["help","map"],{queryParams:{tool:this.activeTool}})}getSelectedElementsForToolbar(){let e=this.elementManagerAdapter.getSelectedElement();return e?[e]:[]}onBaseLayerChanged(e){if(this.useStandaloneComponents){this.logger.warn("El cambio de capa base no est\xE1 implementado para el modo standalone en MapContainerComponent.");return}e&&e.id?(this.logger.debug(`MapContainer: Solicitud para cambiar capa base a: ${e.id} (${e.name})`),this.mapService.setBaseLayer(e.id)):this.logger.warn("MapContainer: Se recibi\xF3 un evento baseLayerChanged sin un ID de capa v\xE1lido.",e)}onPrepareOfflineModeRequest(e){console.log(`MapContainer: Solicitud para modo offline: ${e}`,new Date().toISOString()),this.logDebug(`MapContainer: Solicitud para modo offline: ${e}`),e?this.snackBar.open("Iniciando preparaci\xF3n para modo offline...","Entendido",{duration:3e3}):this.snackBar.open("Cancelando preparaci\xF3n para modo offline / Volviendo a modo online.","Entendido",{duration:3e3}),this.cdr.detectChanges()}startDraggingElement(e,t){if(this.activeTool!=="moveElement"||!e||!e.id)return;let n=e.id;if(!n){this.logger.warn("No se puede iniciar el arrastre: el elemento no tiene ID");return}this.logger.debug(`Iniciando arrastre del elemento: ${n}`);let r=this.mapService.getMap();if(!r)return;let a=r.mouseEventToLatLng(t);this.mapEventsService.dragStarted(n,{x:a.lng,y:a.lat});let l=g=>{if(!r)return;let _=r.mouseEventToLatLng(g);this.updateElementPositionDuringDrag(n,_.lng,_.lat)},u=g=>{if(!r)return;let _=r.mouseEventToLatLng(g);this.finalizeElementDrag(n,_.lng,_.lat),document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",u)};document.addEventListener("mousemove",l),document.addEventListener("mouseup",u),t.preventDefault(),t.stopPropagation()}updateElementPositionDuringDrag(e,t,n){this.mapService.updateElementPreviewPosition(e,t,n)}finalizeElementDrag(e,t,n){this.logger.debug(`Finalizando arrastre del elemento: ${e} en posici\xF3n [${n}, ${t}]`),this.mapEventsService.dragEnded(e,{x:t,y:n}),this.elementManagerAdapter.updateElementPosition(e,t,n),this.snackBar.open("Posici\xF3n del elemento actualizada","Cerrar",{duration:2e3}),setTimeout(()=>{this.mapService.refreshElementsDisplay()},100)}static{this.\u0275fac=function(t){return new(t||o)(A(Qt))}}static{this.\u0275cmp=Y({type:o,selectors:[["app-map-container"]],viewQuery:function(t,n){if(t&1&&(gt(cf,7),gt(qr,5)),t&2){let r;ut(r=ht())&&(n.mapContainerRef=r.first),ut(r=ht())&&(n.mapViewComponent=r.first)}},inputs:{initialZoom:"initialZoom",initialCenter:"initialCenter",darkMode:"darkMode",showControls:"showControls",showMiniMap:"showMiniMap",showLayerControl:"showLayerControl"},features:[un],ngContentSelectors:df,decls:14,vars:20,consts:[["mapContainer",""],[3,"addElement","toggleLayer","centerMap","clearSelection","zoomIn","zoomOut","createConnection","exportMap","openSettings","toggleSearchWidget","toggleElementsPanel","diagnosticClick","toolChanged","helpClick","prepareOfflineModeRequest","selectedElements","isCreatingConnection","showSearchWidget","showElementsPanel","activeLayers","activeTool"],[1,"map-container",3,"mousedown","mousemove","mouseup","click","dblclick","ngClass"],[3,"darkMode","tool","loading","elementSelected","mapLoaded",4,"ngIf"],["id","map","class","map",4,"ngIf"],["class","map-error-message",4,"ngIf"],["position","left",3,"elementSelected",4,"ngIf"],["position","top-right",3,"baseLayerChanged",4,"ngIf"],["class","performance-info",4,"ngIf"],["class","map-loading",4,"ngIf"],[1,"map-widgets-container"],[4,"ngIf"],[3,"elementSelected","mapLoaded","darkMode","tool","loading"],["id","map",1,"map"],[1,"map-error-message"],[1,"map-error-icon"],[1,"map-error-text"],["position","left",3,"elementSelected"],["position","top-right",3,"baseLayerChanged"],[1,"performance-info"],[1,"performance-metric"],[1,"map-loading"],[1,"spinner"]],template:function(t,n){if(t&1){let r=V();vi(),c(0,"app-network-toolbar",1),$e(1,"async"),y("addElement",function(l){return b(r),C(n.onAddElement(l))})("toggleLayer",function(l){return b(r),C(n.onToggleLayer(l))})("centerMap",function(){return b(r),C(n.centerMap(n.initialCenter))})("clearSelection",function(){return b(r),C(n.deselectElement())})("zoomIn",function(){return b(r),C(n.setZoom(1))})("zoomOut",function(){return b(r),C(n.setZoom(-1))})("createConnection",function(){return b(r),C(n.setTool("connect"))})("exportMap",function(){return b(r),C(n.onExportMap())})("openSettings",function(){return b(r),C(n.onOpenSettings())})("toggleSearchWidget",function(){return b(r),C(n.onToggleSearchWidget())})("toggleElementsPanel",function(){return b(r),C(n.onToggleElementsPanel())})("diagnosticClick",function(){return b(r),C(n.onDiagnosticClick())})("toolChanged",function(l){return b(r),C(n.setTool(l))})("helpClick",function(){return b(r),C(n.onHelpClick())})("prepareOfflineModeRequest",function(l){return b(r),C(n.onPrepareOfflineModeRequest(l))}),d(),c(2,"div",2,0),y("mousedown",function(l){return b(r),C(n.onMapMouseDown(l))})("mousemove",function(l){return b(r),C(n.onMapMouseMove(l))})("mouseup",function(l){return b(r),C(n.onMapMouseUp(l))})("click",function(l){return b(r),C(n.onMapClick(l))})("dblclick",function(l){return b(r),C(n.onMapDoubleClick(l))}),E(4,gf,1,3,"app-map-view",3)(5,uf,1,0,"div",4)(6,hf,10,0,"div",5)(7,ff,1,0,"app-elements-panel",6)(8,_f,1,0,"app-layer-control",7)(9,vf,9,4,"div",8)(10,bf,4,0,"div",9),d(),c(11,"div",10),bi(12),d(),E(13,Cf,1,0,"app-performance-widget",11)}t&2&&(h("selectedElements",n.getSelectedElementsForToolbar())("isCreatingConnection",n.activeTool==="connect")("showSearchWidget",n.showSearchWidget)("showElementsPanel",n.showElementsPanel)("activeLayers",An(1,15,n.stateManager.activeLayers)||jt(17,pf))("activeTool",n.activeTool),m(2),h("ngClass",xt(18,mf,n.isDarkTheme)),m(2),h("ngIf",n.useStandaloneComponents),m(),h("ngIf",!n.useStandaloneComponents),m(),h("ngIf",!n.isMapReady&&!n.useStandaloneComponents),m(),h("ngIf",n.isMapReady&&n.showElementsPanel),m(),h("ngIf",n.showLayerControl),m(),h("ngIf",n.isDebugMode),m(),h("ngIf",!n.isMapReady&&!n.useStandaloneComponents),m(3),h("ngIf",n.showWidgets&&n.isMapReady))},dependencies:[ee,ft,re,Ns,pd,cd,_t,pe,be,qr,gd,vd],styles:['@charset "UTF-8";[_ngcontent-%COMP%]:root{--primary-color: #3F51B5;--primary-rgb: 63, 81, 181;--primary-color-hover: rgb(52.4655737705, 67.4557377049, 150.7344262295);--accent-color: #FF4081;--warn-color: #F44336;--background-color: #F5F5F5;--surface-color: #ffffff;--surface-lighter: #f9f9f9;--surface-darker: #eeeeee;--text-color: #212121;--text-secondary-color: hsl(0, 0%, -12.0588235294%);--text-hint-color: hsl(0, 0%, -32.0588235294%);--text-disabled-color: hsl(0, 0%, -52.0588235294%);--primary-contrast-color: white;--accent-contrast-color: white;--warn-contrast-color: white;--olt-color: #4CAF50;--ont-color: #2196F3;--odf-color: #FFC107;--edfa-color: #9C27B0;--splitter-color: #FF5722;--manga-color: #607D8B;--terminal-box-color: #FF9800;--slack-fiber-color: #80DEEA;--spacing-unit: 4px;--spacing-xxs: .125rem;--spacing-xs: .25rem;--spacing-sm: .5rem;--spacing-md: .75rem;--spacing-lg: 1rem;--spacing-xl: 1.5rem;--spacing-xxl: 2rem;--shadow-xs: 0 1px 2px rgba(0,0,0,.05);--shadow-sm: 0 1px 3px rgba(0, 0, 0, .1);--shadow-md: 0 2px 4px rgba(0, 0, 0, .1);--shadow-lg: 0 4px 6px rgba(0, 0, 0, .1);--border-radius-sm: 2px;--border-radius-md: 4px;--border-radius-lg: 8px;--border-radius-round: 50%;--border-color: #e0e0e0;--border-width-normal: 1px;--border-width-strong: 4px;--border-radius-pill: 20px;--border-color-light: rgb(249.5, 249.5, 249.5);--border-color-dark: rgb(198.5, 198.5, 198.5);--color-success: #4caf50;--color-warning: #ff8f00;--color-danger: #c62828;--color-info: #2196F3;--color-neutral: #9e9e9e;--color-success-bg: #e8f5e9;--color-warning-bg: #fff8e1;--color-danger-bg: #ffebee;--color-info-bg: rgb(226.5384615385, 241.5384615385, 253.4615384615);--color-maintenance-bg: #e3f2fd;--status-inactive-fg: #757575;--status-inactive-bg: #f5f5f5;--color-success-contrast: white;--color-warning-contrast: white;--color-danger-contrast: white;--color-info-contrast: #212121;--color-maintenance-contrast: white;--font-family: "Roboto, Segoe UI, sans-serif";--font-size-xxs: .625rem;--font-size-xs: .75rem;--font-size-sm: .875rem;--font-size-md: 1rem;--font-size-lg: 1.125rem;--font-size-xl: 1.25rem;--font-size-xxl: 1.5rem;--font-size-display: 2.5rem;--transition-fast: .15s ease-in-out;--transition-normal: .3s ease-in-out;--transition-slow: .5s ease-in-out;--status-active: #4caf50;--status-inactive: #757575;--status-maintenance: #1565c0;--status-planning: #2196F3;--status-unknown: var(--color-neutral);--status-fault: #c62828;--surface-overlay-light: rgba(255, 255, 255, .85);--surface-overlay-light-strong: rgba(255, 255, 255, .95);--border-color-semitransparent: rgba(0, 0, 0, .1);--primary-bg-subtle: rgba(63, 81, 181, .15);--surface-action-hover: rgb(242.8571428571, 242.8571428571, 242.8571428571);--surface-button: var(--surface-color);--surface-button-hover: var(--surface-action-hover);--text-color-button: var(--text-color);--scrollbar-track-color: #f1f1f1;--scrollbar-thumb-color: #c1c1c1;--scrollbar-thumb-hover-color: #a8a8a8;--z-index-map-base: 1;--z-index-map-elements: 5;--z-index-map-widgets-overlay: 50;--z-index-map-overlay: 100;--z-index-network-design-panels: 900;--z-index-debug-info: 999;--z-index-floating-panel-base: 1000;--z-index-performance-widget: 1000;--z-index-elements-panel: 1001;--z-index-layer-control: 1001;--z-index-sidebar: 1005;--z-index-map-legend: 1005;--z-index-sidebar-mobile: 1010;--z-index-loading-overlay: 1050;--z-index-dialog: 1075;--z-index-toolbar: 1100;--z-index-tooltip: 1150;--z-index-map-controls: 1201;--toolbar-height: 46px;--toolbar-button-height: 30px;--toolbar-button-height-mobile: 32px;--action-button-height: 40px;--menu-item-height: 42px;--icon-size-sm: 18px;--icon-size-md: 20px;--tooltip-bg-color: rgba(33, 33, 33, .95);--primary-ripple-color: rgba(var(--primary-rgb), .1)}[_ngcontent-%COMP%]:root.dark-theme, body.dark-theme[_ngcontent-%COMP%]{--background-color: #121212;--surface-color: #1e1e1e;--surface-lighter: rgb(42.75, 42.75, 42.75);--surface-darker: #121212;--text-color: #e0e0e0;--text-secondary-color: rgb(185.75, 185.75, 185.75);--text-hint-color: rgb(147.5, 147.5, 147.5);--text-disabled-color: rgb(109.25, 109.25, 109.25);--border-color: #444444;--border-color-light: rgb(93.5, 93.5, 93.5);--border-color-dark: rgb(42.5, 42.5, 42.5);--color-success-bg: rgb(51.8181818182, 119.1818181818, 57);--color-warning-bg: rgb(174, 133.4, 0);--color-danger-bg: rgb(184, 0, 27.6);--color-info-bg: rgb(8.9230769231, 95.9230769231, 165.0769230769);--color-maintenance-bg: rgb(11.6, 98.6, 162.4);--shadow-xs: 0 1px 2px rgba(0,0,0,.3);--shadow-sm: 0 1px 3px rgba(0,0,0,.4);--shadow-md: 0 2px 4px rgba(0,0,0,.5);--shadow-lg: 0 4px 6px rgba(0,0,0,.5);--surface-overlay-light: rgba(40, 40, 40, .85);--surface-overlay-light-strong: rgba(30, 30, 30, .95);--border-color-semitransparent: rgba(255, 255, 255, .1);--status-inactive-fg: hsl(0, 0%, 100.8823529412%);--status-inactive-bg: #383838;--primary-bg-subtle: rgba(63, 81, 181, .25);--surface-action-hover: rgb(55.5, 55.5, 55.5);--surface-button: var(--surface-color);--surface-button-hover: var(--surface-action-hover);--text-color-button: var(--text-color);--scrollbar-track-color: #333333;--scrollbar-thumb-color: #666666;--scrollbar-thumb-hover-color: #888888}.standard-panel-ui[_ngcontent-%COMP%]{background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-lg);overflow:hidden;display:flex;flex-direction:column}.standard-panel-ui[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-md);background-color:var(--surface-lighter);border-bottom:1px solid var(--border-color)}.standard-panel-ui[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:var(--font-size-md);font-weight:500;color:var(--text-color)}.standard-panel-ui[_ngcontent-%COMP%]   .panel-content[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-content[_ngcontent-%COMP%]{padding:var(--spacing-md);flex-grow:1;overflow-y:auto;color:var(--text-color)}.standard-panel-ui[_ngcontent-%COMP%]   .panel-actions[_ngcontent-%COMP%], .standard-panel-ui[_ngcontent-%COMP%]   .widget-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:var(--spacing-sm);padding:var(--spacing-sm) var(--spacing-md);border-top:1px solid var(--border-color)}.standard-panel-ui[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]{display:flex;margin-bottom:var(--spacing-sm)}.standard-panel-ui[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]   .info-label[_ngcontent-%COMP%]{width:100px;font-weight:500;color:var(--text-secondary-color)}.standard-panel-ui[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]   .info-value[_ngcontent-%COMP%]{flex:1;color:var(--text-color)}.simple-panel-ui[_ngcontent-%COMP%]{background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-lg);padding:var(--spacing-md);color:var(--text-color)}.side-panel[_ngcontent-%COMP%]{background-color:var(--surface-color);border-radius:var(--border-radius-sm, 4px);box-shadow:var(--shadow-sm, 0 2px 10px rgba(0, 0, 0, .08));height:100%;width:var(--side-panel-width, 320px);display:flex;flex-direction:column;overflow:hidden}@media (max-width: 768px){.side-panel[_ngcontent-%COMP%]{width:var(--side-panel-width-tablet, 280px)}}@media (max-width: 600px){.side-panel[_ngcontent-%COMP%]{width:var(--side-panel-width-mobile, 100%);max-width:100vw}}.side-panel[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%]{height:var(--panel-header-height, 44px);min-height:var(--panel-header-height, 44px);display:flex;align-items:center;justify-content:space-between;padding:0 var(--spacing-sm);border-bottom:1px solid var(--border-color, rgba(0, 0, 0, .1))}.side-panel[_ngcontent-%COMP%]   .panel-content[_ngcontent-%COMP%]{flex:1;overflow:auto}.map-base-container[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;overflow:hidden;background-color:var(--background-color);transition:background-color var(--transition-normal)}.network-design[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}.network-design__toolbar[_ngcontent-%COMP%]{padding:0 var(--spacing-md);background-color:var(--primary-color);color:var(--primary-contrast-color);box-shadow:var(--shadow-md)}.network-design__header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-md);background-color:var(--primary-color);color:var(--primary-contrast-color);box-shadow:var(--shadow-md)}.network-design__header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:var(--font-size-xl);font-weight:500}.network-design__main[_ngcontent-%COMP%]{flex:1;display:flex;overflow:hidden;position:relative;padding:var(--spacing-md);background-color:var(--surface-color)}@media (max-width: 768px){.network-design__main[_ngcontent-%COMP%]{margin-left:0;padding:var(--spacing-sm)}}.network-design__main[_ngcontent-%COMP%]   .network-design__map[_ngcontent-%COMP%]{flex:1;position:relative;border-radius:var(--border-radius-md);overflow:hidden;box-shadow:var(--shadow-md);background-color:var(--surface-darker)}.network-design__main[_ngcontent-%COMP%]   .network-design__sidebar[_ngcontent-%COMP%]{width:300px;padding:var(--spacing-md);background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-md);margin-left:var(--spacing-md);overflow-y:auto;border-right:1px solid var(--border-color)}@media (max-width: 768px){.network-design__main[_ngcontent-%COMP%]   .network-design__sidebar[_ngcontent-%COMP%]{width:100%;position:fixed;top:0;left:0;height:100%;z-index:1000;transform:translate(-100%);transition:transform var(--transition-normal);margin-left:0;border-right:none}.network-design__main[_ngcontent-%COMP%]   .network-design__sidebar--open[_ngcontent-%COMP%]{transform:translate(0)}}.network-design__footer[_ngcontent-%COMP%]{padding:var(--spacing-md);background-color:var(--surface-lighter);border-top:1px solid var(--border-color);font-size:var(--font-size-sm);color:var(--text-color)}.network-design__element[_ngcontent-%COMP%]{padding:var(--spacing-md);margin-bottom:var(--spacing-md);background-color:var(--surface-color);border-radius:var(--border-radius-md);box-shadow:var(--shadow-sm);transition:box-shadow var(--transition-fast)}.network-design__element[_ngcontent-%COMP%]:hover{box-shadow:var(--shadow-md)}.network-design__element--selected[_ngcontent-%COMP%]{border-left:4px solid var(--primary-color)}.status-badge-base[_ngcontent-%COMP%], .status-maintenance[_ngcontent-%COMP%], .status-warning[_ngcontent-%COMP%], .status-fault[_ngcontent-%COMP%], .status-inactive[_ngcontent-%COMP%], .status-active[_ngcontent-%COMP%]{display:inline-block;padding:var(--spacing-xs) var(--spacing-sm);border-radius:var(--border-radius-sm);font-size:var(--font-size-sm);font-weight:500}.status-active[_ngcontent-%COMP%]{background-color:var(--color-success-bg);color:var(--color-success-contrast)}.status-inactive[_ngcontent-%COMP%]{background-color:var(--status-inactive-bg);color:var(--status-inactive-fg)}.status-fault[_ngcontent-%COMP%]{background-color:var(--color-danger-bg);color:var(--color-danger-contrast)}.status-warning[_ngcontent-%COMP%]{background-color:var(--color-warning-bg);color:var(--color-warning-contrast)}.status-maintenance[_ngcontent-%COMP%]{background-color:var(--color-maintenance-bg);color:var(--color-maintenance-contrast)}.network-utils__status-badge[_ngcontent-%COMP%]{display:inline-block;padding:var(--spacing-xs) var(--spacing-sm);border-radius:var(--border-radius-sm);font-size:var(--font-size-xs);font-weight:500;text-transform:uppercase}.network-utils__status-badge--active[_ngcontent-%COMP%]{background-color:var(--color-success-bg);color:var(--color-success-contrast)}.network-utils__status-badge--inactive[_ngcontent-%COMP%]{background-color:var(--status-inactive-bg);color:var(--status-inactive-fg)}.network-utils__status-badge--maintenance[_ngcontent-%COMP%]{background-color:var(--color-maintenance-bg);color:var(--color-maintenance-contrast)}.network-utils__loading[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:var(--spacing-lg);color:var(--text-color)}.network-utils__error[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-md);background-color:#ffebee;color:var(--color-danger);border-radius:var(--border-radius-md)}.widget-container[_ngcontent-%COMP%]{position:absolute;z-index:var(--z-index-widgets-container, 1000);top:var(--spacing-sm, 8px);right:var(--spacing-sm, 8px);width:var(--widget-container-width, 300px);max-height:var(--widget-container-max-height, 70vh);overflow-y:auto;background-color:var(--surface-overlay-light, rgba(255, 255, 255, .7));padding:var(--spacing-xs, 4px) var(--spacing-sm, 8px);border-radius:var(--border-radius-md, 4px);font-size:var(--font-size-xs, 12px);box-shadow:var(--shadow-sm, 0 1px 3px rgba(0, 0, 0, .12))}.widget-container[_ngcontent-%COMP%]   .performance-metric[_ngcontent-%COMP%]{margin-right:var(--spacing-sm, 8px)}.widget-container[_ngcontent-%COMP%]   .performance-metric[_ngcontent-%COMP%]:last-child{margin-right:0}.map-widgets-container[_ngcontent-%COMP%]{position:absolute;z-index:var(--z-index-widgets-container, 1000);inset:0;pointer-events:none;display:flex;flex-direction:column;gap:var(--spacing-sm, 8px)}.mini-map-container[_ngcontent-%COMP%]{position:absolute;bottom:var(--spacing-lg, 20px);left:var(--spacing-lg, 20px);z-index:var(--z-index-map-widgets-overlay, 50);background-color:var(--surface-overlay-light, rgba(255, 255, 255, .8));z-index:var(--z-index-loading-overlay, 1050)}.mini-map-container[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{width:var(--spinner-size-lg, 50px);height:var(--spinner-size-lg, 50px);border:var(--spinner-border-width, 5px) solid var(--spinner-track-color, rgba(0, 0, 0, .1));border-radius:50%;border-top-color:var(--primary-color, #3f51b5);animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:var(--spacing-md, 12px)}.mini-map-container[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:var(--font-size-lg, 18px);color:var(--text-color, #333)}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.map-loading-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background-color:var(--surface-overlay-light, rgba(255, 255, 255, .9));z-index:var(--z-index-loading-overlay, 1050);display:flex;flex-direction:column;justify-content:center;align-items:center}.map-loading-overlay[_ngcontent-%COMP%]   .loading-message[_ngcontent-%COMP%]{font-size:var(--font-size-xl, 18px);font-weight:500}@media (max-width: 768px){.widget-container[_ngcontent-%COMP%]{width:var(--widget-container-width-tablet, 250px)}}@media (max-width: 480px){.widget-container[_ngcontent-%COMP%]{width:100%;max-width:none;top:auto;bottom:0;right:0;max-height:var(--widget-container-max-height-mobile, 40vh)}}[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;position:relative;overflow:hidden}.map-container[_ngcontent-%COMP%]{flex:1;position:relative;width:100%;overflow:hidden;background-color:var(--surface-level-1, #f5f5f5)}#map[_ngcontent-%COMP%], .map[_ngcontent-%COMP%]{width:100%;height:100%}.map-widgets-container[_ngcontent-%COMP%]{position:absolute;z-index:var(--z-index-widgets-container, 1000);inset:0;pointer-events:none}.map-widgets-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{pointer-events:auto}.map-loading-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background-color:var(--surface-overlay-light, rgba(255, 255, 255, .9));z-index:var(--z-index-loading-overlay, 1050);display:flex;flex-direction:column;justify-content:center;align-items:center;box-shadow:0 6px 24px #0000001a;animation:fadeInUp .35s cubic-bezier(.23,1,.32,1)}.map-loading-overlay[_ngcontent-%COMP%]   .loading-spinner[_ngcontent-%COMP%]{margin-bottom:var(--spacing-md, 16px)}.map-loading-overlay[_ngcontent-%COMP%]   .loading-message[_ngcontent-%COMP%]{font-size:var(--font-size-lg, 18px);font-weight:500;color:var(--text-color, #333333)}.map-error-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background-color:var(--surface-overlay-light-strong, rgba(255, 255, 255, .95));z-index:var(--z-index-loading-overlay, 1050);display:flex;flex-direction:column;justify-content:center;align-items:center;padding:var(--spacing-lg, 24px);text-align:center;box-shadow:0 6px 24px #ff00001a;animation:fadeInUp .35s cubic-bezier(.23,1,.32,1)}.map-error-overlay[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:var(--icon-size-xxxl, 48px);height:var(--icon-size-xxxl, 48px);width:var(--icon-size-xxxl, 48px);margin-bottom:var(--spacing-md, 16px);color:var(--color-danger, #f44336)}.map-error-overlay[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:var(--font-size-xl, 20px);font-weight:500;margin:0 0 var(--spacing-md, 16px) 0;color:var(--color-danger, #f44336)}.map-error-overlay[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:var(--font-size-md, 16px);max-width:400px;margin:0 0 var(--spacing-lg, 24px) 0;color:var(--text-color, #333333)}.map-error-overlay[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:var(--button-padding-y, var(--spacing-sm, 8px)) var(--button-padding-x, var(--spacing-md, 16px));background-color:var(--button-bg-color, var(--primary-color, #007bff));color:var(--button-text-color, white);border:var(--button-border, none);border-radius:var(--button-border-radius, var(--border-radius-md, 4px));min-width:150px}.map-content[_ngcontent-%COMP%]{flex:1;position:relative;width:100%;height:100%;z-index:var(--z-index-map-base, 1)}.map-content[_ngcontent-%COMP%]     .leaflet-container{width:100%!important;height:100%!important;background-color:var(--surface-level-1, #f5f5f5)!important;z-index:var(--z-index-map-base, 1)}.cursor-position[_ngcontent-%COMP%]{position:absolute;bottom:var(--spacing-lg, 20px);left:var(--spacing-lg, 20px);background-color:var(--surface-overlay-light, rgba(255, 255, 255, .9));padding:var(--spacing-xs, 5px) var(--spacing-sm, 10px);border-radius:var(--border-radius-md, 4px);font-size:var(--font-size-xs, 12px);box-shadow:var(--shadow-sm, 0 1px 3px rgba(0, 0, 0, .12));z-index:var(--z-index-map-widgets-overlay, 50);color:var(--text-color, #333)}.save-notification[_ngcontent-%COMP%]{position:absolute;top:var(--spacing-lg, 20px);right:var(--spacing-lg, 20px);background-color:var(--color-success-bg-strong, rgba(76, 175, 80, .9));color:var(--color-success-contrast, white);padding:var(--spacing-sm, 10px) var(--spacing-md, 15px);border-radius:var(--border-radius-md, 4px);display:flex;align-items:center;box-shadow:var(--shadow-md, 0 2px 6px rgba(0, 0, 0, .15));z-index:var(--z-index-dialog, 1075)}.save-notification[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:var(--spacing-sm, 8px)}.measurement-info[_ngcontent-%COMP%]{position:absolute;top:var(--spacing-xl, 80px);right:var(--spacing-lg, 20px);width:var(--measurement-info-width, 300px);background-color:var(--surface-color, white);border-radius:var(--border-radius-lg, 8px);box-shadow:var(--shadow-md, 0 2px 6px rgba(0, 0, 0, .15));z-index:var(--z-index-floating-panel-base, 1000);overflow:hidden;color:var(--text-color, #333)}.measurement-info[_ngcontent-%COMP%]   .measurement-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-sm, 10px) var(--spacing-md, 15px);background-color:var(--primary-color, #3f51b5);color:var(--primary-contrast-color, white)}.measurement-info[_ngcontent-%COMP%]   .measurement-content[_ngcontent-%COMP%]{padding:var(--spacing-md, 15px)}.measurement-info[_ngcontent-%COMP%]   .measurement-content[_ngcontent-%COMP%]   .measurement-distance[_ngcontent-%COMP%]{margin-top:var(--spacing-sm, 10px);font-size:var(--font-size-lg, 16px)}.measurement-info[_ngcontent-%COMP%]   .measurement-actions[_ngcontent-%COMP%]{padding:var(--spacing-sm, 10px);display:flex;justify-content:flex-end;border-top:1px solid var(--border-color, #eee)}app-network-toolbar[_ngcontent-%COMP%]{z-index:var(--z-index-toolbar, 1100);position:relative}.element-tooltip[_ngcontent-%COMP%]{position:absolute;background-color:var(--tooltip-bg-color, var(--surface-color, white));border-radius:var(--border-radius-sm, 4px);padding:var(--spacing-xs, 4px) var(--spacing-sm, 8px);box-shadow:var(--shadow-md, 0 2px 6px rgba(0, 0, 0, .15));font-size:var(--font-size-xs, 12px);color:var(--tooltip-text-color, var(--text-color, #333));max-width:200px;z-index:var(--z-index-tooltip, 1150);pointer-events:none}.element-tooltip__title[_ngcontent-%COMP%]{font-weight:500}.map-container[_ngcontent-%COMP%]:empty:after{content:"\\26a0\\fe0f  Error: No se pudo cargar el contenedor del mapa";display:flex;align-items:center;justify-content:center;height:100%;width:100%;background-color:var(--color-warning-bg-subtle, #ffcccc);color:var(--color-warning-contrast-strong, #d32f2f);font-size:var(--font-size-lg, 16px);font-weight:700;z-index:var(--z-index-map-base, 1)}.leaflet-container[_ngcontent-%COMP%]:not(:has(.leaflet-tile)):after{content:"\\26a0\\fe0f  Error: No se pudieron cargar las capas del mapa";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background-color:var(--surface-overlay-light, rgba(255, 255, 255, .9));padding:var(--spacing-sm, 12px) var(--spacing-md, 16px);border-radius:var(--border-radius-md, 4px);color:var(--color-danger-strong, #d32f2f);font-weight:700;z-index:var(--z-index-loading-overlay, 1050)}.map-error-message[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;background:var(--color-warning-bg, #fff3cd);color:var(--color-warning-contrast, #856404);border:1px solid var(--color-warning-border, #ffeeba);border-radius:var(--border-radius-lg, 8px);padding:var(--spacing-xl, 24px);margin:var(--spacing-lg, 16px) auto;max-width:400px;font-size:var(--font-size-md, 16px);box-shadow:var(--shadow-sm, 0 2px 8px rgba(0, 0, 0, .05));z-index:var(--z-index-map-overlay, 100)}.map-error-icon[_ngcontent-%COMP%]{font-size:var(--icon-size-xxxxl, 48px);margin-bottom:var(--spacing-md, 12px)}.map-error-text[_ngcontent-%COMP%]{text-align:center}.performance-info[_ngcontent-%COMP%]{position:absolute;bottom:var(--spacing-sm, 10px);left:var(--spacing-sm, 10px);background:#0009;color:#fff;padding:var(--spacing-xs, 5px) var(--spacing-sm, 10px);border-radius:var(--border-radius-md, 4px);font-size:var(--font-size-xs, 12px);z-index:var(--z-index-debug-info, 999)}.performance-metric[_ngcontent-%COMP%]{margin-right:var(--spacing-sm, 10px)}  .leaflet-popup-content-wrapper{border-radius:var(--border-radius-md, 4px);background-color:var(--surface-color, white);color:var(--text-color, #333)}  .leaflet-popup-tip{background-color:var(--surface-color, white)}  .leaflet-control-zoom{border-radius:var(--border-radius-md, 4px);border:none}  .leaflet-control-zoom a.leaflet-control-zoom-in,   .leaflet-control-zoom a.leaflet-control-zoom-out{border-radius:var(--border-radius-md, 4px)!important;background-color:var(--surface-button, var(--surface-color, white));color:var(--text-color-button, var(--text-color, #333));transition:background-color var(--transition-fast, .2s) ease}  .leaflet-control-zoom a.leaflet-control-zoom-in:hover,   .leaflet-control-zoom a.leaflet-control-zoom-out:hover{background-color:var(--surface-button-hover, var(--surface-hover, #f0f0f0))}  .marker-cluster{background-color:var(--primary-bg-semitransparent, rgba(63, 81, 181, .4))}  .marker-cluster div{background-color:var(--primary-bg-strong-semitransparent, rgba(63, 81, 181, .8));color:var(--primary-contrast-color, white);font-weight:700;border-radius:50%}  .marker-cluster:hover{background-color:var(--primary-bg-hover-semitransparent, rgba(63, 81, 181, .6))}  .leaflet-tooltip{background-color:var(--tooltip-leaflet-bg, var(--surface-overlay-light, rgba(255, 255, 255, .9)));color:var(--tooltip-leaflet-text-color, var(--text-color, #333));border:none;box-shadow:var(--shadow-md, 0 2px 6px rgba(0, 0, 0, .2));padding:var(--spacing-xs, 4px) var(--spacing-sm, 8px);font-size:var(--font-size-xs, 12px);border-radius:var(--border-radius-sm, 4px)}  .leaflet-control-attribution{background-color:var(--surface-overlay-light-semitransparent, rgba(255, 255, 255, .7))!important;color:var(--text-secondary-color, #666)!important}  .leaflet-marker-icon{cursor:pointer}'],changeDetection:0})}}return o})();var Cd=[{path:"",redirectTo:"map",pathMatch:"full"},{path:"map",component:bd,data:{animation:"map",breadcrumb:"Mapa",preload:!0,mapConfig:{initialZoom:16,initialCenter:[19.78375,-70.676666]}}},{path:"elements",loadComponent:()=>import("./chunk-BUHY7BGN.js").then(o=>o.ElementDetailsComponent),data:{animation:"list",breadcrumb:"Elementos"}},{path:"connections",loadComponent:()=>import("./chunk-NFEGY2DF.js").then(o=>o.ConnectionEditorComponent),data:{animation:"connections",breadcrumb:"Conexiones"}},{path:"monitoring",loadComponent:()=>import("./chunk-DVMPXDBM.js").then(o=>o.NetworkHealthWidgetComponent),data:{animation:"monitoring",breadcrumb:"Monitoreo"}},{path:"editor",loadComponent:()=>import("./chunk-IQKY4WE2.js").then(o=>o.ElementEditorComponent),canDeactivate:[si],data:{animation:"editor",breadcrumb:"Editor"}},{path:"editor/:id",loadComponent:()=>import("./chunk-IQKY4WE2.js").then(o=>o.ElementEditorComponent),canDeactivate:[si],data:{animation:"editor",breadcrumb:"Editor"}},{path:"elements/create",title:"Crear Elemento",loadComponent:()=>import("./chunk-IQKY4WE2.js").then(o=>o.ElementEditorComponent),canDeactivate:[si]},{path:"elements/:type/create",title:"Crear Elemento",loadComponent:()=>import("./chunk-IQKY4WE2.js").then(o=>o.ElementEditorComponent),canDeactivate:[si]},{path:"elements/:id",title:"Detalles del Elemento",loadComponent:()=>import("./chunk-BUHY7BGN.js").then(o=>o.ElementDetailsComponent)},{path:"elements/:id/edit",title:"Editar Elemento",loadComponent:()=>import("./chunk-IQKY4WE2.js").then(o=>o.ElementEditorComponent),canDeactivate:[si]},{path:"elements/:id/history",title:"Historial del Elemento",loadComponent:()=>import("./chunk-XJDJR6ET.js").then(o=>o.ElementHistoryComponent)},{path:"history/:id",loadComponent:()=>import("./chunk-XJDJR6ET.js").then(o=>o.ElementHistoryComponent),data:{animation:"history",breadcrumb:"Historial"}},{path:"diagnostic",loadComponent:()=>import("./chunk-JKTHQTMT.js").then(o=>o.MapDiagnosticComponent),data:{animation:"diagnostic",breadcrumb:"Diagn\xF3stico"}},{path:"position-selector",component:zc,data:{animation:"position-selector",breadcrumb:"Selector de Posici\xF3n",isFullPage:!0}},{path:"error",component:Fc,data:{animation:"error",breadcrumb:"Error"}},{path:"element/:type/edit/:id",loadComponent:()=>import("./chunk-IQKY4WE2.js").then(o=>o.ElementEditorComponent),data:{animation:"editor",breadcrumb:"Editor"}},{path:"element/:type/new",loadComponent:()=>import("./chunk-IQKY4WE2.js").then(o=>o.ElementEditorComponent),data:{animation:"editor",breadcrumb:"Nuevo"}},{path:"element/:type/batch",loadComponent:()=>import("./chunk-XO6FHZMJ.js").then(o=>o.BatchElementEditorComponent),data:{animation:"editor",breadcrumb:"Editor por Lotes",icon:"library_add"}},{path:"element/history/:id",loadComponent:()=>import("./chunk-XJDJR6ET.js").then(o=>o.ElementHistoryComponent),data:{animation:"history",breadcrumb:"Historial",icon:"history"}},{path:"**",redirectTo:"error",data:{error:{code:404,message:"P\xE1gina no encontrada",description:"La ruta solicitada no existe en el sistema."}}}];var yd=[{path:"",component:bc,children:[{path:"auth",canActivate:[Mc],loadComponent:()=>import("./chunk-G63NQSXW.js").then(o=>o.AuthComponent),loadChildren:()=>import("./chunk-PN4PBCQN.js").then(o=>o.authRoutes)},{path:"",component:xc,canActivate:[Sc],children:[{path:"dashboard",loadComponent:()=>import("./chunk-6BXVB57A.js").then(o=>o.DashboardLayoutComponent),loadChildren:()=>import("./chunk-OJCU2UD5.js").then(o=>o.DASHBOARD_ROUTES)},{path:"network-design",component:Lc,children:Cd,data:{breadcrumb:"Dise\xF1o de Red",icon:"map",preload:!0}},{path:"projects",loadComponent:()=>import("./chunk-VRQE7K5W.js").then(o=>o.ProjectsComponent),loadChildren:()=>import("./chunk-ACYZD5ZX.js").then(o=>o.PROJECTS_ROUTES),canMatch:[()=>Pc([wi.ADMIN,wi.OPERATOR])]},{path:"offline",loadComponent:()=>import("./chunk-ZXPUJYLP.js").then(o=>o.OfflineComponent),loadChildren:()=>import("./chunk-XRJBQMYH.js").then(o=>o.OFFLINE_ROUTES)},{path:"",redirectTo:"dashboard",pathMatch:"full"}]}]},{path:"**",redirectTo:"dashboard"}];function Ed(o){return new ie(3e3,!1)}function yf(){return new ie(3100,!1)}function Ef(){return new ie(3101,!1)}function wf(o){return new ie(3001,!1)}function xf(o){return new ie(3003,!1)}function Sf(o){return new ie(3004,!1)}function xd(o,i){return new ie(3005,!1)}function Sd(){return new ie(3006,!1)}function Md(){return new ie(3007,!1)}function Pd(o,i){return new ie(3008,!1)}function Td(o){return new ie(3002,!1)}function Od(o,i,e,t,n){return new ie(3010,!1)}function kd(){return new ie(3011,!1)}function Id(){return new ie(3012,!1)}function Dd(){return new ie(3200,!1)}function Ad(){return new ie(3202,!1)}function Rd(){return new ie(3013,!1)}function Nd(o){return new ie(3014,!1)}function Ld(o){return new ie(3015,!1)}function Fd(o){return new ie(3016,!1)}function zd(o,i){return new ie(3404,!1)}function Mf(o){return new ie(3502,!1)}function Bd(o){return new ie(3503,!1)}function Vd(){return new ie(3300,!1)}function $d(o){return new ie(3504,!1)}function jd(o){return new ie(3301,!1)}function Ud(o,i){return new ie(3302,!1)}function Gd(o){return new ie(3303,!1)}function Hd(o,i){return new ie(3400,!1)}function Wd(o){return new ie(3401,!1)}function Kd(o){return new ie(3402,!1)}function qd(o,i){return new ie(3505,!1)}function Wt(o){switch(o.length){case 0:return new vn;case 1:return o[0];default:return new go(o)}}function pa(o,i,e=new Map,t=new Map){let n=[],r=[],a=-1,l=null;if(i.forEach(u=>{let g=u.get("offset"),_=g==a,f=_&&l||new Map;u.forEach((S,T)=>{let w=T,M=S;if(T!=="offset")switch(w=o.normalizePropertyName(w,n),M){case Si:M=e.get(T);break;case St:M=t.get(T);break;default:M=o.normalizeStyleValue(T,w,M,n);break}f.set(w,M)}),_||r.push(f),l=f,a=g}),n.length)throw Mf(n);return r}function Yo(o,i,e,t){switch(i){case"start":o.onStart(()=>t(e&&la(e,"start",o)));break;case"done":o.onDone(()=>t(e&&la(e,"done",o)));break;case"destroy":o.onDestroy(()=>t(e&&la(e,"destroy",o)));break}}function la(o,i,e){let t=e.totalTime,n=!!e.disabled,r=Xo(o.element,o.triggerName,o.fromState,o.toState,i||o.phaseName,t??o.totalTime,n),a=o._data;return a!=null&&(r._data=a),r}function Xo(o,i,e,t,n="",r=0,a){return{element:o,triggerName:i,fromState:e,toState:t,phaseName:n,totalTime:r,disabled:!!a}}function rt(o,i,e){let t=o.get(i);return t||o.set(i,t=e),t}function ma(o){let i=o.indexOf(":"),e=o.substring(1,i),t=o.slice(i+1);return[e,t]}var Pf=typeof document>"u"?null:document.documentElement;function Jo(o){let i=o.parentNode||o.host||null;return i===Pf?null:i}function Tf(o){return o.substring(1,6)=="ebkit"}var Cn=null,wd=!1;function Qd(o){Cn||(Cn=Of()||{},wd=Cn.style?"WebkitAppearance"in Cn.style:!1);let i=!0;return Cn.style&&!Tf(o)&&(i=o in Cn.style,!i&&wd&&(i="Webkit"+o.charAt(0).toUpperCase()+o.slice(1)in Cn.style)),i}function Of(){return typeof document<"u"?document.body:null}function ga(o,i){for(;i;){if(i===o)return!0;i=Jo(i)}return!1}function ua(o,i,e){if(e)return Array.from(o.querySelectorAll(i));let t=o.querySelector(i);return t?[t]:[]}var kf=1e3,ha="{{",If="}}",fa="ng-enter",er="ng-leave",Ri="ng-trigger",Ni=".ng-trigger",_a="ng-animating",tr=".ng-animating";function Vt(o){if(typeof o=="number")return o;let i=o.match(/^(-?[\.\d]+)(m?s)/);return!i||i.length<2?0:ca(parseFloat(i[1]),i[2])}function ca(o,i){switch(i){case"s":return o*kf;default:return o}}function Li(o,i,e){return o.hasOwnProperty("duration")?o:Df(o,i,e)}function Df(o,i,e){let t=/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i,n,r=0,a="";if(typeof o=="string"){let l=o.match(t);if(l===null)return i.push(Ed(o)),{duration:0,delay:0,easing:""};n=ca(parseFloat(l[1]),l[2]);let u=l[3];u!=null&&(r=ca(parseFloat(u),l[4]));let g=l[5];g&&(a=g)}else n=o;if(!e){let l=!1,u=i.length;n<0&&(i.push(yf()),l=!0),r<0&&(i.push(Ef()),l=!0),l&&i.splice(u,0,Ed(o))}return{duration:n,delay:r,easing:a}}function Zd(o){return o.length?o[0]instanceof Map?o:o.map(i=>new Map(Object.entries(i))):[]}function Ot(o,i,e){i.forEach((t,n)=>{let r=nr(n);e&&!e.has(n)&&e.set(n,o.style[r]),o.style[r]=t})}function ln(o,i){i.forEach((e,t)=>{let n=nr(t);o.style[n]=""})}function di(o){return Array.isArray(o)?o.length==1?o[0]:wl(o):o}function Yd(o,i,e){let t=i.params||{},n=va(o);n.length&&n.forEach(r=>{t.hasOwnProperty(r)||e.push(wf(r))})}var da=new RegExp(`${ha}\\s*(.+?)\\s*${If}`,"g");function va(o){let i=[];if(typeof o=="string"){let e;for(;e=da.exec(o);)i.push(e[1]);da.lastIndex=0}return i}function pi(o,i,e){let t=`${o}`,n=t.replace(da,(r,a)=>{let l=i[a];return l==null&&(e.push(xf(a)),l=""),l.toString()});return n==t?o:n}var Af=/-+([a-z0-9])/g;function nr(o){return o.replace(Af,(...i)=>i[1].toUpperCase())}function Xd(o,i){return o===0||i===0}function Jd(o,i,e){if(e.size&&i.length){let t=i[0],n=[];if(e.forEach((r,a)=>{t.has(a)||n.push(a),t.set(a,r)}),n.length)for(let r=1;r<i.length;r++){let a=i[r];n.forEach(l=>a.set(l,ir(o,l)))}}return i}function at(o,i,e){switch(i.type){case J.Trigger:return o.visitTrigger(i,e);case J.State:return o.visitState(i,e);case J.Transition:return o.visitTransition(i,e);case J.Sequence:return o.visitSequence(i,e);case J.Group:return o.visitGroup(i,e);case J.Animate:return o.visitAnimate(i,e);case J.Keyframes:return o.visitKeyframes(i,e);case J.Style:return o.visitStyle(i,e);case J.Reference:return o.visitReference(i,e);case J.AnimateChild:return o.visitAnimateChild(i,e);case J.AnimateRef:return o.visitAnimateRef(i,e);case J.Query:return o.visitQuery(i,e);case J.Stagger:return o.visitStagger(i,e);default:throw Sf(i.type)}}function ir(o,i){return window.getComputedStyle(o)[i]}var Na=(()=>{class o{validateStyleProperty(e){return Qd(e)}containsElement(e,t){return ga(e,t)}getParentElement(e){return Jo(e)}query(e,t,n){return ua(e,t,n)}computeStyle(e,t,n){return n||""}animate(e,t,n,r,a,l=[],u){return new vn(n,r)}static \u0275fac=function(t){return new(t||o)};static \u0275prov=I({token:o,factory:o.\u0275fac})}return o})(),En=class{static NOOP=new Na},wn=class{};var Rf=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]),lr=class extends wn{normalizePropertyName(i,e){return nr(i)}normalizeStyleValue(i,e,t,n){let r="",a=t.toString().trim();if(Rf.has(e)&&t!==0&&t!=="0")if(typeof t=="number")r="px";else{let l=t.match(/^[+-]?[\d\.]+([a-z]*)$/);l&&l[1].length==0&&n.push(xd(i,t))}return a+r}};var cr="*";function Nf(o,i){let e=[];return typeof o=="string"?o.split(/\s*,\s*/).forEach(t=>Lf(t,e,i)):e.push(o),e}function Lf(o,i,e){if(o[0]==":"){let u=Ff(o,e);if(typeof u=="function"){i.push(u);return}o=u}let t=o.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(t==null||t.length<4)return e.push(Ld(o)),i;let n=t[1],r=t[2],a=t[3];i.push(ep(n,a));let l=n==cr&&a==cr;r[0]=="<"&&!l&&i.push(ep(a,n))}function Ff(o,i){switch(o){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(e,t)=>parseFloat(t)>parseFloat(e);case":decrement":return(e,t)=>parseFloat(t)<parseFloat(e);default:return i.push(Fd(o)),"* => *"}}var or=new Set(["true","1"]),rr=new Set(["false","0"]);function ep(o,i){let e=or.has(o)||rr.has(o),t=or.has(i)||rr.has(i);return(n,r)=>{let a=o==cr||o==n,l=i==cr||i==r;return!a&&e&&typeof n=="boolean"&&(a=n?or.has(o):rr.has(o)),!l&&t&&typeof r=="boolean"&&(l=r?or.has(i):rr.has(i)),a&&l}}var dp=":self",zf=new RegExp(`s*${dp}s*,?`,"g");function pp(o,i,e,t){return new xa(o).build(i,e,t)}var tp="",xa=class{_driver;constructor(i){this._driver=i}build(i,e,t){let n=new Sa(e);return this._resetContextStyleTimingState(n),at(this,di(i),n)}_resetContextStyleTimingState(i){i.currentQuerySelector=tp,i.collectedStyles=new Map,i.collectedStyles.set(tp,new Map),i.currentTime=0}visitTrigger(i,e){let t=e.queryCount=0,n=e.depCount=0,r=[],a=[];return i.name.charAt(0)=="@"&&e.errors.push(Sd()),i.definitions.forEach(l=>{if(this._resetContextStyleTimingState(e),l.type==J.State){let u=l,g=u.name;g.toString().split(/\s*,\s*/).forEach(_=>{u.name=_,r.push(this.visitState(u,e))}),u.name=g}else if(l.type==J.Transition){let u=this.visitTransition(l,e);t+=u.queryCount,n+=u.depCount,a.push(u)}else e.errors.push(Md())}),{type:J.Trigger,name:i.name,states:r,transitions:a,queryCount:t,depCount:n,options:null}}visitState(i,e){let t=this.visitStyle(i.styles,e),n=i.options&&i.options.params||null;if(t.containsDynamicStyles){let r=new Set,a=n||{};t.styles.forEach(l=>{l instanceof Map&&l.forEach(u=>{va(u).forEach(g=>{a.hasOwnProperty(g)||r.add(g)})})}),r.size&&e.errors.push(Pd(i.name,[...r.values()]))}return{type:J.State,name:i.name,style:t,options:n?{params:n}:null}}visitTransition(i,e){e.queryCount=0,e.depCount=0;let t=at(this,di(i.animation),e),n=Nf(i.expr,e.errors);return{type:J.Transition,matchers:n,animation:t,queryCount:e.queryCount,depCount:e.depCount,options:yn(i.options)}}visitSequence(i,e){return{type:J.Sequence,steps:i.steps.map(t=>at(this,t,e)),options:yn(i.options)}}visitGroup(i,e){let t=e.currentTime,n=0,r=i.steps.map(a=>{e.currentTime=t;let l=at(this,a,e);return n=Math.max(n,e.currentTime),l});return e.currentTime=n,{type:J.Group,steps:r,options:yn(i.options)}}visitAnimate(i,e){let t=jf(i.timings,e.errors);e.currentAnimateTimings=t;let n,r=i.styles?i.styles:he({});if(r.type==J.Keyframes)n=this.visitKeyframes(r,e);else{let a=i.styles,l=!1;if(!a){l=!0;let g={};t.easing&&(g.easing=t.easing),a=he(g)}e.currentTime+=t.duration+t.delay;let u=this.visitStyle(a,e);u.isEmptyStep=l,n=u}return e.currentAnimateTimings=null,{type:J.Animate,timings:t,style:n,options:null}}visitStyle(i,e){let t=this._makeStyleAst(i,e);return this._validateStyleAst(t,e),t}_makeStyleAst(i,e){let t=[],n=Array.isArray(i.styles)?i.styles:[i.styles];for(let l of n)typeof l=="string"?l===St?t.push(l):e.errors.push(Td(l)):t.push(new Map(Object.entries(l)));let r=!1,a=null;return t.forEach(l=>{if(l instanceof Map&&(l.has("easing")&&(a=l.get("easing"),l.delete("easing")),!r)){for(let u of l.values())if(u.toString().indexOf(ha)>=0){r=!0;break}}}),{type:J.Style,styles:t,easing:a,offset:i.offset,containsDynamicStyles:r,options:null}}_validateStyleAst(i,e){let t=e.currentAnimateTimings,n=e.currentTime,r=e.currentTime;t&&r>0&&(r-=t.duration+t.delay),i.styles.forEach(a=>{typeof a!="string"&&a.forEach((l,u)=>{let g=e.collectedStyles.get(e.currentQuerySelector),_=g.get(u),f=!0;_&&(r!=n&&r>=_.startTime&&n<=_.endTime&&(e.errors.push(Od(u,_.startTime,_.endTime,r,n)),f=!1),r=_.startTime),f&&g.set(u,{startTime:r,endTime:n}),e.options&&Yd(l,e.options,e.errors)})})}visitKeyframes(i,e){let t={type:J.Keyframes,styles:[],options:null};if(!e.currentAnimateTimings)return e.errors.push(kd()),t;let n=1,r=0,a=[],l=!1,u=!1,g=0,_=i.steps.map(q=>{let oe=this._makeStyleAst(q,e),le=oe.offset!=null?oe.offset:$f(oe.styles),W=0;return le!=null&&(r++,W=oe.offset=le),u=u||W<0||W>1,l=l||W<g,g=W,a.push(W),oe});u&&e.errors.push(Id()),l&&e.errors.push(Dd());let f=i.steps.length,S=0;r>0&&r<f?e.errors.push(Ad()):r==0&&(S=n/(f-1));let T=f-1,w=e.currentTime,M=e.currentAnimateTimings,z=M.duration;return _.forEach((q,oe)=>{let le=S>0?oe==T?1:S*oe:a[oe],W=le*z;e.currentTime=w+M.delay+W,M.duration=W,this._validateStyleAst(q,e),q.offset=le,t.styles.push(q)}),t}visitReference(i,e){return{type:J.Reference,animation:at(this,di(i.animation),e),options:yn(i.options)}}visitAnimateChild(i,e){return e.depCount++,{type:J.AnimateChild,options:yn(i.options)}}visitAnimateRef(i,e){return{type:J.AnimateRef,animation:this.visitReference(i.animation,e),options:yn(i.options)}}visitQuery(i,e){let t=e.currentQuerySelector,n=i.options||{};e.queryCount++,e.currentQuery=i;let[r,a]=Bf(i.selector);e.currentQuerySelector=t.length?t+" "+r:r,rt(e.collectedStyles,e.currentQuerySelector,new Map);let l=at(this,di(i.animation),e);return e.currentQuery=null,e.currentQuerySelector=t,{type:J.Query,selector:r,limit:n.limit||0,optional:!!n.optional,includeSelf:a,animation:l,originalSelector:i.selector,options:yn(i.options)}}visitStagger(i,e){e.currentQuery||e.errors.push(Rd());let t=i.timings==="full"?{duration:0,delay:0,easing:"full"}:Li(i.timings,e.errors,!0);return{type:J.Stagger,animation:at(this,di(i.animation),e),timings:t,options:null}}};function Bf(o){let i=!!o.split(/\s*,\s*/).find(e=>e==dp);return i&&(o=o.replace(zf,"")),o=o.replace(/@\*/g,Ni).replace(/@\w+/g,e=>Ni+"-"+e.slice(1)).replace(/:animating/g,tr),[o,i]}function Vf(o){return o?k({},o):null}var Sa=class{errors;queryCount=0;depCount=0;currentTransition=null;currentQuery=null;currentQuerySelector=null;currentAnimateTimings=null;currentTime=0;collectedStyles=new Map;options=null;unsupportedCSSPropertiesFound=new Set;constructor(i){this.errors=i}};function $f(o){if(typeof o=="string")return null;let i=null;if(Array.isArray(o))o.forEach(e=>{if(e instanceof Map&&e.has("offset")){let t=e;i=parseFloat(t.get("offset")),t.delete("offset")}});else if(o instanceof Map&&o.has("offset")){let e=o;i=parseFloat(e.get("offset")),e.delete("offset")}return i}function jf(o,i){if(o.hasOwnProperty("duration"))return o;if(typeof o=="number"){let r=Li(o,i).duration;return ba(r,0,"")}let e=o;if(e.split(/\s+/).some(r=>r.charAt(0)=="{"&&r.charAt(1)=="{")){let r=ba(0,0,"");return r.dynamic=!0,r.strValue=e,r}let n=Li(e,i);return ba(n.duration,n.delay,n.easing)}function yn(o){return o?(o=k({},o),o.params&&(o.params=Vf(o.params))):o={},o}function ba(o,i,e){return{duration:o,delay:i,easing:e}}function La(o,i,e,t,n,r,a=null,l=!1){return{type:1,element:o,keyframes:i,preStyleProps:e,postStyleProps:t,duration:n,delay:r,totalTime:n+r,easing:a,subTimeline:l}}var zi=class{_map=new Map;get(i){return this._map.get(i)||[]}append(i,e){let t=this._map.get(i);t||this._map.set(i,t=[]),t.push(...e)}has(i){return this._map.has(i)}clear(){this._map.clear()}},Uf=1,Gf=":enter",Hf=new RegExp(Gf,"g"),Wf=":leave",Kf=new RegExp(Wf,"g");function mp(o,i,e,t,n,r=new Map,a=new Map,l,u,g=[]){return new Ma().buildKeyframes(o,i,e,t,n,r,a,l,u,g)}var Ma=class{buildKeyframes(i,e,t,n,r,a,l,u,g,_=[]){g=g||new zi;let f=new Pa(i,e,g,n,r,_,[]);f.options=u;let S=u.delay?Vt(u.delay):0;f.currentTimeline.delayNextStep(S),f.currentTimeline.setStyles([a],null,f.errors,u),at(this,t,f);let T=f.timelines.filter(w=>w.containsAnimation());if(T.length&&l.size){let w;for(let M=T.length-1;M>=0;M--){let z=T[M];if(z.element===e){w=z;break}}w&&!w.allowOnlyTimelineStyles()&&w.setStyles([l],null,f.errors,u)}return T.length?T.map(w=>w.buildKeyframes()):[La(e,[],[],[],0,S,"",!1)]}visitTrigger(i,e){}visitState(i,e){}visitTransition(i,e){}visitAnimateChild(i,e){let t=e.subInstructions.get(e.element);if(t){let n=e.createSubContext(i.options),r=e.currentTimeline.currentTime,a=this._visitSubInstructions(t,n,n.options);r!=a&&e.transformIntoNewTimeline(a)}e.previousNode=i}visitAnimateRef(i,e){let t=e.createSubContext(i.options);t.transformIntoNewTimeline(),this._applyAnimationRefDelays([i.options,i.animation.options],e,t),this.visitReference(i.animation,t),e.transformIntoNewTimeline(t.currentTimeline.currentTime),e.previousNode=i}_applyAnimationRefDelays(i,e,t){for(let n of i){let r=n?.delay;if(r){let a=typeof r=="number"?r:Vt(pi(r,n?.params??{},e.errors));t.delayNextStep(a)}}}_visitSubInstructions(i,e,t){let r=e.currentTimeline.currentTime,a=t.duration!=null?Vt(t.duration):null,l=t.delay!=null?Vt(t.delay):null;return a!==0&&i.forEach(u=>{let g=e.appendInstructionToTimeline(u,a,l);r=Math.max(r,g.duration+g.delay)}),r}visitReference(i,e){e.updateOptions(i.options,!0),at(this,i.animation,e),e.previousNode=i}visitSequence(i,e){let t=e.subContextCount,n=e,r=i.options;if(r&&(r.params||r.delay)&&(n=e.createSubContext(r),n.transformIntoNewTimeline(),r.delay!=null)){n.previousNode.type==J.Style&&(n.currentTimeline.snapshotCurrentStyles(),n.previousNode=dr);let a=Vt(r.delay);n.delayNextStep(a)}i.steps.length&&(i.steps.forEach(a=>at(this,a,n)),n.currentTimeline.applyStylesToKeyframe(),n.subContextCount>t&&n.transformIntoNewTimeline()),e.previousNode=i}visitGroup(i,e){let t=[],n=e.currentTimeline.currentTime,r=i.options&&i.options.delay?Vt(i.options.delay):0;i.steps.forEach(a=>{let l=e.createSubContext(i.options);r&&l.delayNextStep(r),at(this,a,l),n=Math.max(n,l.currentTimeline.currentTime),t.push(l.currentTimeline)}),t.forEach(a=>e.currentTimeline.mergeTimelineCollectedStyles(a)),e.transformIntoNewTimeline(n),e.previousNode=i}_visitTiming(i,e){if(i.dynamic){let t=i.strValue,n=e.params?pi(t,e.params,e.errors):t;return Li(n,e.errors)}else return{duration:i.duration,delay:i.delay,easing:i.easing}}visitAnimate(i,e){let t=e.currentAnimateTimings=this._visitTiming(i.timings,e),n=e.currentTimeline;t.delay&&(e.incrementTime(t.delay),n.snapshotCurrentStyles());let r=i.style;r.type==J.Keyframes?this.visitKeyframes(r,e):(e.incrementTime(t.duration),this.visitStyle(r,e),n.applyStylesToKeyframe()),e.currentAnimateTimings=null,e.previousNode=i}visitStyle(i,e){let t=e.currentTimeline,n=e.currentAnimateTimings;!n&&t.hasCurrentStyleProperties()&&t.forwardFrame();let r=n&&n.easing||i.easing;i.isEmptyStep?t.applyEmptyStep(r):t.setStyles(i.styles,r,e.errors,e.options),e.previousNode=i}visitKeyframes(i,e){let t=e.currentAnimateTimings,n=e.currentTimeline.duration,r=t.duration,l=e.createSubContext().currentTimeline;l.easing=t.easing,i.styles.forEach(u=>{let g=u.offset||0;l.forwardTime(g*r),l.setStyles(u.styles,u.easing,e.errors,e.options),l.applyStylesToKeyframe()}),e.currentTimeline.mergeTimelineCollectedStyles(l),e.transformIntoNewTimeline(n+r),e.previousNode=i}visitQuery(i,e){let t=e.currentTimeline.currentTime,n=i.options||{},r=n.delay?Vt(n.delay):0;r&&(e.previousNode.type===J.Style||t==0&&e.currentTimeline.hasCurrentStyleProperties())&&(e.currentTimeline.snapshotCurrentStyles(),e.previousNode=dr);let a=t,l=e.invokeQuery(i.selector,i.originalSelector,i.limit,i.includeSelf,!!n.optional,e.errors);e.currentQueryTotal=l.length;let u=null;l.forEach((g,_)=>{e.currentQueryIndex=_;let f=e.createSubContext(i.options,g);r&&f.delayNextStep(r),g===e.element&&(u=f.currentTimeline),at(this,i.animation,f),f.currentTimeline.applyStylesToKeyframe();let S=f.currentTimeline.currentTime;a=Math.max(a,S)}),e.currentQueryIndex=0,e.currentQueryTotal=0,e.transformIntoNewTimeline(a),u&&(e.currentTimeline.mergeTimelineCollectedStyles(u),e.currentTimeline.snapshotCurrentStyles()),e.previousNode=i}visitStagger(i,e){let t=e.parentContext,n=e.currentTimeline,r=i.timings,a=Math.abs(r.duration),l=a*(e.currentQueryTotal-1),u=a*e.currentQueryIndex;switch(r.duration<0?"reverse":r.easing){case"reverse":u=l-u;break;case"full":u=t.currentStaggerTime;break}let _=e.currentTimeline;u&&_.delayNextStep(u);let f=_.currentTime;at(this,i.animation,e),e.previousNode=i,t.currentStaggerTime=n.currentTime-f+(n.startTime-t.currentTimeline.startTime)}},dr={},Pa=class o{_driver;element;subInstructions;_enterClassName;_leaveClassName;errors;timelines;parentContext=null;currentTimeline;currentAnimateTimings=null;previousNode=dr;subContextCount=0;options={};currentQueryIndex=0;currentQueryTotal=0;currentStaggerTime=0;constructor(i,e,t,n,r,a,l,u){this._driver=i,this.element=e,this.subInstructions=t,this._enterClassName=n,this._leaveClassName=r,this.errors=a,this.timelines=l,this.currentTimeline=u||new pr(this._driver,e,0),l.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(i,e){if(!i)return;let t=i,n=this.options;t.duration!=null&&(n.duration=Vt(t.duration)),t.delay!=null&&(n.delay=Vt(t.delay));let r=t.params;if(r){let a=n.params;a||(a=this.options.params={}),Object.keys(r).forEach(l=>{(!e||!a.hasOwnProperty(l))&&(a[l]=pi(r[l],a,this.errors))})}}_copyOptions(){let i={};if(this.options){let e=this.options.params;if(e){let t=i.params={};Object.keys(e).forEach(n=>{t[n]=e[n]})}}return i}createSubContext(i=null,e,t){let n=e||this.element,r=new o(this._driver,n,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(n,t||0));return r.previousNode=this.previousNode,r.currentAnimateTimings=this.currentAnimateTimings,r.options=this._copyOptions(),r.updateOptions(i),r.currentQueryIndex=this.currentQueryIndex,r.currentQueryTotal=this.currentQueryTotal,r.parentContext=this,this.subContextCount++,r}transformIntoNewTimeline(i){return this.previousNode=dr,this.currentTimeline=this.currentTimeline.fork(this.element,i),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(i,e,t){let n={duration:e??i.duration,delay:this.currentTimeline.currentTime+(t??0)+i.delay,easing:""},r=new Ta(this._driver,i.element,i.keyframes,i.preStyleProps,i.postStyleProps,n,i.stretchStartingKeyframe);return this.timelines.push(r),n}incrementTime(i){this.currentTimeline.forwardTime(this.currentTimeline.duration+i)}delayNextStep(i){i>0&&this.currentTimeline.delayNextStep(i)}invokeQuery(i,e,t,n,r,a){let l=[];if(n&&l.push(this.element),i.length>0){i=i.replace(Hf,"."+this._enterClassName),i=i.replace(Kf,"."+this._leaveClassName);let u=t!=1,g=this._driver.query(this.element,i,u);t!==0&&(g=t<0?g.slice(g.length+t,g.length):g.slice(0,t)),l.push(...g)}return!r&&l.length==0&&a.push(Nd(e)),l}},pr=class o{_driver;element;startTime;_elementTimelineStylesLookup;duration=0;easing=null;_previousKeyframe=new Map;_currentKeyframe=new Map;_keyframes=new Map;_styleSummary=new Map;_localTimelineStyles=new Map;_globalTimelineStyles;_pendingStyles=new Map;_backFill=new Map;_currentEmptyStepKeyframe=null;constructor(i,e,t,n){this._driver=i,this.element=e,this.startTime=t,this._elementTimelineStylesLookup=n,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(e),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(e,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(i){let e=this._keyframes.size===1&&this._pendingStyles.size;this.duration||e?(this.forwardTime(this.currentTime+i),e&&this.snapshotCurrentStyles()):this.startTime+=i}fork(i,e){return this.applyStylesToKeyframe(),new o(this._driver,i,e||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=Uf,this._loadKeyframe()}forwardTime(i){this.applyStylesToKeyframe(),this.duration=i,this._loadKeyframe()}_updateStyle(i,e){this._localTimelineStyles.set(i,e),this._globalTimelineStyles.set(i,e),this._styleSummary.set(i,{time:this.currentTime,value:e})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(i){i&&this._previousKeyframe.set("easing",i);for(let[e,t]of this._globalTimelineStyles)this._backFill.set(e,t||St),this._currentKeyframe.set(e,St);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(i,e,t,n){e&&this._previousKeyframe.set("easing",e);let r=n&&n.params||{},a=qf(i,this._globalTimelineStyles);for(let[l,u]of a){let g=pi(u,r,t);this._pendingStyles.set(l,g),this._localTimelineStyles.has(l)||this._backFill.set(l,this._globalTimelineStyles.get(l)??St),this._updateStyle(l,g)}}applyStylesToKeyframe(){this._pendingStyles.size!=0&&(this._pendingStyles.forEach((i,e)=>{this._currentKeyframe.set(e,i)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((i,e)=>{this._currentKeyframe.has(e)||this._currentKeyframe.set(e,i)}))}snapshotCurrentStyles(){for(let[i,e]of this._localTimelineStyles)this._pendingStyles.set(i,e),this._updateStyle(i,e)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){let i=[];for(let e in this._currentKeyframe)i.push(e);return i}mergeTimelineCollectedStyles(i){i._styleSummary.forEach((e,t)=>{let n=this._styleSummary.get(t);(!n||e.time>n.time)&&this._updateStyle(t,e.value)})}buildKeyframes(){this.applyStylesToKeyframe();let i=new Set,e=new Set,t=this._keyframes.size===1&&this.duration===0,n=[];this._keyframes.forEach((l,u)=>{let g=new Map([...this._backFill,...l]);g.forEach((_,f)=>{_===Si?i.add(f):_===St&&e.add(f)}),t||g.set("offset",u/this.duration),n.push(g)});let r=[...i.values()],a=[...e.values()];if(t){let l=n[0],u=new Map(l);l.set("offset",0),u.set("offset",1),n=[l,u]}return La(this.element,n,r,a,this.duration,this.startTime,this.easing,!1)}},Ta=class extends pr{keyframes;preStyleProps;postStyleProps;_stretchStartingKeyframe;timings;constructor(i,e,t,n,r,a,l=!1){super(i,e,a.delay),this.keyframes=t,this.preStyleProps=n,this.postStyleProps=r,this._stretchStartingKeyframe=l,this.timings={duration:a.duration,delay:a.delay,easing:a.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let i=this.keyframes,{delay:e,duration:t,easing:n}=this.timings;if(this._stretchStartingKeyframe&&e){let r=[],a=t+e,l=e/a,u=new Map(i[0]);u.set("offset",0),r.push(u);let g=new Map(i[0]);g.set("offset",np(l)),r.push(g);let _=i.length-1;for(let f=1;f<=_;f++){let S=new Map(i[f]),T=S.get("offset"),w=e+T*t;S.set("offset",np(w/a)),r.push(S)}t=a,e=0,n="",i=r}return La(this.element,i,this.preStyleProps,this.postStyleProps,t,e,n,!0)}};function np(o,i=3){let e=Math.pow(10,i-1);return Math.round(o*e)/e}function qf(o,i){let e=new Map,t;return o.forEach(n=>{if(n==="*"){t??=i.keys();for(let r of t)e.set(r,St)}else for(let[r,a]of n)e.set(r,a)}),e}function ip(o,i,e,t,n,r,a,l,u,g,_,f,S){return{type:0,element:o,triggerName:i,isRemovalTransition:n,fromState:e,fromStyles:r,toState:t,toStyles:a,timelines:l,queriedElements:u,preStyleProps:g,postStyleProps:_,totalTime:f,errors:S}}var Ca={},mr=class{_triggerName;ast;_stateStyles;constructor(i,e,t){this._triggerName=i,this.ast=e,this._stateStyles=t}match(i,e,t,n){return Qf(this.ast.matchers,i,e,t,n)}buildStyles(i,e,t){let n=this._stateStyles.get("*");return i!==void 0&&(n=this._stateStyles.get(i?.toString())||n),n?n.buildStyles(e,t):new Map}build(i,e,t,n,r,a,l,u,g,_){let f=[],S=this.ast.options&&this.ast.options.params||Ca,T=l&&l.params||Ca,w=this.buildStyles(t,T,f),M=u&&u.params||Ca,z=this.buildStyles(n,M,f),q=new Set,oe=new Map,le=new Map,W=n==="void",se={params:gp(M,S),delay:this.ast.options?.delay},te=_?[]:mp(i,e,this.ast.animation,r,a,w,z,se,g,f),ye=0;return te.forEach(ve=>{ye=Math.max(ve.duration+ve.delay,ye)}),f.length?ip(e,this._triggerName,t,n,W,w,z,[],[],oe,le,ye,f):(te.forEach(ve=>{let Et=ve.element,Pn=rt(oe,Et,new Set);ve.preStyleProps.forEach(cn=>Pn.add(cn));let Xa=rt(le,Et,new Set);ve.postStyleProps.forEach(cn=>Xa.add(cn)),Et!==e&&q.add(Et)}),ip(e,this._triggerName,t,n,W,w,z,te,[...q.values()],oe,le,ye))}};function Qf(o,i,e,t,n){return o.some(r=>r(i,e,t,n))}function gp(o,i){let e=k({},i);return Object.entries(o).forEach(([t,n])=>{n!=null&&(e[t]=n)}),e}var Oa=class{styles;defaultParams;normalizer;constructor(i,e,t){this.styles=i,this.defaultParams=e,this.normalizer=t}buildStyles(i,e){let t=new Map,n=gp(i,this.defaultParams);return this.styles.styles.forEach(r=>{typeof r!="string"&&r.forEach((a,l)=>{a&&(a=pi(a,n,e));let u=this.normalizer.normalizePropertyName(l,e);a=this.normalizer.normalizeStyleValue(l,u,a,e),t.set(l,a)})}),t}};function Zf(o,i,e){return new ka(o,i,e)}var ka=class{name;ast;_normalizer;transitionFactories=[];fallbackTransition;states=new Map;constructor(i,e,t){this.name=i,this.ast=e,this._normalizer=t,e.states.forEach(n=>{let r=n.options&&n.options.params||{};this.states.set(n.name,new Oa(n.style,r,t))}),op(this.states,"true","1"),op(this.states,"false","0"),e.transitions.forEach(n=>{this.transitionFactories.push(new mr(i,n,this.states))}),this.fallbackTransition=Yf(i,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(i,e,t,n){return this.transitionFactories.find(a=>a.match(i,e,t,n))||null}matchStyles(i,e,t){return this.fallbackTransition.buildStyles(i,e,t)}};function Yf(o,i,e){let t=[(a,l)=>!0],n={type:J.Sequence,steps:[],options:null},r={type:J.Transition,animation:n,matchers:t,options:null,queryCount:0,depCount:0};return new mr(o,r,i)}function op(o,i,e){o.has(i)?o.has(e)||o.set(e,o.get(i)):o.has(e)&&o.set(i,o.get(e))}var Xf=new zi,Ia=class{bodyNode;_driver;_normalizer;_animations=new Map;_playersById=new Map;players=[];constructor(i,e,t){this.bodyNode=i,this._driver=e,this._normalizer=t}register(i,e){let t=[],n=[],r=pp(this._driver,e,t,n);if(t.length)throw Bd(t);this._animations.set(i,r)}_buildPlayer(i,e,t){let n=i.element,r=pa(this._normalizer,i.keyframes,e,t);return this._driver.animate(n,r,i.duration,i.delay,i.easing,[],!0)}create(i,e,t={}){let n=[],r=this._animations.get(i),a,l=new Map;if(r?(a=mp(this._driver,e,r,fa,er,new Map,new Map,t,Xf,n),a.forEach(_=>{let f=rt(l,_.element,new Map);_.postStyleProps.forEach(S=>f.set(S,null))})):(n.push(Vd()),a=[]),n.length)throw $d(n);l.forEach((_,f)=>{_.forEach((S,T)=>{_.set(T,this._driver.computeStyle(f,T,St))})});let u=a.map(_=>{let f=l.get(_.element);return this._buildPlayer(_,new Map,f)}),g=Wt(u);return this._playersById.set(i,g),g.onDestroy(()=>this.destroy(i)),this.players.push(g),g}destroy(i){let e=this._getPlayer(i);e.destroy(),this._playersById.delete(i);let t=this.players.indexOf(e);t>=0&&this.players.splice(t,1)}_getPlayer(i){let e=this._playersById.get(i);if(!e)throw jd(i);return e}listen(i,e,t,n){let r=Xo(e,"","","");return Yo(this._getPlayer(i),t,r,n),()=>{}}command(i,e,t,n){if(t=="register"){this.register(i,n[0]);return}if(t=="create"){let a=n[0]||{};this.create(i,e,a);return}let r=this._getPlayer(i);switch(t){case"play":r.play();break;case"pause":r.pause();break;case"reset":r.reset();break;case"restart":r.restart();break;case"finish":r.finish();break;case"init":r.init();break;case"setPosition":r.setPosition(parseFloat(n[0]));break;case"destroy":this.destroy(i);break}}},rp="ng-animate-queued",Jf=".ng-animate-queued",ya="ng-animate-disabled",e0=".ng-animate-disabled",t0="ng-star-inserted",n0=".ng-star-inserted",i0=[],up={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},o0={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},kt="__ng_removed",Bi=class{namespaceId;value;options;get params(){return this.options.params}constructor(i,e=""){this.namespaceId=e;let t=i&&i.hasOwnProperty("value"),n=t?i.value:i;if(this.value=a0(n),t){let r=i,{value:a}=r,l=ns(r,["value"]);this.options=l}else this.options={};this.options.params||(this.options.params={})}absorbOptions(i){let e=i.params;if(e){let t=this.options.params;Object.keys(e).forEach(n=>{t[n]==null&&(t[n]=e[n])})}}},Fi="void",Ea=new Bi(Fi),Da=class{id;hostElement;_engine;players=[];_triggers=new Map;_queue=[];_elementListeners=new Map;_hostClassName;constructor(i,e,t){this.id=i,this.hostElement=e,this._engine=t,this._hostClassName="ng-tns-"+i,yt(e,this._hostClassName)}listen(i,e,t,n){if(!this._triggers.has(e))throw Ud(t,e);if(t==null||t.length==0)throw Gd(e);if(!s0(t))throw Hd(t,e);let r=rt(this._elementListeners,i,[]),a={name:e,phase:t,callback:n};r.push(a);let l=rt(this._engine.statesByElement,i,new Map);return l.has(e)||(yt(i,Ri),yt(i,Ri+"-"+e),l.set(e,Ea)),()=>{this._engine.afterFlush(()=>{let u=r.indexOf(a);u>=0&&r.splice(u,1),this._triggers.has(e)||l.delete(e)})}}register(i,e){return this._triggers.has(i)?!1:(this._triggers.set(i,e),!0)}_getTrigger(i){let e=this._triggers.get(i);if(!e)throw Wd(i);return e}trigger(i,e,t,n=!0){let r=this._getTrigger(e),a=new Vi(this.id,e,i),l=this._engine.statesByElement.get(i);l||(yt(i,Ri),yt(i,Ri+"-"+e),this._engine.statesByElement.set(i,l=new Map));let u=l.get(e),g=new Bi(t,this.id);if(!(t&&t.hasOwnProperty("value"))&&u&&g.absorbOptions(u.options),l.set(e,g),u||(u=Ea),!(g.value===Fi)&&u.value===g.value){if(!d0(u.params,g.params)){let M=[],z=r.matchStyles(u.value,u.params,M),q=r.matchStyles(g.value,g.params,M);M.length?this._engine.reportError(M):this._engine.afterFlush(()=>{ln(i,z),Ot(i,q)})}return}let S=rt(this._engine.playersByElement,i,[]);S.forEach(M=>{M.namespaceId==this.id&&M.triggerName==e&&M.queued&&M.destroy()});let T=r.matchTransition(u.value,g.value,i,g.params),w=!1;if(!T){if(!n)return;T=r.fallbackTransition,w=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:i,triggerName:e,transition:T,fromState:u,toState:g,player:a,isFallbackTransition:w}),w||(yt(i,rp),a.onStart(()=>{mi(i,rp)})),a.onDone(()=>{let M=this.players.indexOf(a);M>=0&&this.players.splice(M,1);let z=this._engine.playersByElement.get(i);if(z){let q=z.indexOf(a);q>=0&&z.splice(q,1)}}),this.players.push(a),S.push(a),a}deregister(i){this._triggers.delete(i),this._engine.statesByElement.forEach(e=>e.delete(i)),this._elementListeners.forEach((e,t)=>{this._elementListeners.set(t,e.filter(n=>n.name!=i))})}clearElementCache(i){this._engine.statesByElement.delete(i),this._elementListeners.delete(i);let e=this._engine.playersByElement.get(i);e&&(e.forEach(t=>t.destroy()),this._engine.playersByElement.delete(i))}_signalRemovalForInnerTriggers(i,e){let t=this._engine.driver.query(i,Ni,!0);t.forEach(n=>{if(n[kt])return;let r=this._engine.fetchNamespacesByElement(n);r.size?r.forEach(a=>a.triggerLeaveAnimation(n,e,!1,!0)):this.clearElementCache(n)}),this._engine.afterFlushAnimationsDone(()=>t.forEach(n=>this.clearElementCache(n)))}triggerLeaveAnimation(i,e,t,n){let r=this._engine.statesByElement.get(i),a=new Map;if(r){let l=[];if(r.forEach((u,g)=>{if(a.set(g,u.value),this._triggers.has(g)){let _=this.trigger(i,g,Fi,n);_&&l.push(_)}}),l.length)return this._engine.markElementAsRemoved(this.id,i,!0,e,a),t&&Wt(l).onDone(()=>this._engine.processLeaveNode(i)),!0}return!1}prepareLeaveAnimationListeners(i){let e=this._elementListeners.get(i),t=this._engine.statesByElement.get(i);if(e&&t){let n=new Set;e.forEach(r=>{let a=r.name;if(n.has(a))return;n.add(a);let u=this._triggers.get(a).fallbackTransition,g=t.get(a)||Ea,_=new Bi(Fi),f=new Vi(this.id,a,i);this._engine.totalQueuedPlayers++,this._queue.push({element:i,triggerName:a,transition:u,fromState:g,toState:_,player:f,isFallbackTransition:!0})})}}removeNode(i,e){let t=this._engine;if(i.childElementCount&&this._signalRemovalForInnerTriggers(i,e),this.triggerLeaveAnimation(i,e,!0))return;let n=!1;if(t.totalAnimations){let r=t.players.length?t.playersByQueriedElement.get(i):[];if(r&&r.length)n=!0;else{let a=i;for(;a=a.parentNode;)if(t.statesByElement.get(a)){n=!0;break}}}if(this.prepareLeaveAnimationListeners(i),n)t.markElementAsRemoved(this.id,i,!1,e);else{let r=i[kt];(!r||r===up)&&(t.afterFlush(()=>this.clearElementCache(i)),t.destroyInnerAnimations(i),t._onRemovalComplete(i,e))}}insertNode(i,e){yt(i,this._hostClassName)}drainQueuedTransitions(i){let e=[];return this._queue.forEach(t=>{let n=t.player;if(n.destroyed)return;let r=t.element,a=this._elementListeners.get(r);a&&a.forEach(l=>{if(l.name==t.triggerName){let u=Xo(r,t.triggerName,t.fromState.value,t.toState.value);u._data=i,Yo(t.player,l.phase,u,l.callback)}}),n.markedForDestroy?this._engine.afterFlush(()=>{n.destroy()}):e.push(t)}),this._queue=[],e.sort((t,n)=>{let r=t.transition.ast.depCount,a=n.transition.ast.depCount;return r==0||a==0?r-a:this._engine.driver.containsElement(t.element,n.element)?1:-1})}destroy(i){this.players.forEach(e=>e.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,i)}},Aa=class{bodyNode;driver;_normalizer;players=[];newHostElements=new Map;playersByElement=new Map;playersByQueriedElement=new Map;statesByElement=new Map;disabledNodes=new Set;totalAnimations=0;totalQueuedPlayers=0;_namespaceLookup={};_namespaceList=[];_flushFns=[];_whenQuietFns=[];namespacesByHostElement=new Map;collectedEnterElements=[];collectedLeaveElements=[];onRemovalComplete=(i,e)=>{};_onRemovalComplete(i,e){this.onRemovalComplete(i,e)}constructor(i,e,t){this.bodyNode=i,this.driver=e,this._normalizer=t}get queuedPlayers(){let i=[];return this._namespaceList.forEach(e=>{e.players.forEach(t=>{t.queued&&i.push(t)})}),i}createNamespace(i,e){let t=new Da(i,e,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,e)?this._balanceNamespaceList(t,e):(this.newHostElements.set(e,t),this.collectEnterElement(e)),this._namespaceLookup[i]=t}_balanceNamespaceList(i,e){let t=this._namespaceList,n=this.namespacesByHostElement;if(t.length-1>=0){let a=!1,l=this.driver.getParentElement(e);for(;l;){let u=n.get(l);if(u){let g=t.indexOf(u);t.splice(g+1,0,i),a=!0;break}l=this.driver.getParentElement(l)}a||t.unshift(i)}else t.push(i);return n.set(e,i),i}register(i,e){let t=this._namespaceLookup[i];return t||(t=this.createNamespace(i,e)),t}registerTrigger(i,e,t){let n=this._namespaceLookup[i];n&&n.register(e,t)&&this.totalAnimations++}destroy(i,e){i&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{let t=this._fetchNamespace(i);this.namespacesByHostElement.delete(t.hostElement);let n=this._namespaceList.indexOf(t);n>=0&&this._namespaceList.splice(n,1),t.destroy(e),delete this._namespaceLookup[i]}))}_fetchNamespace(i){return this._namespaceLookup[i]}fetchNamespacesByElement(i){let e=new Set,t=this.statesByElement.get(i);if(t){for(let n of t.values())if(n.namespaceId){let r=this._fetchNamespace(n.namespaceId);r&&e.add(r)}}return e}trigger(i,e,t,n){if(ar(e)){let r=this._fetchNamespace(i);if(r)return r.trigger(e,t,n),!0}return!1}insertNode(i,e,t,n){if(!ar(e))return;let r=e[kt];if(r&&r.setForRemoval){r.setForRemoval=!1,r.setForMove=!0;let a=this.collectedLeaveElements.indexOf(e);a>=0&&this.collectedLeaveElements.splice(a,1)}if(i){let a=this._fetchNamespace(i);a&&a.insertNode(e,t)}n&&this.collectEnterElement(e)}collectEnterElement(i){this.collectedEnterElements.push(i)}markElementAsDisabled(i,e){e?this.disabledNodes.has(i)||(this.disabledNodes.add(i),yt(i,ya)):this.disabledNodes.has(i)&&(this.disabledNodes.delete(i),mi(i,ya))}removeNode(i,e,t){if(ar(e)){let n=i?this._fetchNamespace(i):null;n?n.removeNode(e,t):this.markElementAsRemoved(i,e,!1,t);let r=this.namespacesByHostElement.get(e);r&&r.id!==i&&r.removeNode(e,t)}else this._onRemovalComplete(e,t)}markElementAsRemoved(i,e,t,n,r){this.collectedLeaveElements.push(e),e[kt]={namespaceId:i,setForRemoval:n,hasAnimation:t,removedBeforeQueried:!1,previousTriggersValues:r}}listen(i,e,t,n,r){return ar(e)?this._fetchNamespace(i).listen(e,t,n,r):()=>{}}_buildInstruction(i,e,t,n,r){return i.transition.build(this.driver,i.element,i.fromState.value,i.toState.value,t,n,i.fromState.options,i.toState.options,e,r)}destroyInnerAnimations(i){let e=this.driver.query(i,Ni,!0);e.forEach(t=>this.destroyActiveAnimationsForElement(t)),this.playersByQueriedElement.size!=0&&(e=this.driver.query(i,tr,!0),e.forEach(t=>this.finishActiveQueriedAnimationOnElement(t)))}destroyActiveAnimationsForElement(i){let e=this.playersByElement.get(i);e&&e.forEach(t=>{t.queued?t.markedForDestroy=!0:t.destroy()})}finishActiveQueriedAnimationOnElement(i){let e=this.playersByQueriedElement.get(i);e&&e.forEach(t=>t.finish())}whenRenderingDone(){return new Promise(i=>{if(this.players.length)return Wt(this.players).onDone(()=>i());i()})}processLeaveNode(i){let e=i[kt];if(e&&e.setForRemoval){if(i[kt]=up,e.namespaceId){this.destroyInnerAnimations(i);let t=this._fetchNamespace(e.namespaceId);t&&t.clearElementCache(i)}this._onRemovalComplete(i,e.setForRemoval)}i.classList?.contains(ya)&&this.markElementAsDisabled(i,!1),this.driver.query(i,e0,!0).forEach(t=>{this.markElementAsDisabled(t,!1)})}flush(i=-1){let e=[];if(this.newHostElements.size&&(this.newHostElements.forEach((t,n)=>this._balanceNamespaceList(t,n)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let t=0;t<this.collectedEnterElements.length;t++){let n=this.collectedEnterElements[t];yt(n,t0)}if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){let t=[];try{e=this._flushAnimations(t,i)}finally{for(let n=0;n<t.length;n++)t[n]()}}else for(let t=0;t<this.collectedLeaveElements.length;t++){let n=this.collectedLeaveElements[t];this.processLeaveNode(n)}if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(t=>t()),this._flushFns=[],this._whenQuietFns.length){let t=this._whenQuietFns;this._whenQuietFns=[],e.length?Wt(e).onDone(()=>{t.forEach(n=>n())}):t.forEach(n=>n())}}reportError(i){throw Kd(i)}_flushAnimations(i,e){let t=new zi,n=[],r=new Map,a=[],l=new Map,u=new Map,g=new Map,_=new Set;this.disabledNodes.forEach(R=>{_.add(R);let $=this.driver.query(R,Jf,!0);for(let G=0;G<$.length;G++)_.add($[G])});let f=this.bodyNode,S=Array.from(this.statesByElement.keys()),T=lp(S,this.collectedEnterElements),w=new Map,M=0;T.forEach((R,$)=>{let G=fa+M++;w.set($,G),R.forEach(ne=>yt(ne,G))});let z=[],q=new Set,oe=new Set;for(let R=0;R<this.collectedLeaveElements.length;R++){let $=this.collectedLeaveElements[R],G=$[kt];G&&G.setForRemoval&&(z.push($),q.add($),G.hasAnimation?this.driver.query($,n0,!0).forEach(ne=>q.add(ne)):oe.add($))}let le=new Map,W=lp(S,Array.from(q));W.forEach((R,$)=>{let G=er+M++;le.set($,G),R.forEach(ne=>yt(ne,G))}),i.push(()=>{T.forEach((R,$)=>{let G=w.get($);R.forEach(ne=>mi(ne,G))}),W.forEach((R,$)=>{let G=le.get($);R.forEach(ne=>mi(ne,G))}),z.forEach(R=>{this.processLeaveNode(R)})});let se=[],te=[];for(let R=this._namespaceList.length-1;R>=0;R--)this._namespaceList[R].drainQueuedTransitions(e).forEach(G=>{let ne=G.player,Re=G.element;if(se.push(ne),this.collectedEnterElements.length){let je=Re[kt];if(je&&je.setForMove){if(je.previousTriggersValues&&je.previousTriggersValues.has(G.triggerName)){let dn=je.previousTriggersValues.get(G.triggerName),pt=this.statesByElement.get(G.element);if(pt&&pt.has(G.triggerName)){let Ui=pt.get(G.triggerName);Ui.value=dn,pt.set(G.triggerName,Ui)}}ne.destroy();return}}let Dt=!f||!this.driver.containsElement(f,Re),st=le.get(Re),Kt=w.get(Re),we=this._buildInstruction(G,t,Kt,st,Dt);if(we.errors&&we.errors.length){te.push(we);return}if(Dt){ne.onStart(()=>ln(Re,we.fromStyles)),ne.onDestroy(()=>Ot(Re,we.toStyles)),n.push(ne);return}if(G.isFallbackTransition){ne.onStart(()=>ln(Re,we.fromStyles)),ne.onDestroy(()=>Ot(Re,we.toStyles)),n.push(ne);return}let ts=[];we.timelines.forEach(je=>{je.stretchStartingKeyframe=!0,this.disabledNodes.has(je.element)||ts.push(je)}),we.timelines=ts,t.append(Re,we.timelines);let Rm={instruction:we,player:ne,element:Re};a.push(Rm),we.queriedElements.forEach(je=>rt(l,je,[]).push(ne)),we.preStyleProps.forEach((je,dn)=>{if(je.size){let pt=u.get(dn);pt||u.set(dn,pt=new Set),je.forEach((Ui,Sr)=>pt.add(Sr))}}),we.postStyleProps.forEach((je,dn)=>{let pt=g.get(dn);pt||g.set(dn,pt=new Set),je.forEach((Ui,Sr)=>pt.add(Sr))})});if(te.length){let R=[];te.forEach($=>{R.push(qd($.triggerName,$.errors))}),se.forEach($=>$.destroy()),this.reportError(R)}let ye=new Map,ve=new Map;a.forEach(R=>{let $=R.element;t.has($)&&(ve.set($,$),this._beforeAnimationBuild(R.player.namespaceId,R.instruction,ye))}),n.forEach(R=>{let $=R.element;this._getPreviousPlayers($,!1,R.namespaceId,R.triggerName,null).forEach(ne=>{rt(ye,$,[]).push(ne),ne.destroy()})});let Et=z.filter(R=>cp(R,u,g)),Pn=new Map;sp(Pn,this.driver,oe,g,St).forEach(R=>{cp(R,u,g)&&Et.push(R)});let cn=new Map;T.forEach((R,$)=>{sp(cn,this.driver,new Set(R),u,Si)}),Et.forEach(R=>{let $=Pn.get(R),G=cn.get(R);Pn.set(R,new Map([...$?.entries()??[],...G?.entries()??[]]))});let xr=[],Ja=[],es={};a.forEach(R=>{let{element:$,player:G,instruction:ne}=R;if(t.has($)){if(_.has($)){G.onDestroy(()=>Ot($,ne.toStyles)),G.disabled=!0,G.overrideTotalTime(ne.totalTime),n.push(G);return}let Re=es;if(ve.size>1){let st=$,Kt=[];for(;st=st.parentNode;){let we=ve.get(st);if(we){Re=we;break}Kt.push(st)}Kt.forEach(we=>ve.set(we,Re))}let Dt=this._buildAnimation(G.namespaceId,ne,ye,r,cn,Pn);if(G.setRealPlayer(Dt),Re===es)xr.push(G);else{let st=this.playersByElement.get(Re);st&&st.length&&(G.parentPlayer=Wt(st)),n.push(G)}}else ln($,ne.fromStyles),G.onDestroy(()=>Ot($,ne.toStyles)),Ja.push(G),_.has($)&&n.push(G)}),Ja.forEach(R=>{let $=r.get(R.element);if($&&$.length){let G=Wt($);R.setRealPlayer(G)}}),n.forEach(R=>{R.parentPlayer?R.syncPlayerEvents(R.parentPlayer):R.destroy()});for(let R=0;R<z.length;R++){let $=z[R],G=$[kt];if(mi($,er),G&&G.hasAnimation)continue;let ne=[];if(l.size){let Dt=l.get($);Dt&&Dt.length&&ne.push(...Dt);let st=this.driver.query($,tr,!0);for(let Kt=0;Kt<st.length;Kt++){let we=l.get(st[Kt]);we&&we.length&&ne.push(...we)}}let Re=ne.filter(Dt=>!Dt.destroyed);Re.length?l0(this,$,Re):this.processLeaveNode($)}return z.length=0,xr.forEach(R=>{this.players.push(R),R.onDone(()=>{R.destroy();let $=this.players.indexOf(R);this.players.splice($,1)}),R.play()}),xr}afterFlush(i){this._flushFns.push(i)}afterFlushAnimationsDone(i){this._whenQuietFns.push(i)}_getPreviousPlayers(i,e,t,n,r){let a=[];if(e){let l=this.playersByQueriedElement.get(i);l&&(a=l)}else{let l=this.playersByElement.get(i);if(l){let u=!r||r==Fi;l.forEach(g=>{g.queued||!u&&g.triggerName!=n||a.push(g)})}}return(t||n)&&(a=a.filter(l=>!(t&&t!=l.namespaceId||n&&n!=l.triggerName))),a}_beforeAnimationBuild(i,e,t){let n=e.triggerName,r=e.element,a=e.isRemovalTransition?void 0:i,l=e.isRemovalTransition?void 0:n;for(let u of e.timelines){let g=u.element,_=g!==r,f=rt(t,g,[]);this._getPreviousPlayers(g,_,a,l,e.toState).forEach(T=>{let w=T.getRealPlayer();w.beforeDestroy&&w.beforeDestroy(),T.destroy(),f.push(T)})}ln(r,e.fromStyles)}_buildAnimation(i,e,t,n,r,a){let l=e.triggerName,u=e.element,g=[],_=new Set,f=new Set,S=e.timelines.map(w=>{let M=w.element;_.add(M);let z=M[kt];if(z&&z.removedBeforeQueried)return new vn(w.duration,w.delay);let q=M!==u,oe=c0((t.get(M)||i0).map(ye=>ye.getRealPlayer())).filter(ye=>{let ve=ye;return ve.element?ve.element===M:!1}),le=r.get(M),W=a.get(M),se=pa(this._normalizer,w.keyframes,le,W),te=this._buildPlayer(w,se,oe);if(w.subTimeline&&n&&f.add(M),q){let ye=new Vi(i,l,M);ye.setRealPlayer(te),g.push(ye)}return te});g.forEach(w=>{rt(this.playersByQueriedElement,w.element,[]).push(w),w.onDone(()=>r0(this.playersByQueriedElement,w.element,w))}),_.forEach(w=>yt(w,_a));let T=Wt(S);return T.onDestroy(()=>{_.forEach(w=>mi(w,_a)),Ot(u,e.toStyles)}),f.forEach(w=>{rt(n,w,[]).push(T)}),T}_buildPlayer(i,e,t){return e.length>0?this.driver.animate(i.element,e,i.duration,i.delay,i.easing,t):new vn(i.duration,i.delay)}},Vi=class{namespaceId;triggerName;element;_player=new vn;_containsRealPlayer=!1;_queuedCallbacks=new Map;destroyed=!1;parentPlayer=null;markedForDestroy=!1;disabled=!1;queued=!0;totalTime=0;constructor(i,e,t){this.namespaceId=i,this.triggerName=e,this.element=t}setRealPlayer(i){this._containsRealPlayer||(this._player=i,this._queuedCallbacks.forEach((e,t)=>{e.forEach(n=>Yo(i,t,void 0,n))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(i.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(i){this.totalTime=i}syncPlayerEvents(i){let e=this._player;e.triggerCallback&&i.onStart(()=>e.triggerCallback("start")),i.onDone(()=>this.finish()),i.onDestroy(()=>this.destroy())}_queueEvent(i,e){rt(this._queuedCallbacks,i,[]).push(e)}onDone(i){this.queued&&this._queueEvent("done",i),this._player.onDone(i)}onStart(i){this.queued&&this._queueEvent("start",i),this._player.onStart(i)}onDestroy(i){this.queued&&this._queueEvent("destroy",i),this._player.onDestroy(i)}init(){this._player.init()}hasStarted(){return this.queued?!1:this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(i){this.queued||this._player.setPosition(i)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(i){let e=this._player;e.triggerCallback&&e.triggerCallback(i)}};function r0(o,i,e){let t=o.get(i);if(t){if(t.length){let n=t.indexOf(e);t.splice(n,1)}t.length==0&&o.delete(i)}return t}function a0(o){return o??null}function ar(o){return o&&o.nodeType===1}function s0(o){return o=="start"||o=="done"}function ap(o,i){let e=o.style.display;return o.style.display=i??"none",e}function sp(o,i,e,t,n){let r=[];e.forEach(u=>r.push(ap(u)));let a=[];t.forEach((u,g)=>{let _=new Map;u.forEach(f=>{let S=i.computeStyle(g,f,n);_.set(f,S),(!S||S.length==0)&&(g[kt]=o0,a.push(g))}),o.set(g,_)});let l=0;return e.forEach(u=>ap(u,r[l++])),a}function lp(o,i){let e=new Map;if(o.forEach(l=>e.set(l,[])),i.length==0)return e;let t=1,n=new Set(i),r=new Map;function a(l){if(!l)return t;let u=r.get(l);if(u)return u;let g=l.parentNode;return e.has(g)?u=g:n.has(g)?u=t:u=a(g),r.set(l,u),u}return i.forEach(l=>{let u=a(l);u!==t&&e.get(u).push(l)}),e}function yt(o,i){o.classList?.add(i)}function mi(o,i){o.classList?.remove(i)}function l0(o,i,e){Wt(e).onDone(()=>o.processLeaveNode(i))}function c0(o){let i=[];return hp(o,i),i}function hp(o,i){for(let e=0;e<o.length;e++){let t=o[e];t instanceof go?hp(t.players,i):i.push(t)}}function d0(o,i){let e=Object.keys(o),t=Object.keys(i);if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++){let r=e[n];if(!i.hasOwnProperty(r)||o[r]!==i[r])return!1}return!0}function cp(o,i,e){let t=e.get(o);if(!t)return!1;let n=i.get(o);return n?t.forEach(r=>n.add(r)):i.set(o,t),e.delete(o),!0}var gi=class{_driver;_normalizer;_transitionEngine;_timelineEngine;_triggerCache={};onRemovalComplete=(i,e)=>{};constructor(i,e,t){this._driver=e,this._normalizer=t,this._transitionEngine=new Aa(i.body,e,t),this._timelineEngine=new Ia(i.body,e,t),this._transitionEngine.onRemovalComplete=(n,r)=>this.onRemovalComplete(n,r)}registerTrigger(i,e,t,n,r){let a=i+"-"+n,l=this._triggerCache[a];if(!l){let u=[],g=[],_=pp(this._driver,r,u,g);if(u.length)throw zd(n,u);l=Zf(n,_,this._normalizer),this._triggerCache[a]=l}this._transitionEngine.registerTrigger(e,n,l)}register(i,e){this._transitionEngine.register(i,e)}destroy(i,e){this._transitionEngine.destroy(i,e)}onInsert(i,e,t,n){this._transitionEngine.insertNode(i,e,t,n)}onRemove(i,e,t){this._transitionEngine.removeNode(i,e,t)}disableAnimations(i,e){this._transitionEngine.markElementAsDisabled(i,e)}process(i,e,t,n){if(t.charAt(0)=="@"){let[r,a]=ma(t),l=n;this._timelineEngine.command(r,e,a,l)}else this._transitionEngine.trigger(i,e,t,n)}listen(i,e,t,n,r){if(t.charAt(0)=="@"){let[a,l]=ma(t);return this._timelineEngine.listen(a,e,l,r)}return this._transitionEngine.listen(i,e,t,n,r)}flush(i=-1){this._transitionEngine.flush(i)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(i){this._transitionEngine.afterFlushAnimationsDone(i)}};function p0(o,i){let e=null,t=null;return Array.isArray(i)&&i.length?(e=wa(i[0]),i.length>1&&(t=wa(i[i.length-1]))):i instanceof Map&&(e=wa(i)),e||t?new m0(o,e,t):null}var m0=(()=>{class o{_element;_startStyles;_endStyles;static initialStylesByElement=new WeakMap;_state=0;_initialStyles;constructor(e,t,n){this._element=e,this._startStyles=t,this._endStyles=n;let r=o.initialStylesByElement.get(e);r||o.initialStylesByElement.set(e,r=new Map),this._initialStyles=r}start(){this._state<1&&(this._startStyles&&Ot(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Ot(this._element,this._initialStyles),this._endStyles&&(Ot(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(o.initialStylesByElement.delete(this._element),this._startStyles&&(ln(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(ln(this._element,this._endStyles),this._endStyles=null),Ot(this._element,this._initialStyles),this._state=3)}}return o})();function wa(o){let i=null;return o.forEach((e,t)=>{g0(t)&&(i=i||new Map,i.set(t,e))}),i}function g0(o){return o==="display"||o==="position"}var gr=class{element;keyframes;options;_specialStyles;_onDoneFns=[];_onStartFns=[];_onDestroyFns=[];_duration;_delay;_initialized=!1;_finished=!1;_started=!1;_destroyed=!1;_finalKeyframe;_originalOnDoneFns=[];_originalOnStartFns=[];domPlayer;time=0;parentPlayer=null;currentSnapshot=new Map;constructor(i,e,t,n){this.element=i,this.keyframes=e,this.options=t,this._specialStyles=n,this._duration=t.duration,this._delay=t.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(i=>i()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;let i=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,i,this.options),this._finalKeyframe=i.length?i[i.length-1]:new Map;let e=()=>this._onFinish();this.domPlayer.addEventListener("finish",e),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",e)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(i){let e=[];return i.forEach(t=>{e.push(Object.fromEntries(t))}),e}_triggerWebAnimation(i,e,t){return i.animate(this._convertKeyframesToObject(e),t)}onStart(i){this._originalOnStartFns.push(i),this._onStartFns.push(i)}onDone(i){this._originalOnDoneFns.push(i),this._onDoneFns.push(i)}onDestroy(i){this._onDestroyFns.push(i)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(i=>i()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(i=>i()),this._onDestroyFns=[])}setPosition(i){this.domPlayer===void 0&&this.init(),this.domPlayer.currentTime=i*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){let i=new Map;this.hasStarted()&&this._finalKeyframe.forEach((t,n)=>{n!=="offset"&&i.set(n,this._finished?t:ir(this.element,n))}),this.currentSnapshot=i}triggerCallback(i){let e=i==="start"?this._onStartFns:this._onDoneFns;e.forEach(t=>t()),e.length=0}},ur=class{validateStyleProperty(i){return!0}validateAnimatableStyleProperty(i){return!0}containsElement(i,e){return ga(i,e)}getParentElement(i){return Jo(i)}query(i,e,t){return ua(i,e,t)}computeStyle(i,e,t){return ir(i,e)}animate(i,e,t,n,r,a=[]){let l=n==0?"both":"forwards",u={duration:t,delay:n,fill:l};r&&(u.easing=r);let g=new Map,_=a.filter(T=>T instanceof gr);Xd(t,n)&&_.forEach(T=>{T.currentSnapshot.forEach((w,M)=>g.set(M,w))});let f=Zd(e).map(T=>new Map(T));f=Jd(i,f,g);let S=p0(i,f);return new gr(i,f,u,S)}};var sr="@",fp="@.disabled",hr=class{namespaceId;delegate;engine;_onDestroy;\u0275type=0;constructor(i,e,t,n){this.namespaceId=i,this.delegate=e,this.engine=t,this._onDestroy=n}get data(){return this.delegate.data}destroyNode(i){this.delegate.destroyNode?.(i)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(i,e){return this.delegate.createElement(i,e)}createComment(i){return this.delegate.createComment(i)}createText(i){return this.delegate.createText(i)}appendChild(i,e){this.delegate.appendChild(i,e),this.engine.onInsert(this.namespaceId,e,i,!1)}insertBefore(i,e,t,n=!0){this.delegate.insertBefore(i,e,t),this.engine.onInsert(this.namespaceId,e,i,n)}removeChild(i,e,t){this.parentNode(e)&&this.engine.onRemove(this.namespaceId,e,this.delegate)}selectRootElement(i,e){return this.delegate.selectRootElement(i,e)}parentNode(i){return this.delegate.parentNode(i)}nextSibling(i){return this.delegate.nextSibling(i)}setAttribute(i,e,t,n){this.delegate.setAttribute(i,e,t,n)}removeAttribute(i,e,t){this.delegate.removeAttribute(i,e,t)}addClass(i,e){this.delegate.addClass(i,e)}removeClass(i,e){this.delegate.removeClass(i,e)}setStyle(i,e,t,n){this.delegate.setStyle(i,e,t,n)}removeStyle(i,e,t){this.delegate.removeStyle(i,e,t)}setProperty(i,e,t){e.charAt(0)==sr&&e==fp?this.disableAnimations(i,!!t):this.delegate.setProperty(i,e,t)}setValue(i,e){this.delegate.setValue(i,e)}listen(i,e,t,n){return this.delegate.listen(i,e,t,n)}disableAnimations(i,e){this.engine.disableAnimations(i,e)}},Ra=class extends hr{factory;constructor(i,e,t,n,r){super(e,t,n,r),this.factory=i,this.namespaceId=e}setProperty(i,e,t){e.charAt(0)==sr?e.charAt(1)=="."&&e==fp?(t=t===void 0?!0:!!t,this.disableAnimations(i,t)):this.engine.process(this.namespaceId,i,e.slice(1),t):this.delegate.setProperty(i,e,t)}listen(i,e,t,n){if(e.charAt(0)==sr){let r=u0(i),a=e.slice(1),l="";return a.charAt(0)!=sr&&([a,l]=h0(a)),this.engine.listen(this.namespaceId,r,a,l,u=>{let g=u._data||-1;this.factory.scheduleListenerCallback(g,t,u)})}return this.delegate.listen(i,e,t,n)}};function u0(o){switch(o){case"body":return document.body;case"document":return document;case"window":return window;default:return o}}function h0(o){let i=o.indexOf("."),e=o.substring(0,i),t=o.slice(i+1);return[e,t]}var fr=class{delegate;engine;_zone;_currentId=0;_microtaskId=1;_animationCallbacksBuffer=[];_rendererCache=new Map;_cdRecurDepth=0;constructor(i,e,t){this.delegate=i,this.engine=e,this._zone=t,e.onRemovalComplete=(n,r)=>{r?.removeChild(null,n)}}createRenderer(i,e){let t="",n=this.delegate.createRenderer(i,e);if(!i||!e?.data?.animation){let g=this._rendererCache,_=g.get(n);if(!_){let f=()=>g.delete(n);_=new hr(t,n,this.engine,f),g.set(n,_)}return _}let r=e.id,a=e.id+"-"+this._currentId;this._currentId++,this.engine.register(a,i);let l=g=>{Array.isArray(g)?g.forEach(l):this.engine.registerTrigger(r,a,i,g.name,g)};return e.data.animation.forEach(l),new Ra(this,a,n,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(i,e,t){if(i>=0&&i<this._microtaskId){this._zone.run(()=>e(t));return}let n=this._animationCallbacksBuffer;n.length==0&&queueMicrotask(()=>{this._zone.run(()=>{n.forEach(r=>{let[a,l]=r;a(l)}),this._animationCallbacksBuffer=[]})}),n.push([e,t])}end(){this._cdRecurDepth--,this._cdRecurDepth==0&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}componentReplaced(i){this.engine.flush(),this.delegate.componentReplaced?.(i)}};var _0=(()=>{class o extends gi{constructor(e,t,n){super(e,t,n)}ngOnDestroy(){this.flush()}static \u0275fac=function(t){return new(t||o)(O(Ci),O(En),O(wn))};static \u0275prov=I({token:o,factory:o.\u0275fac})}return o})();function v0(){return new lr}function b0(o,i,e){return new fr(o,i,e)}var _p=[{provide:wn,useFactory:v0},{provide:gi,useClass:_0},{provide:_i,useFactory:b0,deps:[Bs,gi,et]}],Zx=[{provide:En,useClass:Na},{provide:Ir,useValue:"NoopAnimations"},..._p],C0=[{provide:En,useFactory:()=>new ur},{provide:Ir,useFactory:()=>"BrowserAnimations"},..._p];function vp(){return Es("NgEagerAnimations"),[...C0]}var ji="PERFORM_ACTION",E0="REFRESH",xp="RESET",Sp="ROLLBACK",Mp="COMMIT",Pp="SWEEP",Tp="TOGGLE_ACTION",w0="SET_ACTIONS_ACTIVE",Op="JUMP_TO_STATE",kp="JUMP_TO_ACTION",Qa="IMPORT_STATE",Ip="LOCK_CHANGES",Dp="PAUSE_RECORDING",ui=class{constructor(i,e){if(this.action=i,this.timestamp=e,this.type=ji,typeof i.type>"u")throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?')}},Fa=class{constructor(){this.type=E0}},za=class{constructor(i){this.timestamp=i,this.type=xp}},Ba=class{constructor(i){this.timestamp=i,this.type=Sp}},Va=class{constructor(i){this.timestamp=i,this.type=Mp}},$a=class{constructor(){this.type=Pp}},ja=class{constructor(i){this.id=i,this.type=Tp}};var Ua=class{constructor(i){this.index=i,this.type=Op}},Ga=class{constructor(i){this.actionId=i,this.type=kp}},Ha=class{constructor(i){this.nextLiftedState=i,this.type=Qa}},Wa=class{constructor(i){this.status=i,this.type=Ip}},Ka=class{constructor(i){this.status=i,this.type=Dp}};var Cr=new Le("@ngrx/store-devtools Options"),bp=new Le("@ngrx/store-devtools Initial Config");function Ap(){return null}var x0="NgRx Store DevTools";function S0(o){let i={maxAge:!1,monitor:Ap,actionSanitizer:void 0,stateSanitizer:void 0,name:x0,serialize:!1,logOnly:!1,autoPause:!1,trace:!1,traceLimit:75,features:{pause:!0,lock:!0,persist:!0,export:!0,import:"custom",jump:!0,skip:!0,reorder:!0,dispatch:!0,test:!0},connectInZone:!1},e=typeof o=="function"?o():o,t=e.logOnly?{pause:!0,export:!0,test:!0}:!1,n=e.features||t||i.features;n.import===!0&&(n.import="custom");let r=Object.assign({},i,{features:n},e);if(r.maxAge&&r.maxAge<2)throw new Error(`Devtools 'maxAge' cannot be less than 2, got ${r.maxAge}`);return r}function Cp(o,i){return o.filter(e=>i.indexOf(e)<0)}function Rp(o){let{computedStates:i,currentStateIndex:e}=o;if(e>=i.length){let{state:n}=i[i.length-1];return n}let{state:t}=i[e];return t}function $i(o){return new ui(o,+Date.now())}function M0(o,i){return Object.keys(i).reduce((e,t)=>{let n=Number(t);return e[n]=Np(o,i[n],n),e},{})}function Np(o,i,e){return Q(k({},i),{action:o(i.action,e)})}function P0(o,i){return i.map((e,t)=>({state:Lp(o,e.state,t),error:e.error}))}function Lp(o,i,e){return o(i,e)}function Fp(o){return o.predicate||o.actionsSafelist||o.actionsBlocklist}function T0(o,i,e,t){let n=[],r={},a=[];return o.stagedActionIds.forEach((l,u)=>{let g=o.actionsById[l];g&&(u&&Za(o.computedStates[u],g,i,e,t)||(r[l]=g,n.push(l),a.push(o.computedStates[u])))}),Q(k({},o),{stagedActionIds:n,actionsById:r,computedStates:a})}function Za(o,i,e,t,n){let r=e&&!e(o,i.action),a=t&&!i.action.type.match(t.map(u=>yp(u)).join("|")),l=n&&i.action.type.match(n.map(u=>yp(u)).join("|"));return r||a||l}function yp(o){return o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function zp(o){return{ngZone:o?P(et):null,connectInZone:o}}var yr=(()=>{class o extends To{static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=Or(o)))(n||o)}})()}static{this.\u0275prov=I({token:o,factory:o.\u0275fac})}}return o})(),_r={START:"START",DISPATCH:"DISPATCH",STOP:"STOP",ACTION:"ACTION"},qa=new Le("@ngrx/store-devtools Redux Devtools Extension"),Bp=(()=>{class o{constructor(e,t,n){this.config=t,this.dispatcher=n,this.zoneConfig=zp(this.config.connectInZone),this.devtoolsExtension=e,this.createActionStreams()}notify(e,t){if(this.devtoolsExtension)if(e.type===ji){if(t.isLocked||t.isPaused)return;let n=Rp(t);if(Fp(this.config)&&Za(n,e,this.config.predicate,this.config.actionsSafelist,this.config.actionsBlocklist))return;let r=this.config.stateSanitizer?Lp(this.config.stateSanitizer,n,t.currentStateIndex):n,a=this.config.actionSanitizer?Np(this.config.actionSanitizer,e,t.nextActionId):e;this.sendToReduxDevtools(()=>this.extensionConnection.send(a,r))}else{let n=Q(k({},t),{stagedActionIds:t.stagedActionIds,actionsById:this.config.actionSanitizer?M0(this.config.actionSanitizer,t.actionsById):t.actionsById,computedStates:this.config.stateSanitizer?P0(this.config.stateSanitizer,t.computedStates):t.computedStates});this.sendToReduxDevtools(()=>this.devtoolsExtension.send(null,n,this.getExtensionConfig(this.config)))}}createChangesObservable(){return this.devtoolsExtension?new Ue(e=>{let t=this.zoneConfig.connectInZone?this.zoneConfig.ngZone.runOutsideAngular(()=>this.devtoolsExtension.connect(this.getExtensionConfig(this.config))):this.devtoolsExtension.connect(this.getExtensionConfig(this.config));return this.extensionConnection=t,t.init(),t.subscribe(n=>e.next(n)),t.unsubscribe}):as}createActionStreams(){let e=this.createChangesObservable().pipe(hs()),t=e.pipe(Ee(g=>g.type===_r.START)),n=e.pipe(Ee(g=>g.type===_r.STOP)),r=e.pipe(Ee(g=>g.type===_r.DISPATCH),de(g=>this.unwrapAction(g.payload)),Pr(g=>g.type===Qa?this.dispatcher.pipe(Ee(_=>_.type===Br),ls(1e3),On(1e3),de(()=>g),Pe(()=>Ce(g)),kn(1)):Ce(g))),l=e.pipe(Ee(g=>g.type===_r.ACTION),de(g=>this.unwrapAction(g.payload))).pipe(L(n)),u=r.pipe(L(n));this.start$=t.pipe(L(n)),this.actions$=this.start$.pipe(Ne(()=>l)),this.liftedActions$=this.start$.pipe(Ne(()=>u))}unwrapAction(e){return typeof e=="string"?(0,eval)(`(${e})`):e}getExtensionConfig(e){let t={name:e.name,features:e.features,serialize:e.serialize,autoPause:e.autoPause??!1,trace:e.trace??!1,traceLimit:e.traceLimit??75};return e.maxAge!==!1&&(t.maxAge=e.maxAge),t}sendToReduxDevtools(e){try{e()}catch(t){console.warn("@ngrx/store-devtools: something went wrong inside the redux devtools",t)}}static{this.\u0275fac=function(t){return new(t||o)(O(qa),O(Cr),O(yr))}}static{this.\u0275prov=I({token:o,factory:o.\u0275fac})}}return o})(),br={type:zr},O0="@ngrx/store-devtools/recompute",k0={type:O0};function Vp(o,i,e,t,n){if(t)return{state:e,error:"Interrupted by an error up the chain"};let r=e,a;try{r=o(e,i)}catch(l){a=l.toString(),n.handleError(l)}return{state:r,error:a}}function vr(o,i,e,t,n,r,a,l,u){if(i>=o.length&&o.length===r.length)return o;let g=o.slice(0,i),_=r.length-(u?1:0);for(let f=i;f<_;f++){let S=r[f],T=n[S].action,w=g[f-1],M=w?w.state:t,z=w?w.error:void 0,oe=a.indexOf(S)>-1?w:Vp(e,T,M,z,l);g.push(oe)}return u&&g.push(o[o.length-1]),g}function I0(o,i){return{monitorState:i(void 0,{}),nextActionId:1,actionsById:{0:$i(br)},stagedActionIds:[0],skippedActionIds:[],committedState:o,currentStateIndex:0,computedStates:[],isLocked:!1,isPaused:!1}}function D0(o,i,e,t,n={}){return r=>(a,l)=>{let{monitorState:u,actionsById:g,nextActionId:_,stagedActionIds:f,skippedActionIds:S,committedState:T,currentStateIndex:w,computedStates:M,isLocked:z,isPaused:q}=a||i;a||(g=Object.create(g));function oe(se){let te=se,ye=f.slice(1,te+1);for(let ve=0;ve<ye.length;ve++)if(M[ve+1].error){te=ve,ye=f.slice(1,te+1);break}else delete g[ye[ve]];S=S.filter(ve=>ye.indexOf(ve)===-1),f=[0,...f.slice(te+1)],T=M[te].state,M=M.slice(te),w=w>te?w-te:0}function le(){g={0:$i(br)},_=1,f=[0],S=[],T=M[w].state,w=0,M=[]}let W=0;switch(l.type){case Ip:{z=l.status,W=1/0;break}case Dp:{q=l.status,q?(f=[...f,_],g[_]=new ui({type:"@ngrx/devtools/pause"},+Date.now()),_++,W=f.length-1,M=M.concat(M[M.length-1]),w===f.length-2&&w++,W=1/0):le();break}case xp:{g={0:$i(br)},_=1,f=[0],S=[],T=o,w=0,M=[];break}case Mp:{le();break}case Sp:{g={0:$i(br)},_=1,f=[0],S=[],w=0,M=[];break}case Tp:{let{id:se}=l;S.indexOf(se)===-1?S=[se,...S]:S=S.filter(ye=>ye!==se),W=f.indexOf(se);break}case w0:{let{start:se,end:te,active:ye}=l,ve=[];for(let Et=se;Et<te;Et++)ve.push(Et);ye?S=Cp(S,ve):S=[...S,...ve],W=f.indexOf(se);break}case Op:{w=l.index,W=1/0;break}case kp:{let se=f.indexOf(l.actionId);se!==-1&&(w=se),W=1/0;break}case Pp:{f=Cp(f,S),S=[],w=Math.min(w,f.length-1);break}case ji:{if(z)return a||i;if(q||a&&Za(a.computedStates[w],l,n.predicate,n.actionsSafelist,n.actionsBlocklist)){let te=M[M.length-1];M=[...M.slice(0,-1),Vp(r,l.action,te.state,te.error,e)],W=1/0;break}n.maxAge&&f.length===n.maxAge&&oe(1),w===f.length-1&&w++;let se=_++;g[se]=l,f=[...f,se],W=f.length-1;break}case Qa:{({monitorState:u,actionsById:g,nextActionId:_,stagedActionIds:f,skippedActionIds:S,committedState:T,currentStateIndex:w,computedStates:M,isLocked:z,isPaused:q}=l.nextLiftedState);break}case zr:{W=0,n.maxAge&&f.length>n.maxAge&&(M=vr(M,W,r,T,g,f,S,e,q),oe(f.length-n.maxAge),W=1/0);break}case Br:{if(M.filter(te=>te.error).length>0)W=0,n.maxAge&&f.length>n.maxAge&&(M=vr(M,W,r,T,g,f,S,e,q),oe(f.length-n.maxAge),W=1/0);else{if(!q&&!z){w===f.length-1&&w++;let te=_++;g[te]=new ui(l,+Date.now()),f=[...f,te],W=f.length-1,M=vr(M,W,r,T,g,f,S,e,q)}M=M.map(te=>Q(k({},te),{state:r(te.state,k0)})),w=f.length-1,n.maxAge&&f.length>n.maxAge&&oe(f.length-n.maxAge),W=1/0}break}default:{W=1/0;break}}return M=vr(M,W,r,T,g,f,S,e,q),u=t(u,l),{monitorState:u,actionsById:g,nextActionId:_,stagedActionIds:f,skippedActionIds:S,committedState:T,currentStateIndex:w,computedStates:M,isLocked:z,isPaused:q}}}var Ep=(()=>{class o{constructor(e,t,n,r,a,l,u,g){let _=I0(u,g.monitor),f=D0(u,_,l,g.monitor,g),S=$t($t(t.asObservable().pipe(fs(1)),r.actions$).pipe(de($i)),e,r.liftedActions$).pipe(ss(os)),T=n.pipe(de(f)),w=zp(g.connectInZone),M=new is(1);this.liftedStateSubscription=S.pipe(vs(T),wp(w),us(({state:oe},[le,W])=>{let se=W(oe,le);return le.type!==ji&&Fp(g)&&(se=T0(se,g.predicate,g.actionsSafelist,g.actionsBlocklist)),r.notify(le,se),{state:se,action:le}},{state:_,action:null})).subscribe(({state:oe,action:le})=>{if(M.next(oe),le.type===ji){let W=le.action;a.next(W)}}),this.extensionStartSubscription=r.start$.pipe(wp(w)).subscribe(()=>{this.refresh()});let z=M.asObservable(),q=z.pipe(de(Rp));Object.defineProperty(q,"state",{value:lc(q,{manualCleanup:!0,requireSync:!0})}),this.dispatcher=e,this.liftedState=z,this.state=q}ngOnDestroy(){this.liftedStateSubscription.unsubscribe(),this.extensionStartSubscription.unsubscribe()}dispatch(e){this.dispatcher.next(e)}next(e){this.dispatcher.next(e)}error(e){}complete(){}performAction(e){this.dispatch(new ui(e,+Date.now()))}refresh(){this.dispatch(new Fa)}reset(){this.dispatch(new za(+Date.now()))}rollback(){this.dispatch(new Ba(+Date.now()))}commit(){this.dispatch(new Va(+Date.now()))}sweep(){this.dispatch(new $a)}toggleAction(e){this.dispatch(new ja(e))}jumpToAction(e){this.dispatch(new Ga(e))}jumpToState(e){this.dispatch(new Ua(e))}importState(e){this.dispatch(new Ha(e))}lockChanges(e){this.dispatch(new Wa(e))}pauseRecording(e){this.dispatch(new Ka(e))}static{this.\u0275fac=function(t){return new(t||o)(O(yr),O(To),O(gc),O(Bp),O(Oo),O(Ki),O(dc),O(Cr))}}static{this.\u0275prov=I({token:o,factory:o.\u0275fac})}}return o})();function wp({ngZone:o,connectInZone:i}){return e=>i?new Ue(t=>e.subscribe({next:n=>o.run(()=>t.next(n)),error:n=>o.run(()=>t.error(n)),complete:()=>o.run(()=>t.complete())})):e}var A0=new Le("@ngrx/store-devtools Is Devtools Extension or Monitor Present");function R0(o,i){return!!o||i.monitor!==Ap}function N0(){let o="__REDUX_DEVTOOLS_EXTENSION__";return typeof window=="object"&&typeof window[o]<"u"?window[o]:null}function L0(o){return o.state}function $p(o={}){return Wi([Bp,yr,Ep,{provide:bp,useValue:o},{provide:A0,deps:[qa,Cr],useFactory:R0},{provide:qa,useFactory:N0},{provide:Cr,deps:[bp],useFactory:S0},{provide:hc,deps:[Ep],useFactory:L0},{provide:uc,useExisting:yr}])}var F0={dispatch:!0,functional:!1,useEffectsErrorHandler:!0},Er="__@ngrx/effects_create__";function xn(o,i={}){let e=i.functional?o:o(),t=k(k({},F0),i);return Object.defineProperty(e,Er,{value:t}),e}function z0(o){return Object.getOwnPropertyNames(o).filter(t=>o[t]&&o[t].hasOwnProperty(Er)?o[t][Er].hasOwnProperty("dispatch"):!1).map(t=>{let n=o[t][Er];return k({propertyName:t},n)})}function B0(o){return z0(o)}function jp(o){return Object.getPrototypeOf(o)}function V0(o){return!!o.constructor&&o.constructor.name!=="Object"&&o.constructor.name!=="Function"}function Up(o){return typeof o=="function"}function $0(o){return o.filter(Up)}function j0(o,i,e){let t=jp(o),r=!!t&&t.constructor.name!=="Object"?t.constructor.name:null,a=B0(o).map(({propertyName:l,dispatch:u,useEffectsErrorHandler:g})=>{let _=typeof o[l]=="function"?o[l]():o[l],f=g?e(_,i):_;return u===!1?f.pipe(ds()):f.pipe(gs()).pipe(de(T=>({effect:o[l],notification:T,propertyName:l,sourceName:r,sourceInstance:o})))});return $t(...a)}var U0=10;function Gp(o,i,e=U0){return o.pipe(Pe(t=>(i&&i.handleError(t),e<=1?o:Gp(o,i,e-1))))}var Hp=(()=>{class o extends Ue{constructor(e){super(),e&&(this.source=e)}lift(e){let t=new o;return t.source=this,t.operator=e,t}static{this.\u0275fac=function(t){return new(t||o)(O(Oo))}}static{this.\u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();function Sn(...o){return Ee(i=>o.some(e=>typeof e=="string"?e===i.type:e.type===i.type))}var b1=new Le("@ngrx/effects Internal Root Guard"),C1=new Le("@ngrx/effects User Provided Effects"),y1=new Le("@ngrx/effects Internal Root Effects"),E1=new Le("@ngrx/effects Internal Root Effects Instances"),w1=new Le("@ngrx/effects Internal Feature Effects"),x1=new Le("@ngrx/effects Internal Feature Effects Instance Groups"),G0=new Le("@ngrx/effects Effects Error Handler",{providedIn:"root",factory:()=>Gp}),H0="@ngrx/effects/init",W0=X(H0);function K0(o,i){if(o.notification.kind==="N"){let e=o.notification.value;!q0(e)&&i.handleError(new Error(`Effect ${Q0(o)} dispatched an invalid action: ${Z0(e)}`))}}function q0(o){return typeof o!="function"&&o&&o.type&&typeof o.type=="string"}function Q0({propertyName:o,sourceInstance:i,sourceName:e}){let t=typeof i[o]=="function";return!!e?`"${e}.${String(o)}${t?"()":""}"`:`"${String(o)}()"`}function Z0(o){try{return JSON.stringify(o)}catch{return o}}var Y0="ngrxOnIdentifyEffects";function X0(o){return Ya(o,Y0)}var J0="ngrxOnRunEffects";function e_(o){return Ya(o,J0)}var t_="ngrxOnInitEffects";function n_(o){return Ya(o,t_)}function Ya(o,i){return o&&i in o&&typeof o[i]=="function"}var Wp=(()=>{class o extends N{constructor(e,t){super(),this.errorHandler=e,this.effectsErrorHandler=t}addEffects(e){this.next(e)}toActions(){return this.pipe(Tr(e=>V0(e)?jp(e):e),Mr(e=>e.pipe(Tr(i_))),Mr(e=>{let t=e.pipe(ms(r=>o_(this.errorHandler,this.effectsErrorHandler)(r)),de(r=>(K0(r,this.errorHandler),r.notification)),Ee(r=>r.kind==="N"&&r.value!=null),ps()),n=e.pipe(kn(1),Ee(n_),de(r=>r.ngrxOnInitEffects()));return $t(t,n)}))}static{this.\u0275fac=function(t){return new(t||o)(O(Ki),O(G0))}}static{this.\u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();function i_(o){return X0(o)?o.ngrxOnIdentifyEffects():""}function o_(o,i){return e=>{let t=j0(e,o,i);return e_(e)?e.ngrxOnRunEffects(t):t}}var r_=(()=>{class o{get isStarted(){return!!this.effectsSubscription}constructor(e,t){this.effectSources=e,this.store=t,this.effectsSubscription=null}start(){this.effectsSubscription||(this.effectsSubscription=this.effectSources.toActions().subscribe(this.store))}ngOnDestroy(){this.effectsSubscription&&(this.effectsSubscription.unsubscribe(),this.effectsSubscription=null)}static{this.\u0275fac=function(t){return new(t||o)(O(Wp),O(ko))}}static{this.\u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();function Kp(...o){let i=o.flat(),e=$0(i);return Wi([e,bs(()=>{P(pc),P(mc,{optional:!0});let t=P(r_),n=P(Wp),r=!t.isStarted;r&&t.start();for(let a of i){let l=Up(a)?P(a):a;n.addEffects(l)}r&&P(ko).dispatch(W0())})])}var qp={user:null,token:null,refreshToken:null,expiresIn:null,loading:!1,error:null},s_=Io(qp,_e(Do,o=>Q(k({},o),{loading:!0,error:null})),_e(Ti,(o,{user:i,token:e,refreshToken:t,expiresIn:n})=>Q(k({},o),{user:i,token:e,refreshToken:t,expiresIn:n,loading:!1,error:null})),_e(Oi,(o,{error:i})=>Q(k({},o),{loading:!1,error:i})),_e(Ao,o=>Q(k({},o),{loading:!0,error:null})),_e(_c,()=>k({},qp)),_e(vc,(o,{error:i})=>Q(k({},o),{loading:!1,error:i})),_e(Ro,o=>Q(k({},o),{loading:!0,error:null})),_e(ki,(o,{token:i,refreshToken:e,expiresIn:t})=>Q(k({},o),{token:i,refreshToken:e,expiresIn:t,loading:!1,error:null})),_e(No,(o,{error:i})=>Q(k({},o),{loading:!1,error:i}))),Qp=s_;var Zp=X("[Network] Load FDPs"),Yp=X("[Network] Load FDPs Success",fe()),Xp=X("[Network] Load FDPs Failure",fe()),Jp=X("[Network] Load OLTs"),em=X("[Network] Load OLTs Success",fe()),tm=X("[Network] Load OLTs Failure",fe()),k1=X("[Network] Load ONTs"),I1=X("[Network] Load ONTs Success",fe()),D1=X("[Network] Load ONTs Failure",fe()),A1=X("[Network] Load EDFAs"),R1=X("[Network] Load EDFAs Success",fe()),N1=X("[Network] Load EDFAs Failure",fe()),L1=X("[Network] Load Splitters"),F1=X("[Network] Load Splitters Success",fe()),z1=X("[Network] Load Splitters Failure",fe()),B1=X("[Network] Load Mangas"),V1=X("[Network] Load Mangas Success",fe()),$1=X("[Network] Load Mangas Failure",fe()),nm=X("[Network] Load Fiber Connections"),im=X("[Network] Load Fiber Connections Success",fe()),om=X("[Network] Load Fiber Connections Failure",fe()),rm=X("[Network] Select Network Element",fe()),am=X("[Network] Simulate Failure",fe()),sm=X("[Network] Simulate Failure Success"),lm=X("[Network] Simulate Failure Failure",fe()),cm=X("[Network] Load Alerts",fe()),dm=X("[Network] Load Alerts Success",fe()),pm=X("[Network] Load Alerts Failure",fe()),j1=X("[Network] Acknowledge Alert",fe()),U1=X("[Network] Acknowledge Alert Success",fe()),G1=X("[Network] Acknowledge Alert Failure",fe()),H1=X("[Network] Resolve Alert",fe()),W1=X("[Network] Resolve Alert Success",fe()),K1=X("[Network] Resolve Alert Failure",fe());var d_={fdps:[],olts:[],onts:[],edfas:[],splitters:[],mangas:[],fiberConnections:[],alerts:[],selectedElementType:null,selectedElementId:null,loading:!1,error:null},mm=Io(d_,_e(Zp,o=>Q(k({},o),{loading:!0,error:null})),_e(Yp,(o,{fdps:i})=>Q(k({},o),{fdps:i,loading:!1,error:null})),_e(Xp,(o,{error:i})=>Q(k({},o),{loading:!1,error:i})),_e(Jp,o=>Q(k({},o),{loading:!0,error:null})),_e(em,(o,{olts:i})=>Q(k({},o),{olts:i,loading:!1,error:null})),_e(tm,(o,{error:i})=>Q(k({},o),{loading:!1,error:i})),_e(nm,o=>Q(k({},o),{loading:!0,error:null})),_e(im,(o,{fiberConnections:i})=>Q(k({},o),{fiberConnections:i,loading:!1,error:null})),_e(om,(o,{error:i})=>Q(k({},o),{loading:!1,error:i})),_e(rm,(o,{elementType:i,elementId:e})=>Q(k({},o),{selectedElementType:i,selectedElementId:e})),_e(am,o=>Q(k({},o),{loading:!0,error:null})),_e(sm,o=>Q(k({},o),{loading:!1,error:null})),_e(lm,(o,{error:i})=>Q(k({},o),{loading:!1,error:i})),_e(cm,o=>Q(k({},o),{loading:!0,error:null})),_e(dm,(o,{alerts:i})=>Q(k({},o),{alerts:i,loading:!1,error:null})),_e(pm,(o,{error:i})=>Q(k({},o),{loading:!1,error:i})));var gm=(()=>{class o{constructor(){this.actions$=P(Hp),this.authService=P(tt),this.router=P(Oe),this.TOKEN_KEY="auth_token",this.REFRESH_TOKEN_KEY="refresh_token",this.USER_KEY="auth_user",this.EXPIRES_IN_KEY="expires_in",this.login$=xn(()=>this.actions$.pipe(Sn(Do),Ne(e=>this.authService.login(e.email,e.password).pipe(de(t=>{if(console.log("Login response in effect:",t),!t||!t.user||!t.token||!t.refreshToken||!t.expiresIn)throw new Error("Respuesta de login inv\xE1lida");return Ti({user:t.user,token:t.token,refreshToken:t.refreshToken,expiresIn:t.expiresIn})}),Pe(t=>(console.error("Login error:",t),Ce(Oi({error:t.message||"Error al iniciar sesi\xF3n"})))),fi(()=>{console.log("Login effect completed")}))))),this.loginSuccess$=xn(()=>this.actions$.pipe(Sn(Ti),hi(100),Te(e=>{try{if(console.log("Login success action:",e),!e.expiresIn)throw new Error("expiresIn es undefined");localStorage.setItem(this.TOKEN_KEY,e.token),localStorage.setItem(this.REFRESH_TOKEN_KEY,e.refreshToken),localStorage.setItem(this.USER_KEY,JSON.stringify(e.user)),localStorage.setItem(this.EXPIRES_IN_KEY,e.expiresIn.toString()),console.log("Navegando al dashboard..."),this.router.navigate(["/dashboard"])}catch(t){console.error("Error storing auth data:",t)}})),{dispatch:!1}),this.loginFailure$=xn(()=>this.actions$.pipe(Sn(Oi),Te(e=>{console.error("Login failed:",e.error)})),{dispatch:!1}),this.logout$=xn(()=>this.actions$.pipe(Sn(Ao),Te(()=>{try{this.authService.logout(),this.router.navigate(["/auth/login"])}catch(e){console.error("Error during logout:",e)}})),{dispatch:!1}),this.refreshToken$=xn(()=>this.actions$.pipe(Sn(Ro),Ne(()=>this.authService.refreshToken().pipe(de(e=>ki({token:e.token,refreshToken:e.refreshToken,expiresIn:e.expiresIn})),Pe(e=>(console.error("Token refresh error:",e),Ce(No({error:e.message||"Error al actualizar el token"})))))))),this.refreshTokenSuccess$=xn(()=>this.actions$.pipe(Sn(ki),Te(e=>{try{localStorage.setItem(this.TOKEN_KEY,e.token),localStorage.setItem(this.REFRESH_TOKEN_KEY,e.refreshToken),localStorage.setItem(this.EXPIRES_IN_KEY,e.expiresIn.toString())}catch(t){console.error("Error storing refreshed token:",t)}})),{dispatch:!1})}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275prov=I({token:o,factory:o.\u0275fac})}}return o})();var um={auth:Qp,network:mm},aS=Se.production?[]:[],hm=[gm];var Mn=!1;function fm(o,i){return o.clone({setHeaders:{Authorization:`Bearer ${i}`}})}function m_(o,i,e,t){return!localStorage.getItem("refreshToken")||Mn?(Mn||(Mn=!0,e.logout(),t.navigate(["/auth/login"]),Mn=!1),lt(()=>new Error("Sesi\xF3n expirada o refresh en curso"))):(Mn=!0,e.refreshToken().pipe(Ne(r=>(Mn=!1,localStorage.setItem("token",r.token),localStorage.setItem("refreshToken",r.refreshToken),i(fm(o,r.token)))),Pe(r=>(Mn=!1,e.logout(),t.navigate(["/auth/login"]),lt(()=>r)))))}function _m(o,i){let e=P(tt),t=P(Oe),n=localStorage.getItem("token"),r=o;return n&&(r=fm(o,n)),i(r).pipe(Pe(a=>a instanceof $s&&a.status===401?m_(r,i,e,t):lt(()=>a)))}function vm(o,i){let e=P(qe);return i(o).pipe(Pe(t=>{let n="Ocurri\xF3 un error inesperado";if(t.error instanceof ErrorEvent)n=`Error: ${t.error.message}`;else switch(t.status){case 400:n="Solicitud incorrecta";break;case 401:return lt(()=>t);case 403:n="No tiene permisos para realizar esta acci\xF3n";break;case 404:n="Recurso no encontrado";break;case 409:n="Conflicto con el estado actual del recurso";break;case 422:n="Datos de entrada inv\xE1lidos";break;case 500:n="Error interno del servidor";break;default:n=`Error ${t.status}: ${t.message}`}return e.open(n,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]}),lt(()=>t)}))}var bm=(()=>{class o{constructor(e){this.http=e}getCurrentUser(){return this.http.get(`${Se.apiUrl}/users/me`)}updateUser(e,t){return this.http.patch(`${Se.apiUrl}/users/${e}`,t)}changePassword(e,t){return this.http.post(`${Se.apiUrl}/users/change-password`,{oldPassword:e,newPassword:t})}updatePreferences(e,t){return this.http.patch(`${Se.apiUrl}/users/${e}/preferences`,t)}static{this.\u0275fac=function(t){return new(t||o)(O(Rt))}}static{this.\u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var Cm=(()=>{class o{constructor(e){this.http=e,this.alertsSubject=new ge([]),this.alerts$=this.alertsSubject.asObservable(),Tn(15e3).pipe(Ne(()=>this.getActiveAlerts())).subscribe()}getActiveAlerts(){return this.http.get(`${Se.apiUrl}/alerts/active`).pipe(Te(e=>this.alertsSubject.next(e)))}getAlertHistory(e,t){let n={startDate:e.toISOString(),endDate:t.toISOString()};return this.http.get(`${Se.apiUrl}/alerts/history`,{params:n})}acknowledgeAlert(e){return this.http.patch(`${Se.apiUrl}/alerts/${e}/acknowledge`,{})}resolveAlert(e){return this.http.patch(`${Se.apiUrl}/alerts/${e}/resolve`,{})}getAlertStats(){return this.http.get(`${Se.apiUrl}/alerts/stats`)}static{this.\u0275fac=function(t){return new(t||o)(O(Rt))}}static{this.\u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var ym=(()=>{class o{constructor(e){this.http=e,this.metricsSubject=new ge([]),this.metrics$=this.metricsSubject.asObservable(),Tn(3e4).pipe(Ne(()=>this.getNetworkMetrics())).subscribe()}getNetworkMetrics(){return this.http.get(`${Se.apiUrl}/monitoring/metrics`).pipe(Te(e=>this.metricsSubject.next(e)))}getElementMetrics(e){return this.http.get(`${Se.apiUrl}/monitoring/elements/${e}/metrics`)}getHistoricalMetrics(e,t,n){let r={startDate:t.toISOString(),endDate:n.toISOString()};return this.http.get(`${Se.apiUrl}/monitoring/elements/${e}/history`,{params:r})}static{this.\u0275fac=function(t){return new(t||o)(O(Rt))}}static{this.\u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var Em=(()=>{class o{constructor(e){this.http=e}getReports(){return this.http.get(`${Se.apiUrl}/reports`)}getReport(e){return this.http.get(`${Se.apiUrl}/reports/${e}`)}generateReport(e){return this.http.post(`${Se.apiUrl}/reports/generate`,e)}downloadReport(e){return this.http.get(`${Se.apiUrl}/reports/${e}/download`,{responseType:"blob"})}deleteReport(e){return this.http.delete(`${Se.apiUrl}/reports/${e}`)}static{this.\u0275fac=function(t){return new(t||o)(O(Rt))}}static{this.\u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var wm=(()=>{class o{constructor(e,t,n,r,a,l){this.networkStateService=e,this.eventBus=t,this.layerManager=n,this.elementService=r,this.dialog=a,this.logger=l,this.destroy$=new N;let u=this.networkStateService.getCurrentState();this.zoomLevel$=this.networkStateService.state$.pipe(de(g=>g.zoomLevel),mt()),this.isDarkMode$=this.networkStateService.state$.pipe(de(g=>g.isDarkMode),mt()),this.currentTool$=this.networkStateService.state$.pipe(de(g=>g.currentTool),mt()),this.selectedElement$=this.networkStateService.state$.pipe(de(g=>g.selectedElement),mt()),this.selectedConnection$=this.networkStateService.state$.pipe(de(g=>g.selectedConnection),mt()),this.showSearchWidget$=this.networkStateService.showSearchWidget,this.showElementsPanel$=this.networkStateService.showElementsPanel,this.activeLayers$=new ge(Array.from(u.activeLayers)),this.layerManager.getActiveLayers().pipe(L(this.destroy$)).subscribe(g=>{this.activeLayers$.next(g)}),this.subscribeToEvents()}subscribeToEvents(){this.eventBus.on(zt.ELEMENT_SELECTED).pipe(L(this.destroy$)).subscribe(e=>{this.networkStateService.updateSelectedElement(e.payload?.element)}),this.eventBus.on(zt.CONNECTION_SELECTED).pipe(L(this.destroy$)).subscribe(e=>{this.networkStateService.setSelectedConnection(e.payload?.connection)}),this.eventBus.on(zt.ZOOM_CHANGED).pipe(L(this.destroy$)).subscribe(e=>{this.networkStateService.setZoomLevel(e.payload?.level)})}setZoomLevel(e){this.networkStateService.setZoomLevel(e),this.eventBus.emit({type:zt.ZOOM_CHANGED,timestamp:new Date,payload:{level:e}})}selectElement(e){e?this.eventBus.emitElementSelected(e):this.networkStateService.updateSelectedElement(null)}selectConnection(e){e?this.eventBus.emitConnectionSelected(e):this.networkStateService.setSelectedConnection(null)}toggleLayer(e){this.layerManager.toggleLayer(e)}toggleCustomLayer(e){this.networkStateService.toggleCustomLayer(e)}setCurrentTool(e){let t=this.networkStateService.getCurrentState().currentTool;this.networkStateService.setCurrentTool(e),this.eventBus.emit({type:zt.VIEW_MODE_CHANGED,timestamp:new Date,payload:{tool:e,previousTool:t}})}completeMeasurement(e){this.eventBus.emit({type:zt.WIDGET_ACTION,timestamp:new Date,payload:{action:"measurement_completed",sourceElement:e.sourceElement,targetElement:e.targetElement,distance:e.distance}}),this.networkStateService.addToHistory({action:`Medici\xF3n: ${e.sourceElement.name} \u2192 ${e.targetElement.name}: ${e.distance.toFixed(2)}m`,timestamp:new Date})}createConnection(e){this.networkStateService.setIsDirty(!0),this.eventBus.emit({type:zt.CONNECTION_CREATED,timestamp:new Date,payload:{connection:e}}),this.networkStateService.addToHistory({action:`Conexi\xF3n creada: ${e.sourceElementId} \u2192 ${e.targetElementId}`,timestamp:new Date})}toggleSearchWidget(e){this.networkStateService.showSearchWidget.pipe(L(this.destroy$)).subscribe(t=>{let n=e!==void 0?e:!t;this.networkStateService.setShowSearchWidget(n),this.eventBus.emit({type:zt.WIDGET_ACTION,timestamp:new Date,payload:{component:"searchWidget",visible:n}})})}toggleElementsPanel(e){this.networkStateService.showElementsPanel.pipe(L(this.destroy$)).subscribe(t=>{let n=e!==void 0?e:!t;this.networkStateService.setShowElementsPanel(n),this.eventBus.emit({type:zt.WIDGET_ACTION,timestamp:new Date,payload:{component:"elementsPanel",visible:n}})})}destroy(){this.destroy$.next(),this.destroy$.complete(),this.logger.debug("MapFacadeService destruido")}static{this.\u0275fac=function(t){return new(t||o)(O(Ie),O(So),O(sn),O(Ft),O(nt),O(K))}}static{this.\u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var It=function(o){return o.LAYER_MANAGER="layerManager",o.ELEMENT_CREATOR="elementCreator",o.CONNECTION_CREATOR="connectionCreator",o.ELEMENT_DETAILS="elementDetails",o.SETTINGS="settings",o.MAP_MENU="mapMenu",o}(It||{}),xm=(()=>{class o{constructor(e){this.logger=e,this.layerManagerVisible=new ge(!1),this.elementCreatorVisible=new ge(!1),this.connectionCreatorVisible=new ge(!1),this.elementDetailsVisible=new ge(!1),this.settingsVisible=new ge(!1),this.layerManager$=this.layerManagerVisible.asObservable(),this.elementCreator$=this.elementCreatorVisible.asObservable(),this.connectionCreator$=this.connectionCreatorVisible.asObservable(),this.elementDetails$=this.elementDetailsVisible.asObservable(),this.settings$=this.settingsVisible.asObservable()}togglePanel(e,t,n=!0){let r=t!==void 0?t:!this.getPanelState(e);n&&r&&this.closeAllPanels(),this.setPanelState(e,r),this.logger.debug(`Panel ${e} ${r?"mostrado":"ocultado"}`)}closeAllPanels(){this.layerManagerVisible.next(!1),this.elementCreatorVisible.next(!1),this.connectionCreatorVisible.next(!1),this.elementDetailsVisible.next(!1),this.settingsVisible.next(!1),this.logger.debug("Todos los paneles cerrados")}isPanelVisible(e){return this.getPanelState(e)}getPanelState(e){switch(e){case It.LAYER_MANAGER:return this.layerManagerVisible.value;case It.ELEMENT_CREATOR:return this.elementCreatorVisible.value;case It.CONNECTION_CREATOR:return this.connectionCreatorVisible.value;case It.ELEMENT_DETAILS:return this.elementDetailsVisible.value;case It.SETTINGS:return this.settingsVisible.value;default:return!1}}setPanelState(e,t){switch(e){case It.LAYER_MANAGER:this.layerManagerVisible.next(t);break;case It.ELEMENT_CREATOR:this.elementCreatorVisible.next(t);break;case It.CONNECTION_CREATOR:this.connectionCreatorVisible.next(t);break;case It.ELEMENT_DETAILS:this.elementDetailsVisible.next(t);break;case It.SETTINGS:this.settingsVisible.next(t);break}}static{this.\u0275fac=function(t){return new(t||o)(O(K))}}static{this.\u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var Sm=(()=>{class o{constructor(e){this.keyboardShortcutsService=e,this.zoomIn$=new N,this.zoomOut$=new N,this.zoomReset$=new N,this.fitScreen$=new N,this.panMode$=new N,this.selectMode$=new N,this.delete$=new N,this.setupShortcutListeners()}ngOnDestroy(){this.zoomIn$.complete(),this.zoomOut$.complete(),this.zoomReset$.complete(),this.fitScreen$.complete(),this.panMode$.complete(),this.selectMode$.complete(),this.delete$.complete()}setupShortcutListeners(){document.addEventListener("app-shortcut",e=>{switch(e.detail?.id){case"zoom-in":this.zoomIn$.next();break;case"zoom-out":this.zoomOut$.next();break;case"zoom-reset":this.zoomReset$.next();break;case"fit-screen":this.fitScreen$.next();break;case"pan-mode":this.panMode$.next();break;case"select-mode":this.selectMode$.next();break;case"delete":this.delete$.next();break}})}get onZoomIn(){return this.zoomIn$.asObservable()}get onZoomOut(){return this.zoomOut$.asObservable()}get onZoomReset(){return this.zoomReset$.asObservable()}get onFitScreen(){return this.fitScreen$.asObservable()}get onPanMode(){return this.panMode$.asObservable()}get onSelectMode(){return this.selectMode$.asObservable()}get onDelete(){return this.delete$.asObservable()}static{this.\u0275fac=function(t){return new(t||o)(O(ii))}}static{this.\u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var wr=(()=>{class o{get elements(){return this._elements.asReadonly()}get connections(){return this._connections.asReadonly()}get selectedElement(){return this._selectedElement.asReadonly()}get selectedConnection(){return this._selectedConnection.asReadonly()}get visibleElementTypes(){return this._visibleElementTypes.asReadonly()}get visibleCustomLayers(){return this._visibleCustomLayers.asReadonly()}get zoomLevel(){return this._zoomLevel.asReadonly()}get viewportBounds(){return this._viewportBounds.asReadonly()}get isDarkMode(){return this._isDarkMode.asReadonly()}get currentTool(){return this._currentTool.asReadonly()}get loading(){return this._loading.asReadonly()}get searchQuery(){return this._searchQuery.asReadonly()}constructor(e,t,n,r){this.networkStateService=e,this.elementService=t,this.connectionService=n,this.logger=r,this._elements=Ge([]),this._connections=Ge([]),this._selectedElement=Ge(null),this._selectedConnection=Ge(null),this._visibleElementTypes=Ge(new Set(Object.values(s))),this._visibleCustomLayers=Ge(new Set),this._zoomLevel=Ge(100),this._viewportBounds=Ge(null),this._isDarkMode=Ge(!1),this._currentTool=Ge("pan"),this._loading=Ge(!1),this._searchQuery=Ge(""),this.selectedElementSubject=new ge(null),this.selectedElement$=this.selectedElementSubject.asObservable(),this.selectedConnectionSubject=new ge(null),this.selectedConnection$=this.selectedConnectionSubject.asObservable(),this.elementsCountSubject=new ge(0),this.elementsCount$=this.elementsCountSubject.asObservable(),this.filteredElements=Zi(()=>{let a=this._elements(),l=this._visibleElementTypes(),u=this._searchQuery().toLowerCase();return a.filter(g=>!(!l.has(g.type)||u&&!(g.name?.toLowerCase().includes(u)||g.id?.toLowerCase().includes(u)||g.description?.toLowerCase().includes(u))))}),this.filteredConnections=Zi(()=>{let a=this._connections(),l=new Set(this.filteredElements().map(u=>u.id));return a.filter(u=>l.has(u.sourceElementId)&&l.has(u.targetElementId))}),this.statistics=Zi(()=>({totalElements:this._elements().length,visibleElements:this.filteredElements().length,totalConnections:this._connections().length,visibleConnections:this.filteredConnections().length})),this.state$=new ge({loading:!1,isDarkMode:!1,currentTool:"pan",visibleElementTypes:new Set}),this.initializeState(),Rn(()=>{this.networkStateService.updateDarkMode(this._isDarkMode())}),Rn(()=>{this.networkStateService.updateCurrentTool(this._currentTool())}),Rn(()=>{let a=Array.from(this._visibleElementTypes());this.networkStateService.updateActiveLayers(new Set(a))}),Rn(()=>{let a=this.filteredElements().length;this.elementsCountSubject.next(a)})}initializeState(){this._loading.set(!0),this.updateState(),this.elementService.getAllElements().subscribe({next:e=>{this._elements.set(e),this.logger.debug(`Cargados ${e.length} elementos`)},error:e=>{this.logger.error("Error al cargar elementos:",e),this._elements.set([])}}),this.connectionService.getConnections().subscribe({next:e=>{this._connections.set(e),this.logger.debug(`Cargadas ${e.length} conexiones`)},error:e=>{this.logger.error("Error al cargar conexiones:",e),this._connections.set([])},complete:()=>{this._loading.set(!1),this.updateState()}}),this.networkStateService.state$.subscribe(e=>{if(this._isDarkMode.set(e.isDarkMode),this._currentTool.set(e.currentTool),e.activeLayers instanceof Set)this._visibleElementTypes.set(e.activeLayers);else{let t=new Set(e.activeLayers);this._visibleElementTypes.set(t)}this.updateState()}),Rn(()=>{this.updateState()})}updateState(){this.state$.next({loading:this._loading(),isDarkMode:this._isDarkMode(),currentTool:this._currentTool(),visibleElementTypes:this._visibleElementTypes()})}selectElement(e){this._selectedElement.set(e),this.selectedElementSubject.next(e),e&&(this._selectedConnection.set(null),this.selectedConnectionSubject.next(null))}selectConnection(e){this._selectedConnection.set(e),this.selectedConnectionSubject.next(e),e&&(this._selectedElement.set(null),this.selectedElementSubject.next(null))}updateZoomLevel(e){this._zoomLevel.set(e)}updateViewportBounds(e){this._viewportBounds.set(e)}setCurrentTool(e){this._currentTool.set(e)}toggleElementType(e){this._visibleElementTypes.update(t=>{let n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})}toggleCustomLayer(e){this._visibleCustomLayers.update(t=>{let n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})}updateSearchQuery(e){this._searchQuery.set(e)}toggleDarkMode(){this._isDarkMode.update(e=>!e)}addElement(e){this._elements.update(t=>[...t,e])}updateElement(e){this._elements.update(t=>t.map(n=>n.id===e.id?e:n)),this._selectedElement()?.id===e.id&&this._selectedElement.set(e)}removeElement(e){this._elements.update(t=>t.filter(n=>n.id!==e)),this._selectedElement()?.id===e&&this._selectedElement.set(null),this._connections.update(t=>t.filter(n=>n.sourceElementId!==e&&n.targetElementId!==e))}addConnection(e){this._connections.update(t=>[...t,e])}updateConnection(e){this._connections.update(t=>t.map(n=>n.id===e.id?e:n)),this._selectedConnection()?.id===e.id&&this._selectedConnection.set(e)}removeConnection(e){this._connections.update(t=>t.filter(n=>n.id!==e)),this._selectedConnection()?.id===e&&this._selectedConnection.set(null)}updateVisibleElementTypes(e){this._visibleElementTypes.set(new Set(e)),this.updateState()}refreshMapData(){return this._loading.set(!0),this.updateState(),new Ue(e=>{cs([this.elementService.getAllElements(),this.connectionService.getConnections()]).subscribe({next:([t,n])=>{this._elements.set(t),this._connections.set(n),this._loading.set(!1),this.updateState(),e.next(!0),e.complete()},error:t=>{this.logger.error("Error al cargar datos del mapa",t),this._loading.set(!1),this.updateState(),e.error(t)}})})}getVisibleElements(e){let t=this.filteredElements();return e&&e>0&&e<t.length?t.slice(0,e):t}getVisibleConnections(e){let t=this.filteredConnections();return e&&e>0&&e<t.length?t.slice(0,e):t}static{this.\u0275fac=function(t){return new(t||o)(O(Ie),O(Ft),O(Co),O(K))}}static{this.\u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var Pm=(()=>{class o{constructor(e,t,n,r){this.mapRenderer=e,this.mapStateService=t,this.mapService=n,this.logger=r}setVisibleLayers(e){this.logger.debug("Actualizando capas visibles:",e),this.mapStateService.updateVisibleElementTypes(e)}setDarkMode(e){this.logger.debug(`Estableciendo modo oscuro: ${e}`),this.mapService.setDarkMode(e),this.mapRenderer.updateOptions({darkMode:e})}setActiveTool(e){this.logger.debug(`Estableciendo herramienta activa: ${e}`),this.mapStateService.setCurrentTool(e),this.mapService.setTool(e)}setZoomLevel(e){this.logger.debug(`Estableciendo nivel de zoom: ${e}`),this.mapService.setZoom(e),this.mapStateService.updateZoomLevel(e)}fitToScreen(){this.logger.debug("Ajustando vista para mostrar todos los elementos"),this.mapService.fitToScreen()}optimizeForHardware(e){this.logger.debug(`Optimizando para nivel de hardware: ${e}`);let t=this.mapService.getMap();t&&this.mapRenderer.optimizeForHardware(t,e)}toggleWebGL(e){let t=e!==void 0?e:!this.mapRenderer.getUseWebGL();this.logger.debug(`Configurando WebGL: ${t}`),this.mapRenderer.updateOptions({useWebGL:t}),this.mapRenderer.renderElements(this.mapStateService.filteredElements())}toggleProgressiveLoading(e){let t=e!==void 0?e:!this.mapRenderer.getProgressiveLoading();this.logger.debug(`Configurando carga progresiva: ${t}`),this.mapRenderer.updateOptions({progressiveLoading:t}),this.mapRenderer.renderElements(this.mapStateService.filteredElements())}toggleClustering(e){let t=e!==void 0?e:!this.mapRenderer.getClusteringEnabled();this.logger.debug(`Configurando clustering: ${t}`),this.mapRenderer.updateOptions({clusteringEnabled:t}),this.mapRenderer.renderElements(this.mapStateService.filteredElements())}static{this.\u0275fac=function(t){return new(t||o)(O(ei),O(wr),O(Bt),O(K))}}static{this.\u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var Tm=(()=>{class o{constructor(e,t,n){this.logger=e,this.mapRenderer=t,this.mapService=n,this._capabilities=null}detectCapabilities(){if(this._capabilities)return this._capabilities;let e={level:"medium",gpuAcceleration:this.hasGPUAcceleration(),memoryConstraints:this.hasMemoryConstraints(),isMobile:this.isMobileDevice(),webGLAvailable:this.isWebGLAvailable(),details:{cores:this.detectCPUCores(),ram:"Desconocido",gpu:this.detectGPU(),userAgent:navigator.userAgent}};return e.webGLAvailable&&(e.maxTextureSize=this.detectMaxTextureSize()),e.level=this.determineHardwareLevel(e),this._capabilities=e,e}getRecommendedPerformanceConfig(){let e=this.detectCapabilities();switch(e.level){case"low":return{maxVisibleElements:200,enableClustering:!0,clusterRadius:100,enableWebGL:!1,animationsEnabled:!1,useProgressiveLoading:!0,batchSize:25,processingDelay:100,useSimplifiedRendering:!0,preloadDistance:50,connectionsVisible:"limited",enableMiniMap:!1};case"medium":return{maxVisibleElements:1e3,enableClustering:!0,clusterRadius:80,enableWebGL:e.webGLAvailable,animationsEnabled:!0,useProgressiveLoading:!0,batchSize:50,processingDelay:50,useSimplifiedRendering:!1,preloadDistance:100,connectionsVisible:"visible",enableMiniMap:!0};case"high":return{maxVisibleElements:5e3,enableClustering:e.isMobile,clusterRadius:50,enableWebGL:e.webGLAvailable,animationsEnabled:!0,useProgressiveLoading:!1,batchSize:100,processingDelay:10,useSimplifiedRendering:!1,preloadDistance:200,connectionsVisible:"all",enableMiniMap:!0};default:return{maxVisibleElements:500,enableClustering:!0,enableWebGL:e.webGLAvailable&&!e.isMobile,useProgressiveLoading:!0}}}determineHardwareLevel(e){return e.isMobile?e.webGLAvailable&&e.gpuAcceleration?"medium":"low":e.memoryConstraints?"low":e.gpuAcceleration&&e.webGLAvailable&&e.details.cores>=4?"high":"medium"}hasMemoryConstraints(){return"deviceMemory"in navigator?navigator.deviceMemory<4:this.isMobileDevice()}hasGPUAcceleration(){let e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");if(!t)return!1;let n=t.getSupportedExtensions();return!!n&&n.length>20}isWebGLAvailable(){try{let e=document.createElement("canvas");return!!(window.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl")))}catch{return!1}}isMobileDevice(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}detectCPUCores(){return typeof navigator.hardwareConcurrency<"u"?navigator.hardwareConcurrency:2}detectGPU(){try{let e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");if(!t)return null;let n=t.getExtension("WEBGL_debug_renderer_info");if(n)return t.getParameter(n.UNMASKED_RENDERER_WEBGL)}catch{}return null}detectMaxTextureSize(){try{let e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");return t?t.getParameter(t.MAX_TEXTURE_SIZE):2048}catch{return 2048}}optimizeForHardware(){let e=this.determineHardwareLevel(this.detectCapabilities());this.logger.debug(`Nivel de hardware detectado: ${e}`);let t=this.mapService.getMap();t&&this.mapRenderer.optimizeForHardware(t,e),e==="low"&&this.reduceVisualEffects()}reduceVisualEffects(){document.body.classList.add("reduce-animations");let e=this.mapService.getMap();e&&(e.options.fadeAnimation=!1,e.options.markerZoomAnimation=!1,e.options.zoomAnimation=!1),this.mapRenderer.updateOptions({useWebGL:!1,progressiveLoading:!0,clusteringEnabled:!0})}static{this.\u0275fac=function(t){return new(t||o)(O(K),O(ei),O(Bt))}}static{this.\u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var Om=(()=>{class o{constructor(e){this.logger=e,this.worker=null,this.isWorkerSupported=!1,this.isWorkerSupported=typeof Worker<"u",this.isWorkerSupported?this.initWorker():this.logger.warn("Web Workers no est\xE1n soportados en este navegador. Los c\xE1lculos se realizar\xE1n en el hilo principal.")}initWorker(){try{let e=`
        self.addEventListener('message', function(e) {
          const { action, data } = e.data;
          
          switch (action) {
            case 'calculateNetworkMetrics':
              const result = calculateNetworkMetrics(data.elements, data.connections);
              self.postMessage({ action: 'networkMetrics', data: result });
              break;
            case 'findOptimalPath':
              const path = findOptimalPath(data.source, data.target, data.connections);
              self.postMessage({ action: 'optimalPath', data: path });
              break;
            case 'analyzeNetworkClusters':
              const clusters = analyzeNetworkClusters(data.elements, data.connections);
              self.postMessage({ action: 'networkClusters', data: clusters });
              break;
            default:
              self.postMessage({ action: 'error', data: 'Acci\xF3n desconocida' });
          }
        });
        
        // Implementaci\xF3n de algoritmos de c\xE1lculo
        
        function calculateNetworkMetrics(elements, connections) {
          const startTime = performance.now();
          
          // Calcular distancia total
          let totalDistance = 0;
          for (const conn of connections) {
            if (conn.distance) {
              totalDistance += conn.distance;
            }
          }
          
          // Calcular conexiones promedio por elemento
          const averageConnections = connections.length / (elements.length || 1);
          
          // Calcular densidad de red (conexiones / conexiones posibles)
          const maxPossibleConnections = (elements.length * (elements.length - 1)) / 2;
          const networkDensity = connections.length / (maxPossibleConnections || 1);
          
          // Encontrar elementos centrales (con m\xE1s conexiones)
          const elementConnections = {};
          for (const conn of connections) {
            elementConnections[conn.sourceId] = (elementConnections[conn.sourceId] || 0) + 1;
            elementConnections[conn.targetId] = (elementConnections[conn.targetId] || 0) + 1;
          }
          
          // Ordenar elementos por n\xFAmero de conexiones
          const sortedElements = Object.entries(elementConnections)
            .sort((a, b) => b[1] - a[1])
            .slice(0, 5)
            .map(entry => entry[0]);
          
          // Calcular clusters b\xE1sicos
          const clusters = calculateBasicClusters(elements, connections);
          
          const endTime = performance.now();
          const calculationTime = endTime - startTime;
          
          // Determinar complejidad
          let complexity = 'low';
          if (elements.length > 500 || connections.length > 1000) {
            complexity = 'high';
          } else if (elements.length > 100 || connections.length > 200) {
            complexity = 'medium';
          }
          
          return {
            totalDistance,
            averageConnections,
            networkDensity,
            centralElements: sortedElements,
            clusters,
            performanceIndicators: {
              calculationTime,
              complexity
            }
          };
        }
        
        function findOptimalPath(sourceId, targetId, connections) {
          // Implementaci\xF3n simplificada de Dijkstra
          // Para una implementaci\xF3n completa se necesitar\xEDa m\xE1s c\xF3digo
          
          // Este es un algoritmo indicativo
          return { path: [], distance: 0 };
        }
        
        function analyzeNetworkClusters(elements, connections) {
          return calculateBasicClusters(elements, connections);
        }
        
        function calculateBasicClusters(elements, connections) {
          // Implementaci\xF3n b\xE1sica de clustering basado en proximidad
          // Este es un algoritmo indicativo
          return [];
        }
      `,t=new Blob([e],{type:"application/javascript"});this.worker=new Worker(URL.createObjectURL(t)),this.logger.debug("Web Worker inicializado para c\xE1lculos de red")}catch(e){this.isWorkerSupported=!1,this.logger.error("Error al inicializar Web Worker:",e)}}calculateNetworkMetrics(e,t){return!this.isWorkerSupported||!this.worker?this.calculateMetricsInMainThread(e,t):new Ue(n=>{let r=a=>{let{action:l,data:u}=a.data;l==="networkMetrics"?(n.next(u),n.complete()):l==="error"&&n.error(new Error(u))};return this.worker.addEventListener("message",r),this.worker.postMessage({action:"calculateNetworkMetrics",data:{elements:e||[],connections:t||[]}}),()=>{this.worker.removeEventListener("message",r)}}).pipe(Te(n=>this.logger.debug("M\xE9tricas de red calculadas:",n)),Pe(n=>(this.logger.error("Error en c\xE1lculo de m\xE9tricas:",n),Ce(this.getDefaultMetrics()))))}findOptimalPath(e,t,n){return!this.isWorkerSupported||!this.worker?Ce({path:[],distance:0}):new Ue(r=>{let a=l=>{let{action:u,data:g}=l.data;u==="optimalPath"?(r.next(g),r.complete()):u==="error"&&r.error(new Error(g))};return this.worker.addEventListener("message",a),this.worker.postMessage({action:"findOptimalPath",data:{source:e,target:t,connections:n||[]}}),()=>{this.worker.removeEventListener("message",a)}})}analyzeNetworkClusters(e,t){return!this.isWorkerSupported||!this.worker?Ce([]):new Ue(n=>{let r=a=>{let{action:l,data:u}=a.data;l==="networkClusters"?(n.next(u),n.complete()):l==="error"&&n.error(new Error(u))};return this.worker.addEventListener("message",r),this.worker.postMessage({action:"analyzeNetworkClusters",data:{elements:e||[],connections:t||[]}}),()=>{this.worker.removeEventListener("message",r)}})}calculateMetricsInMainThread(e,t){return Ce(this.getDefaultMetrics()).pipe(Te(()=>this.logger.warn("C\xE1lculo realizado en hilo principal")))}getDefaultMetrics(){return{totalDistance:0,averageConnections:0,networkDensity:0,centralElements:[],clusters:[],performanceIndicators:{calculationTime:0,complexity:"low"}}}ngOnDestroy(){this.worker&&(this.worker.terminate(),this.worker=null)}static{this.\u0275fac=function(t){return new(t||o)(O(K))}}static{this.\u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var km=(()=>{class o{constructor(e,t,n){this.mapService=e,this.logger=t,this.networkStateService=n,this.svg=null,this.currentMeasurements=null}loadJsPDF(){return ce(this,null,function*(){let{jsPDF:e}=yield import("./chunk-R3VGRIET.js");return e})}loadHtml2Canvas(){return ce(this,null,function*(){return(yield import("./chunk-5MGQ7NMG.js")).default})}initialize(e){this.svg=e,this.logger.debug("Servicio de exportaci\xF3n inicializado")}setMeasurements(e){this.currentMeasurements=e}exportMap(e){this.logger.debug(`Exportando mapa en formato ${e}`);try{switch(e.toLowerCase()){case"png":this.exportToPNG();break;case"pdf":this.exportToPDF();break;case"json":this.exportToJSON();break;case"svg":this.exportToSVG();break;case"measurements":this.exportMeasurements();break;default:this.logger.error(`Formato de exportaci\xF3n no soportado: ${e}`);break}}catch(t){this.logger.error("Error al exportar mapa:",t)}}exportToPNG(e){let t=e||`network-map-${new Date().toISOString().slice(0,10)}.png`;try{this.mapService.exportMap("png"),this.logger.info(`Mapa exportado como PNG: ${t}`)}catch(n){this.logger.error("Error al exportar como PNG:",n)}}exportToPDF(e){let t=e||`network-map-${new Date().toISOString().slice(0,10)}.pdf`;try{return Gi(new Promise(n=>ce(this,null,function*(){try{let r=yield this.loadJsPDF(),a=document.querySelector(".map-content svg");if(!a){this.logger.error("No se encontr\xF3 el elemento SVG del mapa"),n(!1);return}let l=document.createElement("canvas"),u=a.getBoundingClientRect();l.width=u.width,l.height=u.height;let g=new XMLSerializer().serializeToString(a),f="data:image/svg+xml;base64,"+btoa(g),S=new Image;S.onload=()=>{let T=l.getContext("2d");if(!T){this.logger.error("No se pudo obtener el contexto 2D del canvas"),n(!1);return}T.drawImage(S,0,0);let w=new r({orientation:"landscape",unit:"px",format:[l.width,l.height]}),M=this.networkStateService.getCurrentState();w.setProperties({title:"Network Map",subject:"Network Map Export",author:"Network Map Tool",keywords:"network, map, export",creator:"Network Map Tool"});let z=l.toDataURL("image/png");w.addImage(z,"PNG",0,0,l.width,l.height),w.setFontSize(10),w.setTextColor(128,128,128),w.text(`Exportado: ${new Date().toLocaleString()}`,10,l.height-10),w.save(t),this.logger.info(`Mapa exportado como PDF: ${t}`),n(!0)},S.onerror=()=>{this.logger.error("Error al cargar la imagen SVG"),n(!1)},S.src=f}catch(r){this.logger.error("Error al exportar como PDF:",r),n(!1)}}))).pipe(Pe(n=>(this.logger.error("Error al exportar como PDF:",n),Ce(!1))))}catch(n){return this.logger.error("Error al exportar como PDF:",n),Ce(!1)}}exportToJSON(e){let t=e||`network-map-${new Date().toISOString().slice(0,10)}.json`;try{let n=this.networkStateService.getCurrentState(),r=n.connections?n.connections:[],a=n.connections?n.connections:[],l={version:"1.0",timestamp:new Date().toISOString(),elements:r,connections:a,metadata:{totalElements:r.length,totalConnections:a.length,exportedBy:"NetworkMapTool"}},u=JSON.stringify(l,null,2),g=new Blob([u],{type:"application/json;charset=utf-8"});this.downloadBlob(g,t),this.logger.info(`Mapa exportado como JSON: ${t}`)}catch(n){this.logger.error("Error al exportar como JSON:",n)}}exportToSVG(e){let t=e||`network-map-${new Date().toISOString().slice(0,10)}.svg`;try{if(!this.svg||!this.svg.node()){this.logger.error("No se pudo exportar el SVG: elemento svg no inicializado");return}let n=this.svg.node().cloneNode(!0);this.applyInlineStyles(n);let a=new XMLSerializer().serializeToString(n),l=new Blob([a],{type:"image/svg+xml;charset=utf-8"});this.downloadBlob(l,t),this.logger.info(`Mapa exportado como SVG: ${t}`)}catch(n){this.logger.error("Error al exportar como SVG:",n)}}exportMeasurements(){if(!this.currentMeasurements){this.logger.warn("No hay mediciones para exportar"),this.networkStateService.showSnackbar("No hay mediciones para exportar","warning");return}try{let e={timestamp:new Date().toISOString(),measurements:this.currentMeasurements,metadata:{type:"distance-measurement",unit:"meters",exportedBy:"NetworkMapTool"}},t=JSON.stringify(e,null,2),n=new Blob([t],{type:"application/json;charset=utf-8"});this.downloadBlob(n,`network-measurements-${this.getDateTimeString()}.json`),this.networkStateService.showSnackbar("Mediciones exportadas","success")}catch(e){this.logger.error("Error al exportar mediciones:",e),this.networkStateService.showSnackbar("Error al exportar mediciones","error")}}saveMapState(e,t,n="json",r){this.logger.debug(`Guardando estado del mapa en formato ${n}`),n.toLowerCase()!=="json"&&this.logger.warn(`Formato no soportado para guardar estado: ${n}. Usando JSON.`);let a=r||`network-map-state-${new Date().toISOString().slice(0,10)}.json`;try{let l={elements:e,connections:t,metadata:{version:"1.0",exportDate:new Date().toISOString(),elementCount:e.length,connectionCount:t.length}},u=JSON.stringify(l,null,2),g=new Blob([u],{type:"application/json"}),_=URL.createObjectURL(g),f=document.createElement("a");f.href=_,f.download=a,document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(_),this.logger.info(`Estado del mapa guardado como JSON: ${a}`)}catch(l){throw this.logger.error("Error al guardar estado del mapa:",l),l}}generateMapReport(e,t,n){let r=n||`network-map-report-${new Date().toISOString().slice(0,10)}.pdf`;this.logger.debug("Generando informe del mapa en PDF"),this.loadJsPDF().then(a=>{try{let l=new a({orientation:"landscape",unit:"mm",format:"a4"});l.setProperties({title:"Network Map Report",subject:"Network Map Detailed Report",author:"Network Map Tool",keywords:"network, map, report",creator:"Network Map Tool"}),l.setFontSize(22),l.setTextColor(0,0,0),l.text("Network Map Report",15,15),l.setFontSize(12),l.setTextColor(100,100,100),l.text(`Generated: ${new Date().toLocaleString()}`,15,22),l.setDrawColor(200,200,200),l.line(15,25,280,25),l.setFontSize(16),l.setTextColor(0,0,0),l.text("Summary",15,35),l.setFontSize(12),l.text(`Total Elements: ${e.length}`,15,45),l.text(`Total Connections: ${t.length}`,15,52);let u=this.calculateElementsByType(e);l.setFontSize(14),l.text("Elements by Type",15,65);let g=70;l.setFontSize(10),l.setTextColor(0,0,0),l.setFillColor(240,240,240),l.rect(15,g,100,7,"F"),l.setFont("helvetica","bold"),l.text("Element Type",17,g+5),l.text("Count",80,g+5),l.setFont("helvetica","normal"),g+=10,Object.entries(u).forEach(([f,S],T)=>{T%2===0&&(l.setFillColor(250,250,250),l.rect(15,g-5,100,7,"F")),l.text(this.getElementTypeName(f),17,g),l.text(S.toString(),80,g),g+=7}),e.length>10&&(l.addPage(),l.setFontSize(16),l.setTextColor(0,0,0),l.text("Elements Detail",15,15),g=25,l.setFontSize(10),l.setFillColor(240,240,240),l.rect(15,g,260,7,"F"),l.setFont("helvetica","bold"),l.text("ID",17,g+5),l.text("Name",50,g+5),l.text("Type",120,g+5),l.text("Status",160,g+5),l.text("Connections",200,g+5),l.setFont("helvetica","normal"),g+=10,e.slice(0,30).forEach((f,S)=>{S%2===0&&(l.setFillColor(250,250,250),l.rect(15,g-5,260,7,"F"));let T=t.filter(w=>w.sourceElementId===f.id||w.targetElementId===f.id).length;l.text(f.id?.slice(0,12)||"N/A",17,g),l.text(f.name?.slice(0,25)||"Sin nombre",50,g),l.text(this.getElementTypeName(f.type),120,g),l.text(f.status||"Desconocido",160,g),l.text(T.toString(),200,g),g+=7,g>190&&S<e.length-1&&(l.addPage(),g=15,l.setFontSize(16),l.text("Elements Detail (continued)",15,g),g=25,l.setFontSize(10),l.setFillColor(240,240,240),l.rect(15,g,260,7,"F"),l.setFont("helvetica","bold"),l.text("ID",17,g+5),l.text("Name",50,g+5),l.text("Type",120,g+5),l.text("Status",160,g+5),l.text("Connections",200,g+5),l.setFont("helvetica","normal"),g+=10)}));let _=l.getNumberOfPages();for(let f=1;f<=_;f++)l.setPage(f),l.setFontSize(8),l.setTextColor(150,150,150),l.text(`Network Map Report - Page ${f} of ${_}`,l.internal.pageSize.getWidth()/2,l.internal.pageSize.getHeight()-10,{align:"center"});l.save(r),this.logger.info(`Informe del mapa generado como PDF: ${r}`)}catch(l){throw this.logger.error("Error al generar informe del mapa:",l),l}}).catch(a=>{this.logger.error("Error al cargar jsPDF:",a)})}calculateElementsByType(e){let t={};return e.forEach(n=>{t[n.type]||(t[n.type]=0),t[n.type]++}),t}getElementTypeName(e){return{FDP:"Fiber Distribution Point",OLT:"Optical Line Terminal",ONT:"Optical Network Terminal",SPLITTER:"Splitter",EDFA:"Erbium Doped Fiber Amplifier",MANGA:"Fiber Splice Enclosure",TERMINAL_BOX:"Terminal Box",MSAN:"Multi-Service Access Node"}[e]||e}downloadBlob(e,t){let n=URL.createObjectURL(e),r=document.createElement("a");r.href=n,r.download=t,document.body.appendChild(r),r.click(),setTimeout(()=>{document.body.removeChild(r),URL.revokeObjectURL(n)},100)}applyInlineStyles(e){let t=e.querySelectorAll("*");for(let n=0;n<t.length;n++){let r=t[n],a=window.getComputedStyle(r);for(let l=0;l<a.length;l++){let u=a[l],g=a.getPropertyValue(u);g&&(r.style[u]=g)}}}getDateTimeString(){return new Date().toISOString().replace(/:/g,"-").replace(/\..+/,"").replace("T","_")}static{this.\u0275fac=function(t){return new(t||o)(O(Bt),O(K),O(Ie))}}static{this.\u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var Im=(()=>{class o{preload(e,t){return e.data?.preload===!0?t():Ce(null)}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var Dm={providers:[Gs(yd,Hs(Im)),js(Us([_m,vm])),vp(),fc(um),Kp(hm),$p({maxAge:25,logOnly:!1,autoPause:!0,trace:!1,traceLimit:75}),{provide:Ys,useValue:!0},tt,fl,ri,K,Fl,Yl,bm,Cm,ym,Em,Xl,So,zo,Ie,Bt,Rl,Ft,wm,xm,Sm,wr,ei,ec,an,sn,cc,Pm,Tm,Om,Eo,km]};var Am=(()=>{class o{constructor(e,t,n){this.keyboardService=e,this.helpService=t,this.router=n,this.title="Network Map"}ngOnInit(){this.routerSubscription=this.router.events.pipe(Ee(e=>e instanceof Nn)).subscribe(e=>{this.updateKeyboardContexts(e.url)}),this.setupShortcutListeners()}ngOnDestroy(){this.routerSubscription&&this.routerSubscription.unsubscribe()}updateKeyboardContexts(e){e.includes("/network-design/map")?this.keyboardService.setActiveContext("map"):e.includes("/network-design/element/")&&e.includes("/edit/")?this.keyboardService.setActiveContext("editor"):e.includes("/network-design/element/")&&e.includes("/batch")?this.keyboardService.setActiveContext("batch-editor"):e.includes("/network-design/element/history/")?this.keyboardService.setActiveContext("detail-view"):this.keyboardService.setActiveContext("global")}setupShortcutListeners(){document.addEventListener("app-shortcut",e=>{switch(e.detail?.id){case"help":this.helpService.showKeyboardShortcutsHelp();break;case"refresh":window.location.reload();break}})}static{this.\u0275fac=function(t){return new(t||o)(A(ii),A(ri),A(Oe))}}static{this.\u0275cmp=Y({type:o,selectors:[["app-root"]],decls:1,vars:0,template:function(t,n){t&1&&D(0,"router-outlet")},dependencies:[Nt],encapsulation:2})}}return o})();Vs(Am,Dm).catch(o=>console.error(o));
