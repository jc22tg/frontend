@use '../../../../network-design.styles.scss' as global-styles;

.network-toolbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--spacing-xs, 5px) var(--spacing-sm, 8px);
  background-color: var(--surface-color, #ffffff);
  box-shadow: var(--shadow-sm, 0 2px 8px rgba(0, 0, 0, 0.08));
  height: var(--toolbar-height, 46px);
  font-family: var(--font-family, 'Roboto', 'Segoe UI', sans-serif);
  border-radius: var(--border-radius-md, 4px);
  margin: var(--spacing-xs, 6px) var(--spacing-xs, 6px) var(--spacing-sm, 10px) var(--spacing-xs, 6px);
  z-index: var(--z-index-toolbar, 1100);

  .layer-controls,
  .element-controls,
  .map-controls {
    display: flex;
    gap: var(--spacing-xs, 4px);
    align-items: center;

    .mat-button {
      border-radius: var(--border-radius-md, 4px);
      padding: 0 var(--spacing-sm, 8px);
      height: var(--toolbar-button-height, 30px);
      font-weight: 500;
      letter-spacing: 0.2px;
      transition: all var(--transition-fast, 0.2s) ease;
      
      .mat-icon {
        margin-right: var(--spacing-xs, 4px);
        font-size: var(--icon-size-sm, 18px);
        height: var(--icon-size-sm, 18px);
        width: var(--icon-size-sm, 18px);
      }
      
      &:hover {
        background-color: var(--surface-action-hover, rgba(0, 0, 0, 0.04));
        transform: translateY(-1px);
      }
      
      &:active {
        transform: translateY(0);
      }
    }

    .mat-icon-button {
      height: var(--toolbar-button-height, 30px);
      width: var(--toolbar-button-height, 30px);
      border-radius: var(--border-radius-md, 4px);
      transition: all var(--transition-fast, 0.2s) ease;
      
      &:hover {
        background-color: var(--surface-action-hover, rgba(0, 0, 0, 0.04));
        transform: translateY(-1px);
      }
      
      &:active {
        transform: translateY(0);
      }
      
      .mat-icon {
        font-size: var(--icon-size-sm, 18px);
        height: var(--icon-size-sm, 18px);
        width: var(--icon-size-sm, 18px);
      }
      
      &.active {
        background-color: var(--primary-bg-subtle, rgba(25, 118, 210, 0.1));
        color: var(--primary-color, #1976d2);
        
        &:hover {
          background-color: #{rgba(global-styles.$primary-color, 0.15)};
        }
      }
    }
  }

  .menu-button {
    display: flex;
    align-items: center;
    
    span {
      font-weight: 500;
      font-size: var(--font-size-xs, 13px);
    }
  }
}

mat-divider[vertical], .mat-divider-vertical {
  height: var(--toolbar-button-height, 30px) !important;
  margin: 0 var(--spacing-xxs, 2px) !important;
}

:host ::ng-deep {
  .mat-mdc-menu-panel {
    max-width: none !important;
    border-radius: var(--border-radius-lg, 8px);
    overflow: hidden;
    box-shadow: var(--shadow-lg, 0 8px 16px rgba(0, 0, 0, 0.12));
    pointer-events: auto !important;
    z-index: 3000 !important;
    
    .menu-header {
      padding: var(--spacing-sm, 10px) var(--spacing-lg, 16px) var(--spacing-sm, 8px);
      
      span {
        font-size: var(--font-size-xs, 13px);
        font-weight: 500;
        color: var(--text-hint-color, #555);
        text-transform: uppercase;
        letter-spacing: 0.8px;
      }
    }
    
    .mat-mdc-menu-item {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm, 8px);
      padding: var(--spacing-sm, 8px) var(--spacing-lg, 16px);
      height: auto;
      min-height: var(--menu-item-height, 42px);
      font-size: var(--font-size-sm, 14px);
      font-weight: 400;
      letter-spacing: 0.1px;
      transition: all var(--transition-fast, 0.2s) ease;
      border-radius: var(--border-radius-md, 4px);
      margin: 0 var(--spacing-xs, 4px);
      cursor: pointer !important;
      pointer-events: auto !important;

      .mat-icon {
        margin-right: var(--spacing-sm, 8px);
        font-size: var(--icon-size-md, 20px);
        height: var(--icon-size-md, 20px);
        width: var(--icon-size-md, 20px);
        color: var(--text-secondary-color, #555);
      }

      span {
        flex: 1;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        color: var(--text-color, #333);
      }
      
      &:hover {
        background-color: var(--surface-action-hover, rgba(0, 0, 0, 0.04)) !important;
        transform: translateX(2px) !important;
        color: var(--primary-color, #1976d2) !important;
      }
      
      &.cdk-program-focused,
      &.cdk-keyboard-focused,
      &.mat-mdc-menu-item-highlighted {
        background-color: var(--surface-action-hover, rgba(0, 0, 0, 0.04)) !important;
        transform: translateX(2px) !important;
        color: var(--primary-color, #1976d2) !important;
      }
      
      &:active {
        background-color: #{rgba(global-styles.$text-color, 0.08)};
        transform: translateX(0);
      }

      .network-icon {
        &.fdp-icon { color: var(--fdp-color, #2196F3); }
        &.olt-icon { color: var(--olt-color, #4CAF50); }
        &.ont-icon { color: var(--ont-color); }
        &.edfa-icon { color: var(--edfa-color, #9C27B0); }
        &.splitter-icon { color: var(--splitter-color, #FF9800); }
        &.manga-icon { color: var(--manga-color, #795548); }
        &.terminal-box-icon { color: var(--terminal-box-color, #607D8B); }
      }
    }
    
    .mat-divider {
      margin: var(--spacing-sm, 8px) 0;
    }

    &.enhanced-menu {
      padding: var(--spacing-sm, 8px);
    }
  }

  .mat-tooltip {
    font-size: var(--font-size-xs, 13px);
    padding: var(--spacing-sm, 8px) var(--spacing-md, 12px);
    background-color: var(--tooltip-bg-color, rgba(33, 33, 33, 0.95));
    border-radius: var(--border-radius-sm, 6px);
    font-weight: 400;
    box-shadow: var(--shadow-md, 0 4px 8px rgba(0, 0, 0, 0.15));
  }

  .mat-badge-content {
    font-size: var(--font-size-xxs, 10px);
    height: var(--badge-size, 16px);
    width: var(--badge-size, 16px);
    line-height: var(--badge-size, 16px);
  }

  .mat-ripple-element {
    background-color: var(--primary-ripple-color, rgba(25, 118, 210, 0.1));
  }

  .add-element-menu {
    .mat-mdc-menu-content {
      padding: 8px;
      
      .add-element-menu-container {
        display: flex;
        flex-direction: column;
        gap: 4px;
        pointer-events: auto !important;
        position: relative;
        z-index: 3000 !important;
        
        .add-element-item {
          cursor: pointer !important;
          pointer-events: auto !important;
          z-index: 3000 !important;
          position: relative;
          
          &:hover {
            background-color: var(--surface-action-hover, rgba(0, 0, 0, 0.04)) !important;
            color: var(--primary-color, #1976d2) !important;
            transform: translateX(2px) !important;
          }
        }
      }
    }
  }
}

.active-button {
  position: relative;
  overflow: hidden;
  
  &::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 3px;
    background-color: var(--primary-color, #1976d2);
    transform: scaleX(0);
    transition: transform var(--transition-normal, 0.3s) ease;
  }
  
  &.active::after {
    transform: scaleX(1);
  }
}

.transition-element {
  transition: all var(--transition-normal, 0.3s) cubic-bezier(0.4, 0, 0.2, 1);
}

@media (max-width: global-styles.$breakpoint-tablet) {
  .network-toolbar {
    padding: var(--spacing-xs, 6px) var(--spacing-sm, 8px);
    height: auto;
    flex-wrap: wrap;
    margin: var(--spacing-xs, 4px);
    
    .layer-controls,
    .element-controls,
    .map-controls {
      gap: var(--spacing-xs, 4px);
      margin: var(--spacing-xxs, 2px) 0;
    }
    
    .mat-button {
      padding: 0 var(--spacing-sm, 8px);
      font-size: var(--font-size-xs, 13px);
      
      .mat-icon {
        margin-right: var(--spacing-xs, 4px);
        font-size: var(--icon-size-sm, 18px);
        height: var(--icon-size-sm, 18px);
        width: var(--icon-size-sm, 18px);
      }
    }
    
    .mat-icon-button {
      height: var(--toolbar-button-height-mobile, 32px);
      width: var(--toolbar-button-height-mobile, 32px);
      
      .mat-icon {
        font-size: var(--icon-size-sm, 18px);
        height: var(--icon-size-sm, 18px);
        width: var(--icon-size-sm, 18px);
      }
    }
  }

  .action-button {
    padding: 0 var(--spacing-md, 12px);
    
    span {
      display: none;
    }
    
    .mat-icon {
      margin-right: 0;
    }
  }
  
  .menu-button {
    span {
      // display: none;
    }
    
    .mat-icon:not(.dropdown-icon) {
      // margin-right: 0;
    }
    
    .dropdown-icon {
      // margin-left: 0;
    }
  }
}

@media (max-width: global-styles.$breakpoint-mobile) {
  .network-toolbar {
    padding: var(--spacing-xs, 4px);
    
    .menu-button {
      span {
        display: none;
      }
    }
  }
}

.dropdown-icon {
  font-size: var(--icon-size-sm, 18px) !important;
  height: var(--icon-size-sm, 18px) !important;
  width: var(--icon-size-sm, 18px) !important;
  margin-left: var(--spacing-xs, 4px) !important;
  margin-right: 0 !important;
  opacity: 0.7;
  transition: transform var(--transition-fast, 0.2s) ease;
}

.menu-button:hover .dropdown-icon {
  transform: translateY(2px);
}

.action-button {
  display: flex;
  align-items: center;
  padding: 0 var(--spacing-lg, 16px);
  height: var(--action-button-height, 40px);
  border-radius: var(--border-radius-lg, 8px);
  transition: all var(--transition-fast, 0.2s) ease;
  
  &.active {
    background-color: var(--primary-dark-color, #1565C0);
  }
  
  .mat-icon {
    margin-right: var(--spacing-sm, 8px);
  }
  
  &:hover {
    transform: translateY(-1px);
    box-shadow: var(--shadow-md, 0 2px 8px rgba(0, 0, 0, 0.15));
  }
  
  &:active {
    transform: translateY(0);
  }
}

.control-group {
  display: flex;
  background-color: var(--surface-lighter, rgba(0, 0, 0, 0.03));
  border-radius: var(--border-radius-lg, 8px);
  padding: var(--spacing-xxs, 2px);
  
  .map-control-button {
    margin: 0 var(--spacing-xxs, 2px);
    
    &:hover {
      background-color: var(--surface-action-hover, rgba(0, 0, 0, 0.08));
    }
  }
}

@keyframes pulse {
  0% {
    box-shadow: 0 0 0 0 #{rgba(global-styles.$primary-color, 0.4)};
  }
  70% {
    box-shadow: 0 0 0 6px #{rgba(global-styles.$primary-color, 0)};
  }
  100% {
    box-shadow: 0 0 0 0 #{rgba(global-styles.$primary-color, 0)};
  }
}

.button-pulse {
  animation: pulse 1.5s infinite;
}

@keyframes slideDown {
  from {
    transform: translateY(-10px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.network-toolbar {
  animation: slideDown var(--transition-normal, 0.3s) ease forwards;
}

.map-control-button {
  &.active {
    background-color: var(--primary-bg-subtle, rgba(25, 118, 210, 0.1));
    color: var(--primary-color, #1976d2);
    
    &:hover {
      background-color: #{rgba(global-styles.$primary-color, 0.15)};
    }
  }
}

@keyframes pulseIcon {
  0% { transform: scale(1); }
  50% { transform: scale(1.1); }
  100% { transform: scale(1); }
}

.map-control-button.active .mat-icon {
  animation: pulseIcon var(--transition-normal, 0.3s) ease-in-out;
}
