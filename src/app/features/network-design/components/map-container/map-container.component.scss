@use '../../network-design.styles.scss' as global-styles;
@use './map-container.shared.scss' as shared;

:host {
  display: flex;
  flex-direction: column;
  height: 100%;
  width: 100%;
  position: relative;
  overflow: hidden;
}

.map-container {
  flex: 1;
  position: relative;
  width: 100%;
  overflow: hidden;
  background-color: var(--surface-level-1, #f5f5f5);
}

#map, .map {
  width: 100%;
  height: 100%;
}

.map-widgets-container {
  position: absolute;
  z-index: var(--z-index-widgets-container, 1000);
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  pointer-events: none;
  
  > * {
    pointer-events: auto;
  }
}

.map-loading-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: var(--surface-overlay-light, rgba(255, 255, 255, 0.9));
  z-index: var(--z-index-loading-overlay, 1050);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  box-shadow: 0 6px 24px rgba(0,0,0,0.10);
  animation: fadeInUp 0.35s cubic-bezier(0.23, 1, 0.32, 1);

  .loading-spinner {
    margin-bottom: var(--spacing-md, 16px);
  }

  .loading-message {
    font-size: var(--font-size-lg, 18px);
    font-weight: 500;
    color: var(--text-color, #333333);
  }
}

.map-error-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: var(--surface-overlay-light-strong, rgba(255, 255, 255, 0.95));
  z-index: var(--z-index-loading-overlay, 1050);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  padding: var(--spacing-lg, 24px);
  text-align: center;
  box-shadow: 0 6px 24px rgba(255,0,0,0.10);
  animation: fadeInUp 0.35s cubic-bezier(0.23, 1, 0.32, 1);

  mat-icon {
    font-size: var(--icon-size-xxxl, 48px);
    height: var(--icon-size-xxxl, 48px);
    width: var(--icon-size-xxxl, 48px);
    margin-bottom: var(--spacing-md, 16px);
    color: var(--color-danger, #f44336);
  }

  h3 {
    font-size: var(--font-size-xl, 20px);
    font-weight: 500;
    margin: 0 0 var(--spacing-md, 16px) 0;
    color: var(--color-danger, #f44336);
  }

  p {
    font-size: var(--font-size-md, 16px);
    max-width: 400px;
    margin: 0 0 var(--spacing-lg, 24px) 0;
    color: var(--text-color, #333333);
  }

  button {
    padding: var(--button-padding-y, var(--spacing-sm, 8px)) var(--button-padding-x, var(--spacing-md, 16px));
    background-color: var(--button-bg-color, var(--primary-color, #007bff));
    color: var(--button-text-color, white);
    border: var(--button-border, none);
    border-radius: var(--button-border-radius, var(--border-radius-md, 4px));
    min-width: 150px;
  }
}

.map-content {
  flex: 1;
  position: relative;
  width: 100%;
  height: 100%;
  z-index: var(--z-index-map-base, 1);
  
  ::ng-deep .leaflet-container {
    width: 100% !important;
    height: 100% !important;
    background-color: var(--surface-level-1, #f5f5f5) !important;
    z-index: var(--z-index-map-base, 1);
  }
}

.cursor-position {
  position: absolute;
  bottom: var(--spacing-lg, 20px);
  left: var(--spacing-lg, 20px);
  background-color: var(--surface-overlay-light, rgba(255, 255, 255, 0.9));
  padding: var(--spacing-xs, 5px) var(--spacing-sm, 10px);
  border-radius: var(--border-radius-md, 4px);
  font-size: var(--font-size-xs, 12px);
  box-shadow: var(--shadow-sm, 0 1px 3px rgba(0,0,0,0.12));
  z-index: var(--z-index-map-widgets-overlay, 50);
  color: var(--text-color, #333);
}

.save-notification {
  position: absolute;
  top: var(--spacing-lg, 20px);
  right: var(--spacing-lg, 20px);
  background-color: var(--color-success-bg-strong, rgba(76, 175, 80, 0.9));
  color: var(--color-success-contrast, white);
  padding: var(--spacing-sm, 10px) var(--spacing-md, 15px);
  border-radius: var(--border-radius-md, 4px);
  display: flex;
  align-items: center;
  box-shadow: var(--shadow-md, 0 2px 6px rgba(0,0,0,0.15));
  z-index: var(--z-index-dialog, 1075);
  
  mat-icon {
    margin-right: var(--spacing-sm, 8px);
  }
}

.measurement-info {
  position: absolute;
  top: var(--spacing-xl, 80px);
  right: var(--spacing-lg, 20px);
  width: var(--measurement-info-width, 300px);
  background-color: var(--surface-color, white); 
  border-radius: var(--border-radius-lg, 8px);
  box-shadow: var(--shadow-md, 0 2px 6px rgba(0,0,0,0.15));
  z-index: var(--z-index-floating-panel-base, 1000);
  overflow: hidden;
  color: var(--text-color, #333);
  
  .measurement-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--spacing-sm, 10px) var(--spacing-md, 15px);
    background-color: var(--primary-color, #3f51b5);
    color: var(--primary-contrast-color, white);
  }
  
  .measurement-content {
    padding: var(--spacing-md, 15px);
    .measurement-distance {
      margin-top: var(--spacing-sm, 10px);
      font-size: var(--font-size-lg, 16px);
    }
  }
  
  .measurement-actions {
    padding: var(--spacing-sm, 10px);
    display: flex;
    justify-content: flex-end;
    border-top: 1px solid var(--border-color, #eee);
  }
}

app-network-toolbar {
  z-index: var(--z-index-toolbar, 1100);
  position: relative;
}

.element-tooltip {
  position: absolute;
  background-color: var(--tooltip-bg-color, var(--surface-color, white)); 
  border-radius: var(--border-radius-sm, 4px); 
  padding: var(--spacing-xs, 4px) var(--spacing-sm, 8px);
  box-shadow: var(--shadow-md, 0 2px 6px rgba(0,0,0,0.15)); 
  font-size: var(--font-size-xs, 12px);
  color: var(--tooltip-text-color, var(--text-color, #333)); 
  max-width: 200px;
  z-index: var(--z-index-tooltip, 1150);
  pointer-events: none;
  
  &__title {
    font-weight: 500;
  }
}

:host-context(.dark-theme) {
  // Ejemplo: si el fondo del mapa necesita un color específico en dark mode
  // que no es el --surface-level-1 global del tema oscuro.
  // .map-container { background-color: var(--map-specific-dark-bg, #2a2a2a); }
}

.map-container:empty::after {
  content: "⚠️ Error: No se pudo cargar el contenedor del mapa";
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%;
  width: 100%;
  background-color: var(--color-warning-bg-subtle, #ffcccc);
  color: var(--color-warning-contrast-strong, #d32f2f);
  font-size: var(--font-size-lg, 16px);
  font-weight: bold;
  z-index: var(--z-index-map-base, 1);
}

.leaflet-container:not(:has(.leaflet-tile))::after {
  content: "⚠️ Error: No se pudieron cargar las capas del mapa";
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: var(--surface-overlay-light, rgba(255, 255, 255, 0.9));
  padding: var(--spacing-sm, 12px) var(--spacing-md, 16px);
  border-radius: var(--border-radius-md, 4px);
  color: var(--color-danger-strong, #d32f2f);
  font-weight: bold;
  z-index: var(--z-index-loading-overlay, 1050);
}

.map-error-message {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: var(--color-warning-bg, #fff3cd);
  color: var(--color-warning-contrast, #856404);
  border: 1px solid var(--color-warning-border, #ffeeba);
  border-radius: var(--border-radius-lg, 8px);
  padding: var(--spacing-xl, 24px);
  margin: var(--spacing-lg, 16px) auto;
  max-width: 400px;
  font-size: var(--font-size-md, 16px);
  box-shadow: var(--shadow-sm, 0 2px 8px rgba(0,0,0,0.05));
  z-index: var(--z-index-map-overlay, 100);
}

.map-error-icon {
  font-size: var(--icon-size-xxxxl, 48px);
  margin-bottom: var(--spacing-md, 12px);
}

.map-error-text {
  text-align: center;
}

.performance-info {
  position: absolute;
  bottom: var(--spacing-sm, 10px);
  left: var(--spacing-sm, 10px);
  background: rgba(0, 0, 0, 0.6);
  color: white;
  padding: var(--spacing-xs, 5px) var(--spacing-sm, 10px);
  border-radius: var(--border-radius-md, 4px);
  font-size: var(--font-size-xs, 12px);
  z-index: var(--z-index-debug-info, 999);
}

.performance-metric {
  margin-right: var(--spacing-sm, 10px);
}

::ng-deep {
  .leaflet-popup-content-wrapper {
    border-radius: var(--border-radius-md, 4px);
    background-color: var(--surface-color, white);
    color: var(--text-color, #333);
  }
  
  .leaflet-popup-tip {
    background-color: var(--surface-color, white);
  }
  
  .leaflet-control-zoom {
    border-radius: var(--border-radius-md, 4px);
    border: none;
    
    a.leaflet-control-zoom-in,
    a.leaflet-control-zoom-out {
      border-radius: var(--border-radius-md, 4px) !important;
      background-color: var(--surface-button, var(--surface-color, white));
      color: var(--text-color-button, var(--text-color, #333));
      transition: background-color var(--transition-fast, 0.2s) ease;
      
      &:hover {
        background-color: var(--surface-button-hover, var(--surface-hover, #f0f0f0));
      }
    }
  }
  
  .marker-cluster {
    background-color: var(--primary-bg-semitransparent, rgba(63, 81, 181, 0.4));
    div {
      background-color: var(--primary-bg-strong-semitransparent, rgba(63, 81, 181, 0.8));
      color: var(--primary-contrast-color, white);
      font-weight: bold;
      border-radius: 50%;
    }
    &:hover {
      background-color: var(--primary-bg-hover-semitransparent, rgba(63, 81, 181, 0.6));
    }
  }
  
  .leaflet-tooltip {
    background-color: var(--tooltip-leaflet-bg, var(--surface-overlay-light, rgba(255, 255, 255, 0.9)));
    color: var(--tooltip-leaflet-text-color, var(--text-color, #333));
    border: none;
    box-shadow: var(--shadow-md, 0 2px 6px rgba(0,0,0,0.2));
    padding: var(--spacing-xs, 4px) var(--spacing-sm, 8px);
    font-size: var(--font-size-xs, 12px);
    border-radius: var(--border-radius-sm, 4px);
    
    &::before {
    }
  }

  .leaflet-control-attribution {
    background-color: var(--surface-overlay-light-semitransparent, rgba(255,255,255,0.7)) !important;
    color: var(--text-secondary-color, #666) !important;
  }

  .leaflet-marker-icon {
    cursor: pointer;
  }
} 